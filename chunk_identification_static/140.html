<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>140</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    140
                    <a href="139.html">prev</a>
                    <a href="141.html">next</a>
                    <a href="140_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_af265461f1c56e3a7adc42f34032f45b8522722a_src/com/android/launcher3/LauncherBackupHelper.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;af265461f1c56e3a7adc42f34032f45b8522722a:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;af265461f1c56e3a7adc42f34032f45b8522722a^1:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;af265461f1c56e3a7adc42f34032f45b8522722a^2:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;d848ca4869b4f0ae1ddc0ee7abe00984d6162cc1:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b]], subset: [[b], [b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  28 import android.content.pm.PackageManager;                                                                </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  29 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-3433483468941074901" onmouseenter="enter('-3433483468941074901');" onmouseout="out('-3433483468941074901');" style="">  35 import android.graphics.Point;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  36 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  37 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  38 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  39 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  40 import android.util.Log;                                                                                 </span>
<span  style="">  41                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  42 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  43 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  44 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  45 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  46 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  47 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  48 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  49 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  50 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  51 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  52 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  53 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  54 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-797779758351574749" onmouseenter="enter('-797779758351574749');" onmouseout="out('-797779758351574749');" style="">  55 import com.android.launcher3.model.MigrateFromRestoreTask;                                               </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  56 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  57 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  58 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  59                                                                                                          </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  60 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  61 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  62                                                                                                          </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  63 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  64 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  65 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  66 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  69 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  70 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  71                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  72 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  73  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  74  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  75 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  76     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  77     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  78     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  79                                                                                                          </span>
<span class="826917367119663975" onmouseenter="enter('826917367119663975');" onmouseout="out('826917367119663975');" style="">  80     private static final int BACKUP_VERSION = 4;                                                         </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  81     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  82                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  83     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  84     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  85     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  86                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  87     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  88     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  90     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  91     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  92                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  93     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  94         Favorites._ID,                     // 0                                                          </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  95         Favorites.MODIFIED,                // 1                                                          </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  96         Favorites.INTENT,                  // 2                                                          </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  97         Favorites.APPWIDGET_PROVIDER,      // 3                                                          </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  98         Favorites.APPWIDGET_ID,            // 4                                                          </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  99         Favorites.CELLX,                   // 5                                                          </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 100         Favorites.CELLY,                   // 6                                                          </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 101         Favorites.CONTAINER,               // 7                                                          </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 102         Favorites.ICON,                    // 8                                                          </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 103         Favorites.ICON_PACKAGE,            // 9                                                          </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 104         Favorites.ICON_RESOURCE,           // 10                                                         </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 105         Favorites.ICON_TYPE,               // 11                                                         </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 106         Favorites.ITEM_TYPE,               // 12                                                         </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 107         Favorites.SCREEN,                  // 13                                                         </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 108         Favorites.SPANX,                   // 14                                                         </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 109         Favorites.SPANY,                   // 15                                                         </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 110         Favorites.TITLE,                   // 16                                                         </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 111         Favorites.PROFILE_ID,              // 17                                                         </span>
<span class="8195666479774249088" onmouseenter="enter('8195666479774249088');" onmouseout="out('8195666479774249088');" style=""> 112         Favorites.RANK,                    // 18                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 113     };                                                                                                   </span>
<span  style=""> 114                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 115     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 116     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 117     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 118     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 119     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 120     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 121     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 122     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 123     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 124     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 125     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 126     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 127     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 128     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 129     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 130     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 131     private static final int TITLE_INDEX = 16;                                                           </span>
<span class="-9020064880382451057" onmouseenter="enter('-9020064880382451057');" onmouseout="out('-9020064880382451057');" style=""> 132     private static final int RANK_INDEX = 18;                                                            </span>
<span  style=""> 133                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 134     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 135         WorkspaceScreens._ID,              // 0                                                          </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 136         WorkspaceScreens.MODIFIED,         // 1                                                          </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 137         WorkspaceScreens.SCREEN_RANK       // 2                                                          </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 138     };                                                                                                   </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 140     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 141                                                                                                          </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style=""> 142     @Thunk final Context mContext;                                                                       </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 143     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 144     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 145     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 146     private final long mUserSerial;                                                                      </span>
<span  style=""> 147                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 148     private BackupManager mBackupManager;                                                                </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 149     private byte[] mBuffer = new byte[512];                                                              </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 150     private long mLastBackupRestoreTime;                                                                 </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 151     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 152                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 153     private IconCache mIconCache;                                                                        </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 154     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 155     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 156                                                                                                          </span>
<span class="8277982309001466181" onmouseenter="enter('8277982309001466181');" onmouseout="out('8277982309001466181');" style=""> 157     DeviceProfieData migrationCompatibleProfileData;                                                     </span>
<span class="324588424384202565" onmouseenter="enter('324588424384202565');" onmouseout="out('324588424384202565');" style=""> 158     HashSet&lt;String&gt; widgetSizes = new HashSet&lt;&gt;();                                                       </span>
<span  style=""> 159                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 160     boolean restoreSuccessful;                                                                           </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 161     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 162                                                                                                          </span>
<span class="4744147174059046892" onmouseenter="enter('4744147174059046892');" onmouseout="out('4744147174059046892');" style=""> 163     // When migrating from a device which different hotseat configuration, the icons are shifted         </span>
<span class="-3936955316846306336" onmouseenter="enter('-3936955316846306336');" onmouseout="out('-3936955316846306336');" style=""> 164     // to center along the new all-apps icon.                                                            </span>
<span class="309766951368773182" onmouseenter="enter('309766951368773182');" onmouseout="out('309766951368773182');" style=""> 165     private int mHotseatShift = 0;                                                                       </span>
<span  style=""> 166                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 167     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 168         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 169         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 170         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 171         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 172         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span  style=""> 173                                                                                                          </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 174         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 175         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 178     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 179         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 180             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 182         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 185     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 186         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 187         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 188         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 189             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 190                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 193         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 196     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 197      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 198      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 199      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 200      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 201      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 202      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 203      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 204      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 205      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 206      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 207     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 208     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 209             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 210         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 211                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 212         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 213         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 214             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 215             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 216             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 217             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 220         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 221             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 222             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 223             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 224             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span  style=""> 226                                                                                                          </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 227         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 228         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 229         applyJournal(in);                                                                                </span>
<span  style=""> 230                                                                                                          </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 231         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 232         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 233         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 234         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 235         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 236             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 237             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 238             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 239             backupWidgets(data);                                                                         </span>
<span  style=""> 240                                                                                                          </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 241             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 242             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 243             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 244                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 246             mExistingKeys.removeAll(validKeys);                                                          </span>
<span  style=""> 247                                                                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 248             // Delete anything left in the existing keys.                                                </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 249             for (String deleted: mExistingKeys) {                                                        </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 250                 if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                             </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 251                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 252                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253             }                                                                                            </span>
<span  style=""> 254                                                                                                          </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 255             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 256             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 257                 // Check if any metadata has changed                                                     </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 258                 mBackupDataWasUpdated = (in.profile == null)                                             </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 259                         || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                      </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style=""> 260                             DeviceProfieData.toByteArray(mDeviceProfileData))                            </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 261                         || (in.backupVersion != BACKUP_VERSION)                                          </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 262                         || (in.appVersion != getAppVersion());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span  style=""> 264                                                                                                          </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 265             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 266                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span  style=""> 267                                                                                                          </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 268                 // We store the journal at two places.                                                   </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 269                 //   1) Storing it in newState allows us to do partial backups by comparing old state    </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 270                 //   2) Storing it in backup data allows us to validate keys during restore              </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 271                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 272                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 273             } else {                                                                                     </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 274                 if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 276         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 277             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span  style=""> 279                                                                                                          </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 280         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 283     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 284      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 285      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 287     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 288         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 289         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span  style=""> 290                                                                                                          </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 291         if (oldProfile == null || oldProfile.desktopCols == 0) {                                         </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 292             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 293             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="458635177486396964" onmouseenter="enter('458635177486396964');" onmouseout="out('458635177486396964');" style=""> 296         boolean isHotseatCompatible = false;                                                             </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 297         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style=""> 298             isHotseatCompatible = true;                                                                  </span>
<span class="6856306724544172936" onmouseenter="enter('6856306724544172936');" onmouseout="out('6856306724544172936');" style=""> 299             mHotseatShift = 0;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 302 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2142366465478542154" onmouseenter="enter('2142366465478542154');" onmouseout="out('2142366465478542154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 303         if ((currentProfile.allappsRank &gt;= oldProfile.allappsRank)                                       </span>
<span class="-6632599495891550017" onmouseenter="enter('-6632599495891550017');" onmouseout="out('-6632599495891550017');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304                 &amp;&amp; ((currentProfile.hotseatCount - currentProfile.allappsRank) &gt;=                        </span>
<span class="8568226590607864890" onmouseenter="enter('8568226590607864890');" onmouseout="out('8568226590607864890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305                         (oldProfile.hotseatCount - oldProfile.allappsRank))) {                           </span>
<span class="2270742623811584810" onmouseenter="enter('2270742623811584810');" onmouseout="out('2270742623811584810');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306             // There is enough space on both sides of the hotseat.                                       </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307             isHotseatCompatible = true;                                                                  </span>
<span class="5163576225814391245" onmouseenter="enter('5163576225814391245');" onmouseout="out('5163576225814391245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308             mHotseatShift = currentProfile.allappsRank - oldProfile.allappsRank;                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310                                                                                                          </span>
<span class="-1017020977077293413" onmouseenter="enter('-1017020977077293413');" onmouseout="out('-1017020977077293413');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311         if (!isHotseatCompatible) {                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313         }                                                                                                </span>
<span class="-8412024600313814265" onmouseenter="enter('-8412024600313814265');" onmouseout="out('-8412024600313814265');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314         if ((currentProfile.desktopCols &gt;= oldProfile.desktopCols)                                       </span>
<span class="5768651476481696104" onmouseenter="enter('5768651476481696104');" onmouseout="out('5768651476481696104');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows)) {                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318                                                                                                          </span>
<span class="4881414489005539302" onmouseenter="enter('4881414489005539302');" onmouseout="out('4881414489005539302');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319         if (MigrateFromRestoreTask.ENABLED &amp;&amp;                                                            </span>
<span class="990686264093981039" onmouseenter="enter('990686264093981039');" onmouseout="out('990686264093981039');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320                 (oldProfile.desktopCols - currentProfile.desktopCols &lt;= 1) &amp;&amp;                            </span>
<span class="-4956046918292613771" onmouseenter="enter('-4956046918292613771');" onmouseout="out('-4956046918292613771');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321                 (oldProfile.desktopRows - currentProfile.desktopRows &lt;= 1)) {                            </span>
<span class="-7375128792855769034" onmouseenter="enter('-7375128792855769034');" onmouseout="out('-7375128792855769034');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322             // Allow desktop migration when row and/or column count contracts by 1.                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323                                                                                                          </span>
<span class="-3339830446988550734" onmouseenter="enter('-3339830446988550734');" onmouseout="out('-3339830446988550734');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324             migrationCompatibleProfileData = initDeviceProfileData(mIdp);                                </span>
<span class="1832232547208942697" onmouseenter="enter('1832232547208942697');" onmouseout="out('1832232547208942697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325             migrationCompatibleProfileData.desktopCols = oldProfile.desktopCols;                         </span>
<span class="539436906242464602" onmouseenter="enter('539436906242464602');" onmouseout="out('539436906242464602');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326             migrationCompatibleProfileData.desktopRows = oldProfile.desktopRows;                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329         return false;                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 330 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331                                                                                                          </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)              </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 334 =======                                                                                                  </span>
<span class="-2322857033322689801" onmouseenter="enter('-2322857033322689801');" onmouseout="out('-2322857033322689801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335         out.key = keys.toArray(BackupProtos.Key.emptyArray());                                           </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336         writeJournal(newState, out);                                                                     </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337         Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                      </span>
<span class="-1379186895432660313" onmouseenter="enter('-1379186895432660313');" onmouseout="out('-1379186895432660313');" style=""> 338 &gt;&gt;&gt;&gt;&gt;&gt;&gt; THEIRS                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 341     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 342      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 343      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 344      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 345      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 346      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 347      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 348     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 349     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 350         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 351             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352         }                                                                                                </span>
<span  style=""> 353                                                                                                          </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 354         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 355         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 356             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 358         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 359             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 360             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 361             String backupKey = data.getKey();                                                            </span>
<span  style=""> 362                                                                                                          </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 363             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 364                 if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                       </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 365                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 366                     // We received the journal key after a restore key.                                  </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 367                     Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);       </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 368                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 369                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370                 }                                                                                        </span>
<span  style=""> 371                                                                                                          </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 372                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 373                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 374                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 375                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 376                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377             }                                                                                            </span>
<span  style=""> 378                                                                                                          </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 379             if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                        </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 380                 if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 381                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 383             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 384             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 385             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 386                 case Key.FAVORITE:                                                                       </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 387                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 388                     break;                                                                               </span>
<span  style=""> 389                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 390                 case Key.SCREEN:                                                                         </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 391                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 392                     break;                                                                               </span>
<span  style=""> 393                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 394                 case Key.ICON:                                                                           </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 395                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 396                     break;                                                                               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 397 =======                                                                                                  </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style=""> 398         return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)              </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style=""> 399                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                               </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 400 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 403     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 404      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 405      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 406      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 407      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 408      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 409      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 410     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 411     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 412         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 413             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414         }                                                                                                </span>
<span  style=""> 415                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 416         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 417             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 418             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 419             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 420             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 421             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422         }                                                                                                </span>
<span  style=""> 423                                                                                                          </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 424         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 425         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 426             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 428         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 429             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 430             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 431             String backupKey = data.getKey();                                                            </span>
<span  style=""> 432                                                                                                          </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 433             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 434                 if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                       </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 435                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 436                     // We received the journal key after a restore key.                                  </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 437                     Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);       </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 438                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 439                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440                 }                                                                                        </span>
<span  style=""> 441                                                                                                          </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 442                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 443                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 444                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 445                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 446                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447             }                                                                                            </span>
<span  style=""> 448                                                                                                          </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 449             if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                        </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 450                 if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 451                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 453             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 454             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 455             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 456                 case Key.FAVORITE:                                                                       </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 457                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 458                     break;                                                                               </span>
<span  style=""> 459                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 460                 case Key.SCREEN:                                                                         </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 461                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 462                     break;                                                                               </span>
<span  style=""> 463                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 464                 case Key.ICON:                                                                           </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 465                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 466                     break;                                                                               </span>
<span  style=""> 467                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 468                 case Key.WIDGET:                                                                         </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 469                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 470                     break;                                                                               </span>
<span  style=""> 471                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 472                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 473                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 474                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 475                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 477         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 478             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 482     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 483      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 484      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 485      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 486      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 487     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 488     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 489         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490     }                                                                                                    </span>
<span  style=""> 491                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 492     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 493         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 494         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 495         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 496         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 497         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 498         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 499         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500     }                                                                                                    </span>
<span  style=""> 501                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 502     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 503         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 504             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 505                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 506         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 507             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509     }                                                                                                    </span>
<span  style=""> 510                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 511 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 512     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 513         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 514         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 515         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 516         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 517         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 518         return data;                                                                                     </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 519 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527     /**                                                                                                  </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528      * @return the current device profile information.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529      */                                                                                                  </span>
<span class="4124629983355258626" onmouseenter="enter('4124629983355258626');" onmouseout="out('4124629983355258626');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530     private DeviceProfieData getDeviceProfieData() {                                                     </span>
<span class="-7376286606070162099" onmouseenter="enter('-7376286606070162099');" onmouseout="out('-7376286606070162099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531         if (mCurrentProfile != null) {                                                                   </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532             return mCurrentProfile;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533         }                                                                                                </span>
<span class="-5497719505817004004" onmouseenter="enter('-5497719505817004004');" onmouseout="out('-5497719505817004004');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534         final Context applicationContext = mContext.getApplicationContext();                             </span>
<span class="7980813194196555392" onmouseenter="enter('7980813194196555392');" onmouseout="out('7980813194196555392');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535         DeviceProfile profile = LauncherAppState.createDynamicGrid(applicationContext, null)             </span>
<span class="-5938220650159761744" onmouseenter="enter('-5938220650159761744');" onmouseout="out('-5938220650159761744');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536                 .getDeviceProfile();                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537                                                                                                          </span>
<span class="-8088032308844031335" onmouseenter="enter('-8088032308844031335');" onmouseout="out('-8088032308844031335');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538         mCurrentProfile = new DeviceProfieData();                                                        </span>
<span class="7442338639987606524" onmouseenter="enter('7442338639987606524');" onmouseout="out('7442338639987606524');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539         mCurrentProfile.desktopRows = profile.numRows;                                                   </span>
<span class="-4500555851720273514" onmouseenter="enter('-4500555851720273514');" onmouseout="out('-4500555851720273514');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540         mCurrentProfile.desktopCols = profile.numColumns;                                                </span>
<span class="-3431910476829522829" onmouseenter="enter('-3431910476829522829');" onmouseout="out('-3431910476829522829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541         mCurrentProfile.hotseatCount = profile.numHotseatIcons;                                          </span>
<span class="1465841957362210064" onmouseenter="enter('1465841957362210064');" onmouseout="out('1465841957362210064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542         mCurrentProfile.allappsRank = profile.hotseatAllAppsRank;                                        </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543         return mCurrentProfile;                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 544 =======                                                                                                  </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545         // clear the output journal time, to force a full backup to                                      </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         // will catch any changes the restore process might have made                                    </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547         Journal out = new Journal();                                                                     </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548         out.t = 0;                                                                                       </span>
<span class="-4698345167913557184" onmouseenter="enter('-4698345167913557184');" onmouseout="out('-4698345167913557184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549         out.key = mKeys.toArray(BackupProtos.Key.emptyArray());                                          </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550         writeJournal(newState, out);                                                                     </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551         Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                         </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552         mKeys.clear();                                                                                   </span>
<span class="-1379186895432660313" onmouseenter="enter('-1379186895432660313');" onmouseout="out('-1379186895432660313');" style=""> 553 &gt;&gt;&gt;&gt;&gt;&gt;&gt; THEIRS                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554     }                                                                                                    </span>
<span  style=""> 555                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 556     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 557      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 558      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 559      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 560      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 561      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 562     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 563         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 564         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 565         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 566         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 567                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 568         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 569             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 570             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 571                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 572                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 573                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 574                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 575                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 576                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 577                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 578                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 579                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 582         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 583             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585     }                                                                                                    </span>
<span  style=""> 586                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 587     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 588      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 589      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 590      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 591      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 592      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 593      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 594      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 595      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 596     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 597         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 598         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 599 =======                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 600     /**                                                                                                  </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style=""> 601      * @return the current device profile information.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 602      */                                                                                                  </span>
<span class="4124629983355258626" onmouseenter="enter('4124629983355258626');" onmouseout="out('4124629983355258626');" style=""> 603     private DeviceProfieData getDeviceProfieData() {                                                     </span>
<span class="-7376286606070162099" onmouseenter="enter('-7376286606070162099');" onmouseout="out('-7376286606070162099');" style=""> 604         if (mCurrentProfile != null) {                                                                   </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style=""> 605             return mCurrentProfile;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606         }                                                                                                </span>
<span class="-5497719505817004004" onmouseenter="enter('-5497719505817004004');" onmouseout="out('-5497719505817004004');" style=""> 607         final Context applicationContext = mContext.getApplicationContext();                             </span>
<span class="7980813194196555392" onmouseenter="enter('7980813194196555392');" onmouseout="out('7980813194196555392');" style=""> 608         DeviceProfile profile = LauncherAppState.createDynamicGrid(applicationContext, null)             </span>
<span class="-5938220650159761744" onmouseenter="enter('-5938220650159761744');" onmouseout="out('-5938220650159761744');" style=""> 609                 .getDeviceProfile();                                                                     </span>
<span  style=""> 610                                                                                                          </span>
<span class="-8088032308844031335" onmouseenter="enter('-8088032308844031335');" onmouseout="out('-8088032308844031335');" style=""> 611         mCurrentProfile = new DeviceProfieData();                                                        </span>
<span class="7442338639987606524" onmouseenter="enter('7442338639987606524');" onmouseout="out('7442338639987606524');" style=""> 612         mCurrentProfile.desktopRows = profile.numRows;                                                   </span>
<span class="-4500555851720273514" onmouseenter="enter('-4500555851720273514');" onmouseout="out('-4500555851720273514');" style=""> 613         mCurrentProfile.desktopCols = profile.numColumns;                                                </span>
<span class="-3431910476829522829" onmouseenter="enter('-3431910476829522829');" onmouseout="out('-3431910476829522829');" style=""> 614         mCurrentProfile.hotseatCount = profile.numHotseatIcons;                                          </span>
<span class="1465841957362210064" onmouseenter="enter('1465841957362210064');" onmouseout="out('1465841957362210064');" style=""> 615         mCurrentProfile.allappsRank = profile.hotseatAllAppsRank;                                        </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style=""> 616         return mCurrentProfile;                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 617 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618     }                                                                                                    </span>
<span  style=""> 619                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 620     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 621      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 622      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 623      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 624      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 625      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 626     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 627         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 628         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 629         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 630         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 631                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 632         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 633             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 634             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 635                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 636                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 637                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 638                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 639                 final String backupKey = keyToBackupKey(key);                                            </span>
<span  style=""> 640                                                                                                          </span>
<span class="4187503492614027377" onmouseenter="enter('4187503492614027377');" onmouseout="out('4187503492614027377');" style=""> 641                 // Favorite proto changed in v4. Backup again if the version is old.                     </span>
<span class="-1619074712666531849" onmouseenter="enter('-1619074712666531849');" onmouseout="out('-1619074712666531849');" style=""> 642                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime           </span>
<span class="4652601050666676553" onmouseenter="enter('4652601050666676553');" onmouseout="out('4652601050666676553');" style=""> 643                         || restoredBackupVersion &lt; 4) {                                                  </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 644                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 645                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 646                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 648             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 649         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 650             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652     }                                                                                                    </span>
<span  style=""> 653                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 654     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 655      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 656      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 657      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 658      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 659      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 660      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 661      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 662      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 663     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 664         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 665         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 666                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 667                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 668         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 669         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 670         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671     }                                                                                                    </span>
<span  style=""> 672                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 673     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 674      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 675      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 676      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 677      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 678      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 679     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 680         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 681         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 682         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 683                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 684         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 685             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 686             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 687             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 688                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 689                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 690                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 691                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 692                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 693                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 694                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 695                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 696                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 699         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 700             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702     }                                                                                                    </span>
<span  style=""> 703                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 704     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 705      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 706      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 707      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 708      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 709      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 710      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 711      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 712      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 713     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 714         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 715         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 716                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 717                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 718         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 719         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 720         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721     }                                                                                                    </span>
<span  style=""> 722                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 723     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 724      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 725      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 726      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 727      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 728      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 729     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 730         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 731         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 732         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 733         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 734         int backupUpIconCount = 0;                                                                       </span>
<span  style=""> 735                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 736         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 737         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 738                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 739                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 740         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 741                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 742         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 743             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 744             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 745                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 746                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 747                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 748                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 749                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 750                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 751                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 752                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 753                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 754                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 755                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 756                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 758                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 759                         if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                        </span>
<span  style=""> 760                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 761                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 762                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 763                     } else if (backupKey != null) {                                                      </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 764                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);            </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 765                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 766                             if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                           </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 767                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 768                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 769                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 770                                 mKeys.add(key);                                                          </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 771                                 backupUpIconCount ++;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 773                         } else {                                                                         </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 774                             if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 775                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 776                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 779                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 780                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 781                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 782                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783                 }                                                                                        </span>
<span  style=""> 784                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 786         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 787             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789     }                                                                                                    </span>
<span  style=""> 790                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 791     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 792      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 793      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 794      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 795      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 796      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 797      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 798      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 799      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 800     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 801         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 802         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 803                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 804                                                                                                          </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 805         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 806         if (DEBUG) {                                                                                     </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 807             Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 809         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 810         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 811             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 812         } else {                                                                                         </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 813             if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                             </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style=""> 814             mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,           </span>
<span class="5334405366542742044" onmouseenter="enter('5334405366542742044');" onmouseout="out('5334405366542742044');" style=""> 815                     &quot;&quot; /* label */, mUserSerial, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 816         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span  style=""> 818                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 819     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 820      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 821      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 822      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 823      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 824      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 825      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 826     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 827         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 828         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 829         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 830         int backupWidgetCount = 0;                                                                       </span>
<span  style=""> 831                                                                                                          </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 832         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 833                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 834         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 835                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 836         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 837             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 838             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 839                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 840                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 841                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 842                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 843                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 844                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 845                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 846                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 847                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 848                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849                 }                                                                                        </span>
<span  style=""> 850                                                                                                          </span>
<span class="-8332597063062869722" onmouseenter="enter('-8332597063062869722');" onmouseout="out('-8332597063062869722');" style=""> 851                 // Widget backup proto changed in v3. So add it again if the original backup is old.     </span>
<span class="3325885606329004984" onmouseenter="enter('3325885606329004984');" onmouseout="out('3325885606329004984');" style=""> 852                 if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= 3) {                   </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 853                     if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                          </span>
<span  style=""> 854                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 855                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 856                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 857                 } else if (backupKey != null) {                                                          </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 858                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 859                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 860                         if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                             </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 861                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 862                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 863                         mKeys.add(key);                                                                  </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 864                         backupWidgetCount ++;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 865                     } else {                                                                             </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 866                         if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 867                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 868                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 872         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 873             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 874         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875     }                                                                                                    </span>
<span  style=""> 876                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 877     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 878      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 879      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 880      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 881      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 882      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 883      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 884      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 885      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 886     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 887         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 888         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 889                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 890         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 891         if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                            </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 892         if (widget.icon.data != null)  {                                                                 </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 893             Bitmap icon = BitmapFactory                                                                  </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 894                     .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                      </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 895             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 896                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 897             } else {                                                                                     </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style=""> 898                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),               </span>
<span class="-5814139742387413473" onmouseenter="enter('-5814139742387413473');" onmouseout="out('-5814139742387413473');" style=""> 899                         icon, widget.icon.dpi, widget.label, mUserSerial, mIdp);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 901         }                                                                                                </span>
<span  style=""> 902                                                                                                          </span>
<span class="-2385058200628938943" onmouseenter="enter('-2385058200628938943');" onmouseout="out('-2385058200628938943');" style=""> 903         // Cache widget min sizes incase migration is required.                                          </span>
<span class="-5680508515789962848" onmouseenter="enter('-5680508515789962848');" onmouseout="out('-5680508515789962848');" style=""> 904         widgetSizes.add(widget.provider + &quot;#&quot; + widget.minSpanX + &quot;,&quot; + widget.minSpanY);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905     }                                                                                                    </span>
<span  style=""> 906                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 907     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 908      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 909      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 910      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 911      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 912     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 913         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 914         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 915         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 916         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 917         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918     }                                                                                                    </span>
<span  style=""> 919                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 920     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 921      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 922      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 923      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 924      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 925     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 926         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 927         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 928         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 929         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 930         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 933     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 934     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 935         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 936     }                                                                                                    </span>
<span  style=""> 937                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 938     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 939     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 940         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 941             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 942             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 943                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 944                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 945             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 946             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 947         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 948             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 949         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 950             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952     }                                                                                                    </span>
<span  style=""> 953                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 954     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 955     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 956         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 957         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 958         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 959         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 960         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 961             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 963         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964     }                                                                                                    </span>
<span  style=""> 965                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 966     /**                                                                                                  </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style=""> 967      * @return true if its an hotseat item, that can be replaced during restore.                         </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style=""> 968      * TODO: Extend check for folders in hotseat.                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 969      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 970     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style=""> 971         return favorite.container == Favorites.CONTAINER_HOTSEAT                                         </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style=""> 972                 &amp;&amp; favorite.intent != null                                                               </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style=""> 973                 &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                 </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style=""> 974                 || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975     }                                                                                                    </span>
<span  style=""> 976                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 977     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 978     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 979         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 980         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 981         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 982         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 983         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 984         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 985         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 986         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 987         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="-7969839402703871132" onmouseenter="enter('-7969839402703871132');" onmouseout="out('-7969839402703871132');" style=""> 988         favorite.rank = c.getInt(RANK_INDEX);                                                            </span>
<span  style=""> 989                                                                                                          </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 990         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 991         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 992             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 994         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 995         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 996         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 997             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 998                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 999                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style="">1000                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style="">1001             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style="">1002                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1003             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1004         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style="">1005         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style="">1006         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style="">1007             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style="">1008             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style="">1009             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style="">1010                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1011             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style="">1012         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="">1013             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style="">1014                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style="">1015                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style="">1016                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style="">1018                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style="">1019                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style="">1020                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1021                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1022             }                                                                                            </span>
<span  style="">1023                                                                                                          </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style="">1024             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style="">1025             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style="">1026                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1027             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1028         }                                                                                                </span>
<span  style="">1029                                                                                                          </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style="">1030         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style="">1031             if (intent != null &amp;&amp; intent.getComponent() != null) {                                       </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style="">1032                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style="">1033                 ActivityInfo activity = null;;                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1034                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style="">1035                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style="">1036                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style="">1037                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1038                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style="">1039                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style="">1040                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1041                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style="">1042                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style="">1043                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style="">1044                         mItemTypeMatchers[i] = new ItemTypeMatcher(                                      </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style="">1045                                 CommonAppTypeParser.getResourceForItemType(i));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1046                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style="">1047                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style="">1048                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">1049                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1050                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1051                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1052             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053         }                                                                                                </span>
<span  style="">1054                                                                                                          </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style="">1055         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1056     }                                                                                                    </span>
<span  style="">1057                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style="">1058     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style="">1059     private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                    </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1060             throws IOException {                                                                         </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style="">1061         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span  style="">1062                                                                                                          </span>
<span class="9046104249279415184" onmouseenter="enter('9046104249279415184');" onmouseout="out('9046104249279415184');" style="">1063         // If it is a hotseat item, move it accordingly.                                                 </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style="">1064         if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                         </span>
<span class="-6501405241219819611" onmouseenter="enter('-6501405241219819611');" onmouseout="out('-6501405241219819611');" style="">1065             favorite.screen += mHotseatShift;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1066         }                                                                                                </span>
<span  style="">1067                                                                                                          </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="">1068         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style="">1069         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style="">1070         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style="">1071         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style="">1072         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style="">1073         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style="">1074         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style="">1075         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="-3701788107564637331" onmouseenter="enter('-3701788107564637331');" onmouseout="out('-3701788107564637331');" style="">1076         values.put(Favorites.RANK, favorite.rank);                                                       </span>
<span  style="">1077                                                                                                          </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style="">1078         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="">1079             values.put(Favorites.ICON_TYPE, favorite.iconType);                                          </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="">1080             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="">1081                 values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="">1082                 values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083             }                                                                                            </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style="">1084             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1085         }                                                                                                </span>
<span  style="">1086                                                                                                          </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style="">1087         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style="">1088             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1089         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style="">1090             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1091         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style="">1092         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style="">1093             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style="">1095         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style="">1096                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style="">1097         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style="">1098         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style="">1099                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style="">1100         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style="">1101                                                                                                          </span>
<span class="7585439753959053806" onmouseenter="enter('7585439753959053806');" onmouseout="out('7585439753959053806');" style="">1102         // If we will attempt grid resize, use the original profile to validate grid size, as            </span>
<span class="7298199795309036018" onmouseenter="enter('7298199795309036018');" onmouseout="out('7298199795309036018');" style="">1103         // anything which fits in the original grid should fit in the current grid after                 </span>
<span class="-386818733866572403" onmouseenter="enter('-386818733866572403');" onmouseout="out('-386818733866572403');" style="">1104         // grid migration.                                                                               </span>
<span class="978452708592763195" onmouseenter="enter('978452708592763195');" onmouseout="out('978452708592763195');" style="">1105         DeviceProfieData currentProfile = migrationCompatibleProfileData == null                         </span>
<span class="-7548774861757189682" onmouseenter="enter('-7548774861757189682');" onmouseout="out('-7548774861757189682');" style="">1106                 ? mDeviceProfileData : migrationCompatibleProfileData;                                   </span>
<span  style="">1107                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style="">1108         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style="">1109             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style="">1110                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style="">1112             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="">1113             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style="">1114                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style="">1115                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style="">1116                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span  style="">1117                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style="">1118             // Verify placement                                                                          </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style="">1119             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                         </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style="">1120                     || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {               </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1121                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style="">1122                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1123             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1124         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style="">1125             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style="">1126             if (isReplaceableHotseatItem(favorite)                                                       </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style="">1127                     &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                       </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style="">1128                     &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                 </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style="">1129                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="">1130                 values.put(LauncherSettings.Favorites.RESTORED,                                          </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style="">1131                         1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1132             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="">1133                 // Let LauncherModel know we&#x27;ve been here.                                               </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="">1134                 values.put(LauncherSettings.Favorites.RESTORED, 1);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1135             }                                                                                            </span>
<span  style="">1136                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style="">1137             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style="">1138             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style="">1139                 if ((favorite.screen &gt;= currentProfile.hotseatCount)                                     </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style="">1140                         || (favorite.screen == currentProfile.allappsRank)) {                            </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1141                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style="">1142                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1143                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1144             } else {                                                                                     </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style="">1145                 if ((favorite.cellX &gt;= currentProfile.desktopCols)                                       </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style="">1146                         || (favorite.cellY &gt;= currentProfile.desktopRows)) {                             </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1147                     restoreSuccessful = false;                                                           </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style="">1148                     throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1151         }                                                                                                </span>
<span  style="">1152                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1153         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1154     }                                                                                                    </span>
<span  style="">1155                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style="">1156     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style="">1157     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style="">1158         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style="">1159         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style="">1160         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style="">1161         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1162     }                                                                                                    </span>
<span  style="">1163                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style="">1164     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style="">1165     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1166             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style="">1167         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="">1168         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style="">1169         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style="">1170         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1171         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172     }                                                                                                    </span>
<span  style="">1173                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style="">1174     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style="">1175     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style="">1176         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style="">1177         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style="">1178         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style="">1179         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1180     }                                                                                                    </span>
<span  style="">1181                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style="">1182     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style="">1183     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="">1184         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="">1185                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1186         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="">1187         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1188         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1189         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1190         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1191             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style="">1192             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1193             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style="">1194             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="">1195             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1196         }                                                                                                </span>
<span  style="">1197                                                                                                          </span>
<span class="1043295540346253364" onmouseenter="enter('1043295540346253364');" onmouseout="out('1043295540346253364');" style="">1198         Point spans = info.getMinSpans(mIdp, mContext);                                                  </span>
<span class="-1248183371241258015" onmouseenter="enter('-1248183371241258015');" onmouseout="out('-1248183371241258015');" style="">1199         widget.minSpanX = spans.x;                                                                       </span>
<span class="1290669233310739887" onmouseenter="enter('1290669233310739887');" onmouseout="out('1290669233310739887');" style="">1200         widget.minSpanY = spans.y;                                                                       </span>
<span  style="">1201                                                                                                          </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1202         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1203     }                                                                                                    </span>
<span  style="">1204                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1205     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1206      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1207      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1208     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1209             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1210         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1211         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1212         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213     }                                                                                                    </span>
<span  style="">1214                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1215     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1216      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1217      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1218      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1219      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1220      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1221      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1222      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1223      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1224     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1225         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1226         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1227             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1228         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1229         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1230         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1231             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1232             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1233             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1234                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1235                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1236                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1237                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1238                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1239                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1240                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1241                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1242                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1243                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1244                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1245                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1246                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1247                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1248                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1249                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1250                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1251                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1252                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1253                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1254                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1255                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1256                     }                                                                                    </span>
<span  style="">1257                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1258                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1259                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1260                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1261                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1262                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1263                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1264                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1265                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1266                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1267                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1268                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1269                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1270                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1271                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1272                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1273                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1274                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1275             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1276         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1277             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1278         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1279             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1280                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1281             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1282                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1283             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1284         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1285         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1286     }                                                                                                    </span>
<span  style="">1287                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1288     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1289             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1290         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1291     }                                                                                                    </span>
<span  style="">1292                                                                                                          </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1293     private void writeRowToBackup(String backupKey, MessageNano proto,                                   </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1294             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1295         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1296         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1297         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1298         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1299         if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1300     }                                                                                                    </span>
<span  style="">1301                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1302     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1303      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1304      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1305      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1306      * in that case, do a full backup.                                                                   </span>
<span  style="">1307                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1308      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1309      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1310      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1311     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1312         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1313         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1314             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1315             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1316             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1317             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1318             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1319         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1320             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1321         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1322     }                                                                                                    </span>
<span  style="">1323                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1324     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1325     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1326         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1327         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1328         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1329         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1330         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1331         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1332     }                                                                                                    </span>
<span  style="">1333                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1334     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1335     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1336             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1337         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1338         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1339         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1340         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1341         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1342             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1343         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1344         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1345     }                                                                                                    </span>
<span  style="">1346                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1347     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1348      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1349      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1350     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1351         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1352         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1353         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1354             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1355             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1356         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1357         cursor.close();                                                                                  </span>
<span  style="">1358                                                                                                          </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1359         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1360             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1361             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1362         }                                                                                                </span>
<span  style="">1363                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1364         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1365     }                                                                                                    </span>
<span  style="">1366                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1367     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1368         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1369                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1370     }                                                                                                    </span>
<span  style="">1371                                                                                                          </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="">1372     @Thunk class InvalidBackupException extends IOException {                                            </span>
<span  style="">1373                                                                                                          </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1374         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1375                                                                                                          </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="">1376         @Thunk InvalidBackupException(Throwable cause) {                                                 </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1377             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1378         }                                                                                                </span>
<span  style="">1379                                                                                                          </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="">1380         @Thunk InvalidBackupException(String reason) {                                                   </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1381             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1382         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1383     }                                                                                                    </span>
<span  style="">1384                                                                                                          </span>
<span class="-806551235718833382" onmouseenter="enter('-806551235718833382');" onmouseout="out('-806551235718833382');" style="">1385     public boolean shouldAttemptWorkspaceMigration() {                                                   </span>
<span class="-2817654345638424296" onmouseenter="enter('-2817654345638424296');" onmouseout="out('-2817654345638424296');" style="">1386         return migrationCompatibleProfileData != null;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1387     }                                                                                                    </span>
<span  style="">1388                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1389     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1390      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1391      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1392      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1393     private class ItemTypeMatcher {                                                                      </span>
<span  style="">1394                                                                                                          </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1395         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1396                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1397         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="">1398             mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1399         }                                                                                                </span>
<span  style="">1400                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1401         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1402             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1403             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1404             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1405                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1406                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1407                 int type;                                                                                </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="">1408                 while (((type = parser.next()) != XmlPullParser.END_TAG ||                               </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="">1409                         parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {              </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1410                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1411                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1412                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="">1413                         final String uri = DefaultLayoutParser.getAttributeValue(                        </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="">1414                                 parser, DefaultLayoutParser.ATTR_URI);                                   </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1415                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1416                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1417                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1418             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1419                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1420             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1421                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1422             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1423             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1424         }                                                                                                </span>
<span  style="">1425                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1426         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1427             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1428                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1429                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="">1430                 if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                        </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="">1431                         || info.activityInfo.name.equals(activity.targetActivity))) {                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1432                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1433                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1434             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1435             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1436         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1437     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1438 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  28 import android.content.pm.PackageManager;                                                                </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  29 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-3433483468941074901" onmouseenter="enter('-3433483468941074901');" onmouseout="out('-3433483468941074901');" style="">  35 import android.graphics.Point;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  36 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  37 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  38 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  39 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  40 import android.util.Log;                                                                                 </span>
<span  style="">  41                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  42 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  43 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  44 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  45 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  46 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  47 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  48 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  49 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  50 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  51 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  52 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  53 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  54 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-797779758351574749" onmouseenter="enter('-797779758351574749');" onmouseout="out('-797779758351574749');" style="">  55 import com.android.launcher3.model.MigrateFromRestoreTask;                                               </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  56 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  57 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  58 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  59                                                                                                          </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  60 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  61 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  62                                                                                                          </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  63 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  64 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  65 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  66 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  69 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  70 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  71                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  72 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  73  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  74  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  75 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  76     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  77     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  78     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  79                                                                                                          </span>
<span class="826917367119663975" onmouseenter="enter('826917367119663975');" onmouseout="out('826917367119663975');" style="">  80     private static final int BACKUP_VERSION = 4;                                                         </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  81     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  82                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  83     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  84     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  85     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  86                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  87     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  88     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  90     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  91     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  92                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  93     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  94         Favorites._ID,                     // 0                                                          </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  95         Favorites.MODIFIED,                // 1                                                          </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  96         Favorites.INTENT,                  // 2                                                          </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  97         Favorites.APPWIDGET_PROVIDER,      // 3                                                          </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  98         Favorites.APPWIDGET_ID,            // 4                                                          </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  99         Favorites.CELLX,                   // 5                                                          </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 100         Favorites.CELLY,                   // 6                                                          </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 101         Favorites.CONTAINER,               // 7                                                          </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 102         Favorites.ICON,                    // 8                                                          </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 103         Favorites.ICON_PACKAGE,            // 9                                                          </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 104         Favorites.ICON_RESOURCE,           // 10                                                         </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 105         Favorites.ICON_TYPE,               // 11                                                         </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 106         Favorites.ITEM_TYPE,               // 12                                                         </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 107         Favorites.SCREEN,                  // 13                                                         </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 108         Favorites.SPANX,                   // 14                                                         </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 109         Favorites.SPANY,                   // 15                                                         </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 110         Favorites.TITLE,                   // 16                                                         </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 111         Favorites.PROFILE_ID,              // 17                                                         </span>
<span class="8195666479774249088" onmouseenter="enter('8195666479774249088');" onmouseout="out('8195666479774249088');" style=""> 112         Favorites.RANK,                    // 18                                                         </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 113     };                                                                                                   </span>
<span  style=""> 114                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 115     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 116     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 117     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 118     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 119     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 120     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 121     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 122     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 123     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 124     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 125     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 126     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 127     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 128     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 129     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 130     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 131     private static final int TITLE_INDEX = 16;                                                           </span>
<span class="-9020064880382451057" onmouseenter="enter('-9020064880382451057');" onmouseout="out('-9020064880382451057');" style=""> 132     private static final int RANK_INDEX = 18;                                                            </span>
<span  style=""> 133                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 134     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 135         WorkspaceScreens._ID,              // 0                                                          </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 136         WorkspaceScreens.MODIFIED,         // 1                                                          </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 137         WorkspaceScreens.SCREEN_RANK       // 2                                                          </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 138     };                                                                                                   </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 140     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 141                                                                                                          </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style=""> 142     @Thunk final Context mContext;                                                                       </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 143     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 144     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 145     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 146     private final long mUserSerial;                                                                      </span>
<span  style=""> 147                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 148     private BackupManager mBackupManager;                                                                </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 149     private byte[] mBuffer = new byte[512];                                                              </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 150     private long mLastBackupRestoreTime;                                                                 </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 151     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 152                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 153     private IconCache mIconCache;                                                                        </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 154     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 155     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 156                                                                                                          </span>
<span class="8277982309001466181" onmouseenter="enter('8277982309001466181');" onmouseout="out('8277982309001466181');" style=""> 157     DeviceProfieData migrationCompatibleProfileData;                                                     </span>
<span class="324588424384202565" onmouseenter="enter('324588424384202565');" onmouseout="out('324588424384202565');" style=""> 158     HashSet&lt;String&gt; widgetSizes = new HashSet&lt;&gt;();                                                       </span>
<span  style=""> 159                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 160     boolean restoreSuccessful;                                                                           </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 161     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 162                                                                                                          </span>
<span class="4744147174059046892" onmouseenter="enter('4744147174059046892');" onmouseout="out('4744147174059046892');" style=""> 163     // When migrating from a device which different hotseat configuration, the icons are shifted         </span>
<span class="-3936955316846306336" onmouseenter="enter('-3936955316846306336');" onmouseout="out('-3936955316846306336');" style=""> 164     // to center along the new all-apps icon.                                                            </span>
<span class="309766951368773182" onmouseenter="enter('309766951368773182');" onmouseout="out('309766951368773182');" style=""> 165     private int mHotseatShift = 0;                                                                       </span>
<span  style=""> 166                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 167     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 168         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 169         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 170         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 171         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 172         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span  style=""> 173                                                                                                          </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 174         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 175         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 178     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 179         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 180             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 182         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 185     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 186         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 187         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 188         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 189             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 190                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 193         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 196     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 197      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 198      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 199      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 200      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 201      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 202      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 203      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 204      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 205      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 206      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 207     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 208     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 209             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 210         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 211                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 212         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 213         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 214             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 215             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 216             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 217             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 220         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 221             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 222             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 223             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 224             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span  style=""> 226                                                                                                          </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 227         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 228         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 229         applyJournal(in);                                                                                </span>
<span  style=""> 230                                                                                                          </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 231         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 232         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 233         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 234         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 235         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 236             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 237             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 238             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 239             backupWidgets(data);                                                                         </span>
<span  style=""> 240                                                                                                          </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 241             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 242             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 243             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 244                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 246             mExistingKeys.removeAll(validKeys);                                                          </span>
<span  style=""> 247                                                                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 248             // Delete anything left in the existing keys.                                                </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 249             for (String deleted: mExistingKeys) {                                                        </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 250                 if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                             </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 251                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 252                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253             }                                                                                            </span>
<span  style=""> 254                                                                                                          </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 255             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 256             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 257                 // Check if any metadata has changed                                                     </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style=""> 258                 mBackupDataWasUpdated = (in.profile == null)                                             </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style=""> 259                         || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                      </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style=""> 260                             DeviceProfieData.toByteArray(mDeviceProfileData))                            </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style=""> 261                         || (in.backupVersion != BACKUP_VERSION)                                          </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style=""> 262                         || (in.appVersion != getAppVersion());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span  style=""> 264                                                                                                          </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 265             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 266                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span  style=""> 267                                                                                                          </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 268                 // We store the journal at two places.                                                   </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style=""> 269                 //   1) Storing it in newState allows us to do partial backups by comparing old state    </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style=""> 270                 //   2) Storing it in backup data allows us to validate keys during restore              </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 271                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 272                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 273             } else {                                                                                     </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style=""> 274                 if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 276         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 277             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278         }                                                                                                </span>
<span  style=""> 279                                                                                                          </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 280         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 283     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 284      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 285      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 287     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 288         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 289         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span  style=""> 290                                                                                                          </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 291         if (oldProfile == null || oldProfile.desktopCols == 0) {                                         </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 292             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 293             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="458635177486396964" onmouseenter="enter('458635177486396964');" onmouseout="out('458635177486396964');" style=""> 296         boolean isHotseatCompatible = false;                                                             </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 297         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style=""> 298             isHotseatCompatible = true;                                                                  </span>
<span class="6856306724544172936" onmouseenter="enter('6856306724544172936');" onmouseout="out('6856306724544172936');" style=""> 299             mHotseatShift = 0;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="2142366465478542154" onmouseenter="enter('2142366465478542154');" onmouseout="out('2142366465478542154');" style=""> 302         if ((currentProfile.allappsRank &gt;= oldProfile.allappsRank)                                       </span>
<span class="-6632599495891550017" onmouseenter="enter('-6632599495891550017');" onmouseout="out('-6632599495891550017');" style=""> 303                 &amp;&amp; ((currentProfile.hotseatCount - currentProfile.allappsRank) &gt;=                        </span>
<span class="8568226590607864890" onmouseenter="enter('8568226590607864890');" onmouseout="out('8568226590607864890');" style=""> 304                         (oldProfile.hotseatCount - oldProfile.allappsRank))) {                           </span>
<span class="2270742623811584810" onmouseenter="enter('2270742623811584810');" onmouseout="out('2270742623811584810');" style=""> 305             // There is enough space on both sides of the hotseat.                                       </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style=""> 306             isHotseatCompatible = true;                                                                  </span>
<span class="5163576225814391245" onmouseenter="enter('5163576225814391245');" onmouseout="out('5163576225814391245');" style=""> 307             mHotseatShift = currentProfile.allappsRank - oldProfile.allappsRank;                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308         }                                                                                                </span>
<span  style=""> 309                                                                                                          </span>
<span class="-1017020977077293413" onmouseenter="enter('-1017020977077293413');" onmouseout="out('-1017020977077293413');" style=""> 310         if (!isHotseatCompatible) {                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 311             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312         }                                                                                                </span>
<span class="-8412024600313814265" onmouseenter="enter('-8412024600313814265');" onmouseout="out('-8412024600313814265');" style=""> 313         if ((currentProfile.desktopCols &gt;= oldProfile.desktopCols)                                       </span>
<span class="5768651476481696104" onmouseenter="enter('5768651476481696104');" onmouseout="out('5768651476481696104');" style=""> 314                 &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows)) {                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 315             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316         }                                                                                                </span>
<span  style=""> 317                                                                                                          </span>
<span class="4881414489005539302" onmouseenter="enter('4881414489005539302');" onmouseout="out('4881414489005539302');" style=""> 318         if (MigrateFromRestoreTask.ENABLED &amp;&amp;                                                            </span>
<span class="990686264093981039" onmouseenter="enter('990686264093981039');" onmouseout="out('990686264093981039');" style=""> 319                 (oldProfile.desktopCols - currentProfile.desktopCols &lt;= 1) &amp;&amp;                            </span>
<span class="-4956046918292613771" onmouseenter="enter('-4956046918292613771');" onmouseout="out('-4956046918292613771');" style=""> 320                 (oldProfile.desktopRows - currentProfile.desktopRows &lt;= 1)) {                            </span>
<span class="-7375128792855769034" onmouseenter="enter('-7375128792855769034');" onmouseout="out('-7375128792855769034');" style=""> 321             // Allow desktop migration when row and/or column count contracts by 1.                      </span>
<span  style=""> 322                                                                                                          </span>
<span class="-3339830446988550734" onmouseenter="enter('-3339830446988550734');" onmouseout="out('-3339830446988550734');" style=""> 323             migrationCompatibleProfileData = initDeviceProfileData(mIdp);                                </span>
<span class="1832232547208942697" onmouseenter="enter('1832232547208942697');" onmouseout="out('1832232547208942697');" style=""> 324             migrationCompatibleProfileData.desktopCols = oldProfile.desktopCols;                         </span>
<span class="539436906242464602" onmouseenter="enter('539436906242464602');" onmouseout="out('539436906242464602');" style=""> 325             migrationCompatibleProfileData.desktopRows = oldProfile.desktopRows;                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 326             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 328         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329     }                                                                                                    </span>
<span  style=""> 330                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 331     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 332      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 333      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 334      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 335      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 336      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 337      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 338     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 339     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 340         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 341             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342         }                                                                                                </span>
<span  style=""> 343                                                                                                          </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 344         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 345             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 346             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 347             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 348             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 349             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350         }                                                                                                </span>
<span  style=""> 351                                                                                                          </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 352         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 353         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 354             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 356         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 357             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 358             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 359             String backupKey = data.getKey();                                                            </span>
<span  style=""> 360                                                                                                          </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 361             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 362                 if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                       </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 363                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 364                     // We received the journal key after a restore key.                                  </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 365                     Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);       </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 366                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 367                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368                 }                                                                                        </span>
<span  style=""> 369                                                                                                          </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 370                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 371                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 372                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 373                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 374                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375             }                                                                                            </span>
<span  style=""> 376                                                                                                          </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 377             if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                        </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 378                 if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 379                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 381             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 382             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 383             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 384                 case Key.FAVORITE:                                                                       </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 385                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 386                     break;                                                                               </span>
<span  style=""> 387                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 388                 case Key.SCREEN:                                                                         </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 389                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 390                     break;                                                                               </span>
<span  style=""> 391                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 392                 case Key.ICON:                                                                           </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 393                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 394                     break;                                                                               </span>
<span  style=""> 395                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 396                 case Key.WIDGET:                                                                         </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 397                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 398                     break;                                                                               </span>
<span  style=""> 399                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 400                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 401                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 402                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 403                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 405         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 406             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408     }                                                                                                    </span>
<span  style=""> 409                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 410     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 411      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 412      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 413      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 414      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 415     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 416     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 417         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418     }                                                                                                    </span>
<span  style=""> 419                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 420     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 421         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 422         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 423         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 424         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 425         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 426         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 427         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428     }                                                                                                    </span>
<span  style=""> 429                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 430     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 431         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 432             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 433                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 434         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 435             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437     }                                                                                                    </span>
<span  style=""> 438                                                                                                          </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style=""> 439     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style=""> 440         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style=""> 441         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style=""> 442         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style=""> 443         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style=""> 444         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style=""> 445         return data;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446     }                                                                                                    </span>
<span  style=""> 447                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 448     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 449      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 450      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 451      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 452      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 453      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 454     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 455         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 456         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 457         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 458         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 459                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 460         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 461             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 462             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 463                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 464                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 465                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 466                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 467                 final String backupKey = keyToBackupKey(key);                                            </span>
<span  style=""> 468                                                                                                          </span>
<span class="4187503492614027377" onmouseenter="enter('4187503492614027377');" onmouseout="out('4187503492614027377');" style=""> 469                 // Favorite proto changed in v4. Backup again if the version is old.                     </span>
<span class="-1619074712666531849" onmouseenter="enter('-1619074712666531849');" onmouseout="out('-1619074712666531849');" style=""> 470                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime           </span>
<span class="4652601050666676553" onmouseenter="enter('4652601050666676553');" onmouseout="out('4652601050666676553');" style=""> 471                         || restoredBackupVersion &lt; 4) {                                                  </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 472                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 473                 } else {                                                                                 </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 474                     if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 477         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 478             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 482     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 483      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 484      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 485      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 486      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 487      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 488      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 489      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 490      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 491     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 492         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 493         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 494                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 495                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 496         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 497         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 498         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499     }                                                                                                    </span>
<span  style=""> 500                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 501     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 502      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 503      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 504      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 505      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 506      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 507     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 508         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 509         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 510         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 511                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 512         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 513             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 514             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 515             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 516                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 517                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 518                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 519                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 520                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 521                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 522                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 523                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 524                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 527         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 528             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530     }                                                                                                    </span>
<span  style=""> 531                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 532     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 533      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 534      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 535      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 536      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 537      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 538      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 539      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 540      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 541     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 542         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 543         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 544                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 545                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 546         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 547         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 548         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549     }                                                                                                    </span>
<span  style=""> 550                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 551     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 552      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 553      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 554      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 555      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 556      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 557     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 558         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 559         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 560         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 561         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 562         int backupUpIconCount = 0;                                                                       </span>
<span  style=""> 563                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 564         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 565         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 566                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 567                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 568         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 569                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 570         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 571             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 572             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 573                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 574                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 575                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 576                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 577                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 578                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 579                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 580                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 581                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 582                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 583                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 584                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 586                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 587                         if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                        </span>
<span  style=""> 588                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 589                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 590                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 591                     } else if (backupKey != null) {                                                      </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 592                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);            </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 593                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 594                             if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                           </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 595                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 596                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 597                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 598                                 mKeys.add(key);                                                          </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 599                                 backupUpIconCount ++;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 601                         } else {                                                                         </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 602                             if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 603                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 604                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 607                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 608                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 609                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 610                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611                 }                                                                                        </span>
<span  style=""> 612                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 614         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 615             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617     }                                                                                                    </span>
<span  style=""> 618                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 619     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 620      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 621      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 622      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 623      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 624      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 625      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 626      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 627      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 628     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 629         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 630         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 631                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 632                                                                                                          </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 633         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 634         if (DEBUG) {                                                                                     </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 635             Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 637         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 638         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 639             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 640         } else {                                                                                         </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 641             if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                             </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style=""> 642             mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,           </span>
<span class="5334405366542742044" onmouseenter="enter('5334405366542742044');" onmouseout="out('5334405366542742044');" style=""> 643                     &quot;&quot; /* label */, mUserSerial, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645     }                                                                                                    </span>
<span  style=""> 646                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 647     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 648      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 649      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 650      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 651      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 652      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 653      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 654     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 655         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 656         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 657         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 658         int backupWidgetCount = 0;                                                                       </span>
<span  style=""> 659                                                                                                          </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 660         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 661                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 662         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 663                 where, null, null);                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 664         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 665             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 666             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 667                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 668                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 669                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 670                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 671                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 672                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 673                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 674                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 675                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 676                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677                 }                                                                                        </span>
<span  style=""> 678                                                                                                          </span>
<span class="-8332597063062869722" onmouseenter="enter('-8332597063062869722');" onmouseout="out('-8332597063062869722');" style=""> 679                 // Widget backup proto changed in v3. So add it again if the original backup is old.     </span>
<span class="3325885606329004984" onmouseenter="enter('3325885606329004984');" onmouseout="out('3325885606329004984');" style=""> 680                 if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= 3) {                   </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 681                     if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                          </span>
<span  style=""> 682                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 683                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 684                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 685                 } else if (backupKey != null) {                                                          </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 686                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 687                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 688                         if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                             </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 689                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 690                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 691                         mKeys.add(key);                                                                  </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 692                         backupWidgetCount ++;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 693                     } else {                                                                             </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 694                         if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 695                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 696                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 700         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 701             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703     }                                                                                                    </span>
<span  style=""> 704                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 705     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 706      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 707      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 708      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 709      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 710      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 711      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 712      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 713      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 714     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 715         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 716         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 717                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 718         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 719         if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                            </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 720         if (widget.icon.data != null)  {                                                                 </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 721             Bitmap icon = BitmapFactory                                                                  </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 722                     .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                      </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 723             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 724                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 725             } else {                                                                                     </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style=""> 726                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),               </span>
<span class="-5814139742387413473" onmouseenter="enter('-5814139742387413473');" onmouseout="out('-5814139742387413473');" style=""> 727                         icon, widget.icon.dpi, widget.label, mUserSerial, mIdp);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729         }                                                                                                </span>
<span  style=""> 730                                                                                                          </span>
<span class="-2385058200628938943" onmouseenter="enter('-2385058200628938943');" onmouseout="out('-2385058200628938943');" style=""> 731         // Cache widget min sizes incase migration is required.                                          </span>
<span class="-5680508515789962848" onmouseenter="enter('-5680508515789962848');" onmouseout="out('-5680508515789962848');" style=""> 732         widgetSizes.add(widget.provider + &quot;#&quot; + widget.minSpanX + &quot;,&quot; + widget.minSpanY);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733     }                                                                                                    </span>
<span  style=""> 734                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 735     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 736      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 737      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 738      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 739      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 740     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 741         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 742         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 743         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 744         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 745         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746     }                                                                                                    </span>
<span  style=""> 747                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 748     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 749      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 750      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 751      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 752      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 753     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 754         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 755         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 756         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 757         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 758         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 759     }                                                                                                    </span>
<span  style=""> 760                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 761     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 762     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 763         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764     }                                                                                                    </span>
<span  style=""> 765                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 766     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 767     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 768         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 769             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 770             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 771                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 772                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 774             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 775         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 776             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 777         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 778             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780     }                                                                                                    </span>
<span  style=""> 781                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 782     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 783     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 784         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 785         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 786         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 787         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 788         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 789             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 791         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792     }                                                                                                    </span>
<span  style=""> 793                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 794     /**                                                                                                  </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style=""> 795      * @return true if its an hotseat item, that can be replaced during restore.                         </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style=""> 796      * TODO: Extend check for folders in hotseat.                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 797      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 798     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style=""> 799         return favorite.container == Favorites.CONTAINER_HOTSEAT                                         </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style=""> 800                 &amp;&amp; favorite.intent != null                                                               </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style=""> 801                 &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                 </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style=""> 802                 || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 803     }                                                                                                    </span>
<span  style=""> 804                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 805     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 806     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 807         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 808         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 809         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 810         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 811         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 812         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 813         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 814         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 815         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="-7969839402703871132" onmouseenter="enter('-7969839402703871132');" onmouseout="out('-7969839402703871132');" style=""> 816         favorite.rank = c.getInt(RANK_INDEX);                                                            </span>
<span  style=""> 817                                                                                                          </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 818         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 819         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 820             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 822         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 823         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 824         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 825             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 826                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 827                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 828                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 829             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 830                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 831             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 833         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 834         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 835             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 836             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 837             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 838                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style=""> 840         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 841             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 842                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 843                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 844                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 846                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 847                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 848                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850             }                                                                                            </span>
<span  style=""> 851                                                                                                          </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 852             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 853             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 854                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856         }                                                                                                </span>
<span  style=""> 857                                                                                                          </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style=""> 858         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style=""> 859             if (intent != null &amp;&amp; intent.getComponent() != null) {                                       </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style=""> 860                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style=""> 861                 ActivityInfo activity = null;;                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 862                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style=""> 863                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 864                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style=""> 865                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style=""> 867                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 868                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style=""> 870                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style=""> 871                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style=""> 872                         mItemTypeMatchers[i] = new ItemTypeMatcher(                                      </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style=""> 873                                 CommonAppTypeParser.getResourceForItemType(i));                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 874                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style=""> 875                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style=""> 876                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 877                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 880             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881         }                                                                                                </span>
<span  style=""> 882                                                                                                          </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 883         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884     }                                                                                                    </span>
<span  style=""> 885                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 886     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 887     private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                    </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 888             throws IOException {                                                                         </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 889         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span  style=""> 890                                                                                                          </span>
<span class="9046104249279415184" onmouseenter="enter('9046104249279415184');" onmouseout="out('9046104249279415184');" style=""> 891         // If it is a hotseat item, move it accordingly.                                                 </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 892         if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                         </span>
<span class="-6501405241219819611" onmouseenter="enter('-6501405241219819611');" onmouseout="out('-6501405241219819611');" style=""> 893             favorite.screen += mHotseatShift;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 894         }                                                                                                </span>
<span  style=""> 895                                                                                                          </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 896         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 897         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 898         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 899         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 900         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 901         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 902         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 903         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="-3701788107564637331" onmouseenter="enter('-3701788107564637331');" onmouseout="out('-3701788107564637331');" style=""> 904         values.put(Favorites.RANK, favorite.rank);                                                       </span>
<span  style=""> 905                                                                                                          </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style=""> 906         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 907             values.put(Favorites.ICON_TYPE, favorite.iconType);                                          </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 908             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 909                 values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 910                 values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911             }                                                                                            </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 912             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 913         }                                                                                                </span>
<span  style=""> 914                                                                                                          </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 915         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 916             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 917         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 918             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 919         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 920         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 921             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 922         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 923         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style=""> 924                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 925         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 926         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 927                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 928         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style=""> 929                                                                                                          </span>
<span class="7585439753959053806" onmouseenter="enter('7585439753959053806');" onmouseout="out('7585439753959053806');" style=""> 930         // If we will attempt grid resize, use the original profile to validate grid size, as            </span>
<span class="7298199795309036018" onmouseenter="enter('7298199795309036018');" onmouseout="out('7298199795309036018');" style=""> 931         // anything which fits in the original grid should fit in the current grid after                 </span>
<span class="-386818733866572403" onmouseenter="enter('-386818733866572403');" onmouseout="out('-386818733866572403');" style=""> 932         // grid migration.                                                                               </span>
<span class="978452708592763195" onmouseenter="enter('978452708592763195');" onmouseout="out('978452708592763195');" style=""> 933         DeviceProfieData currentProfile = migrationCompatibleProfileData == null                         </span>
<span class="-7548774861757189682" onmouseenter="enter('-7548774861757189682');" onmouseout="out('-7548774861757189682');" style=""> 934                 ? mDeviceProfileData : migrationCompatibleProfileData;                                   </span>
<span  style=""> 935                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 936         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 937             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 938                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 940             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 941             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 942                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 943                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 944                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span  style=""> 945                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 946             // Verify placement                                                                          </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style=""> 947             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                         </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style=""> 948                     || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {               </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 949                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 950                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 952         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style=""> 953             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style=""> 954             if (isReplaceableHotseatItem(favorite)                                                       </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style=""> 955                     &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                       </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style=""> 956                     &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                 </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style=""> 957                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 958                 values.put(LauncherSettings.Favorites.RESTORED,                                          </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style=""> 959                         1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 960             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 961                 // Let LauncherModel know we&#x27;ve been here.                                               </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 962                 values.put(LauncherSettings.Favorites.RESTORED, 1);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963             }                                                                                            </span>
<span  style=""> 964                                                                                                          </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 965             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 966             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style=""> 967                 if ((favorite.screen &gt;= currentProfile.hotseatCount)                                     </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style=""> 968                         || (favorite.screen == currentProfile.allappsRank)) {                            </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 969                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 970                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 971                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 972             } else {                                                                                     </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style=""> 973                 if ((favorite.cellX &gt;= currentProfile.desktopCols)                                       </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style=""> 974                         || (favorite.cellY &gt;= currentProfile.desktopRows)) {                             </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 975                     restoreSuccessful = false;                                                           </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 976                     throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 978             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979         }                                                                                                </span>
<span  style=""> 980                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 981         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982     }                                                                                                    </span>
<span  style=""> 983                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 984     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 985     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 986         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 987         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 988         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 989         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 990     }                                                                                                    </span>
<span  style=""> 991                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 992     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 993     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 994             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 995         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 996         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 997         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 998         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 999         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1000     }                                                                                                    </span>
<span  style="">1001                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style="">1002     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style="">1003     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style="">1004         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style="">1005         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style="">1006         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style="">1007         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1008     }                                                                                                    </span>
<span  style="">1009                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style="">1010     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style="">1011     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="">1012         final LauncherAppWidgetProviderInfo info =                                                       </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="">1013                 LauncherModel.getProviderInfo(mContext, provider, user);                                 </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1014         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="">1015         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1016         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1017         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1018         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1019             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style="">1020             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1021             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style="">1022             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="">1023             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1024         }                                                                                                </span>
<span  style="">1025                                                                                                          </span>
<span class="1043295540346253364" onmouseenter="enter('1043295540346253364');" onmouseout="out('1043295540346253364');" style="">1026         Point spans = info.getMinSpans(mIdp, mContext);                                                  </span>
<span class="-1248183371241258015" onmouseenter="enter('-1248183371241258015');" onmouseout="out('-1248183371241258015');" style="">1027         widget.minSpanX = spans.x;                                                                       </span>
<span class="1290669233310739887" onmouseenter="enter('1290669233310739887');" onmouseout="out('1290669233310739887');" style="">1028         widget.minSpanY = spans.y;                                                                       </span>
<span  style="">1029                                                                                                          </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1030         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031     }                                                                                                    </span>
<span  style="">1032                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1033     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1034      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1035      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1036     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1037             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1038         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1039         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1040         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1041     }                                                                                                    </span>
<span  style="">1042                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1043     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1044      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1045      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1046      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1047      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1048      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1049      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1050      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1051      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1052     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1053         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1054         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1055             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1056         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1057         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1058         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1059             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1060             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1061             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1062                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1063                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1064                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1065                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1066                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1067                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1068                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1069                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1070                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1071                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1072                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1073                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1074                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1075                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1076                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1077                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1078                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1079                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1081                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1082                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1083                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1084                     }                                                                                    </span>
<span  style="">1085                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1086                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1087                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1088                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1089                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1090                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1091                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1092                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1093                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1094                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1095                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1096                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1097                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1098                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1099                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1100                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1101                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1103             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1104         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1105             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1106         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1107             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1108                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1109             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1110                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1112         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1113         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1114     }                                                                                                    </span>
<span  style="">1115                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1116     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1117             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1118         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119     }                                                                                                    </span>
<span  style="">1120                                                                                                          </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1121     private void writeRowToBackup(String backupKey, MessageNano proto,                                   </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1122             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1123         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1124         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1125         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1126         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1127         if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1128     }                                                                                                    </span>
<span  style="">1129                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1130     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1131      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1132      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1133      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1134      * in that case, do a full backup.                                                                   </span>
<span  style="">1135                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1136      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1137      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1138      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1139     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1140         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1141         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1142             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1143             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1144             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1145             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1146             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1147         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1148             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150     }                                                                                                    </span>
<span  style="">1151                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1152     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1153     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1154         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1155         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1156         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1157         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1158         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1159         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1160     }                                                                                                    </span>
<span  style="">1161                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1162     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1163     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1164             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1165         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1166         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1167         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1168         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1169         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1170             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1171         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1172         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1173     }                                                                                                    </span>
<span  style="">1174                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1175     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1176      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1177      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1178     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1179         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1180         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1181         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1182             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1183             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1184         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1185         cursor.close();                                                                                  </span>
<span  style="">1186                                                                                                          </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1187         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1188             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1189             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1190         }                                                                                                </span>
<span  style="">1191                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1192         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1193     }                                                                                                    </span>
<span  style="">1194                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1195     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1196         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1197                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198     }                                                                                                    </span>
<span  style="">1199                                                                                                          </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="">1200     @Thunk class InvalidBackupException extends IOException {                                            </span>
<span  style="">1201                                                                                                          </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1202         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1203                                                                                                          </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="">1204         @Thunk InvalidBackupException(Throwable cause) {                                                 </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1205             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span  style="">1207                                                                                                          </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="">1208         @Thunk InvalidBackupException(String reason) {                                                   </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1209             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1210         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1211     }                                                                                                    </span>
<span  style="">1212                                                                                                          </span>
<span class="-806551235718833382" onmouseenter="enter('-806551235718833382');" onmouseout="out('-806551235718833382');" style="">1213     public boolean shouldAttemptWorkspaceMigration() {                                                   </span>
<span class="-2817654345638424296" onmouseenter="enter('-2817654345638424296');" onmouseout="out('-2817654345638424296');" style="">1214         return migrationCompatibleProfileData != null;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215     }                                                                                                    </span>
<span  style="">1216                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1217     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1218      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1219      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1220      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1221     private class ItemTypeMatcher {                                                                      </span>
<span  style="">1222                                                                                                          </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1223         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1224                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1225         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="">1226             mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1227         }                                                                                                </span>
<span  style="">1228                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1229         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1230             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1231             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1232             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1233                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1234                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1235                 int type;                                                                                </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="">1236                 while (((type = parser.next()) != XmlPullParser.END_TAG ||                               </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="">1237                         parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {              </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1238                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1239                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1240                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="">1241                         final String uri = DefaultLayoutParser.getAttributeValue(                        </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="">1242                                 parser, DefaultLayoutParser.ATTR_URI);                                   </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1243                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1244                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1245                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1246             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1247                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1248             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1249                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1250             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1251             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1252         }                                                                                                </span>
<span  style="">1253                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1254         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1255             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1256                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1257                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="">1258                 if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                        </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="">1259                         || info.activityInfo.name.equals(activity.targetActivity))) {                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1260                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1261                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1262             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1263             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1264         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1265     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1266 }                                                                                                        </span>










































































































































































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  22 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  23 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  24 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  25 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  26 import android.content.Intent;                                                                           </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="">  27 import android.content.pm.ActivityInfo;                                                                  </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  28 import android.content.pm.PackageManager.NameNotFoundException;                                          </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="">  29 import android.content.pm.PackageManager;                                                                </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">  30 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="">  31 import android.content.res.XmlResourceParser;                                                            </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  32 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  33 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  34 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-3433483468941074901" onmouseenter="enter('-3433483468941074901');" onmouseout="out('-3433483468941074901');" style="">  35 import android.graphics.Point;                                                                           </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  36 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  37 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  38 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  39 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  40 import android.util.Log;                                                                                 </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  41 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  42 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  43 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  44 import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                       </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  45 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  46 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  47 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  48 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  49 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  50 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  51 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  52 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  53 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="-797779758351574749" onmouseenter="enter('-797779758351574749');" onmouseout="out('-797779758351574749');" style="">  54 import com.android.launcher3.model.MigrateFromRestoreTask;                                               </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="">  55 import com.android.launcher3.util.Thunk;                                                                 </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  56 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  57 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  58 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  59 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  60 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  61 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  62 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  63 import java.util.Arrays;                                                                                 </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  64 import java.util.HashSet;                                                                                </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  65 import java.util.zip.CRC32;                                                                              </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="">  66 import org.xmlpull.v1.XmlPullParser;                                                                     </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="">  67 import org.xmlpull.v1.XmlPullParserException;                                                            </span>
<span  style="">  68                                                                                                          </span>
<span  style="">  69                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  70 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  71  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  72  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  73 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  74     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span  style="">  75                                                                                                          </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  76     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span  style="">  77                                                                                                          </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  78     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  79                                                                                                          </span>
<span class="826917367119663975" onmouseenter="enter('826917367119663975');" onmouseout="out('826917367119663975');" style="">  80     private static final int BACKUP_VERSION = 4;                                                         </span>
<span  style="">  81                                                                                                          </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  82     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  83                                                                                                          </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  84     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  85     // key (any Base64 encoded string).                                                                  </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  86     // Journal key is such that it is always smaller than any dynamically generated                      </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  87     // key (any Base64 encoded string).                                                                  </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  88     private static final String JOURNAL_KEY = &quot;#&quot;;                                                       </span>
<span  style="">  89                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90     /**                                                                                                  </span>
<span class="-8065821024341297110" onmouseenter="enter('-8065821024341297110');" onmouseout="out('-8065821024341297110');" style="">  91      * icons are large, dribble them out                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92      */                                                                                                  </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  93     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  95     /**                                                                                                  </span>
<span class="3256952212797886844" onmouseenter="enter('3256952212797886844');" onmouseout="out('3256952212797886844');" style="">  96      * widgets contain previews, which are very large, dribble them out                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  97      */                                                                                                  </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  98     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  99                                                                                                          </span>
<span class="1587707096878894918" onmouseenter="enter('1587707096878894918');" onmouseout="out('1587707096878894918');" style=""> 100     private static final String[] FAVORITE_PROJECTION = new java.lang.String[]{ Favorites._ID, // 0      </span>
<span class="-8910357097358992059" onmouseenter="enter('-8910357097358992059');" onmouseout="out('-8910357097358992059');" style=""> 101     Favorites.MODIFIED, // 1                                                                             </span>
<span class="-749201270860763817" onmouseenter="enter('-749201270860763817');" onmouseout="out('-749201270860763817');" style=""> 102     Favorites.INTENT, // 2                                                                               </span>
<span class="-612495736897876596" onmouseenter="enter('-612495736897876596');" onmouseout="out('-612495736897876596');" style=""> 103     Favorites.APPWIDGET_PROVIDER// 3                                                                     </span>
<span class="-6720320026711450546" onmouseenter="enter('-6720320026711450546');" onmouseout="out('-6720320026711450546');" style=""> 104     , Favorites.APPWIDGET_ID, // 4                                                                       </span>
<span class="3218168104679783416" onmouseenter="enter('3218168104679783416');" onmouseout="out('3218168104679783416');" style=""> 105     Favorites.CELLX, // 5                                                                                </span>
<span class="8245952406225141877" onmouseenter="enter('8245952406225141877');" onmouseout="out('8245952406225141877');" style=""> 106     Favorites.CELLY, // 6                                                                                </span>
<span class="-2109237276185492425" onmouseenter="enter('-2109237276185492425');" onmouseout="out('-2109237276185492425');" style=""> 107     Favorites.CONTAINER, // 7                                                                            </span>
<span class="-8366598762535535129" onmouseenter="enter('-8366598762535535129');" onmouseout="out('-8366598762535535129');" style=""> 108     Favorites.ICON, // 8                                                                                 </span>
<span class="-3642835515557756243" onmouseenter="enter('-3642835515557756243');" onmouseout="out('-3642835515557756243');" style=""> 109     Favorites.ICON_PACKAGE, // 9                                                                         </span>
<span class="-2327923354092612113" onmouseenter="enter('-2327923354092612113');" onmouseout="out('-2327923354092612113');" style=""> 110     Favorites.ICON_RESOURCE, // 10                                                                       </span>
<span class="5850657317434177997" onmouseenter="enter('5850657317434177997');" onmouseout="out('5850657317434177997');" style=""> 111     Favorites.ICON_TYPE, // 11                                                                           </span>
<span class="3850117922988643466" onmouseenter="enter('3850117922988643466');" onmouseout="out('3850117922988643466');" style=""> 112     Favorites.ITEM_TYPE, // 12                                                                           </span>
<span class="-6475101418922352990" onmouseenter="enter('-6475101418922352990');" onmouseout="out('-6475101418922352990');" style=""> 113     Favorites.SCREEN, // 13                                                                              </span>
<span class="5128229125325386907" onmouseenter="enter('5128229125325386907');" onmouseout="out('5128229125325386907');" style=""> 114     Favorites.SPANX, // 14                                                                               </span>
<span class="-6122457275871599674" onmouseenter="enter('-6122457275871599674');" onmouseout="out('-6122457275871599674');" style=""> 115     Favorites.SPANY, // 15                                                                               </span>
<span class="-1948317659803091992" onmouseenter="enter('-1948317659803091992');" onmouseout="out('-1948317659803091992');" style=""> 116     Favorites.TITLE, // 16                                                                               </span>
<span class="-807045405076516636" onmouseenter="enter('-807045405076516636');" onmouseout="out('-807045405076516636');" style=""> 117     Favorites.PROFILE_ID, // 17                                                                          </span>
<span class="-2497367574672303169" onmouseenter="enter('-2497367574672303169');" onmouseout="out('-2497367574672303169');" style=""> 118         // 18                                                                                            </span>
<span class="105587193737010335" onmouseenter="enter('105587193737010335');" onmouseout="out('105587193737010335');" style=""> 119     Favorites.RANK };                                                                                    </span>
<span  style=""> 120                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 121     private static final int ID_INDEX = 0;                                                               </span>
<span  style=""> 122                                                                                                          </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 123     private static final int ID_MODIFIED = 1;                                                            </span>
<span  style=""> 124                                                                                                          </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 125     private static final int INTENT_INDEX = 2;                                                           </span>
<span  style=""> 126                                                                                                          </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 127     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span  style=""> 128                                                                                                          </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 129     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span  style=""> 130                                                                                                          </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 131     private static final int CELLX_INDEX = 5;                                                            </span>
<span  style=""> 132                                                                                                          </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 133     private static final int CELLY_INDEX = 6;                                                            </span>
<span  style=""> 134                                                                                                          </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 135     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span  style=""> 136                                                                                                          </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 137     private static final int ICON_INDEX = 8;                                                             </span>
<span  style=""> 138                                                                                                          </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 139     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span  style=""> 140                                                                                                          </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 141     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span  style=""> 142                                                                                                          </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 143     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span  style=""> 144                                                                                                          </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 145     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span  style=""> 146                                                                                                          </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 147     private static final int SCREEN_INDEX = 13;                                                          </span>
<span  style=""> 148                                                                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 149     private static final int SPANX_INDEX = 14;                                                           </span>
<span  style=""> 150                                                                                                          </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 151     private static final int SPANY_INDEX = 15;                                                           </span>
<span  style=""> 152                                                                                                          </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 153     private static final int TITLE_INDEX = 16;                                                           </span>
<span  style=""> 154                                                                                                          </span>
<span class="-9020064880382451057" onmouseenter="enter('-9020064880382451057');" onmouseout="out('-9020064880382451057');" style=""> 155     private static final int RANK_INDEX = 18;                                                            </span>
<span  style=""> 156                                                                                                          </span>
<span class="5285461630596938806" onmouseenter="enter('5285461630596938806');" onmouseout="out('5285461630596938806');" style=""> 157     private static final String[] SCREEN_PROJECTION = new java.lang.String[]{ WorkspaceScreens._ID, // 0 </span>
<span class="-468774149427187497" onmouseenter="enter('-468774149427187497');" onmouseout="out('-468774149427187497');" style=""> 158     WorkspaceScreens.MODIFIED, // 1                                                                      </span>
<span class="500123378539811644" onmouseenter="enter('500123378539811644');" onmouseout="out('500123378539811644');" style=""> 159     WorkspaceScreens.SCREEN_RANK// 2                                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 160      };                                                                                                  </span>
<span  style=""> 161                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 162     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style=""> 164     @Thunk                                                                                               </span>
<span class="5910217195494154996" onmouseenter="enter('5910217195494154996');" onmouseout="out('5910217195494154996');" style=""> 165     final Context mContext;                                                                              </span>
<span  style=""> 166                                                                                                          </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 167     private final HashSet&lt;String&gt; mExistingKeys;                                                         </span>
<span  style=""> 168                                                                                                          </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 169     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span  style=""> 170                                                                                                          </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style=""> 171     private final ItemTypeMatcher[] mItemTypeMatchers;                                                   </span>
<span  style=""> 172                                                                                                          </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style=""> 173     private final long mUserSerial;                                                                      </span>
<span  style=""> 174                                                                                                          </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 175     private BackupManager mBackupManager;                                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 177     private byte[] mBuffer = new byte[512];                                                              </span>
<span  style=""> 178                                                                                                          </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 179     private long mLastBackupRestoreTime;                                                                 </span>
<span  style=""> 180                                                                                                          </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style=""> 181     private boolean mBackupDataWasUpdated;                                                               </span>
<span  style=""> 182                                                                                                          </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style=""> 183     private IconCache mIconCache;                                                                        </span>
<span  style=""> 184                                                                                                          </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style=""> 185     private DeviceProfieData mDeviceProfileData;                                                         </span>
<span  style=""> 186                                                                                                          </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style=""> 187     private InvariantDeviceProfile mIdp;                                                                 </span>
<span  style=""> 188                                                                                                          </span>
<span class="8277982309001466181" onmouseenter="enter('8277982309001466181');" onmouseout="out('8277982309001466181');" style=""> 189     DeviceProfieData migrationCompatibleProfileData;                                                     </span>
<span  style=""> 190                                                                                                          </span>
<span class="324588424384202565" onmouseenter="enter('324588424384202565');" onmouseout="out('324588424384202565');" style=""> 191     HashSet&lt;String&gt; widgetSizes = new HashSet&lt;&gt;();                                                       </span>
<span  style=""> 192                                                                                                          </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 193     boolean restoreSuccessful;                                                                           </span>
<span  style=""> 194                                                                                                          </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style=""> 195     int restoredBackupVersion = 1;                                                                       </span>
<span  style=""> 196                                                                                                          </span>
<span class="4744147174059046892" onmouseenter="enter('4744147174059046892');" onmouseout="out('4744147174059046892');" style=""> 197     // When migrating from a device which different hotseat configuration, the icons are shifted         </span>
<span class="-3936955316846306336" onmouseenter="enter('-3936955316846306336');" onmouseout="out('-3936955316846306336');" style=""> 198     // to center along the new all-apps icon.                                                            </span>
<span class="309766951368773182" onmouseenter="enter('309766951368773182');" onmouseout="out('309766951368773182');" style=""> 199     private int mHotseatShift = 0;                                                                       </span>
<span  style=""> 200                                                                                                          </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 201     public LauncherBackupHelper(Context context) {                                                       </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 202         mContext = context;                                                                              </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 203         mExistingKeys = new HashSet&lt;String&gt;();                                                           </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 204         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 205         restoreSuccessful = true;                                                                        </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style=""> 206         mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];               </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style=""> 207         UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                         </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style=""> 208         mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209     }                                                                                                    </span>
<span  style=""> 210                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 211     private void dataChanged() {                                                                         </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 212         if (mBackupManager == null) {                                                                    </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 213             mBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 215         mBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216     }                                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 218     private void applyJournal(Journal journal) {                                                         </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 219         mLastBackupRestoreTime = journal.t;                                                              </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 220         mExistingKeys.clear();                                                                           </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 221         if (journal.key != null) {                                                                       </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 222             for (Key key : journal.key) {                                                                </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 223                 mExistingKeys.add(keyToBackupKey(key));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style=""> 226         restoredBackupVersion = journal.backupVersion;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 229     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 230      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 231      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 232      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 233      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 234      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 235      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 236      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 237      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 238      * @param newState notes for the next backup                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 239      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 240     @Override                                                                                            </span>
<span class="-5806703195927255708" onmouseenter="enter('-5806703195927255708');" onmouseout="out('-5806703195927255708');" style=""><abbr title=" 241     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor newState) {"> 241     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor </abbr></span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 242         if (VERBOSE) {                                                                                   </span>
<span class="-5617118756948088857" onmouseenter="enter('-5617118756948088857');" onmouseout="out('-5617118756948088857');" style=""> 243             Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244         }                                                                                                </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 245         Journal in = readJournal(oldState);                                                              </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 246         if (!launcherIsReady()) {                                                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 247             dataChanged();                                                                               </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 248             // Perform backup later.                                                                     </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 249             writeJournal(newState, in);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 250             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251         }                                                                                                </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 252         if (mDeviceProfileData == null) {                                                                </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 253             LauncherAppState app = LauncherAppState.getInstance();                                       </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style=""> 254             mIdp = app.getInvariantDeviceProfile();                                                      </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 255             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 256             mIconCache = app.getIconCache();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 258         Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                          </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 259         mKeys.clear();                                                                                   </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 260         applyJournal(in);                                                                                </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 261         // Record the time before performing backup so that entries edited while the backup              </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 262         // was going on, do not get missed in next backup.                                               </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 263         long newBackupTime = System.currentTimeMillis();                                                 </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style=""> 264         mBackupDataWasUpdated = false;                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 265         try {                                                                                            </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 266             backupFavorites(data);                                                                       </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 267             backupScreens(data);                                                                         </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 268             backupIcons(data);                                                                           </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 269             backupWidgets(data);                                                                         </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 270             // Delete any key which still exist in the old backup, but is not valid anymore.             </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 271             HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                           </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 272             for (Key key : mKeys) {                                                                      </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 273                 validKeys.add(keyToBackupKey(key));                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274             }                                                                                            </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 275             mExistingKeys.removeAll(validKeys);                                                          </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 276             // Delete anything left in the existing keys.                                                </span>
<span class="4811572641015042658" onmouseenter="enter('4811572641015042658');" onmouseout="out('4811572641015042658');" style=""> 277             for (String deleted : mExistingKeys) {                                                       </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 278                 if (VERBOSE) {                                                                           </span>
<span class="1150942118378003601" onmouseenter="enter('1150942118378003601');" onmouseout="out('1150942118378003601');" style=""> 279                     Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280                 }                                                                                        </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 281                 data.writeEntityHeader(deleted, -1);                                                     </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style=""> 282                 mBackupDataWasUpdated = true;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283             }                                                                                            </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 284             mExistingKeys.clear();                                                                       </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style=""> 285             if (!mBackupDataWasUpdated) {                                                                </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style=""> 286                 // Check if any metadata has changed                                                     </span>
<span class="-1567327741722237843" onmouseenter="enter('-1567327741722237843');" onmouseout="out('-1567327741722237843');" style=""><abbr title=" 287                 mBackupDataWasUpdated = (((in.profile == null) || (!Arrays.equals(DeviceProfieData.toByteArray(in.profile), DeviceProfieData.toByteArray(mDeviceProfileData)))) || (in.backupVersion != BACKUP_VERSION)) || (in.appVersion != getAppVersion());"> 287                 mBackupDataWasUpdated = (((in.profile == null) || (!Arrays.equals(DeviceProfieData.toByte</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288             }                                                                                            </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style=""> 289             if (mBackupDataWasUpdated) {                                                                 </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style=""> 290                 mLastBackupRestoreTime = newBackupTime;                                                  </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style=""> 291                 // We store the journal at two places.                                                   </span>
<span class="4290466575057092605" onmouseenter="enter('4290466575057092605');" onmouseout="out('4290466575057092605');" style=""> 292                 // 1) Storing it in newState allows us to do partial backups by comparing old state      </span>
<span class="5756403488043250658" onmouseenter="enter('5756403488043250658');" onmouseout="out('5756403488043250658');" style=""> 293                 // 2) Storing it in backup data allows us to validate keys during restore                </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style=""> 294                 Journal state = getCurrentStateJournal();                                                </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style=""> 295                 writeRowToBackup(JOURNAL_KEY, state, data);                                              </span>
<span class="-5471896261648202052" onmouseenter="enter('-5471896261648202052');" onmouseout="out('-5471896261648202052');" style=""> 296             } else if (DEBUG) {                                                                          </span>
<span class="3608009003540804130" onmouseenter="enter('3608009003540804130');" onmouseout="out('3608009003540804130');" style=""> 297                 Log.d(TAG, &quot;Nothing was written during backup&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 299         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 300             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301         }                                                                                                </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 302         writeNewStateDescription(newState);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303     }                                                                                                    </span>
<span  style=""> 304                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 305     /**                                                                                                  </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 306      * @return true if the backup corresponding to oldstate can be successfully applied                  </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 307      * to this device.                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 308      */                                                                                                  </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 309     private boolean isBackupCompatible(Journal oldState) {                                               </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style=""> 310         DeviceProfieData currentProfile = mDeviceProfileData;                                            </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 311         DeviceProfieData oldProfile = oldState.profile;                                                  </span>
<span class="-5663454642251425284" onmouseenter="enter('-5663454642251425284');" onmouseout="out('-5663454642251425284');" style=""> 312         if ((oldProfile == null) || (oldProfile.desktopCols == 0)) {                                     </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 313             // Profile info is not valid, ignore the check.                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 314             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315         }                                                                                                </span>
<span class="458635177486396964" onmouseenter="enter('458635177486396964');" onmouseout="out('458635177486396964');" style=""> 316         boolean isHotseatCompatible = false;                                                             </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 317         if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                     </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style=""> 318             isHotseatCompatible = true;                                                                  </span>
<span class="6856306724544172936" onmouseenter="enter('6856306724544172936');" onmouseout="out('6856306724544172936');" style=""> 319             mHotseatShift = 0;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="291641322832697030" onmouseenter="enter('291641322832697030');" onmouseout="out('291641322832697030');" style=""><abbr title=" 321         if ((currentProfile.allappsRank &gt;= oldProfile.allappsRank) &amp;&amp; ((currentProfile.hotseatCount - currentProfile.allappsRank) &gt;= (oldProfile.hotseatCount - oldProfile.allappsRank))) {"> 321         if ((currentProfile.allappsRank &gt;= oldProfile.allappsRank) &amp;&amp; ((currentProfile.hotseatCount - cur</abbr></span>
<span class="2270742623811584810" onmouseenter="enter('2270742623811584810');" onmouseout="out('2270742623811584810');" style=""> 322             // There is enough space on both sides of the hotseat.                                       </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style=""> 323             isHotseatCompatible = true;                                                                  </span>
<span class="5163576225814391245" onmouseenter="enter('5163576225814391245');" onmouseout="out('5163576225814391245');" style=""> 324             mHotseatShift = currentProfile.allappsRank - oldProfile.allappsRank;                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325         }                                                                                                </span>
<span class="-1017020977077293413" onmouseenter="enter('-1017020977077293413');" onmouseout="out('-1017020977077293413');" style=""> 326         if (!isHotseatCompatible) {                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 327             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328         }                                                                                                </span>
<span class="-4298381991525112166" onmouseenter="enter('-4298381991525112166');" onmouseout="out('-4298381991525112166');" style=""><abbr title=" 329         if ((currentProfile.desktopCols &gt;= oldProfile.desktopCols) &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows)) {"> 329         if ((currentProfile.desktopCols &gt;= oldProfile.desktopCols) &amp;&amp; (currentProfile.desktopRows &gt;= oldP</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 330             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331         }                                                                                                </span>
<span class="-3415423177224261688" onmouseenter="enter('-3415423177224261688');" onmouseout="out('-3415423177224261688');" style=""><abbr title=" 332         if ((MigrateFromRestoreTask.ENABLED &amp;&amp; ((oldProfile.desktopCols - currentProfile.desktopCols) &lt;= 1)) &amp;&amp; ((oldProfile.desktopRows - currentProfile.desktopRows) &lt;= 1)) {"> 332         if ((MigrateFromRestoreTask.ENABLED &amp;&amp; ((oldProfile.desktopCols - currentProfile.desktopCols) &lt;= </abbr></span>
<span class="-7375128792855769034" onmouseenter="enter('-7375128792855769034');" onmouseout="out('-7375128792855769034');" style=""> 333             // Allow desktop migration when row and/or column count contracts by 1.                      </span>
<span class="-3339830446988550734" onmouseenter="enter('-3339830446988550734');" onmouseout="out('-3339830446988550734');" style=""> 334             migrationCompatibleProfileData = initDeviceProfileData(mIdp);                                </span>
<span class="1832232547208942697" onmouseenter="enter('1832232547208942697');" onmouseout="out('1832232547208942697');" style=""> 335             migrationCompatibleProfileData.desktopCols = oldProfile.desktopCols;                         </span>
<span class="539436906242464602" onmouseenter="enter('539436906242464602');" onmouseout="out('539436906242464602');" style=""> 336             migrationCompatibleProfileData.desktopRows = oldProfile.desktopRows;                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 337             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 339         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340     }                                                                                                    </span>
<span  style=""> 341                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 342     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 343      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 344      * It assumes that the keys will arrive in lexical order. So if the journal was present in the       </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 345      * backup, it should arrive first.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 346      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 347      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 348      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 349     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 350     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 351         if (!restoreSuccessful) {                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 352             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353         }                                                                                                </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style=""> 354         if (mDeviceProfileData == null) {                                                                </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style=""> 355             // This call does not happen on a looper thread. So LauncherAppState                         </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style=""> 356             // can&#x27;t be created . Instead initialize required dependencies directly.                     </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style=""> 357             mIdp = new InvariantDeviceProfile(mContext);                                                 </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style=""> 358             mDeviceProfileData = initDeviceProfileData(mIdp);                                            </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style=""> 359             mIconCache = new IconCache(mContext, mIdp);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360         }                                                                                                </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 361         int dataSize = data.size();                                                                      </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 362         if (mBuffer.length &lt; dataSize) {                                                                 </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 363             mBuffer = new byte[dataSize];                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 365         try {                                                                                            </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 366             int bytesRead = data.read(mBuffer, 0, dataSize);                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 367             if (DEBUG) {                                                                                 </span>
<span class="8996496803609627725" onmouseenter="enter('8996496803609627725');" onmouseout="out('8996496803609627725');" style=""> 368                 Log.d(TAG, (((&quot;read &quot; + bytesRead) + &quot; of &quot;) + dataSize) + &quot; available&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369             }                                                                                            </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 370             String backupKey = data.getKey();                                                            </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 371             if (JOURNAL_KEY.equals(backupKey)) {                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 372                 if (VERBOSE) {                                                                           </span>
<span class="-2230266871029732794" onmouseenter="enter('-2230266871029732794');" onmouseout="out('-2230266871029732794');" style=""> 373                     Log.v(TAG, &quot;Journal entry restored&quot;);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374                 }                                                                                        </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 375                 if (!mKeys.isEmpty()) {                                                                  </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 376                     // We received the journal key after a restore key.                                  </span>
<span class="-4686256114772101773" onmouseenter="enter('-4686256114772101773');" onmouseout="out('-4686256114772101773');" style=""> 377                     Log.wtf(TAG, (keyToBackupKey(mKeys.get(0)) + &quot; received after &quot;) + JOURNAL_KEY);     </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 378                     restoreSuccessful = false;                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 379                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380                 }                                                                                        </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 381                 Journal journal = new Journal();                                                         </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 382                 MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                     </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 383                 applyJournal(journal);                                                                   </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 384                 restoreSuccessful = isBackupCompatible(journal);                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 385                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386             }                                                                                            </span>
<span class="7483085946619488974" onmouseenter="enter('7483085946619488974');" onmouseout="out('7483085946619488974');" style=""> 387             if ((!mExistingKeys.isEmpty()) &amp;&amp; (!mExistingKeys.contains(backupKey))) {                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 388                 if (DEBUG) {                                                                             </span>
<span class="-4761886863514344241" onmouseenter="enter('-4761886863514344241');" onmouseout="out('-4761886863514344241');" style=""> 389                     Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 391                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392             }                                                                                            </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 393             Key key = backupKeyToKey(backupKey);                                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 394             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 395             switch (key.type) {                                                                          </span>
<span class="6496334887013597344" onmouseenter="enter('6496334887013597344');" onmouseout="out('6496334887013597344');" style=""> 396                 case Key.FAVORITE :                                                                      </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 397                     restoreFavorite(key, mBuffer, dataSize);                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 398                     break;                                                                               </span>
<span class="287087988598936739" onmouseenter="enter('287087988598936739');" onmouseout="out('287087988598936739');" style=""> 399                 case Key.SCREEN :                                                                        </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 400                     restoreScreen(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 401                     break;                                                                               </span>
<span class="-8891757616372688198" onmouseenter="enter('-8891757616372688198');" onmouseout="out('-8891757616372688198');" style=""> 402                 case Key.ICON :                                                                          </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 403                     restoreIcon(key, mBuffer, dataSize);                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 404                     break;                                                                               </span>
<span class="-8481070254821362106" onmouseenter="enter('-8481070254821362106');" onmouseout="out('-8481070254821362106');" style=""> 405                 case Key.WIDGET :                                                                        </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 406                     restoreWidget(key, mBuffer, dataSize);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 407                     break;                                                                               </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 408                 default :                                                                                </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 409                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 410                     mKeys.remove(key);                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 411                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 413         } catch (IOException e) {                                                                        </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 414             Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416     }                                                                                                    </span>
<span  style=""> 417                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 418     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 419      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 420      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 421      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 422      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 423     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 424     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 425         writeJournal(newState, getCurrentStateJournal());                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426     }                                                                                                    </span>
<span  style=""> 427                                                                                                          </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 428     private Journal getCurrentStateJournal() {                                                           </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 429         Journal journal = new Journal();                                                                 </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 430         journal.t = mLastBackupRestoreTime;                                                              </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 431         journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                 </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 432         journal.appVersion = getAppVersion();                                                            </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 433         journal.backupVersion = BACKUP_VERSION;                                                          </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style=""> 434         journal.profile = mDeviceProfileData;                                                            </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 435         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436     }                                                                                                    </span>
<span  style=""> 437                                                                                                          </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 438     private int getAppVersion() {                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 439         try {                                                                                            </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 440             return mContext.getPackageManager()                                                          </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 441                     .getPackageInfo(mContext.getPackageName(), 0).versionCode;                           </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 442         } catch (NameNotFoundException e) {                                                              </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 443             return 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445     }                                                                                                    </span>
<span  style=""> 446                                                                                                          </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style=""> 447     private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                     </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style=""> 448         DeviceProfieData data = new DeviceProfieData();                                                  </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style=""> 449         data.desktopRows = profile.numRows;                                                              </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style=""> 450         data.desktopCols = profile.numColumns;                                                           </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style=""> 451         data.hotseatCount = profile.numHotseatIcons;                                                     </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style=""> 452         data.allappsRank = profile.hotseatAllAppsRank;                                                   </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style=""> 453         return data;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454     }                                                                                                    </span>
<span  style=""> 455                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 456     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 457      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 458      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 459      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 460      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 461      */                                                                                                  </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 462     private void backupFavorites(BackupDataOutput data) throws IOException {                             </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 463         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 464         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 465         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="4122938018113407665" onmouseenter="enter('4122938018113407665');" onmouseout="out('4122938018113407665');" style=""><abbr title=" 466         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, getUserSelectionArg(), null, null);"> 466         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, getUserSelectionArg(), null,</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 467         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 468             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 469             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 470                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 471                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 472                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 473                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 474                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="4187503492614027377" onmouseenter="enter('4187503492614027377');" onmouseout="out('4187503492614027377');" style=""> 475                 // Favorite proto changed in v4. Backup again if the version is old.                     </span>
<span class="-1343742825742944089" onmouseenter="enter('-1343742825742944089');" onmouseout="out('-1343742825742944089');" style=""><abbr title=" 476                 if (((!mExistingKeys.contains(backupKey)) || (updateTime &gt;= mLastBackupRestoreTime)) || (restoredBackupVersion &lt; 4)) {"> 476                 if (((!mExistingKeys.contains(backupKey)) || (updateTime &gt;= mLastBackupRestoreTime)) || (</abbr></span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 477                     writeRowToBackup(key, packFavorite(cursor), data);                                   </span>
<span class="-5471896261648202052" onmouseenter="enter('-5471896261648202052');" onmouseout="out('-5471896261648202052');" style=""> 478                 } else if (DEBUG) {                                                                      </span>
<span class="2798950388581653999" onmouseenter="enter('2798950388581653999');" onmouseout="out('2798950388581653999');" style=""> 479                     Log.d(TAG, &quot;favorite already backup up: &quot; + id);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 482         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 483             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485     }                                                                                                    </span>
<span  style=""> 486                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 487     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 488      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 489      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 490      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 491      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 492      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 493      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 494      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 495      */                                                                                                  </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 496     private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 497         if (VERBOSE) {                                                                                   </span>
<span class="-6123834741244844948" onmouseenter="enter('-6123834741244844948');" onmouseout="out('-6123834741244844948');" style=""> 498             Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 500         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 501             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 501             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502         }                                                                                                </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 503         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 504         ContentValues values = unpackFavorite(buffer, dataSize);                                         </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style=""> 505         cr.insert(Favorites.CONTENT_URI, values);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506     }                                                                                                    </span>
<span  style=""> 507                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 508     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 509      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 510      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 511      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 512      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 513      */                                                                                                  </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 514     private void backupScreens(BackupDataOutput data) throws IOException {                               </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 515         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 516         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 517         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 518                 null, null, null);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 519         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 520             cursor.moveToPosition(-1);                                                                   </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 521             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 522             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 523                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 524                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 525                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 526                 mKeys.add(key);                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 527                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 528                 if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {        </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 529                     writeRowToBackup(key, packScreen(cursor), data);                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 530                 } else {                                                                                 </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 531                     if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 534         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 535             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537     }                                                                                                    </span>
<span  style=""> 538                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 539     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 540      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 541      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 542      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 543      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 544      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 545      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 546      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 547      */                                                                                                  </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 548     private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 549         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 550         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 551                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 552                                                                                                          </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 553         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 554         ContentValues values = unpackScreen(buffer, dataSize);                                           </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 555         cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556     }                                                                                                    </span>
<span  style=""> 557                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 558     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 559      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 560      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 561      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 562      * @param data output stream for key/value pairs                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 563      */                                                                                                  </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 564     private void backupIcons(BackupDataOutput data) throws IOException {                                 </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 565         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 566         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 567         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 568         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 569         int backupUpIconCount = 0;                                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 570         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="-6932835081018188666" onmouseenter="enter('-6932835081018188666');" onmouseout="out('-6932835081018188666');" style=""><abbr title=" 571         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; OR &quot;) + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_SHORTCUT) + &quot;) AND &quot;) + getUserSelectionArg();"> 571         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; O</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 572         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 573         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 574             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 575             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 576                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 577                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 578                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 579                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 580                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 581                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 582                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 583                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 584                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 585                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 586                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 587                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588                     }                                                                                    </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 589                     if (mExistingKeys.contains(backupKey)) {                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 590                         if (DEBUG) {                                                                     </span>
<span class="4635087996775304723" onmouseenter="enter('4635087996775304723');" onmouseout="out('4635087996775304723');" style=""> 591                             Log.d(TAG, &quot;already saved icon &quot; + backupKey);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592                         }                                                                                </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 593                         // remember that we already backed this up previously                            </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 594                         mKeys.add(key);                                                                  </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 595                     } else if (backupKey != null) {                                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 596                         if (DEBUG) {                                                                     </span>
<span class="530416191072288257" onmouseenter="enter('530416191072288257');" onmouseout="out('530416191072288257');" style=""> 597                             Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598                         }                                                                                </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 599                         if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 600                             if (DEBUG) {                                                                 </span>
<span class="-2589587613337864598" onmouseenter="enter('-2589587613337864598');" onmouseout="out('-2589587613337864598');" style=""> 601                                 Log.d(TAG, &quot;saving icon &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602                             }                                                                            </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 603                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="8052636830342996642" onmouseenter="enter('8052636830342996642');" onmouseout="out('8052636830342996642');" style=""> 604                             if ((icon != null) &amp;&amp; (!mIconCache.isDefaultIcon(icon, myUserHandle))) {     </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 605                                 writeRowToBackup(key, packIcon(dpi, icon), data);                        </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 606                                 mKeys.add(key);                                                          </span>
<span class="235400677560042881" onmouseenter="enter('235400677560042881');" onmouseout="out('235400677560042881');" style=""> 607                                 backupUpIconCount++;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 609                         } else {                                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 610                             if (VERBOSE) {                                                               </span>
<span class="5129938609128680853" onmouseenter="enter('5129938609128680853');" onmouseout="out('5129938609128680853');" style=""> 611                                 Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612                             }                                                                            </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 613                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 614                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 617                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 618                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 619                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 620                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 623         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 624             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626     }                                                                                                    </span>
<span  style=""> 627                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 628     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 629      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 630      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 631      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 632      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 633      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 634      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 635      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 636      */                                                                                                  </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 637     private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                  </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 638         if (VERBOSE) {                                                                                   </span>
<span class="-4078819072521132180" onmouseenter="enter('-4078819072521132180');" onmouseout="out('-4078819072521132180');" style=""> 639             Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 641         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 642             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 642             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643         }                                                                                                </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 644         Resource res = unpackProto(new Resource(), buffer, dataSize);                                    </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 645         if (DEBUG) {                                                                                     </span>
<span class="1496105702580132456" onmouseenter="enter('1496105702580132456');" onmouseout="out('1496105702580132456');" style=""> 646             Log.d(TAG, (&quot;unpacked &quot; + res.dpi) + &quot; dpi icon&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647         }                                                                                                </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 648         Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                       </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 649         if (icon == null) {                                                                              </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 650             Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 651         } else {                                                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 652             if (VERBOSE) {                                                                               </span>
<span class="7868918963870702505" onmouseenter="enter('7868918963870702505');" onmouseout="out('7868918963870702505');" style=""> 653                 Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654             }                                                                                            </span>
<span class="3133606860225122509" onmouseenter="enter('3133606860225122509');" onmouseout="out('3133606860225122509');" style=""> 655                     /* label */                                                                          </span>
<span class="-2703814818785106029" onmouseenter="enter('-2703814818785106029');" onmouseout="out('-2703814818785106029');" style=""><abbr title=" 656             mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi, &quot;&quot;, mUserSerial, mIdp);"> 656             mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi, &quot;&quot;, mUserS</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658     }                                                                                                    </span>
<span  style=""> 659                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 660     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 661      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 662      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 663      *                                                                                                   </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 664      * @param data output stream for key/value pairs                                                     </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 665      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 666      */                                                                                                  </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 667     private void backupWidgets(BackupDataOutput data) throws IOException {                               </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 668         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 669         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 670         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 671         int backupWidgetCount = 0;                                                                       </span>
<span class="-6307972240176527729" onmouseenter="enter('-6307972240176527729');" onmouseout="out('-6307972240176527729');" style=""><abbr title=" 672         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUserSelectionArg();"> 672         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUse</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 673         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 674         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 675             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 676             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 677                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 678                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 679                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 680                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 681                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 682                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 683                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 684                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 685                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 686                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687                 }                                                                                        </span>
<span class="-8332597063062869722" onmouseenter="enter('-8332597063062869722');" onmouseout="out('-8332597063062869722');" style=""> 688                 // Widget backup proto changed in v3. So add it again if the original backup is old.     </span>
<span class="-6714911851302829669" onmouseenter="enter('-6714911851302829669');" onmouseout="out('-6714911851302829669');" style=""> 689                 if (mExistingKeys.contains(backupKey) &amp;&amp; (restoredBackupVersion &gt;= 3)) {                 </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 690                     if (DEBUG) {                                                                         </span>
<span class="5278806361360866030" onmouseenter="enter('5278806361360866030');" onmouseout="out('5278806361360866030');" style=""> 691                         Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692                     }                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 693                     // remember that we already backed this up previously                                </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 694                     mKeys.add(key);                                                                      </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 695                 } else if (backupKey != null) {                                                          </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 696                     if (DEBUG) {                                                                         </span>
<span class="678155715926072897" onmouseenter="enter('678155715926072897');" onmouseout="out('678155715926072897');" style=""> 697                         Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698                     }                                                                                    </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 699                     if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 700                         if (DEBUG) {                                                                     </span>
<span class="5540811938341971613" onmouseenter="enter('5540811938341971613');" onmouseout="out('5540811938341971613');" style=""> 701                             Log.d(TAG, &quot;saving widget &quot; + backupKey);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702                         }                                                                                </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style=""> 703                         UserHandleCompat user = UserHandleCompat.myUserHandle();                         </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style=""> 704                         writeRowToBackup(key, packWidget(dpi, provider, user), data);                    </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 705                         mKeys.add(key);                                                                  </span>
<span class="3646169184741034315" onmouseenter="enter('3646169184741034315');" onmouseout="out('3646169184741034315');" style=""> 706                         backupWidgetCount++;                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 707                     } else {                                                                             </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 708                         if (VERBOSE) {                                                                   </span>
<span class="5514285149038000298" onmouseenter="enter('5514285149038000298');" onmouseout="out('5514285149038000298');" style=""> 709                             Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710                         }                                                                                </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 711                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 712                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 716         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 717             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719     }                                                                                                    </span>
<span  style=""> 720                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 721     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 722      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 723      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 724      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 725      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 726      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 727      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 728      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 729      */                                                                                                  </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 730     private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 731         if (VERBOSE) {                                                                                   </span>
<span class="-6524290342693786597" onmouseenter="enter('-6524290342693786597');" onmouseout="out('-6524290342693786597');" style=""> 732             Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 734         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 735             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 735             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 737         Widget widget = unpackProto(new Widget(), buffer, dataSize);                                     </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 738         if (DEBUG) {                                                                                     </span>
<span class="-9093045750186824630" onmouseenter="enter('-9093045750186824630');" onmouseout="out('-9093045750186824630');" style=""> 739             Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740         }                                                                                                </span>
<span class="-2352547474915147862" onmouseenter="enter('-2352547474915147862');" onmouseout="out('-2352547474915147862');" style=""> 741         if (widget.icon.data != null) {                                                                  </span>
<span class="-4697846519687927474" onmouseenter="enter('-4697846519687927474');" onmouseout="out('-4697846519687927474');" style=""> 742             Bitmap icon = BitmapFactory.decodeByteArray(widget.icon.data, 0, widget.icon.data.length);   </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 743             if (icon == null) {                                                                          </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 744                 Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 745             } else {                                                                                     </span>
<span class="6980620582013661429" onmouseenter="enter('6980620582013661429');" onmouseout="out('6980620582013661429');" style=""><abbr title=" 746                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider), icon, widget.icon.dpi, widget.label, mUserSerial, mIdp);"> 746                 mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider), icon, widget.i</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748         }                                                                                                </span>
<span class="-2385058200628938943" onmouseenter="enter('-2385058200628938943');" onmouseout="out('-2385058200628938943');" style=""> 749         // Cache widget min sizes incase migration is required.                                          </span>
<span class="282472742514233108" onmouseenter="enter('282472742514233108');" onmouseout="out('282472742514233108');" style=""> 750         widgetSizes.add((((widget.provider + &quot;#&quot;) + widget.minSpanX) + &quot;,&quot;) + widget.minSpanY);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751     }                                                                                                    </span>
<span  style=""> 752                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 753     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 754      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 755      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 756      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 757      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 758     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 759         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 760         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 761         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 762         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 763         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764     }                                                                                                    </span>
<span  style=""> 765                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 766     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 767      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 768      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 769      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 770      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 771     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 772         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 773         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 774         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 775         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 776         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777     }                                                                                                    </span>
<span  style=""> 778                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 779     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 780     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 781         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782     }                                                                                                    </span>
<span  style=""> 783                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 784     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 785     private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 786         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 787             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 788             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 789                 key = null;                                                                              </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 790                 throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 792             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 793         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 794             throw new InvalidBackupException(e);                                                         </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 795         } catch (IllegalArgumentException e) {                                                           </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 796             throw new InvalidBackupException(e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798     }                                                                                                    </span>
<span  style=""> 799                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 800     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 801     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 802         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 803         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 804         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 805         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 806         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 807             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 809         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810     }                                                                                                    </span>
<span  style=""> 811                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 812     /**                                                                                                  </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style=""> 813      * @return the current device profile information.                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 814      */                                                                                                  </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style=""> 815     private boolean isReplaceableHotseatItem(Favorite favorite) {                                        </span>
<span class="2678893273476874271" onmouseenter="enter('2678893273476874271');" onmouseout="out('2678893273476874271');" style=""><abbr title=" 816         return ((favorite.container == Favorites.CONTAINER_HOTSEAT) &amp;&amp; (favorite.intent != null)) &amp;&amp; ((favorite.itemType == Favorites.ITEM_TYPE_APPLICATION) || (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT));"> 816         return ((favorite.container == Favorites.CONTAINER_HOTSEAT) &amp;&amp; (favorite.intent != null)) &amp;&amp; ((fa</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span  style=""> 818                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 819     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 820     private Favorite packFavorite(Cursor c) {                                                            </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 821         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 822         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 823         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 824         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 825         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 826         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 827         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 828         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 829         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="-7969839402703871132" onmouseenter="enter('-7969839402703871132');" onmouseout="out('-7969839402703871132');" style=""> 830         favorite.rank = c.getInt(RANK_INDEX);                                                            </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 831         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 832         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 833             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 835         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style=""> 836         Intent intent = null;                                                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 837         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 838             try {                                                                                        </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style=""> 839                 intent = Intent.parseUri(intentDescription, 0);                                          </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 840                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 841                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 842             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 843                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 846         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 847         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 848             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 849             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 850             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 851                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852             }                                                                                            </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style=""> 853         } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                  </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 854             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 855                 String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                    </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 856                 if (!TextUtils.isEmpty(iconPackage)) {                                                   </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 857                     favorite.iconPackage = iconPackage;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 858                 }                                                                                        </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 859                 String iconResource = c.getString(ICON_RESOURCE_INDEX);                                  </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 860                 if (!TextUtils.isEmpty(iconResource)) {                                                  </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 861                     favorite.iconResource = iconResource;                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863             }                                                                                            </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 864             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-7768091047370598017" onmouseenter="enter('-7768091047370598017');" onmouseout="out('-7768091047370598017');" style=""> 865             if ((blob != null) &amp;&amp; (blob.length &gt; 0)) {                                                   </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 866                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868         }                                                                                                </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style=""> 869         if (isReplaceableHotseatItem(favorite)) {                                                        </span>
<span class="-5359258242147093219" onmouseenter="enter('-5359258242147093219');" onmouseout="out('-5359258242147093219');" style=""> 870             if ((intent != null) &amp;&amp; (intent.getComponent() != null)) {                                   </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style=""> 871                 PackageManager pm = mContext.getPackageManager();                                        </span>
<span class="4317298495692205294" onmouseenter="enter('4317298495692205294');" onmouseout="out('4317298495692205294');" style=""> 872                 ActivityInfo activity = null;                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 873                 try {                                                                                    </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style=""> 874                     activity = pm.getActivityInfo(intent.getComponent(), 0);                             </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 875                 } catch (NameNotFoundException e) {                                                      </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style=""> 876                     Log.e(TAG, &quot;Target not found&quot;, e);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877                 }                                                                                        </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style=""> 878                 if (activity == null) {                                                                  </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 879                     return favorite;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 880                 }                                                                                        </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style=""> 881                 for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                     </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style=""> 882                     if (mItemTypeMatchers[i] == null) {                                                  </span>
<span class="-4832415767623566243" onmouseenter="enter('-4832415767623566243');" onmouseout="out('-4832415767623566243');" style=""><abbr title=" 883                         mItemTypeMatchers[i] = new ItemTypeMatcher(CommonAppTypeParser.getResourceForItemType(i));"> 883                         mItemTypeMatchers[i] = new ItemTypeMatcher(CommonAppTypeParser.getResourceForItem</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884                     }                                                                                    </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style=""> 885                     if (mItemTypeMatchers[i].matches(activity, pm)) {                                    </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style=""> 886                         favorite.targetType = i;                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 887                         break;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 889                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891         }                                                                                                </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 892         return favorite;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 893     }                                                                                                    </span>
<span  style=""> 894                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 895     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-2705156603149131066" onmouseenter="enter('-2705156603149131066');" onmouseout="out('-2705156603149131066');" style=""> 896     private ContentValues unpackFavorite(byte[] buffer, int dataSize) throws IOException {               </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 897         Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                               </span>
<span class="9046104249279415184" onmouseenter="enter('9046104249279415184');" onmouseout="out('9046104249279415184');" style=""> 898         // If it is a hotseat item, move it accordingly.                                                 </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 899         if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                         </span>
<span class="-6501405241219819611" onmouseenter="enter('-6501405241219819611');" onmouseout="out('-6501405241219819611');" style=""> 900             favorite.screen += mHotseatShift;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 901         }                                                                                                </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 902         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 903         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 904         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 905         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 906         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 907         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 908         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 909         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="-3701788107564637331" onmouseenter="enter('-3701788107564637331');" onmouseout="out('-3701788107564637331');" style=""> 910         values.put(Favorites.RANK, favorite.rank);                                                       </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style=""> 911         if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                         </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 912             values.put(Favorites.ICON_TYPE, favorite.iconType);                                          </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 913             if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                     </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 914                 values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 915                 values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 916             }                                                                                            </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 917             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918         }                                                                                                </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 919         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 920             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 921         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 922             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 924         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 925             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 927         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 928         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="927954047226477943" onmouseenter="enter('927954047226477943');" onmouseout="out('927954047226477943');" style=""><abbr title=" 929         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);"> 929         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHand</abbr></span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 930         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span class="7585439753959053806" onmouseenter="enter('7585439753959053806');" onmouseout="out('7585439753959053806');" style=""> 931         // If we will attempt grid resize, use the original profile to validate grid size, as            </span>
<span class="7298199795309036018" onmouseenter="enter('7298199795309036018');" onmouseout="out('7298199795309036018');" style=""> 932         // anything which fits in the original grid should fit in the current grid after                 </span>
<span class="-386818733866572403" onmouseenter="enter('-386818733866572403');" onmouseout="out('-386818733866572403');" style=""> 933         // grid migration.                                                                               </span>
<span class="-1399049322136518278" onmouseenter="enter('-1399049322136518278');" onmouseout="out('-1399049322136518278');" style=""><abbr title=" 934         DeviceProfieData currentProfile = (migrationCompatibleProfileData == null) ? mDeviceProfileData : migrationCompatibleProfileData;"> 934         DeviceProfieData currentProfile = (migrationCompatibleProfileData == null) ? mDeviceProfileData :</abbr></span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 935         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 936             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 937                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 939             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="4553452473703868579" onmouseenter="enter('4553452473703868579');" onmouseout="out('4553452473703868579');" style=""><abbr title=" 940             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY) | LauncherAppWidgetInfo.FLAG_UI_NOT_READY);"> 940             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | La</abbr></span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 941             // Verify placement                                                                          </span>
<span class="3504964728132522462" onmouseenter="enter('3504964728132522462');" onmouseout="out('3504964728132522462');" style=""><abbr title=" 942             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols) || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {"> 942             if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols) || ((favorite.cellY + fa</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 943                 restoreSuccessful = false;                                                               </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style=""> 944                 throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 945             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 946         } else {                                                                                         </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style=""> 947             // Check if it is an hotseat item, that can be replaced.                                     </span>
<span class="279700350632264948" onmouseenter="enter('279700350632264948');" onmouseout="out('279700350632264948');" style=""><abbr title=" 948             if ((isReplaceableHotseatItem(favorite) &amp;&amp; (favorite.targetType != Favorite.TARGET_NONE)) &amp;&amp; (favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT)) {"> 948             if ((isReplaceableHotseatItem(favorite) &amp;&amp; (favorite.targetType != Favorite.TARGET_NONE)) &amp;&amp; </abbr></span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style=""> 949                 Log.e(TAG, &quot;Added item type flag&quot;);                                                      </span>
<span class="8152825144969340057" onmouseenter="enter('8152825144969340057');" onmouseout="out('8152825144969340057');" style=""><abbr title=" 950                 values.put(LauncherSettings.Favorites.RESTORED, 1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));"> 950                 values.put(LauncherSettings.Favorites.RESTORED, 1 | CommonAppTypeParser.encodeItemTypeToF</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 951             } else {                                                                                     </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 952                 // Let LauncherModel know we&#x27;ve been here.                                               </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 953                 values.put(LauncherSettings.Favorites.RESTORED, 1);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 954             }                                                                                            </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style=""> 955             // Verify placement                                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style=""> 956             if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                     </span>
<span class="2545967495709376645" onmouseenter="enter('2545967495709376645');" onmouseout="out('2545967495709376645');" style=""><abbr title=" 957                 if ((favorite.screen &gt;= currentProfile.hotseatCount) || (favorite.screen == currentProfile.allappsRank)) {"> 957                 if ((favorite.screen &gt;= currentProfile.hotseatCount) || (favorite.screen == currentProfil</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 958                     restoreSuccessful = false;                                                           </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style=""> 959                     throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 960                 }                                                                                        </span>
<span class="1112998508371516182" onmouseenter="enter('1112998508371516182');" onmouseout="out('1112998508371516182');" style=""><abbr title=" 961             } else if ((favorite.cellX &gt;= currentProfile.desktopCols) || (favorite.cellY &gt;= currentProfile.desktopRows)) {"> 961             } else if ((favorite.cellX &gt;= currentProfile.desktopCols) || (favorite.cellY &gt;= currentProfil</abbr></span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 962                 restoreSuccessful = false;                                                               </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style=""> 963                 throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 965         }                                                                                                </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 966         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 967     }                                                                                                    </span>
<span  style=""> 968                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 969     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style=""> 970     private Screen packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 971         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 972         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 973         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 974         return screen;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975     }                                                                                                    </span>
<span  style=""> 976                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 977     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style=""> 978     private ContentValues unpackScreen(byte[] buffer, int dataSize)                                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 979             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style=""> 980         Screen screen = unpackProto(new Screen(), buffer, dataSize);                                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 981         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 982         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 983         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 984         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985     }                                                                                                    </span>
<span  style=""> 986                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 987     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style=""> 988     private Resource packIcon(int dpi, Bitmap icon) {                                                    </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 989         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 990         res.dpi = dpi;                                                                                   </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style=""> 991         res.data = Utilities.flattenBitmap(icon);                                                        </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 992         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993     }                                                                                                    </span>
<span  style=""> 994                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 995     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style=""> 996     private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                  </span>
<span class="-1416918261157743074" onmouseenter="enter('-1416918261157743074');" onmouseout="out('-1416918261157743074');" style=""><abbr title=" 997         final LauncherAppWidgetProviderInfo info = LauncherModel.getProviderInfo(mContext, provider, user);"> 997         final LauncherAppWidgetProviderInfo info = LauncherModel.getProviderInfo(mContext, provider, user</abbr></span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 998         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 999         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1000         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1001         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1002         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1003             widget.icon = new Resource();                                                                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style="">1004             Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);      </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1005             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style="">1006             widget.icon.data = Utilities.flattenBitmap(icon);                                            </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="">1007             widget.icon.dpi = dpi;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1008         }                                                                                                </span>
<span class="1043295540346253364" onmouseenter="enter('1043295540346253364');" onmouseout="out('1043295540346253364');" style="">1009         Point spans = info.getMinSpans(mIdp, mContext);                                                  </span>
<span class="-1248183371241258015" onmouseenter="enter('-1248183371241258015');" onmouseout="out('-1248183371241258015');" style="">1010         widget.minSpanX = spans.x;                                                                       </span>
<span class="1290669233310739887" onmouseenter="enter('1290669233310739887');" onmouseout="out('1290669233310739887');" style="">1011         widget.minSpanY = spans.y;                                                                       </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1012         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1013     }                                                                                                    </span>
<span  style="">1014                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1015     /**                                                                                                  </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1016      * Deserialize a proto after verifying checksum wrapper.                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1017      */                                                                                                  </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1018     private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1019             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1020         MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1021         if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1022         return proto;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1023     }                                                                                                    </span>
<span  style="">1024                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1025     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1026      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1027      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1028      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1029      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1030      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1031      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1032      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1033      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1034     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1035         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1036         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1037             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1038         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1039         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1040         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1041             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1042             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1043             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1044                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1045                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1046                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1047                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1048                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1049                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1050                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1051                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1052                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1053                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1054                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1055                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1056                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1057                             bytesRead += result;                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1058                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1059                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1060                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1061                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1062                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1063                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1064                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1065                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1066                     }                                                                                    </span>
<span  style="">1067                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1068                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1069                     try {                                                                                </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1070                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));             </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1071                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1072                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1073                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1074                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1075                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1076                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1077                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1078                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1079                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1081                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1082                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1083                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1084                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1085             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1086         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1087             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1088         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1089             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1090                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1091             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1092                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1093             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1095         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1096     }                                                                                                    </span>
<span  style="">1097                                                                                                          </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1098     private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                     </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1099             throws IOException {                                                                         </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1100         writeRowToBackup(keyToBackupKey(key), proto, data);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1101     }                                                                                                    </span>
<span  style="">1102                                                                                                          </span>
<span class="5997468119611754471" onmouseenter="enter('5997468119611754471');" onmouseout="out('5997468119611754471');" style=""><abbr title="1103     private void writeRowToBackup(String backupKey, MessageNano proto, BackupDataOutput data) throws IOException {">1103     private void writeRowToBackup(String backupKey, MessageNano proto, BackupDataOutput data) throws IOEx</abbr></span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1104         byte[] blob = writeCheckedBytes(proto);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1105         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1106         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="">1107         mBackupDataWasUpdated = true;                                                                    </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1108         if (VERBOSE) {                                                                                   </span>
<span class="-1368886410353517341" onmouseenter="enter('-1368886410353517341');" onmouseout="out('-1368886410353517341');" style="">1109             Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1110         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111     }                                                                                                    </span>
<span  style="">1112                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1113     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1114      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1115      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1116      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1117      * in that case, do a full backup.                                                                   </span>
<span  style="">1118                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1119      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1120      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1121      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1122     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1123         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1124         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1125             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1126             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1127             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1128             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1129             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1130         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1131             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1132         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1133     }                                                                                                    </span>
<span  style="">1134                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1135     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1136     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1137         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1138         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1139         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1140         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1141         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1142         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1143     }                                                                                                    </span>
<span  style="">1144                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1145     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1146     private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                  </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1147             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1148         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1149         MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                             </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1150         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1151         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1152         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1153             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1154         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1155         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1156     }                                                                                                    </span>
<span  style="">1157                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1158     /**                                                                                                  </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1159      * @return true if the launcher is in a state to support backup                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1160      */                                                                                                  </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1161     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1162         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1163         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1164         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1165             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1166             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1167         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1168         cursor.close();                                                                                  </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="">1169         if (LauncherAppState.getInstanceNoCreate() == null) {                                            </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1170             // launcher services are unavailable, try again later                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1171             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1173         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1174     }                                                                                                    </span>
<span  style="">1175                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1176     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1177         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1178                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1179     }                                                                                                    </span>
<span  style="">1180                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1181     @Thunk                                                                                               </span>
<span class="-7015206867904851673" onmouseenter="enter('-7015206867904851673');" onmouseout="out('-7015206867904851673');" style="">1182     class InvalidBackupException extends IOException {                                                   </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="">1183         private static final long serialVersionUID = 8931456637211665082L;                               </span>
<span  style="">1184                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1185         @Thunk                                                                                           </span>
<span class="-4902678955413310672" onmouseenter="enter('-4902678955413310672');" onmouseout="out('-4902678955413310672');" style="">1186         InvalidBackupException(Throwable cause) {                                                        </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1187             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1188         }                                                                                                </span>
<span  style="">1189                                                                                                          </span>
<span class="-2238806055197440738" onmouseenter="enter('-2238806055197440738');" onmouseout="out('-2238806055197440738');" style="">1190         @Thunk                                                                                           </span>
<span class="7967891493045537234" onmouseenter="enter('7967891493045537234');" onmouseout="out('7967891493045537234');" style="">1191         InvalidBackupException(String reason) {                                                          </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1192             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1193         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1194     }                                                                                                    </span>
<span  style="">1195                                                                                                          </span>
<span class="-806551235718833382" onmouseenter="enter('-806551235718833382');" onmouseout="out('-806551235718833382');" style="">1196     public boolean shouldAttemptWorkspaceMigration() {                                                   </span>
<span class="-2817654345638424296" onmouseenter="enter('-2817654345638424296');" onmouseout="out('-2817654345638424296');" style="">1197         return migrationCompatibleProfileData != null;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198     }                                                                                                    </span>
<span  style="">1199                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1200     /**                                                                                                  </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="">1201      * A class to check if an activity can handle one of the intents from a list of                      </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="">1202      * predefined intents.                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1203      */                                                                                                  </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="">1204     private class ItemTypeMatcher {                                                                      </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="">1205         private final ArrayList&lt;Intent&gt; mIntents;                                                        </span>
<span  style="">1206                                                                                                          </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="">1207         ItemTypeMatcher(int xml_res) {                                                                   </span>
<span class="7774102846924447028" onmouseenter="enter('7774102846924447028');" onmouseout="out('7774102846924447028');" style="">1208             mIntents = (xml_res == 0) ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1209         }                                                                                                </span>
<span  style="">1210                                                                                                          </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="">1211         private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                            </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="">1212             ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                         </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="">1213             XmlResourceParser parser = mContext.getResources().getXml(xml_res);                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1214             try {                                                                                        </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="">1215                 DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);              </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="">1216                 final int depth = parser.getDepth();                                                     </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="">1217                 int type;                                                                                </span>
<span class="4981837604325580139" onmouseenter="enter('4981837604325580139');" onmouseout="out('4981837604325580139');" style=""><abbr title="1218                 while ((((type = parser.next()) != XmlPullParser.END_TAG) || (parser.getDepth() &gt; depth)) &amp;&amp; (type != XmlPullParser.END_DOCUMENT)) {">1218                 while ((((type = parser.next()) != XmlPullParser.END_TAG) || (parser.getDepth() &gt; depth))</abbr></span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="">1219                     if (type != XmlPullParser.START_TAG) {                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="">1220                         continue;                                                                        </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="">1221                     } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {              </span>
<span class="2100728637087232742" onmouseenter="enter('2100728637087232742');" onmouseout="out('2100728637087232742');" style=""><abbr title="1222                         final String uri = DefaultLayoutParser.getAttributeValue(parser, DefaultLayoutParser.ATTR_URI);">1222                         final String uri = DefaultLayoutParser.getAttributeValue(parser, DefaultLayoutPar</abbr></span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="">1223                         intents.add(Intent.parseUri(uri, 0));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1224                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1225                 }                                                                                        </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="">1226             } catch (URISyntaxException | XmlPullParserException | IOException e) {                      </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="">1227                 Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1228             } finally {                                                                                  </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="">1229                 parser.close();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1230             }                                                                                            </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="">1231             return intents;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1232         }                                                                                                </span>
<span  style="">1233                                                                                                          </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="">1234         public boolean matches(ActivityInfo activity, PackageManager pm) {                               </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="">1235             for (Intent intent : mIntents) {                                                             </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="">1236                 intent.setPackage(activity.packageName);                                                 </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="">1237                 ResolveInfo info = pm.resolveActivity(intent, 0);                                        </span>
<span class="515179691964617202" onmouseenter="enter('515179691964617202');" onmouseout="out('515179691964617202');" style=""><abbr title="1238                 if ((info != null) &amp;&amp; (info.activityInfo.name.equals(activity.name) || info.activityInfo.name.equals(activity.targetActivity))) {">1238                 if ((info != null) &amp;&amp; (info.activityInfo.name.equals(activity.name) || info.activityInfo.</abbr></span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1239                     return true;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1240                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1241             }                                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1242             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1243         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1244     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1245 }                                                                                                        </span>































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2   * Copyright (C) 2013 The Android Open Source Project                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16  package com.android.launcher3;                                                                                    </span>
<span  style="">  17                                                                                                                    </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18  import android.app.backup.BackupDataInputStream;                                                                  </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19  import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20  import android.app.backup.BackupHelper;                                                                           </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21  import android.app.backup.BackupManager;                                                                          </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import android.appwidget.AppWidgetManager;                                                                        </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  24  import android.content.ComponentName;                                                                             </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  25  import android.content.ContentResolver;                                                                           </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  26  import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28  import android.content.Intent;                                                                                    </span>
<span class="-9183914406029598577" onmouseenter="enter('-9183914406029598577');" onmouseout="out('-9183914406029598577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import android.content.pm.ActivityInfo;                                                                           </span>
<span class="-1290624633738557221" onmouseenter="enter('-1290624633738557221');" onmouseout="out('-1290624633738557221');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import android.content.pm.PackageManager;                                                                         </span>
<span class="-2097531830514422912" onmouseenter="enter('-2097531830514422912');" onmouseout="out('-2097531830514422912');" style="">  31  import android.content.pm.PackageManager.NameNotFoundException;                                                   </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import android.content.pm.ResolveInfo;                                                                            </span>
<span class="7386012112211289620" onmouseenter="enter('7386012112211289620');" onmouseout="out('7386012112211289620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import android.content.res.XmlResourceParser;                                                                     </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  34  import android.database.Cursor;                                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  35  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  36  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-3433483468941074901" onmouseenter="enter('-3433483468941074901');" onmouseout="out('-3433483468941074901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import android.graphics.Point;                                                                                    </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  38  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  39  import android.os.ParcelFileDescriptor;                                                                           </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  40  import android.text.TextUtils;                                                                                    </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  41  import android.util.Base64;                                                                                       </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  42  import android.util.Log;                                                                                          </span>
<span  style="">  43                                                                                                                    </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  44  import com.android.launcher3.LauncherSettings.Favorites;                                                          </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  45  import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                                   </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  46  import com.android.launcher3.backup.BackupProtos;                                                                 </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  47  import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                                  </span>
<span class="-9155601042523121965" onmouseenter="enter('-9155601042523121965');" onmouseout="out('-9155601042523121965');" style="">  48  import com.android.launcher3.backup.BackupProtos.DeviceProfieData;                                                </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  49  import com.android.launcher3.backup.BackupProtos.Favorite;                                                        </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  50  import com.android.launcher3.backup.BackupProtos.Journal;                                                         </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  51  import com.android.launcher3.backup.BackupProtos.Key;                                                             </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  52  import com.android.launcher3.backup.BackupProtos.Resource;                                                        </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  53  import com.android.launcher3.backup.BackupProtos.Screen;                                                          </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  54  import com.android.launcher3.backup.BackupProtos.Widget;                                                          </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  55  import com.android.launcher3.compat.UserHandleCompat;                                                             </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  56  import com.android.launcher3.compat.UserManagerCompat;                                                            </span>
<span class="-797779758351574749" onmouseenter="enter('-797779758351574749');" onmouseout="out('-797779758351574749');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +import com.android.launcher3.model.MigrateFromRestoreTask;                                                        </span>
<span class="-1058861693464722738" onmouseenter="enter('-1058861693464722738');" onmouseout="out('-1058861693464722738');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import com.android.launcher3.util.Thunk;                                                                          </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  59  import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                               </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  60  import com.google.protobuf.nano.MessageNano;                                                                      </span>
<span  style="">  61                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-5145222340437954675" onmouseenter="enter('-5145222340437954675');" onmouseout="out('-5145222340437954675');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import org.xmlpull.v1.XmlPullParser;                                                                              </span>
<span class="-3477173242969633951" onmouseenter="enter('-3477173242969633951');" onmouseout="out('-3477173242969633951');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +import org.xmlpull.v1.XmlPullParserException;                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +                                                                                                                  </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  66  import java.io.FileInputStream;                                                                                   </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  67  import java.io.FileOutputStream;                                                                                  </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  68  import java.io.IOException;                                                                                       </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  69  import java.net.URISyntaxException;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  70  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -import java.util.HashMap;                                                                                         </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +import java.util.Arrays;                                                                                          </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  73  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -import java.util.List;                                                                                            </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  75  import java.util.zip.CRC32;                                                                                       </span>
<span  style="">  76                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77  /**                                                                                                               </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  78   * Persist the launcher home state across calamities.                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  79   */                                                                                                               </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  80  public class LauncherBackupHelper implements BackupHelper {                                                       </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  81      private static final String TAG = &quot;LauncherBackupHelper&quot;;                                                     </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  82      private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                                     </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  83      private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                         </span>
<span  style="">  84                                                                                                                    </span>
<span class="-1169906795921543870" onmouseenter="enter('-1169906795921543870');" onmouseout="out('-1169906795921543870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -    private static final int BACKUP_VERSION = 2;                                                                  </span>
<span class="826917367119663975" onmouseenter="enter('826917367119663975');" onmouseout="out('826917367119663975');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +    private static final int BACKUP_VERSION = 4;                                                                  </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  87      private static final int MAX_JOURNAL_SIZE = 1000000;                                                          </span>
<span  style="">  88                                                                                                                    </span>
<span class="1227889678285844575" onmouseenter="enter('1227889678285844575');" onmouseout="out('1227889678285844575');" style="">  89      // Journal key is such that it is always smaller than any dynamically generated                               </span>
<span class="-7201622243292167361" onmouseenter="enter('-7201622243292167361');" onmouseout="out('-7201622243292167361');" style="">  90      // key (any Base64 encoded string).                                                                           </span>
<span class="-2000116264167241763" onmouseenter="enter('-2000116264167241763');" onmouseout="out('-2000116264167241763');" style="">  91      private static final String JOURNAL_KEY = &quot;#&quot;;                                                                </span>
<span  style="">  92                                                                                                                    </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  93      /** icons are large, dribble them out */                                                                      </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  94      private static final int MAX_ICONS_PER_PASS = 10;                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  96      /** widgets contain previews, which are very large, dribble them out */                                       </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  97      private static final int MAX_WIDGETS_PER_PASS = 5;                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -                                                                                                                  </span>
<span class="-1476094414441025702" onmouseenter="enter('-1476094414441025702');" onmouseout="out('-1476094414441025702');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    private static final int IMAGE_COMPRESSION_QUALITY = 75;                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -                                                                                                                  </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -    private static final Bitmap.CompressFormat IMAGE_FORMAT =                                                     </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -            android.graphics.Bitmap.CompressFormat.PNG;                                                           </span>
<span  style=""> 103                                                                                                                    </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style=""> 104      private static final String[] FAVORITE_PROJECTION = {                                                         </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style=""> 105          Favorites._ID,                     // 0                                                                   </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style=""> 106          Favorites.MODIFIED,                // 1                                                                   </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style=""> 107          Favorites.INTENT,                  // 2                                                                   </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style=""> 108          Favorites.APPWIDGET_PROVIDER,      // 3                                                                   </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style=""> 109          Favorites.APPWIDGET_ID,            // 4                                                                   </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style=""> 110          Favorites.CELLX,                   // 5                                                                   </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 111          Favorites.CELLY,                   // 6                                                                   </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 112          Favorites.CONTAINER,               // 7                                                                   </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 113          Favorites.ICON,                    // 8                                                                   </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 114          Favorites.ICON_PACKAGE,            // 9                                                                   </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 115          Favorites.ICON_RESOURCE,           // 10                                                                  </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 116          Favorites.ICON_TYPE,               // 11                                                                  </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 117          Favorites.ITEM_TYPE,               // 12                                                                  </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 118          Favorites.SCREEN,                  // 13                                                                  </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 119          Favorites.SPANX,                   // 14                                                                  </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 120          Favorites.SPANY,                   // 15                                                                  </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 121          Favorites.TITLE,                   // 16                                                                  </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 122          Favorites.PROFILE_ID,              // 17                                                                  </span>
<span class="8195666479774249088" onmouseenter="enter('8195666479774249088');" onmouseout="out('8195666479774249088');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +        Favorites.RANK,                    // 18                                                                  </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 124      };                                                                                                            </span>
<span  style=""> 125                                                                                                                    </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 126      private static final int ID_INDEX = 0;                                                                        </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 127      private static final int ID_MODIFIED = 1;                                                                     </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 128      private static final int INTENT_INDEX = 2;                                                                    </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 129      private static final int APPWIDGET_PROVIDER_INDEX = 3;                                                        </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 130      private static final int APPWIDGET_ID_INDEX = 4;                                                              </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 131      private static final int CELLX_INDEX = 5;                                                                     </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 132      private static final int CELLY_INDEX = 6;                                                                     </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 133      private static final int CONTAINER_INDEX = 7;                                                                 </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 134      private static final int ICON_INDEX = 8;                                                                      </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 135      private static final int ICON_PACKAGE_INDEX = 9;                                                              </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 136      private static final int ICON_RESOURCE_INDEX = 10;                                                            </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 137      private static final int ICON_TYPE_INDEX = 11;                                                                </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 138      private static final int ITEM_TYPE_INDEX = 12;                                                                </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 139      private static final int SCREEN_INDEX = 13;                                                                   </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 140      private static final int SPANX_INDEX = 14;                                                                    </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 141      private static final int SPANY_INDEX = 15;                                                                    </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 142      private static final int TITLE_INDEX = 16;                                                                    </span>
<span class="-9020064880382451057" onmouseenter="enter('-9020064880382451057');" onmouseout="out('-9020064880382451057');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +    private static final int RANK_INDEX = 18;                                                                     </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 145      private static final String[] SCREEN_PROJECTION = {                                                           </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 146          WorkspaceScreens._ID,              // 0                                                                   </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 147          WorkspaceScreens.MODIFIED,         // 1                                                                   </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 148          WorkspaceScreens.SCREEN_RANK       // 2                                                                   </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 149      };                                                                                                            </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 151      private static final int SCREEN_RANK_INDEX = 2;                                                               </span>
<span  style=""> 152                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -    private final Context mContext;                                                                               </span>
<span class="7768295683460392373" onmouseenter="enter('7768295683460392373');" onmouseout="out('7768295683460392373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +    @Thunk final Context mContext;                                                                                </span>
<span class="322687894047159710" onmouseenter="enter('322687894047159710');" onmouseout="out('322687894047159710');" style=""> 155      private final HashSet&lt;String&gt; mExistingKeys;                                                                  </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 156      private final ArrayList&lt;Key&gt; mKeys;                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -                                                                                                                  </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -    private IconCache mIconCache;                                                                                 </span>
<span class="-6664428779349892399" onmouseenter="enter('-6664428779349892399');" onmouseout="out('-6664428779349892399');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +    private final ItemTypeMatcher[] mItemTypeMatchers;                                                            </span>
<span class="9149998677632156297" onmouseenter="enter('9149998677632156297');" onmouseout="out('9149998677632156297');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +    private final long mUserSerial;                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                                                                                                                  </span>
<span class="-4529726336093832969" onmouseenter="enter('-4529726336093832969');" onmouseout="out('-4529726336093832969');" style=""> 162      private BackupManager mBackupManager;                                                                         </span>
<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -    private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                             </span>
<span class="6106973069472465032" onmouseenter="enter('6106973069472465032');" onmouseout="out('6106973069472465032');" style=""> 164      private byte[] mBuffer = new byte[512];                                                                       </span>
<span class="6468110517985033863" onmouseenter="enter('6468110517985033863');" onmouseout="out('6468110517985033863');" style=""> 165      private long mLastBackupRestoreTime;                                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -                                                                                                                  </span>
<span class="-6659096482642381235" onmouseenter="enter('-6659096482642381235');" onmouseout="out('-6659096482642381235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -    private DeviceProfieData mCurrentProfile;                                                                     </span>
<span class="-24454894373626067" onmouseenter="enter('-24454894373626067');" onmouseout="out('-24454894373626067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +    private boolean mBackupDataWasUpdated;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                                                                                                                  </span>
<span class="-3446390922171092190" onmouseenter="enter('-3446390922171092190');" onmouseout="out('-3446390922171092190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +    private IconCache mIconCache;                                                                                 </span>
<span class="-3500910367670014789" onmouseenter="enter('-3500910367670014789');" onmouseout="out('-3500910367670014789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +    private DeviceProfieData mDeviceProfileData;                                                                  </span>
<span class="-7868009434057786161" onmouseenter="enter('-7868009434057786161');" onmouseout="out('-7868009434057786161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +    private InvariantDeviceProfile mIdp;                                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +                                                                                                                  </span>
<span class="8277982309001466181" onmouseenter="enter('8277982309001466181');" onmouseout="out('8277982309001466181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +    DeviceProfieData migrationCompatibleProfileData;                                                              </span>
<span class="324588424384202565" onmouseenter="enter('324588424384202565');" onmouseout="out('324588424384202565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +    HashSet&lt;String&gt; widgetSizes = new HashSet&lt;&gt;();                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                                                                                                                  </span>
<span class="-1537547605236866447" onmouseenter="enter('-1537547605236866447');" onmouseout="out('-1537547605236866447');" style=""> 177      boolean restoreSuccessful;                                                                                    </span>
<span class="-5895164545870736358" onmouseenter="enter('-5895164545870736358');" onmouseout="out('-5895164545870736358');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +    int restoredBackupVersion = 1;                                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                                                                                                                  </span>
<span class="4744147174059046892" onmouseenter="enter('4744147174059046892');" onmouseout="out('4744147174059046892');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +    // When migrating from a device which different hotseat configuration, the icons are shifted                  </span>
<span class="-3936955316846306336" onmouseenter="enter('-3936955316846306336');" onmouseout="out('-3936955316846306336');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +    // to center along the new all-apps icon.                                                                     </span>
<span class="309766951368773182" onmouseenter="enter('309766951368773182');" onmouseout="out('309766951368773182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +    private int mHotseatShift = 0;                                                                                </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 184      public LauncherBackupHelper(Context context) {                                                                </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 185          mContext = context;                                                                                       </span>
<span class="-8099871769387608407" onmouseenter="enter('-8099871769387608407');" onmouseout="out('-8099871769387608407');" style=""> 186          mExistingKeys = new HashSet&lt;String&gt;();                                                                    </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 187          mKeys = new ArrayList&lt;Key&gt;();                                                                             </span>
<span class="-5130888860931967184" onmouseenter="enter('-5130888860931967184');" onmouseout="out('-5130888860931967184');" style=""> 188          restoreSuccessful = true;                                                                                 </span>
<span class="-2642761737959358353" onmouseenter="enter('-2642761737959358353');" onmouseout="out('-2642761737959358353');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +        mItemTypeMatchers = new ItemTypeMatcher[CommonAppTypeParser.SUPPORTED_TYPE_COUNT];                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                                                                                                                  </span>
<span class="8272328117098122260" onmouseenter="enter('8272328117098122260');" onmouseout="out('8272328117098122260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +        UserManagerCompat userManager = UserManagerCompat.getInstance(mContext);                                  </span>
<span class="8300382124285307409" onmouseenter="enter('8300382124285307409');" onmouseout="out('8300382124285307409');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +        mUserSerial = userManager.getSerialNumberForUser(UserHandleCompat.myUserHandle());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span  style=""> 194                                                                                                                    </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 195      private void dataChanged() {                                                                                  </span>
<span class="-4187983950524179546" onmouseenter="enter('-4187983950524179546');" onmouseout="out('-4187983950524179546');" style=""> 196          if (mBackupManager == null) {                                                                             </span>
<span class="-1768236204051084651" onmouseenter="enter('-1768236204051084651');" onmouseout="out('-1768236204051084651');" style=""> 197              mBackupManager = new BackupManager(mContext);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198          }                                                                                                         </span>
<span class="-7885795710318889161" onmouseenter="enter('-7885795710318889161');" onmouseout="out('-7885795710318889161');" style=""> 199          mBackupManager.dataChanged();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200      }                                                                                                             </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-4749665679264578391" onmouseenter="enter('-4749665679264578391');" onmouseout="out('-4749665679264578391');" style=""> 202      private void applyJournal(Journal journal) {                                                                  </span>
<span class="-712450943307932739" onmouseenter="enter('-712450943307932739');" onmouseout="out('-712450943307932739');" style=""> 203          mLastBackupRestoreTime = journal.t;                                                                       </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 204          mExistingKeys.clear();                                                                                    </span>
<span class="-6405264292095755109" onmouseenter="enter('-6405264292095755109');" onmouseout="out('-6405264292095755109');" style=""> 205          if (journal.key != null) {                                                                                </span>
<span class="1392354685911314157" onmouseenter="enter('1392354685911314157');" onmouseout="out('1392354685911314157');" style=""> 206              for (Key key : journal.key) {                                                                         </span>
<span class="364228769796090082" onmouseenter="enter('364228769796090082');" onmouseout="out('364228769796090082');" style=""> 207                  mExistingKeys.add(keyToBackupKey(key));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span class="3666831718712279360" onmouseenter="enter('3666831718712279360');" onmouseout="out('3666831718712279360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +        restoredBackupVersion = journal.backupVersion;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211      }                                                                                                             </span>
<span  style=""> 212                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 213      /**                                                                                                           </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 214       * Back up launcher data so we can restore the user&#x27;s state on a new device.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 215       *                                                                                                            </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 216       * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 217       *                                                                                                            </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 218       * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 219       *                                                                                                            </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 220       * @param oldState notes from the last backup                                                                 </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 221       * @param data incremental key/value pairs to persist off-device                                              </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 222       * @param newState notes for the next backup                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 223       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 224      @Override                                                                                                     </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 225      public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                               </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 226              ParcelFileDescriptor newState) {                                                                      </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 227          if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span  style=""> 228                                                                                                                    </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 229          Journal in = readJournal(oldState);                                                                       </span>
<span class="-5265833691069193027" onmouseenter="enter('-5265833691069193027');" onmouseout="out('-5265833691069193027');" style=""> 230          if (!launcherIsReady()) {                                                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +            dataChanged();                                                                                        </span>
<span class="-5694957392555050138" onmouseenter="enter('-5694957392555050138');" onmouseout="out('-5694957392555050138');" style=""> 232              // Perform backup later.                                                                              </span>
<span class="-1157156644550081771" onmouseenter="enter('-1157156644550081771');" onmouseout="out('-1157156644550081771');" style=""> 233              writeJournal(newState, in);                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 234              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                                                                                                                  </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +        if (mDeviceProfileData == null) {                                                                         </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +            LauncherAppState app = LauncherAppState.getInstance();                                                </span>
<span class="-822483714686965642" onmouseenter="enter('-822483714686965642');" onmouseout="out('-822483714686965642');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +            mIdp = app.getInvariantDeviceProfile();                                                               </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +            mDeviceProfileData = initDeviceProfileData(mIdp);                                                     </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +            mIconCache = app.getIconCache();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                                                                                                                  </span>
<span class="5716020795731800698" onmouseenter="enter('5716020795731800698');" onmouseout="out('5716020795731800698');" style=""> 244          Log.v(TAG, &quot;lastBackupTime = &quot; + in.t);                                                                   </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 245          mKeys.clear();                                                                                            </span>
<span class="-4595717776411391172" onmouseenter="enter('-4595717776411391172');" onmouseout="out('-4595717776411391172');" style=""> 246          applyJournal(in);                                                                                         </span>
<span  style=""> 247                                                                                                                    </span>
<span class="5103885382674118963" onmouseenter="enter('5103885382674118963');" onmouseout="out('5103885382674118963');" style=""> 248          // Record the time before performing backup so that entries edited while the backup                       </span>
<span class="8140928668753669154" onmouseenter="enter('8140928668753669154');" onmouseout="out('8140928668753669154');" style=""> 249          // was going on, do not get missed in next backup.                                                        </span>
<span class="-3033254580710415370" onmouseenter="enter('-3033254580710415370');" onmouseout="out('-3033254580710415370');" style=""> 250          long newBackupTime = System.currentTimeMillis();                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 251 -                                                                                                                  </span>
<span class="-3240009759834753248" onmouseenter="enter('-3240009759834753248');" onmouseout="out('-3240009759834753248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +        mBackupDataWasUpdated = false;                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 253          try {                                                                                                     </span>
<span class="2367247575072300559" onmouseenter="enter('2367247575072300559');" onmouseout="out('2367247575072300559');" style=""> 254              backupFavorites(data);                                                                                </span>
<span class="-6154611946262874567" onmouseenter="enter('-6154611946262874567');" onmouseout="out('-6154611946262874567');" style=""> 255              backupScreens(data);                                                                                  </span>
<span class="-2297081874214881528" onmouseenter="enter('-2297081874214881528');" onmouseout="out('-2297081874214881528');" style=""> 256              backupIcons(data);                                                                                    </span>
<span class="-3217091058512889644" onmouseenter="enter('-3217091058512889644');" onmouseout="out('-3217091058512889644');" style=""> 257              backupWidgets(data);                                                                                  </span>
<span  style=""> 258                                                                                                                    </span>
<span class="-887863480756312662" onmouseenter="enter('-887863480756312662');" onmouseout="out('-887863480756312662');" style=""> 259              // Delete any key which still exist in the old backup, but is not valid anymore.                      </span>
<span class="1806163788205171865" onmouseenter="enter('1806163788205171865');" onmouseout="out('1806163788205171865');" style=""> 260              HashSet&lt;String&gt; validKeys = new HashSet&lt;String&gt;();                                                    </span>
<span class="6947914168121515905" onmouseenter="enter('6947914168121515905');" onmouseout="out('6947914168121515905');" style=""> 261              for (Key key : mKeys) {                                                                               </span>
<span class="6507870889450716199" onmouseenter="enter('6507870889450716199');" onmouseout="out('6507870889450716199');" style=""> 262                  validKeys.add(keyToBackupKey(key));                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263              }                                                                                                     </span>
<span class="275595780582014239" onmouseenter="enter('275595780582014239');" onmouseout="out('275595780582014239');" style=""> 264              mExistingKeys.removeAll(validKeys);                                                                   </span>
<span  style=""> 265                                                                                                                    </span>
<span class="-6732135123636414527" onmouseenter="enter('-6732135123636414527');" onmouseout="out('-6732135123636414527');" style=""> 266              // Delete anything left in the existing keys.                                                         </span>
<span class="-8057776950468218811" onmouseenter="enter('-8057776950468218811');" onmouseout="out('-8057776950468218811');" style=""> 267              for (String deleted: mExistingKeys) {                                                                 </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style=""> 268                  if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                      </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 269                  data.writeEntityHeader(deleted, -1);                                                              </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +                mBackupDataWasUpdated = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271              }                                                                                                     </span>
<span  style=""> 272                                                                                                                    </span>
<span class="-9184538687471535694" onmouseenter="enter('-9184538687471535694');" onmouseout="out('-9184538687471535694');" style=""> 273              mExistingKeys.clear();                                                                                </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -            mLastBackupRestoreTime = newBackupTime;                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -                                                                                                                  </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 276 -            // We store the journal at two places.                                                                </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 277 -            //   1) Storing it in newState allows us to do partial backups by comparing old state                 </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 278 -            //   2) Storing it in backup data allows us to validate keys during restore                           </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 279 -            Journal state = getCurrentStateJournal();                                                             </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 280 -            writeRowToBackup(JOURNAL_KEY, state, data);                                                           </span>
<span class="-782803333523865970" onmouseenter="enter('-782803333523865970');" onmouseout="out('-782803333523865970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +            if (!mBackupDataWasUpdated) {                                                                         </span>
<span class="-5350582183772445738" onmouseenter="enter('-5350582183772445738');" onmouseout="out('-5350582183772445738');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +                // Check if any metadata has changed                                                              </span>
<span class="4456255566361909194" onmouseenter="enter('4456255566361909194');" onmouseout="out('4456255566361909194');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +                mBackupDataWasUpdated = (in.profile == null)                                                      </span>
<span class="3696867724938300008" onmouseenter="enter('3696867724938300008');" onmouseout="out('3696867724938300008');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +                        || !Arrays.equals(DeviceProfieData.toByteArray(in.profile),                               </span>
<span class="-526865330972865914" onmouseenter="enter('-526865330972865914');" onmouseout="out('-526865330972865914');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +                            DeviceProfieData.toByteArray(mDeviceProfileData))                                     </span>
<span class="-3212861652554024645" onmouseenter="enter('-3212861652554024645');" onmouseout="out('-3212861652554024645');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +                        || (in.backupVersion != BACKUP_VERSION)                                                   </span>
<span class="3693115347738857050" onmouseenter="enter('3693115347738857050');" onmouseout="out('3693115347738857050');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +                        || (in.appVersion != getAppVersion());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +                                                                                                                  </span>
<span class="6455337319713156507" onmouseenter="enter('6455337319713156507');" onmouseout="out('6455337319713156507');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +            if (mBackupDataWasUpdated) {                                                                          </span>
<span class="6177157194240418511" onmouseenter="enter('6177157194240418511');" onmouseout="out('6177157194240418511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +                mLastBackupRestoreTime = newBackupTime;                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +                                                                                                                  </span>
<span class="-6482734242992137364" onmouseenter="enter('-6482734242992137364');" onmouseout="out('-6482734242992137364');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +                // We store the journal at two places.                                                            </span>
<span class="6203130427149262723" onmouseenter="enter('6203130427149262723');" onmouseout="out('6203130427149262723');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +                //   1) Storing it in newState allows us to do partial backups by comparing old state             </span>
<span class="6908595649316169476" onmouseenter="enter('6908595649316169476');" onmouseout="out('6908595649316169476');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +                //   2) Storing it in backup data allows us to validate keys during restore                       </span>
<span class="-4229641414511008920" onmouseenter="enter('-4229641414511008920');" onmouseout="out('-4229641414511008920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +                Journal state = getCurrentStateJournal();                                                         </span>
<span class="-4974713521318693958" onmouseenter="enter('-4974713521318693958');" onmouseout="out('-4974713521318693958');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +                writeRowToBackup(JOURNAL_KEY, state, data);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +            } else {                                                                                              </span>
<span class="6846529623619819273" onmouseenter="enter('6846529623619819273');" onmouseout="out('6846529623619819273');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +                if (DEBUG) Log.d(TAG, &quot;Nothing was written during backup&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 301          } catch (IOException e) {                                                                                 </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 302              Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303          }                                                                                                         </span>
<span  style=""> 304                                                                                                                    </span>
<span class="-4878422747440785219" onmouseenter="enter('-4878422747440785219');" onmouseout="out('-4878422747440785219');" style=""> 305          writeNewStateDescription(newState);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 308      /**                                                                                                           </span>
<span class="1274145306210220133" onmouseenter="enter('1274145306210220133');" onmouseout="out('1274145306210220133');" style=""> 309       * @return true if the backup corresponding to oldstate can be successfully applied                           </span>
<span class="5325743025880775715" onmouseenter="enter('5325743025880775715');" onmouseout="out('5325743025880775715');" style=""> 310       * to this device.                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 311       */                                                                                                           </span>
<span class="-1497567008492905970" onmouseenter="enter('-1497567008492905970');" onmouseout="out('-1497567008492905970');" style=""> 312      private boolean isBackupCompatible(Journal oldState) {                                                        </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -        DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -                                                                                                                  </span>
<span class="-7056523103850531928" onmouseenter="enter('-7056523103850531928');" onmouseout="out('-7056523103850531928');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +        DeviceProfieData currentProfile = mDeviceProfileData;                                                     </span>
<span class="2186134198263207905" onmouseenter="enter('2186134198263207905');" onmouseout="out('2186134198263207905');" style=""> 316          DeviceProfieData oldProfile = oldState.profile;                                                           </span>
<span  style=""> 317                                                                                                                    </span>
<span class="3516483988150785854" onmouseenter="enter('3516483988150785854');" onmouseout="out('3516483988150785854');" style=""> 318          if (oldProfile == null || oldProfile.desktopCols == 0) {                                                  </span>
<span class="-3362532486741282817" onmouseenter="enter('-3362532486741282817');" onmouseout="out('-3362532486741282817');" style=""> 319              // Profile info is not valid, ignore the check.                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 320              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321          }                                                                                                         </span>
<span  style=""> 322                                                                                                                    </span>
<span class="-3969248474555793010" onmouseenter="enter('-3969248474555793010');" onmouseout="out('-3969248474555793010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -        boolean isHotsetCompatible = false;                                                                       </span>
<span class="458635177486396964" onmouseenter="enter('458635177486396964');" onmouseout="out('458635177486396964');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +        boolean isHotseatCompatible = false;                                                                      </span>
<span class="7555667768902424746" onmouseenter="enter('7555667768902424746');" onmouseout="out('7555667768902424746');" style=""> 325          if (currentProfile.allappsRank &gt;= oldProfile.hotseatCount) {                                              </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -            isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -        }                                                                                                         </span>
<span class="-5234148737954946799" onmouseenter="enter('-5234148737954946799');" onmouseout="out('-5234148737954946799');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -        if ((currentProfile.hotseatCount &gt;= oldProfile.hotseatCount) &amp;&amp;                                           </span>
<span class="-4785593469925988823" onmouseenter="enter('-4785593469925988823');" onmouseout="out('-4785593469925988823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -                (currentProfile.allappsRank == oldProfile.allappsRank)) {                                         </span>
<span class="6442776247760200548" onmouseenter="enter('6442776247760200548');" onmouseout="out('6442776247760200548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -            isHotsetCompatible = true;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -                                                                                                                  </span>
<span class="-6996782978604961637" onmouseenter="enter('-6996782978604961637');" onmouseout="out('-6996782978604961637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -        return isHotsetCompatible &amp;&amp; (currentProfile.desktopCols &gt;= oldProfile.desktopCols)                       </span>
<span class="4824114787736852304" onmouseenter="enter('4824114787736852304');" onmouseout="out('4824114787736852304');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -                &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows);                                        </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +            isHotseatCompatible = true;                                                                           </span>
<span class="6856306724544172936" onmouseenter="enter('6856306724544172936');" onmouseout="out('6856306724544172936');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +            mHotseatShift = 0;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +                                                                                                                  </span>
<span class="2142366465478542154" onmouseenter="enter('2142366465478542154');" onmouseout="out('2142366465478542154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +        if ((currentProfile.allappsRank &gt;= oldProfile.allappsRank)                                                </span>
<span class="-6632599495891550017" onmouseenter="enter('-6632599495891550017');" onmouseout="out('-6632599495891550017');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +                &amp;&amp; ((currentProfile.hotseatCount - currentProfile.allappsRank) &gt;=                                 </span>
<span class="8568226590607864890" onmouseenter="enter('8568226590607864890');" onmouseout="out('8568226590607864890');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +                        (oldProfile.hotseatCount - oldProfile.allappsRank))) {                                    </span>
<span class="2270742623811584810" onmouseenter="enter('2270742623811584810');" onmouseout="out('2270742623811584810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +            // There is enough space on both sides of the hotseat.                                                </span>
<span class="2095381343861464956" onmouseenter="enter('2095381343861464956');" onmouseout="out('2095381343861464956');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +            isHotseatCompatible = true;                                                                           </span>
<span class="5163576225814391245" onmouseenter="enter('5163576225814391245');" onmouseout="out('5163576225814391245');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +            mHotseatShift = currentProfile.allappsRank - oldProfile.allappsRank;                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +                                                                                                                  </span>
<span class="-1017020977077293413" onmouseenter="enter('-1017020977077293413');" onmouseout="out('-1017020977077293413');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +        if (!isHotseatCompatible) {                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +        }                                                                                                         </span>
<span class="-8412024600313814265" onmouseenter="enter('-8412024600313814265');" onmouseout="out('-8412024600313814265');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 350 +        if ((currentProfile.desktopCols &gt;= oldProfile.desktopCols)                                                </span>
<span class="5768651476481696104" onmouseenter="enter('5768651476481696104');" onmouseout="out('5768651476481696104');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 351 +                &amp;&amp; (currentProfile.desktopRows &gt;= oldProfile.desktopRows)) {                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +            return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 353 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 354 +                                                                                                                  </span>
<span class="4881414489005539302" onmouseenter="enter('4881414489005539302');" onmouseout="out('4881414489005539302');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 355 +        if (MigrateFromRestoreTask.ENABLED &amp;&amp;                                                                     </span>
<span class="990686264093981039" onmouseenter="enter('990686264093981039');" onmouseout="out('990686264093981039');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 356 +                (oldProfile.desktopCols - currentProfile.desktopCols &lt;= 1) &amp;&amp;                                     </span>
<span class="-4956046918292613771" onmouseenter="enter('-4956046918292613771');" onmouseout="out('-4956046918292613771');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 357 +                (oldProfile.desktopRows - currentProfile.desktopRows &lt;= 1)) {                                     </span>
<span class="-7375128792855769034" onmouseenter="enter('-7375128792855769034');" onmouseout="out('-7375128792855769034');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 358 +            // Allow desktop migration when row and/or column count contracts by 1.                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 359 +                                                                                                                  </span>
<span class="-3339830446988550734" onmouseenter="enter('-3339830446988550734');" onmouseout="out('-3339830446988550734');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +            migrationCompatibleProfileData = initDeviceProfileData(mIdp);                                         </span>
<span class="1832232547208942697" onmouseenter="enter('1832232547208942697');" onmouseout="out('1832232547208942697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 361 +            migrationCompatibleProfileData.desktopCols = oldProfile.desktopCols;                                  </span>
<span class="539436906242464602" onmouseenter="enter('539436906242464602');" onmouseout="out('539436906242464602');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 362 +            migrationCompatibleProfileData.desktopRows = oldProfile.desktopRows;                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 363 +            return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 364 +        }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366      }                                                                                                             </span>
<span  style=""> 367                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 368      /**                                                                                                           </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 369       * Restore launcher configuration from the restored data stream.                                              </span>
<span class="-1856945508747740588" onmouseenter="enter('-1856945508747740588');" onmouseout="out('-1856945508747740588');" style=""> 370       * It assumes that the keys will arrive in lexical order. So if the journal was present in the                </span>
<span class="2411910135463290927" onmouseenter="enter('2411910135463290927');" onmouseout="out('2411910135463290927');" style=""> 371       * backup, it should arrive first.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 372       *                                                                                                            </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 373       * @param data the key/value pair from the server                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 374       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 375      @Override                                                                                                     </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 376      public void restoreEntity(BackupDataInputStream data) {                                                       </span>
<span class="-127886961654618200" onmouseenter="enter('-127886961654618200');" onmouseout="out('-127886961654618200');" style=""> 377          if (!restoreSuccessful) {                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 378              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +                                                                                                                  </span>
<span class="5270919219230505120" onmouseenter="enter('5270919219230505120');" onmouseout="out('5270919219230505120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +        if (mDeviceProfileData == null) {                                                                         </span>
<span class="-7365949463446456385" onmouseenter="enter('-7365949463446456385');" onmouseout="out('-7365949463446456385');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +            // This call does not happen on a looper thread. So LauncherAppState                                  </span>
<span class="7742081762032358869" onmouseenter="enter('7742081762032358869');" onmouseout="out('7742081762032358869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +            // can&#x27;t be created . Instead initialize required dependencies directly.                              </span>
<span class="-7037594543034166950" onmouseenter="enter('-7037594543034166950');" onmouseout="out('-7037594543034166950');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +            mIdp = new InvariantDeviceProfile(mContext);                                                          </span>
<span class="-966904913968782788" onmouseenter="enter('-966904913968782788');" onmouseout="out('-966904913968782788');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +            mDeviceProfileData = initDeviceProfileData(mIdp);                                                     </span>
<span class="-5064962813407388257" onmouseenter="enter('-5064962813407388257');" onmouseout="out('-5064962813407388257');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +            mIconCache = new IconCache(mContext, mIdp);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387          }                                                                                                         </span>
<span  style=""> 388                                                                                                                    </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 389          int dataSize = data.size();                                                                               </span>
<span class="-1256073701717849120" onmouseenter="enter('-1256073701717849120');" onmouseout="out('-1256073701717849120');" style=""> 390          if (mBuffer.length &lt; dataSize) {                                                                          </span>
<span class="-5319326250757977160" onmouseenter="enter('-5319326250757977160');" onmouseout="out('-5319326250757977160');" style=""> 391              mBuffer = new byte[dataSize];                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 393          try {                                                                                                     </span>
<span class="5901243457524828252" onmouseenter="enter('5901243457524828252');" onmouseout="out('5901243457524828252');" style=""> 394              int bytesRead = data.read(mBuffer, 0, dataSize);                                                      </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 395              if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);                        </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 396              String backupKey = data.getKey();                                                                     </span>
<span  style=""> 397                                                                                                                    </span>
<span class="-5702566428559028312" onmouseenter="enter('-5702566428559028312');" onmouseout="out('-5702566428559028312');" style=""> 398              if (JOURNAL_KEY.equals(backupKey)) {                                                                  </span>
<span class="861480520560348620" onmouseenter="enter('861480520560348620');" onmouseout="out('861480520560348620');" style=""> 399                  if (VERBOSE) Log.v(TAG, &quot;Journal entry restored&quot;);                                                </span>
<span class="6015988213121749225" onmouseenter="enter('6015988213121749225');" onmouseout="out('6015988213121749225');" style=""> 400                  if (!mKeys.isEmpty()) {                                                                           </span>
<span class="-1319751021517979145" onmouseenter="enter('-1319751021517979145');" onmouseout="out('-1319751021517979145');" style=""> 401                      // We received the journal key after a restore key.                                           </span>
<span class="-6413448608388632775" onmouseenter="enter('-6413448608388632775');" onmouseout="out('-6413448608388632775');" style=""> 402                      Log.wtf(TAG, keyToBackupKey(mKeys.get(0)) + &quot; received after &quot; + JOURNAL_KEY);                </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style=""> 403                      restoreSuccessful = false;                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 404                      return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405                  }                                                                                                 </span>
<span  style=""> 406                                                                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 407                  Journal journal = new Journal();                                                                  </span>
<span class="-7040767486787391901" onmouseenter="enter('-7040767486787391901');" onmouseout="out('-7040767486787391901');" style=""> 408                  MessageNano.mergeFrom(journal, readCheckedBytes(mBuffer, dataSize));                              </span>
<span class="8578417762252911273" onmouseenter="enter('8578417762252911273');" onmouseout="out('8578417762252911273');" style=""> 409                  applyJournal(journal);                                                                            </span>
<span class="-921427634741341201" onmouseenter="enter('-921427634741341201');" onmouseout="out('-921427634741341201');" style=""> 410                  restoreSuccessful = isBackupCompatible(journal);                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 411                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412              }                                                                                                     </span>
<span  style=""> 413                                                                                                                    </span>
<span class="-8956282678842110456" onmouseenter="enter('-8956282678842110456');" onmouseout="out('-8956282678842110456');" style=""> 414              if (!mExistingKeys.isEmpty() &amp;&amp; !mExistingKeys.contains(backupKey)) {                                 </span>
<span class="-4032373622926454622" onmouseenter="enter('-4032373622926454622');" onmouseout="out('-4032373622926454622');" style=""> 415                  if (DEBUG) Log.e(TAG, &quot;Ignoring key not present in the backup state &quot; + backupKey);               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 416                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417              }                                                                                                     </span>
<span class="-4802392256467780093" onmouseenter="enter('-4802392256467780093');" onmouseout="out('-4802392256467780093');" style=""> 418              Key key = backupKeyToKey(backupKey);                                                                  </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 419              mKeys.add(key);                                                                                       </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 420              switch (key.type) {                                                                                   </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 421                  case Key.FAVORITE:                                                                                </span>
<span class="5708123153318281844" onmouseenter="enter('5708123153318281844');" onmouseout="out('5708123153318281844');" style=""> 422                      restoreFavorite(key, mBuffer, dataSize);                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 423                      break;                                                                                        </span>
<span  style=""> 424                                                                                                                    </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 425                  case Key.SCREEN:                                                                                  </span>
<span class="7490697766628818953" onmouseenter="enter('7490697766628818953');" onmouseout="out('7490697766628818953');" style=""> 426                      restoreScreen(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 427                      break;                                                                                        </span>
<span  style=""> 428                                                                                                                    </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 429                  case Key.ICON:                                                                                    </span>
<span class="948753710339894928" onmouseenter="enter('948753710339894928');" onmouseout="out('948753710339894928');" style=""> 430                      restoreIcon(key, mBuffer, dataSize);                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 431                      break;                                                                                        </span>
<span  style=""> 432                                                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 433                  case Key.WIDGET:                                                                                  </span>
<span class="-1253645818307977810" onmouseenter="enter('-1253645818307977810');" onmouseout="out('-1253645818307977810');" style=""> 434                      restoreWidget(key, mBuffer, dataSize);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 435                      break;                                                                                        </span>
<span  style=""> 436                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 437                  default:                                                                                          </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 438                      Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                                       </span>
<span class="-5305034080181796308" onmouseenter="enter('-5305034080181796308');" onmouseout="out('-5305034080181796308');" style=""> 439                      mKeys.remove(key);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 440                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 442          } catch (IOException e) {                                                                                 </span>
<span class="2062758611826441743" onmouseenter="enter('2062758611826441743');" onmouseout="out('2062758611826441743');" style=""> 443              Log.w(TAG, &quot;ignoring unparsable backup entry&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445      }                                                                                                             </span>
<span  style=""> 446                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 447      /**                                                                                                           </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 448       * Record the restore state for the next backup.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 449       *                                                                                                            </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 450       * @param newState notes about the backup state after restore.                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 451       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 452      @Override                                                                                                     </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 453      public void writeNewStateDescription(ParcelFileDescriptor newState) {                                         </span>
<span class="1209596619612355663" onmouseenter="enter('1209596619612355663');" onmouseout="out('1209596619612355663');" style=""> 454          writeJournal(newState, getCurrentStateJournal());                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455      }                                                                                                             </span>
<span  style=""> 456                                                                                                                    </span>
<span class="5361066547065430271" onmouseenter="enter('5361066547065430271');" onmouseout="out('5361066547065430271');" style=""> 457      private Journal getCurrentStateJournal() {                                                                    </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 458          Journal journal = new Journal();                                                                          </span>
<span class="2668005706983433530" onmouseenter="enter('2668005706983433530');" onmouseout="out('2668005706983433530');" style=""> 459          journal.t = mLastBackupRestoreTime;                                                                       </span>
<span class="-1944214630047212676" onmouseenter="enter('-1944214630047212676');" onmouseout="out('-1944214630047212676');" style=""> 460          journal.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                          </span>
<span class="2856231288986708124" onmouseenter="enter('2856231288986708124');" onmouseout="out('2856231288986708124');" style=""> 461          journal.appVersion = getAppVersion();                                                                     </span>
<span class="-107765399740345714" onmouseenter="enter('-107765399740345714');" onmouseout="out('-107765399740345714');" style=""> 462          journal.backupVersion = BACKUP_VERSION;                                                                   </span>
<span class="-6030934345780896454" onmouseenter="enter('-6030934345780896454');" onmouseout="out('-6030934345780896454');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -        journal.profile = getDeviceProfieData();                                                                  </span>
<span class="-7715415502309333222" onmouseenter="enter('-7715415502309333222');" onmouseout="out('-7715415502309333222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +        journal.profile = mDeviceProfileData;                                                                     </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 465          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466      }                                                                                                             </span>
<span  style=""> 467                                                                                                                    </span>
<span class="-8498234956299820347" onmouseenter="enter('-8498234956299820347');" onmouseout="out('-8498234956299820347');" style=""> 468      private int getAppVersion() {                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 469          try {                                                                                                     </span>
<span class="2149968715759047730" onmouseenter="enter('2149968715759047730');" onmouseout="out('2149968715759047730');" style=""> 470              return mContext.getPackageManager()                                                                   </span>
<span class="-7626352549388476422" onmouseenter="enter('-7626352549388476422');" onmouseout="out('-7626352549388476422');" style=""> 471                      .getPackageInfo(mContext.getPackageName(), 0).versionCode;                                    </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style=""> 472          } catch (NameNotFoundException e) {                                                                       </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 473              return 0;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475      }                                                                                                             </span>
<span  style=""> 476                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -    /**                                                                                                           </span>
<span class="-4501492075935595010" onmouseenter="enter('-4501492075935595010');" onmouseout="out('-4501492075935595010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -     * @return the current device profile information.                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -     */                                                                                                           </span>
<span class="4124629983355258626" onmouseenter="enter('4124629983355258626');" onmouseout="out('4124629983355258626');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -    private DeviceProfieData getDeviceProfieData() {                                                              </span>
<span class="-7376286606070162099" onmouseenter="enter('-7376286606070162099');" onmouseout="out('-7376286606070162099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -        if (mCurrentProfile != null) {                                                                            </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 482 -            return mCurrentProfile;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 483 -        }                                                                                                         </span>
<span class="-5497719505817004004" onmouseenter="enter('-5497719505817004004');" onmouseout="out('-5497719505817004004');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 484 -        final Context applicationContext = mContext.getApplicationContext();                                      </span>
<span class="7980813194196555392" onmouseenter="enter('7980813194196555392');" onmouseout="out('7980813194196555392');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 485 -        DeviceProfile profile = LauncherAppState.createDynamicGrid(applicationContext, null)                      </span>
<span class="-5938220650159761744" onmouseenter="enter('-5938220650159761744');" onmouseout="out('-5938220650159761744');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 486 -                .getDeviceProfile();                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 487 -                                                                                                                  </span>
<span class="-8088032308844031335" onmouseenter="enter('-8088032308844031335');" onmouseout="out('-8088032308844031335');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 488 -        mCurrentProfile = new DeviceProfieData();                                                                 </span>
<span class="7442338639987606524" onmouseenter="enter('7442338639987606524');" onmouseout="out('7442338639987606524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 489 -        mCurrentProfile.desktopRows = profile.numRows;                                                            </span>
<span class="-4500555851720273514" onmouseenter="enter('-4500555851720273514');" onmouseout="out('-4500555851720273514');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 490 -        mCurrentProfile.desktopCols = profile.numColumns;                                                         </span>
<span class="-3431910476829522829" onmouseenter="enter('-3431910476829522829');" onmouseout="out('-3431910476829522829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 491 -        mCurrentProfile.hotseatCount = profile.numHotseatIcons;                                                   </span>
<span class="1465841957362210064" onmouseenter="enter('1465841957362210064');" onmouseout="out('1465841957362210064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -        mCurrentProfile.allappsRank = profile.hotseatAllAppsRank;                                                 </span>
<span class="3843029335830945633" onmouseenter="enter('3843029335830945633');" onmouseout="out('3843029335830945633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -        return mCurrentProfile;                                                                                   </span>
<span class="6576363625058514055" onmouseenter="enter('6576363625058514055');" onmouseout="out('6576363625058514055');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 494 +    private DeviceProfieData initDeviceProfileData(InvariantDeviceProfile profile) {                              </span>
<span class="-2478858342839252661" onmouseenter="enter('-2478858342839252661');" onmouseout="out('-2478858342839252661');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +        DeviceProfieData data = new DeviceProfieData();                                                           </span>
<span class="-7734808685544870260" onmouseenter="enter('-7734808685544870260');" onmouseout="out('-7734808685544870260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +        data.desktopRows = profile.numRows;                                                                       </span>
<span class="-8910203890428709006" onmouseenter="enter('-8910203890428709006');" onmouseout="out('-8910203890428709006');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 497 +        data.desktopCols = profile.numColumns;                                                                    </span>
<span class="4593981134327524493" onmouseenter="enter('4593981134327524493');" onmouseout="out('4593981134327524493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 498 +        data.hotseatCount = profile.numHotseatIcons;                                                              </span>
<span class="5653132512699670336" onmouseenter="enter('5653132512699670336');" onmouseout="out('5653132512699670336');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 499 +        data.allappsRank = profile.hotseatAllAppsRank;                                                            </span>
<span class="2885311051796901480" onmouseenter="enter('2885311051796901480');" onmouseout="out('2885311051796901480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 500 +        return data;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501      }                                                                                                             </span>
<span  style=""> 502                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 503      /**                                                                                                           </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 504       * Write all modified favorites to the data stream.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 505       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 506       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 507       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 508       */                                                                                                           </span>
<span class="7789802927217882655" onmouseenter="enter('7789802927217882655');" onmouseout="out('7789802927217882655');" style=""> 509      private void backupFavorites(BackupDataOutput data) throws IOException {                                      </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 510          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 511          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 512          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 513          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 514                  getUserSelectionArg(), null, null);                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 515          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 516              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 517              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 518                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 519                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 520                  Key key = getKey(Key.FAVORITE, id);                                                               </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 521                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 522                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 523 -                if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 524 +                                                                                                                  </span>
<span class="4187503492614027377" onmouseenter="enter('4187503492614027377');" onmouseout="out('4187503492614027377');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 525 +                // Favorite proto changed in v4. Backup again if the version is old.                              </span>
<span class="-1619074712666531849" onmouseenter="enter('-1619074712666531849');" onmouseout="out('-1619074712666531849');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 526 +                if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime                    </span>
<span class="4652601050666676553" onmouseenter="enter('4652601050666676553');" onmouseout="out('4652601050666676553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 527 +                        || restoredBackupVersion &lt; 4) {                                                           </span>
<span class="8212694762147237251" onmouseenter="enter('8212694762147237251');" onmouseout="out('8212694762147237251');" style=""> 528                      writeRowToBackup(key, packFavorite(cursor), data);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 529                  } else {                                                                                          </span>
<span class="-3837846720021002444" onmouseenter="enter('-3837846720021002444');" onmouseout="out('-3837846720021002444');" style=""> 530                      if (DEBUG) Log.d(TAG, &quot;favorite already backup up: &quot; + id);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 533          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 534              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536      }                                                                                                             </span>
<span  style=""> 537                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 538      /**                                                                                                           </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 539       * Read a favorite from the stream.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 540       *                                                                                                            </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 541       * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 542       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 543       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 544       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 545       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 546       */                                                                                                           </span>
<span class="-2502704772416884024" onmouseenter="enter('-2502704772416884024');" onmouseout="out('-2502704772416884024');" style=""> 547      private void restoreFavorite(Key key, byte[] buffer, int dataSize) throws IOException {                       </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 548          if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 549          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 550                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 551                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 552          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6400903198828292123" onmouseenter="enter('6400903198828292123');" onmouseout="out('6400903198828292123');" style=""> 553          ContentValues values = unpackFavorite(buffer, dataSize);                                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 554 -        cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                                 </span>
<span class="-2714314735421273150" onmouseenter="enter('-2714314735421273150');" onmouseout="out('-2714314735421273150');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +        cr.insert(Favorites.CONTENT_URI, values);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556      }                                                                                                             </span>
<span  style=""> 557                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 558      /**                                                                                                           </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 559       * Write all modified screens to the data stream.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 560       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 561       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 562       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 563       */                                                                                                           </span>
<span class="4732364898758632244" onmouseenter="enter('4732364898758632244');" onmouseout="out('4732364898758632244');" style=""> 564      private void backupScreens(BackupDataOutput data) throws IOException {                                        </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 565          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 566          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 567          Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                                 </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 568                  null, null, null);                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 569          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 570              cursor.moveToPosition(-1);                                                                            </span>
<span class="1721282989099201486" onmouseenter="enter('1721282989099201486');" onmouseout="out('1721282989099201486');" style=""> 571              if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + mLastBackupRestoreTime);                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 572              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 573                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 574                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 575                  Key key = getKey(Key.SCREEN, id);                                                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 576                  mKeys.add(key);                                                                                   </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 577                  final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-7983395109510693260" onmouseenter="enter('-7983395109510693260');" onmouseout="out('-7983395109510693260');" style=""> 578                  if (!mExistingKeys.contains(backupKey) || updateTime &gt;= mLastBackupRestoreTime) {                 </span>
<span class="-573246198419722966" onmouseenter="enter('-573246198419722966');" onmouseout="out('-573246198419722966');" style=""> 579                      writeRowToBackup(key, packScreen(cursor), data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 580                  } else {                                                                                          </span>
<span class="-4309200868437524647" onmouseenter="enter('-4309200868437524647');" onmouseout="out('-4309200868437524647');" style=""> 581                      if (VERBOSE) Log.v(TAG, &quot;screen already backup up &quot; + id);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 582                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 583              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 584          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 585              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587      }                                                                                                             </span>
<span  style=""> 588                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 589      /**                                                                                                           </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 590       * Read a screen from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 591       *                                                                                                            </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 592       * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 593       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 594       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 595       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 596       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 597       */                                                                                                           </span>
<span class="-1794559795686181688" onmouseenter="enter('-1794559795686181688');" onmouseout="out('-1794559795686181688');" style=""> 598      private void restoreScreen(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 599          if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 600          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 601                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 602                                                                                                                    </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 603          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="6042764494466564399" onmouseenter="enter('6042764494466564399');" onmouseout="out('6042764494466564399');" style=""> 604          ContentValues values = unpackScreen(buffer, dataSize);                                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 605          cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606      }                                                                                                             </span>
<span  style=""> 607                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 608      /**                                                                                                           </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 609       * Write all the static icon resources we need to render placeholders                                         </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 610       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 611       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 612       * @param data output stream for key/value pairs                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 613       */                                                                                                           </span>
<span class="3910675463894981216" onmouseenter="enter('3910675463894981216');" onmouseout="out('3910675463894981216');" style=""> 614      private void backupIcons(BackupDataOutput data) throws IOException {                                          </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 615          // persist icons that haven&#x27;t been persisted yet                                                          </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -        if (!initializeIconCache()) {                                                                             </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -            dataChanged(); // try again later                                                                     </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -            if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -        }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 621          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 622          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 623          final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                    </span>
<span class="4135193754803164928" onmouseenter="enter('4135193754803164928');" onmouseout="out('4135193754803164928');" style=""> 624          int backupUpIconCount = 0;                                                                                </span>
<span  style=""> 625                                                                                                                    </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 626          // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 627          String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +               </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 628                  Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                             </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 629                  getUserSelectionArg();                                                                            </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 630          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 631                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 632          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 633              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 634              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 635                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 636                  final String intentDescription = cursor.getString(INTENT_INDEX);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 637                  try {                                                                                             </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 638                      Intent intent = Intent.parseUri(intentDescription, 0);                                        </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 639                      ComponentName cn = intent.getComponent();                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 640                      Key key = null;                                                                               </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 641                      String backupKey = null;                                                                      </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 642                      if (cn != null) {                                                                             </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 643                          key = getKey(Key.ICON, cn.flattenToShortString());                                        </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 644                          backupKey = keyToBackupKey(key);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 645                      } else {                                                                                      </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 646                          Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647                      }                                                                                             </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style=""> 648                      if (mExistingKeys.contains(backupKey)) {                                                      </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 649                          if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                                 </span>
<span  style=""> 650                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 651                          // remember that we already backed this up previously                                     </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 652                          mKeys.add(key);                                                                           </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 653                      } else if (backupKey != null) {                                                               </span>
<span class="-6310531343064499436" onmouseenter="enter('-6310531343064499436');" onmouseout="out('-6310531343064499436');" style=""> 654                          if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupUpIconCount);                     </span>
<span class="-7149782557861440622" onmouseenter="enter('-7149782557861440622');" onmouseout="out('-7149782557861440622');" style=""> 655                          if (backupUpIconCount &lt; MAX_ICONS_PER_PASS) {                                             </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 656                              if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                                    </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 657                              Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                               </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 658                              if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {                  </span>
<span class="-4676181089270198191" onmouseenter="enter('-4676181089270198191');" onmouseout="out('-4676181089270198191');" style=""> 659                                  writeRowToBackup(key, packIcon(dpi, icon), data);                                 </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 660                                  mKeys.add(key);                                                                   </span>
<span class="5377719919294214367" onmouseenter="enter('5377719919294214367');" onmouseout="out('5377719919294214367');" style=""> 661                                  backupUpIconCount ++;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 663                          } else {                                                                                  </span>
<span class="4246955911601526686" onmouseenter="enter('4246955911601526686');" onmouseout="out('4246955911601526686');" style=""> 664                              if (VERBOSE) Log.v(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 665                              // too many icons for this pass, request another.                                     </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 666                              dataChanged();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668                      }                                                                                             </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 669                  } catch (URISyntaxException e) {                                                                  </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 670                      Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 671                  } catch (IOException e) {                                                                         </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 672                      Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673                  }                                                                                                 </span>
<span  style=""> 674                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 676          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 677              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679      }                                                                                                             </span>
<span  style=""> 680                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 681      /**                                                                                                           </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 682       * Read an icon from the stream.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 683       *                                                                                                            </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 684       * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 685       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 686       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 687       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 688       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 689       */                                                                                                           </span>
<span class="8015788538491650348" onmouseenter="enter('8015788538491650348');" onmouseout="out('8015788538491650348');" style=""> 690      private void restoreIcon(Key key, byte[] buffer, int dataSize) throws IOException {                           </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 691          if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 692          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 693                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 694                                                                                                                    </span>
<span class="6127537832758136488" onmouseenter="enter('6127537832758136488');" onmouseout="out('6127537832758136488');" style=""> 695          Resource res = unpackProto(new Resource(), buffer, dataSize);                                             </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 696          if (DEBUG) {                                                                                              </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 697              Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698          }                                                                                                         </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 699          Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                                </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 700          if (icon == null) {                                                                                       </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 701              Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 702 -        }                                                                                                         </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 703 -        if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                          </span>
<span class="-6103588571021946959" onmouseenter="enter('-6103588571021946959');" onmouseout="out('-6103588571021946959');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 704 -        IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name), icon, res.dpi);              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 705 +        } else {                                                                                                  </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 706 +            if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                      </span>
<span class="-1593325621603386304" onmouseenter="enter('-1593325621603386304');" onmouseout="out('-1593325621603386304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 707 +            mIconCache.preloadIcon(ComponentName.unflattenFromString(key.name), icon, res.dpi,                    </span>
<span class="5334405366542742044" onmouseenter="enter('5334405366542742044');" onmouseout="out('5334405366542742044');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 708 +                    &quot;&quot; /* label */, mUserSerial, mIdp);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 709 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710      }                                                                                                             </span>
<span  style=""> 711                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 712      /**                                                                                                           </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 713       * Write all the static widget resources we need to render placeholders                                       </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 714       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 715       *                                                                                                            </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 716       * @param data output stream for key/value pairs                                                              </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 717       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 718       */                                                                                                           </span>
<span class="8902701956386788636" onmouseenter="enter('8902701956386788636');" onmouseout="out('8902701956386788636');" style=""> 719      private void backupWidgets(BackupDataOutput data) throws IOException {                                        </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 720          // persist static widget info that hasn&#x27;t been persisted yet                                              </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 721 -        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 722 -        if (appState == null || !initializeIconCache()) {                                                         </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 723 -            Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 724 -            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 725 -        }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 726          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 727 -        final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                              </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 728 -        final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 729          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 730 -        final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                               </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 731 -        if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                             </span>
<span class="-2626585076927746046" onmouseenter="enter('-2626585076927746046');" onmouseout="out('-2626585076927746046');" style=""> 732          int backupWidgetCount = 0;                                                                                </span>
<span  style=""> 733                                                                                                                    </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 734          String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;                        </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 735                  + getUserSelectionArg();                                                                          </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 736          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 737                  where, null, null);                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 738          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 739              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 740              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 741                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 742                  final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                           </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 743 -                final int spanX = cursor.getInt(SPANX_INDEX);                                                     </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 744 -                final int spanY = cursor.getInt(SPANY_INDEX);                                                     </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 745                  final ComponentName provider = ComponentName.unflattenFromString(providerName);                   </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 746                  Key key = null;                                                                                   </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 747                  String backupKey = null;                                                                          </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 748                  if (provider != null) {                                                                           </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 749                      key = getKey(Key.WIDGET, providerName);                                                       </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 750                      backupKey = keyToBackupKey(key);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 751                  } else {                                                                                          </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 752                      Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753                  }                                                                                                 </span>
<span class="-1457210912744999897" onmouseenter="enter('-1457210912744999897');" onmouseout="out('-1457210912744999897');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 754 -                if (mExistingKeys.contains(backupKey)) {                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 755 +                                                                                                                  </span>
<span class="-8332597063062869722" onmouseenter="enter('-8332597063062869722');" onmouseout="out('-8332597063062869722');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 756 +                // Widget backup proto changed in v3. So add it again if the original backup is old.              </span>
<span class="3325885606329004984" onmouseenter="enter('3325885606329004984');" onmouseout="out('3325885606329004984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 757 +                if (mExistingKeys.contains(backupKey) &amp;&amp; restoredBackupVersion &gt;= 3) {                            </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 758                      if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                   </span>
<span  style=""> 759                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 760                      // remember that we already backed this up previously                                         </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 761                      mKeys.add(key);                                                                               </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 762                  } else if (backupKey != null) {                                                                   </span>
<span class="-6588785262075303708" onmouseenter="enter('-6588785262075303708');" onmouseout="out('-6588785262075303708');" style=""> 763                      if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + backupWidgetCount);                         </span>
<span class="5925821600833926932" onmouseenter="enter('5925821600833926932');" onmouseout="out('5925821600833926932');" style=""> 764                      if (backupWidgetCount &lt; MAX_WIDGETS_PER_PASS) {                                               </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 765                          if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                                      </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 766 -                        previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                                 </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 767 -                                spanY * profile.cellHeightPx, widgetSpacingLayout);                               </span>
<span class="-8196153411041800780" onmouseenter="enter('-8196153411041800780');" onmouseout="out('-8196153411041800780');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 768 -                        writeRowToBackup(key, packWidget(dpi, previewLoader, mIconCache, provider), data);        </span>
<span class="-7713836903288582020" onmouseenter="enter('-7713836903288582020');" onmouseout="out('-7713836903288582020');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 769 +                        UserHandleCompat user = UserHandleCompat.myUserHandle();                                  </span>
<span class="3378765365372107616" onmouseenter="enter('3378765365372107616');" onmouseout="out('3378765365372107616');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 770 +                        writeRowToBackup(key, packWidget(dpi, provider, user), data);                             </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 771                          mKeys.add(key);                                                                           </span>
<span class="945813103637646770" onmouseenter="enter('945813103637646770');" onmouseout="out('945813103637646770');" style=""> 772                          backupWidgetCount ++;                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 773                      } else {                                                                                      </span>
<span class="5790411094184621928" onmouseenter="enter('5790411094184621928');" onmouseout="out('5790411094184621928');" style=""> 774                          if (VERBOSE) Log.v(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 775                          // too many widgets for this pass, request another.                                       </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 776                          dataChanged();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 780          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 781              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783      }                                                                                                             </span>
<span  style=""> 784                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 785      /**                                                                                                           </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 786       * Read a widget from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 787       *                                                                                                            </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 788       * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 789       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 790       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 791       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 792       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 793       */                                                                                                           </span>
<span class="-8845552363866853368" onmouseenter="enter('-8845552363866853368');" onmouseout="out('-8845552363866853368');" style=""> 794      private void restoreWidget(Key key, byte[] buffer, int dataSize) throws IOException {                         </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 795          if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 796          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 797                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-906159713803457754" onmouseenter="enter('-906159713803457754');" onmouseout="out('-906159713803457754');" style=""> 798          Widget widget = unpackProto(new Widget(), buffer, dataSize);                                              </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 799          if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                     </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 800          if (widget.icon.data != null)  {                                                                          </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 801              Bitmap icon = BitmapFactory                                                                           </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 802                      .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                               </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 803              if (icon == null) {                                                                                   </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 804                  Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 805              } else {                                                                                              </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 806 -                IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),               </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 807 -                        icon, widget.icon.dpi);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 808 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 809 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 810 -                                                                                                                  </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 811 -        // future site of widget table mutation                                                                   </span>
<span class="4162878957742609395" onmouseenter="enter('4162878957742609395');" onmouseout="out('4162878957742609395');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 812 +                mIconCache.preloadIcon(ComponentName.unflattenFromString(widget.provider),                        </span>
<span class="-5814139742387413473" onmouseenter="enter('-5814139742387413473');" onmouseout="out('-5814139742387413473');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 813 +                        icon, widget.icon.dpi, widget.label, mUserSerial, mIdp);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 814 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 815 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 816 +                                                                                                                  </span>
<span class="-2385058200628938943" onmouseenter="enter('-2385058200628938943');" onmouseout="out('-2385058200628938943');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 817 +        // Cache widget min sizes incase migration is required.                                                   </span>
<span class="-5680508515789962848" onmouseenter="enter('-5680508515789962848');" onmouseout="out('-5680508515789962848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 818 +        widgetSizes.add(widget.provider + &quot;#&quot; + widget.minSpanX + &quot;,&quot; + widget.minSpanY);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819      }                                                                                                             </span>
<span  style=""> 820                                                                                                                    </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 821      /** create a new key, with an integer ID.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 822       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 823       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 824       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 825       */                                                                                                           </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 826      private Key getKey(int type, long id) {                                                                       </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 827          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 828          key.type = type;                                                                                          </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 829          key.id = id;                                                                                              </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 830          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 831          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832      }                                                                                                             </span>
<span  style=""> 833                                                                                                                    </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 834      /** create a new key for a named object.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 835       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 836       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 837       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 838       */                                                                                                           </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 839      private Key getKey(int type, String name) {                                                                   </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 840          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 841          key.type = type;                                                                                          </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 842          key.name = name;                                                                                          </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 843          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 844          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845      }                                                                                                             </span>
<span  style=""> 846                                                                                                                    </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 847      /** keys need to be strings, serialize and encode. */                                                         </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 848      private String keyToBackupKey(Key key) {                                                                      </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 849          return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850      }                                                                                                             </span>
<span  style=""> 851                                                                                                                    </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 852      /** keys need to be strings, decode and parse. */                                                             </span>
<span class="8487156125211732933" onmouseenter="enter('8487156125211732933');" onmouseout="out('8487156125211732933');" style=""> 853      private Key backupKeyToKey(String backupKey) throws InvalidBackupException {                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 854          try {                                                                                                     </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 855              Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                                    </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 856              if (key.checksum != checkKey(key)) {                                                                  </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 857                  key = null;                                                                                       </span>
<span class="-8357577075922640878" onmouseenter="enter('-8357577075922640878');" onmouseout="out('-8357577075922640878');" style=""> 858                  throw new InvalidBackupException(&quot;invalid key read from stream&quot; + backupKey);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 859              }                                                                                                     </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 860              return key;                                                                                           </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 861          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 862              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 863          } catch (IllegalArgumentException e) {                                                                    </span>
<span class="3366873413335010096" onmouseenter="enter('3366873413335010096');" onmouseout="out('3366873413335010096');" style=""> 864              throw new InvalidBackupException(e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866      }                                                                                                             </span>
<span  style=""> 867                                                                                                                    </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 868      /** Compute the checksum over the important bits of a key. */                                                 </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 869      private long checkKey(Key key) {                                                                              </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 870          CRC32 checksum = new CRC32();                                                                             </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 871          checksum.update(key.type);                                                                                </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 872          checksum.update((int) (key.id &amp; 0xffff));                                                                 </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 873          checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                         </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 874          if (!TextUtils.isEmpty(key.name)) {                                                                       </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 875              checksum.update(key.name.getBytes());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876          }                                                                                                         </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 877          return checksum.getValue();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 878 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 879 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 880 +    /**                                                                                                           </span>
<span class="-7741701430317985923" onmouseenter="enter('-7741701430317985923');" onmouseout="out('-7741701430317985923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 881 +     * @return true if its an hotseat item, that can be replaced during restore.                                  </span>
<span class="6416967335754747262" onmouseenter="enter('6416967335754747262');" onmouseout="out('6416967335754747262');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 882 +     * TODO: Extend check for folders in hotseat.                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 883 +     */                                                                                                           </span>
<span class="-2584398314640009222" onmouseenter="enter('-2584398314640009222');" onmouseout="out('-2584398314640009222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 884 +    private boolean isReplaceableHotseatItem(Favorite favorite) {                                                 </span>
<span class="604075697947552793" onmouseenter="enter('604075697947552793');" onmouseout="out('604075697947552793');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 885 +        return favorite.container == Favorites.CONTAINER_HOTSEAT                                                  </span>
<span class="6256768192304850763" onmouseenter="enter('6256768192304850763');" onmouseout="out('6256768192304850763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 886 +                &amp;&amp; favorite.intent != null                                                                        </span>
<span class="-434659868641842414" onmouseenter="enter('-434659868641842414');" onmouseout="out('-434659868641842414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 887 +                &amp;&amp; (favorite.itemType == Favorites.ITEM_TYPE_APPLICATION                                          </span>
<span class="5423532842312973304" onmouseenter="enter('5423532842312973304');" onmouseout="out('5423532842312973304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 888 +                || favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 889      }                                                                                                             </span>
<span  style=""> 890                                                                                                                    </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 891      /** Serialize a Favorite for persistence, including a checksum wrapper. */                                    </span>
<span class="-4941620442458043521" onmouseenter="enter('-4941620442458043521');" onmouseout="out('-4941620442458043521');" style=""> 892      private Favorite packFavorite(Cursor c) {                                                                     </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 893          Favorite favorite = new Favorite();                                                                       </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 894          favorite.id = c.getLong(ID_INDEX);                                                                        </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 895          favorite.screen = c.getInt(SCREEN_INDEX);                                                                 </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 896          favorite.container = c.getInt(CONTAINER_INDEX);                                                           </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 897          favorite.cellX = c.getInt(CELLX_INDEX);                                                                   </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 898          favorite.cellY = c.getInt(CELLY_INDEX);                                                                   </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 899          favorite.spanX = c.getInt(SPANX_INDEX);                                                                   </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 900          favorite.spanY = c.getInt(SPANY_INDEX);                                                                   </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 901          favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                            </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 902 -        if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 903 -            String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                                 </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 904 -            if (!TextUtils.isEmpty(iconPackage)) {                                                                </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 905 -                favorite.iconPackage = iconPackage;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 906 -            }                                                                                                     </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 907 -            String iconResource = c.getString(ICON_RESOURCE_INDEX);                                               </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 908 -            if (!TextUtils.isEmpty(iconResource)) {                                                               </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 909 -                favorite.iconResource = iconResource;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 910 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 911 -        }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 912 -        if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 913 -            byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 914 -            if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 915 -                favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 916 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 917 -        }                                                                                                         </span>
<span class="-7969839402703871132" onmouseenter="enter('-7969839402703871132');" onmouseout="out('-7969839402703871132');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 918 +        favorite.rank = c.getInt(RANK_INDEX);                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 919 +                                                                                                                  </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 920          String title = c.getString(TITLE_INDEX);                                                                  </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 921          if (!TextUtils.isEmpty(title)) {                                                                          </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 922              favorite.title = title;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923          }                                                                                                         </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 924          String intentDescription = c.getString(INTENT_INDEX);                                                     </span>
<span class="7565520938942946666" onmouseenter="enter('7565520938942946666');" onmouseout="out('7565520938942946666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 925 +        Intent intent = null;                                                                                     </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 926          if (!TextUtils.isEmpty(intentDescription)) {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 927              try {                                                                                                 </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 928 -                Intent intent = Intent.parseUri(intentDescription, 0);                                            </span>
<span class="-1059471947143689601" onmouseenter="enter('-1059471947143689601');" onmouseout="out('-1059471947143689601');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 929 +                intent = Intent.parseUri(intentDescription, 0);                                                   </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 930                  intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                                       </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 931                  favorite.intent = intent.toUri(0);                                                                </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 932              } catch (URISyntaxException e) {                                                                      </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 933                  Log.e(TAG, &quot;Invalid intent&quot;, e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 934              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 935          }                                                                                                         </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 936          favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 937          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 938              favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                                  </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 939              String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                                     </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 940              if (!TextUtils.isEmpty(appWidgetProvider)) {                                                          </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 941                  favorite.appWidgetProvider = appWidgetProvider;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 942              }                                                                                                     </span>
<span class="-2728942272707239025" onmouseenter="enter('-2728942272707239025');" onmouseout="out('-2728942272707239025');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 943 +        } else if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                           </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 944 +            if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                              </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 945 +                String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                             </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 946 +                if (!TextUtils.isEmpty(iconPackage)) {                                                            </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 947 +                    favorite.iconPackage = iconPackage;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 948 +                }                                                                                                 </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 949 +                String iconResource = c.getString(ICON_RESOURCE_INDEX);                                           </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 950 +                if (!TextUtils.isEmpty(iconResource)) {                                                           </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 951 +                    favorite.iconResource = iconResource;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 952 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 953 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 954 +                                                                                                                  </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 955 +            byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 956 +            if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 957 +                favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 958 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 959 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 960 +                                                                                                                  </span>
<span class="4506787128775909524" onmouseenter="enter('4506787128775909524');" onmouseout="out('4506787128775909524');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 961 +        if (isReplaceableHotseatItem(favorite)) {                                                                 </span>
<span class="1125417031607979515" onmouseenter="enter('1125417031607979515');" onmouseout="out('1125417031607979515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 962 +            if (intent != null &amp;&amp; intent.getComponent() != null) {                                                </span>
<span class="-1730109496559992149" onmouseenter="enter('-1730109496559992149');" onmouseout="out('-1730109496559992149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 963 +                PackageManager pm = mContext.getPackageManager();                                                 </span>
<span class="1376604666851387224" onmouseenter="enter('1376604666851387224');" onmouseout="out('1376604666851387224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 964 +                ActivityInfo activity = null;;                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 965 +                try {                                                                                             </span>
<span class="-4680891658995954763" onmouseenter="enter('-4680891658995954763');" onmouseout="out('-4680891658995954763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 966 +                    activity = pm.getActivityInfo(intent.getComponent(), 0);                                      </span>
<span class="-117497467326286440" onmouseenter="enter('-117497467326286440');" onmouseout="out('-117497467326286440');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 967 +                } catch (NameNotFoundException e) {                                                               </span>
<span class="6441840811582394217" onmouseenter="enter('6441840811582394217');" onmouseout="out('6441840811582394217');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 968 +                    Log.e(TAG, &quot;Target not found&quot;, e);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 969 +                }                                                                                                 </span>
<span class="-686470663642561295" onmouseenter="enter('-686470663642561295');" onmouseout="out('-686470663642561295');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 970 +                if (activity == null) {                                                                           </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 971 +                    return favorite;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 972 +                }                                                                                                 </span>
<span class="1588348629699716331" onmouseenter="enter('1588348629699716331');" onmouseout="out('1588348629699716331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 973 +                for (int i = 0; i &lt; mItemTypeMatchers.length; i++) {                                              </span>
<span class="-5068297146611218467" onmouseenter="enter('-5068297146611218467');" onmouseout="out('-5068297146611218467');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 974 +                    if (mItemTypeMatchers[i] == null) {                                                           </span>
<span class="2340950037759851004" onmouseenter="enter('2340950037759851004');" onmouseout="out('2340950037759851004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 975 +                        mItemTypeMatchers[i] = new ItemTypeMatcher(                                               </span>
<span class="8145000845780688523" onmouseenter="enter('8145000845780688523');" onmouseout="out('8145000845780688523');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 976 +                                CommonAppTypeParser.getResourceForItemType(i));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 977 +                    }                                                                                             </span>
<span class="-7033063453356190819" onmouseenter="enter('-7033063453356190819');" onmouseout="out('-7033063453356190819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 978 +                    if (mItemTypeMatchers[i].matches(activity, pm)) {                                             </span>
<span class="7655986738273236605" onmouseenter="enter('7655986738273236605');" onmouseout="out('7655986738273236605');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 979 +                        favorite.targetType = i;                                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 980 +                        break;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 981 +                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 982 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 983 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984          }                                                                                                         </span>
<span  style=""> 985                                                                                                                    </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 986          return favorite;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 987      }                                                                                                             </span>
<span  style=""> 988                                                                                                                    </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 989      /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                             </span>
<span class="-5576008980985724481" onmouseenter="enter('-5576008980985724481');" onmouseout="out('-5576008980985724481');" style=""> 990      private ContentValues unpackFavorite(byte[] buffer, int dataSize)                                             </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 991              throws IOException {                                                                                  </span>
<span class="-2434416742280569425" onmouseenter="enter('-2434416742280569425');" onmouseout="out('-2434416742280569425');" style=""> 992          Favorite favorite = unpackProto(new Favorite(), buffer, dataSize);                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 993 +                                                                                                                  </span>
<span class="9046104249279415184" onmouseenter="enter('9046104249279415184');" onmouseout="out('9046104249279415184');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 994 +        // If it is a hotseat item, move it accordingly.                                                          </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 995 +        if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                                  </span>
<span class="-6501405241219819611" onmouseenter="enter('-6501405241219819611');" onmouseout="out('-6501405241219819611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 996 +            favorite.screen += mHotseatShift;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 997 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 998 +                                                                                                                  </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 999          ContentValues values = new ContentValues();                                                               </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style="">1000          values.put(Favorites._ID, favorite.id);                                                                   </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style="">1001          values.put(Favorites.SCREEN, favorite.screen);                                                            </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style="">1002          values.put(Favorites.CONTAINER, favorite.container);                                                      </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style="">1003          values.put(Favorites.CELLX, favorite.cellX);                                                              </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style="">1004          values.put(Favorites.CELLY, favorite.cellY);                                                              </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style="">1005          values.put(Favorites.SPANX, favorite.spanX);                                                              </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style="">1006          values.put(Favorites.SPANY, favorite.spanY);                                                              </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1007 -        values.put(Favorites.ICON_TYPE, favorite.iconType);                                                       </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1008 -        if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1009 -            values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                             </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1010 -            values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1011 -        }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1012 -        if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="-3701788107564637331" onmouseenter="enter('-3701788107564637331');" onmouseout="out('-3701788107564637331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1013 +        values.put(Favorites.RANK, favorite.rank);                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1014 +                                                                                                                  </span>
<span class="-1096736107689112766" onmouseenter="enter('-1096736107689112766');" onmouseout="out('-1096736107689112766');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1015 +        if (favorite.itemType == Favorites.ITEM_TYPE_SHORTCUT) {                                                  </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1016 +            values.put(Favorites.ICON_TYPE, favorite.iconType);                                                   </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1017 +            if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                              </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1018 +                values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                         </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1019 +                values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1020 +            }                                                                                                     </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style="">1021              values.put(Favorites.ICON, favorite.icon);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1022          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1023 +                                                                                                                  </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style="">1024          if (!TextUtils.isEmpty(favorite.title)) {                                                                 </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style="">1025              values.put(Favorites.TITLE, favorite.title);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1026          } else {                                                                                                  </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style="">1027              values.put(Favorites.TITLE, &quot;&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1028          }                                                                                                         </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style="">1029          if (!TextUtils.isEmpty(favorite.intent)) {                                                                </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style="">1030              values.put(Favorites.INTENT, favorite.intent);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031          }                                                                                                         </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style="">1032          values.put(Favorites.ITEM_TYPE, favorite.itemType);                                                       </span>
<span  style="">1033                                                                                                                    </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style="">1034          UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                          </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style="">1035          long userSerialNumber =                                                                                   </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style="">1036                  UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);                     </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style="">1037          values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                                      </span>
<span  style="">1038                                                                                                                    </span>
<span class="6840222601736111479" onmouseenter="enter('6840222601736111479');" onmouseout="out('6840222601736111479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1039 -        DeviceProfieData currentProfile = getDeviceProfieData();                                                  </span>
<span class="7585439753959053806" onmouseenter="enter('7585439753959053806');" onmouseout="out('7585439753959053806');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1040 +        // If we will attempt grid resize, use the original profile to validate grid size, as                     </span>
<span class="7298199795309036018" onmouseenter="enter('7298199795309036018');" onmouseout="out('7298199795309036018');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1041 +        // anything which fits in the original grid should fit in the current grid after                          </span>
<span class="-386818733866572403" onmouseenter="enter('-386818733866572403');" onmouseout="out('-386818733866572403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1042 +        // grid migration.                                                                                        </span>
<span class="978452708592763195" onmouseenter="enter('978452708592763195');" onmouseout="out('978452708592763195');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1043 +        DeviceProfieData currentProfile = migrationCompatibleProfileData == null                                  </span>
<span class="-7548774861757189682" onmouseenter="enter('-7548774861757189682');" onmouseout="out('-7548774861757189682');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1044 +                ? mDeviceProfileData : migrationCompatibleProfileData;                                            </span>
<span  style="">1045                                                                                                                    </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style="">1046          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style="">1047              if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                                 </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style="">1048                  values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1049              }                                                                                                     </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style="">1050              values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                             </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="">1051              values.put(LauncherSettings.Favorites.RESTORED,                                                       </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style="">1052                      LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                                     </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style="">1053                      LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                               </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style="">1054                      LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                                     </span>
<span  style="">1055                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style="">1056              // Verify placement                                                                                   </span>
<span class="-7553882590673737344" onmouseenter="enter('-7553882590673737344');" onmouseout="out('-7553882590673737344');" style="">1057              if (((favorite.cellX + favorite.spanX) &gt; currentProfile.desktopCols)                                  </span>
<span class="1436175124930418764" onmouseenter="enter('1436175124930418764');" onmouseout="out('1436175124930418764');" style="">1058                      || ((favorite.cellY + favorite.spanY) &gt; currentProfile.desktopRows)) {                        </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1059                  restoreSuccessful = false;                                                                        </span>
<span class="7011633566362790130" onmouseenter="enter('7011633566362790130');" onmouseout="out('7011633566362790130');" style="">1060                  throw new InvalidBackupException(&quot;Widget not in screen bounds, aborting restore&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1061              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1062          } else {                                                                                                  </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1063 -            // Let LauncherModel know we&#x27;ve been here.                                                            </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1064 -            values.put(LauncherSettings.Favorites.RESTORED, 1);                                                   </span>
<span class="8786702956663306303" onmouseenter="enter('8786702956663306303');" onmouseout="out('8786702956663306303');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1065 +            // Check if it is an hotseat item, that can be replaced.                                              </span>
<span class="5088947528875964657" onmouseenter="enter('5088947528875964657');" onmouseout="out('5088947528875964657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1066 +            if (isReplaceableHotseatItem(favorite)                                                                </span>
<span class="-3804650287411139588" onmouseenter="enter('-3804650287411139588');" onmouseout="out('-3804650287411139588');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1067 +                    &amp;&amp; favorite.targetType != Favorite.TARGET_NONE                                                </span>
<span class="3747219331600099018" onmouseenter="enter('3747219331600099018');" onmouseout="out('3747219331600099018');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1068 +                    &amp;&amp; favorite.targetType &lt; CommonAppTypeParser.SUPPORTED_TYPE_COUNT) {                          </span>
<span class="2770840096112784262" onmouseenter="enter('2770840096112784262');" onmouseout="out('2770840096112784262');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1069 +                Log.e(TAG, &quot;Added item type flag&quot;);                                                               </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1070 +                values.put(LauncherSettings.Favorites.RESTORED,                                                   </span>
<span class="-5769863763985510613" onmouseenter="enter('-5769863763985510613');" onmouseout="out('-5769863763985510613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1071 +                        1 | CommonAppTypeParser.encodeItemTypeToFlag(favorite.targetType));                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1072 +            } else {                                                                                              </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1073 +                // Let LauncherModel know we&#x27;ve been here.                                                        </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1074 +                values.put(LauncherSettings.Favorites.RESTORED, 1);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1075 +            }                                                                                                     </span>
<span  style="">1076                                                                                                                    </span>
<span class="-5084610606634259821" onmouseenter="enter('-5084610606634259821');" onmouseout="out('-5084610606634259821');" style="">1077              // Verify placement                                                                                   </span>
<span class="3864952878759458640" onmouseenter="enter('3864952878759458640');" onmouseout="out('3864952878759458640');" style="">1078              if (favorite.container == Favorites.CONTAINER_HOTSEAT) {                                              </span>
<span class="3850618212667286309" onmouseenter="enter('3850618212667286309');" onmouseout="out('3850618212667286309');" style="">1079                  if ((favorite.screen &gt;= currentProfile.hotseatCount)                                              </span>
<span class="-2927406358945708190" onmouseenter="enter('-2927406358945708190');" onmouseout="out('-2927406358945708190');" style="">1080                          || (favorite.screen == currentProfile.allappsRank)) {                                     </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1081                      restoreSuccessful = false;                                                                    </span>
<span class="-691298798481443174" onmouseenter="enter('-691298798481443174');" onmouseout="out('-691298798481443174');" style="">1082                      throw new InvalidBackupException(&quot;Item not in hotseat bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1084              } else {                                                                                              </span>
<span class="4635538835318305805" onmouseenter="enter('4635538835318305805');" onmouseout="out('4635538835318305805');" style="">1085                  if ((favorite.cellX &gt;= currentProfile.desktopCols)                                                </span>
<span class="-3183516951997115573" onmouseenter="enter('-3183516951997115573');" onmouseout="out('-3183516951997115573');" style="">1086                          || (favorite.cellY &gt;= currentProfile.desktopRows)) {                                      </span>
<span class="1213158576869320795" onmouseenter="enter('1213158576869320795');" onmouseout="out('1213158576869320795');" style="">1087                      restoreSuccessful = false;                                                                    </span>
<span class="-4636836023111342177" onmouseenter="enter('-4636836023111342177');" onmouseout="out('-4636836023111342177');" style="">1088                      throw new InvalidBackupException(&quot;Item not in desktop bounds, aborting restore&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1089                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1090              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1091          }                                                                                                         </span>
<span  style="">1092                                                                                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1093          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094      }                                                                                                             </span>
<span  style="">1095                                                                                                                    </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style="">1096      /** Serialize a Screen for persistence, including a checksum wrapper. */                                      </span>
<span class="-2972226878649627416" onmouseenter="enter('-2972226878649627416');" onmouseout="out('-2972226878649627416');" style="">1097      private Screen packScreen(Cursor c) {                                                                         </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style="">1098          Screen screen = new Screen();                                                                             </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style="">1099          screen.id = c.getLong(ID_INDEX);                                                                          </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style="">1100          screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                                </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style="">1101          return screen;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102      }                                                                                                             </span>
<span  style="">1103                                                                                                                    </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style="">1104      /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                               </span>
<span class="-6334846790262383221" onmouseenter="enter('-6334846790262383221');" onmouseout="out('-6334846790262383221');" style="">1105      private ContentValues unpackScreen(byte[] buffer, int dataSize)                                               </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1106              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="8220272479703320672" onmouseenter="enter('8220272479703320672');" onmouseout="out('8220272479703320672');" style="">1107          Screen screen = unpackProto(new Screen(), buffer, dataSize);                                              </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="">1108          ContentValues values = new ContentValues();                                                               </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style="">1109          values.put(WorkspaceScreens._ID, screen.id);                                                              </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style="">1110          values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="">1111          return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1112      }                                                                                                             </span>
<span  style="">1113                                                                                                                    </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style="">1114      /** Serialize an icon Resource for persistence, including a checksum wrapper. */                              </span>
<span class="-3765156030933234683" onmouseenter="enter('-3765156030933234683');" onmouseout="out('-3765156030933234683');" style="">1115      private Resource packIcon(int dpi, Bitmap icon) {                                                             </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style="">1116          Resource res = new Resource();                                                                            </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style="">1117          res.dpi = dpi;                                                                                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1118 -        ByteArrayOutputStream os = new ByteArrayOutputStream();                                                   </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1119 -        if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                         </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1120 -            res.data = os.toByteArray();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1121 -        }                                                                                                         </span>
<span class="1351395175055257895" onmouseenter="enter('1351395175055257895');" onmouseout="out('1351395175055257895');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1122 +        res.data = Utilities.flattenBitmap(icon);                                                                 </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style="">1123          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124      }                                                                                                             </span>
<span  style="">1125                                                                                                                    </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style="">1126      /** Serialize a widget for persistence, including a checksum wrapper. */                                      </span>
<span class="122020410304176150" onmouseenter="enter('122020410304176150');" onmouseout="out('122020410304176150');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1127 -    private Widget packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,                    </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1128 -            ComponentName provider) {                                                                             </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1129 -        final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                                   </span>
<span class="-7319030046565372905" onmouseenter="enter('-7319030046565372905');" onmouseout="out('-7319030046565372905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1130 +    private Widget packWidget(int dpi, ComponentName provider, UserHandleCompat user) {                           </span>
<span class="-6758131701855543680" onmouseenter="enter('-6758131701855543680');" onmouseout="out('-6758131701855543680');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1131 +        final LauncherAppWidgetProviderInfo info =                                                                </span>
<span class="959088304814933331" onmouseenter="enter('959088304814933331');" onmouseout="out('959088304814933331');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1132 +                LauncherModel.getProviderInfo(mContext, provider, user);                                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1133          Widget widget = new Widget();                                                                             </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="">1134          widget.provider = provider.flattenToShortString();                                                        </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1135          widget.label = info.label;                                                                                </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1136          widget.configure = info.configure != null;                                                                </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1137          if (info.icon != 0) {                                                                                     </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1138              widget.icon = new Resource();                                                                         </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1139 -            Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);                </span>
<span class="2748374132463314083" onmouseenter="enter('2748374132463314083');" onmouseout="out('2748374132463314083');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1140 +            Drawable fullResIcon = mIconCache.getFullResIcon(provider.getPackageName(), info.icon);               </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1141              Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                                      </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1142 -            ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1143 -            if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                     </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1144 -                widget.icon.data = os.toByteArray();                                                              </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1145 -                widget.icon.dpi = dpi;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1146 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1147 -        }                                                                                                         </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1148 -        if (info.previewImage != 0) {                                                                             </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1149 -            widget.preview = new Resource();                                                                      </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1150 -            Bitmap preview = previewLoader.generateWidgetPreview(info, null);                                     </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1151 -            ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1152 -            if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                  </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1153 -                widget.preview.data = os.toByteArray();                                                           </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1154 -                widget.preview.dpi = dpi;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1155 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1156 -        }                                                                                                         </span>
<span class="-7999586914508767376" onmouseenter="enter('-7999586914508767376');" onmouseout="out('-7999586914508767376');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1157 +            widget.icon.data = Utilities.flattenBitmap(icon);                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1158 +            widget.icon.dpi = dpi;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1159 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1160 +                                                                                                                  </span>
<span class="1043295540346253364" onmouseenter="enter('1043295540346253364');" onmouseout="out('1043295540346253364');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1161 +        Point spans = info.getMinSpans(mIdp, mContext);                                                           </span>
<span class="-1248183371241258015" onmouseenter="enter('-1248183371241258015');" onmouseout="out('-1248183371241258015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1162 +        widget.minSpanX = spans.x;                                                                                </span>
<span class="1290669233310739887" onmouseenter="enter('1290669233310739887');" onmouseout="out('1290669233310739887');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1163 +        widget.minSpanY = spans.y;                                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1164 +                                                                                                                  </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1165          return widget;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1166      }                                                                                                             </span>
<span  style="">1167                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1168      /**                                                                                                           </span>
<span class="-6874367995571601041" onmouseenter="enter('-6874367995571601041');" onmouseout="out('-6874367995571601041');" style="">1169       * Deserialize a proto after verifying checksum wrapper.                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1170       */                                                                                                           </span>
<span class="-5715443043908740461" onmouseenter="enter('-5715443043908740461');" onmouseout="out('-5715443043908740461');" style="">1171      private &lt;T extends MessageNano&gt; T unpackProto(T proto, byte[] buffer, int dataSize)                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1172              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="3586959539497362312" onmouseenter="enter('3586959539497362312');" onmouseout="out('3586959539497362312');" style="">1173          MessageNano.mergeFrom(proto, readCheckedBytes(buffer, dataSize));                                         </span>
<span class="-457719895855013137" onmouseenter="enter('-457719895855013137');" onmouseout="out('-457719895855013137');" style="">1174          if (DEBUG) Log.d(TAG, &quot;unpacked proto &quot; + proto);                                                         </span>
<span class="-4617644922538843539" onmouseenter="enter('-4617644922538843539');" onmouseout="out('-4617644922538843539');" style="">1175          return proto;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176      }                                                                                                             </span>
<span  style="">1177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1178      /**                                                                                                           </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1179       * Read the old journal from the input file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1180       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1181       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1182       * in that case, do a full backup.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1183       *                                                                                                            </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1184       * @param oldState the read-0only file descriptor pointing to the old journal                                 </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1185       * @return a Journal protocol buffer                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1186       */                                                                                                           </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1187      private Journal readJournal(ParcelFileDescriptor oldState) {                                                  </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1188          Journal journal = new Journal();                                                                          </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1189          if (oldState == null) {                                                                                   </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1190              return journal;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1191          }                                                                                                         </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1192          FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1193          try {                                                                                                     </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1194              int availableBytes = inStream.available();                                                            </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1195              if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                                 </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1196              if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                              </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1197                  byte[] buffer = new byte[availableBytes];                                                         </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1198                  int bytesRead = 0;                                                                                </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1199                  boolean valid = false;                                                                            </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1200                  InvalidProtocolBufferNanoException lastProtoException = null;                                     </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1201                  while (availableBytes &gt; 0) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1202                      try {                                                                                         </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1203                          // OMG what are you doing? This is crazy inefficient!                                     </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1204                          // If we read a byte that is not ours, we will cause trouble: b/12491813                  </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1205                          // However, we don&#x27;t know how many bytes to expect (oops).                                </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1206                          // So we have to step through *slowly*, watching for the end.                             </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1207                          int result = inStream.read(buffer, bytesRead, 1);                                         </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1208                          if (result &gt; 0) {                                                                         </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1209                              availableBytes -= result;                                                             </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1210                              bytesRead += result;                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1211                          } else {                                                                                  </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1212                              Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                          </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1213                              // stop reading and see what there is to parse                                        </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1214                              availableBytes = 0;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215                          }                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1216                      } catch (IOException e) {                                                                     </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1217                          buffer = null;                                                                            </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1218                          availableBytes = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1219                      }                                                                                             </span>
<span  style="">1220                                                                                                                    </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1221                      // check the buffer to see if we have a valid journal                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1222                      try {                                                                                         </span>
<span class="1860035926493113497" onmouseenter="enter('1860035926493113497');" onmouseout="out('1860035926493113497');" style="">1223                          MessageNano.mergeFrom(journal, readCheckedBytes(buffer, bytesRead));                      </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1224                          // if we are here, then we have read a valid, checksum-verified journal                   </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1225                          valid = true;                                                                             </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1226                          availableBytes = 0;                                                                       </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1227                          if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);                       </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1228                      } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1229                          // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.              </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1230                          lastProtoException = e;                                                                   </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1231                          journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1232                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1233                  }                                                                                                 </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1234                  if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                        </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1235                  if (!valid) {                                                                                     </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1236                      Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1237                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1238              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1239          } catch (IOException e) {                                                                                 </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1240              Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1241          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1242              try {                                                                                                 </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1243                  inStream.close();                                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1244              } catch (IOException e) {                                                                             </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1245                  Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1246              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1247          }                                                                                                         </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1248          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1249      }                                                                                                             </span>
<span  style="">1250                                                                                                                    </span>
<span class="886193086460418431" onmouseenter="enter('886193086460418431');" onmouseout="out('886193086460418431');" style="">1251      private void writeRowToBackup(Key key, MessageNano proto, BackupDataOutput data)                              </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1252              throws IOException {                                                                                  </span>
<span class="-47929768022599793" onmouseenter="enter('-47929768022599793');" onmouseout="out('-47929768022599793');" style="">1253          writeRowToBackup(keyToBackupKey(key), proto, data);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1254      }                                                                                                             </span>
<span  style="">1255                                                                                                                    </span>
<span class="-4642169512794878648" onmouseenter="enter('-4642169512794878648');" onmouseout="out('-4642169512794878648');" style="">1256      private void writeRowToBackup(String backupKey, MessageNano proto,                                            </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1257              BackupDataOutput data) throws IOException {                                                           </span>
<span class="-6717132936649015334" onmouseenter="enter('-6717132936649015334');" onmouseout="out('-6717132936649015334');" style="">1258          byte[] blob = writeCheckedBytes(proto);                                                                   </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1259          data.writeEntityHeader(backupKey, blob.length);                                                           </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1260          data.writeEntityData(blob, blob.length);                                                                  </span>
<span class="5408292374197886519" onmouseenter="enter('5408292374197886519');" onmouseout="out('5408292374197886519');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1261 +        mBackupDataWasUpdated = true;                                                                             </span>
<span class="-5534390041754670144" onmouseenter="enter('-5534390041754670144');" onmouseout="out('-5534390041754670144');" style="">1262          if (VERBOSE) Log.v(TAG, &quot;Writing New entry &quot; + backupKey);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1263      }                                                                                                             </span>
<span  style="">1264                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1265      /**                                                                                                           </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1266       * Write the new journal to the output file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1267       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1268       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1269       * in that case, do a full backup.                                                                            </span>
<span  style="">1270                                                                                                                    </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1271       * @param newState the write-only file descriptor pointing to the new journal                                 </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1272       * @param journal a Journal protocol buffer                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1273       */                                                                                                           </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1274      private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                                   </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1275          FileOutputStream outStream = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1276          try {                                                                                                     </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1277              outStream = new FileOutputStream(newState.getFileDescriptor());                                       </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1278              final byte[] journalBytes = writeCheckedBytes(journal);                                               </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1279              outStream.write(journalBytes);                                                                        </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1280              outStream.close();                                                                                    </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1281              if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1282          } catch (IOException e) {                                                                                 </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1283              Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1284          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1285      }                                                                                                             </span>
<span  style="">1286                                                                                                                    </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1287      /** Wrap a proto in a CheckedMessage and compute the checksum. */                                             </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1288      private byte[] writeCheckedBytes(MessageNano proto) {                                                         </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1289          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1290          wrapper.payload = MessageNano.toByteArray(proto);                                                         </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1291          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1292          checksum.update(wrapper.payload);                                                                         </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1293          wrapper.checksum = checksum.getValue();                                                                   </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1294          return MessageNano.toByteArray(wrapper);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1295      }                                                                                                             </span>
<span  style="">1296                                                                                                                    </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1297      /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                                  </span>
<span class="241902133357238288" onmouseenter="enter('241902133357238288');" onmouseout="out('241902133357238288');" style="">1298      private static byte[] readCheckedBytes(byte[] buffer, int dataSize)                                           </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1299              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1300          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="-6803919683702549568" onmouseenter="enter('-6803919683702549568');" onmouseout="out('-6803919683702549568');" style="">1301          MessageNano.mergeFrom(wrapper, buffer, 0, dataSize);                                                      </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1302          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1303          checksum.update(wrapper.payload);                                                                         </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1304          if (wrapper.checksum != checksum.getValue()) {                                                            </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1305              throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1306          }                                                                                                         </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1307          return wrapper.payload;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1308      }                                                                                                             </span>
<span  style="">1309                                                                                                                    </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1310 -    private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                            </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1311 -        if (mWidgetMap == null) {                                                                                 </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1312 -            List&lt;AppWidgetProviderInfo&gt; widgets =                                                                 </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1313 -                    AppWidgetManager.getInstance(mContext).getInstalledProviders();                               </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1314 -            mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());                       </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1315 -            for (AppWidgetProviderInfo info : widgets) {                                                          </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1316 -                mWidgetMap.put(info.provider, info);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1317 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1318 -        }                                                                                                         </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1319 -        return mWidgetMap.get(component);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1320 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1321 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1322 -                                                                                                                  </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1323 -    private boolean initializeIconCache() {                                                                       </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1324 -        if (mIconCache != null) {                                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1325 -            return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1326 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1327 -                                                                                                                  </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1328 -        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1329 -        if (appState == null) {                                                                                   </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1330 -            Throwable stackTrace = new Throwable();                                                               </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1331 -            stackTrace.fillInStackTrace();                                                                        </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1332 -            Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1333 -            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1334 -        }                                                                                                         </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1335 -        mIconCache = appState.getIconCache();                                                                     </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1336 -        return mIconCache != null;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1337 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1338 -                                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1339 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1340      /**                                                                                                           </span>
<span class="-8980911233908727276" onmouseenter="enter('-8980911233908727276');" onmouseout="out('-8980911233908727276');" style="">1341       * @return true if the launcher is in a state to support backup                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1342       */                                                                                                           </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1343      private boolean launcherIsReady() {                                                                           </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1344          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1345          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);                   </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1346          if (cursor == null) {                                                                                     </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1347              // launcher data has been wiped, do nothing                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1348              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1349          }                                                                                                         </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1350          cursor.close();                                                                                           </span>
<span  style="">1351                                                                                                                    </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1352 -        if (!initializeIconCache()) {                                                                             </span>
<span class="5421709736360679354" onmouseenter="enter('5421709736360679354');" onmouseout="out('5421709736360679354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1353 +        if (LauncherAppState.getInstanceNoCreate() == null) {                                                     </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1354              // launcher services are unavailable, try again later                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1355 -            dataChanged();                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1356              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1357          }                                                                                                         </span>
<span  style="">1358                                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1359          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1360      }                                                                                                             </span>
<span  style="">1361                                                                                                                    </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1362      private String getUserSelectionArg() {                                                                        </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1363          return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                               </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1364                  .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1365      }                                                                                                             </span>
<span  style="">1366                                                                                                                    </span>
<span class="2300443005706538875" onmouseenter="enter('2300443005706538875');" onmouseout="out('2300443005706538875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1367 -    private class InvalidBackupException extends IOException {                                                    </span>
<span class="7118811970258264720" onmouseenter="enter('7118811970258264720');" onmouseout="out('7118811970258264720');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1368 -        private InvalidBackupException(Throwable cause) {                                                         </span>
<span class="-5176517881040090425" onmouseenter="enter('-5176517881040090425');" onmouseout="out('-5176517881040090425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1369 +    @Thunk class InvalidBackupException extends IOException {                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1370 +                                                                                                                  </span>
<span class="-159655997534807889" onmouseenter="enter('-159655997534807889');" onmouseout="out('-159655997534807889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1371 +        private static final long serialVersionUID = 8931456637211665082L;                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1372 +                                                                                                                  </span>
<span class="5112209169585560371" onmouseenter="enter('5112209169585560371');" onmouseout="out('5112209169585560371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1373 +        @Thunk InvalidBackupException(Throwable cause) {                                                          </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1374              super(cause);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1375          }                                                                                                         </span>
<span  style="">1376                                                                                                                    </span>
<span class="3383530736812522133" onmouseenter="enter('3383530736812522133');" onmouseout="out('3383530736812522133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1377 -        public InvalidBackupException(String reason) {                                                            </span>
<span class="5097977583346831854" onmouseenter="enter('5097977583346831854');" onmouseout="out('5097977583346831854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1378 +        @Thunk InvalidBackupException(String reason) {                                                            </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1379              super(reason);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1380          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1381      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1382 +                                                                                                                  </span>
<span class="-806551235718833382" onmouseenter="enter('-806551235718833382');" onmouseout="out('-806551235718833382');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1383 +    public boolean shouldAttemptWorkspaceMigration() {                                                            </span>
<span class="-2817654345638424296" onmouseenter="enter('-2817654345638424296');" onmouseout="out('-2817654345638424296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1384 +        return migrationCompatibleProfileData != null;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1385 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1386 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1387 +    /**                                                                                                           </span>
<span class="-6003386830996260587" onmouseenter="enter('-6003386830996260587');" onmouseout="out('-6003386830996260587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1388 +     * A class to check if an activity can handle one of the intents from a list of                               </span>
<span class="-5698366910009859729" onmouseenter="enter('-5698366910009859729');" onmouseout="out('-5698366910009859729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1389 +     * predefined intents.                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1390 +     */                                                                                                           </span>
<span class="-294417881302882943" onmouseenter="enter('-294417881302882943');" onmouseout="out('-294417881302882943');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1391 +    private class ItemTypeMatcher {                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1392 +                                                                                                                  </span>
<span class="5661369644980564444" onmouseenter="enter('5661369644980564444');" onmouseout="out('5661369644980564444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1393 +        private final ArrayList&lt;Intent&gt; mIntents;                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1394 +                                                                                                                  </span>
<span class="7947835864751663019" onmouseenter="enter('7947835864751663019');" onmouseout="out('7947835864751663019');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1395 +        ItemTypeMatcher(int xml_res) {                                                                            </span>
<span class="-2300579919401902073" onmouseenter="enter('-2300579919401902073');" onmouseout="out('-2300579919401902073');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1396 +            mIntents = xml_res == 0 ? new ArrayList&lt;Intent&gt;() : parseIntents(xml_res);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1397 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1398 +                                                                                                                  </span>
<span class="1901648508961547266" onmouseenter="enter('1901648508961547266');" onmouseout="out('1901648508961547266');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1399 +        private ArrayList&lt;Intent&gt; parseIntents(int xml_res) {                                                     </span>
<span class="5540360935338349750" onmouseenter="enter('5540360935338349750');" onmouseout="out('5540360935338349750');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1400 +            ArrayList&lt;Intent&gt; intents = new ArrayList&lt;Intent&gt;();                                                  </span>
<span class="3061609294443151520" onmouseenter="enter('3061609294443151520');" onmouseout="out('3061609294443151520');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1401 +            XmlResourceParser parser = mContext.getResources().getXml(xml_res);                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1402 +            try {                                                                                                 </span>
<span class="-8849434420134325659" onmouseenter="enter('-8849434420134325659');" onmouseout="out('-8849434420134325659');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1403 +                DefaultLayoutParser.beginDocument(parser, DefaultLayoutParser.TAG_RESOLVE);                       </span>
<span class="-1796733801910506416" onmouseenter="enter('-1796733801910506416');" onmouseout="out('-1796733801910506416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1404 +                final int depth = parser.getDepth();                                                              </span>
<span class="3163913122247807134" onmouseenter="enter('3163913122247807134');" onmouseout="out('3163913122247807134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1405 +                int type;                                                                                         </span>
<span class="-1784597901533800040" onmouseenter="enter('-1784597901533800040');" onmouseout="out('-1784597901533800040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1406 +                while (((type = parser.next()) != XmlPullParser.END_TAG ||                                        </span>
<span class="9136127903140816012" onmouseenter="enter('9136127903140816012');" onmouseout="out('9136127903140816012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1407 +                        parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {                       </span>
<span class="-852303053066575561" onmouseenter="enter('-852303053066575561');" onmouseout="out('-852303053066575561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1408 +                    if (type != XmlPullParser.START_TAG) {                                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1409 +                        continue;                                                                                 </span>
<span class="-2831914866731738684" onmouseenter="enter('-2831914866731738684');" onmouseout="out('-2831914866731738684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1410 +                    } else if (DefaultLayoutParser.TAG_FAVORITE.equals(parser.getName())) {                       </span>
<span class="-6398792714141510192" onmouseenter="enter('-6398792714141510192');" onmouseout="out('-6398792714141510192');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1411 +                        final String uri = DefaultLayoutParser.getAttributeValue(                                 </span>
<span class="-7436101632763202971" onmouseenter="enter('-7436101632763202971');" onmouseout="out('-7436101632763202971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1412 +                                parser, DefaultLayoutParser.ATTR_URI);                                            </span>
<span class="2923956873578722269" onmouseenter="enter('2923956873578722269');" onmouseout="out('2923956873578722269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1413 +                        intents.add(Intent.parseUri(uri, 0));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1414 +                    }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1415 +                }                                                                                                 </span>
<span class="852313001671934341" onmouseenter="enter('852313001671934341');" onmouseout="out('852313001671934341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1416 +            } catch (URISyntaxException | XmlPullParserException | IOException e) {                               </span>
<span class="-9140097493106781040" onmouseenter="enter('-9140097493106781040');" onmouseout="out('-9140097493106781040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1417 +                Log.e(TAG, &quot;Unable to parse &quot; + xml_res, e);                                                      </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1418 +            } finally {                                                                                           </span>
<span class="1683108134309283446" onmouseenter="enter('1683108134309283446');" onmouseout="out('1683108134309283446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1419 +                parser.close();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1420 +            }                                                                                                     </span>
<span class="3401874801805457207" onmouseenter="enter('3401874801805457207');" onmouseout="out('3401874801805457207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1421 +            return intents;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1422 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1423 +                                                                                                                  </span>
<span class="-2440005102828915968" onmouseenter="enter('-2440005102828915968');" onmouseout="out('-2440005102828915968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1424 +        public boolean matches(ActivityInfo activity, PackageManager pm) {                                        </span>
<span class="-4382865482068887175" onmouseenter="enter('-4382865482068887175');" onmouseout="out('-4382865482068887175');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1425 +            for (Intent intent : mIntents) {                                                                      </span>
<span class="-1644176256185935870" onmouseenter="enter('-1644176256185935870');" onmouseout="out('-1644176256185935870');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1426 +                intent.setPackage(activity.packageName);                                                          </span>
<span class="-6215226788751992631" onmouseenter="enter('-6215226788751992631');" onmouseout="out('-6215226788751992631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1427 +                ResolveInfo info = pm.resolveActivity(intent, 0);                                                 </span>
<span class="2104528236737597253" onmouseenter="enter('2104528236737597253');" onmouseout="out('2104528236737597253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1428 +                if (info != null &amp;&amp; (info.activityInfo.name.equals(activity.name)                                 </span>
<span class="1520043710369759480" onmouseenter="enter('1520043710369759480');" onmouseout="out('1520043710369759480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1429 +                        || info.activityInfo.name.equals(activity.targetActivity))) {                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1430 +                    return true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1431 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1432 +            }                                                                                                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1433 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1434 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1435 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1436  }                                                                                                                 </span></pre></td>
                            <td><pre></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            