<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>166</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    166
                    <a href="165.html">prev</a>
                    <a href="167.html">next</a>
                    <a href="166_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_6e41116e816ffe5b940f6df83fbbf5a28e8c88bb_admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/ProductCustomPersistenceHandler.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;6e41116e816ffe5b940f6df83fbbf5a28e8c88bb:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/ProductCustomPersistenceHandler.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;6e41116e816ffe5b940f6df83fbbf5a28e8c88bb^1:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/ProductCustomPersistenceHandler.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;6e41116e816ffe5b940f6df83fbbf5a28e8c88bb^2:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/ProductCustomPersistenceHandler.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;7aa99231e33d2cad425553c3c1de5a674270c4e1:admin/broadleaf-admin-module/src/main/java/org/broadleafcommerce/admin/server/service/handler/ProductCustomPersistenceHandler.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [s]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="607567072764399459" onmouseenter="enter('607567072764399459');" onmouseout="out('607567072764399459');" style="">   1 /*-                                                                                                      </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="2735768235135741819" onmouseenter="enter('2735768235135741819');" onmouseout="out('2735768235135741819');" style="">   5  * Copyright (C) 2009 - 2022 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  18 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  21 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5003207573385979332" onmouseenter="enter('5003207573385979332');" onmouseout="out('5003207573385979332');" style=""><abbr title="  25 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManager;">  25 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManagðŸ”µ</abbr></span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  26 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  27 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  28 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  29 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  30 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-2618521349256495257" onmouseenter="enter('-2618521349256495257');" onmouseout="out('-2618521349256495257');" style="">  31 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeService;                             </span>
<span class="-3988587350630126043" onmouseenter="enter('-3988587350630126043');" onmouseout="out('-3988587350630126043');" style="">  32 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeServiceImpl;                         </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  33 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  34 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  35 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  36 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  37 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="5877661970606637396" onmouseenter="enter('5877661970606637396');" onmouseout="out('5877661970606637396');" style="">  38 import org.broadleafcommerce.core.catalog.domain.CategoryProductXrefImpl;                                </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  39 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  40 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  41 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  42 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  43 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-428848345283345816" onmouseenter="enter('-428848345283345816');" onmouseout="out('-428848345283345816');" style="">  44 import org.broadleafcommerce.core.catalog.service.type.ProductBundlePricingModelType;                    </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  45 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  46 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  47 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  48 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  49 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  50 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  51 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  52 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  53 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  54 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  55 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-4913438826169444493" onmouseenter="enter('-4913438826169444493');" onmouseout="out('-4913438826169444493');" style="">  56 import org.broadleafcommerce.openadmin.server.service.persistence.module.EmptyFilterValues;              </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  57 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  58 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  59 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  60 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  61 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  62 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  63 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  64 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  64 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  65 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  66 import org.springframework.stereotype.Component;                                                         </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  67 import java.lang.reflect.Field;                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  68 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  69 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  71 import java.util.Map;                                                                                    </span>
<span class="5924803009700709999" onmouseenter="enter('5924803009700709999');" onmouseout="out('5924803009700709999');" style="">  72 import java.util.stream.Stream;                                                                          </span>
<span  style="">  73                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  74 import javax.annotation.Resource;                                                                        </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  75 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  76 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  77 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  78 import javax.persistence.criteria.From;                                                                  </span>
<span class="4189756756281347615" onmouseenter="enter('4189756756281347615');" onmouseout="out('4189756756281347615');" style="">  79 import javax.persistence.criteria.JoinType;                                                              </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  80 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  81 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  82 import javax.persistence.criteria.Root;                                                                  </span>
<span  style="">  83                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84 /**                                                                                                      </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  85  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86  */                                                                                                      </span>
<span class="660262005045399639" onmouseenter="enter('660262005045399639');" onmouseout="out('660262005045399639');" style="">  87 @Component(&quot;blProductCustomPersistenceHandler&quot;)                                                          </span>
<span class="-5558200371078111093" onmouseenter="enter('-5558200371078111093');" onmouseout="out('-5558200371078111093');" style="">  88 public class ProductCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                   </span>
<span  style="">  89                                                                                                          </span>
<span class="6601773269924456427" onmouseenter="enter('6601773269924456427');" onmouseout="out('6601773269924456427');" style="">  90     protected static final String ID_PROPERTY = &quot;id&quot;;                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  92     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  93     protected CatalogService catalogService;                                                             </span>
<span  style="">  94                                                                                                          </span>
<span class="8724020527834493732" onmouseenter="enter('8724020527834493732');" onmouseout="out('8724020527834493732');" style="">  95     @Resource(name = &quot;blProductCustomPersistenceHandlerExtensionManager&quot;)                                </span>
<span class="5198675979006161834" onmouseenter="enter('5198675979006161834');" onmouseout="out('5198675979006161834');" style="">  96     protected ProductCustomPersistenceHandlerExtensionManager extensionManager;                          </span>
<span  style="">  97                                                                                                          </span>
<span class="-7078262064240547152" onmouseenter="enter('-7078262064240547152');" onmouseout="out('-7078262064240547152');" style="">  98     @Resource(name = &quot;blParentCategoryLegacyModeService&quot;)                                                </span>
<span class="7833791338969174941" onmouseenter="enter('7833791338969174941');" onmouseout="out('7833791338969174941');" style="">  99     protected ParentCategoryLegacyModeService parentCategoryLegacyModeService;                           </span>
<span  style=""> 100                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 101     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 102     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 103                                                                                                          </span>
<span class="4171055983434128927" onmouseenter="enter('4171055983434128927');" onmouseout="out('4171055983434128927');" style=""> 104     @Value(&quot;${product.query.limit:500}&quot;)                                                                 </span>
<span class="395756119071585853" onmouseenter="enter('395756119071585853');" onmouseout="out('395756119071585853');" style=""> 105     protected long queryLimit;                                                                           </span>
<span  style=""> 106                                                                                                          </span>
<span class="1763955632160691042" onmouseenter="enter('1763955632160691042');" onmouseout="out('1763955632160691042');" style=""> 107     @Value(&quot;${product.eager.fetch.associations.admin:true}&quot;)                                             </span>
<span class="-5859298812289369627" onmouseenter="enter('-5859298812289369627');" onmouseout="out('-5859298812289369627');" style=""> 108     protected boolean eagerFetchAssociations = true;                                                     </span>
<span  style=""> 109                                                                                                          </span>
<span class="7059678051681133033" onmouseenter="enter('7059678051681133033');" onmouseout="out('7059678051681133033');" style=""> 110     private static final Log LOG = LogFactory.getLog(ProductCustomPersistenceHandler.class);             </span>
<span  style=""> 111                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 112     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 113     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 114         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 114         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-1941058799374650916" onmouseenter="enter('-1941058799374650916');" onmouseout="out('-1941058799374650916');" style=""> 115         String[] customCriteria = persistencePackage.getCustomCriteria();                                </span>
<span class="-6187520531612273029" onmouseenter="enter('-6187520531612273029');" onmouseout="out('-6187520531612273029');" style=""><abbr title=" 116         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.class.getName().equals(ceilingEntityFullyQualifiedClassname);"> 116         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; PrðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117     }                                                                                                    </span>
<span  style=""> 118                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 120     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 121         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122     }                                                                                                    </span>
<span  style=""> 123                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 124     @Override                                                                                            </span>
<span class="-3598578007792382897" onmouseenter="enter('-3598578007792382897');" onmouseout="out('-3598578007792382897');" style=""> 125     public Boolean canHandleRemove(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 126         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127     }                                                                                                    </span>
<span  style=""> 128                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 129     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 130     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="-4855907251399383811" onmouseenter="enter('-4855907251399383811');" onmouseout="out('-4855907251399383811');" style=""> 131         return isRecursiveProductSelection(persistencePackage) || canHandleAdd(persistencePackage);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 135     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 136         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137     }                                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 139     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 140     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 140     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-3269781843971996957" onmouseenter="enter('-3269781843971996957');" onmouseout="out('-3269781843971996957');" style=""> 141         Map&lt;String, FieldMetadata&gt; md = getMetadata(persistencePackage, helper);                         </span>
<span  style=""> 142                                                                                                          </span>
<span class="4046647143093628321" onmouseenter="enter('4046647143093628321');" onmouseout="out('4046647143093628321');" style=""> 143         modifyParentCategoryMetadata(md);                                                                </span>
<span  style=""> 144                                                                                                          </span>
<span class="-3976181121340681385" onmouseenter="enter('-3976181121340681385');" onmouseout="out('-3976181121340681385');" style=""> 145         extensionManager.getProxy().manageInspect(md);                                                   </span>
<span  style=""> 146                                                                                                          </span>
<span class="3104749978175677264" onmouseenter="enter('3104749978175677264');" onmouseout="out('3104749978175677264');" style=""> 147         return getResultSet(persistencePackage, helper, md);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="1439455151726717615" onmouseenter="enter('1439455151726717615');" onmouseout="out('1439455151726717615');" style=""><abbr title=" 151     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao"> 151     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="7090980851977161261" onmouseenter="enter('7090980851977161261');" onmouseout="out('7090980851977161261');" style=""> 152             dynamicEntityDao, RecordHelper helper) throws ServiceException {                             </span>
<span  style=""> 153                                                                                                          </span>
<span class="7569586386580693394" onmouseenter="enter('7569586386580693394');" onmouseout="out('7569586386580693394');" style=""> 154         if (isRecursiveProductSelection(persistencePackage)) {                                           </span>
<span class="-8647006973930156734" onmouseenter="enter('-8647006973930156734');" onmouseout="out('-8647006973930156734');" style=""> 155             return getFilteredDynamicResultSet(persistencePackage, cto, helper);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156         }                                                                                                </span>
<span  style=""> 157                                                                                                          </span>
<span class="6757106929036196196" onmouseenter="enter('6757106929036196196');" onmouseout="out('6757106929036196196');" style=""> 158         boolean legacy = parentCategoryLegacyModeService.isLegacyMode();                                 </span>
<span  style=""> 159                                                                                                          </span>
<span class="-6242900732247061705" onmouseenter="enter('-6242900732247061705');" onmouseout="out('-6242900732247061705');" style=""> 160         //the following code applies when filters are present only:                                      </span>
<span class="7713333205546637982" onmouseenter="enter('7713333205546637982');" onmouseout="out('7713333205546637982');" style=""><abbr title=" 161         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to be matched"> 161         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the fiðŸ”µ</abbr></span>
<span class="-4534809142114175803" onmouseenter="enter('-4534809142114175803');" onmouseout="out('-4534809142114175803');" style=""><abbr title=" 162         //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the &quot;legacy&quot; mode."> 162         //against the categories chosen in the listGrid filter. The default behavior up to this point, asðŸ”µ</abbr></span>
<span class="4043022036079520545" onmouseenter="enter('4043022036079520545');" onmouseout="out('4043022036079520545');" style=""><abbr title=" 163         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCategory&quot;."> 163         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;ðŸ”µ</abbr></span>
<span class="-7849952188616772175" onmouseenter="enter('-7849952188616772175');" onmouseout="out('-7849952188616772175');" style=""><abbr title=" 164         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping in cto.additionalFilterMappings,"> 164         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilteðŸ”µ</abbr></span>
<span class="-1781087399901648456" onmouseenter="enter('-1781087399901648456');" onmouseout="out('-1781087399901648456');" style=""> 165         //which seeks matching values in  allParentCategoryXRefs instead                                 </span>
<span class="-5527176171961818632" onmouseenter="enter('-5527176171961818632');" onmouseout="out('-5527176171961818632');" style=""> 166         if (!legacy) {                                                                                   </span>
<span class="-4942654953935107368" onmouseenter="enter('-4942654953935107368');" onmouseout="out('-4942654953935107368');" style=""> 167             FilterAndSortCriteria fsc = cto.getCriteriaMap().get(&quot;defaultCategory&quot;);                     </span>
<span class="7732194668261263043" onmouseenter="enter('7732194668261263043');" onmouseout="out('7732194668261263043');" style=""> 168             if (fsc != null) {                                                                           </span>
<span class="5140613669097034739" onmouseenter="enter('5140613669097034739');" onmouseout="out('5140613669097034739');" style=""> 169                 List&lt;String&gt; filterValues = fsc.getFilterValues();                                       </span>
<span class="3991008560349807179" onmouseenter="enter('3991008560349807179');" onmouseout="out('3991008560349807179');" style=""> 170                 cto.getCriteriaMap().remove(&quot;defaultCategory&quot;);                                          </span>
<span  style=""> 171                                                                                                          </span>
<span class="5187909757738614354" onmouseenter="enter('5187909757738614354');" onmouseout="out('5187909757738614354');" style=""><abbr title=" 172                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;Long&gt;() {"> 172                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTranðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 173                     @Override                                                                            </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 174                     public Long transform(Object input) {                                                </span>
<span class="7261043087809466345" onmouseenter="enter('7261043087809466345');" onmouseout="out('7261043087809466345');" style=""> 175                         return Long.parseLong(((String) input));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 177                 });                                                                                      </span>
<span class="-3339810432835967648" onmouseenter="enter('-3339810432835967648');" onmouseout="out('-3339810432835967648');" style=""><abbr title=" 178                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();"> 178                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder(ðŸ”µ</abbr></span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 179                 CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                          </span>
<span class="1136355655038715928" onmouseenter="enter('1136355655038715928');" onmouseout="out('1136355655038715928');" style=""> 180                 Root&lt;CategoryProductXrefImpl&gt; root = criteria.from(CategoryProductXrefImpl.class);       </span>
<span class="-192292848609070031" onmouseenter="enter('-192292848609070031');" onmouseout="out('-192292848609070031');" style=""> 181                 criteria.select(root.get(&quot;product&quot;).get(&quot;id&quot;).as(Long.class));                           </span>
<span class="4051795261411779358" onmouseenter="enter('4051795261411779358');" onmouseout="out('4051795261411779358');" style=""> 182                 List&lt;Predicate&gt; restrictions = new ArrayList&lt;Predicate&gt;();                               </span>
<span class="7079639045649129257" onmouseenter="enter('7079639045649129257');" onmouseout="out('7079639045649129257');" style=""> 183                 restrictions.add(builder.equal(root.get(&quot;defaultReference&quot;), Boolean.TRUE));             </span>
<span class="5207279827061650716" onmouseenter="enter('5207279827061650716');" onmouseout="out('5207279827061650716');" style=""> 184                 if (CollectionUtils.isNotEmpty(transformedValues)) {                                     </span>
<span class="146441315649268392" onmouseenter="enter('146441315649268392');" onmouseout="out('146441315649268392');" style=""> 185                     restrictions.add(root.get(&quot;category&quot;).get(&quot;id&quot;).in(transformedValues));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                 }                                                                                        </span>
<span  style=""> 187                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 188                 criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                </span>
<span class="7055825944566640974" onmouseenter="enter('7055825944566640974');" onmouseout="out('7055825944566640974');" style=""><abbr title=" 189                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);"> 189                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteriaðŸ”µ</abbr></span>
<span class="8509583784823066198" onmouseenter="enter('8509583784823066198');" onmouseout="out('8509583784823066198');" style=""> 190                 List&lt;Long&gt; productIds = query.getResultList();                                           </span>
<span class="-1516584047908894525" onmouseenter="enter('-1516584047908894525');" onmouseout="out('-1516584047908894525');" style=""><abbr title=" 191                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));"> 191                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[pðŸ”µ</abbr></span>
<span  style=""> 192                                                                                                          </span>
<span class="5110006719648509717" onmouseenter="enter('5110006719648509717');" onmouseout="out('5110006719648509717');" style=""> 193                 if (productIds.size() == 0) {                                                            </span>
<span class="-8650761106430502088" onmouseenter="enter('-8650761106430502088');" onmouseout="out('-8650761106430502088');" style=""> 194                     return new DynamicResultSet(null, new Entity[0], 0);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                 }                                                                                        </span>
<span class="-924931052995986786" onmouseenter="enter('-924931052995986786');" onmouseout="out('-924931052995986786');" style=""> 196                 if (productIds.size() &lt;= queryLimit) {                                                   </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 197                     FilterMapping filterMapping = new FilterMapping()                                    </span>
<span class="-3543945038191067122" onmouseenter="enter('-3543945038191067122');" onmouseout="out('-3543945038191067122');" style=""> 198                             .withFieldPath(new FieldPath().withTargetProperty(&quot;id&quot;))                     </span>
<span class="2232883807641366792" onmouseenter="enter('2232883807641366792');" onmouseout="out('2232883807641366792');" style=""> 199                             .withDirectFilterValues(productIds)                                          </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 200                             .withRestriction(new Restriction()                                           </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 201                                                      .withPredicateProvider(new PredicateProvider() {    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 202                                                                                 @Override                </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 203                                                                                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 203                                                                                 public Predicate buildPreðŸ”µ</abbr></span>
<span class="-5114847374786337606" onmouseenter="enter('-5114847374786337606');" onmouseout="out('-5114847374786337606');" style=""><abbr title=" 204                                                                                                                 From root, String ceilingEntity, String fullPropertyName,"> 204                                                                                                          ðŸ”µ</abbr></span>
<span class="8513618248320586908" onmouseenter="enter('8513618248320586908');" onmouseout="out('8513618248320586908');" style=""><abbr title=" 205                                                                                                                 Path explicitPath, List directValues) {"> 205                                                                                                          ðŸ”µ</abbr></span>
<span class="-7844596111771279367" onmouseenter="enter('-7844596111771279367');" onmouseout="out('-7844596111771279367');" style=""><abbr title=" 206                                                                                     return explicitPath.in(directValues);"> 206                                                                                     return explicitPath.iðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                                                                                 }                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                                                                             }                            </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 209                                                      )                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 210                             );                                                                           </span>
<span class="8464857299985770317" onmouseenter="enter('8464857299985770317');" onmouseout="out('8464857299985770317');" style=""> 211                     cto.getAdditionalFilterMappings().add(filterMapping);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 212                 } else {                                                                                 </span>
<span class="-5679004918959824296" onmouseenter="enter('-5679004918959824296');" onmouseout="out('-5679004918959824296');" style=""> 213                     String joined = StringUtils.join(transformedValues, &#x27;,&#x27;);                            </span>
<span class="-7138538771694428625" onmouseenter="enter('-7138538771694428625');" onmouseout="out('-7138538771694428625');" style=""><abbr title=" 214                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since there are &quot; +"> 214                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query sðŸ”µ</abbr></span>
<span class="-3268164569215202291" onmouseenter="enter('-3268164569215202291');" onmouseout="out('-3268164569215202291');" style=""><abbr title=" 215                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected default categories(%s). This is a &quot; +"> 215                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the ðŸ”µ</abbr></span>
<span class="6513435278584853007" onmouseenter="enter('6513435278584853007');" onmouseout="out('6513435278584853007');" style=""> 216                                            &quot;filter query limitation.&quot;, joined));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                 }                                                                                        </span>
<span class="-6371393405809532308" onmouseenter="enter('-6371393405809532308');" onmouseout="out('-6371393405809532308');" style=""> 218                 cto.getNonCountAdditionalFilterMappings().add(                                           </span>
<span class="861084839636182372" onmouseenter="enter('861084839636182372');" onmouseout="out('861084839636182372');" style=""> 219                         new FilterMapping().withFieldPath(new FieldPath().                               </span>
<span class="-2774318940771911356" onmouseenter="enter('-2774318940771911356');" onmouseout="out('-2774318940771911356');" style=""> 220                                 withAssociationPath(Arrays.asList(&quot;allParentCategoryXrefs&quot;,&quot;category&quot;)). </span>
<span class="821868564123592571" onmouseenter="enter('821868564123592571');" onmouseout="out('821868564123592571');" style=""> 221                                 withTargetPropertyPieces(Arrays.asList(&quot;name&quot;)))                         </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 222                                 .withDirectFilterValues(new EmptyFilterValues())                         </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 223                                 .withRestriction(new Restriction()                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 224                                         .withPredicateProvider(new PredicateProvider() {                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225                                             @Override                                                    </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 226                                             public Predicate buildPredicate(CriteriaBuilder builder,     </span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 227                                                                             FieldPathBuilder fieldPathBuilder, From root,"> 227                                                                             FieldPathBuilder fieldPathBuiðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""> 228                                                                             String ceilingEntity,        </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 229                                                                             String fullPropertyName, Path explicitPath,"> 229                                                                             String fullPropertyName, PathðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 230                                                                             List directValues) {         </span>
<span class="-8553876951484288081" onmouseenter="enter('-8553876951484288081');" onmouseout="out('-8553876951484288081');" style=""><abbr title=" 231                                                 //expect it to be allParentCategoryXrefs.category.name, so we need to restrict on allParentCategoryXrefs - 2 levels up"> 231                                                 //expect it to be allParentCategoryXrefs.category.name, sðŸ”µ</abbr></span>
<span class="8037864455504608737" onmouseenter="enter('8037864455504608737');" onmouseout="out('8037864455504608737');" style=""><abbr title=" 232                                                 Predicate equal = builder.equal(explicitPath.getParentPath().getParentPath().get(&quot;defaultReference&quot;), Boolean.TRUE);"> 232                                                 Predicate equal = builder.equal(explicitPath.getParentPatðŸ”µ</abbr></span>
<span class="1665766703297118664" onmouseenter="enter('1665766703297118664');" onmouseout="out('1665766703297118664');" style=""> 233                                                 return equal;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234                                             }                                                            </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 235                                         })                                                               </span>
<span class="-3422099077497392780" onmouseenter="enter('-3422099077497392780');" onmouseout="out('-3422099077497392780');" style=""> 236                                 ).withSortDirection(fsc.getSortDirection()));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238         }                                                                                                </span>
<span  style=""> 239                                                                                                          </span>
<span class="2582332595020198633" onmouseenter="enter('2582332595020198633');" onmouseout="out('2582332595020198633');" style=""> 240         if (eagerFetchAssociations) {                                                                    </span>
<span class="6234898006418452293" onmouseenter="enter('6234898006418452293');" onmouseout="out('6234898006418452293');" style=""> 241             cto.getNonCountAdditionalFilterMappings().add(new FilterMapping()                            </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""><abbr title=" 242                                                                   .withDirectFilterValues(new EmptyFilterValues())"> 242                                                                   .withDirectFilterValues(new EmptyFilterðŸ”µ</abbr></span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 243                                                                   .withRestriction(new Restriction()     </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""><abbr title=" 244                                                                                            .withPredicateProvider(new PredicateProvider() {"> 244                                                                                            .withPredicateðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 245                                                                                                @Override </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""><abbr title=" 246                                                                                                public Predicate buildPredicate(CriteriaBuilder builder,"> 246                                                                                                public PreðŸ”µ</abbr></span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 247                                                                                                                                FieldPathBuilder fieldPathBuilder, From root,"> 247                                                                                                          ðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""><abbr title=" 248                                                                                                                                String ceilingEntity,"> 248                                                                                                          ðŸ”µ</abbr></span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 249                                                                                                                                String fullPropertyName, Path explicitPath,"> 249                                                                                                          ðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""><abbr title=" 250                                                                                                                                List directValues) {"> 250                                                                                                          ðŸ”µ</abbr></span>
<span class="624264344901137787" onmouseenter="enter('624264344901137787');" onmouseout="out('624264344901137787');" style=""><abbr title=" 251                                                                                                    root.fetch(&quot;defaultSku&quot;, JoinType.LEFT);"> 251                                                                                                    root.fðŸ”µ</abbr></span>
<span class="2236319445290317600" onmouseenter="enter('2236319445290317600');" onmouseout="out('2236319445290317600');" style=""><abbr title=" 252                                                                                                    root.fetch(&quot;defaultCategory&quot;, JoinType.LEFT);"> 252                                                                                                    root.fðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""><abbr title=" 253                                                                                                    return null;"> 253                                                                                                    returnðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                                                                                                }         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 255                                                                                            })            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 256                                                                   ));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span class="-5277136380896832206" onmouseenter="enter('-5277136380896832206');" onmouseout="out('-5277136380896832206');" style=""> 258         return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259     }                                                                                                    </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 262     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 262     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 263         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 264         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 265             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 265             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-1738937064203927240" onmouseenter="enter('-1738937064203927240');" onmouseout="out('-1738937064203927240');" style=""> 266             Product adminInstance = (Product) Class.forName(entity.getType()[0]).newInstance();          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 267             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 267             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 268                                                                                                          </span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 269             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 270                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271             }                                                                                            </span>
<span  style=""> 272                                                                                                          </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 273             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 273             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 274             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 275                                                                                                          </span>
<span class="2994500046663637288" onmouseenter="enter('2994500046663637288');" onmouseout="out('2994500046663637288');" style=""> 276             //Since none of the Sku fields are required, it&#x27;s possible that the user did not fill out    </span>
<span class="-1662985695084142247" onmouseenter="enter('-1662985695084142247');" onmouseout="out('-1662985695084142247');" style=""><abbr title=" 277             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiate one"> 277             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so iðŸ”µ</abbr></span>
<span class="-4407708836004135952" onmouseenter="enter('-4407708836004135952');" onmouseout="out('-4407708836004135952');" style=""> 278             if (adminInstance.getDefaultSku() == null) {                                                 </span>
<span class="-5869950698936088971" onmouseenter="enter('-5869950698936088971');" onmouseout="out('-5869950698936088971');" style=""> 279                 Sku newSku = catalogService.createSku();                                                 </span>
<span class="3758063373327618746" onmouseenter="enter('3758063373327618746');" onmouseout="out('3758063373327618746');" style=""> 280                 dynamicEntityDao.persist(newSku);                                                        </span>
<span class="3627601061948392291" onmouseenter="enter('3627601061948392291');" onmouseout="out('3627601061948392291');" style=""> 281                 adminInstance.setDefaultSku(newSku);                                                     </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 282                 adminInstance = dynamicEntityDao.merge(adminInstance);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283             }                                                                                            </span>
<span  style=""> 284                                                                                                          </span>
<span class="1398885520878604990" onmouseenter="enter('1398885520878604990');" onmouseout="out('1398885520878604990');" style=""> 285             //also set the default product for the Sku                                                   </span>
<span class="-5769689371067636269" onmouseenter="enter('-5769689371067636269');" onmouseout="out('-5769689371067636269');" style=""> 286             adminInstance.getDefaultSku().setDefaultProduct(adminInstance);                              </span>
<span class="-8818629679601416674" onmouseenter="enter('-8818629679601416674');" onmouseout="out('-8818629679601416674');" style=""> 287             dynamicEntityDao.merge(adminInstance.getDefaultSku());                                       </span>
<span  style=""> 288                                                                                                          </span>
<span class="6340800826002936969" onmouseenter="enter('6340800826002936969');" onmouseout="out('6340800826002936969');" style=""> 289             // if this is a Pre-Add, skip the rest of the method                                         </span>
<span class="4698552646741459586" onmouseenter="enter('4698552646741459586');" onmouseout="out('4698552646741459586');" style=""> 290             if (entity.isPreAdd()) {                                                                     </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 291                 return helper.getRecord(adminProperties, adminInstance, null, null);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292             }                                                                                            </span>
<span  style=""> 293                                                                                                          </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 294             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 295             if (extensionManager != null) {                                                              </span>
<span class="-1778606721590329888" onmouseenter="enter('-1778606721590329888');" onmouseout="out('-1778606721590329888');" style=""><abbr title=" 296                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persistencePackage, adminInstance);"> 296                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAddðŸ”µ</abbr></span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 297                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 299             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 300                 setupXref(adminInstance);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301             }                                                                                            </span>
<span  style=""> 302                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 303             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 304         } catch (Exception e) {                                                                          </span>
<span class="7134174968934853795" onmouseenter="enter('7134174968934853795');" onmouseout="out('7134174968934853795');" style=""> 305             throw new ServiceException(&quot;Unable to add entity for &quot; + entity.getType()[0], e);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 309     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 310     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 310     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 311         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 312         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 313             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 313             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span  style=""> 314                                                                                                          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 315             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 315             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 316                                                                                                          </span>
<span class="1819538413343548026" onmouseenter="enter('1819538413343548026');" onmouseout="out('1819538413343548026');" style=""><abbr title=" 317             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategory&quot;));"> 317             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategoðŸ”µ</abbr></span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 318             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="6303363757907394261" onmouseenter="enter('6303363757907394261');" onmouseout="out('6303363757907394261');" style=""><abbr title=" 319             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 319             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findPropertðŸ”µ</abbr></span>
<span class="-1298210778461020296" onmouseenter="enter('-1298210778461020296');" onmouseout="out('-1298210778461020296');" style=""><abbr title=" 320                 //Change the inherited type so that this property is disconnected from the entity and validation is temporarily skipped."> 320                 //Change the inherited type so that this property is disconnected from the entity and valðŸ”µ</abbr></span>
<span class="5827004128286973668" onmouseenter="enter('5827004128286973668');" onmouseout="out('5827004128286973668');" style=""><abbr title=" 321                 //This is useful when the defaultCategory was previously completely empty for whatever reason. Without this, such"> 321                 //This is useful when the defaultCategory was previously completely empty for whatever reðŸ”µ</abbr></span>
<span class="-8493051113864514358" onmouseenter="enter('-8493051113864514358');" onmouseout="out('-8493051113864514358');" style=""><abbr title=" 322                 //a case would fail the validation, even though the property was specified in the submission."> 322                 //a case would fail the validation, even though the property was specified in the submissðŸ”µ</abbr></span>
<span class="-8335887377494536791" onmouseenter="enter('-8335887377494536791');" onmouseout="out('-8335887377494536791');" style=""> 323                 defaultCategory.setInheritedFromType(String.class.getName());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324             }                                                                                            </span>
<span  style=""> 325                                                                                                          </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 326             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="6153157527633548109" onmouseenter="enter('6153157527633548109');" onmouseout="out('6153157527633548109');" style=""><abbr title=" 327             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 327             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]ðŸ”µ</abbr></span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 328             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 329                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330             }                                                                                            </span>
<span  style=""> 331                                                                                                          </span>
<span class="-710126092547245946" onmouseenter="enter('-710126092547245946');" onmouseout="out('-710126092547245946');" style=""> 332             CategoryProductXref oldDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="-5817707795302619279" onmouseenter="enter('-5817707795302619279');" onmouseout="out('-5817707795302619279');" style=""><abbr title=" 333             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched from db"> 333             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not beðŸ”µ</abbr></span>
<span class="6655495238084243637" onmouseenter="enter('6655495238084243637');" onmouseout="out('6655495238084243637');" style=""><abbr title=" 334             //and it will cause validation error, we should allow deployemnt of product with category in sandbox state"> 334             //and it will cause validation error, we should allow deployemnt of product with category in ðŸ”µ</abbr></span>
<span class="6453615407021429154" onmouseenter="enter('6453615407021429154');" onmouseout="out('6453615407021429154');" style=""> 335             //so override required flag for that field during deployment                                 </span>
<span class="-367004153561380049" onmouseenter="enter('-367004153561380049');" onmouseout="out('-367004153561380049');" style=""> 336             if(BroadleafRequestContext.getBroadleafRequestContext().isProductionSandBox()){              </span>
<span class="-3632045312370469531" onmouseenter="enter('-3632045312370469531');" onmouseout="out('-3632045312370469531');" style=""> 337                 ((BasicFieldMetadata)adminProperties.get(&quot;defaultCategory&quot;)).setRequiredOverride(false); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 339             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 339             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 340             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 341             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 342             if (extensionManager != null) {                                                              </span>
<span class="-3727608922273128682" onmouseenter="enter('-3727608922273128682');" onmouseout="out('-3727608922273128682');" style=""><abbr title=" 343                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdate"> 343                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdðŸ”µ</abbr></span>
<span class="-5509937458278318351" onmouseenter="enter('-5509937458278318351');" onmouseout="out('-5509937458278318351');" style=""> 344                         (persistencePackage, adminInstance);                                             </span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 345                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span  style=""> 346                                                                                                          </span>
<span class="1636360182407915778" onmouseenter="enter('1636360182407915778');" onmouseout="out('1636360182407915778');" style=""> 347                 extensionManager.getProxy().manageFields(persistencePackage, adminInstance);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 349             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 350                 setupXref(adminInstance);                                                                </span>
<span class="-7967199691392957007" onmouseenter="enter('-7967199691392957007');" onmouseout="out('-7967199691392957007');" style=""> 351                 removeOldDefault(adminInstance, oldDefault, entity);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352             }                                                                                            </span>
<span  style=""> 353                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 354             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 355         } catch (Exception e) {                                                                          </span>
<span class="-8723674804020595812" onmouseenter="enter('-8723674804020595812');" onmouseout="out('-8723674804020595812');" style=""> 356             throw new ServiceException(&quot;Unable to update entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358     }                                                                                                    </span>
<span  style=""> 359                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 360     @Override                                                                                            </span>
<span class="1887636609613592843" onmouseenter="enter('1887636609613592843');" onmouseout="out('1887636609613592843');" style=""><abbr title=" 361     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 361     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 362         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 363         try {                                                                                            </span>
<span class="3243810268662008348" onmouseenter="enter('3243810268662008348');" onmouseout="out('3243810268662008348');" style=""><abbr title=" 364             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);"> 364             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entityðŸ”µ</abbr></span>
<span class="-4186523034208284789" onmouseenter="enter('-4186523034208284789');" onmouseout="out('-4186523034208284789');" style=""> 365             removeProduct(persistencePackage, adminInstance, helper);                                    </span>
<span class="29076383544473850" onmouseenter="enter('29076383544473850');" onmouseout="out('29076383544473850');" style=""> 366             List&lt;Sku&gt; skuList = adminInstance.getAllSkus();                                              </span>
<span class="-2506961360510940575" onmouseenter="enter('-2506961360510940575');" onmouseout="out('-2506961360510940575');" style=""> 367             for (Sku sku : skuList) {                                                                    </span>
<span class="2039383434106799748" onmouseenter="enter('2039383434106799748');" onmouseout="out('2039383434106799748');" style=""> 368                 catalogService.removeSku(sku);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369             }                                                                                            </span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 370         } catch (ClassNotFoundException e) {                                                             </span>
<span class="8549847936080404575" onmouseenter="enter('8549847936080404575');" onmouseout="out('8549847936080404575');" style=""> 371             throw new ServiceException(&quot;Unable to remove entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="-8634314107060974128" onmouseenter="enter('-8634314107060974128');" onmouseout="out('-8634314107060974128');" style=""><abbr title=" 375     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,"> 375     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntðŸ”µ</abbr></span>
<span class="2232129114834499824" onmouseenter="enter('2232129114834499824');" onmouseout="out('2232129114834499824');" style=""> 376                                        Entity entity) throws ClassNotFoundException {                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 377         PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();  </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 378         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 378         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getNaðŸ”µ</abbr></span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 379         Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                               </span>
<span class="3403576257396241131" onmouseenter="enter('3403576257396241131');" onmouseout="out('3403576257396241131');" style=""> 380         String type = entity.getType()[0];                                                               </span>
<span class="791413654597460382" onmouseenter="enter('791413654597460382');" onmouseout="out('791413654597460382');" style=""> 381         Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);    </span>
<span  style=""> 382                                                                                                          </span>
<span class="2848615422851099691" onmouseenter="enter('2848615422851099691');" onmouseout="out('2848615422851099691');" style=""> 383         return adminInstance;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="-7276315230897223897" onmouseenter="enter('-7276315230897223897');" onmouseout="out('-7276315230897223897');" style=""><abbr title=" 386     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {"> 386     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelpðŸ”µ</abbr></span>
<span class="8222559285797311452" onmouseenter="enter('8222559285797311452');" onmouseout="out('8222559285797311452');" style=""> 387         catalogService.removeProduct(adminInstance);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 390     /**                                                                                                  </span>
<span class="-6565674410629622369" onmouseenter="enter('-6565674410629622369');" onmouseout="out('-6565674410629622369');" style=""> 391      * If the pricing model is of type item_sum, that property should not be required                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 392      *                                                                                                   </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 393      * @param adminInstance                                                                              </span>
<span class="1188154204740832420" onmouseenter="enter('1188154204740832420');" onmouseout="out('1188154204740832420');" style=""> 394      * @param adminProperties                                                                            </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 395      * @param entity                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396      */                                                                                                  </span>
<span class="1796231511775682058" onmouseenter="enter('1796231511775682058');" onmouseout="out('1796231511775682058');" style=""><abbr title=" 397     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminProperties, Entity entity) {"> 397     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; ðŸ”µ</abbr></span>
<span class="-7898829768536246574" onmouseenter="enter('-7898829768536246574');" onmouseout="out('-7898829768536246574');" style=""> 398         //no required validation for product bundles                                                     </span>
<span class="2028132163697204828" onmouseenter="enter('2028132163697204828');" onmouseout="out('2028132163697204828');" style=""> 399         ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(false); </span>
<span class="-1136678238396033433" onmouseenter="enter('-1136678238396033433');" onmouseout="out('-1136678238396033433');" style=""> 400         if (entity.getPMap().get(&quot;pricingModel&quot;) != null) {                                              </span>
<span class="-5810729812081766749" onmouseenter="enter('-5810729812081766749');" onmouseout="out('-5810729812081766749');" style=""><abbr title=" 401             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValue())) {"> 401             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;ðŸ”µ</abbr></span>
<span class="-8087214156619436047" onmouseenter="enter('-8087214156619436047');" onmouseout="out('-8087214156619436047');" style=""><abbr title=" 402                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(true);"> 402                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405     }                                                                                                    </span>
<span  style=""> 406                                                                                                          </span>
<span class="-6194621554657272575" onmouseenter="enter('-6194621554657272575');" onmouseout="out('-6194621554657272575');" style=""> 407     protected Boolean isDefaultCategoryLegacyMode() {                                                    </span>
<span class="-2222712760012631506" onmouseenter="enter('-2222712760012631506');" onmouseout="out('-2222712760012631506');" style=""><abbr title=" 408         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeService();"> 408         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyðŸ”µ</abbr></span>
<span class="-3125121052433413106" onmouseenter="enter('-3125121052433413106');" onmouseout="out('-3125121052433413106');" style=""> 409         if (legacyModeService != null) {                                                                 </span>
<span class="-7433711904609854570" onmouseenter="enter('-7433711904609854570');" onmouseout="out('-7433711904609854570');" style=""> 410             return legacyModeService.isLegacyMode();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 412         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413     }                                                                                                    </span>
<span  style=""> 414                                                                                                          </span>
<span class="-182298883698048941" onmouseenter="enter('-182298883698048941');" onmouseout="out('-182298883698048941');" style=""> 415     protected void modifyParentCategoryMetadata(Map&lt;String, FieldMetadata&gt; md) {                         </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 416         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-3233029088333925194" onmouseenter="enter('-3233029088333925194');" onmouseout="out('-3233029088333925194');" style=""> 417             md.remove(&quot;allParentCategoryXrefs&quot;);                                                         </span>
<span  style=""> 418                                                                                                          </span>
<span class="-8850866426953517740" onmouseenter="enter('-8850866426953517740');" onmouseout="out('-8850866426953517740');" style=""> 419             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) md.get(&quot;defaultCategory&quot;));       </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 420             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422     }                                                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="4323219351741765804" onmouseenter="enter('4323219351741765804');" onmouseout="out('4323219351741765804');" style=""> 424     protected Category getExistingDefaultCategory(Product product) {                                     </span>
<span class="4785057058955893593" onmouseenter="enter('4785057058955893593');" onmouseout="out('4785057058955893593');" style=""> 425         //Make sure we get the actual field value - not something manipulated in the getter              </span>
<span class="-7097588232152162933" onmouseenter="enter('-7097588232152162933');" onmouseout="out('-7097588232152162933');" style=""> 426         Category parentCategory;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="1642298731132209432" onmouseenter="enter('1642298731132209432');" onmouseout="out('1642298731132209432');" style=""> 428             Field defaultCategory = ProductImpl.class.getDeclaredField(&quot;defaultCategory&quot;);               </span>
<span class="-5472088449890863756" onmouseenter="enter('-5472088449890863756');" onmouseout="out('-5472088449890863756');" style=""> 429             defaultCategory.setAccessible(true);                                                         </span>
<span class="-5032854148355745900" onmouseenter="enter('-5032854148355745900');" onmouseout="out('-5032854148355745900');" style=""> 430             parentCategory = (Category) defaultCategory.get(product);                                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 431         } catch (NoSuchFieldException e) {                                                               </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 432             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 433         } catch (IllegalAccessException e) {                                                             </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 434             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span class="-4827692301542162901" onmouseenter="enter('-4827692301542162901');" onmouseout="out('-4827692301542162901');" style=""> 436         return parentCategory;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437     }                                                                                                    </span>
<span  style=""> 438                                                                                                          </span>
<span class="2198792804957949705" onmouseenter="enter('2198792804957949705');" onmouseout="out('2198792804957949705');" style=""><abbr title=" 439     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity) {"> 439     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity)ðŸ”µ</abbr></span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 440         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-8408462162055715920" onmouseenter="enter('-8408462162055715920');" onmouseout="out('-8408462162055715920');" style=""><abbr title=" 441             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 441             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findPropertyðŸ”µ</abbr></span>
<span class="3184747591230429719" onmouseenter="enter('3184747591230429719');" onmouseout="out('3184747591230429719');" style=""> 442                 adminInstance.setCategory(null);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443             }                                                                                            </span>
<span class="7434653101319155783" onmouseenter="enter('7434653101319155783');" onmouseout="out('7434653101319155783');" style=""> 444             CategoryProductXref newDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="1862582476950403842" onmouseenter="enter('1862582476950403842');" onmouseout="out('1862582476950403842');" style=""> 445             if (oldDefault != null &amp;&amp; !oldDefault.equals(newDefault)) {                                  </span>
<span class="-2218242322092133143" onmouseenter="enter('-2218242322092133143');" onmouseout="out('-2218242322092133143');" style=""> 446                 adminInstance.getAllParentCategoryXrefs().remove(oldDefault);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449     }                                                                                                    </span>
<span  style=""> 450                                                                                                          </span>
<span class="902349756604301531" onmouseenter="enter('902349756604301531');" onmouseout="out('902349756604301531');" style=""> 451     protected void setupXref(Product adminInstance) {                                                    </span>
<span class="1047341479251260893" onmouseenter="enter('1047341479251260893');" onmouseout="out('1047341479251260893');" style=""> 452         if (isDefaultCategoryLegacyMode()) {                                                             </span>
<span class="4336193572473592352" onmouseenter="enter('4336193572473592352');" onmouseout="out('4336193572473592352');" style=""> 453             CategoryProductXref categoryXref = new CategoryProductXrefImpl();                            </span>
<span class="3362376343183691887" onmouseenter="enter('3362376343183691887');" onmouseout="out('3362376343183691887');" style=""> 454             categoryXref.setCategory(getExistingDefaultCategory(adminInstance));                         </span>
<span class="998500482226783196" onmouseenter="enter('998500482226783196');" onmouseout="out('998500482226783196');" style=""> 455             categoryXref.setProduct(adminInstance);                                                      </span>
<span class="-2133389353332895077" onmouseenter="enter('-2133389353332895077');" onmouseout="out('-2133389353332895077');" style=""><abbr title=" 456             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() != null) {"> 456             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCateðŸ”µ</abbr></span>
<span class="-7221514252473967991" onmouseenter="enter('-7221514252473967991');" onmouseout="out('-7221514252473967991');" style=""> 457                 adminInstance.getAllParentCategoryXrefs().add(categoryXref);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460     }                                                                                                    </span>
<span  style=""> 461                                                                                                          </span>
<span class="-4866520984434663516" onmouseenter="enter('-4866520984434663516');" onmouseout="out('-4866520984434663516');" style=""> 462     protected CategoryProductXref getCurrentDefaultXref(Product product) {                               </span>
<span class="5121334440715645479" onmouseenter="enter('5121334440715645479');" onmouseout="out('5121334440715645479');" style=""> 463         CategoryProductXref currentDefault = null;                                                       </span>
<span class="4669448491831723006" onmouseenter="enter('4669448491831723006');" onmouseout="out('4669448491831723006');" style=""> 464         List&lt;CategoryProductXref&gt; xrefs = product.getAllParentCategoryXrefs();                           </span>
<span class="-1899512729290259350" onmouseenter="enter('-1899512729290259350');" onmouseout="out('-1899512729290259350');" style=""> 465         if (!CollectionUtils.isEmpty(xrefs)) {                                                           </span>
<span class="-1984009506268747903" onmouseenter="enter('-1984009506268747903');" onmouseout="out('-1984009506268747903');" style=""> 466             for (CategoryProductXref xref : xrefs) {                                                     </span>
<span class="113451359587339395" onmouseenter="enter('113451359587339395');" onmouseout="out('113451359587339395');" style=""><abbr title=" 467                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReference()) {"> 467                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaulðŸ”µ</abbr></span>
<span class="-4081682415228113248" onmouseenter="enter('-4081682415228113248');" onmouseout="out('-4081682415228113248');" style=""> 468                     currentDefault = xref;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 469                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span class="5312955631235184797" onmouseenter="enter('5312955631235184797');" onmouseout="out('5312955631235184797');" style=""> 473         return currentDefault;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474     }                                                                                                    </span>
<span  style=""> 475                                                                                                          </span>
<span class="4094641218853198204" onmouseenter="enter('4094641218853198204');" onmouseout="out('4094641218853198204');" style=""> 476     protected boolean isRecursiveProductSelection(PersistencePackage persistencePackage) {               </span>
<span class="7271253784317390082" onmouseenter="enter('7271253784317390082');" onmouseout="out('7271253784317390082');" style=""> 477         final List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());       </span>
<span class="5034407762644036308" onmouseenter="enter('5034407762644036308');" onmouseout="out('5034407762644036308');" style=""> 478         return Stream.of(&quot;upsaleProduct&quot;, &quot;crossSaleProduct&quot;, &quot;requestingField=addOnProduct&quot;)            </span>
<span class="-8438117934997670681" onmouseenter="enter('-8438117934997670681');" onmouseout="out('-8438117934997670681');" style=""> 479                 .anyMatch(customCriteria::contains);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="-3368052144456426396" onmouseenter="enter('-3368052144456426396');" onmouseout="out('-3368052144456426396');" style=""><abbr title=" 482     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicateProvider) {"> 482     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider pðŸ”µ</abbr></span>
<span  style=""> 483                                                                                                          </span>
<span class="8057622255252958217" onmouseenter="enter('8057622255252958217');" onmouseout="out('8057622255252958217');" style=""> 484         FieldPath fieldPath = new FieldPath().withTargetProperty(targetPropertyName);                    </span>
<span class="-6596211108915962883" onmouseenter="enter('-6596211108915962883');" onmouseout="out('-6596211108915962883');" style=""> 485         EmptyFilterValues directFilterValues = new EmptyFilterValues();                                  </span>
<span class="4277357472881062872" onmouseenter="enter('4277357472881062872');" onmouseout="out('4277357472881062872');" style=""> 486         Restriction newRestriction = new Restriction().withPredicateProvider(predicateProvider);         </span>
<span  style=""> 487                                                                                                          </span>
<span class="3608289770015613450" onmouseenter="enter('3608289770015613450');" onmouseout="out('3608289770015613450');" style=""> 488         return new FilterMapping()                                                                       </span>
<span class="-6035283433958931422" onmouseenter="enter('-6035283433958931422');" onmouseout="out('-6035283433958931422');" style=""> 489             .withFieldPath(fieldPath)                                                                    </span>
<span class="1581873956966044880" onmouseenter="enter('1581873956966044880');" onmouseout="out('1581873956966044880');" style=""> 490             .withDirectFilterValues(directFilterValues)                                                  </span>
<span class="27993374560272883" onmouseenter="enter('27993374560272883');" onmouseout="out('27993374560272883');" style=""> 491             .withRestriction(newRestriction);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492     }                                                                                                    </span>
<span  style=""> 493                                                                                                          </span>
<span class="1303149189704190318" onmouseenter="enter('1303149189704190318');" onmouseout="out('1303149189704190318');" style=""><abbr title=" 494     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferObject cto, RecordHelper helper) throws ServiceException {"> 494     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriðŸ”µ</abbr></span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 495 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-3386273820962459143" onmouseenter="enter('-3386273820962459143');" onmouseout="out('-3386273820962459143');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 496         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0) {"> 496         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0)ðŸ”µ</abbr></span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 497             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 497             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 498                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 499                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 499                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 500                                                 String ceilingEntity, String fullPropertyName, Path explicitPath,"> 500                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 501                                                 List directValues) {                                     </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 502                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 502                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 503                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 504             });                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 505 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 506         FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 506         FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicatePðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507             @Override                                                                                    </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 508             public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 508             public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, FðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 509                                             String ceilingEntity, String fullPropertyName, Path explicitPath,"> 509                                             String ceilingEntity, String fullPropertyName, Path explicitPðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510                                             List directValues) {                                         </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 511                 return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 511                 return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513         });                                                                                              </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514         cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                   </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 515         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 515         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516         PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                     </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 517 =======                                                                                                  </span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-4365624777334076097" onmouseenter="enter('-4365624777334076097');" onmouseout="out('-4365624777334076097');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         if (sectionCrumbs != null &amp;&amp; sectionCrumbs.length &gt; 0) {                                         </span>
<span class="-4393846817404821398" onmouseenter="enter('-4393846817404821398');" onmouseout="out('-4393846817404821398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520             FilterMapping defaultCategoryMapping = this.createFilterMappingForProperty(                  </span>
<span class="-1391188242443598318" onmouseenter="enter('-1391188242443598318');" onmouseout="out('-1391188242443598318');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521                     ID_PROPERTY,                                                                         </span>
<span class="-7754832296053455105" onmouseenter="enter('-7754832296053455105');" onmouseout="out('-7754832296053455105');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 522                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, directValues)"> 522                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, direðŸ”µ</abbr></span>
<span class="-2761785120798275454" onmouseenter="enter('-2761785120798275454');" onmouseout="out('-2761785120798275454');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 523                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()))"> 523                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524             );                                                                                           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 525 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style=""> 526             cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527         }                                                                                                </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 528         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 528         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style=""> 529         PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                     </span>
<span class="6289449121708775001" onmouseenter="enter('6289449121708775001');" onmouseout="out('6289449121708775001');" style=""> 530         return persistenceModule.fetch(persistencePackage, cto);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532 }                                                                                                        </span></pre></td>
                            <td><pre><span class="607567072764399459" onmouseenter="enter('607567072764399459');" onmouseout="out('607567072764399459');" style="">   1 /*-                                                                                                      </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="2735768235135741819" onmouseenter="enter('2735768235135741819');" onmouseout="out('2735768235135741819');" style="">   5  * Copyright (C) 2009 - 2022 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  18 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  21 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  22 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  23 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  24 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5003207573385979332" onmouseenter="enter('5003207573385979332');" onmouseout="out('5003207573385979332');" style=""><abbr title="  25 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManager;">  25 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManagðŸ”µ</abbr></span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  26 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  27 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  28 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  29 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  30 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-2618521349256495257" onmouseenter="enter('-2618521349256495257');" onmouseout="out('-2618521349256495257');" style="">  31 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeService;                             </span>
<span class="-3988587350630126043" onmouseenter="enter('-3988587350630126043');" onmouseout="out('-3988587350630126043');" style="">  32 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeServiceImpl;                         </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  33 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  34 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  35 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  36 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  37 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="5877661970606637396" onmouseenter="enter('5877661970606637396');" onmouseout="out('5877661970606637396');" style="">  38 import org.broadleafcommerce.core.catalog.domain.CategoryProductXrefImpl;                                </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  39 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  40 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  41 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  42 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  43 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-428848345283345816" onmouseenter="enter('-428848345283345816');" onmouseout="out('-428848345283345816');" style="">  44 import org.broadleafcommerce.core.catalog.service.type.ProductBundlePricingModelType;                    </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  45 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  46 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  47 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  48 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  49 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  50 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  51 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  52 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  53 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  54 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  55 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-4913438826169444493" onmouseenter="enter('-4913438826169444493');" onmouseout="out('-4913438826169444493');" style="">  56 import org.broadleafcommerce.openadmin.server.service.persistence.module.EmptyFilterValues;              </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  57 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  58 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  59 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  60 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  61 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  62 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  63 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  64 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  64 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  65 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  66 import org.springframework.stereotype.Component;                                                         </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  67 import java.lang.reflect.Field;                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  68 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  69 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  71 import java.util.Map;                                                                                    </span>
<span class="5924803009700709999" onmouseenter="enter('5924803009700709999');" onmouseout="out('5924803009700709999');" style="">  72 import java.util.stream.Stream;                                                                          </span>
<span  style="">  73                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  74 import javax.annotation.Resource;                                                                        </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  75 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  76 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  77 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  78 import javax.persistence.criteria.From;                                                                  </span>
<span class="4189756756281347615" onmouseenter="enter('4189756756281347615');" onmouseout="out('4189756756281347615');" style="">  79 import javax.persistence.criteria.JoinType;                                                              </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  80 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  81 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  82 import javax.persistence.criteria.Root;                                                                  </span>
<span  style="">  83                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84 /**                                                                                                      </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  85  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86  */                                                                                                      </span>
<span class="660262005045399639" onmouseenter="enter('660262005045399639');" onmouseout="out('660262005045399639');" style="">  87 @Component(&quot;blProductCustomPersistenceHandler&quot;)                                                          </span>
<span class="-5558200371078111093" onmouseenter="enter('-5558200371078111093');" onmouseout="out('-5558200371078111093');" style="">  88 public class ProductCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                   </span>
<span  style="">  89                                                                                                          </span>
<span class="6601773269924456427" onmouseenter="enter('6601773269924456427');" onmouseout="out('6601773269924456427');" style="">  90     protected static final String ID_PROPERTY = &quot;id&quot;;                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  92     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  93     protected CatalogService catalogService;                                                             </span>
<span  style="">  94                                                                                                          </span>
<span class="8724020527834493732" onmouseenter="enter('8724020527834493732');" onmouseout="out('8724020527834493732');" style="">  95     @Resource(name = &quot;blProductCustomPersistenceHandlerExtensionManager&quot;)                                </span>
<span class="5198675979006161834" onmouseenter="enter('5198675979006161834');" onmouseout="out('5198675979006161834');" style="">  96     protected ProductCustomPersistenceHandlerExtensionManager extensionManager;                          </span>
<span  style="">  97                                                                                                          </span>
<span class="-7078262064240547152" onmouseenter="enter('-7078262064240547152');" onmouseout="out('-7078262064240547152');" style="">  98     @Resource(name = &quot;blParentCategoryLegacyModeService&quot;)                                                </span>
<span class="7833791338969174941" onmouseenter="enter('7833791338969174941');" onmouseout="out('7833791338969174941');" style="">  99     protected ParentCategoryLegacyModeService parentCategoryLegacyModeService;                           </span>
<span  style=""> 100                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 101     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 102     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 103                                                                                                          </span>
<span class="4171055983434128927" onmouseenter="enter('4171055983434128927');" onmouseout="out('4171055983434128927');" style=""> 104     @Value(&quot;${product.query.limit:500}&quot;)                                                                 </span>
<span class="395756119071585853" onmouseenter="enter('395756119071585853');" onmouseout="out('395756119071585853');" style=""> 105     protected long queryLimit;                                                                           </span>
<span  style=""> 106                                                                                                          </span>
<span class="1763955632160691042" onmouseenter="enter('1763955632160691042');" onmouseout="out('1763955632160691042');" style=""> 107     @Value(&quot;${product.eager.fetch.associations.admin:true}&quot;)                                             </span>
<span class="-5859298812289369627" onmouseenter="enter('-5859298812289369627');" onmouseout="out('-5859298812289369627');" style=""> 108     protected boolean eagerFetchAssociations = true;                                                     </span>
<span  style=""> 109                                                                                                          </span>
<span class="7059678051681133033" onmouseenter="enter('7059678051681133033');" onmouseout="out('7059678051681133033');" style=""> 110     private static final Log LOG = LogFactory.getLog(ProductCustomPersistenceHandler.class);             </span>
<span  style=""> 111                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 112     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 113     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 114         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 114         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-1941058799374650916" onmouseenter="enter('-1941058799374650916');" onmouseout="out('-1941058799374650916');" style=""> 115         String[] customCriteria = persistencePackage.getCustomCriteria();                                </span>
<span class="-6187520531612273029" onmouseenter="enter('-6187520531612273029');" onmouseout="out('-6187520531612273029');" style=""><abbr title=" 116         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.class.getName().equals(ceilingEntityFullyQualifiedClassname);"> 116         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; PrðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117     }                                                                                                    </span>
<span  style=""> 118                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 120     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 121         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122     }                                                                                                    </span>
<span  style=""> 123                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 124     @Override                                                                                            </span>
<span class="-3598578007792382897" onmouseenter="enter('-3598578007792382897');" onmouseout="out('-3598578007792382897');" style=""> 125     public Boolean canHandleRemove(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 126         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127     }                                                                                                    </span>
<span  style=""> 128                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 129     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 130     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="-4855907251399383811" onmouseenter="enter('-4855907251399383811');" onmouseout="out('-4855907251399383811');" style=""> 131         return isRecursiveProductSelection(persistencePackage) || canHandleAdd(persistencePackage);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 135     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 136         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137     }                                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 139     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 140     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 140     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-3269781843971996957" onmouseenter="enter('-3269781843971996957');" onmouseout="out('-3269781843971996957');" style=""> 141         Map&lt;String, FieldMetadata&gt; md = getMetadata(persistencePackage, helper);                         </span>
<span  style=""> 142                                                                                                          </span>
<span class="4046647143093628321" onmouseenter="enter('4046647143093628321');" onmouseout="out('4046647143093628321');" style=""> 143         modifyParentCategoryMetadata(md);                                                                </span>
<span  style=""> 144                                                                                                          </span>
<span class="-3976181121340681385" onmouseenter="enter('-3976181121340681385');" onmouseout="out('-3976181121340681385');" style=""> 145         extensionManager.getProxy().manageInspect(md);                                                   </span>
<span  style=""> 146                                                                                                          </span>
<span class="3104749978175677264" onmouseenter="enter('3104749978175677264');" onmouseout="out('3104749978175677264');" style=""> 147         return getResultSet(persistencePackage, helper, md);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 150     @Override                                                                                            </span>
<span class="1439455151726717615" onmouseenter="enter('1439455151726717615');" onmouseout="out('1439455151726717615');" style=""><abbr title=" 151     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao"> 151     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="7090980851977161261" onmouseenter="enter('7090980851977161261');" onmouseout="out('7090980851977161261');" style=""> 152             dynamicEntityDao, RecordHelper helper) throws ServiceException {                             </span>
<span  style=""> 153                                                                                                          </span>
<span class="7569586386580693394" onmouseenter="enter('7569586386580693394');" onmouseout="out('7569586386580693394');" style=""> 154         if (isRecursiveProductSelection(persistencePackage)) {                                           </span>
<span class="-8647006973930156734" onmouseenter="enter('-8647006973930156734');" onmouseout="out('-8647006973930156734');" style=""> 155             return getFilteredDynamicResultSet(persistencePackage, cto, helper);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156         }                                                                                                </span>
<span  style=""> 157                                                                                                          </span>
<span class="6757106929036196196" onmouseenter="enter('6757106929036196196');" onmouseout="out('6757106929036196196');" style=""> 158         boolean legacy = parentCategoryLegacyModeService.isLegacyMode();                                 </span>
<span  style=""> 159                                                                                                          </span>
<span class="-6242900732247061705" onmouseenter="enter('-6242900732247061705');" onmouseout="out('-6242900732247061705');" style=""> 160         //the following code applies when filters are present only:                                      </span>
<span class="7713333205546637982" onmouseenter="enter('7713333205546637982');" onmouseout="out('7713333205546637982');" style=""><abbr title=" 161         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to be matched"> 161         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the fiðŸ”µ</abbr></span>
<span class="-4534809142114175803" onmouseenter="enter('-4534809142114175803');" onmouseout="out('-4534809142114175803');" style=""><abbr title=" 162         //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the &quot;legacy&quot; mode."> 162         //against the categories chosen in the listGrid filter. The default behavior up to this point, asðŸ”µ</abbr></span>
<span class="4043022036079520545" onmouseenter="enter('4043022036079520545');" onmouseout="out('4043022036079520545');" style=""><abbr title=" 163         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCategory&quot;."> 163         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;ðŸ”µ</abbr></span>
<span class="-7849952188616772175" onmouseenter="enter('-7849952188616772175');" onmouseout="out('-7849952188616772175');" style=""><abbr title=" 164         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping in cto.additionalFilterMappings,"> 164         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilteðŸ”µ</abbr></span>
<span class="-1781087399901648456" onmouseenter="enter('-1781087399901648456');" onmouseout="out('-1781087399901648456');" style=""> 165         //which seeks matching values in  allParentCategoryXRefs instead                                 </span>
<span class="-5527176171961818632" onmouseenter="enter('-5527176171961818632');" onmouseout="out('-5527176171961818632');" style=""> 166         if (!legacy) {                                                                                   </span>
<span class="-4942654953935107368" onmouseenter="enter('-4942654953935107368');" onmouseout="out('-4942654953935107368');" style=""> 167             FilterAndSortCriteria fsc = cto.getCriteriaMap().get(&quot;defaultCategory&quot;);                     </span>
<span class="7732194668261263043" onmouseenter="enter('7732194668261263043');" onmouseout="out('7732194668261263043');" style=""> 168             if (fsc != null) {                                                                           </span>
<span class="5140613669097034739" onmouseenter="enter('5140613669097034739');" onmouseout="out('5140613669097034739');" style=""> 169                 List&lt;String&gt; filterValues = fsc.getFilterValues();                                       </span>
<span class="3991008560349807179" onmouseenter="enter('3991008560349807179');" onmouseout="out('3991008560349807179');" style=""> 170                 cto.getCriteriaMap().remove(&quot;defaultCategory&quot;);                                          </span>
<span  style=""> 171                                                                                                          </span>
<span class="5187909757738614354" onmouseenter="enter('5187909757738614354');" onmouseout="out('5187909757738614354');" style=""><abbr title=" 172                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;Long&gt;() {"> 172                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTranðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 173                     @Override                                                                            </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 174                     public Long transform(Object input) {                                                </span>
<span class="7261043087809466345" onmouseenter="enter('7261043087809466345');" onmouseout="out('7261043087809466345');" style=""> 175                         return Long.parseLong(((String) input));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 177                 });                                                                                      </span>
<span class="-3339810432835967648" onmouseenter="enter('-3339810432835967648');" onmouseout="out('-3339810432835967648');" style=""><abbr title=" 178                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();"> 178                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder(ðŸ”µ</abbr></span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 179                 CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                          </span>
<span class="1136355655038715928" onmouseenter="enter('1136355655038715928');" onmouseout="out('1136355655038715928');" style=""> 180                 Root&lt;CategoryProductXrefImpl&gt; root = criteria.from(CategoryProductXrefImpl.class);       </span>
<span class="-192292848609070031" onmouseenter="enter('-192292848609070031');" onmouseout="out('-192292848609070031');" style=""> 181                 criteria.select(root.get(&quot;product&quot;).get(&quot;id&quot;).as(Long.class));                           </span>
<span class="4051795261411779358" onmouseenter="enter('4051795261411779358');" onmouseout="out('4051795261411779358');" style=""> 182                 List&lt;Predicate&gt; restrictions = new ArrayList&lt;Predicate&gt;();                               </span>
<span class="7079639045649129257" onmouseenter="enter('7079639045649129257');" onmouseout="out('7079639045649129257');" style=""> 183                 restrictions.add(builder.equal(root.get(&quot;defaultReference&quot;), Boolean.TRUE));             </span>
<span class="5207279827061650716" onmouseenter="enter('5207279827061650716');" onmouseout="out('5207279827061650716');" style=""> 184                 if (CollectionUtils.isNotEmpty(transformedValues)) {                                     </span>
<span class="146441315649268392" onmouseenter="enter('146441315649268392');" onmouseout="out('146441315649268392');" style=""> 185                     restrictions.add(root.get(&quot;category&quot;).get(&quot;id&quot;).in(transformedValues));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                 }                                                                                        </span>
<span  style=""> 187                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 188                 criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                </span>
<span class="7055825944566640974" onmouseenter="enter('7055825944566640974');" onmouseout="out('7055825944566640974');" style=""><abbr title=" 189                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);"> 189                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteriaðŸ”µ</abbr></span>
<span class="8509583784823066198" onmouseenter="enter('8509583784823066198');" onmouseout="out('8509583784823066198');" style=""> 190                 List&lt;Long&gt; productIds = query.getResultList();                                           </span>
<span class="-1516584047908894525" onmouseenter="enter('-1516584047908894525');" onmouseout="out('-1516584047908894525');" style=""><abbr title=" 191                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));"> 191                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[pðŸ”µ</abbr></span>
<span  style=""> 192                                                                                                          </span>
<span class="5110006719648509717" onmouseenter="enter('5110006719648509717');" onmouseout="out('5110006719648509717');" style=""> 193                 if (productIds.size() == 0) {                                                            </span>
<span class="-8650761106430502088" onmouseenter="enter('-8650761106430502088');" onmouseout="out('-8650761106430502088');" style=""> 194                     return new DynamicResultSet(null, new Entity[0], 0);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                 }                                                                                        </span>
<span class="-924931052995986786" onmouseenter="enter('-924931052995986786');" onmouseout="out('-924931052995986786');" style=""> 196                 if (productIds.size() &lt;= queryLimit) {                                                   </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 197                     FilterMapping filterMapping = new FilterMapping()                                    </span>
<span class="-3543945038191067122" onmouseenter="enter('-3543945038191067122');" onmouseout="out('-3543945038191067122');" style=""> 198                             .withFieldPath(new FieldPath().withTargetProperty(&quot;id&quot;))                     </span>
<span class="2232883807641366792" onmouseenter="enter('2232883807641366792');" onmouseout="out('2232883807641366792');" style=""> 199                             .withDirectFilterValues(productIds)                                          </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 200                             .withRestriction(new Restriction()                                           </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 201                                                      .withPredicateProvider(new PredicateProvider() {    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 202                                                                                 @Override                </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 203                                                                                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 203                                                                                 public Predicate buildPreðŸ”µ</abbr></span>
<span class="-5114847374786337606" onmouseenter="enter('-5114847374786337606');" onmouseout="out('-5114847374786337606');" style=""><abbr title=" 204                                                                                                                 From root, String ceilingEntity, String fullPropertyName,"> 204                                                                                                          ðŸ”µ</abbr></span>
<span class="8513618248320586908" onmouseenter="enter('8513618248320586908');" onmouseout="out('8513618248320586908');" style=""><abbr title=" 205                                                                                                                 Path explicitPath, List directValues) {"> 205                                                                                                          ðŸ”µ</abbr></span>
<span class="-7844596111771279367" onmouseenter="enter('-7844596111771279367');" onmouseout="out('-7844596111771279367');" style=""><abbr title=" 206                                                                                     return explicitPath.in(directValues);"> 206                                                                                     return explicitPath.iðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                                                                                 }                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                                                                             }                            </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 209                                                      )                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 210                             );                                                                           </span>
<span class="8464857299985770317" onmouseenter="enter('8464857299985770317');" onmouseout="out('8464857299985770317');" style=""> 211                     cto.getAdditionalFilterMappings().add(filterMapping);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 212                 } else {                                                                                 </span>
<span class="-5679004918959824296" onmouseenter="enter('-5679004918959824296');" onmouseout="out('-5679004918959824296');" style=""> 213                     String joined = StringUtils.join(transformedValues, &#x27;,&#x27;);                            </span>
<span class="-7138538771694428625" onmouseenter="enter('-7138538771694428625');" onmouseout="out('-7138538771694428625');" style=""><abbr title=" 214                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since there are &quot; +"> 214                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query sðŸ”µ</abbr></span>
<span class="-3268164569215202291" onmouseenter="enter('-3268164569215202291');" onmouseout="out('-3268164569215202291');" style=""><abbr title=" 215                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected default categories(%s). This is a &quot; +"> 215                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the ðŸ”µ</abbr></span>
<span class="6513435278584853007" onmouseenter="enter('6513435278584853007');" onmouseout="out('6513435278584853007');" style=""> 216                                            &quot;filter query limitation.&quot;, joined));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                 }                                                                                        </span>
<span class="-6371393405809532308" onmouseenter="enter('-6371393405809532308');" onmouseout="out('-6371393405809532308');" style=""> 218                 cto.getNonCountAdditionalFilterMappings().add(                                           </span>
<span class="861084839636182372" onmouseenter="enter('861084839636182372');" onmouseout="out('861084839636182372');" style=""> 219                         new FilterMapping().withFieldPath(new FieldPath().                               </span>
<span class="-2774318940771911356" onmouseenter="enter('-2774318940771911356');" onmouseout="out('-2774318940771911356');" style=""> 220                                 withAssociationPath(Arrays.asList(&quot;allParentCategoryXrefs&quot;,&quot;category&quot;)). </span>
<span class="821868564123592571" onmouseenter="enter('821868564123592571');" onmouseout="out('821868564123592571');" style=""> 221                                 withTargetPropertyPieces(Arrays.asList(&quot;name&quot;)))                         </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 222                                 .withDirectFilterValues(new EmptyFilterValues())                         </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 223                                 .withRestriction(new Restriction()                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 224                                         .withPredicateProvider(new PredicateProvider() {                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225                                             @Override                                                    </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 226                                             public Predicate buildPredicate(CriteriaBuilder builder,     </span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 227                                                                             FieldPathBuilder fieldPathBuilder, From root,"> 227                                                                             FieldPathBuilder fieldPathBuiðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""> 228                                                                             String ceilingEntity,        </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 229                                                                             String fullPropertyName, Path explicitPath,"> 229                                                                             String fullPropertyName, PathðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 230                                                                             List directValues) {         </span>
<span class="-8553876951484288081" onmouseenter="enter('-8553876951484288081');" onmouseout="out('-8553876951484288081');" style=""><abbr title=" 231                                                 //expect it to be allParentCategoryXrefs.category.name, so we need to restrict on allParentCategoryXrefs - 2 levels up"> 231                                                 //expect it to be allParentCategoryXrefs.category.name, sðŸ”µ</abbr></span>
<span class="8037864455504608737" onmouseenter="enter('8037864455504608737');" onmouseout="out('8037864455504608737');" style=""><abbr title=" 232                                                 Predicate equal = builder.equal(explicitPath.getParentPath().getParentPath().get(&quot;defaultReference&quot;), Boolean.TRUE);"> 232                                                 Predicate equal = builder.equal(explicitPath.getParentPatðŸ”µ</abbr></span>
<span class="1665766703297118664" onmouseenter="enter('1665766703297118664');" onmouseout="out('1665766703297118664');" style=""> 233                                                 return equal;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234                                             }                                                            </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 235                                         })                                                               </span>
<span class="-3422099077497392780" onmouseenter="enter('-3422099077497392780');" onmouseout="out('-3422099077497392780');" style=""> 236                                 ).withSortDirection(fsc.getSortDirection()));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238         }                                                                                                </span>
<span  style=""> 239                                                                                                          </span>
<span class="2582332595020198633" onmouseenter="enter('2582332595020198633');" onmouseout="out('2582332595020198633');" style=""> 240         if (eagerFetchAssociations) {                                                                    </span>
<span class="6234898006418452293" onmouseenter="enter('6234898006418452293');" onmouseout="out('6234898006418452293');" style=""> 241             cto.getNonCountAdditionalFilterMappings().add(new FilterMapping()                            </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""><abbr title=" 242                                                                   .withDirectFilterValues(new EmptyFilterValues())"> 242                                                                   .withDirectFilterValues(new EmptyFilterðŸ”µ</abbr></span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 243                                                                   .withRestriction(new Restriction()     </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""><abbr title=" 244                                                                                            .withPredicateProvider(new PredicateProvider() {"> 244                                                                                            .withPredicateðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 245                                                                                                @Override </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""><abbr title=" 246                                                                                                public Predicate buildPredicate(CriteriaBuilder builder,"> 246                                                                                                public PreðŸ”µ</abbr></span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 247                                                                                                                                FieldPathBuilder fieldPathBuilder, From root,"> 247                                                                                                          ðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""><abbr title=" 248                                                                                                                                String ceilingEntity,"> 248                                                                                                          ðŸ”µ</abbr></span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 249                                                                                                                                String fullPropertyName, Path explicitPath,"> 249                                                                                                          ðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""><abbr title=" 250                                                                                                                                List directValues) {"> 250                                                                                                          ðŸ”µ</abbr></span>
<span class="624264344901137787" onmouseenter="enter('624264344901137787');" onmouseout="out('624264344901137787');" style=""><abbr title=" 251                                                                                                    root.fetch(&quot;defaultSku&quot;, JoinType.LEFT);"> 251                                                                                                    root.fðŸ”µ</abbr></span>
<span class="2236319445290317600" onmouseenter="enter('2236319445290317600');" onmouseout="out('2236319445290317600');" style=""><abbr title=" 252                                                                                                    root.fetch(&quot;defaultCategory&quot;, JoinType.LEFT);"> 252                                                                                                    root.fðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""><abbr title=" 253                                                                                                    return null;"> 253                                                                                                    returnðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                                                                                                }         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 255                                                                                            })            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 256                                                                   ));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span class="-5277136380896832206" onmouseenter="enter('-5277136380896832206');" onmouseout="out('-5277136380896832206');" style=""> 258         return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259     }                                                                                                    </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 262     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 262     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 263         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 264         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 265             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 265             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-1738937064203927240" onmouseenter="enter('-1738937064203927240');" onmouseout="out('-1738937064203927240');" style=""> 266             Product adminInstance = (Product) Class.forName(entity.getType()[0]).newInstance();          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 267             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 267             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 268                                                                                                          </span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 269             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 270                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271             }                                                                                            </span>
<span  style=""> 272                                                                                                          </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 273             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 273             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 274             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 275                                                                                                          </span>
<span class="2994500046663637288" onmouseenter="enter('2994500046663637288');" onmouseout="out('2994500046663637288');" style=""> 276             //Since none of the Sku fields are required, it&#x27;s possible that the user did not fill out    </span>
<span class="-1662985695084142247" onmouseenter="enter('-1662985695084142247');" onmouseout="out('-1662985695084142247');" style=""><abbr title=" 277             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiate one"> 277             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so iðŸ”µ</abbr></span>
<span class="-4407708836004135952" onmouseenter="enter('-4407708836004135952');" onmouseout="out('-4407708836004135952');" style=""> 278             if (adminInstance.getDefaultSku() == null) {                                                 </span>
<span class="-5869950698936088971" onmouseenter="enter('-5869950698936088971');" onmouseout="out('-5869950698936088971');" style=""> 279                 Sku newSku = catalogService.createSku();                                                 </span>
<span class="3758063373327618746" onmouseenter="enter('3758063373327618746');" onmouseout="out('3758063373327618746');" style=""> 280                 dynamicEntityDao.persist(newSku);                                                        </span>
<span class="3627601061948392291" onmouseenter="enter('3627601061948392291');" onmouseout="out('3627601061948392291');" style=""> 281                 adminInstance.setDefaultSku(newSku);                                                     </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 282                 adminInstance = dynamicEntityDao.merge(adminInstance);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283             }                                                                                            </span>
<span  style=""> 284                                                                                                          </span>
<span class="1398885520878604990" onmouseenter="enter('1398885520878604990');" onmouseout="out('1398885520878604990');" style=""> 285             //also set the default product for the Sku                                                   </span>
<span class="-5769689371067636269" onmouseenter="enter('-5769689371067636269');" onmouseout="out('-5769689371067636269');" style=""> 286             adminInstance.getDefaultSku().setDefaultProduct(adminInstance);                              </span>
<span class="-8818629679601416674" onmouseenter="enter('-8818629679601416674');" onmouseout="out('-8818629679601416674');" style=""> 287             dynamicEntityDao.merge(adminInstance.getDefaultSku());                                       </span>
<span  style=""> 288                                                                                                          </span>
<span class="6340800826002936969" onmouseenter="enter('6340800826002936969');" onmouseout="out('6340800826002936969');" style=""> 289             // if this is a Pre-Add, skip the rest of the method                                         </span>
<span class="4698552646741459586" onmouseenter="enter('4698552646741459586');" onmouseout="out('4698552646741459586');" style=""> 290             if (entity.isPreAdd()) {                                                                     </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 291                 return helper.getRecord(adminProperties, adminInstance, null, null);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292             }                                                                                            </span>
<span  style=""> 293                                                                                                          </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 294             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 295             if (extensionManager != null) {                                                              </span>
<span class="-1778606721590329888" onmouseenter="enter('-1778606721590329888');" onmouseout="out('-1778606721590329888');" style=""><abbr title=" 296                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persistencePackage, adminInstance);"> 296                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAddðŸ”µ</abbr></span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 297                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 299             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 300                 setupXref(adminInstance);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301             }                                                                                            </span>
<span  style=""> 302                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 303             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 304         } catch (Exception e) {                                                                          </span>
<span class="7134174968934853795" onmouseenter="enter('7134174968934853795');" onmouseout="out('7134174968934853795');" style=""> 305             throw new ServiceException(&quot;Unable to add entity for &quot; + entity.getType()[0], e);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 309     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 310     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 310     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 311         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 312         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 313             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 313             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span  style=""> 314                                                                                                          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 315             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 315             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 316                                                                                                          </span>
<span class="1819538413343548026" onmouseenter="enter('1819538413343548026');" onmouseout="out('1819538413343548026');" style=""><abbr title=" 317             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategory&quot;));"> 317             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategoðŸ”µ</abbr></span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 318             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="6303363757907394261" onmouseenter="enter('6303363757907394261');" onmouseout="out('6303363757907394261');" style=""><abbr title=" 319             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 319             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findPropertðŸ”µ</abbr></span>
<span class="-1298210778461020296" onmouseenter="enter('-1298210778461020296');" onmouseout="out('-1298210778461020296');" style=""><abbr title=" 320                 //Change the inherited type so that this property is disconnected from the entity and validation is temporarily skipped."> 320                 //Change the inherited type so that this property is disconnected from the entity and valðŸ”µ</abbr></span>
<span class="5827004128286973668" onmouseenter="enter('5827004128286973668');" onmouseout="out('5827004128286973668');" style=""><abbr title=" 321                 //This is useful when the defaultCategory was previously completely empty for whatever reason. Without this, such"> 321                 //This is useful when the defaultCategory was previously completely empty for whatever reðŸ”µ</abbr></span>
<span class="-8493051113864514358" onmouseenter="enter('-8493051113864514358');" onmouseout="out('-8493051113864514358');" style=""><abbr title=" 322                 //a case would fail the validation, even though the property was specified in the submission."> 322                 //a case would fail the validation, even though the property was specified in the submissðŸ”µ</abbr></span>
<span class="-8335887377494536791" onmouseenter="enter('-8335887377494536791');" onmouseout="out('-8335887377494536791');" style=""> 323                 defaultCategory.setInheritedFromType(String.class.getName());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324             }                                                                                            </span>
<span  style=""> 325                                                                                                          </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 326             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="6153157527633548109" onmouseenter="enter('6153157527633548109');" onmouseout="out('6153157527633548109');" style=""><abbr title=" 327             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 327             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]ðŸ”µ</abbr></span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 328             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 329                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330             }                                                                                            </span>
<span  style=""> 331                                                                                                          </span>
<span class="-710126092547245946" onmouseenter="enter('-710126092547245946');" onmouseout="out('-710126092547245946');" style=""> 332             CategoryProductXref oldDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="-5817707795302619279" onmouseenter="enter('-5817707795302619279');" onmouseout="out('-5817707795302619279');" style=""><abbr title=" 333             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched from db"> 333             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not beðŸ”µ</abbr></span>
<span class="6655495238084243637" onmouseenter="enter('6655495238084243637');" onmouseout="out('6655495238084243637');" style=""><abbr title=" 334             //and it will cause validation error, we should allow deployemnt of product with category in sandbox state"> 334             //and it will cause validation error, we should allow deployemnt of product with category in ðŸ”µ</abbr></span>
<span class="6453615407021429154" onmouseenter="enter('6453615407021429154');" onmouseout="out('6453615407021429154');" style=""> 335             //so override required flag for that field during deployment                                 </span>
<span class="-367004153561380049" onmouseenter="enter('-367004153561380049');" onmouseout="out('-367004153561380049');" style=""> 336             if(BroadleafRequestContext.getBroadleafRequestContext().isProductionSandBox()){              </span>
<span class="-3632045312370469531" onmouseenter="enter('-3632045312370469531');" onmouseout="out('-3632045312370469531');" style=""> 337                 ((BasicFieldMetadata)adminProperties.get(&quot;defaultCategory&quot;)).setRequiredOverride(false); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338             }                                                                                            </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 339             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 339             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 340             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 341             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 342             if (extensionManager != null) {                                                              </span>
<span class="-3727608922273128682" onmouseenter="enter('-3727608922273128682');" onmouseout="out('-3727608922273128682');" style=""><abbr title=" 343                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdate"> 343                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdðŸ”µ</abbr></span>
<span class="-5509937458278318351" onmouseenter="enter('-5509937458278318351');" onmouseout="out('-5509937458278318351');" style=""> 344                         (persistencePackage, adminInstance);                                             </span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 345                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span  style=""> 346                                                                                                          </span>
<span class="1636360182407915778" onmouseenter="enter('1636360182407915778');" onmouseout="out('1636360182407915778');" style=""> 347                 extensionManager.getProxy().manageFields(persistencePackage, adminInstance);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 349             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 350                 setupXref(adminInstance);                                                                </span>
<span class="-7967199691392957007" onmouseenter="enter('-7967199691392957007');" onmouseout="out('-7967199691392957007');" style=""> 351                 removeOldDefault(adminInstance, oldDefault, entity);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352             }                                                                                            </span>
<span  style=""> 353                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 354             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 355         } catch (Exception e) {                                                                          </span>
<span class="-8723674804020595812" onmouseenter="enter('-8723674804020595812');" onmouseout="out('-8723674804020595812');" style=""> 356             throw new ServiceException(&quot;Unable to update entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358     }                                                                                                    </span>
<span  style=""> 359                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 360     @Override                                                                                            </span>
<span class="1887636609613592843" onmouseenter="enter('1887636609613592843');" onmouseout="out('1887636609613592843');" style=""><abbr title=" 361     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 361     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 362         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 363         try {                                                                                            </span>
<span class="3243810268662008348" onmouseenter="enter('3243810268662008348');" onmouseout="out('3243810268662008348');" style=""><abbr title=" 364             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);"> 364             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entityðŸ”µ</abbr></span>
<span class="-4186523034208284789" onmouseenter="enter('-4186523034208284789');" onmouseout="out('-4186523034208284789');" style=""> 365             removeProduct(persistencePackage, adminInstance, helper);                                    </span>
<span class="29076383544473850" onmouseenter="enter('29076383544473850');" onmouseout="out('29076383544473850');" style=""> 366             List&lt;Sku&gt; skuList = adminInstance.getAllSkus();                                              </span>
<span class="-2506961360510940575" onmouseenter="enter('-2506961360510940575');" onmouseout="out('-2506961360510940575');" style=""> 367             for (Sku sku : skuList) {                                                                    </span>
<span class="2039383434106799748" onmouseenter="enter('2039383434106799748');" onmouseout="out('2039383434106799748');" style=""> 368                 catalogService.removeSku(sku);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369             }                                                                                            </span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 370         } catch (ClassNotFoundException e) {                                                             </span>
<span class="8549847936080404575" onmouseenter="enter('8549847936080404575');" onmouseout="out('8549847936080404575');" style=""> 371             throw new ServiceException(&quot;Unable to remove entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="-8634314107060974128" onmouseenter="enter('-8634314107060974128');" onmouseout="out('-8634314107060974128');" style=""><abbr title=" 375     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,"> 375     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntðŸ”µ</abbr></span>
<span class="2232129114834499824" onmouseenter="enter('2232129114834499824');" onmouseout="out('2232129114834499824');" style=""> 376                                        Entity entity) throws ClassNotFoundException {                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 377         PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();  </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 378         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 378         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getNaðŸ”µ</abbr></span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 379         Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                               </span>
<span class="3403576257396241131" onmouseenter="enter('3403576257396241131');" onmouseout="out('3403576257396241131');" style=""> 380         String type = entity.getType()[0];                                                               </span>
<span class="791413654597460382" onmouseenter="enter('791413654597460382');" onmouseout="out('791413654597460382');" style=""> 381         Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);    </span>
<span  style=""> 382                                                                                                          </span>
<span class="2848615422851099691" onmouseenter="enter('2848615422851099691');" onmouseout="out('2848615422851099691');" style=""> 383         return adminInstance;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="-7276315230897223897" onmouseenter="enter('-7276315230897223897');" onmouseout="out('-7276315230897223897');" style=""><abbr title=" 386     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {"> 386     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelpðŸ”µ</abbr></span>
<span class="8222559285797311452" onmouseenter="enter('8222559285797311452');" onmouseout="out('8222559285797311452');" style=""> 387         catalogService.removeProduct(adminInstance);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 390     /**                                                                                                  </span>
<span class="-6565674410629622369" onmouseenter="enter('-6565674410629622369');" onmouseout="out('-6565674410629622369');" style=""> 391      * If the pricing model is of type item_sum, that property should not be required                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 392      *                                                                                                   </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 393      * @param adminInstance                                                                              </span>
<span class="1188154204740832420" onmouseenter="enter('1188154204740832420');" onmouseout="out('1188154204740832420');" style=""> 394      * @param adminProperties                                                                            </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 395      * @param entity                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396      */                                                                                                  </span>
<span class="1796231511775682058" onmouseenter="enter('1796231511775682058');" onmouseout="out('1796231511775682058');" style=""><abbr title=" 397     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminProperties, Entity entity) {"> 397     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; ðŸ”µ</abbr></span>
<span class="-7898829768536246574" onmouseenter="enter('-7898829768536246574');" onmouseout="out('-7898829768536246574');" style=""> 398         //no required validation for product bundles                                                     </span>
<span class="2028132163697204828" onmouseenter="enter('2028132163697204828');" onmouseout="out('2028132163697204828');" style=""> 399         ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(false); </span>
<span class="-1136678238396033433" onmouseenter="enter('-1136678238396033433');" onmouseout="out('-1136678238396033433');" style=""> 400         if (entity.getPMap().get(&quot;pricingModel&quot;) != null) {                                              </span>
<span class="-5810729812081766749" onmouseenter="enter('-5810729812081766749');" onmouseout="out('-5810729812081766749');" style=""><abbr title=" 401             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValue())) {"> 401             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;ðŸ”µ</abbr></span>
<span class="-8087214156619436047" onmouseenter="enter('-8087214156619436047');" onmouseout="out('-8087214156619436047');" style=""><abbr title=" 402                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(true);"> 402                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405     }                                                                                                    </span>
<span  style=""> 406                                                                                                          </span>
<span class="-6194621554657272575" onmouseenter="enter('-6194621554657272575');" onmouseout="out('-6194621554657272575');" style=""> 407     protected Boolean isDefaultCategoryLegacyMode() {                                                    </span>
<span class="-2222712760012631506" onmouseenter="enter('-2222712760012631506');" onmouseout="out('-2222712760012631506');" style=""><abbr title=" 408         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeService();"> 408         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyðŸ”µ</abbr></span>
<span class="-3125121052433413106" onmouseenter="enter('-3125121052433413106');" onmouseout="out('-3125121052433413106');" style=""> 409         if (legacyModeService != null) {                                                                 </span>
<span class="-7433711904609854570" onmouseenter="enter('-7433711904609854570');" onmouseout="out('-7433711904609854570');" style=""> 410             return legacyModeService.isLegacyMode();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 412         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413     }                                                                                                    </span>
<span  style=""> 414                                                                                                          </span>
<span class="-182298883698048941" onmouseenter="enter('-182298883698048941');" onmouseout="out('-182298883698048941');" style=""> 415     protected void modifyParentCategoryMetadata(Map&lt;String, FieldMetadata&gt; md) {                         </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 416         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-3233029088333925194" onmouseenter="enter('-3233029088333925194');" onmouseout="out('-3233029088333925194');" style=""> 417             md.remove(&quot;allParentCategoryXrefs&quot;);                                                         </span>
<span  style=""> 418                                                                                                          </span>
<span class="-8850866426953517740" onmouseenter="enter('-8850866426953517740');" onmouseout="out('-8850866426953517740');" style=""> 419             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) md.get(&quot;defaultCategory&quot;));       </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 420             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422     }                                                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="4323219351741765804" onmouseenter="enter('4323219351741765804');" onmouseout="out('4323219351741765804');" style=""> 424     protected Category getExistingDefaultCategory(Product product) {                                     </span>
<span class="4785057058955893593" onmouseenter="enter('4785057058955893593');" onmouseout="out('4785057058955893593');" style=""> 425         //Make sure we get the actual field value - not something manipulated in the getter              </span>
<span class="-7097588232152162933" onmouseenter="enter('-7097588232152162933');" onmouseout="out('-7097588232152162933');" style=""> 426         Category parentCategory;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 427         try {                                                                                            </span>
<span class="1642298731132209432" onmouseenter="enter('1642298731132209432');" onmouseout="out('1642298731132209432');" style=""> 428             Field defaultCategory = ProductImpl.class.getDeclaredField(&quot;defaultCategory&quot;);               </span>
<span class="-5472088449890863756" onmouseenter="enter('-5472088449890863756');" onmouseout="out('-5472088449890863756');" style=""> 429             defaultCategory.setAccessible(true);                                                         </span>
<span class="-5032854148355745900" onmouseenter="enter('-5032854148355745900');" onmouseout="out('-5032854148355745900');" style=""> 430             parentCategory = (Category) defaultCategory.get(product);                                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 431         } catch (NoSuchFieldException e) {                                                               </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 432             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 433         } catch (IllegalAccessException e) {                                                             </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 434             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span class="-4827692301542162901" onmouseenter="enter('-4827692301542162901');" onmouseout="out('-4827692301542162901');" style=""> 436         return parentCategory;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437     }                                                                                                    </span>
<span  style=""> 438                                                                                                          </span>
<span class="2198792804957949705" onmouseenter="enter('2198792804957949705');" onmouseout="out('2198792804957949705');" style=""><abbr title=" 439     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity) {"> 439     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity)ðŸ”µ</abbr></span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 440         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-8408462162055715920" onmouseenter="enter('-8408462162055715920');" onmouseout="out('-8408462162055715920');" style=""><abbr title=" 441             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 441             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findPropertyðŸ”µ</abbr></span>
<span class="3184747591230429719" onmouseenter="enter('3184747591230429719');" onmouseout="out('3184747591230429719');" style=""> 442                 adminInstance.setCategory(null);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443             }                                                                                            </span>
<span class="7434653101319155783" onmouseenter="enter('7434653101319155783');" onmouseout="out('7434653101319155783');" style=""> 444             CategoryProductXref newDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="1862582476950403842" onmouseenter="enter('1862582476950403842');" onmouseout="out('1862582476950403842');" style=""> 445             if (oldDefault != null &amp;&amp; !oldDefault.equals(newDefault)) {                                  </span>
<span class="-2218242322092133143" onmouseenter="enter('-2218242322092133143');" onmouseout="out('-2218242322092133143');" style=""> 446                 adminInstance.getAllParentCategoryXrefs().remove(oldDefault);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449     }                                                                                                    </span>
<span  style=""> 450                                                                                                          </span>
<span class="902349756604301531" onmouseenter="enter('902349756604301531');" onmouseout="out('902349756604301531');" style=""> 451     protected void setupXref(Product adminInstance) {                                                    </span>
<span class="1047341479251260893" onmouseenter="enter('1047341479251260893');" onmouseout="out('1047341479251260893');" style=""> 452         if (isDefaultCategoryLegacyMode()) {                                                             </span>
<span class="4336193572473592352" onmouseenter="enter('4336193572473592352');" onmouseout="out('4336193572473592352');" style=""> 453             CategoryProductXref categoryXref = new CategoryProductXrefImpl();                            </span>
<span class="3362376343183691887" onmouseenter="enter('3362376343183691887');" onmouseout="out('3362376343183691887');" style=""> 454             categoryXref.setCategory(getExistingDefaultCategory(adminInstance));                         </span>
<span class="998500482226783196" onmouseenter="enter('998500482226783196');" onmouseout="out('998500482226783196');" style=""> 455             categoryXref.setProduct(adminInstance);                                                      </span>
<span class="-2133389353332895077" onmouseenter="enter('-2133389353332895077');" onmouseout="out('-2133389353332895077');" style=""><abbr title=" 456             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() != null) {"> 456             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCateðŸ”µ</abbr></span>
<span class="-7221514252473967991" onmouseenter="enter('-7221514252473967991');" onmouseout="out('-7221514252473967991');" style=""> 457                 adminInstance.getAllParentCategoryXrefs().add(categoryXref);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460     }                                                                                                    </span>
<span  style=""> 461                                                                                                          </span>
<span class="-4866520984434663516" onmouseenter="enter('-4866520984434663516');" onmouseout="out('-4866520984434663516');" style=""> 462     protected CategoryProductXref getCurrentDefaultXref(Product product) {                               </span>
<span class="5121334440715645479" onmouseenter="enter('5121334440715645479');" onmouseout="out('5121334440715645479');" style=""> 463         CategoryProductXref currentDefault = null;                                                       </span>
<span class="4669448491831723006" onmouseenter="enter('4669448491831723006');" onmouseout="out('4669448491831723006');" style=""> 464         List&lt;CategoryProductXref&gt; xrefs = product.getAllParentCategoryXrefs();                           </span>
<span class="-1899512729290259350" onmouseenter="enter('-1899512729290259350');" onmouseout="out('-1899512729290259350');" style=""> 465         if (!CollectionUtils.isEmpty(xrefs)) {                                                           </span>
<span class="-1984009506268747903" onmouseenter="enter('-1984009506268747903');" onmouseout="out('-1984009506268747903');" style=""> 466             for (CategoryProductXref xref : xrefs) {                                                     </span>
<span class="113451359587339395" onmouseenter="enter('113451359587339395');" onmouseout="out('113451359587339395');" style=""><abbr title=" 467                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReference()) {"> 467                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaulðŸ”µ</abbr></span>
<span class="-4081682415228113248" onmouseenter="enter('-4081682415228113248');" onmouseout="out('-4081682415228113248');" style=""> 468                     currentDefault = xref;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 469                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span class="5312955631235184797" onmouseenter="enter('5312955631235184797');" onmouseout="out('5312955631235184797');" style=""> 473         return currentDefault;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474     }                                                                                                    </span>
<span  style=""> 475                                                                                                          </span>
<span class="4094641218853198204" onmouseenter="enter('4094641218853198204');" onmouseout="out('4094641218853198204');" style=""> 476     protected boolean isRecursiveProductSelection(PersistencePackage persistencePackage) {               </span>
<span class="7271253784317390082" onmouseenter="enter('7271253784317390082');" onmouseout="out('7271253784317390082');" style=""> 477         final List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());       </span>
<span class="5034407762644036308" onmouseenter="enter('5034407762644036308');" onmouseout="out('5034407762644036308');" style=""> 478         return Stream.of(&quot;upsaleProduct&quot;, &quot;crossSaleProduct&quot;, &quot;requestingField=addOnProduct&quot;)            </span>
<span class="-8438117934997670681" onmouseenter="enter('-8438117934997670681');" onmouseout="out('-8438117934997670681');" style=""> 479                 .anyMatch(customCriteria::contains);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="-3368052144456426396" onmouseenter="enter('-3368052144456426396');" onmouseout="out('-3368052144456426396');" style=""><abbr title=" 482     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicateProvider) {"> 482     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider pðŸ”µ</abbr></span>
<span  style=""> 483                                                                                                          </span>
<span class="8057622255252958217" onmouseenter="enter('8057622255252958217');" onmouseout="out('8057622255252958217');" style=""> 484         FieldPath fieldPath = new FieldPath().withTargetProperty(targetPropertyName);                    </span>
<span class="-6596211108915962883" onmouseenter="enter('-6596211108915962883');" onmouseout="out('-6596211108915962883');" style=""> 485         EmptyFilterValues directFilterValues = new EmptyFilterValues();                                  </span>
<span class="4277357472881062872" onmouseenter="enter('4277357472881062872');" onmouseout="out('4277357472881062872');" style=""> 486         Restriction newRestriction = new Restriction().withPredicateProvider(predicateProvider);         </span>
<span  style=""> 487                                                                                                          </span>
<span class="3608289770015613450" onmouseenter="enter('3608289770015613450');" onmouseout="out('3608289770015613450');" style=""> 488         return new FilterMapping()                                                                       </span>
<span class="-6035283433958931422" onmouseenter="enter('-6035283433958931422');" onmouseout="out('-6035283433958931422');" style=""> 489             .withFieldPath(fieldPath)                                                                    </span>
<span class="1581873956966044880" onmouseenter="enter('1581873956966044880');" onmouseout="out('1581873956966044880');" style=""> 490             .withDirectFilterValues(directFilterValues)                                                  </span>
<span class="27993374560272883" onmouseenter="enter('27993374560272883');" onmouseout="out('27993374560272883');" style=""> 491             .withRestriction(newRestriction);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492     }                                                                                                    </span>
<span  style=""> 493                                                                                                          </span>
<span class="1303149189704190318" onmouseenter="enter('1303149189704190318');" onmouseout="out('1303149189704190318');" style=""><abbr title=" 494     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferObject cto, RecordHelper helper) throws ServiceException {"> 494     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriðŸ”µ</abbr></span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 495 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-3386273820962459143" onmouseenter="enter('-3386273820962459143');" onmouseout="out('-3386273820962459143');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 496         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0) {"> 496         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0)ðŸ”µ</abbr></span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 497             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 497             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 498                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 499                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 499                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 500                                                 String ceilingEntity, String fullPropertyName, Path explicitPath,"> 500                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 501                                                 List directValues) {                                     </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 502                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 502                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 503                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 504             });                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 505 ||||||| BASE                                                                                             </span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 506         FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 506         FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicatePðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507             @Override                                                                                    </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 508             public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 508             public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, FðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 509                                             String ceilingEntity, String fullPropertyName, Path explicitPath,"> 509                                             String ceilingEntity, String fullPropertyName, Path explicitPðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510                                             List directValues) {                                         </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 511                 return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 511                 return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513         });                                                                                              </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514         cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 515 =======                                                                                                  </span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-4365624777334076097" onmouseenter="enter('-4365624777334076097');" onmouseout="out('-4365624777334076097');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517         if (sectionCrumbs != null &amp;&amp; sectionCrumbs.length &gt; 0) {                                         </span>
<span class="-4393846817404821398" onmouseenter="enter('-4393846817404821398');" onmouseout="out('-4393846817404821398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518             FilterMapping defaultCategoryMapping = this.createFilterMappingForProperty(                  </span>
<span class="-1391188242443598318" onmouseenter="enter('-1391188242443598318');" onmouseout="out('-1391188242443598318');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519                     ID_PROPERTY,                                                                         </span>
<span class="-7754832296053455105" onmouseenter="enter('-7754832296053455105');" onmouseout="out('-7754832296053455105');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 520                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, directValues)"> 520                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, direðŸ”µ</abbr></span>
<span class="-2761785120798275454" onmouseenter="enter('-2761785120798275454');" onmouseout="out('-2761785120798275454');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 521                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()))"> 521                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522             );                                                                                           </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 523 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style=""> 524         cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 526         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 526         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style=""> 527         PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                     </span>
<span class="6289449121708775001" onmouseenter="enter('6289449121708775001');" onmouseout="out('6289449121708775001');" style=""> 528         return persistenceModule.fetch(persistencePackage, cto);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530 }                                                                                                        </span>
</pre></td>
                            <td><pre><span class="607567072764399459" onmouseenter="enter('607567072764399459');" onmouseout="out('607567072764399459');" style="">   1 /*-                                                                                                      </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   3  * BroadleafCommerce Admin Module                                                                        </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="2735768235135741819" onmouseenter="enter('2735768235135741819');" onmouseout="out('2735768235135741819');" style="">   5  * Copyright (C) 2009 - 2022 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  18 package org.broadleafcommerce.admin.server.service.handler;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  20 import java.lang.reflect.Field;                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  21 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  22 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  23 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  24 import java.util.Map;                                                                                    </span>
<span class="5924803009700709999" onmouseenter="enter('5924803009700709999');" onmouseout="out('5924803009700709999');" style="">  25 import java.util.stream.Stream;                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  26 import javax.annotation.Resource;                                                                        </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  27 import javax.persistence.TypedQuery;                                                                     </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  28 import javax.persistence.criteria.CriteriaBuilder;                                                       </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  29 import javax.persistence.criteria.CriteriaQuery;                                                         </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  30 import javax.persistence.criteria.From;                                                                  </span>
<span class="4189756756281347615" onmouseenter="enter('4189756756281347615');" onmouseout="out('4189756756281347615');" style="">  31 import javax.persistence.criteria.JoinType;                                                              </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  32 import javax.persistence.criteria.Path;                                                                  </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  33 import javax.persistence.criteria.Predicate;                                                             </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  34 import javax.persistence.criteria.Root;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  35 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  36 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  37 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  38 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  39 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="5003207573385979332" onmouseenter="enter('5003207573385979332');" onmouseout="out('5003207573385979332');" style=""><abbr title="  40 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManager;">  40 import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManagðŸ”µ</abbr></span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  41 import org.broadleafcommerce.common.exception.ExceptionHelper;                                           </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  42 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  43 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  44 import org.broadleafcommerce.common.presentation.client.OperationType;                                   </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  45 import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                               </span>
<span class="-2618521349256495257" onmouseenter="enter('-2618521349256495257');" onmouseout="out('-2618521349256495257');" style="">  46 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeService;                             </span>
<span class="-3988587350630126043" onmouseenter="enter('-3988587350630126043');" onmouseout="out('-3988587350630126043');" style="">  47 import org.broadleafcommerce.common.service.ParentCategoryLegacyModeServiceImpl;                         </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  48 import org.broadleafcommerce.common.util.BLCCollectionUtils;                                             </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  49 import org.broadleafcommerce.common.util.TypedTransformer;                                               </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  50 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  51 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  52 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="5877661970606637396" onmouseenter="enter('5877661970606637396');" onmouseout="out('5877661970606637396');" style="">  53 import org.broadleafcommerce.core.catalog.domain.CategoryProductXrefImpl;                                </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  54 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  55 import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                          </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  56 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  57 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  58 import org.broadleafcommerce.core.catalog.service.CatalogService;                                        </span>
<span class="-428848345283345816" onmouseenter="enter('-428848345283345816');" onmouseout="out('-428848345283345816');" style="">  59 import org.broadleafcommerce.core.catalog.service.type.ProductBundlePricingModelType;                    </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  60 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  61 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  62 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  63 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  64 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  65 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  66 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  67 import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                       </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  68 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  69 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  70 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;           </span>
<span class="-4913438826169444493" onmouseenter="enter('-4913438826169444493');" onmouseout="out('-4913438826169444493');" style="">  71 import org.broadleafcommerce.openadmin.server.service.persistence.module.EmptyFilterValues;              </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  72 import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                  </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  73 import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;              </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  74 import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                   </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  75 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;             </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  76 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;      </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  77 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;         </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  78 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;           </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style=""><abbr title="  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;">  79 import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvðŸ”µ</abbr></span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  80 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  81 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  82                                                                                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84 /**                                                                                                      </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  85  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86  */                                                                                                      </span>
<span class="660262005045399639" onmouseenter="enter('660262005045399639');" onmouseout="out('660262005045399639');" style="">  87 @Component(&quot;blProductCustomPersistenceHandler&quot;)                                                          </span>
<span class="-5558200371078111093" onmouseenter="enter('-5558200371078111093');" onmouseout="out('-5558200371078111093');" style="">  88 public class ProductCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                   </span>
<span class="6601773269924456427" onmouseenter="enter('6601773269924456427');" onmouseout="out('6601773269924456427');" style="">  89     protected static final String ID_PROPERTY = &quot;id&quot;;                                                    </span>
<span  style="">  90                                                                                                          </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  91     @Resource(name = &quot;blCatalogService&quot;)                                                                 </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  92     protected CatalogService catalogService;                                                             </span>
<span  style="">  93                                                                                                          </span>
<span class="8724020527834493732" onmouseenter="enter('8724020527834493732');" onmouseout="out('8724020527834493732');" style="">  94     @Resource(name = &quot;blProductCustomPersistenceHandlerExtensionManager&quot;)                                </span>
<span class="5198675979006161834" onmouseenter="enter('5198675979006161834');" onmouseout="out('5198675979006161834');" style="">  95     protected ProductCustomPersistenceHandlerExtensionManager extensionManager;                          </span>
<span  style="">  96                                                                                                          </span>
<span class="-7078262064240547152" onmouseenter="enter('-7078262064240547152');" onmouseout="out('-7078262064240547152');" style="">  97     @Resource(name = &quot;blParentCategoryLegacyModeService&quot;)                                                </span>
<span class="7833791338969174941" onmouseenter="enter('7833791338969174941');" onmouseout="out('7833791338969174941');" style="">  98     protected ParentCategoryLegacyModeService parentCategoryLegacyModeService;                           </span>
<span  style="">  99                                                                                                          </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 100     @Resource(name = &quot;blSandBoxHelper&quot;)                                                                  </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 101     protected SandBoxHelper sandBoxHelper;                                                               </span>
<span  style=""> 102                                                                                                          </span>
<span class="4171055983434128927" onmouseenter="enter('4171055983434128927');" onmouseout="out('4171055983434128927');" style=""> 103     @Value(&quot;${product.query.limit:500}&quot;)                                                                 </span>
<span class="395756119071585853" onmouseenter="enter('395756119071585853');" onmouseout="out('395756119071585853');" style=""> 104     protected long queryLimit;                                                                           </span>
<span  style=""> 105                                                                                                          </span>
<span class="1763955632160691042" onmouseenter="enter('1763955632160691042');" onmouseout="out('1763955632160691042');" style=""> 106     @Value(&quot;${product.eager.fetch.associations.admin:true}&quot;)                                             </span>
<span class="-5859298812289369627" onmouseenter="enter('-5859298812289369627');" onmouseout="out('-5859298812289369627');" style=""> 107     protected boolean eagerFetchAssociations = true;                                                     </span>
<span  style=""> 108                                                                                                          </span>
<span class="7059678051681133033" onmouseenter="enter('7059678051681133033');" onmouseout="out('7059678051681133033');" style=""> 109     private static final Log LOG = LogFactory.getLog(ProductCustomPersistenceHandler.class);             </span>
<span  style=""> 110                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 111     @Override                                                                                            </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 112     public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                 </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 113         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 113         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClðŸ”µ</abbr></span>
<span class="-1941058799374650916" onmouseenter="enter('-1941058799374650916');" onmouseout="out('-1941058799374650916');" style=""> 114         String[] customCriteria = persistencePackage.getCustomCriteria();                                </span>
<span class="-6187520531612273029" onmouseenter="enter('-6187520531612273029');" onmouseout="out('-6187520531612273029');" style=""><abbr title=" 115         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.class.getName().equals(ceilingEntityFullyQualifiedClassname);"> 115         return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; PrðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116     }                                                                                                    </span>
<span  style=""> 117                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118     @Override                                                                                            </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 119     public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 120         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 123     @Override                                                                                            </span>
<span class="-3598578007792382897" onmouseenter="enter('-3598578007792382897');" onmouseout="out('-3598578007792382897');" style=""> 124     public Boolean canHandleRemove(PersistencePackage persistencePackage) {                              </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 125         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128     @Override                                                                                            </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 129     public Boolean canHandleFetch(PersistencePackage persistencePackage) {                               </span>
<span class="-4855907251399383811" onmouseenter="enter('-4855907251399383811');" onmouseout="out('-4855907251399383811');" style=""> 130         return isRecursiveProductSelection(persistencePackage) || canHandleAdd(persistencePackage);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131     }                                                                                                    </span>
<span  style=""> 132                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 133     @Override                                                                                            </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 134     public Boolean canHandleInspect(PersistencePackage persistencePackage) {                             </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 135         return canHandleAdd(persistencePackage);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span  style=""> 137                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138     @Override                                                                                            </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 139     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 139     public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityðŸ”µ</abbr></span>
<span class="-3269781843971996957" onmouseenter="enter('-3269781843971996957');" onmouseout="out('-3269781843971996957');" style=""> 140         Map&lt;String, FieldMetadata&gt; md = getMetadata(persistencePackage, helper);                         </span>
<span  style=""> 141                                                                                                          </span>
<span class="4046647143093628321" onmouseenter="enter('4046647143093628321');" onmouseout="out('4046647143093628321');" style=""> 142         modifyParentCategoryMetadata(md);                                                                </span>
<span  style=""> 143                                                                                                          </span>
<span class="-3976181121340681385" onmouseenter="enter('-3976181121340681385');" onmouseout="out('-3976181121340681385');" style=""> 144         extensionManager.getProxy().manageInspect(md);                                                   </span>
<span  style=""> 145                                                                                                          </span>
<span class="3104749978175677264" onmouseenter="enter('3104749978175677264');" onmouseout="out('3104749978175677264');" style=""> 146         return getResultSet(persistencePackage, helper, md);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147     }                                                                                                    </span>
<span  style=""> 148                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 149     @Override                                                                                            </span>
<span class="1439455151726717615" onmouseenter="enter('1439455151726717615');" onmouseout="out('1439455151726717615');" style=""><abbr title=" 150     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao"> 150     public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynaðŸ”µ</abbr></span>
<span class="7090980851977161261" onmouseenter="enter('7090980851977161261');" onmouseout="out('7090980851977161261');" style=""> 151             dynamicEntityDao, RecordHelper helper) throws ServiceException {                             </span>
<span  style=""> 152                                                                                                          </span>
<span class="7569586386580693394" onmouseenter="enter('7569586386580693394');" onmouseout="out('7569586386580693394');" style=""> 153         if (isRecursiveProductSelection(persistencePackage)) {                                           </span>
<span class="-8647006973930156734" onmouseenter="enter('-8647006973930156734');" onmouseout="out('-8647006973930156734');" style=""> 154             return getFilteredDynamicResultSet(persistencePackage, cto, helper);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155         }                                                                                                </span>
<span  style=""> 156                                                                                                          </span>
<span class="6757106929036196196" onmouseenter="enter('6757106929036196196');" onmouseout="out('6757106929036196196');" style=""> 157         boolean legacy = parentCategoryLegacyModeService.isLegacyMode();                                 </span>
<span  style=""> 158                                                                                                          </span>
<span class="-6242900732247061705" onmouseenter="enter('-6242900732247061705');" onmouseout="out('-6242900732247061705');" style=""> 159         //the following code applies when filters are present only:                                      </span>
<span class="7713333205546637982" onmouseenter="enter('7713333205546637982');" onmouseout="out('7713333205546637982');" style=""><abbr title=" 160         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to be matched"> 160         //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the fiðŸ”µ</abbr></span>
<span class="-4534809142114175803" onmouseenter="enter('-4534809142114175803');" onmouseout="out('-4534809142114175803');" style=""><abbr title=" 161         //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the &quot;legacy&quot; mode."> 161         //against the categories chosen in the listGrid filter. The default behavior up to this point, asðŸ”µ</abbr></span>
<span class="4043022036079520545" onmouseenter="enter('4043022036079520545');" onmouseout="out('4043022036079520545');" style=""><abbr title=" 162         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCategory&quot;."> 162         //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;ðŸ”µ</abbr></span>
<span class="-7849952188616772175" onmouseenter="enter('-7849952188616772175');" onmouseout="out('-7849952188616772175');" style=""><abbr title=" 163         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping in cto.additionalFilterMappings,"> 163         //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilteðŸ”µ</abbr></span>
<span class="-1781087399901648456" onmouseenter="enter('-1781087399901648456');" onmouseout="out('-1781087399901648456');" style=""> 164         //which seeks matching values in  allParentCategoryXRefs instead                                 </span>
<span class="-5527176171961818632" onmouseenter="enter('-5527176171961818632');" onmouseout="out('-5527176171961818632');" style=""> 165         if (!legacy) {                                                                                   </span>
<span class="-4942654953935107368" onmouseenter="enter('-4942654953935107368');" onmouseout="out('-4942654953935107368');" style=""> 166             FilterAndSortCriteria fsc = cto.getCriteriaMap().get(&quot;defaultCategory&quot;);                     </span>
<span class="7732194668261263043" onmouseenter="enter('7732194668261263043');" onmouseout="out('7732194668261263043');" style=""> 167             if (fsc != null) {                                                                           </span>
<span class="5140613669097034739" onmouseenter="enter('5140613669097034739');" onmouseout="out('5140613669097034739');" style=""> 168                 List&lt;String&gt; filterValues = fsc.getFilterValues();                                       </span>
<span class="3991008560349807179" onmouseenter="enter('3991008560349807179');" onmouseout="out('3991008560349807179');" style=""> 169                 cto.getCriteriaMap().remove(&quot;defaultCategory&quot;);                                          </span>
<span  style=""> 170                                                                                                          </span>
<span class="5187909757738614354" onmouseenter="enter('5187909757738614354');" onmouseout="out('5187909757738614354');" style=""><abbr title=" 171                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;Long&gt;() {"> 171                 List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTranðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 172                     @Override                                                                            </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 173                     public Long transform(Object input) {                                                </span>
<span class="7261043087809466345" onmouseenter="enter('7261043087809466345');" onmouseout="out('7261043087809466345');" style=""> 174                         return Long.parseLong(((String) input));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 176                 });                                                                                      </span>
<span class="-3339810432835967648" onmouseenter="enter('-3339810432835967648');" onmouseout="out('-3339810432835967648');" style=""><abbr title=" 177                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();"> 177                 CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder(ðŸ”µ</abbr></span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 178                 CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                          </span>
<span class="1136355655038715928" onmouseenter="enter('1136355655038715928');" onmouseout="out('1136355655038715928');" style=""> 179                 Root&lt;CategoryProductXrefImpl&gt; root = criteria.from(CategoryProductXrefImpl.class);       </span>
<span class="-192292848609070031" onmouseenter="enter('-192292848609070031');" onmouseout="out('-192292848609070031');" style=""> 180                 criteria.select(root.get(&quot;product&quot;).get(&quot;id&quot;).as(Long.class));                           </span>
<span class="4051795261411779358" onmouseenter="enter('4051795261411779358');" onmouseout="out('4051795261411779358');" style=""> 181                 List&lt;Predicate&gt; restrictions = new ArrayList&lt;Predicate&gt;();                               </span>
<span class="7079639045649129257" onmouseenter="enter('7079639045649129257');" onmouseout="out('7079639045649129257');" style=""> 182                 restrictions.add(builder.equal(root.get(&quot;defaultReference&quot;), Boolean.TRUE));             </span>
<span class="5207279827061650716" onmouseenter="enter('5207279827061650716');" onmouseout="out('5207279827061650716');" style=""> 183                 if (CollectionUtils.isNotEmpty(transformedValues)) {                                     </span>
<span class="146441315649268392" onmouseenter="enter('146441315649268392');" onmouseout="out('146441315649268392');" style=""> 184                     restrictions.add(root.get(&quot;category&quot;).get(&quot;id&quot;).in(transformedValues));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                 }                                                                                        </span>
<span  style=""> 186                                                                                                          </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 187                 criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                </span>
<span class="7055825944566640974" onmouseenter="enter('7055825944566640974');" onmouseout="out('7055825944566640974');" style=""><abbr title=" 188                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);"> 188                 TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteriaðŸ”µ</abbr></span>
<span class="8509583784823066198" onmouseenter="enter('8509583784823066198');" onmouseout="out('8509583784823066198');" style=""> 189                 List&lt;Long&gt; productIds = query.getResultList();                                           </span>
<span class="-1516584047908894525" onmouseenter="enter('-1516584047908894525');" onmouseout="out('-1516584047908894525');" style=""><abbr title=" 190                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));"> 190                 productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[pðŸ”µ</abbr></span>
<span  style=""> 191                                                                                                          </span>
<span class="5110006719648509717" onmouseenter="enter('5110006719648509717');" onmouseout="out('5110006719648509717');" style=""> 192                 if (productIds.size() == 0) {                                                            </span>
<span class="-8650761106430502088" onmouseenter="enter('-8650761106430502088');" onmouseout="out('-8650761106430502088');" style=""> 193                     return new DynamicResultSet(null, new Entity[0], 0);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194                 }                                                                                        </span>
<span class="-924931052995986786" onmouseenter="enter('-924931052995986786');" onmouseout="out('-924931052995986786');" style=""> 195                 if (productIds.size() &lt;= queryLimit) {                                                   </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 196                     FilterMapping filterMapping = new FilterMapping()                                    </span>
<span class="-3543945038191067122" onmouseenter="enter('-3543945038191067122');" onmouseout="out('-3543945038191067122');" style=""> 197                             .withFieldPath(new FieldPath().withTargetProperty(&quot;id&quot;))                     </span>
<span class="2232883807641366792" onmouseenter="enter('2232883807641366792');" onmouseout="out('2232883807641366792');" style=""> 198                             .withDirectFilterValues(productIds)                                          </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 199                             .withRestriction(new Restriction()                                           </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 200                                                      .withPredicateProvider(new PredicateProvider() {    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 201                                                                                 @Override                </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 202                                                                                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 202                                                                                 public Predicate buildPreðŸ”µ</abbr></span>
<span class="-5114847374786337606" onmouseenter="enter('-5114847374786337606');" onmouseout="out('-5114847374786337606');" style=""><abbr title=" 203                                                                                                                 From root, String ceilingEntity, String fullPropertyName,"> 203                                                                                                          ðŸ”µ</abbr></span>
<span class="8513618248320586908" onmouseenter="enter('8513618248320586908');" onmouseout="out('8513618248320586908');" style=""><abbr title=" 204                                                                                                                 Path explicitPath, List directValues) {"> 204                                                                                                          ðŸ”µ</abbr></span>
<span class="-7844596111771279367" onmouseenter="enter('-7844596111771279367');" onmouseout="out('-7844596111771279367');" style=""><abbr title=" 205                                                                                     return explicitPath.in(directValues);"> 205                                                                                     return explicitPath.iðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206                                                                                 }                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                                                                             }                            </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 208                                                      )                                                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 209                             );                                                                           </span>
<span class="8464857299985770317" onmouseenter="enter('8464857299985770317');" onmouseout="out('8464857299985770317');" style=""> 210                     cto.getAdditionalFilterMappings().add(filterMapping);                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211                 } else {                                                                                 </span>
<span class="-5679004918959824296" onmouseenter="enter('-5679004918959824296');" onmouseout="out('-5679004918959824296');" style=""> 212                     String joined = StringUtils.join(transformedValues, &#x27;,&#x27;);                            </span>
<span class="-7138538771694428625" onmouseenter="enter('-7138538771694428625');" onmouseout="out('-7138538771694428625');" style=""><abbr title=" 213                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since there are &quot; +"> 213                     LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query sðŸ”µ</abbr></span>
<span class="-3268164569215202291" onmouseenter="enter('-3268164569215202291');" onmouseout="out('-3268164569215202291');" style=""><abbr title=" 214                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected default categories(%s). This is a &quot; +"> 214                                            &quot;more than &quot; + queryLimit + &quot; products found to belong to the ðŸ”µ</abbr></span>
<span class="6513435278584853007" onmouseenter="enter('6513435278584853007');" onmouseout="out('6513435278584853007');" style=""> 215                                            &quot;filter query limitation.&quot;, joined));                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                 }                                                                                        </span>
<span class="-6371393405809532308" onmouseenter="enter('-6371393405809532308');" onmouseout="out('-6371393405809532308');" style=""> 217                 cto.getNonCountAdditionalFilterMappings().add(                                           </span>
<span class="861084839636182372" onmouseenter="enter('861084839636182372');" onmouseout="out('861084839636182372');" style=""> 218                         new FilterMapping().withFieldPath(new FieldPath().                               </span>
<span class="-2774318940771911356" onmouseenter="enter('-2774318940771911356');" onmouseout="out('-2774318940771911356');" style=""> 219                                 withAssociationPath(Arrays.asList(&quot;allParentCategoryXrefs&quot;,&quot;category&quot;)). </span>
<span class="821868564123592571" onmouseenter="enter('821868564123592571');" onmouseout="out('821868564123592571');" style=""> 220                                 withTargetPropertyPieces(Arrays.asList(&quot;name&quot;)))                         </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 221                                 .withDirectFilterValues(new EmptyFilterValues())                         </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 222                                 .withRestriction(new Restriction()                                       </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 223                                         .withPredicateProvider(new PredicateProvider() {                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 224                                             @Override                                                    </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 225                                             public Predicate buildPredicate(CriteriaBuilder builder,     </span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 226                                                                             FieldPathBuilder fieldPathBuilder, From root,"> 226                                                                             FieldPathBuilder fieldPathBuiðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""> 227                                                                             String ceilingEntity,        </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 228                                                                             String fullPropertyName, Path explicitPath,"> 228                                                                             String fullPropertyName, PathðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 229                                                                             List directValues) {         </span>
<span class="-8553876951484288081" onmouseenter="enter('-8553876951484288081');" onmouseout="out('-8553876951484288081');" style=""><abbr title=" 230                                                 //expect it to be allParentCategoryXrefs.category.name, so we need to restrict on allParentCategoryXrefs - 2 levels up"> 230                                                 //expect it to be allParentCategoryXrefs.category.name, sðŸ”µ</abbr></span>
<span class="8037864455504608737" onmouseenter="enter('8037864455504608737');" onmouseout="out('8037864455504608737');" style=""><abbr title=" 231                                                 Predicate equal = builder.equal(explicitPath.getParentPath().getParentPath().get(&quot;defaultReference&quot;), Boolean.TRUE);"> 231                                                 Predicate equal = builder.equal(explicitPath.getParentPatðŸ”µ</abbr></span>
<span class="1665766703297118664" onmouseenter="enter('1665766703297118664');" onmouseout="out('1665766703297118664');" style=""> 232                                                 return equal;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                                             }                                                            </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 234                                         })                                                               </span>
<span class="-3422099077497392780" onmouseenter="enter('-3422099077497392780');" onmouseout="out('-3422099077497392780');" style=""> 235                                 ).withSortDirection(fsc.getSortDirection()));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span  style=""> 238                                                                                                          </span>
<span class="2582332595020198633" onmouseenter="enter('2582332595020198633');" onmouseout="out('2582332595020198633');" style=""> 239         if (eagerFetchAssociations) {                                                                    </span>
<span class="6234898006418452293" onmouseenter="enter('6234898006418452293');" onmouseout="out('6234898006418452293');" style=""> 240             cto.getNonCountAdditionalFilterMappings().add(new FilterMapping()                            </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""><abbr title=" 241                                                                   .withDirectFilterValues(new EmptyFilterValues())"> 241                                                                   .withDirectFilterValues(new EmptyFilterðŸ”µ</abbr></span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 242                                                                   .withRestriction(new Restriction()     </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""><abbr title=" 243                                                                                            .withPredicateProvider(new PredicateProvider() {"> 243                                                                                            .withPredicateðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244                                                                                                @Override </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""><abbr title=" 245                                                                                                public Predicate buildPredicate(CriteriaBuilder builder,"> 245                                                                                                public PreðŸ”µ</abbr></span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 246                                                                                                                                FieldPathBuilder fieldPathBuilder, From root,"> 246                                                                                                          ðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""><abbr title=" 247                                                                                                                                String ceilingEntity,"> 247                                                                                                          ðŸ”µ</abbr></span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 248                                                                                                                                String fullPropertyName, Path explicitPath,"> 248                                                                                                          ðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""><abbr title=" 249                                                                                                                                List directValues) {"> 249                                                                                                          ðŸ”µ</abbr></span>
<span class="624264344901137787" onmouseenter="enter('624264344901137787');" onmouseout="out('624264344901137787');" style=""><abbr title=" 250                                                                                                    root.fetch(&quot;defaultSku&quot;, JoinType.LEFT);"> 250                                                                                                    root.fðŸ”µ</abbr></span>
<span class="2236319445290317600" onmouseenter="enter('2236319445290317600');" onmouseout="out('2236319445290317600');" style=""><abbr title=" 251                                                                                                    root.fetch(&quot;defaultCategory&quot;, JoinType.LEFT);"> 251                                                                                                    root.fðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""><abbr title=" 252                                                                                                    return null;"> 252                                                                                                    returnðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                                                                                                }         </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 254                                                                                            })            </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 255                                                                   ));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256         }                                                                                                </span>
<span class="-5277136380896832206" onmouseenter="enter('-5277136380896832206');" onmouseout="out('-5277136380896832206');" style=""> 257         return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span  style=""> 259                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 260     @Override                                                                                            </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 261     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 261     public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 262         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 263         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 264             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 264             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span class="-1738937064203927240" onmouseenter="enter('-1738937064203927240');" onmouseout="out('-1738937064203927240');" style=""> 265             Product adminInstance = (Product) Class.forName(entity.getType()[0]).newInstance();          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 266             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 266             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 267                                                                                                          </span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 268             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 269                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270             }                                                                                            </span>
<span  style=""> 271                                                                                                          </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 272             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 272             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 273             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span  style=""> 274                                                                                                          </span>
<span class="2994500046663637288" onmouseenter="enter('2994500046663637288');" onmouseout="out('2994500046663637288');" style=""> 275             //Since none of the Sku fields are required, it&#x27;s possible that the user did not fill out    </span>
<span class="-1662985695084142247" onmouseenter="enter('-1662985695084142247');" onmouseout="out('-1662985695084142247');" style=""><abbr title=" 276             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiate one"> 276             //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so iðŸ”µ</abbr></span>
<span class="-4407708836004135952" onmouseenter="enter('-4407708836004135952');" onmouseout="out('-4407708836004135952');" style=""> 277             if (adminInstance.getDefaultSku() == null) {                                                 </span>
<span class="-5869950698936088971" onmouseenter="enter('-5869950698936088971');" onmouseout="out('-5869950698936088971');" style=""> 278                 Sku newSku = catalogService.createSku();                                                 </span>
<span class="3758063373327618746" onmouseenter="enter('3758063373327618746');" onmouseout="out('3758063373327618746');" style=""> 279                 dynamicEntityDao.persist(newSku);                                                        </span>
<span class="3627601061948392291" onmouseenter="enter('3627601061948392291');" onmouseout="out('3627601061948392291');" style=""> 280                 adminInstance.setDefaultSku(newSku);                                                     </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 281                 adminInstance = dynamicEntityDao.merge(adminInstance);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span  style=""> 283                                                                                                          </span>
<span class="1398885520878604990" onmouseenter="enter('1398885520878604990');" onmouseout="out('1398885520878604990');" style=""> 284             //also set the default product for the Sku                                                   </span>
<span class="-5769689371067636269" onmouseenter="enter('-5769689371067636269');" onmouseout="out('-5769689371067636269');" style=""> 285             adminInstance.getDefaultSku().setDefaultProduct(adminInstance);                              </span>
<span class="-8818629679601416674" onmouseenter="enter('-8818629679601416674');" onmouseout="out('-8818629679601416674');" style=""> 286             dynamicEntityDao.merge(adminInstance.getDefaultSku());                                       </span>
<span  style=""> 287                                                                                                          </span>
<span class="6340800826002936969" onmouseenter="enter('6340800826002936969');" onmouseout="out('6340800826002936969');" style=""> 288             // if this is a Pre-Add, skip the rest of the method                                         </span>
<span class="4698552646741459586" onmouseenter="enter('4698552646741459586');" onmouseout="out('4698552646741459586');" style=""> 289             if (entity.isPreAdd()) {                                                                     </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 290                 return helper.getRecord(adminProperties, adminInstance, null, null);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291             }                                                                                            </span>
<span  style=""> 292                                                                                                          </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 293             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 294             if (extensionManager != null) {                                                              </span>
<span class="-1778606721590329888" onmouseenter="enter('-1778606721590329888');" onmouseout="out('-1778606721590329888');" style=""><abbr title=" 295                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persistencePackage, adminInstance);"> 295                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAddðŸ”µ</abbr></span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 296                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 298             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 299                 setupXref(adminInstance);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300             }                                                                                            </span>
<span  style=""> 301                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 302             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 303         } catch (Exception e) {                                                                          </span>
<span class="7134174968934853795" onmouseenter="enter('7134174968934853795');" onmouseout="out('7134174968934853795');" style=""> 304             throw new ServiceException(&quot;Unable to add entity for &quot; + entity.getType()[0], e);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 309     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 309     public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 310         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 311         try {                                                                                            </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""><abbr title=" 312             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();"> 312             PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective(ðŸ”µ</abbr></span>
<span  style=""> 313                                                                                                          </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 314             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 314             Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.gðŸ”µ</abbr></span>
<span  style=""> 315                                                                                                          </span>
<span class="1819538413343548026" onmouseenter="enter('1819538413343548026');" onmouseout="out('1819538413343548026');" style=""><abbr title=" 316             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategory&quot;));"> 316             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategoðŸ”µ</abbr></span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 317             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="6303363757907394261" onmouseenter="enter('6303363757907394261');" onmouseout="out('6303363757907394261');" style=""><abbr title=" 318             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 318             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findPropertðŸ”µ</abbr></span>
<span class="-1298210778461020296" onmouseenter="enter('-1298210778461020296');" onmouseout="out('-1298210778461020296');" style=""><abbr title=" 319                 //Change the inherited type so that this property is disconnected from the entity and validation is temporarily skipped."> 319                 //Change the inherited type so that this property is disconnected from the entity and valðŸ”µ</abbr></span>
<span class="5827004128286973668" onmouseenter="enter('5827004128286973668');" onmouseout="out('5827004128286973668');" style=""><abbr title=" 320                 //This is useful when the defaultCategory was previously completely empty for whatever reason. Without this, such"> 320                 //This is useful when the defaultCategory was previously completely empty for whatever reðŸ”µ</abbr></span>
<span class="-8493051113864514358" onmouseenter="enter('-8493051113864514358');" onmouseout="out('-8493051113864514358');" style=""><abbr title=" 321                 //a case would fail the validation, even though the property was specified in the submission."> 321                 //a case would fail the validation, even though the property was specified in the submissðŸ”µ</abbr></span>
<span class="-8335887377494536791" onmouseenter="enter('-8335887377494536791');" onmouseout="out('-8335887377494536791');" style=""> 322                 defaultCategory.setInheritedFromType(String.class.getName());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323             }                                                                                            </span>
<span  style=""> 324                                                                                                          </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 325             Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                           </span>
<span class="6153157527633548109" onmouseenter="enter('6153157527633548109');" onmouseout="out('6153157527633548109');" style=""><abbr title=" 326             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 326             Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]ðŸ”µ</abbr></span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 327             if (adminInstance instanceof ProductBundle) {                                                </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 328                 removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329             }                                                                                            </span>
<span  style=""> 330                                                                                                          </span>
<span class="-710126092547245946" onmouseenter="enter('-710126092547245946');" onmouseout="out('-710126092547245946');" style=""> 331             CategoryProductXref oldDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="-5817707795302619279" onmouseenter="enter('-5817707795302619279');" onmouseout="out('-5817707795302619279');" style=""><abbr title=" 332             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched from db"> 332             //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not beðŸ”µ</abbr></span>
<span class="6655495238084243637" onmouseenter="enter('6655495238084243637');" onmouseout="out('6655495238084243637');" style=""><abbr title=" 333             //and it will cause validation error, we should allow deployemnt of product with category in sandbox state"> 333             //and it will cause validation error, we should allow deployemnt of product with category in ðŸ”µ</abbr></span>
<span class="6453615407021429154" onmouseenter="enter('6453615407021429154');" onmouseout="out('6453615407021429154');" style=""> 334             //so override required flag for that field during deployment                                 </span>
<span class="-367004153561380049" onmouseenter="enter('-367004153561380049');" onmouseout="out('-367004153561380049');" style=""> 335             if(BroadleafRequestContext.getBroadleafRequestContext().isProductionSandBox()){              </span>
<span class="-3632045312370469531" onmouseenter="enter('-3632045312370469531');" onmouseout="out('-3632045312370469531');" style=""> 336                 ((BasicFieldMetadata)adminProperties.get(&quot;defaultCategory&quot;)).setRequiredOverride(false); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337             }                                                                                            </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 338             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 338             adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminPropertiðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 339             adminInstance = dynamicEntityDao.merge(adminInstance);                                       </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 340             boolean handled = false;                                                                     </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 341             if (extensionManager != null) {                                                              </span>
<span class="-3727608922273128682" onmouseenter="enter('-3727608922273128682');" onmouseout="out('-3727608922273128682');" style=""><abbr title=" 342                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdate"> 342                 ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdðŸ”µ</abbr></span>
<span class="-5509937458278318351" onmouseenter="enter('-5509937458278318351');" onmouseout="out('-5509937458278318351');" style=""> 343                         (persistencePackage, adminInstance);                                             </span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 344                 handled = ExtensionResultStatusType.NOT_HANDLED != result;                               </span>
<span  style=""> 345                                                                                                          </span>
<span class="1636360182407915778" onmouseenter="enter('1636360182407915778');" onmouseout="out('1636360182407915778');" style=""> 346                 extensionManager.getProxy().manageFields(persistencePackage, adminInstance);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347             }                                                                                            </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 348             if (!handled) {                                                                              </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 349                 setupXref(adminInstance);                                                                </span>
<span class="-7967199691392957007" onmouseenter="enter('-7967199691392957007');" onmouseout="out('-7967199691392957007');" style=""> 350                 removeOldDefault(adminInstance, oldDefault, entity);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351             }                                                                                            </span>
<span  style=""> 352                                                                                                          </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 353             return helper.getRecord(adminProperties, adminInstance, null, null);                         </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 354         } catch (Exception e) {                                                                          </span>
<span class="-8723674804020595812" onmouseenter="enter('-8723674804020595812');" onmouseout="out('-8723674804020595812');" style=""> 355             throw new ServiceException(&quot;Unable to update entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span  style=""> 358                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 359     @Override                                                                                            </span>
<span class="1887636609613592843" onmouseenter="enter('1887636609613592843');" onmouseout="out('1887636609613592843');" style=""><abbr title=" 360     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 360     public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 361         Entity entity = persistencePackage.getEntity();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 362         try {                                                                                            </span>
<span class="3243810268662008348" onmouseenter="enter('3243810268662008348');" onmouseout="out('3243810268662008348');" style=""><abbr title=" 363             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);"> 363             Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entityðŸ”µ</abbr></span>
<span class="-4186523034208284789" onmouseenter="enter('-4186523034208284789');" onmouseout="out('-4186523034208284789');" style=""> 364             removeProduct(persistencePackage, adminInstance, helper);                                    </span>
<span class="29076383544473850" onmouseenter="enter('29076383544473850');" onmouseout="out('29076383544473850');" style=""> 365             List&lt;Sku&gt; skuList = adminInstance.getAllSkus();                                              </span>
<span class="-2506961360510940575" onmouseenter="enter('-2506961360510940575');" onmouseout="out('-2506961360510940575');" style=""> 366             for (Sku sku : skuList) {                                                                    </span>
<span class="2039383434106799748" onmouseenter="enter('2039383434106799748');" onmouseout="out('2039383434106799748');" style=""> 367                 catalogService.removeSku(sku);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368             }                                                                                            </span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 369         } catch (ClassNotFoundException e) {                                                             </span>
<span class="8549847936080404575" onmouseenter="enter('8549847936080404575');" onmouseout="out('8549847936080404575');" style=""> 370             throw new ServiceException(&quot;Unable to remove entity for &quot; + entity.getType()[0], e);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span  style=""> 373                                                                                                          </span>
<span class="-8634314107060974128" onmouseenter="enter('-8634314107060974128');" onmouseout="out('-8634314107060974128');" style=""><abbr title=" 374     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,"> 374     protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntðŸ”µ</abbr></span>
<span class="2232129114834499824" onmouseenter="enter('2232129114834499824');" onmouseout="out('2232129114834499824');" style=""> 375                                        Entity entity) throws ClassNotFoundException {                    </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 376         PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();  </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 377         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 377         Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getNaðŸ”µ</abbr></span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 378         Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                               </span>
<span class="3403576257396241131" onmouseenter="enter('3403576257396241131');" onmouseout="out('3403576257396241131');" style=""> 379         String type = entity.getType()[0];                                                               </span>
<span class="791413654597460382" onmouseenter="enter('791413654597460382');" onmouseout="out('791413654597460382');" style=""> 380         Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);    </span>
<span  style=""> 381                                                                                                          </span>
<span class="2848615422851099691" onmouseenter="enter('2848615422851099691');" onmouseout="out('2848615422851099691');" style=""> 382         return adminInstance;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383     }                                                                                                    </span>
<span  style=""> 384                                                                                                          </span>
<span class="-7276315230897223897" onmouseenter="enter('-7276315230897223897');" onmouseout="out('-7276315230897223897');" style=""><abbr title=" 385     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {"> 385     protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelpðŸ”µ</abbr></span>
<span class="8222559285797311452" onmouseenter="enter('8222559285797311452');" onmouseout="out('8222559285797311452');" style=""> 386         catalogService.removeProduct(adminInstance);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387     }                                                                                                    </span>
<span  style=""> 388                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 389     /**                                                                                                  </span>
<span class="-6565674410629622369" onmouseenter="enter('-6565674410629622369');" onmouseout="out('-6565674410629622369');" style=""> 390      * If the pricing model is of type item_sum, that property should not be required                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 391      *                                                                                                   </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 392      * @param adminInstance                                                                              </span>
<span class="1188154204740832420" onmouseenter="enter('1188154204740832420');" onmouseout="out('1188154204740832420');" style=""> 393      * @param adminProperties                                                                            </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 394      * @param entity                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 395      */                                                                                                  </span>
<span class="1796231511775682058" onmouseenter="enter('1796231511775682058');" onmouseout="out('1796231511775682058');" style=""><abbr title=" 396     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminProperties, Entity entity) {"> 396     protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; ðŸ”µ</abbr></span>
<span class="-7898829768536246574" onmouseenter="enter('-7898829768536246574');" onmouseout="out('-7898829768536246574');" style=""> 397         //no required validation for product bundles                                                     </span>
<span class="2028132163697204828" onmouseenter="enter('2028132163697204828');" onmouseout="out('2028132163697204828');" style=""> 398         ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(false); </span>
<span class="-1136678238396033433" onmouseenter="enter('-1136678238396033433');" onmouseout="out('-1136678238396033433');" style=""> 399         if (entity.getPMap().get(&quot;pricingModel&quot;) != null) {                                              </span>
<span class="-5810729812081766749" onmouseenter="enter('-5810729812081766749');" onmouseout="out('-5810729812081766749');" style=""><abbr title=" 400             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValue())) {"> 400             if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;ðŸ”µ</abbr></span>
<span class="-8087214156619436047" onmouseenter="enter('-8087214156619436047');" onmouseout="out('-8087214156619436047');" style=""><abbr title=" 401                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(true);"> 401                 ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="-6194621554657272575" onmouseenter="enter('-6194621554657272575');" onmouseout="out('-6194621554657272575');" style=""> 406     protected Boolean isDefaultCategoryLegacyMode() {                                                    </span>
<span class="-2222712760012631506" onmouseenter="enter('-2222712760012631506');" onmouseout="out('-2222712760012631506');" style=""><abbr title=" 407         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeService();"> 407         ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyðŸ”µ</abbr></span>
<span class="-3125121052433413106" onmouseenter="enter('-3125121052433413106');" onmouseout="out('-3125121052433413106');" style=""> 408         if (legacyModeService != null) {                                                                 </span>
<span class="-7433711904609854570" onmouseenter="enter('-7433711904609854570');" onmouseout="out('-7433711904609854570');" style=""> 409             return legacyModeService.isLegacyMode();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 411         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412     }                                                                                                    </span>
<span  style=""> 413                                                                                                          </span>
<span class="-182298883698048941" onmouseenter="enter('-182298883698048941');" onmouseout="out('-182298883698048941');" style=""> 414     protected void modifyParentCategoryMetadata(Map&lt;String, FieldMetadata&gt; md) {                         </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 415         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-3233029088333925194" onmouseenter="enter('-3233029088333925194');" onmouseout="out('-3233029088333925194');" style=""> 416             md.remove(&quot;allParentCategoryXrefs&quot;);                                                         </span>
<span  style=""> 417                                                                                                          </span>
<span class="-8850866426953517740" onmouseenter="enter('-8850866426953517740');" onmouseout="out('-8850866426953517740');" style=""> 418             BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) md.get(&quot;defaultCategory&quot;));       </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 419             defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421     }                                                                                                    </span>
<span  style=""> 422                                                                                                          </span>
<span class="4323219351741765804" onmouseenter="enter('4323219351741765804');" onmouseout="out('4323219351741765804');" style=""> 423     protected Category getExistingDefaultCategory(Product product) {                                     </span>
<span class="4785057058955893593" onmouseenter="enter('4785057058955893593');" onmouseout="out('4785057058955893593');" style=""> 424         //Make sure we get the actual field value - not something manipulated in the getter              </span>
<span class="-7097588232152162933" onmouseenter="enter('-7097588232152162933');" onmouseout="out('-7097588232152162933');" style=""> 425         Category parentCategory;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 426         try {                                                                                            </span>
<span class="1642298731132209432" onmouseenter="enter('1642298731132209432');" onmouseout="out('1642298731132209432');" style=""> 427             Field defaultCategory = ProductImpl.class.getDeclaredField(&quot;defaultCategory&quot;);               </span>
<span class="-5472088449890863756" onmouseenter="enter('-5472088449890863756');" onmouseout="out('-5472088449890863756');" style=""> 428             defaultCategory.setAccessible(true);                                                         </span>
<span class="-5032854148355745900" onmouseenter="enter('-5032854148355745900');" onmouseout="out('-5032854148355745900');" style=""> 429             parentCategory = (Category) defaultCategory.get(product);                                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 430         } catch (NoSuchFieldException e) {                                                               </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 431             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 432         } catch (IllegalAccessException e) {                                                             </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 433             throw ExceptionHelper.refineException(e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434         }                                                                                                </span>
<span class="-4827692301542162901" onmouseenter="enter('-4827692301542162901');" onmouseout="out('-4827692301542162901');" style=""> 435         return parentCategory;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436     }                                                                                                    </span>
<span  style=""> 437                                                                                                          </span>
<span class="2198792804957949705" onmouseenter="enter('2198792804957949705');" onmouseout="out('2198792804957949705');" style=""><abbr title=" 438     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity) {"> 438     protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity)ðŸ”µ</abbr></span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 439         if (!isDefaultCategoryLegacyMode()) {                                                            </span>
<span class="-8408462162055715920" onmouseenter="enter('-8408462162055715920');" onmouseout="out('-8408462162055715920');" style=""><abbr title=" 440             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 440             if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findPropertyðŸ”µ</abbr></span>
<span class="3184747591230429719" onmouseenter="enter('3184747591230429719');" onmouseout="out('3184747591230429719');" style=""> 441                 adminInstance.setCategory(null);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442             }                                                                                            </span>
<span class="7434653101319155783" onmouseenter="enter('7434653101319155783');" onmouseout="out('7434653101319155783');" style=""> 443             CategoryProductXref newDefault = getCurrentDefaultXref(adminInstance);                       </span>
<span class="1862582476950403842" onmouseenter="enter('1862582476950403842');" onmouseout="out('1862582476950403842');" style=""> 444             if (oldDefault != null &amp;&amp; !oldDefault.equals(newDefault)) {                                  </span>
<span class="-2218242322092133143" onmouseenter="enter('-2218242322092133143');" onmouseout="out('-2218242322092133143');" style=""> 445                 adminInstance.getAllParentCategoryXrefs().remove(oldDefault);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448     }                                                                                                    </span>
<span  style=""> 449                                                                                                          </span>
<span class="902349756604301531" onmouseenter="enter('902349756604301531');" onmouseout="out('902349756604301531');" style=""> 450     protected void setupXref(Product adminInstance) {                                                    </span>
<span class="1047341479251260893" onmouseenter="enter('1047341479251260893');" onmouseout="out('1047341479251260893');" style=""> 451         if (isDefaultCategoryLegacyMode()) {                                                             </span>
<span class="4336193572473592352" onmouseenter="enter('4336193572473592352');" onmouseout="out('4336193572473592352');" style=""> 452             CategoryProductXref categoryXref = new CategoryProductXrefImpl();                            </span>
<span class="3362376343183691887" onmouseenter="enter('3362376343183691887');" onmouseout="out('3362376343183691887');" style=""> 453             categoryXref.setCategory(getExistingDefaultCategory(adminInstance));                         </span>
<span class="998500482226783196" onmouseenter="enter('998500482226783196');" onmouseout="out('998500482226783196');" style=""> 454             categoryXref.setProduct(adminInstance);                                                      </span>
<span class="-2133389353332895077" onmouseenter="enter('-2133389353332895077');" onmouseout="out('-2133389353332895077');" style=""><abbr title=" 455             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() != null) {"> 455             if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCateðŸ”µ</abbr></span>
<span class="-7221514252473967991" onmouseenter="enter('-7221514252473967991');" onmouseout="out('-7221514252473967991');" style=""> 456                 adminInstance.getAllParentCategoryXrefs().add(categoryXref);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459     }                                                                                                    </span>
<span  style=""> 460                                                                                                          </span>
<span class="-4866520984434663516" onmouseenter="enter('-4866520984434663516');" onmouseout="out('-4866520984434663516');" style=""> 461     protected CategoryProductXref getCurrentDefaultXref(Product product) {                               </span>
<span class="5121334440715645479" onmouseenter="enter('5121334440715645479');" onmouseout="out('5121334440715645479');" style=""> 462         CategoryProductXref currentDefault = null;                                                       </span>
<span class="4669448491831723006" onmouseenter="enter('4669448491831723006');" onmouseout="out('4669448491831723006');" style=""> 463         List&lt;CategoryProductXref&gt; xrefs = product.getAllParentCategoryXrefs();                           </span>
<span class="-1899512729290259350" onmouseenter="enter('-1899512729290259350');" onmouseout="out('-1899512729290259350');" style=""> 464         if (!CollectionUtils.isEmpty(xrefs)) {                                                           </span>
<span class="-1984009506268747903" onmouseenter="enter('-1984009506268747903');" onmouseout="out('-1984009506268747903');" style=""> 465             for (CategoryProductXref xref : xrefs) {                                                     </span>
<span class="113451359587339395" onmouseenter="enter('113451359587339395');" onmouseout="out('113451359587339395');" style=""><abbr title=" 466                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReference()) {"> 466                 if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaulðŸ”µ</abbr></span>
<span class="-4081682415228113248" onmouseenter="enter('-4081682415228113248');" onmouseout="out('-4081682415228113248');" style=""> 467                     currentDefault = xref;                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 468                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471         }                                                                                                </span>
<span class="5312955631235184797" onmouseenter="enter('5312955631235184797');" onmouseout="out('5312955631235184797');" style=""> 472         return currentDefault;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473     }                                                                                                    </span>
<span  style=""> 474                                                                                                          </span>
<span class="4094641218853198204" onmouseenter="enter('4094641218853198204');" onmouseout="out('4094641218853198204');" style=""> 475     protected boolean isRecursiveProductSelection(PersistencePackage persistencePackage) {               </span>
<span class="7271253784317390082" onmouseenter="enter('7271253784317390082');" onmouseout="out('7271253784317390082');" style=""> 476         final List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());       </span>
<span class="-5755492140582673003" onmouseenter="enter('-5755492140582673003');" onmouseout="out('-5755492140582673003');" style=""><abbr title=" 477         return Stream.of(&quot;upsaleProduct&quot;, &quot;crossSaleProduct&quot;, &quot;requestingField=addOnProduct&quot;).anyMatch(customCriteria::contains);"> 477         return Stream.of(&quot;upsaleProduct&quot;, &quot;crossSaleProduct&quot;, &quot;requestingField=addOnProduct&quot;).anyMatch(cuðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478     }                                                                                                    </span>
<span  style=""> 479                                                                                                          </span>
<span class="-3368052144456426396" onmouseenter="enter('-3368052144456426396');" onmouseout="out('-3368052144456426396');" style=""><abbr title=" 480     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicateProvider) {"> 480     protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider pðŸ”µ</abbr></span>
<span  style=""> 481                                                                                                          </span>
<span class="8057622255252958217" onmouseenter="enter('8057622255252958217');" onmouseout="out('8057622255252958217');" style=""> 482         FieldPath fieldPath = new FieldPath().withTargetProperty(targetPropertyName);                    </span>
<span class="-6596211108915962883" onmouseenter="enter('-6596211108915962883');" onmouseout="out('-6596211108915962883');" style=""> 483         EmptyFilterValues directFilterValues = new EmptyFilterValues();                                  </span>
<span class="4277357472881062872" onmouseenter="enter('4277357472881062872');" onmouseout="out('4277357472881062872');" style=""> 484         Restriction newRestriction = new Restriction().withPredicateProvider(predicateProvider);         </span>
<span  style=""> 485                                                                                                          </span>
<span class="3608289770015613450" onmouseenter="enter('3608289770015613450');" onmouseout="out('3608289770015613450');" style=""> 486         return new FilterMapping()                                                                       </span>
<span class="-6035283433958931422" onmouseenter="enter('-6035283433958931422');" onmouseout="out('-6035283433958931422');" style=""> 487             .withFieldPath(fieldPath)                                                                    </span>
<span class="1581873956966044880" onmouseenter="enter('1581873956966044880');" onmouseout="out('1581873956966044880');" style=""> 488             .withDirectFilterValues(directFilterValues)                                                  </span>
<span class="27993374560272883" onmouseenter="enter('27993374560272883');" onmouseout="out('27993374560272883');" style=""> 489             .withRestriction(newRestriction);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490     }                                                                                                    </span>
<span  style=""> 491                                                                                                          </span>
<span class="1303149189704190318" onmouseenter="enter('1303149189704190318');" onmouseout="out('1303149189704190318');" style=""><abbr title=" 492     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferObject cto, RecordHelper helper) throws ServiceException {"> 492     protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriðŸ”µ</abbr></span>
<span  style=""> 493                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 494 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-3386273820962459143" onmouseenter="enter('-3386273820962459143');" onmouseout="out('-3386273820962459143');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 495         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0) {"> 495         if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0)ðŸ”µ</abbr></span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 496             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 496             FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 497                 @Override                                                                                </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 498                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 498                 public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuildeðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 499                                                 String ceilingEntity, String fullPropertyName, Path explicitPath,"> 499                                                 String ceilingEntity, String fullPropertyName, Path expliðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 500                                                 List directValues) {                                     </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 501                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 501                     return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbsðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 502                 }                                                                                        </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 503             });                                                                                          </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 504             cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 505         }                                                                                                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 506 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 507 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 507 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 508 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                                                                                                          </span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510         SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                            </span>
<span class="-4365624777334076097" onmouseenter="enter('-4365624777334076097');" onmouseout="out('-4365624777334076097');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511         if (sectionCrumbs != null &amp;&amp; sectionCrumbs.length &gt; 0) {                                         </span>
<span class="-4393846817404821398" onmouseenter="enter('-4393846817404821398');" onmouseout="out('-4393846817404821398');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512             FilterMapping defaultCategoryMapping = this.createFilterMappingForProperty(                  </span>
<span class="-1391188242443598318" onmouseenter="enter('-1391188242443598318');" onmouseout="out('-1391188242443598318');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513                     ID_PROPERTY,                                                                         </span>
<span class="-7754832296053455105" onmouseenter="enter('-7754832296053455105');" onmouseout="out('-7754832296053455105');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 514                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, directValues)"> 514                     (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, direðŸ”µ</abbr></span>
<span class="-2761785120798275454" onmouseenter="enter('-2761785120798275454');" onmouseout="out('-2761785120798275454');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 515                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()))"> 515                             -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516             );                                                                                           </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517             cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518         }                                                                                                </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 519 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 520                                                                                                          </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 521         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 521         OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style=""> 522         PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                     </span>
<span class="6289449121708775001" onmouseenter="enter('6289449121708775001');" onmouseout="out('6289449121708775001');" style=""> 523         return persistenceModule.fetch(persistencePackage, cto);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525 }                                                                                                        </span>





</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="607567072764399459" onmouseenter="enter('607567072764399459');" onmouseout="out('607567072764399459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 +/*-                                                                                                               </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   3   * #%L                                                                                                            </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   4   * BroadleafCommerce Admin Module                                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   5   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="2735768235135741819" onmouseenter="enter('2735768235135741819');" onmouseout="out('2735768235135741819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   7 + * Copyright (C) 2009 - 2022 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   8   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   9   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">  10   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">  11   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  12   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  13   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  14   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  15   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  16   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  16   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  17   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  18   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  19   */                                                                                                               </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  20  package org.broadleafcommerce.admin.server.service.handler;                                                       </span>
<span  style="">  21                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  22  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  23  import org.apache.commons.lang.ArrayUtils;                                                                        </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  24  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  25  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  26  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5003207573385979332" onmouseenter="enter('5003207573385979332');" onmouseout="out('5003207573385979332');" style="">  27  import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManager;      </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  28  import org.broadleafcommerce.common.exception.ExceptionHelper;                                                    </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  29  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  30  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  31  import org.broadleafcommerce.common.presentation.client.OperationType;                                            </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  32  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-2618521349256495257" onmouseenter="enter('-2618521349256495257');" onmouseout="out('-2618521349256495257');" style="">  33  import org.broadleafcommerce.common.service.ParentCategoryLegacyModeService;                                      </span>
<span class="-3988587350630126043" onmouseenter="enter('-3988587350630126043');" onmouseout="out('-3988587350630126043');" style="">  34  import org.broadleafcommerce.common.service.ParentCategoryLegacyModeServiceImpl;                                  </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  35  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  36  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  37  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  38  import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  39  import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                             </span>
<span class="5877661970606637396" onmouseenter="enter('5877661970606637396');" onmouseout="out('5877661970606637396');" style="">  40  import org.broadleafcommerce.core.catalog.domain.CategoryProductXrefImpl;                                         </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  41  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  42  import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  43  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  44  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  45  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-428848345283345816" onmouseenter="enter('-428848345283345816');" onmouseout="out('-428848345283345816');" style="">  46  import org.broadleafcommerce.core.catalog.service.type.ProductBundlePricingModelType;                             </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  47  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  48  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  49  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  50  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  51  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  52  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  53  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  54  import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                                </span>

<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  55  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  56  import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;                    </span>
<span class="-4913438826169444493" onmouseenter="enter('-4913438826169444493');" onmouseout="out('-4913438826169444493');" style="">  57  import org.broadleafcommerce.openadmin.server.service.persistence.module.EmptyFilterValues;                       </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  58  import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                           </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  59  import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;                       </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  60  import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                            </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  61  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;                      </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  62  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;               </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  63  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;                  </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  64  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;                    </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style="">  65  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  66  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  67  import org.springframework.stereotype.Component;                                                                  </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  68  import java.lang.reflect.Field;                                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  69  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  70  import java.util.Arrays;                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  71  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  72  import java.util.Map;                                                                                             </span>


<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  73  import javax.annotation.Resource;                                                                                 </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  74  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  75  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  76  import javax.persistence.criteria.CriteriaQuery;                                                                  </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  77  import javax.persistence.criteria.From;                                                                           </span>
<span class="4189756756281347615" onmouseenter="enter('4189756756281347615');" onmouseout="out('4189756756281347615');" style="">  78  import javax.persistence.criteria.JoinType;                                                                       </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  79  import javax.persistence.criteria.Path;                                                                           </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  80  import javax.persistence.criteria.Predicate;                                                                      </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  81  import javax.persistence.criteria.Root;                                                                           </span>
<span  style="">  82                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83  /**                                                                                                               </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  84   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85   */                                                                                                               </span>
<span class="660262005045399639" onmouseenter="enter('660262005045399639');" onmouseout="out('660262005045399639');" style="">  86  @Component(&quot;blProductCustomPersistenceHandler&quot;)                                                                   </span>
<span class="-5558200371078111093" onmouseenter="enter('-5558200371078111093');" onmouseout="out('-5558200371078111093');" style="">  87  public class ProductCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                            </span>
<span  style="">  88                                                                                                                    </span>
<span class="6601773269924456427" onmouseenter="enter('6601773269924456427');" onmouseout="out('6601773269924456427');" style="">  89      protected static final String ID_PROPERTY = &quot;id&quot;;                                                             </span>
<span  style="">  90                                                                                                                    </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  91      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  92      protected CatalogService catalogService;                                                                      </span>
<span  style="">  93                                                                                                                    </span>
<span class="8724020527834493732" onmouseenter="enter('8724020527834493732');" onmouseout="out('8724020527834493732');" style="">  94      @Resource(name = &quot;blProductCustomPersistenceHandlerExtensionManager&quot;)                                         </span>
<span class="5198675979006161834" onmouseenter="enter('5198675979006161834');" onmouseout="out('5198675979006161834');" style="">  95      protected ProductCustomPersistenceHandlerExtensionManager extensionManager;                                   </span>
<span  style="">  96                                                                                                                    </span>
<span class="-7078262064240547152" onmouseenter="enter('-7078262064240547152');" onmouseout="out('-7078262064240547152');" style="">  97      @Resource(name = &quot;blParentCategoryLegacyModeService&quot;)                                                         </span>
<span class="7833791338969174941" onmouseenter="enter('7833791338969174941');" onmouseout="out('7833791338969174941');" style="">  98      protected ParentCategoryLegacyModeService parentCategoryLegacyModeService;                                    </span>
<span  style="">  99                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 100      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 101      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 102                                                                                                                    </span>
<span class="4171055983434128927" onmouseenter="enter('4171055983434128927');" onmouseout="out('4171055983434128927');" style=""> 103      @Value(&quot;${product.query.limit:500}&quot;)                                                                          </span>
<span class="395756119071585853" onmouseenter="enter('395756119071585853');" onmouseout="out('395756119071585853');" style=""> 104      protected long queryLimit;                                                                                    </span>
<span  style=""> 105                                                                                                                    </span>
<span class="1763955632160691042" onmouseenter="enter('1763955632160691042');" onmouseout="out('1763955632160691042');" style=""> 106      @Value(&quot;${product.eager.fetch.associations.admin:true}&quot;)                                                      </span>
<span class="-5859298812289369627" onmouseenter="enter('-5859298812289369627');" onmouseout="out('-5859298812289369627');" style=""> 107      protected boolean eagerFetchAssociations = true;                                                              </span>
<span  style=""> 108                                                                                                                    </span>
<span class="7059678051681133033" onmouseenter="enter('7059678051681133033');" onmouseout="out('7059678051681133033');" style=""> 109      private static final Log LOG = LogFactory.getLog(ProductCustomPersistenceHandler.class);                      </span>
<span  style=""> 110                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 111      @Override                                                                                                     </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 112      public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                          </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 113          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 113          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-1941058799374650916" onmouseenter="enter('-1941058799374650916');" onmouseout="out('-1941058799374650916');" style=""> 114          String[] customCriteria = persistencePackage.getCustomCriteria();                                         </span>
<span class="-6187520531612273029" onmouseenter="enter('-6187520531612273029');" onmouseout="out('-6187520531612273029');" style=""><abbr title=" 115          return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.class.getName().equals(ceilingEntityFullyQualifiedClassname);"> 115          return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.claðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116      }                                                                                                             </span>
<span  style=""> 117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118      @Override                                                                                                     </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 119      public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                                       </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 120          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121      }                                                                                                             </span>
<span  style=""> 122                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 123      @Override                                                                                                     </span>
<span class="-3598578007792382897" onmouseenter="enter('-3598578007792382897');" onmouseout="out('-3598578007792382897');" style=""> 124      public Boolean canHandleRemove(PersistencePackage persistencePackage) {                                       </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 125          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126      }                                                                                                             </span>
<span  style=""> 127                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128      @Override                                                                                                     </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 129      public Boolean canHandleFetch(PersistencePackage persistencePackage) {                                        </span>
<span class="-4855907251399383811" onmouseenter="enter('-4855907251399383811');" onmouseout="out('-4855907251399383811');" style=""> 130          return isRecursiveProductSelection(persistencePackage) || canHandleAdd(persistencePackage);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 133      @Override                                                                                                     </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 134      public Boolean canHandleInspect(PersistencePackage persistencePackage) {                                      </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 135          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136      }                                                                                                             </span>
<span  style=""> 137                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138      @Override                                                                                                     </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 139      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 139      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspðŸ”µ</abbr></span>
<span class="-3269781843971996957" onmouseenter="enter('-3269781843971996957');" onmouseout="out('-3269781843971996957');" style=""> 140          Map&lt;String, FieldMetadata&gt; md = getMetadata(persistencePackage, helper);                                  </span>
<span  style=""> 141                                                                                                                    </span>
<span class="4046647143093628321" onmouseenter="enter('4046647143093628321');" onmouseout="out('4046647143093628321');" style=""> 142          modifyParentCategoryMetadata(md);                                                                         </span>
<span  style=""> 143                                                                                                                    </span>
<span class="-3976181121340681385" onmouseenter="enter('-3976181121340681385');" onmouseout="out('-3976181121340681385');" style=""> 144          extensionManager.getProxy().manageInspect(md);                                                            </span>
<span  style=""> 145                                                                                                                    </span>
<span class="3104749978175677264" onmouseenter="enter('3104749978175677264');" onmouseout="out('3104749978175677264');" style=""> 146          return getResultSet(persistencePackage, helper, md);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147      }                                                                                                             </span>
<span  style=""> 148                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 149      @Override                                                                                                     </span>
<span class="1439455151726717615" onmouseenter="enter('1439455151726717615');" onmouseout="out('1439455151726717615');" style=""><abbr title=" 150      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao"> 150      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityðŸ”µ</abbr></span>
<span class="7090980851977161261" onmouseenter="enter('7090980851977161261');" onmouseout="out('7090980851977161261');" style=""> 151              dynamicEntityDao, RecordHelper helper) throws ServiceException {                                      </span>
<span  style=""> 152                                                                                                                    </span>
<span class="7569586386580693394" onmouseenter="enter('7569586386580693394');" onmouseout="out('7569586386580693394');" style=""> 153          if (isRecursiveProductSelection(persistencePackage)) {                                                    </span>
<span class="-8647006973930156734" onmouseenter="enter('-8647006973930156734');" onmouseout="out('-8647006973930156734');" style=""> 154              return getFilteredDynamicResultSet(persistencePackage, cto, helper);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155          }                                                                                                         </span>
<span  style=""> 156                                                                                                                    </span>
<span class="6757106929036196196" onmouseenter="enter('6757106929036196196');" onmouseout="out('6757106929036196196');" style=""> 157          boolean legacy = parentCategoryLegacyModeService.isLegacyMode();                                          </span>
<span  style=""> 158                                                                                                                    </span>
<span class="-6242900732247061705" onmouseenter="enter('-6242900732247061705');" onmouseout="out('-6242900732247061705');" style=""> 159          //the following code applies when filters are present only:                                               </span>
<span class="7713333205546637982" onmouseenter="enter('7713333205546637982');" onmouseout="out('7713333205546637982');" style=""><abbr title=" 160          //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to be matched"> 160          //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to beðŸ”µ</abbr></span>
<span class="-4534809142114175803" onmouseenter="enter('-4534809142114175803');" onmouseout="out('-4534809142114175803');" style=""><abbr title=" 161          //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the &quot;legacy&quot; mode."> 161          //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes theðŸ”µ</abbr></span>
<span class="4043022036079520545" onmouseenter="enter('4043022036079520545');" onmouseout="out('4043022036079520545');" style=""><abbr title=" 162          //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCategory&quot;."> 162          //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCaðŸ”µ</abbr></span>
<span class="-7849952188616772175" onmouseenter="enter('-7849952188616772175');" onmouseout="out('-7849952188616772175');" style=""><abbr title=" 163          //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping in cto.additionalFilterMappings,"> 163          //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping ðŸ”µ</abbr></span>
<span class="-1781087399901648456" onmouseenter="enter('-1781087399901648456');" onmouseout="out('-1781087399901648456');" style=""> 164          //which seeks matching values in  allParentCategoryXRefs instead                                          </span>
<span class="-5527176171961818632" onmouseenter="enter('-5527176171961818632');" onmouseout="out('-5527176171961818632');" style=""> 165          if (!legacy) {                                                                                            </span>
<span class="-4942654953935107368" onmouseenter="enter('-4942654953935107368');" onmouseout="out('-4942654953935107368');" style=""> 166              FilterAndSortCriteria fsc = cto.getCriteriaMap().get(&quot;defaultCategory&quot;);                              </span>
<span class="7732194668261263043" onmouseenter="enter('7732194668261263043');" onmouseout="out('7732194668261263043');" style=""> 167              if (fsc != null) {                                                                                    </span>
<span class="5140613669097034739" onmouseenter="enter('5140613669097034739');" onmouseout="out('5140613669097034739');" style=""> 168                  List&lt;String&gt; filterValues = fsc.getFilterValues();                                                </span>
<span class="3991008560349807179" onmouseenter="enter('3991008560349807179');" onmouseout="out('3991008560349807179');" style=""> 169                  cto.getCriteriaMap().remove(&quot;defaultCategory&quot;);                                                   </span>
<span  style=""> 170                                                                                                                    </span>
<span class="5187909757738614354" onmouseenter="enter('5187909757738614354');" onmouseout="out('5187909757738614354');" style=""><abbr title=" 171                  List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;Long&gt;() {"> 171                  List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;LðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 172                      @Override                                                                                     </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 173                      public Long transform(Object input) {                                                         </span>
<span class="7261043087809466345" onmouseenter="enter('7261043087809466345');" onmouseout="out('7261043087809466345');" style=""> 174                          return Long.parseLong(((String) input));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 176                  });                                                                                               </span>
<span class="-3339810432835967648" onmouseenter="enter('-3339810432835967648');" onmouseout="out('-3339810432835967648');" style=""> 177                  CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();       </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 178                  CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                   </span>
<span class="1136355655038715928" onmouseenter="enter('1136355655038715928');" onmouseout="out('1136355655038715928');" style=""> 179                  Root&lt;CategoryProductXrefImpl&gt; root = criteria.from(CategoryProductXrefImpl.class);                </span>
<span class="-192292848609070031" onmouseenter="enter('-192292848609070031');" onmouseout="out('-192292848609070031');" style=""> 180                  criteria.select(root.get(&quot;product&quot;).get(&quot;id&quot;).as(Long.class));                                    </span>
<span class="4051795261411779358" onmouseenter="enter('4051795261411779358');" onmouseout="out('4051795261411779358');" style=""> 181                  List&lt;Predicate&gt; restrictions = new ArrayList&lt;Predicate&gt;();                                        </span>
<span class="7079639045649129257" onmouseenter="enter('7079639045649129257');" onmouseout="out('7079639045649129257');" style=""> 182                  restrictions.add(builder.equal(root.get(&quot;defaultReference&quot;), Boolean.TRUE));                      </span>
<span class="5207279827061650716" onmouseenter="enter('5207279827061650716');" onmouseout="out('5207279827061650716');" style=""> 183                  if (CollectionUtils.isNotEmpty(transformedValues)) {                                              </span>
<span class="146441315649268392" onmouseenter="enter('146441315649268392');" onmouseout="out('146441315649268392');" style=""> 184                      restrictions.add(root.get(&quot;category&quot;).get(&quot;id&quot;).in(transformedValues));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                  }                                                                                                 </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 187                  criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                         </span>
<span class="7055825944566640974" onmouseenter="enter('7055825944566640974');" onmouseout="out('7055825944566640974');" style=""> 188                  TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);       </span>
<span class="8509583784823066198" onmouseenter="enter('8509583784823066198');" onmouseout="out('8509583784823066198');" style=""> 189                  List&lt;Long&gt; productIds = query.getResultList();                                                    </span>
<span class="-1516584047908894525" onmouseenter="enter('-1516584047908894525');" onmouseout="out('-1516584047908894525');" style=""><abbr title=" 190                  productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));"> 190                  productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIdsðŸ”µ</abbr></span>
<span  style=""> 191                                                                                                                    </span>
<span class="5110006719648509717" onmouseenter="enter('5110006719648509717');" onmouseout="out('5110006719648509717');" style=""> 192                  if (productIds.size() == 0) {                                                                     </span>
<span class="-8650761106430502088" onmouseenter="enter('-8650761106430502088');" onmouseout="out('-8650761106430502088');" style=""> 193                      return new DynamicResultSet(null, new Entity[0], 0);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194                  }                                                                                                 </span>
<span class="-924931052995986786" onmouseenter="enter('-924931052995986786');" onmouseout="out('-924931052995986786');" style=""> 195                  if (productIds.size() &lt;= queryLimit) {                                                            </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 196                      FilterMapping filterMapping = new FilterMapping()                                             </span>
<span class="-3543945038191067122" onmouseenter="enter('-3543945038191067122');" onmouseout="out('-3543945038191067122');" style=""> 197                              .withFieldPath(new FieldPath().withTargetProperty(&quot;id&quot;))                              </span>
<span class="2232883807641366792" onmouseenter="enter('2232883807641366792');" onmouseout="out('2232883807641366792');" style=""> 198                              .withDirectFilterValues(productIds)                                                   </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 199                              .withRestriction(new Restriction()                                                    </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 200                                                       .withPredicateProvider(new PredicateProvider() {             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 201                                                                                  @Override                         </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 202                                                                                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 202                                                                                  public Predicate buildPredicate(CrðŸ”µ</abbr></span>
<span class="-5114847374786337606" onmouseenter="enter('-5114847374786337606');" onmouseout="out('-5114847374786337606');" style=""><abbr title=" 203                                                                                                                  From root, String ceilingEntity, String fullPropertyName,"> 203                                                                                                                  FrðŸ”µ</abbr></span>
<span class="8513618248320586908" onmouseenter="enter('8513618248320586908');" onmouseout="out('8513618248320586908');" style=""><abbr title=" 204                                                                                                                  Path explicitPath, List directValues) {"> 204                                                                                                                  PaðŸ”µ</abbr></span>
<span class="-7844596111771279367" onmouseenter="enter('-7844596111771279367');" onmouseout="out('-7844596111771279367');" style=""><abbr title=" 205                                                                                      return explicitPath.in(directValues);"> 205                                                                                      return explicitPath.in(directVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206                                                                                  }                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207                                                                              }                                     </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 208                                                       )                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 209                              );                                                                                    </span>
<span class="8464857299985770317" onmouseenter="enter('8464857299985770317');" onmouseout="out('8464857299985770317');" style=""> 210                      cto.getAdditionalFilterMappings().add(filterMapping);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211                  } else {                                                                                          </span>
<span class="-5679004918959824296" onmouseenter="enter('-5679004918959824296');" onmouseout="out('-5679004918959824296');" style=""> 212                      String joined = StringUtils.join(transformedValues, &#x27;,&#x27;);                                     </span>
<span class="-7138538771694428625" onmouseenter="enter('-7138538771694428625');" onmouseout="out('-7138538771694428625');" style=""><abbr title=" 213                      LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since there are &quot; +"> 213                      LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since therðŸ”µ</abbr></span>
<span class="-3268164569215202291" onmouseenter="enter('-3268164569215202291');" onmouseout="out('-3268164569215202291');" style=""><abbr title=" 214                                             &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected default categories(%s). This is a &quot; +"> 214                                             &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected ðŸ”µ</abbr></span>
<span class="6513435278584853007" onmouseenter="enter('6513435278584853007');" onmouseout="out('6513435278584853007');" style=""> 215                                             &quot;filter query limitation.&quot;, joined));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                  }                                                                                                 </span>
<span class="-6371393405809532308" onmouseenter="enter('-6371393405809532308');" onmouseout="out('-6371393405809532308');" style=""> 217                  cto.getNonCountAdditionalFilterMappings().add(                                                    </span>
<span class="861084839636182372" onmouseenter="enter('861084839636182372');" onmouseout="out('861084839636182372');" style=""> 218                          new FilterMapping().withFieldPath(new FieldPath().                                        </span>
<span class="-2774318940771911356" onmouseenter="enter('-2774318940771911356');" onmouseout="out('-2774318940771911356');" style=""> 219                                  withAssociationPath(Arrays.asList(&quot;allParentCategoryXrefs&quot;,&quot;category&quot;)).          </span>
<span class="821868564123592571" onmouseenter="enter('821868564123592571');" onmouseout="out('821868564123592571');" style=""> 220                                  withTargetPropertyPieces(Arrays.asList(&quot;name&quot;)))                                  </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 221                                  .withDirectFilterValues(new EmptyFilterValues())                                  </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 222                                  .withRestriction(new Restriction()                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 223                                          .withPredicateProvider(new PredicateProvider() {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 224                                              @Override                                                             </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 225                                              public Predicate buildPredicate(CriteriaBuilder builder,              </span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 226                                                                              FieldPathBuilder fieldPathBuilder, From root,"> 226                                                                              FieldPathBuilder fieldPathBuilder, FroðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""> 227                                                                              String ceilingEntity,                 </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 228                                                                              String fullPropertyName, Path explicitPath,"> 228                                                                              String fullPropertyName, Path explicitðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 229                                                                              List directValues) {                  </span>
<span class="-8553876951484288081" onmouseenter="enter('-8553876951484288081');" onmouseout="out('-8553876951484288081');" style=""><abbr title=" 230                                                  //expect it to be allParentCategoryXrefs.category.name, so we need to restrict on allParentCategoryXrefs - 2 levels up"> 230                                                  //expect it to be allParentCategoryXrefs.category.name, so we needðŸ”µ</abbr></span>
<span class="8037864455504608737" onmouseenter="enter('8037864455504608737');" onmouseout="out('8037864455504608737');" style=""><abbr title=" 231                                                  Predicate equal = builder.equal(explicitPath.getParentPath().getParentPath().get(&quot;defaultReference&quot;), Boolean.TRUE);"> 231                                                  Predicate equal = builder.equal(explicitPath.getParentPath().getPaðŸ”µ</abbr></span>
<span class="1665766703297118664" onmouseenter="enter('1665766703297118664');" onmouseout="out('1665766703297118664');" style=""> 232                                                  return equal;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                                              }                                                                     </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 234                                          })                                                                        </span>
<span class="-3422099077497392780" onmouseenter="enter('-3422099077497392780');" onmouseout="out('-3422099077497392780');" style=""> 235                                  ).withSortDirection(fsc.getSortDirection()));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237          }                                                                                                         </span>
<span  style=""> 238                                                                                                                    </span>
<span class="2582332595020198633" onmouseenter="enter('2582332595020198633');" onmouseout="out('2582332595020198633');" style=""> 239          if (eagerFetchAssociations) {                                                                             </span>
<span class="6234898006418452293" onmouseenter="enter('6234898006418452293');" onmouseout="out('6234898006418452293');" style=""> 240              cto.getNonCountAdditionalFilterMappings().add(new FilterMapping()                                     </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 241                                                                    .withDirectFilterValues(new EmptyFilterValues())</span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 242                                                                    .withRestriction(new Restriction()              </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""><abbr title=" 243                                                                                             .withPredicateProvider(new PredicateProvider() {"> 243                                                                                             .withPredicateProvider(ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244                                                                                                 @Override          </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""><abbr title=" 245                                                                                                 public Predicate buildPredicate(CriteriaBuilder builder,"> 245                                                                                                 public Predicate buðŸ”µ</abbr></span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 246                                                                                                                                 FieldPathBuilder fieldPathBuilder, From root,"> 246                                                                                                                    ðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""><abbr title=" 247                                                                                                                                 String ceilingEntity,"> 247                                                                                                                    ðŸ”µ</abbr></span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 248                                                                                                                                 String fullPropertyName, Path explicitPath,"> 248                                                                                                                    ðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""><abbr title=" 249                                                                                                                                 List directValues) {"> 249                                                                                                                    ðŸ”µ</abbr></span>
<span class="624264344901137787" onmouseenter="enter('624264344901137787');" onmouseout="out('624264344901137787');" style=""><abbr title=" 250                                                                                                     root.fetch(&quot;defaultSku&quot;, JoinType.LEFT);"> 250                                                                                                     root.fetch(&quot;defðŸ”µ</abbr></span>
<span class="2236319445290317600" onmouseenter="enter('2236319445290317600');" onmouseout="out('2236319445290317600');" style=""><abbr title=" 251                                                                                                     root.fetch(&quot;defaultCategory&quot;, JoinType.LEFT);"> 251                                                                                                     root.fetch(&quot;defðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 252                                                                                                     return null;   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                                                                                                 }                  </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 254                                                                                             })                     </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 255                                                                    ));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256          }                                                                                                         </span>
<span class="-5277136380896832206" onmouseenter="enter('-5277136380896832206');" onmouseout="out('-5277136380896832206');" style=""> 257          return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258      }                                                                                                             </span>
<span  style=""> 259                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 260      @Override                                                                                                     </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 261      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 261      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 262          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 263          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 264              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-1738937064203927240" onmouseenter="enter('-1738937064203927240');" onmouseout="out('-1738937064203927240');" style=""> 265              Product adminInstance = (Product) Class.forName(entity.getType()[0]).newInstance();                   </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 266              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 266              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(),ðŸ”µ</abbr></span>
<span  style=""> 267                                                                                                                    </span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 268              if (adminInstance instanceof ProductBundle) {                                                         </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 269                  removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270              }                                                                                                     </span>
<span  style=""> 271                                                                                                                    </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 272              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 272              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, falseðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 273              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 274                                                                                                                    </span>
<span class="2994500046663637288" onmouseenter="enter('2994500046663637288');" onmouseout="out('2994500046663637288');" style=""> 275              //Since none of the Sku fields are required, it&#x27;s possible that the user did not fill out             </span>
<span class="-1662985695084142247" onmouseenter="enter('-1662985695084142247');" onmouseout="out('-1662985695084142247');" style=""><abbr title=" 276              //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiate one"> 276              //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiatðŸ”µ</abbr></span>
<span class="-4407708836004135952" onmouseenter="enter('-4407708836004135952');" onmouseout="out('-4407708836004135952');" style=""> 277              if (adminInstance.getDefaultSku() == null) {                                                          </span>
<span class="-5869950698936088971" onmouseenter="enter('-5869950698936088971');" onmouseout="out('-5869950698936088971');" style=""> 278                  Sku newSku = catalogService.createSku();                                                          </span>
<span class="3758063373327618746" onmouseenter="enter('3758063373327618746');" onmouseout="out('3758063373327618746');" style=""> 279                  dynamicEntityDao.persist(newSku);                                                                 </span>
<span class="3627601061948392291" onmouseenter="enter('3627601061948392291');" onmouseout="out('3627601061948392291');" style=""> 280                  adminInstance.setDefaultSku(newSku);                                                              </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 281                  adminInstance = dynamicEntityDao.merge(adminInstance);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282              }                                                                                                     </span>
<span  style=""> 283                                                                                                                    </span>
<span class="1398885520878604990" onmouseenter="enter('1398885520878604990');" onmouseout="out('1398885520878604990');" style=""> 284              //also set the default product for the Sku                                                            </span>
<span class="-5769689371067636269" onmouseenter="enter('-5769689371067636269');" onmouseout="out('-5769689371067636269');" style=""> 285              adminInstance.getDefaultSku().setDefaultProduct(adminInstance);                                       </span>
<span class="-8818629679601416674" onmouseenter="enter('-8818629679601416674');" onmouseout="out('-8818629679601416674');" style=""> 286              dynamicEntityDao.merge(adminInstance.getDefaultSku());                                                </span>
<span  style=""> 287                                                                                                                    </span>
<span class="6340800826002936969" onmouseenter="enter('6340800826002936969');" onmouseout="out('6340800826002936969');" style=""> 288              // if this is a Pre-Add, skip the rest of the method                                                  </span>
<span class="4698552646741459586" onmouseenter="enter('4698552646741459586');" onmouseout="out('4698552646741459586');" style=""> 289              if (entity.isPreAdd()) {                                                                              </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 290                  return helper.getRecord(adminProperties, adminInstance, null, null);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291              }                                                                                                     </span>
<span  style=""> 292                                                                                                                    </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 293              boolean handled = false;                                                                              </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 294              if (extensionManager != null) {                                                                       </span>
<span class="-1778606721590329888" onmouseenter="enter('-1778606721590329888');" onmouseout="out('-1778606721590329888');" style=""><abbr title=" 295                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persistencePackage, adminInstance);"> 295                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persisteðŸ”µ</abbr></span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 296                  handled = ExtensionResultStatusType.NOT_HANDLED != result;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297              }                                                                                                     </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 298              if (!handled) {                                                                                       </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 299                  setupXref(adminInstance);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300              }                                                                                                     </span>
<span  style=""> 301                                                                                                                    </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 302              return helper.getRecord(adminProperties, adminInstance, null, null);                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 303          } catch (Exception e) {                                                                                   </span>
<span class="7134174968934853795" onmouseenter="enter('7134174968934853795');" onmouseout="out('7134174968934853795');" style=""> 304              throw new ServiceException(&quot;Unable to add entity for &quot; + entity.getType()[0], e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308      @Override                                                                                                     </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 309      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 309      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper heðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 310          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 311          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 312              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span  style=""> 313                                                                                                                    </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 314              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 314              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(),ðŸ”µ</abbr></span>
<span  style=""> 315                                                                                                                    </span>
<span class="1819538413343548026" onmouseenter="enter('1819538413343548026');" onmouseout="out('1819538413343548026');" style=""> 316              BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategory&quot;));   </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 317              defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                                       </span>
<span class="6303363757907394261" onmouseenter="enter('6303363757907394261');" onmouseout="out('6303363757907394261');" style=""><abbr title=" 318              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 318              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaulðŸ”µ</abbr></span>
<span class="-1298210778461020296" onmouseenter="enter('-1298210778461020296');" onmouseout="out('-1298210778461020296');" style=""><abbr title=" 319                  //Change the inherited type so that this property is disconnected from the entity and validation is temporarily skipped."> 319                  //Change the inherited type so that this property is disconnected from the entity and validation iðŸ”µ</abbr></span>
<span class="5827004128286973668" onmouseenter="enter('5827004128286973668');" onmouseout="out('5827004128286973668');" style=""><abbr title=" 320                  //This is useful when the defaultCategory was previously completely empty for whatever reason. Without this, such"> 320                  //This is useful when the defaultCategory was previously completely empty for whatever reason. WitðŸ”µ</abbr></span>
<span class="-8493051113864514358" onmouseenter="enter('-8493051113864514358');" onmouseout="out('-8493051113864514358');" style=""> 321                  //a case would fail the validation, even though the property was specified in the submission.     </span>
<span class="-8335887377494536791" onmouseenter="enter('-8335887377494536791');" onmouseout="out('-8335887377494536791');" style=""> 322                  defaultCategory.setInheritedFromType(String.class.getName());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323              }                                                                                                     </span>
<span  style=""> 324                                                                                                                    </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 325              Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                    </span>
<span class="6153157527633548109" onmouseenter="enter('6153157527633548109');" onmouseout="out('6153157527633548109');" style=""><abbr title=" 326              Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 326              Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primarðŸ”µ</abbr></span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 327              if (adminInstance instanceof ProductBundle) {                                                         </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 328                  removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329              }                                                                                                     </span>
<span  style=""> 330                                                                                                                    </span>
<span class="-710126092547245946" onmouseenter="enter('-710126092547245946');" onmouseout="out('-710126092547245946');" style=""> 331              CategoryProductXref oldDefault = getCurrentDefaultXref(adminInstance);                                </span>
<span class="-5817707795302619279" onmouseenter="enter('-5817707795302619279');" onmouseout="out('-5817707795302619279');" style=""><abbr title=" 332              //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched from db"> 332              //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched ðŸ”µ</abbr></span>
<span class="6655495238084243637" onmouseenter="enter('6655495238084243637');" onmouseout="out('6655495238084243637');" style=""><abbr title=" 333              //and it will cause validation error, we should allow deployemnt of product with category in sandbox state"> 333              //and it will cause validation error, we should allow deployemnt of product with category in sandbox sðŸ”µ</abbr></span>
<span class="6453615407021429154" onmouseenter="enter('6453615407021429154');" onmouseout="out('6453615407021429154');" style=""> 334              //so override required flag for that field during deployment                                          </span>
<span class="-367004153561380049" onmouseenter="enter('-367004153561380049');" onmouseout="out('-367004153561380049');" style=""> 335              if(BroadleafRequestContext.getBroadleafRequestContext().isProductionSandBox()){                       </span>
<span class="-3632045312370469531" onmouseenter="enter('-3632045312370469531');" onmouseout="out('-3632045312370469531');" style=""> 336                  ((BasicFieldMetadata)adminProperties.get(&quot;defaultCategory&quot;)).setRequiredOverride(false);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337              }                                                                                                     </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 338              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 338              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, falseðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 339              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 340              boolean handled = false;                                                                              </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 341              if (extensionManager != null) {                                                                       </span>
<span class="-3727608922273128682" onmouseenter="enter('-3727608922273128682');" onmouseout="out('-3727608922273128682');" style=""> 342                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdate      </span>
<span class="-5509937458278318351" onmouseenter="enter('-5509937458278318351');" onmouseout="out('-5509937458278318351');" style=""> 343                          (persistencePackage, adminInstance);                                                      </span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 344                  handled = ExtensionResultStatusType.NOT_HANDLED != result;                                        </span>
<span  style=""> 345                                                                                                                    </span>
<span class="1636360182407915778" onmouseenter="enter('1636360182407915778');" onmouseout="out('1636360182407915778');" style=""> 346                  extensionManager.getProxy().manageFields(persistencePackage, adminInstance);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347              }                                                                                                     </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 348              if (!handled) {                                                                                       </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 349                  setupXref(adminInstance);                                                                         </span>
<span class="-7967199691392957007" onmouseenter="enter('-7967199691392957007');" onmouseout="out('-7967199691392957007');" style=""> 350                  removeOldDefault(adminInstance, oldDefault, entity);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351              }                                                                                                     </span>
<span  style=""> 352                                                                                                                    </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 353              return helper.getRecord(adminProperties, adminInstance, null, null);                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 354          } catch (Exception e) {                                                                                   </span>
<span class="-8723674804020595812" onmouseenter="enter('-8723674804020595812');" onmouseout="out('-8723674804020595812');" style=""> 355              throw new ServiceException(&quot;Unable to update entity for &quot; + entity.getType()[0], e);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357      }                                                                                                             </span>
<span  style=""> 358                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 359      @Override                                                                                                     </span>
<span class="1887636609613592843" onmouseenter="enter('1887636609613592843');" onmouseout="out('1887636609613592843');" style=""><abbr title=" 360      public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 360      public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 361          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 362          try {                                                                                                     </span>
<span class="3243810268662008348" onmouseenter="enter('3243810268662008348');" onmouseout="out('3243810268662008348');" style=""> 363              Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);       </span>
<span class="-4186523034208284789" onmouseenter="enter('-4186523034208284789');" onmouseout="out('-4186523034208284789');" style=""> 364              removeProduct(persistencePackage, adminInstance, helper);                                             </span>
<span class="29076383544473850" onmouseenter="enter('29076383544473850');" onmouseout="out('29076383544473850');" style=""> 365              List&lt;Sku&gt; skuList = adminInstance.getAllSkus();                                                       </span>
<span class="-2506961360510940575" onmouseenter="enter('-2506961360510940575');" onmouseout="out('-2506961360510940575');" style=""> 366              for (Sku sku : skuList) {                                                                             </span>
<span class="2039383434106799748" onmouseenter="enter('2039383434106799748');" onmouseout="out('2039383434106799748');" style=""> 367                  catalogService.removeSku(sku);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368              }                                                                                                     </span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 369          } catch (ClassNotFoundException e) {                                                                      </span>
<span class="8549847936080404575" onmouseenter="enter('8549847936080404575');" onmouseout="out('8549847936080404575');" style=""> 370              throw new ServiceException(&quot;Unable to remove entity for &quot; + entity.getType()[0], e);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372      }                                                                                                             </span>
<span  style=""> 373                                                                                                                    </span>
<span class="-8634314107060974128" onmouseenter="enter('-8634314107060974128');" onmouseout="out('-8634314107060974128');" style=""><abbr title=" 374      protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,"> 374      protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RðŸ”µ</abbr></span>
<span class="2232129114834499824" onmouseenter="enter('2232129114834499824');" onmouseout="out('2232129114834499824');" style=""> 375                                         Entity entity) throws ClassNotFoundException {                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 376          PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();           </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 377          Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 377          Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), perðŸ”µ</abbr></span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 378          Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                        </span>
<span class="3403576257396241131" onmouseenter="enter('3403576257396241131');" onmouseout="out('3403576257396241131');" style=""> 379          String type = entity.getType()[0];                                                                        </span>
<span class="791413654597460382" onmouseenter="enter('791413654597460382');" onmouseout="out('791413654597460382');" style=""> 380          Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);             </span>
<span  style=""> 381                                                                                                                    </span>
<span class="2848615422851099691" onmouseenter="enter('2848615422851099691');" onmouseout="out('2848615422851099691');" style=""> 382          return adminInstance;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383      }                                                                                                             </span>
<span  style=""> 384                                                                                                                    </span>
<span class="-7276315230897223897" onmouseenter="enter('-7276315230897223897');" onmouseout="out('-7276315230897223897');" style=""><abbr title=" 385      protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {"> 385      protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helperðŸ”µ</abbr></span>
<span class="8222559285797311452" onmouseenter="enter('8222559285797311452');" onmouseout="out('8222559285797311452');" style=""> 386          catalogService.removeProduct(adminInstance);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387      }                                                                                                             </span>
<span  style=""> 388                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 389      /**                                                                                                           </span>
<span class="-6565674410629622369" onmouseenter="enter('-6565674410629622369');" onmouseout="out('-6565674410629622369');" style=""> 390       * If the pricing model is of type item_sum, that property should not be required                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 391       *                                                                                                            </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 392       * @param adminInstance                                                                                       </span>
<span class="1188154204740832420" onmouseenter="enter('1188154204740832420');" onmouseout="out('1188154204740832420');" style=""> 393       * @param adminProperties                                                                                     </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 394       * @param entity                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 395       */                                                                                                           </span>
<span class="1796231511775682058" onmouseenter="enter('1796231511775682058');" onmouseout="out('1796231511775682058');" style=""><abbr title=" 396      protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminProperties, Entity entity) {"> 396      protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminPropðŸ”µ</abbr></span>
<span class="-7898829768536246574" onmouseenter="enter('-7898829768536246574');" onmouseout="out('-7898829768536246574');" style=""> 397          //no required validation for product bundles                                                              </span>
<span class="2028132163697204828" onmouseenter="enter('2028132163697204828');" onmouseout="out('2028132163697204828');" style=""> 398          ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(false);          </span>
<span class="-1136678238396033433" onmouseenter="enter('-1136678238396033433');" onmouseout="out('-1136678238396033433');" style=""> 399          if (entity.getPMap().get(&quot;pricingModel&quot;) != null) {                                                       </span>
<span class="-5810729812081766749" onmouseenter="enter('-5810729812081766749');" onmouseout="out('-5810729812081766749');" style=""><abbr title=" 400              if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValue())) {"> 400              if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValuðŸ”µ</abbr></span>
<span class="-8087214156619436047" onmouseenter="enter('-8087214156619436047');" onmouseout="out('-8087214156619436047');" style=""> 401                  ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(true);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404      }                                                                                                             </span>
<span  style=""> 405                                                                                                                    </span>
<span class="-6194621554657272575" onmouseenter="enter('-6194621554657272575');" onmouseout="out('-6194621554657272575');" style=""> 406      protected Boolean isDefaultCategoryLegacyMode() {                                                             </span>
<span class="-2222712760012631506" onmouseenter="enter('-2222712760012631506');" onmouseout="out('-2222712760012631506');" style=""><abbr title=" 407          ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeService();"> 407          ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeServiðŸ”µ</abbr></span>
<span class="-3125121052433413106" onmouseenter="enter('-3125121052433413106');" onmouseout="out('-3125121052433413106');" style=""> 408          if (legacyModeService != null) {                                                                          </span>
<span class="-7433711904609854570" onmouseenter="enter('-7433711904609854570');" onmouseout="out('-7433711904609854570');" style=""> 409              return legacyModeService.isLegacyMode();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 411          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412      }                                                                                                             </span>
<span  style=""> 413                                                                                                                    </span>
<span class="-182298883698048941" onmouseenter="enter('-182298883698048941');" onmouseout="out('-182298883698048941');" style=""> 414      protected void modifyParentCategoryMetadata(Map&lt;String, FieldMetadata&gt; md) {                                  </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 415          if (!isDefaultCategoryLegacyMode()) {                                                                     </span>
<span class="-3233029088333925194" onmouseenter="enter('-3233029088333925194');" onmouseout="out('-3233029088333925194');" style=""> 416              md.remove(&quot;allParentCategoryXrefs&quot;);                                                                  </span>
<span  style=""> 417                                                                                                                    </span>
<span class="-8850866426953517740" onmouseenter="enter('-8850866426953517740');" onmouseout="out('-8850866426953517740');" style=""> 418              BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) md.get(&quot;defaultCategory&quot;));                </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 419              defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421      }                                                                                                             </span>
<span  style=""> 422                                                                                                                    </span>
<span class="4323219351741765804" onmouseenter="enter('4323219351741765804');" onmouseout="out('4323219351741765804');" style=""> 423      protected Category getExistingDefaultCategory(Product product) {                                              </span>
<span class="4785057058955893593" onmouseenter="enter('4785057058955893593');" onmouseout="out('4785057058955893593');" style=""> 424          //Make sure we get the actual field value - not something manipulated in the getter                       </span>
<span class="-7097588232152162933" onmouseenter="enter('-7097588232152162933');" onmouseout="out('-7097588232152162933');" style=""> 425          Category parentCategory;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 426          try {                                                                                                     </span>
<span class="1642298731132209432" onmouseenter="enter('1642298731132209432');" onmouseout="out('1642298731132209432');" style=""> 427              Field defaultCategory = ProductImpl.class.getDeclaredField(&quot;defaultCategory&quot;);                        </span>
<span class="-5472088449890863756" onmouseenter="enter('-5472088449890863756');" onmouseout="out('-5472088449890863756');" style=""> 428              defaultCategory.setAccessible(true);                                                                  </span>
<span class="-5032854148355745900" onmouseenter="enter('-5032854148355745900');" onmouseout="out('-5032854148355745900');" style=""> 429              parentCategory = (Category) defaultCategory.get(product);                                             </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 430          } catch (NoSuchFieldException e) {                                                                        </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 431              throw ExceptionHelper.refineException(e);                                                             </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 432          } catch (IllegalAccessException e) {                                                                      </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 433              throw ExceptionHelper.refineException(e);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434          }                                                                                                         </span>
<span class="-4827692301542162901" onmouseenter="enter('-4827692301542162901');" onmouseout="out('-4827692301542162901');" style=""> 435          return parentCategory;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436      }                                                                                                             </span>
<span  style=""> 437                                                                                                                    </span>
<span class="2198792804957949705" onmouseenter="enter('2198792804957949705');" onmouseout="out('2198792804957949705');" style=""> 438      protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity) {       </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 439          if (!isDefaultCategoryLegacyMode()) {                                                                     </span>
<span class="-8408462162055715920" onmouseenter="enter('-8408462162055715920');" onmouseout="out('-8408462162055715920');" style=""><abbr title=" 440              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 440              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultðŸ”µ</abbr></span>
<span class="3184747591230429719" onmouseenter="enter('3184747591230429719');" onmouseout="out('3184747591230429719');" style=""> 441                  adminInstance.setCategory(null);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442              }                                                                                                     </span>
<span class="7434653101319155783" onmouseenter="enter('7434653101319155783');" onmouseout="out('7434653101319155783');" style=""> 443              CategoryProductXref newDefault = getCurrentDefaultXref(adminInstance);                                </span>
<span class="1862582476950403842" onmouseenter="enter('1862582476950403842');" onmouseout="out('1862582476950403842');" style=""> 444              if (oldDefault != null &amp;&amp; !oldDefault.equals(newDefault)) {                                           </span>
<span class="-2218242322092133143" onmouseenter="enter('-2218242322092133143');" onmouseout="out('-2218242322092133143');" style=""> 445                  adminInstance.getAllParentCategoryXrefs().remove(oldDefault);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448      }                                                                                                             </span>
<span  style=""> 449                                                                                                                    </span>
<span class="902349756604301531" onmouseenter="enter('902349756604301531');" onmouseout="out('902349756604301531');" style=""> 450      protected void setupXref(Product adminInstance) {                                                             </span>
<span class="1047341479251260893" onmouseenter="enter('1047341479251260893');" onmouseout="out('1047341479251260893');" style=""> 451          if (isDefaultCategoryLegacyMode()) {                                                                      </span>
<span class="4336193572473592352" onmouseenter="enter('4336193572473592352');" onmouseout="out('4336193572473592352');" style=""> 452              CategoryProductXref categoryXref = new CategoryProductXrefImpl();                                     </span>
<span class="3362376343183691887" onmouseenter="enter('3362376343183691887');" onmouseout="out('3362376343183691887');" style=""> 453              categoryXref.setCategory(getExistingDefaultCategory(adminInstance));                                  </span>
<span class="998500482226783196" onmouseenter="enter('998500482226783196');" onmouseout="out('998500482226783196');" style=""> 454              categoryXref.setProduct(adminInstance);                                                               </span>
<span class="-2133389353332895077" onmouseenter="enter('-2133389353332895077');" onmouseout="out('-2133389353332895077');" style=""><abbr title=" 455              if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() != null) {"> 455              if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() !=ðŸ”µ</abbr></span>
<span class="-7221514252473967991" onmouseenter="enter('-7221514252473967991');" onmouseout="out('-7221514252473967991');" style=""> 456                  adminInstance.getAllParentCategoryXrefs().add(categoryXref);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459      }                                                                                                             </span>
<span  style=""> 460                                                                                                                    </span>
<span class="-4866520984434663516" onmouseenter="enter('-4866520984434663516');" onmouseout="out('-4866520984434663516');" style=""> 461      protected CategoryProductXref getCurrentDefaultXref(Product product) {                                        </span>
<span class="5121334440715645479" onmouseenter="enter('5121334440715645479');" onmouseout="out('5121334440715645479');" style=""> 462          CategoryProductXref currentDefault = null;                                                                </span>
<span class="4669448491831723006" onmouseenter="enter('4669448491831723006');" onmouseout="out('4669448491831723006');" style=""> 463          List&lt;CategoryProductXref&gt; xrefs = product.getAllParentCategoryXrefs();                                    </span>
<span class="-1899512729290259350" onmouseenter="enter('-1899512729290259350');" onmouseout="out('-1899512729290259350');" style=""> 464          if (!CollectionUtils.isEmpty(xrefs)) {                                                                    </span>
<span class="-1984009506268747903" onmouseenter="enter('-1984009506268747903');" onmouseout="out('-1984009506268747903');" style=""> 465              for (CategoryProductXref xref : xrefs) {                                                              </span>
<span class="113451359587339395" onmouseenter="enter('113451359587339395');" onmouseout="out('113451359587339395');" style=""><abbr title=" 466                  if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReference()) {"> 466                  if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReferencðŸ”µ</abbr></span>
<span class="-4081682415228113248" onmouseenter="enter('-4081682415228113248');" onmouseout="out('-4081682415228113248');" style=""> 467                      currentDefault = xref;                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 468                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471          }                                                                                                         </span>
<span class="5312955631235184797" onmouseenter="enter('5312955631235184797');" onmouseout="out('5312955631235184797');" style=""> 472          return currentDefault;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473      }                                                                                                             </span>
<span  style=""> 474                                                                                                                    </span>
<span class="4094641218853198204" onmouseenter="enter('4094641218853198204');" onmouseout="out('4094641218853198204');" style=""> 475      protected boolean isRecursiveProductSelection(PersistencePackage persistencePackage) {                        </span>
<span class="-2408999831407736607" onmouseenter="enter('-2408999831407736607');" onmouseout="out('-2408999831407736607');" style=""> 476          List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());                      </span>
<span class="6739384969443933808" onmouseenter="enter('6739384969443933808');" onmouseout="out('6739384969443933808');" style=""><abbr title=" 477          return customCriteria.contains(&quot;upsaleProduct&quot;) || customCriteria.contains(&quot;crossSaleProduct&quot;) || customCriteria.contains(&quot;requestingField=addOnProduct&quot;);"> 477          return customCriteria.contains(&quot;upsaleProduct&quot;) || customCriteria.contains(&quot;crossSaleProduct&quot;) || customCrðŸ”µ</abbr></span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478      }                                                                                                             </span>
<span  style=""> 479                                                                                                                    </span>
<span class="-3368052144456426396" onmouseenter="enter('-3368052144456426396');" onmouseout="out('-3368052144456426396');" style=""><abbr title=" 480      protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicateProvider) {"> 480      protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicatePðŸ”µ</abbr></span>
<span  style=""> 481                                                                                                                    </span>
<span class="8057622255252958217" onmouseenter="enter('8057622255252958217');" onmouseout="out('8057622255252958217');" style=""> 482          FieldPath fieldPath = new FieldPath().withTargetProperty(targetPropertyName);                             </span>
<span class="-6596211108915962883" onmouseenter="enter('-6596211108915962883');" onmouseout="out('-6596211108915962883');" style=""> 483          EmptyFilterValues directFilterValues = new EmptyFilterValues();                                           </span>
<span class="4277357472881062872" onmouseenter="enter('4277357472881062872');" onmouseout="out('4277357472881062872');" style=""> 484          Restriction newRestriction = new Restriction().withPredicateProvider(predicateProvider);                  </span>
<span  style=""> 485                                                                                                                    </span>
<span class="3608289770015613450" onmouseenter="enter('3608289770015613450');" onmouseout="out('3608289770015613450');" style=""> 486          return new FilterMapping()                                                                                </span>
<span class="-6035283433958931422" onmouseenter="enter('-6035283433958931422');" onmouseout="out('-6035283433958931422');" style=""> 487              .withFieldPath(fieldPath)                                                                             </span>
<span class="1581873956966044880" onmouseenter="enter('1581873956966044880');" onmouseout="out('1581873956966044880');" style=""> 488              .withDirectFilterValues(directFilterValues)                                                           </span>
<span class="27993374560272883" onmouseenter="enter('27993374560272883');" onmouseout="out('27993374560272883');" style=""> 489              .withRestriction(newRestriction);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490      }                                                                                                             </span>
<span  style=""> 491                                                                                                                    </span>
<span class="1303149189704190318" onmouseenter="enter('1303149189704190318');" onmouseout="out('1303149189704190318');" style=""><abbr title=" 492      protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferObject cto, RecordHelper helper) throws ServiceException {"> 492      protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferðŸ”µ</abbr></span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 493 -        FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 493 -        FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider()ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -            @Override                                                                                             </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -            public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,</span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -                                            String ceilingEntity, String fullPropertyName, Path explicitPath,     </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -                                            List directValues) {                                                  </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 498 -                return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 498 -                return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 499 -            }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -        });                                                                                                       </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -        cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                            </span>
<span class="-3386273820962459143" onmouseenter="enter('-3386273820962459143');" onmouseout="out('-3386273820962459143');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +        if(persistencePackage.getSectionCrumbs()!=null &amp;&amp; persistencePackage.getSectionCrumbs().length&gt;0) {       </span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 503 +            FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 503 +            FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvidðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +                @Override                                                                                         </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 505 +                public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,"> 505 +                public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From rðŸ”µ</abbr></span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +                                                String ceilingEntity, String fullPropertyName, Path explicitPath, </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 507 +                                                List directValues) {                                              </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 508 +                    return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 508 +                    return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +                }                                                                                                 </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 510 +            });                                                                                                   </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 511 +            cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 512 +        }                                                                                                         </span>
<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 513          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 513          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType(ðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style=""> 514          PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                              </span>
<span class="6289449121708775001" onmouseenter="enter('6289449121708775001');" onmouseout="out('6289449121708775001');" style=""> 515          return persistenceModule.fetch(persistencePackage, cto);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 516      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="607567072764399459" onmouseenter="enter('607567072764399459');" onmouseout="out('607567072764399459');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 +/*-                                                                                                               </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   3   * #%L                                                                                                            </span>
<span class="-1249558187989023334" onmouseenter="enter('-1249558187989023334');" onmouseout="out('-1249558187989023334');" style="">   4   * BroadleafCommerce Admin Module                                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   5   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="2735768235135741819" onmouseenter="enter('2735768235135741819');" onmouseout="out('2735768235135741819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   7 + * Copyright (C) 2009 - 2022 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   8   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   9   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">  10   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">  11   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  12   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  13   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  14   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  15   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  16   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  16   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  17   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  18   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  19   */                                                                                                               </span>
<span class="3565305863144860564" onmouseenter="enter('3565305863144860564');" onmouseout="out('3565305863144860564');" style="">  20  package org.broadleafcommerce.admin.server.service.handler;                                                       </span>
<span  style="">  21                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  22  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  23  import org.apache.commons.lang.ArrayUtils;                                                                        </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  24  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  25  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  26  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="5003207573385979332" onmouseenter="enter('5003207573385979332');" onmouseout="out('5003207573385979332');" style="">  27  import org.broadleafcommerce.admin.server.service.extension.ProductCustomPersistenceHandlerExtensionManager;      </span>
<span class="-9066890226896155571" onmouseenter="enter('-9066890226896155571');" onmouseout="out('-9066890226896155571');" style="">  28  import org.broadleafcommerce.common.exception.ExceptionHelper;                                                    </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  29  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  30  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="-212317658512913375" onmouseenter="enter('-212317658512913375');" onmouseout="out('-212317658512913375');" style="">  31  import org.broadleafcommerce.common.presentation.client.OperationType;                                            </span>
<span class="-2818686525334833130" onmouseenter="enter('-2818686525334833130');" onmouseout="out('-2818686525334833130');" style="">  32  import org.broadleafcommerce.common.sandbox.SandBoxHelper;                                                        </span>
<span class="-2618521349256495257" onmouseenter="enter('-2618521349256495257');" onmouseout="out('-2618521349256495257');" style="">  33  import org.broadleafcommerce.common.service.ParentCategoryLegacyModeService;                                      </span>
<span class="-3988587350630126043" onmouseenter="enter('-3988587350630126043');" onmouseout="out('-3988587350630126043');" style="">  34  import org.broadleafcommerce.common.service.ParentCategoryLegacyModeServiceImpl;                                  </span>
<span class="-3909806959928975034" onmouseenter="enter('-3909806959928975034');" onmouseout="out('-3909806959928975034');" style="">  35  import org.broadleafcommerce.common.util.BLCCollectionUtils;                                                      </span>
<span class="-8028747938757529269" onmouseenter="enter('-8028747938757529269');" onmouseout="out('-8028747938757529269');" style="">  36  import org.broadleafcommerce.common.util.TypedTransformer;                                                        </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  37  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  38  import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  39  import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                             </span>
<span class="5877661970606637396" onmouseenter="enter('5877661970606637396');" onmouseout="out('5877661970606637396');" style="">  40  import org.broadleafcommerce.core.catalog.domain.CategoryProductXrefImpl;                                         </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  41  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="8587718080948629089" onmouseenter="enter('8587718080948629089');" onmouseout="out('8587718080948629089');" style="">  42  import org.broadleafcommerce.core.catalog.domain.ProductBundle;                                                   </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  43  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  44  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="7449534617313289359" onmouseenter="enter('7449534617313289359');" onmouseout="out('7449534617313289359');" style="">  45  import org.broadleafcommerce.core.catalog.service.CatalogService;                                                 </span>
<span class="-428848345283345816" onmouseenter="enter('-428848345283345816');" onmouseout="out('-428848345283345816');" style="">  46  import org.broadleafcommerce.core.catalog.service.type.ProductBundlePricingModelType;                             </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  47  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  48  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  49  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  50  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  51  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  52  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  53  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="8079401142601162613" onmouseenter="enter('8079401142601162613');" onmouseout="out('8079401142601162613');" style="">  54  import org.broadleafcommerce.openadmin.dto.PersistencePerspective;                                                </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                          </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  56  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-9217168395336380631" onmouseenter="enter('-9217168395336380631');" onmouseout="out('-9217168395336380631');" style="">  57  import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;                    </span>
<span class="-4913438826169444493" onmouseenter="enter('-4913438826169444493');" onmouseout="out('-4913438826169444493');" style="">  58  import org.broadleafcommerce.openadmin.server.service.persistence.module.EmptyFilterValues;                       </span>
<span class="-9205099315907051841" onmouseenter="enter('-9205099315907051841');" onmouseout="out('-9205099315907051841');" style="">  59  import org.broadleafcommerce.openadmin.server.service.persistence.module.InspectHelper;                           </span>
<span class="8253709771214222101" onmouseenter="enter('8253709771214222101');" onmouseout="out('8253709771214222101');" style="">  60  import org.broadleafcommerce.openadmin.server.service.persistence.module.PersistenceModule;                       </span>
<span class="5407139061354632707" onmouseenter="enter('5407139061354632707');" onmouseout="out('5407139061354632707');" style="">  61  import org.broadleafcommerce.openadmin.server.service.persistence.module.RecordHelper;                            </span>
<span class="7637154476457570035" onmouseenter="enter('7637154476457570035');" onmouseout="out('7637154476457570035');" style="">  62  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPath;                      </span>
<span class="1663650800150084878" onmouseenter="enter('1663650800150084878');" onmouseout="out('1663650800150084878');" style="">  63  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FieldPathBuilder;               </span>
<span class="7520439988643323618" onmouseenter="enter('7520439988643323618');" onmouseout="out('7520439988643323618');" style="">  64  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.FilterMapping;                  </span>
<span class="-8754722050104399052" onmouseenter="enter('-8754722050104399052');" onmouseout="out('-8754722050104399052');" style="">  65  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.Restriction;                    </span>
<span class="2225343043491731861" onmouseenter="enter('2225343043491731861');" onmouseout="out('2225343043491731861');" style="">  66  import org.broadleafcommerce.openadmin.server.service.persistence.module.criteria.predicate.PredicateProvider;    </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  67  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  68  import org.springframework.stereotype.Component;                                                                  </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  69  import java.lang.reflect.Field;                                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  70  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  71  import java.util.Arrays;                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  72  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  73  import java.util.Map;                                                                                             </span>
<span class="5924803009700709999" onmouseenter="enter('5924803009700709999');" onmouseout="out('5924803009700709999');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +import java.util.stream.Stream;                                                                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +                                                                                                                  </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  76  import javax.annotation.Resource;                                                                                 </span>
<span class="6539032290250175619" onmouseenter="enter('6539032290250175619');" onmouseout="out('6539032290250175619');" style="">  77  import javax.persistence.TypedQuery;                                                                              </span>
<span class="8485852916582699615" onmouseenter="enter('8485852916582699615');" onmouseout="out('8485852916582699615');" style="">  78  import javax.persistence.criteria.CriteriaBuilder;                                                                </span>
<span class="9191540725958216337" onmouseenter="enter('9191540725958216337');" onmouseout="out('9191540725958216337');" style="">  79  import javax.persistence.criteria.CriteriaQuery;                                                                  </span>
<span class="2535099540501772744" onmouseenter="enter('2535099540501772744');" onmouseout="out('2535099540501772744');" style="">  80  import javax.persistence.criteria.From;                                                                           </span>
<span class="4189756756281347615" onmouseenter="enter('4189756756281347615');" onmouseout="out('4189756756281347615');" style="">  81  import javax.persistence.criteria.JoinType;                                                                       </span>
<span class="5773424155764142692" onmouseenter="enter('5773424155764142692');" onmouseout="out('5773424155764142692');" style="">  82  import javax.persistence.criteria.Path;                                                                           </span>
<span class="7244103982108254428" onmouseenter="enter('7244103982108254428');" onmouseout="out('7244103982108254428');" style="">  83  import javax.persistence.criteria.Predicate;                                                                      </span>
<span class="5782830673162504954" onmouseenter="enter('5782830673162504954');" onmouseout="out('5782830673162504954');" style="">  84  import javax.persistence.criteria.Root;                                                                           </span>
<span  style="">  85                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86  /**                                                                                                               </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  87   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88   */                                                                                                               </span>
<span class="660262005045399639" onmouseenter="enter('660262005045399639');" onmouseout="out('660262005045399639');" style="">  89  @Component(&quot;blProductCustomPersistenceHandler&quot;)                                                                   </span>
<span class="-5558200371078111093" onmouseenter="enter('-5558200371078111093');" onmouseout="out('-5558200371078111093');" style="">  90  public class ProductCustomPersistenceHandler extends CustomPersistenceHandlerAdapter {                            </span>
<span  style="">  91                                                                                                                    </span>
<span class="6601773269924456427" onmouseenter="enter('6601773269924456427');" onmouseout="out('6601773269924456427');" style="">  92      protected static final String ID_PROPERTY = &quot;id&quot;;                                                             </span>
<span  style="">  93                                                                                                                    </span>
<span class="-9027538666103138416" onmouseenter="enter('-9027538666103138416');" onmouseout="out('-9027538666103138416');" style="">  94      @Resource(name = &quot;blCatalogService&quot;)                                                                          </span>
<span class="-4113751917539394305" onmouseenter="enter('-4113751917539394305');" onmouseout="out('-4113751917539394305');" style="">  95      protected CatalogService catalogService;                                                                      </span>
<span  style="">  96                                                                                                                    </span>
<span class="8724020527834493732" onmouseenter="enter('8724020527834493732');" onmouseout="out('8724020527834493732');" style="">  97      @Resource(name = &quot;blProductCustomPersistenceHandlerExtensionManager&quot;)                                         </span>
<span class="5198675979006161834" onmouseenter="enter('5198675979006161834');" onmouseout="out('5198675979006161834');" style="">  98      protected ProductCustomPersistenceHandlerExtensionManager extensionManager;                                   </span>
<span  style="">  99                                                                                                                    </span>
<span class="-7078262064240547152" onmouseenter="enter('-7078262064240547152');" onmouseout="out('-7078262064240547152');" style=""> 100      @Resource(name = &quot;blParentCategoryLegacyModeService&quot;)                                                         </span>
<span class="7833791338969174941" onmouseenter="enter('7833791338969174941');" onmouseout="out('7833791338969174941');" style=""> 101      protected ParentCategoryLegacyModeService parentCategoryLegacyModeService;                                    </span>
<span  style=""> 102                                                                                                                    </span>
<span class="-3946461589801993391" onmouseenter="enter('-3946461589801993391');" onmouseout="out('-3946461589801993391');" style=""> 103      @Resource(name = &quot;blSandBoxHelper&quot;)                                                                           </span>
<span class="-7799183597372200632" onmouseenter="enter('-7799183597372200632');" onmouseout="out('-7799183597372200632');" style=""> 104      protected SandBoxHelper sandBoxHelper;                                                                        </span>
<span  style=""> 105                                                                                                                    </span>
<span class="4171055983434128927" onmouseenter="enter('4171055983434128927');" onmouseout="out('4171055983434128927');" style=""> 106      @Value(&quot;${product.query.limit:500}&quot;)                                                                          </span>
<span class="395756119071585853" onmouseenter="enter('395756119071585853');" onmouseout="out('395756119071585853');" style=""> 107      protected long queryLimit;                                                                                    </span>
<span  style=""> 108                                                                                                                    </span>
<span class="1763955632160691042" onmouseenter="enter('1763955632160691042');" onmouseout="out('1763955632160691042');" style=""> 109      @Value(&quot;${product.eager.fetch.associations.admin:true}&quot;)                                                      </span>
<span class="-5859298812289369627" onmouseenter="enter('-5859298812289369627');" onmouseout="out('-5859298812289369627');" style=""> 110      protected boolean eagerFetchAssociations = true;                                                              </span>
<span  style=""> 111                                                                                                                    </span>
<span class="7059678051681133033" onmouseenter="enter('7059678051681133033');" onmouseout="out('7059678051681133033');" style=""> 112      private static final Log LOG = LogFactory.getLog(ProductCustomPersistenceHandler.class);                      </span>
<span  style=""> 113                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114      @Override                                                                                                     </span>
<span class="1712661648493993457" onmouseenter="enter('1712661648493993457');" onmouseout="out('1712661648493993457');" style=""> 115      public Boolean canHandleAdd(PersistencePackage persistencePackage) {                                          </span>
<span class="2519389108374285224" onmouseenter="enter('2519389108374285224');" onmouseout="out('2519389108374285224');" style=""><abbr title=" 116          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();"> 116          String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname()ðŸ”µ</abbr></span>
<span class="-1941058799374650916" onmouseenter="enter('-1941058799374650916');" onmouseout="out('-1941058799374650916');" style=""> 117          String[] customCriteria = persistencePackage.getCustomCriteria();                                         </span>
<span class="-6187520531612273029" onmouseenter="enter('-6187520531612273029');" onmouseout="out('-6187520531612273029');" style=""><abbr title=" 118          return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.class.getName().equals(ceilingEntityFullyQualifiedClassname);"> 118          return !ArrayUtils.isEmpty(customCriteria) &amp;&amp; &quot;productDirectEdit&quot;.equals(customCriteria[0]) &amp;&amp; Product.claðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119      }                                                                                                             </span>
<span  style=""> 120                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 121      @Override                                                                                                     </span>
<span class="5315207923223107799" onmouseenter="enter('5315207923223107799');" onmouseout="out('5315207923223107799');" style=""> 122      public Boolean canHandleUpdate(PersistencePackage persistencePackage) {                                       </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 123          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124      }                                                                                                             </span>
<span  style=""> 125                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 126      @Override                                                                                                     </span>
<span class="-3598578007792382897" onmouseenter="enter('-3598578007792382897');" onmouseout="out('-3598578007792382897');" style=""> 127      public Boolean canHandleRemove(PersistencePackage persistencePackage) {                                       </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 128          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129      }                                                                                                             </span>
<span  style=""> 130                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 131      @Override                                                                                                     </span>
<span class="-8556163469002491307" onmouseenter="enter('-8556163469002491307');" onmouseout="out('-8556163469002491307');" style=""> 132      public Boolean canHandleFetch(PersistencePackage persistencePackage) {                                        </span>
<span class="-4855907251399383811" onmouseenter="enter('-4855907251399383811');" onmouseout="out('-4855907251399383811');" style=""> 133          return isRecursiveProductSelection(persistencePackage) || canHandleAdd(persistencePackage);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134      }                                                                                                             </span>
<span  style=""> 135                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 136      @Override                                                                                                     </span>
<span class="998850855763553690" onmouseenter="enter('998850855763553690');" onmouseout="out('998850855763553690');" style=""> 137      public Boolean canHandleInspect(PersistencePackage persistencePackage) {                                      </span>
<span class="219204931672538013" onmouseenter="enter('219204931672538013');" onmouseout="out('219204931672538013');" style=""> 138          return canHandleAdd(persistencePackage);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139      }                                                                                                             </span>
<span  style=""> 140                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 141      @Override                                                                                                     </span>
<span class="4696212939538128393" onmouseenter="enter('4696212939538128393');" onmouseout="out('4696212939538128393');" style=""><abbr title=" 142      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspectHelper helper) throws ServiceException {"> 142      public DynamicResultSet inspect(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, InspðŸ”µ</abbr></span>
<span class="-3269781843971996957" onmouseenter="enter('-3269781843971996957');" onmouseout="out('-3269781843971996957');" style=""> 143          Map&lt;String, FieldMetadata&gt; md = getMetadata(persistencePackage, helper);                                  </span>
<span  style=""> 144                                                                                                                    </span>
<span class="4046647143093628321" onmouseenter="enter('4046647143093628321');" onmouseout="out('4046647143093628321');" style=""> 145          modifyParentCategoryMetadata(md);                                                                         </span>
<span  style=""> 146                                                                                                                    </span>
<span class="-3976181121340681385" onmouseenter="enter('-3976181121340681385');" onmouseout="out('-3976181121340681385');" style=""> 147          extensionManager.getProxy().manageInspect(md);                                                            </span>
<span  style=""> 148                                                                                                                    </span>
<span class="3104749978175677264" onmouseenter="enter('3104749978175677264');" onmouseout="out('3104749978175677264');" style=""> 149          return getResultSet(persistencePackage, helper, md);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150      }                                                                                                             </span>
<span  style=""> 151                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 152      @Override                                                                                                     </span>
<span class="1439455151726717615" onmouseenter="enter('1439455151726717615');" onmouseout="out('1439455151726717615');" style=""><abbr title=" 153      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityDao"> 153      public DynamicResultSet fetch(PersistencePackage persistencePackage, CriteriaTransferObject cto, DynamicEntityðŸ”µ</abbr></span>
<span class="7090980851977161261" onmouseenter="enter('7090980851977161261');" onmouseout="out('7090980851977161261');" style=""> 154              dynamicEntityDao, RecordHelper helper) throws ServiceException {                                      </span>
<span  style=""> 155                                                                                                                    </span>
<span class="7569586386580693394" onmouseenter="enter('7569586386580693394');" onmouseout="out('7569586386580693394');" style=""> 156          if (isRecursiveProductSelection(persistencePackage)) {                                                    </span>
<span class="-8647006973930156734" onmouseenter="enter('-8647006973930156734');" onmouseout="out('-8647006973930156734');" style=""> 157              return getFilteredDynamicResultSet(persistencePackage, cto, helper);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158          }                                                                                                         </span>
<span  style=""> 159                                                                                                                    </span>
<span class="6757106929036196196" onmouseenter="enter('6757106929036196196');" onmouseout="out('6757106929036196196');" style=""> 160          boolean legacy = parentCategoryLegacyModeService.isLegacyMode();                                          </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-6242900732247061705" onmouseenter="enter('-6242900732247061705');" onmouseout="out('-6242900732247061705');" style=""> 162          //the following code applies when filters are present only:                                               </span>
<span class="7713333205546637982" onmouseenter="enter('7713333205546637982');" onmouseout="out('7713333205546637982');" style=""><abbr title=" 163          //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to be matched"> 163          //&quot;legacy&quot; means that the parent category filter still utilizes Product.defaultCategory as the field to beðŸ”µ</abbr></span>
<span class="-4534809142114175803" onmouseenter="enter('-4534809142114175803');" onmouseout="out('-4534809142114175803');" style=""><abbr title=" 164          //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes the &quot;legacy&quot; mode."> 164          //against the categories chosen in the listGrid filter. The default behavior up to this point, assumes theðŸ”µ</abbr></span>
<span class="4043022036079520545" onmouseenter="enter('4043022036079520545');" onmouseout="out('4043022036079520545');" style=""><abbr title=" 165          //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCategory&quot;."> 165          //This means that one of the FilterAndSortCriterias will try to match the chosen values against &quot;defaultCaðŸ”µ</abbr></span>
<span class="-7849952188616772175" onmouseenter="enter('-7849952188616772175');" onmouseout="out('-7849952188616772175');" style=""><abbr title=" 166          //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping in cto.additionalFilterMappings,"> 166          //If &quot;legacy&quot; is false, we remove that FilterAndSortCriteria from the CTO, and inject a new FilterMapping ðŸ”µ</abbr></span>
<span class="-1781087399901648456" onmouseenter="enter('-1781087399901648456');" onmouseout="out('-1781087399901648456');" style=""> 167          //which seeks matching values in  allParentCategoryXRefs instead                                          </span>
<span class="-5527176171961818632" onmouseenter="enter('-5527176171961818632');" onmouseout="out('-5527176171961818632');" style=""> 168          if (!legacy) {                                                                                            </span>
<span class="-4942654953935107368" onmouseenter="enter('-4942654953935107368');" onmouseout="out('-4942654953935107368');" style=""> 169              FilterAndSortCriteria fsc = cto.getCriteriaMap().get(&quot;defaultCategory&quot;);                              </span>
<span class="7732194668261263043" onmouseenter="enter('7732194668261263043');" onmouseout="out('7732194668261263043');" style=""> 170              if (fsc != null) {                                                                                    </span>
<span class="5140613669097034739" onmouseenter="enter('5140613669097034739');" onmouseout="out('5140613669097034739');" style=""> 171                  List&lt;String&gt; filterValues = fsc.getFilterValues();                                                </span>
<span class="3991008560349807179" onmouseenter="enter('3991008560349807179');" onmouseout="out('3991008560349807179');" style=""> 172                  cto.getCriteriaMap().remove(&quot;defaultCategory&quot;);                                                   </span>
<span  style=""> 173                                                                                                                    </span>
<span class="5187909757738614354" onmouseenter="enter('5187909757738614354');" onmouseout="out('5187909757738614354');" style=""><abbr title=" 174                  List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;Long&gt;() {"> 174                  List&lt;Long&gt; transformedValues = BLCCollectionUtils.collectList(filterValues, new TypedTransformer&lt;LðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175                      @Override                                                                                     </span>
<span class="1211663884639874343" onmouseenter="enter('1211663884639874343');" onmouseout="out('1211663884639874343');" style=""> 176                      public Long transform(Object input) {                                                         </span>
<span class="7261043087809466345" onmouseenter="enter('7261043087809466345');" onmouseout="out('7261043087809466345');" style=""> 177                          return Long.parseLong(((String) input));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 179                  });                                                                                               </span>
<span class="-3339810432835967648" onmouseenter="enter('-3339810432835967648');" onmouseout="out('-3339810432835967648');" style=""> 180                  CriteriaBuilder builder = dynamicEntityDao.getStandardEntityManager().getCriteriaBuilder();       </span>
<span class="1553585152448885012" onmouseenter="enter('1553585152448885012');" onmouseout="out('1553585152448885012');" style=""> 181                  CriteriaQuery&lt;Long&gt; criteria = builder.createQuery(Long.class);                                   </span>
<span class="1136355655038715928" onmouseenter="enter('1136355655038715928');" onmouseout="out('1136355655038715928');" style=""> 182                  Root&lt;CategoryProductXrefImpl&gt; root = criteria.from(CategoryProductXrefImpl.class);                </span>
<span class="-192292848609070031" onmouseenter="enter('-192292848609070031');" onmouseout="out('-192292848609070031');" style=""> 183                  criteria.select(root.get(&quot;product&quot;).get(&quot;id&quot;).as(Long.class));                                    </span>
<span class="4051795261411779358" onmouseenter="enter('4051795261411779358');" onmouseout="out('4051795261411779358');" style=""> 184                  List&lt;Predicate&gt; restrictions = new ArrayList&lt;Predicate&gt;();                                        </span>
<span class="7079639045649129257" onmouseenter="enter('7079639045649129257');" onmouseout="out('7079639045649129257');" style=""> 185                  restrictions.add(builder.equal(root.get(&quot;defaultReference&quot;), Boolean.TRUE));                      </span>
<span class="5207279827061650716" onmouseenter="enter('5207279827061650716');" onmouseout="out('5207279827061650716');" style=""> 186                  if (CollectionUtils.isNotEmpty(transformedValues)) {                                              </span>
<span class="146441315649268392" onmouseenter="enter('146441315649268392');" onmouseout="out('146441315649268392');" style=""> 187                      restrictions.add(root.get(&quot;category&quot;).get(&quot;id&quot;).in(transformedValues));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188                  }                                                                                                 </span>
<span  style=""> 189                                                                                                                    </span>
<span class="-7694216774508171321" onmouseenter="enter('-7694216774508171321');" onmouseout="out('-7694216774508171321');" style=""> 190                  criteria.where(restrictions.toArray(new Predicate[restrictions.size()]));                         </span>
<span class="7055825944566640974" onmouseenter="enter('7055825944566640974');" onmouseout="out('7055825944566640974');" style=""> 191                  TypedQuery&lt;Long&gt; query = dynamicEntityDao.getStandardEntityManager().createQuery(criteria);       </span>
<span class="8509583784823066198" onmouseenter="enter('8509583784823066198');" onmouseout="out('8509583784823066198');" style=""> 192                  List&lt;Long&gt; productIds = query.getResultList();                                                    </span>
<span class="-1516584047908894525" onmouseenter="enter('-1516584047908894525');" onmouseout="out('-1516584047908894525');" style=""><abbr title=" 193                  productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIds.size()]));"> 193                  productIds = sandBoxHelper.mergeCloneIds(ProductImpl.class, productIds.toArray(new Long[productIdsðŸ”µ</abbr></span>
<span  style=""> 194                                                                                                                    </span>
<span class="5110006719648509717" onmouseenter="enter('5110006719648509717');" onmouseout="out('5110006719648509717');" style=""> 195                  if (productIds.size() == 0) {                                                                     </span>
<span class="-8650761106430502088" onmouseenter="enter('-8650761106430502088');" onmouseout="out('-8650761106430502088');" style=""> 196                      return new DynamicResultSet(null, new Entity[0], 0);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                  }                                                                                                 </span>
<span class="-924931052995986786" onmouseenter="enter('-924931052995986786');" onmouseout="out('-924931052995986786');" style=""> 198                  if (productIds.size() &lt;= queryLimit) {                                                            </span>
<span class="-3028331070500986006" onmouseenter="enter('-3028331070500986006');" onmouseout="out('-3028331070500986006');" style=""> 199                      FilterMapping filterMapping = new FilterMapping()                                             </span>
<span class="-3543945038191067122" onmouseenter="enter('-3543945038191067122');" onmouseout="out('-3543945038191067122');" style=""> 200                              .withFieldPath(new FieldPath().withTargetProperty(&quot;id&quot;))                              </span>
<span class="2232883807641366792" onmouseenter="enter('2232883807641366792');" onmouseout="out('2232883807641366792');" style=""> 201                              .withDirectFilterValues(productIds)                                                   </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 202                              .withRestriction(new Restriction()                                                    </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 203                                                       .withPredicateProvider(new PredicateProvider() {             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 204                                                                                  @Override                         </span>
<span class="-33431144742852463" onmouseenter="enter('-33431144742852463');" onmouseout="out('-33431144742852463');" style=""><abbr title=" 205                                                                                  public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder,"> 205                                                                                  public Predicate buildPredicate(CrðŸ”µ</abbr></span>
<span class="-5114847374786337606" onmouseenter="enter('-5114847374786337606');" onmouseout="out('-5114847374786337606');" style=""><abbr title=" 206                                                                                                                  From root, String ceilingEntity, String fullPropertyName,"> 206                                                                                                                  FrðŸ”µ</abbr></span>
<span class="8513618248320586908" onmouseenter="enter('8513618248320586908');" onmouseout="out('8513618248320586908');" style=""><abbr title=" 207                                                                                                                  Path explicitPath, List directValues) {"> 207                                                                                                                  PaðŸ”µ</abbr></span>
<span class="-7844596111771279367" onmouseenter="enter('-7844596111771279367');" onmouseout="out('-7844596111771279367');" style=""><abbr title=" 208                                                                                      return explicitPath.in(directValues);"> 208                                                                                      return explicitPath.in(directVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209                                                                                  }                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                                                                              }                                     </span>
<span class="-2015476096144723150" onmouseenter="enter('-2015476096144723150');" onmouseout="out('-2015476096144723150');" style=""> 211                                                       )                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 212                              );                                                                                    </span>
<span class="8464857299985770317" onmouseenter="enter('8464857299985770317');" onmouseout="out('8464857299985770317');" style=""> 213                      cto.getAdditionalFilterMappings().add(filterMapping);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 214                  } else {                                                                                          </span>
<span class="-5679004918959824296" onmouseenter="enter('-5679004918959824296');" onmouseout="out('-5679004918959824296');" style=""> 215                      String joined = StringUtils.join(transformedValues, &#x27;,&#x27;);                                     </span>
<span class="-7138538771694428625" onmouseenter="enter('-7138538771694428625');" onmouseout="out('-7138538771694428625');" style=""><abbr title=" 216                      LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since there are &quot; +"> 216                      LOG.warn(String.format(&quot;Skipping default category filtering for product fetch query since therðŸ”µ</abbr></span>
<span class="-3268164569215202291" onmouseenter="enter('-3268164569215202291');" onmouseout="out('-3268164569215202291');" style=""><abbr title=" 217                                             &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected default categories(%s). This is a &quot; +"> 217                                             &quot;more than &quot; + queryLimit + &quot; products found to belong to the selected ðŸ”µ</abbr></span>
<span class="6513435278584853007" onmouseenter="enter('6513435278584853007');" onmouseout="out('6513435278584853007');" style=""> 218                                             &quot;filter query limitation.&quot;, joined));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                  }                                                                                                 </span>
<span class="-6371393405809532308" onmouseenter="enter('-6371393405809532308');" onmouseout="out('-6371393405809532308');" style=""> 220                  cto.getNonCountAdditionalFilterMappings().add(                                                    </span>
<span class="861084839636182372" onmouseenter="enter('861084839636182372');" onmouseout="out('861084839636182372');" style=""> 221                          new FilterMapping().withFieldPath(new FieldPath().                                        </span>
<span class="-2774318940771911356" onmouseenter="enter('-2774318940771911356');" onmouseout="out('-2774318940771911356');" style=""> 222                                  withAssociationPath(Arrays.asList(&quot;allParentCategoryXrefs&quot;,&quot;category&quot;)).          </span>
<span class="821868564123592571" onmouseenter="enter('821868564123592571');" onmouseout="out('821868564123592571');" style=""> 223                                  withTargetPropertyPieces(Arrays.asList(&quot;name&quot;)))                                  </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 224                                  .withDirectFilterValues(new EmptyFilterValues())                                  </span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 225                                  .withRestriction(new Restriction()                                                </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""> 226                                          .withPredicateProvider(new PredicateProvider() {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 227                                              @Override                                                             </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""> 228                                              public Predicate buildPredicate(CriteriaBuilder builder,              </span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 229                                                                              FieldPathBuilder fieldPathBuilder, From root,"> 229                                                                              FieldPathBuilder fieldPathBuilder, FroðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""> 230                                                                              String ceilingEntity,                 </span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 231                                                                              String fullPropertyName, Path explicitPath,"> 231                                                                              String fullPropertyName, Path explicitðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""> 232                                                                              List directValues) {                  </span>
<span class="-8553876951484288081" onmouseenter="enter('-8553876951484288081');" onmouseout="out('-8553876951484288081');" style=""><abbr title=" 233                                                  //expect it to be allParentCategoryXrefs.category.name, so we need to restrict on allParentCategoryXrefs - 2 levels up"> 233                                                  //expect it to be allParentCategoryXrefs.category.name, so we needðŸ”µ</abbr></span>
<span class="8037864455504608737" onmouseenter="enter('8037864455504608737');" onmouseout="out('8037864455504608737');" style=""><abbr title=" 234                                                  Predicate equal = builder.equal(explicitPath.getParentPath().getParentPath().get(&quot;defaultReference&quot;), Boolean.TRUE);"> 234                                                  Predicate equal = builder.equal(explicitPath.getParentPath().getPaðŸ”µ</abbr></span>
<span class="1665766703297118664" onmouseenter="enter('1665766703297118664');" onmouseout="out('1665766703297118664');" style=""> 235                                                  return equal;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236                                              }                                                                     </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 237                                          })                                                                        </span>
<span class="-3422099077497392780" onmouseenter="enter('-3422099077497392780');" onmouseout="out('-3422099077497392780');" style=""> 238                                  ).withSortDirection(fsc.getSortDirection()));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240          }                                                                                                         </span>
<span  style=""> 241                                                                                                                    </span>
<span class="2582332595020198633" onmouseenter="enter('2582332595020198633');" onmouseout="out('2582332595020198633');" style=""> 242          if (eagerFetchAssociations) {                                                                             </span>
<span class="6234898006418452293" onmouseenter="enter('6234898006418452293');" onmouseout="out('6234898006418452293');" style=""> 243              cto.getNonCountAdditionalFilterMappings().add(new FilterMapping()                                     </span>
<span class="2888003341970826788" onmouseenter="enter('2888003341970826788');" onmouseout="out('2888003341970826788');" style=""> 244                                                                    .withDirectFilterValues(new EmptyFilterValues())</span>
<span class="-336067390801829771" onmouseenter="enter('-336067390801829771');" onmouseout="out('-336067390801829771');" style=""> 245                                                                    .withRestriction(new Restriction()              </span>
<span class="-6215109126792992245" onmouseenter="enter('-6215109126792992245');" onmouseout="out('-6215109126792992245');" style=""><abbr title=" 246                                                                                             .withPredicateProvider(new PredicateProvider() {"> 246                                                                                             .withPredicateProvider(ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 247                                                                                                 @Override          </span>
<span class="-6543887403560352788" onmouseenter="enter('-6543887403560352788');" onmouseout="out('-6543887403560352788');" style=""><abbr title=" 248                                                                                                 public Predicate buildPredicate(CriteriaBuilder builder,"> 248                                                                                                 public Predicate buðŸ”µ</abbr></span>
<span class="-9120683970411914274" onmouseenter="enter('-9120683970411914274');" onmouseout="out('-9120683970411914274');" style=""><abbr title=" 249                                                                                                                                 FieldPathBuilder fieldPathBuilder, From root,"> 249                                                                                                                    ðŸ”µ</abbr></span>
<span class="-6496567708295007325" onmouseenter="enter('-6496567708295007325');" onmouseout="out('-6496567708295007325');" style=""><abbr title=" 250                                                                                                                                 String ceilingEntity,"> 250                                                                                                                    ðŸ”µ</abbr></span>
<span class="-5624751861859036647" onmouseenter="enter('-5624751861859036647');" onmouseout="out('-5624751861859036647');" style=""><abbr title=" 251                                                                                                                                 String fullPropertyName, Path explicitPath,"> 251                                                                                                                    ðŸ”µ</abbr></span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style=""><abbr title=" 252                                                                                                                                 List directValues) {"> 252                                                                                                                    ðŸ”µ</abbr></span>
<span class="624264344901137787" onmouseenter="enter('624264344901137787');" onmouseout="out('624264344901137787');" style=""><abbr title=" 253                                                                                                     root.fetch(&quot;defaultSku&quot;, JoinType.LEFT);"> 253                                                                                                     root.fetch(&quot;defðŸ”µ</abbr></span>
<span class="2236319445290317600" onmouseenter="enter('2236319445290317600');" onmouseout="out('2236319445290317600');" style=""><abbr title=" 254                                                                                                     root.fetch(&quot;defaultCategory&quot;, JoinType.LEFT);"> 254                                                                                                     root.fetch(&quot;defðŸ”µ</abbr></span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 255                                                                                                     return null;   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256                                                                                                 }                  </span>
<span class="7022022634399588778" onmouseenter="enter('7022022634399588778');" onmouseout="out('7022022634399588778');" style=""> 257                                                                                             })                     </span>
<span class="3699784701886273761" onmouseenter="enter('3699784701886273761');" onmouseout="out('3699784701886273761');" style=""> 258                                                                    ));                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259          }                                                                                                         </span>
<span class="-5277136380896832206" onmouseenter="enter('-5277136380896832206');" onmouseout="out('-5277136380896832206');" style=""> 260          return helper.getCompatibleModule(OperationType.BASIC).fetch(persistencePackage, cto);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261      }                                                                                                             </span>
<span  style=""> 262                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 263      @Override                                                                                                     </span>
<span class="-3782560920985534584" onmouseenter="enter('-3782560920985534584');" onmouseout="out('-3782560920985534584');" style=""><abbr title=" 264      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 264      public Entity add(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpeðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 265          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 266          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 267              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span class="-1738937064203927240" onmouseenter="enter('-1738937064203927240');" onmouseout="out('-1738937064203927240');" style=""> 268              Product adminInstance = (Product) Class.forName(entity.getType()[0]).newInstance();                   </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 269              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 269              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(),ðŸ”µ</abbr></span>
<span  style=""> 270                                                                                                                    </span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 271              if (adminInstance instanceof ProductBundle) {                                                         </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 272                  removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273              }                                                                                                     </span>
<span  style=""> 274                                                                                                                    </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 275              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 275              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, falseðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 276              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span  style=""> 277                                                                                                                    </span>
<span class="2994500046663637288" onmouseenter="enter('2994500046663637288');" onmouseout="out('2994500046663637288');" style=""> 278              //Since none of the Sku fields are required, it&#x27;s possible that the user did not fill out             </span>
<span class="-1662985695084142247" onmouseenter="enter('-1662985695084142247');" onmouseout="out('-1662985695084142247');" style=""><abbr title=" 279              //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiate one"> 279              //any Sku fields, and thus a Sku would not be created. Product still needs a default Sku so instantiatðŸ”µ</abbr></span>
<span class="-4407708836004135952" onmouseenter="enter('-4407708836004135952');" onmouseout="out('-4407708836004135952');" style=""> 280              if (adminInstance.getDefaultSku() == null) {                                                          </span>
<span class="-5869950698936088971" onmouseenter="enter('-5869950698936088971');" onmouseout="out('-5869950698936088971');" style=""> 281                  Sku newSku = catalogService.createSku();                                                          </span>
<span class="3758063373327618746" onmouseenter="enter('3758063373327618746');" onmouseout="out('3758063373327618746');" style=""> 282                  dynamicEntityDao.persist(newSku);                                                                 </span>
<span class="3627601061948392291" onmouseenter="enter('3627601061948392291');" onmouseout="out('3627601061948392291');" style=""> 283                  adminInstance.setDefaultSku(newSku);                                                              </span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 284                  adminInstance = dynamicEntityDao.merge(adminInstance);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285              }                                                                                                     </span>
<span  style=""> 286                                                                                                                    </span>
<span class="1398885520878604990" onmouseenter="enter('1398885520878604990');" onmouseout="out('1398885520878604990');" style=""> 287              //also set the default product for the Sku                                                            </span>
<span class="-5769689371067636269" onmouseenter="enter('-5769689371067636269');" onmouseout="out('-5769689371067636269');" style=""> 288              adminInstance.getDefaultSku().setDefaultProduct(adminInstance);                                       </span>
<span class="-8818629679601416674" onmouseenter="enter('-8818629679601416674');" onmouseout="out('-8818629679601416674');" style=""> 289              dynamicEntityDao.merge(adminInstance.getDefaultSku());                                                </span>
<span  style=""> 290                                                                                                                    </span>
<span class="6340800826002936969" onmouseenter="enter('6340800826002936969');" onmouseout="out('6340800826002936969');" style=""> 291              // if this is a Pre-Add, skip the rest of the method                                                  </span>
<span class="4698552646741459586" onmouseenter="enter('4698552646741459586');" onmouseout="out('4698552646741459586');" style=""> 292              if (entity.isPreAdd()) {                                                                              </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 293                  return helper.getRecord(adminProperties, adminInstance, null, null);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294              }                                                                                                     </span>
<span  style=""> 295                                                                                                                    </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 296              boolean handled = false;                                                                              </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 297              if (extensionManager != null) {                                                                       </span>
<span class="-1778606721590329888" onmouseenter="enter('-1778606721590329888');" onmouseout="out('-1778606721590329888');" style=""><abbr title=" 298                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persistencePackage, adminInstance);"> 298                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForAdd(persisteðŸ”µ</abbr></span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 299                  handled = ExtensionResultStatusType.NOT_HANDLED != result;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300              }                                                                                                     </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 301              if (!handled) {                                                                                       </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 302                  setupXref(adminInstance);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303              }                                                                                                     </span>
<span  style=""> 304                                                                                                                    </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 305              return helper.getRecord(adminProperties, adminInstance, null, null);                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 306          } catch (Exception e) {                                                                                   </span>
<span class="7134174968934853795" onmouseenter="enter('7134174968934853795');" onmouseout="out('7134174968934853795');" style=""> 307              throw new ServiceException(&quot;Unable to add entity for &quot; + entity.getType()[0], e);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309      }                                                                                                             </span>
<span  style=""> 310                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 311      @Override                                                                                                     </span>
<span class="-7421665622225711363" onmouseenter="enter('-7421665622225711363');" onmouseout="out('-7421665622225711363');" style=""><abbr title=" 312      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 312      public Entity update(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper heðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 313          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 314          try {                                                                                                     </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 315              PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();       </span>
<span  style=""> 316                                                                                                                    </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 317              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 317              Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(),ðŸ”µ</abbr></span>
<span  style=""> 318                                                                                                                    </span>
<span class="1819538413343548026" onmouseenter="enter('1819538413343548026');" onmouseout="out('1819538413343548026');" style=""> 319              BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) adminProperties.get(&quot;defaultCategory&quot;));   </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 320              defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                                       </span>
<span class="6303363757907394261" onmouseenter="enter('6303363757907394261');" onmouseout="out('6303363757907394261');" style=""><abbr title=" 321              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 321              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; !StringUtils.isEmpty(entity.findProperty(&quot;defaulðŸ”µ</abbr></span>
<span class="-1298210778461020296" onmouseenter="enter('-1298210778461020296');" onmouseout="out('-1298210778461020296');" style=""><abbr title=" 322                  //Change the inherited type so that this property is disconnected from the entity and validation is temporarily skipped."> 322                  //Change the inherited type so that this property is disconnected from the entity and validation iðŸ”µ</abbr></span>
<span class="5827004128286973668" onmouseenter="enter('5827004128286973668');" onmouseout="out('5827004128286973668');" style=""><abbr title=" 323                  //This is useful when the defaultCategory was previously completely empty for whatever reason. Without this, such"> 323                  //This is useful when the defaultCategory was previously completely empty for whatever reason. WitðŸ”µ</abbr></span>
<span class="-8493051113864514358" onmouseenter="enter('-8493051113864514358');" onmouseout="out('-8493051113864514358');" style=""> 324                  //a case would fail the validation, even though the property was specified in the submission.     </span>
<span class="-8335887377494536791" onmouseenter="enter('-8335887377494536791');" onmouseout="out('-8335887377494536791');" style=""> 325                  defaultCategory.setInheritedFromType(String.class.getName());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326              }                                                                                                     </span>
<span  style=""> 327                                                                                                                    </span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 328              Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                    </span>
<span class="6153157527633548109" onmouseenter="enter('6153157527633548109');" onmouseout="out('6153157527633548109');" style=""><abbr title=" 329              Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primaryKey);"> 329              Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(entity.getType()[0]), primarðŸ”µ</abbr></span>
<span class="4651272141266782816" onmouseenter="enter('4651272141266782816');" onmouseout="out('4651272141266782816');" style=""> 330              if (adminInstance instanceof ProductBundle) {                                                         </span>
<span class="1608037765098343937" onmouseenter="enter('1608037765098343937');" onmouseout="out('1608037765098343937');" style=""> 331                  removeBundleFieldRestrictions((ProductBundle) adminInstance, adminProperties, entity);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332              }                                                                                                     </span>
<span  style=""> 333                                                                                                                    </span>
<span class="-710126092547245946" onmouseenter="enter('-710126092547245946');" onmouseout="out('-710126092547245946');" style=""> 334              CategoryProductXref oldDefault = getCurrentDefaultXref(adminInstance);                                </span>
<span class="-5817707795302619279" onmouseenter="enter('-5817707795302619279');" onmouseout="out('-5817707795302619279');" style=""><abbr title=" 335              //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched from db"> 335              //Fix for QA#2963 - during deployment sanboxed (not deployed) version of category will not be fetched ðŸ”µ</abbr></span>
<span class="6655495238084243637" onmouseenter="enter('6655495238084243637');" onmouseout="out('6655495238084243637');" style=""><abbr title=" 336              //and it will cause validation error, we should allow deployemnt of product with category in sandbox state"> 336              //and it will cause validation error, we should allow deployemnt of product with category in sandbox sðŸ”µ</abbr></span>
<span class="6453615407021429154" onmouseenter="enter('6453615407021429154');" onmouseout="out('6453615407021429154');" style=""> 337              //so override required flag for that field during deployment                                          </span>
<span class="-367004153561380049" onmouseenter="enter('-367004153561380049');" onmouseout="out('-367004153561380049');" style=""> 338              if(BroadleafRequestContext.getBroadleafRequestContext().isProductionSandBox()){                       </span>
<span class="-3632045312370469531" onmouseenter="enter('-3632045312370469531');" onmouseout="out('-3632045312370469531');" style=""> 339                  ((BasicFieldMetadata)adminProperties.get(&quot;defaultCategory&quot;)).setRequiredOverride(false);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340              }                                                                                                     </span>
<span class="115882008859230816" onmouseenter="enter('115882008859230816');" onmouseout="out('115882008859230816');" style=""><abbr title=" 341              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, false);"> 341              adminInstance = (Product) helper.createPopulatedInstance(adminInstance, entity, adminProperties, falseðŸ”µ</abbr></span>
<span class="-8515515287852309803" onmouseenter="enter('-8515515287852309803');" onmouseout="out('-8515515287852309803');" style=""> 342              adminInstance = dynamicEntityDao.merge(adminInstance);                                                </span>
<span class="-2571070256044572115" onmouseenter="enter('-2571070256044572115');" onmouseout="out('-2571070256044572115');" style=""> 343              boolean handled = false;                                                                              </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 344              if (extensionManager != null) {                                                                       </span>
<span class="-3727608922273128682" onmouseenter="enter('-3727608922273128682');" onmouseout="out('-3727608922273128682');" style=""> 345                  ExtensionResultStatusType result = extensionManager.getProxy().manageParentCategoryForUpdate      </span>
<span class="-5509937458278318351" onmouseenter="enter('-5509937458278318351');" onmouseout="out('-5509937458278318351');" style=""> 346                          (persistencePackage, adminInstance);                                                      </span>
<span class="3929977561681506234" onmouseenter="enter('3929977561681506234');" onmouseout="out('3929977561681506234');" style=""> 347                  handled = ExtensionResultStatusType.NOT_HANDLED != result;                                        </span>
<span  style=""> 348                                                                                                                    </span>
<span class="1636360182407915778" onmouseenter="enter('1636360182407915778');" onmouseout="out('1636360182407915778');" style=""> 349                  extensionManager.getProxy().manageFields(persistencePackage, adminInstance);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350              }                                                                                                     </span>
<span class="6122548445509025326" onmouseenter="enter('6122548445509025326');" onmouseout="out('6122548445509025326');" style=""> 351              if (!handled) {                                                                                       </span>
<span class="2516257976380182277" onmouseenter="enter('2516257976380182277');" onmouseout="out('2516257976380182277');" style=""> 352                  setupXref(adminInstance);                                                                         </span>
<span class="-7967199691392957007" onmouseenter="enter('-7967199691392957007');" onmouseout="out('-7967199691392957007');" style=""> 353                  removeOldDefault(adminInstance, oldDefault, entity);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354              }                                                                                                     </span>
<span  style=""> 355                                                                                                                    </span>
<span class="5485008517089027347" onmouseenter="enter('5485008517089027347');" onmouseout="out('5485008517089027347');" style=""> 356              return helper.getRecord(adminProperties, adminInstance, null, null);                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 357          } catch (Exception e) {                                                                                   </span>
<span class="-8723674804020595812" onmouseenter="enter('-8723674804020595812');" onmouseout="out('-8723674804020595812');" style=""> 358              throw new ServiceException(&quot;Unable to update entity for &quot; + entity.getType()[0], e);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360      }                                                                                                             </span>
<span  style=""> 361                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 362      @Override                                                                                                     </span>
<span class="1887636609613592843" onmouseenter="enter('1887636609613592843');" onmouseout="out('1887636609613592843');" style=""><abbr title=" 363      public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper) throws ServiceException {"> 363      public void remove(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helpðŸ”µ</abbr></span>
<span class="-5517088049392213417" onmouseenter="enter('-5517088049392213417');" onmouseout="out('-5517088049392213417');" style=""> 364          Entity entity = persistencePackage.getEntity();                                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 365          try {                                                                                                     </span>
<span class="3243810268662008348" onmouseenter="enter('3243810268662008348');" onmouseout="out('3243810268662008348');" style=""> 366              Product adminInstance = getAdminInstance(persistencePackage, dynamicEntityDao, helper, entity);       </span>
<span class="-4186523034208284789" onmouseenter="enter('-4186523034208284789');" onmouseout="out('-4186523034208284789');" style=""> 367              removeProduct(persistencePackage, adminInstance, helper);                                             </span>
<span class="29076383544473850" onmouseenter="enter('29076383544473850');" onmouseout="out('29076383544473850');" style=""> 368              List&lt;Sku&gt; skuList = adminInstance.getAllSkus();                                                       </span>
<span class="-2506961360510940575" onmouseenter="enter('-2506961360510940575');" onmouseout="out('-2506961360510940575');" style=""> 369              for (Sku sku : skuList) {                                                                             </span>
<span class="2039383434106799748" onmouseenter="enter('2039383434106799748');" onmouseout="out('2039383434106799748');" style=""> 370                  catalogService.removeSku(sku);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371              }                                                                                                     </span>
<span class="1054888787890391626" onmouseenter="enter('1054888787890391626');" onmouseout="out('1054888787890391626');" style=""> 372          } catch (ClassNotFoundException e) {                                                                      </span>
<span class="8549847936080404575" onmouseenter="enter('8549847936080404575');" onmouseout="out('8549847936080404575');" style=""> 373              throw new ServiceException(&quot;Unable to remove entity for &quot; + entity.getType()[0], e);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375      }                                                                                                             </span>
<span  style=""> 376                                                                                                                    </span>
<span class="-8634314107060974128" onmouseenter="enter('-8634314107060974128');" onmouseout="out('-8634314107060974128');" style=""><abbr title=" 377      protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RecordHelper helper,"> 377      protected Product getAdminInstance(PersistencePackage persistencePackage, DynamicEntityDao dynamicEntityDao, RðŸ”µ</abbr></span>
<span class="2232129114834499824" onmouseenter="enter('2232129114834499824');" onmouseout="out('2232129114834499824');" style=""> 378                                         Entity entity) throws ClassNotFoundException {                             </span>
<span class="818057629322979073" onmouseenter="enter('818057629322979073');" onmouseout="out('818057629322979073');" style=""> 379          PersistencePerspective persistencePerspective = persistencePackage.getPersistencePerspective();           </span>
<span class="-5893316249587451731" onmouseenter="enter('-5893316249587451731');" onmouseout="out('-5893316249587451731');" style=""><abbr title=" 380          Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), persistencePerspective);"> 380          Map&lt;String, FieldMetadata&gt; adminProperties = helper.getSimpleMergedProperties(Product.class.getName(), perðŸ”µ</abbr></span>
<span class="-5056229965271915337" onmouseenter="enter('-5056229965271915337');" onmouseout="out('-5056229965271915337');" style=""> 381          Object primaryKey = helper.getPrimaryKey(entity, adminProperties);                                        </span>
<span class="3403576257396241131" onmouseenter="enter('3403576257396241131');" onmouseout="out('3403576257396241131');" style=""> 382          String type = entity.getType()[0];                                                                        </span>
<span class="791413654597460382" onmouseenter="enter('791413654597460382');" onmouseout="out('791413654597460382');" style=""> 383          Product adminInstance = (Product) dynamicEntityDao.retrieve(Class.forName(type), primaryKey);             </span>
<span  style=""> 384                                                                                                                    </span>
<span class="2848615422851099691" onmouseenter="enter('2848615422851099691');" onmouseout="out('2848615422851099691');" style=""> 385          return adminInstance;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386      }                                                                                                             </span>
<span  style=""> 387                                                                                                                    </span>
<span class="-7276315230897223897" onmouseenter="enter('-7276315230897223897');" onmouseout="out('-7276315230897223897');" style=""><abbr title=" 388      protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helper) throws ServiceException {"> 388      protected void removeProduct(PersistencePackage persistencePackage, Product adminInstance, RecordHelper helperðŸ”µ</abbr></span>
<span class="8222559285797311452" onmouseenter="enter('8222559285797311452');" onmouseout="out('8222559285797311452');" style=""> 389          catalogService.removeProduct(adminInstance);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390      }                                                                                                             </span>
<span  style=""> 391                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 392      /**                                                                                                           </span>
<span class="-6565674410629622369" onmouseenter="enter('-6565674410629622369');" onmouseout="out('-6565674410629622369');" style=""> 393       * If the pricing model is of type item_sum, that property should not be required                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 394       *                                                                                                            </span>
<span class="-3727775444071594306" onmouseenter="enter('-3727775444071594306');" onmouseout="out('-3727775444071594306');" style=""> 395       * @param adminInstance                                                                                       </span>
<span class="1188154204740832420" onmouseenter="enter('1188154204740832420');" onmouseout="out('1188154204740832420');" style=""> 396       * @param adminProperties                                                                                     </span>
<span class="5381683285013722867" onmouseenter="enter('5381683285013722867');" onmouseout="out('5381683285013722867');" style=""> 397       * @param entity                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 398       */                                                                                                           </span>
<span class="1796231511775682058" onmouseenter="enter('1796231511775682058');" onmouseout="out('1796231511775682058');" style=""><abbr title=" 399      protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminProperties, Entity entity) {"> 399      protected void removeBundleFieldRestrictions(ProductBundle adminInstance, Map&lt;String, FieldMetadata&gt; adminPropðŸ”µ</abbr></span>
<span class="-7898829768536246574" onmouseenter="enter('-7898829768536246574');" onmouseout="out('-7898829768536246574');" style=""> 400          //no required validation for product bundles                                                              </span>
<span class="2028132163697204828" onmouseenter="enter('2028132163697204828');" onmouseout="out('2028132163697204828');" style=""> 401          ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(false);          </span>
<span class="-1136678238396033433" onmouseenter="enter('-1136678238396033433');" onmouseout="out('-1136678238396033433');" style=""> 402          if (entity.getPMap().get(&quot;pricingModel&quot;) != null) {                                                       </span>
<span class="-5810729812081766749" onmouseenter="enter('-5810729812081766749');" onmouseout="out('-5810729812081766749');" style=""><abbr title=" 403              if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValue())) {"> 403              if (ProductBundlePricingModelType.BUNDLE.getType().equals(entity.getPMap().get(&quot;pricingModel&quot;).getValuðŸ”µ</abbr></span>
<span class="-8087214156619436047" onmouseenter="enter('-8087214156619436047');" onmouseout="out('-8087214156619436047');" style=""> 404                  ((BasicFieldMetadata) adminProperties.get(&quot;defaultSku.retailPrice&quot;)).setRequiredOverride(true);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407      }                                                                                                             </span>
<span  style=""> 408                                                                                                                    </span>
<span class="-6194621554657272575" onmouseenter="enter('-6194621554657272575');" onmouseout="out('-6194621554657272575');" style=""> 409      protected Boolean isDefaultCategoryLegacyMode() {                                                             </span>
<span class="-2222712760012631506" onmouseenter="enter('-2222712760012631506');" onmouseout="out('-2222712760012631506');" style=""><abbr title=" 410          ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeService();"> 410          ParentCategoryLegacyModeService legacyModeService = ParentCategoryLegacyModeServiceImpl.getLegacyModeServiðŸ”µ</abbr></span>
<span class="-3125121052433413106" onmouseenter="enter('-3125121052433413106');" onmouseout="out('-3125121052433413106');" style=""> 411          if (legacyModeService != null) {                                                                          </span>
<span class="-7433711904609854570" onmouseenter="enter('-7433711904609854570');" onmouseout="out('-7433711904609854570');" style=""> 412              return legacyModeService.isLegacyMode();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 414          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415      }                                                                                                             </span>
<span  style=""> 416                                                                                                                    </span>
<span class="-182298883698048941" onmouseenter="enter('-182298883698048941');" onmouseout="out('-182298883698048941');" style=""> 417      protected void modifyParentCategoryMetadata(Map&lt;String, FieldMetadata&gt; md) {                                  </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 418          if (!isDefaultCategoryLegacyMode()) {                                                                     </span>
<span class="-3233029088333925194" onmouseenter="enter('-3233029088333925194');" onmouseout="out('-3233029088333925194');" style=""> 419              md.remove(&quot;allParentCategoryXrefs&quot;);                                                                  </span>
<span  style=""> 420                                                                                                                    </span>
<span class="-8850866426953517740" onmouseenter="enter('-8850866426953517740');" onmouseout="out('-8850866426953517740');" style=""> 421              BasicFieldMetadata defaultCategory = ((BasicFieldMetadata) md.get(&quot;defaultCategory&quot;));                </span>
<span class="-4242835614991779267" onmouseenter="enter('-4242835614991779267');" onmouseout="out('-4242835614991779267');" style=""> 422              defaultCategory.setFriendlyName(&quot;ProductImpl_Parent_Category&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424      }                                                                                                             </span>
<span  style=""> 425                                                                                                                    </span>
<span class="4323219351741765804" onmouseenter="enter('4323219351741765804');" onmouseout="out('4323219351741765804');" style=""> 426      protected Category getExistingDefaultCategory(Product product) {                                              </span>
<span class="4785057058955893593" onmouseenter="enter('4785057058955893593');" onmouseout="out('4785057058955893593');" style=""> 427          //Make sure we get the actual field value - not something manipulated in the getter                       </span>
<span class="-7097588232152162933" onmouseenter="enter('-7097588232152162933');" onmouseout="out('-7097588232152162933');" style=""> 428          Category parentCategory;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 429          try {                                                                                                     </span>
<span class="1642298731132209432" onmouseenter="enter('1642298731132209432');" onmouseout="out('1642298731132209432');" style=""> 430              Field defaultCategory = ProductImpl.class.getDeclaredField(&quot;defaultCategory&quot;);                        </span>
<span class="-5472088449890863756" onmouseenter="enter('-5472088449890863756');" onmouseout="out('-5472088449890863756');" style=""> 431              defaultCategory.setAccessible(true);                                                                  </span>
<span class="-5032854148355745900" onmouseenter="enter('-5032854148355745900');" onmouseout="out('-5032854148355745900');" style=""> 432              parentCategory = (Category) defaultCategory.get(product);                                             </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 433          } catch (NoSuchFieldException e) {                                                                        </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 434              throw ExceptionHelper.refineException(e);                                                             </span>
<span class="-4283655124212124805" onmouseenter="enter('-4283655124212124805');" onmouseout="out('-4283655124212124805');" style=""> 435          } catch (IllegalAccessException e) {                                                                      </span>
<span class="-1035238313469204420" onmouseenter="enter('-1035238313469204420');" onmouseout="out('-1035238313469204420');" style=""> 436              throw ExceptionHelper.refineException(e);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span class="-4827692301542162901" onmouseenter="enter('-4827692301542162901');" onmouseout="out('-4827692301542162901');" style=""> 438          return parentCategory;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439      }                                                                                                             </span>
<span  style=""> 440                                                                                                                    </span>
<span class="2198792804957949705" onmouseenter="enter('2198792804957949705');" onmouseout="out('2198792804957949705');" style=""> 441      protected void removeOldDefault(Product adminInstance, CategoryProductXref oldDefault, Entity entity) {       </span>
<span class="-133226884882730025" onmouseenter="enter('-133226884882730025');" onmouseout="out('-133226884882730025');" style=""> 442          if (!isDefaultCategoryLegacyMode()) {                                                                     </span>
<span class="-8408462162055715920" onmouseenter="enter('-8408462162055715920');" onmouseout="out('-8408462162055715920');" style=""><abbr title=" 443              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultCategory&quot;).getValue())) {"> 443              if (entity.findProperty(&quot;defaultCategory&quot;) != null &amp;&amp; StringUtils.isEmpty(entity.findProperty(&quot;defaultðŸ”µ</abbr></span>
<span class="3184747591230429719" onmouseenter="enter('3184747591230429719');" onmouseout="out('3184747591230429719');" style=""> 444                  adminInstance.setCategory(null);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445              }                                                                                                     </span>
<span class="7434653101319155783" onmouseenter="enter('7434653101319155783');" onmouseout="out('7434653101319155783');" style=""> 446              CategoryProductXref newDefault = getCurrentDefaultXref(adminInstance);                                </span>
<span class="1862582476950403842" onmouseenter="enter('1862582476950403842');" onmouseout="out('1862582476950403842');" style=""> 447              if (oldDefault != null &amp;&amp; !oldDefault.equals(newDefault)) {                                           </span>
<span class="-2218242322092133143" onmouseenter="enter('-2218242322092133143');" onmouseout="out('-2218242322092133143');" style=""> 448                  adminInstance.getAllParentCategoryXrefs().remove(oldDefault);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451      }                                                                                                             </span>
<span  style=""> 452                                                                                                                    </span>
<span class="902349756604301531" onmouseenter="enter('902349756604301531');" onmouseout="out('902349756604301531');" style=""> 453      protected void setupXref(Product adminInstance) {                                                             </span>
<span class="1047341479251260893" onmouseenter="enter('1047341479251260893');" onmouseout="out('1047341479251260893');" style=""> 454          if (isDefaultCategoryLegacyMode()) {                                                                      </span>
<span class="4336193572473592352" onmouseenter="enter('4336193572473592352');" onmouseout="out('4336193572473592352');" style=""> 455              CategoryProductXref categoryXref = new CategoryProductXrefImpl();                                     </span>
<span class="3362376343183691887" onmouseenter="enter('3362376343183691887');" onmouseout="out('3362376343183691887');" style=""> 456              categoryXref.setCategory(getExistingDefaultCategory(adminInstance));                                  </span>
<span class="998500482226783196" onmouseenter="enter('998500482226783196');" onmouseout="out('998500482226783196');" style=""> 457              categoryXref.setProduct(adminInstance);                                                               </span>
<span class="-2133389353332895077" onmouseenter="enter('-2133389353332895077');" onmouseout="out('-2133389353332895077');" style=""><abbr title=" 458              if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() != null) {"> 458              if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref) &amp;&amp; categoryXref.getCategory() !=ðŸ”µ</abbr></span>
<span class="-7221514252473967991" onmouseenter="enter('-7221514252473967991');" onmouseout="out('-7221514252473967991');" style=""> 459                  adminInstance.getAllParentCategoryXrefs().add(categoryXref);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462      }                                                                                                             </span>
<span  style=""> 463                                                                                                                    </span>
<span class="-4866520984434663516" onmouseenter="enter('-4866520984434663516');" onmouseout="out('-4866520984434663516');" style=""> 464      protected CategoryProductXref getCurrentDefaultXref(Product product) {                                        </span>
<span class="5121334440715645479" onmouseenter="enter('5121334440715645479');" onmouseout="out('5121334440715645479');" style=""> 465          CategoryProductXref currentDefault = null;                                                                </span>
<span class="4669448491831723006" onmouseenter="enter('4669448491831723006');" onmouseout="out('4669448491831723006');" style=""> 466          List&lt;CategoryProductXref&gt; xrefs = product.getAllParentCategoryXrefs();                                    </span>
<span class="-1899512729290259350" onmouseenter="enter('-1899512729290259350');" onmouseout="out('-1899512729290259350');" style=""> 467          if (!CollectionUtils.isEmpty(xrefs)) {                                                                    </span>
<span class="-1984009506268747903" onmouseenter="enter('-1984009506268747903');" onmouseout="out('-1984009506268747903');" style=""> 468              for (CategoryProductXref xref : xrefs) {                                                              </span>
<span class="113451359587339395" onmouseenter="enter('113451359587339395');" onmouseout="out('113451359587339395');" style=""><abbr title=" 469                  if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReference()) {"> 469                  if (xref.getCategory().isActive() &amp;&amp; xref.getDefaultReference() != null &amp;&amp; xref.getDefaultReferencðŸ”µ</abbr></span>
<span class="-4081682415228113248" onmouseenter="enter('-4081682415228113248');" onmouseout="out('-4081682415228113248');" style=""> 470                      currentDefault = xref;                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 471                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474          }                                                                                                         </span>
<span class="5312955631235184797" onmouseenter="enter('5312955631235184797');" onmouseout="out('5312955631235184797');" style=""> 475          return currentDefault;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476      }                                                                                                             </span>
<span  style=""> 477                                                                                                                    </span>
<span class="4094641218853198204" onmouseenter="enter('4094641218853198204');" onmouseout="out('4094641218853198204');" style=""> 478      protected boolean isRecursiveProductSelection(PersistencePackage persistencePackage) {                        </span>
<span class="-2408999831407736607" onmouseenter="enter('-2408999831407736607');" onmouseout="out('-2408999831407736607');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -        List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());                      </span>
<span class="6739384969443933808" onmouseenter="enter('6739384969443933808');" onmouseout="out('6739384969443933808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 480 -        return customCriteria.contains(&quot;upsaleProduct&quot;) || customCriteria.contains(&quot;crossSaleProduct&quot;) || customCriteria.contains(&quot;requestingField=addOnProduct&quot;);"> 480 -        return customCriteria.contains(&quot;upsaleProduct&quot;) || customCriteria.contains(&quot;crossSaleProduct&quot;) || customCrðŸ”µ</abbr></span>
<span class="7271253784317390082" onmouseenter="enter('7271253784317390082');" onmouseout="out('7271253784317390082');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 481 +        final List&lt;String&gt; customCriteria = Arrays.asList(persistencePackage.getCustomCriteria());                </span>
<span class="5034407762644036308" onmouseenter="enter('5034407762644036308');" onmouseout="out('5034407762644036308');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 482 +        return Stream.of(&quot;upsaleProduct&quot;, &quot;crossSaleProduct&quot;, &quot;requestingField=addOnProduct&quot;)                     </span>
<span class="-8438117934997670681" onmouseenter="enter('-8438117934997670681');" onmouseout="out('-8438117934997670681');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 483 +                .anyMatch(customCriteria::contains);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484      }                                                                                                             </span>
<span  style=""> 485                                                                                                                    </span>
<span class="-3368052144456426396" onmouseenter="enter('-3368052144456426396');" onmouseout="out('-3368052144456426396');" style=""><abbr title=" 486      protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicateProvider) {"> 486      protected FilterMapping createFilterMappingForProperty(String targetPropertyName, PredicateProvider predicatePðŸ”µ</abbr></span>
<span  style=""> 487                                                                                                                    </span>
<span class="8057622255252958217" onmouseenter="enter('8057622255252958217');" onmouseout="out('8057622255252958217');" style=""> 488          FieldPath fieldPath = new FieldPath().withTargetProperty(targetPropertyName);                             </span>
<span class="-6596211108915962883" onmouseenter="enter('-6596211108915962883');" onmouseout="out('-6596211108915962883');" style=""> 489          EmptyFilterValues directFilterValues = new EmptyFilterValues();                                           </span>
<span class="4277357472881062872" onmouseenter="enter('4277357472881062872');" onmouseout="out('4277357472881062872');" style=""> 490          Restriction newRestriction = new Restriction().withPredicateProvider(predicateProvider);                  </span>
<span  style=""> 491                                                                                                                    </span>
<span class="3608289770015613450" onmouseenter="enter('3608289770015613450');" onmouseout="out('3608289770015613450');" style=""> 492          return new FilterMapping()                                                                                </span>
<span class="-6035283433958931422" onmouseenter="enter('-6035283433958931422');" onmouseout="out('-6035283433958931422');" style=""> 493              .withFieldPath(fieldPath)                                                                             </span>
<span class="1581873956966044880" onmouseenter="enter('1581873956966044880');" onmouseout="out('1581873956966044880');" style=""> 494              .withDirectFilterValues(directFilterValues)                                                           </span>
<span class="27993374560272883" onmouseenter="enter('27993374560272883');" onmouseout="out('27993374560272883');" style=""> 495              .withRestriction(newRestriction);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496      }                                                                                                             </span>
<span  style=""> 497                                                                                                                    </span>
<span class="1303149189704190318" onmouseenter="enter('1303149189704190318');" onmouseout="out('1303149189704190318');" style=""><abbr title=" 498      protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferObject cto, RecordHelper helper) throws ServiceException {"> 498      protected DynamicResultSet getFilteredDynamicResultSet(PersistencePackage persistencePackage, CriteriaTransferðŸ”µ</abbr></span>
<span class="4441729997245575051" onmouseenter="enter('4441729997245575051');" onmouseout="out('4441729997245575051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 499 -        FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider() {"> 499 -        FilterMapping defaultCategoryMapping = createFilterMappingForProperty(ID_PROPERTY, new PredicateProvider()ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -            @Override                                                                                             </span>
<span class="-5588636227064039300" onmouseenter="enter('-5588636227064039300');" onmouseout="out('-5588636227064039300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -            public Predicate buildPredicate(CriteriaBuilder builder, FieldPathBuilder fieldPathBuilder, From root,</span>
<span class="-2630656431277390942" onmouseenter="enter('-2630656431277390942');" onmouseout="out('-2630656431277390942');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -                                            String ceilingEntity, String fullPropertyName, Path explicitPath,     </span>
<span class="-5946251977876316007" onmouseenter="enter('-5946251977876316007');" onmouseout="out('-5946251977876316007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 503 -                                            List directValues) {                                                  </span>
<span class="-7664604770218303640" onmouseenter="enter('-7664604770218303640');" onmouseout="out('-7664604770218303640');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 504 -                return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectionId()));"> 504 -                return builder.and(builder.notEqual(explicitPath, persistencePackage.getSectionCrumbs()[0].getSectðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -            }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 506 -        });                                                                                                       </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 507 -        cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                            </span>
<span class="-8187222964943103604" onmouseenter="enter('-8187222964943103604');" onmouseout="out('-8187222964943103604');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 508 +        SectionCrumb[] sectionCrumbs = persistencePackage.getSectionCrumbs();                                     </span>
<span class="-4365624777334076097" onmouseenter="enter('-4365624777334076097');" onmouseout="out('-4365624777334076097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +        if (sectionCrumbs != null &amp;&amp; sectionCrumbs.length &gt; 0) {                                                  </span>
<span class="-4393846817404821398" onmouseenter="enter('-4393846817404821398');" onmouseout="out('-4393846817404821398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 510 +            FilterMapping defaultCategoryMapping = this.createFilterMappingForProperty(                           </span>
<span class="-1391188242443598318" onmouseenter="enter('-1391188242443598318');" onmouseout="out('-1391188242443598318');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 511 +                    ID_PROPERTY,                                                                                  </span>
<span class="-7754832296053455105" onmouseenter="enter('-7754832296053455105');" onmouseout="out('-7754832296053455105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 512 +                    (builder, fieldPathBuilder, root, ceilingEntity, fullPropertyName, explicitPath, directValues)</span>
<span class="-2761785120798275454" onmouseenter="enter('-2761785120798275454');" onmouseout="out('-2761785120798275454');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 513 +                            -&gt; builder.and(builder.notEqual(explicitPath, sectionCrumbs[0].getSectionId()))       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 514 +            );                                                                                                    </span>
<span class="4489758666431231312" onmouseenter="enter('4489758666431231312');" onmouseout="out('4489758666431231312');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 515 +            cto.getAdditionalFilterMappings().add(defaultCategoryMapping);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 516 +        }                                                                                                         </span>


<span class="10418940480604143" onmouseenter="enter('10418940480604143');" onmouseout="out('10418940480604143');" style=""><abbr title=" 517          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType();"> 517          OperationType fetchType = persistencePackage.getPersistencePerspective().getOperationTypes().getFetchType(ðŸ”µ</abbr></span>
<span class="7533364809232214700" onmouseenter="enter('7533364809232214700');" onmouseout="out('7533364809232214700');" style=""> 518          PersistenceModule persistenceModule = helper.getCompatibleModule(fetchType);                              </span>
<span class="6289449121708775001" onmouseenter="enter('6289449121708775001');" onmouseout="out('6289449121708775001');" style=""> 519          return persistenceModule.fetch(persistencePackage, cto);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            