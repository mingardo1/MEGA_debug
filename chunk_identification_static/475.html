<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>475</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    475
                    <a href="474.html">prev</a>
                    <a href="476.html">next</a>
                    <a href="475_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_d3f904d1d764e0acb7127ddbeb050c2b3ff060b3_core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;d3f904d1d764e0acb7127ddbeb050c2b3ff060b3:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;d3f904d1d764e0acb7127ddbeb050c2b3ff060b3^1:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;d3f904d1d764e0acb7127ddbeb050c2b3ff060b3^2:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;d124305ffe07b66f8eee430b3c0ac1072281dc14:core/src/main/java/com/dtstack/flink/sql/side/SideSqlExec.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  22                                                                                                          </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  23 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  24 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  25 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  26 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  27 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  28 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  29 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  30 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  31 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  32 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  33 import org.apache.flink.types.Row;                                                                       </span>
<span  style="">  34                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  35 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  36 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  37 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  38 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  39 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  40 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  41 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  42 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  43 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  44 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  45 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  46 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  47 import com.google.common.collect.Sets;                                                                   </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  48 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  49 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  50 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  51 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  52 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  53 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  54 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  55 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  56 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  57 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  58 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  59 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  60 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  61 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  62 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  63 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  64 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  65 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  66 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  67 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  68 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  69                                                                                                          </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  70 import java.sql.Timestamp;                                                                               </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  71 import java.time.LocalDateTime;                                                                          </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  72 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  73 import java.util.Collection;                                                                             </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  74 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  75 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  76 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  77 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  78 import java.util.Set;                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  80 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  81                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  83  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  84  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  85  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  86  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87  */                                                                                                      </span>
<span  style="">  88                                                                                                          </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  89 public class SideSqlExec {                                                                               </span>
<span  style="">  90                                                                                                          </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  91     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  92                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  93     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  94                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  95     private String tmpFields = null;                                                                     </span>
<span  style="">  96                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  97     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  98                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  99     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style=""> 100                                                                                                          </span>
<span class="-2568962717532337416" onmouseenter="enter('-2568962717532337416');" onmouseout="out('-2568962717532337416');" style=""><abbr title=" 101     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,"> 101     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment 🔵</abbr></span>
<span class="85465325218630864" onmouseenter="enter('85465325218630864');" onmouseout="out('85465325218630864');" style=""><abbr title=" 102                      Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) throws Exception {"> 102                      Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) thro🔵</abbr></span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style=""> 103         if(localSqlPluginPath == null){                                                                  </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style=""> 104             throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 107         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 108         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 109             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 110         } catch (Exception e) {                                                                          </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 111             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style=""> 114         if(createView != null){                                                                          </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 115             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 116             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 117             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 120         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 121         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="-1577132173025596093" onmouseenter="enter('-1577132173025596093');" onmouseout="out('-1577132173025596093');" style=""> 122         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet());                  </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 123         Object pollObj = null;                                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="6779353451040372641" onmouseenter="enter('6779353451040372641');" onmouseout="out('6779353451040372641');" style=""> 125         //need clean                                                                                     </span>
<span class="4055483294687718975" onmouseenter="enter('4055483294687718975');" onmouseout="out('4055483294687718975');" style=""> 126         boolean preIsSideJoin = false;                                                                   </span>
<span class="2266898631888830275" onmouseenter="enter('2266898631888830275');" onmouseout="out('2266898631888830275');" style=""> 127         List&lt;FieldReplaceInfo&gt; replaceInfoList = Lists.newArrayList();                                   </span>
<span  style=""> 128                                                                                                          </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 129         while((pollObj = exeQueue.poll()) != null){                                                      </span>
<span  style=""> 130                                                                                                          </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 131             if(pollObj instanceof SqlNode){                                                              </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 132                 SqlNode pollSqlNode = (SqlNode) pollObj;                                                 </span>
<span  style=""> 133                                                                                                          </span>
<span class="-3934441269421991372" onmouseenter="enter('-3934441269421991372');" onmouseout="out('-3934441269421991372');" style=""> 134                 if(preIsSideJoin){                                                                       </span>
<span class="313285673257348059" onmouseenter="enter('313285673257348059');" onmouseout="out('313285673257348059');" style=""> 135                     preIsSideJoin = false;                                                               </span>
<span class="-2618061440979010579" onmouseenter="enter('-2618061440979010579');" onmouseout="out('-2618061440979010579');" style=""> 136                     List&lt;String&gt; fieldNames = null;                                                      </span>
<span class="-7322309591596780027" onmouseenter="enter('-7322309591596780027');" onmouseout="out('-7322309591596780027');" style=""> 137                     for(FieldReplaceInfo replaceInfo : replaceInfoList){                                 </span>
<span class="2418913985965727773" onmouseenter="enter('2418913985965727773');" onmouseout="out('2418913985965727773');" style=""> 138                         fieldNames = Lists.newArrayList();                                               </span>
<span class="-6690427821834278824" onmouseenter="enter('-6690427821834278824');" onmouseout="out('-6690427821834278824');" style=""> 139                         replaceFieldName(pollSqlNode, replaceInfo);                                      </span>
<span class="8246822691580888265" onmouseenter="enter('8246822691580888265');" onmouseout="out('8246822691580888265');" style=""> 140                         addAliasForFieldNode(pollSqlNode, fieldNames, replaceInfo.getMappingTable());    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span  style=""> 143                                                                                                          </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 144                 if(pollSqlNode.getKind() == INSERT){                                                     </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 145 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146                     System.out.println(&quot;----------real exec sql-----------&quot; );                           </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147                     System.out.println(pollSqlNode.toString());                                          </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 149 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                 if(pollSqlNode.getKind() == INSERT){                                                     </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                     System.out.println(&quot;----------real exec sql-----------&quot; );                           </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                     System.out.println(pollSqlNode.toString());                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 153 =======                                                                                                  </span>
<span class="-7041171683301857607" onmouseenter="enter('-7041171683301857607');" onmouseout="out('-7041171683301857607');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString(), queryConfig);               </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 155 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 156                     if(LOG.isInfoEnabled()){                                                             </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 157                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                     }                                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 160                 }else if(pollSqlNode.getKind() == AS){                                                   </span>
<span class="-4906327517343466594" onmouseenter="enter('-4906327517343466594');" onmouseout="out('-4906327517343466594');" style=""> 161                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache, replaceInfoList);               </span>
<span  style=""> 162                                                                                                          </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 163                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 164                     SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                 </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 165                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 166                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 167                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span  style=""> 168                                                                                                          </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 169                 } else if (pollSqlNode.getKind() == SELECT){                                             </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 170                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 170                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 171                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span  style=""> 172                                                                                                          </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 173                     if (createView.getFieldsInfoStr() == null){                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 174                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 175                     } else {                                                                             </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 176                         if (checkFieldsInfo(createView, table)){                                         </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 177                             table = table.as(tmpFields);                                                 </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 178                             tableEnv.registerTable(createView.getTableName(), table);                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 179                         } else {                                                                         </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 180                             throw new RuntimeException(&quot;Fields mismatch&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                     }                                                                                    </span>
<span  style=""> 183                                                                                                          </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 184                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                 }                                                                                        </span>
<span  style=""> 186                                                                                                          </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 187             }else if (pollObj instanceof JoinInfo){                                                      </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 188                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-4508108017455823844" onmouseenter="enter('-4508108017455823844');" onmouseout="out('-4508108017455823844');" style=""> 189                 preIsSideJoin = true;                                                                    </span>
<span class="-9158044292308775618" onmouseenter="enter('-9158044292308775618');" onmouseout="out('-9158044292308775618');" style=""> 190                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv, replaceInfoList);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span  style=""> 196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 198      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 199      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 200      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 201      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 202      */                                                                                                  </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 203     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){        </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 204         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 205         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span  style=""> 206                                                                                                          </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 207         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 208         if(infoKind != SELECT){                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 209             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 212         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);   </span>
<span  style=""> 213                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 214         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 215         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 216             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 217             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 218             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 219             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 222         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 223         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 224         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 225         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 226         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span  style=""> 229                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 230     /**                                                                                                  </span>
<span class="-3820374652196669145" onmouseenter="enter('-3820374652196669145');" onmouseout="out('-3820374652196669145');" style=""> 231      * 添加字段别名                                                                                            </span>
<span class="9038438555178000204" onmouseenter="enter('9038438555178000204');" onmouseout="out('9038438555178000204');" style=""> 232      * @param pollSqlNode                                                                                </span>
<span class="-5133777749030939729" onmouseenter="enter('-5133777749030939729');" onmouseout="out('-5133777749030939729');" style=""> 233      * @param fieldList                                                                                  </span>
<span class="-2002961180008195570" onmouseenter="enter('-2002961180008195570');" onmouseout="out('-2002961180008195570');" style=""> 234      * @param mappingTable                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 235      */                                                                                                  </span>
<span class="-3955444104111901697" onmouseenter="enter('-3955444104111901697');" onmouseout="out('-3955444104111901697');" style=""><abbr title=" 236     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 236     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String,🔵</abbr></span>
<span class="-663927235385144722" onmouseenter="enter('-663927235385144722');" onmouseout="out('-663927235385144722');" style=""> 237         SqlKind sqlKind = pollSqlNode.getKind();                                                         </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 238         switch (sqlKind) {                                                                               </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 239             case INSERT:                                                                                 </span>
<span class="-3657774864843651643" onmouseenter="enter('-3657774864843651643');" onmouseout="out('-3657774864843651643');" style=""> 240                 SqlNode source = ((SqlInsert) pollSqlNode).getSource();                                  </span>
<span class="6134982029327154291" onmouseenter="enter('6134982029327154291');" onmouseout="out('6134982029327154291');" style=""> 241                 addAliasForFieldNode(source, fieldList, mappingTable);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 242                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 243             case AS:                                                                                     </span>
<span class="-6853425371672212621" onmouseenter="enter('-6853425371672212621');" onmouseout="out('-6853425371672212621');" style=""><abbr title=" 244                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTable);"> 244                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTab🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 245                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 246             case SELECT:                                                                                 </span>
<span class="-345466278028982068" onmouseenter="enter('-345466278028982068');" onmouseout="out('-345466278028982068');" style=""> 247                 SqlNodeList selectList = ((SqlSelect) pollSqlNode).getSelectList();                      </span>
<span class="-4478316650227403681" onmouseenter="enter('-4478316650227403681');" onmouseout="out('-4478316650227403681');" style=""> 248                 selectList.getList().forEach(node -&gt; {                                                   </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 249                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 250                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 251                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 252                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                         }                                                                                </span>
<span class="-4986679521926317286" onmouseenter="enter('-4986679521926317286');" onmouseout="out('-4986679521926317286');" style=""> 254                         // save real field                                                               </span>
<span class="2742839839262283647" onmouseenter="enter('2742839839262283647');" onmouseout="out('2742839839262283647');" style=""> 255                         String fieldName = sqlIdentifier.names.get(1);                                   </span>
<span class="-5921041769209732806" onmouseenter="enter('-5921041769209732806');" onmouseout="out('-5921041769209732806');" style=""><abbr title=" 256                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().containsKey(fieldName)) {"> 256                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap🔵</abbr></span>
<span class="-2287024865944183458" onmouseenter="enter('-2287024865944183458');" onmouseout="out('-2287024865944183458');" style=""> 257                             fieldList.add(fieldName);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258                         }                                                                                </span>
<span  style=""> 259                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 261                 });                                                                                      </span>
<span class="-8923237898045704845" onmouseenter="enter('-8923237898045704845');" onmouseout="out('-8923237898045704845');" style=""> 262                 for (int i = 0; i &lt; selectList.getList().size(); i++) {                                  </span>
<span class="-4321294484021988020" onmouseenter="enter('-4321294484021988020');" onmouseout="out('-4321294484021988020');" style=""> 263                     SqlNode node = selectList.get(i);                                                    </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 264                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 265                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 266                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 267                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268                         }                                                                                </span>
<span class="-170655463018543442" onmouseenter="enter('-170655463018543442');" onmouseout="out('-170655463018543442');" style=""> 269                         String name = sqlIdentifier.names.get(1);                                        </span>
<span class="-3204699988614579440" onmouseenter="enter('-3204699988614579440');" onmouseout="out('-3204699988614579440');" style=""> 270                         // avoid real field pv0 convert pv                                               </span>
<span class="6166166284113505247" onmouseenter="enter('6166166284113505247');" onmouseout="out('6166166284113505247');" style=""><abbr title=" 271                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring(0, name.length() - 1))) {"> 271                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.🔵</abbr></span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 272                             SqlOperator operator = new SqlAsOperator();                                  </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 273                             SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                          </span>
<span  style=""> 274                                                                                                          </span>
<span class="-2138283127011244558" onmouseenter="enter('-2138283127011244558');" onmouseout="out('-2138283127011244558');" style=""><abbr title=" 275                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() - 1), null, sqlParserPos);"> 275                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.l🔵</abbr></span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 276                             SqlNode[] sqlNodes = new SqlNode[2];                                         </span>
<span class="-2939555014928254235" onmouseenter="enter('-2939555014928254235');" onmouseout="out('-2939555014928254235');" style=""> 277                             sqlNodes[0] = sqlIdentifier;                                                 </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 278                             sqlNodes[1] = sqlIdentifierAlias;                                            </span>
<span class="172920197577317623" onmouseenter="enter('172920197577317623');" onmouseout="out('172920197577317623');" style=""><abbr title=" 279                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos);"> 279                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos🔵</abbr></span>
<span  style=""> 280                                                                                                          </span>
<span class="-6513758114426947797" onmouseenter="enter('-6513758114426947797');" onmouseout="out('-6513758114426947797');" style=""> 281                             selectList.set(i, sqlBasicCall);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 285                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 286             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 287                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span  style=""> 290                                                                                                          </span>
<span  style=""> 291                                                                                                          </span>
<span class="3897594848566528823" onmouseenter="enter('3897594848566528823');" onmouseout="out('3897594848566528823');" style=""> 292     public AliasInfo parseAsNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 293         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 294         if(sqlKind != AS){                                                                               </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 295             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span  style=""> 297                                                                                                          </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 298         SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                         </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 299         SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                       </span>
<span  style=""> 300                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 301         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 302         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 303         aliasInfo.setAlias(alias.toString());                                                            </span>
<span  style=""> 304                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 305         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="-8689302297966137516" onmouseenter="enter('-8689302297966137516');" onmouseout="out('-8689302297966137516');" style=""><abbr title=" 308     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 308     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, Stri🔵</abbr></span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 309         TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                  </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 310         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 311         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 312             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 313             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 314             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 315             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 316             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 318             sideOutTypes[i] = fieldInfo.getTypeInformation();                                            </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 319             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 321         return new RowTypeInfo(sideOutTypes, sideOutNames);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322     }                                                                                                    </span>
<span  style=""> 323                                                                                                          </span>
<span  style=""> 324                                                                                                          </span>
<span  style=""> 325                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 326     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 327         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 328             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 330         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331     }                                                                                                    </span>
<span  style=""> 332                                                                                                          </span>
<span class="4184261108342886546" onmouseenter="enter('4184261108342886546');" onmouseout="out('4184261108342886546');" style=""> 333     //需要考虑更多的情况                                                                                          </span>
<span class="-5866348515582828073" onmouseenter="enter('-5866348515582828073');" onmouseout="out('-5866348515582828073');" style=""> 334     private void replaceFieldName(SqlNode sqlNode, FieldReplaceInfo replaceInfo) {                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 335         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 336         switch (sqlKind) {                                                                               </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 337             case INSERT:                                                                                 </span>
<span class="1507566640229528779" onmouseenter="enter('1507566640229528779');" onmouseout="out('1507566640229528779');" style=""> 338                 SqlNode sqlSource = ((SqlInsert) sqlNode).getSource();                                   </span>
<span class="3539579188210716047" onmouseenter="enter('3539579188210716047');" onmouseout="out('3539579188210716047');" style=""> 339                 replaceFieldName(sqlSource, replaceInfo);                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 340                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 341             case AS:                                                                                     </span>
<span class="-2471580703701460163" onmouseenter="enter('-2471580703701460163');" onmouseout="out('-2471580703701460163');" style=""> 342                 SqlNode asNode = ((SqlBasicCall) sqlNode).getOperands()[0];                              </span>
<span class="2382936847570265491" onmouseenter="enter('2382936847570265491');" onmouseout="out('2382936847570265491');" style=""> 343                 replaceFieldName(asNode, replaceInfo);                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 344                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 345             case SELECT:                                                                                 </span>
<span class="7730902652365827282" onmouseenter="enter('7730902652365827282');" onmouseout="out('7730902652365827282');" style=""><abbr title=" 346                 SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName());"> 346                 SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTarget🔵</abbr></span>
<span class="-1465070514376240276" onmouseenter="enter('-1465070514376240276');" onmouseout="out('-1465070514376240276');" style=""> 347                 if(sqlSelect == null){                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 348                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349                 }                                                                                        </span>
<span  style=""> 350                                                                                                          </span>
<span class="-7911431356156617515" onmouseenter="enter('-7911431356156617515');" onmouseout="out('-7911431356156617515');" style=""> 351                 SqlNode sqlSource1 = sqlSelect.getFrom();                                                </span>
<span class="-4060139958118865814" onmouseenter="enter('-4060139958118865814');" onmouseout="out('-4060139958118865814');" style=""> 352                 if(sqlSource1.getKind() == AS){                                                          </span>
<span class="7708153722582291408" onmouseenter="enter('7708153722582291408');" onmouseout="out('7708153722582291408');" style=""> 353                     String tableName = ((SqlBasicCall)sqlSource1).getOperands()[0].toString();           </span>
<span class="-7976662112993336650" onmouseenter="enter('-7976662112993336650');" onmouseout="out('-7976662112993336650');" style=""> 354                     if(tableName.equalsIgnoreCase(replaceInfo.getTargetTableName())){                    </span>
<span class="5036423329776629809" onmouseenter="enter('5036423329776629809');" onmouseout="out('5036423329776629809');" style=""> 355                         SqlNodeList sqlSelectList = sqlSelect.getSelectList();                           </span>
<span class="4783458191183529265" onmouseenter="enter('4783458191183529265');" onmouseout="out('4783458191183529265');" style=""> 356                         SqlNode whereNode = sqlSelect.getWhere();                                        </span>
<span class="6069356713975423578" onmouseenter="enter('6069356713975423578');" onmouseout="out('6069356713975423578');" style=""> 357                         SqlNodeList sqlGroup = sqlSelect.getGroup();                                     </span>
<span  style=""> 358                                                                                                          </span>
<span class="2024933395694494313" onmouseenter="enter('2024933395694494313');" onmouseout="out('2024933395694494313');" style=""> 359                         //TODO 暂时不处理having                                                               </span>
<span class="-2928778695763881832" onmouseenter="enter('-2928778695763881832');" onmouseout="out('-2928778695763881832');" style=""> 360                         SqlNode sqlHaving = sqlSelect.getHaving();                                       </span>
<span  style=""> 361                                                                                                          </span>
<span class="-3614471078991347107" onmouseenter="enter('-3614471078991347107');" onmouseout="out('-3614471078991347107');" style=""> 362                         List&lt;SqlNode&gt; newSelectNodeList = Lists.newArrayList();                          </span>
<span class="4525830429471113267" onmouseenter="enter('4525830429471113267');" onmouseout="out('4525830429471113267');" style=""> 363                         for( int i=0; i&lt;sqlSelectList.getList().size(); i++){                            </span>
<span class="295237348129218365" onmouseenter="enter('295237348129218365');" onmouseout="out('295237348129218365');" style=""> 364                             SqlNode selectNode = sqlSelectList.getList().get(i);                         </span>
<span class="3005939127677060655" onmouseenter="enter('3005939127677060655');" onmouseout="out('3005939127677060655');" style=""> 365                             //特殊处理 isStar的标识                                                             </span>
<span class="-7362933676269921614" onmouseenter="enter('-7362933676269921614');" onmouseout="out('-7362933676269921614');" style=""><abbr title=" 366                             if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar()){"> 366                             if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar(🔵</abbr></span>
<span class="1426748103918852649" onmouseenter="enter('1426748103918852649');" onmouseout="out('1426748103918852649');" style=""><abbr title=" 367                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo);"> 367                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, re🔵</abbr></span>
<span class="-936038636053459659" onmouseenter="enter('-936038636053459659');" onmouseout="out('-936038636053459659');" style=""> 368                                 newSelectNodeList.addAll(replaceNodeList);                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 369                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370                             }                                                                            </span>
<span  style=""> 371                                                                                                          </span>
<span class="3570575360626670937" onmouseenter="enter('3570575360626670937');" onmouseout="out('3570575360626670937');" style=""> 372                             SqlNode replaceNode = replaceSelectFieldName(selectNode, replaceInfo);       </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 373                             if(replaceNode == null){                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 374                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375                             }                                                                            </span>
<span  style=""> 376                                                                                                          </span>
<span class="-2861561298429904330" onmouseenter="enter('-2861561298429904330');" onmouseout="out('-2861561298429904330');" style=""> 377                             //sqlSelectList.set(i, replaceNode);                                         </span>
<span class="1157087708345012360" onmouseenter="enter('1157087708345012360');" onmouseout="out('1157087708345012360');" style=""> 378                             newSelectNodeList.add(replaceNode);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379                         }                                                                                </span>
<span  style=""> 380                                                                                                          </span>
<span class="3723543992832155466" onmouseenter="enter('3723543992832155466');" onmouseout="out('3723543992832155466');" style=""><abbr title=" 381                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosition());"> 381                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getP🔵</abbr></span>
<span class="-8903961717282297850" onmouseenter="enter('-8903961717282297850');" onmouseout="out('-8903961717282297850');" style=""> 382                         sqlSelect.setSelectList(newSelectList);                                          </span>
<span  style=""> 383                                                                                                          </span>
<span class="-47820880813073829" onmouseenter="enter('-47820880813073829');" onmouseout="out('-47820880813073829');" style=""> 384                         //where                                                                          </span>
<span class="-2977999434516732521" onmouseenter="enter('-2977999434516732521');" onmouseout="out('-2977999434516732521');" style=""> 385                         if(whereNode != null){                                                           </span>
<span class="5185992084008387135" onmouseenter="enter('5185992084008387135');" onmouseout="out('5185992084008387135');" style=""> 386                             SqlNode[] sqlNodeList = ((SqlBasicCall)whereNode).getOperands();             </span>
<span class="3961659355684503168" onmouseenter="enter('3961659355684503168');" onmouseout="out('3961659355684503168');" style=""> 387                             for(int i =0; i&lt;sqlNodeList.length; i++) {                                   </span>
<span class="2172750173548984826" onmouseenter="enter('2172750173548984826');" onmouseout="out('2172750173548984826');" style=""> 388                                 SqlNode whereSqlNode = sqlNodeList[i];                                   </span>
<span class="-4477047106175359937" onmouseenter="enter('-4477047106175359937');" onmouseout="out('-4477047106175359937');" style=""> 389                                 SqlNode replaceNode = replaceNodeInfo(whereSqlNode, replaceInfo);        </span>
<span class="-1237302974526763563" onmouseenter="enter('-1237302974526763563');" onmouseout="out('-1237302974526763563');" style=""> 390                                 sqlNodeList[i] = replaceNode;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392                         }                                                                                </span>
<span class="6298777632396279516" onmouseenter="enter('6298777632396279516');" onmouseout="out('6298777632396279516');" style=""> 393                         if(sqlGroup != null &amp;&amp; CollectionUtils.isNotEmpty(sqlGroup.getList())){          </span>
<span class="-8564058694678267080" onmouseenter="enter('-8564058694678267080');" onmouseout="out('-8564058694678267080');" style=""> 394                             for( int i=0; i&lt;sqlGroup.getList().size(); i++){                             </span>
<span class="1364213940272952273" onmouseenter="enter('1364213940272952273');" onmouseout="out('1364213940272952273');" style=""> 395                                 SqlNode selectNode = sqlGroup.getList().get(i);                          </span>
<span class="3578364850198173029" onmouseenter="enter('3578364850198173029');" onmouseout="out('3578364850198173029');" style=""> 396                                 SqlNode replaceNode = replaceNodeInfo(selectNode, replaceInfo);          </span>
<span class="5715423325454336801" onmouseenter="enter('5715423325454336801');" onmouseout="out('5715423325454336801');" style=""> 397                                 sqlGroup.set(i, replaceNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 401                 }else{                                                                                   </span>
<span class="7951951008096051242" onmouseenter="enter('7951951008096051242');" onmouseout="out('7951951008096051242');" style=""> 402                     throw new RuntimeException(&quot;---not deal type:&quot; + sqlNode);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403                 }                                                                                        </span>
<span  style=""> 404                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 405                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 406             case UNION:                                                                                  </span>
<span class="-8185525423233229369" onmouseenter="enter('-8185525423233229369');" onmouseout="out('-8185525423233229369');" style=""> 407                 SqlNode unionLeft = ((SqlBasicCall) sqlNode).getOperands()[0];                           </span>
<span class="3590878486653773103" onmouseenter="enter('3590878486653773103');" onmouseout="out('3590878486653773103');" style=""> 408                 SqlNode unionRight = ((SqlBasicCall) sqlNode).getOperands()[1];                          </span>
<span class="12832057540049012" onmouseenter="enter('12832057540049012');" onmouseout="out('12832057540049012');" style=""> 409                 replaceFieldName(unionLeft, replaceInfo);                                                </span>
<span class="-8236931260571053140" onmouseenter="enter('-8236931260571053140');" onmouseout="out('-8236931260571053140');" style=""> 410                 replaceFieldName(unionRight, replaceInfo);                                               </span>
<span  style=""> 411                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 412                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 413             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 414                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="6726911406523213581" onmouseenter="enter('6726911406523213581');" onmouseout="out('6726911406523213581');" style=""> 415                 replaceFieldName(sqlOrderBy.query, replaceInfo);                                         </span>
<span class="-1619723091747707804" onmouseenter="enter('-1619723091747707804');" onmouseout="out('-1619723091747707804');" style=""> 416                 SqlNodeList orderFiledList = sqlOrderBy.orderList;                                       </span>
<span class="-5416337846474747128" onmouseenter="enter('-5416337846474747128');" onmouseout="out('-5416337846474747128');" style=""> 417                 for (int i=0 ;i&lt;orderFiledList.size();i++) {                                             </span>
<span class="3598769397463403835" onmouseenter="enter('3598769397463403835');" onmouseout="out('3598769397463403835');" style=""><abbr title=" 418                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTableAlias());"> 418                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getT🔵</abbr></span>
<span class="-1288993483926023903" onmouseenter="enter('-1288993483926023903');" onmouseout="out('-1288993483926023903');" style=""> 419                     orderFiledList.set(i, replaceNode);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420                 }                                                                                        </span>
<span  style=""> 421                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 422             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 423                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425     }                                                                                                    </span>
<span  style=""> 426                                                                                                          </span>
<span class="-4529709500477233937" onmouseenter="enter('-4529709500477233937');" onmouseout="out('-4529709500477233937');" style=""> 427     private SqlNode replaceOrderByTableName(SqlNode orderNode, String tableAlias) {                      </span>
<span class="-8843072586907859237" onmouseenter="enter('-8843072586907859237');" onmouseout="out('-8843072586907859237');" style=""> 428         if(orderNode.getKind() == IDENTIFIER){                                                           </span>
<span class="1286019212722079849" onmouseenter="enter('1286019212722079849');" onmouseout="out('1286019212722079849');" style=""> 429             SqlIdentifier sqlIdentifier = (SqlIdentifier) orderNode;                                     </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 430             if (sqlIdentifier.names.size() == 1) {                                                       </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 431                 return orderNode;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432             }                                                                                            </span>
<span class="4987076328947336547" onmouseenter="enter('4987076328947336547');" onmouseout="out('4987076328947336547');" style=""> 433             return sqlIdentifier.setName(0, tableAlias);                                                 </span>
<span class="6164370744345420381" onmouseenter="enter('6164370744345420381');" onmouseout="out('6164370744345420381');" style=""> 434         } else if (orderNode instanceof  SqlBasicCall) {                                                 </span>
<span class="4197878478620092735" onmouseenter="enter('4197878478620092735');" onmouseout="out('4197878478620092735');" style=""> 435             SqlBasicCall sqlBasicCall = (SqlBasicCall) orderNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 436             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 437                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="-7345169450449378118" onmouseenter="enter('-7345169450449378118');" onmouseout="out('-7345169450449378118');" style=""> 438                 sqlBasicCall.getOperands()[i] = replaceOrderByTableName(sqlNode , tableAlias);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439             }                                                                                            </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 440             return sqlBasicCall;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 441         } else {                                                                                         </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 442             return orderNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="4620342074554351588" onmouseenter="enter('4620342074554351588');" onmouseout="out('4620342074554351588');" style=""> 446     private SqlNode replaceNodeInfo(SqlNode groupNode, FieldReplaceInfo replaceInfo){                    </span>
<span class="-8006552962557562934" onmouseenter="enter('-8006552962557562934');" onmouseout="out('-8006552962557562934');" style=""> 447         if(groupNode.getKind() == IDENTIFIER){                                                           </span>
<span class="3769318911409416973" onmouseenter="enter('3769318911409416973');" onmouseout="out('3769318911409416973');" style=""> 448             SqlIdentifier sqlIdentifier = (SqlIdentifier) groupNode;                                     </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 449             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 450                 return sqlIdentifier;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451             }                                                                                            </span>
<span  style=""> 452                                                                                                          </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 453             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 453             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="1289832806545417263" onmouseenter="enter('1289832806545417263');" onmouseout="out('1289832806545417263');" style=""> 454             if(mappingFieldName == null){                                                                </span>
<span class="-3862759337385230883" onmouseenter="enter('-3862759337385230883');" onmouseout="out('-3862759337385230883');" style=""> 455                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + sqlIdentifier.toString() ); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456             }                                                                                            </span>
<span  style=""> 457                                                                                                          </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 458             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2521832232004155291" onmouseenter="enter('2521832232004155291');" onmouseout="out('2521832232004155291');" style=""> 459             return sqlIdentifier.setName(1, mappingFieldName);                                           </span>
<span class="6819015395036995114" onmouseenter="enter('6819015395036995114');" onmouseout="out('6819015395036995114');" style=""> 460         }else if(groupNode instanceof  SqlBasicCall){                                                    </span>
<span class="8961639140694724649" onmouseenter="enter('8961639140694724649');" onmouseout="out('8961639140694724649');" style=""> 461             SqlBasicCall sqlBasicCall = (SqlBasicCall) groupNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 462             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 463                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 464                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 465                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466             }                                                                                            </span>
<span  style=""> 467                                                                                                          </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 468             return sqlBasicCall;                                                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 469         }else{                                                                                           </span>
<span class="-2985482133144580062" onmouseenter="enter('-2985482133144580062');" onmouseout="out('-2985482133144580062');" style=""> 470             return groupNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472     }                                                                                                    </span>
<span  style=""> 473                                                                                                          </span>
<span class="8999921149877150187" onmouseenter="enter('8999921149877150187');" onmouseout="out('8999921149877150187');" style=""> 474     public SqlNode filterNodeWithTargetName(SqlNode sqlNode, String targetTableName) {                   </span>
<span  style=""> 475                                                                                                          </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 476         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 477         switch (sqlKind){                                                                                </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 478             case SELECT:                                                                                 </span>
<span class="3690582093491335304" onmouseenter="enter('3690582093491335304');" onmouseout="out('3690582093491335304');" style=""> 479                 SqlNode fromNode = ((SqlSelect)sqlNode).getFrom();                                       </span>
<span class="-3145608785072750921" onmouseenter="enter('-3145608785072750921');" onmouseout="out('-3145608785072750921');" style=""><abbr title=" 480                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDENTIFIER){"> 480                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDE🔵</abbr></span>
<span class="-8703575627981044416" onmouseenter="enter('-8703575627981044416');" onmouseout="out('-8703575627981044416');" style=""><abbr title=" 481                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableName)){"> 481                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableN🔵</abbr></span>
<span class="4129664160573057591" onmouseenter="enter('4129664160573057591');" onmouseout="out('4129664160573057591');" style=""> 482                         return sqlNode;                                                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 483                     }else{                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 484                         return null;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 486                 }else{                                                                                   </span>
<span class="-487022337093825690" onmouseenter="enter('-487022337093825690');" onmouseout="out('-487022337093825690');" style=""> 487                     return filterNodeWithTargetName(fromNode, targetTableName);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488                 }                                                                                        </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 489             case AS:                                                                                     </span>
<span class="-1062165270197177560" onmouseenter="enter('-1062165270197177560');" onmouseout="out('-1062165270197177560');" style=""> 490                 SqlNode childNode = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-1638905337538821604" onmouseenter="enter('-1638905337538821604');" onmouseout="out('-1638905337538821604');" style=""> 491                 return filterNodeWithTargetName(childNode, targetTableName);                             </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 492             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 493                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-2733398086906527657" onmouseenter="enter('-2733398086906527657');" onmouseout="out('-2733398086906527657');" style=""> 494                 SqlNode rightNode =  ((SqlJoin)sqlNode).getRight();                                      </span>
<span class="2468445302541940347" onmouseenter="enter('2468445302541940347');" onmouseout="out('2468445302541940347');" style=""> 495                 SqlNode leftReturnNode = filterNodeWithTargetName(leftNode, targetTableName);            </span>
<span class="-8199943593633767670" onmouseenter="enter('-8199943593633767670');" onmouseout="out('-8199943593633767670');" style=""> 496                 SqlNode rightReturnNode = filterNodeWithTargetName(rightNode, targetTableName);          </span>
<span  style=""> 497                                                                                                          </span>
<span class="-394673487884933665" onmouseenter="enter('-394673487884933665');" onmouseout="out('-394673487884933665');" style=""> 498                 if(leftReturnNode != null) {                                                             </span>
<span class="7562823630460789719" onmouseenter="enter('7562823630460789719');" onmouseout="out('7562823630460789719');" style=""> 499                     return leftReturnNode;                                                               </span>
<span class="1020015460804008518" onmouseenter="enter('1020015460804008518');" onmouseout="out('1020015460804008518');" style=""> 500                 }else if(rightReturnNode != null){                                                       </span>
<span class="7420403991289947009" onmouseenter="enter('7420403991289947009');" onmouseout="out('7420403991289947009');" style=""> 501                     return rightReturnNode;                                                              </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 502                 }else{                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 503                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504                 }                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 505             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 506                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507         }                                                                                                </span>
<span  style=""> 508                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 509         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510     }                                                                                                    </span>
<span  style=""> 511                                                                                                          </span>
<span  style=""> 512                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 513     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 514         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""><abbr title=" 517     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 517     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 518         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 519         if(table == null){                                                                               </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 520             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521         }                                                                                                </span>
<span  style=""> 522                                                                                                          </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 523         if(table == null){                                                                               </span>
<span class="-2825016904896826066" onmouseenter="enter('-2825016904896826066');" onmouseout="out('-2825016904896826066');" style=""> 524             throw new RuntimeException(&quot;not register table &quot; + tableName);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span  style=""> 526                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 527         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span  style=""> 529                                                                                                          </span>
<span class="-8696523049985644897" onmouseenter="enter('-8696523049985644897');" onmouseout="out('-8696523049985644897');" style=""> 530     private List&lt;SqlNode&gt; replaceSelectStarFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo){  </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 531         SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                        </span>
<span class="-376697531199676299" onmouseenter="enter('-376697531199676299');" onmouseout="out('-376697531199676299');" style=""> 532         List&lt;SqlNode&gt; sqlNodes = Lists.newArrayList();                                                   </span>
<span class="-3220711380851181839" onmouseenter="enter('-3220711380851181839');" onmouseout="out('-3220711380851181839');" style=""> 533         if(sqlIdentifier.isStar()){//处理 [* or table.*]                                                   </span>
<span class="-8760640117888015743" onmouseenter="enter('-8760640117888015743');" onmouseout="out('-8760640117888015743');" style=""> 534             int identifierSize = sqlIdentifier.names.size();                                             </span>
<span class="-737230567623922483" onmouseenter="enter('-737230567623922483');" onmouseout="out('-737230567623922483');" style=""> 535             Collection&lt;String&gt; columns = null;                                                           </span>
<span class="-3878600943817580523" onmouseenter="enter('-3878600943817580523');" onmouseout="out('-3878600943817580523');" style=""> 536             if(identifierSize == 1){                                                                     </span>
<span class="439489357590017604" onmouseenter="enter('439489357590017604');" onmouseout="out('439489357590017604');" style=""> 537                 columns = replaceInfo.getMappingTable().values();                                        </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 538             }else{                                                                                       </span>
<span class="-6967503276601174325" onmouseenter="enter('-6967503276601174325');" onmouseout="out('-6967503276601174325');" style=""> 539                 columns = replaceInfo.getMappingTable().row(sqlIdentifier.names.get(0)).values();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540             }                                                                                            </span>
<span  style=""> 541                                                                                                          </span>
<span class="-8621425588629763030" onmouseenter="enter('-8621425588629763030');" onmouseout="out('-8621425588629763030');" style=""> 542             for(String colAlias : columns){                                                              </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 543                 SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                      </span>
<span class="7376564429850475234" onmouseenter="enter('7376564429850475234');" onmouseout="out('7376564429850475234');" style=""> 544                 List&lt;String&gt; columnInfo = Lists.newArrayList();                                          </span>
<span class="-7580690826400610936" onmouseenter="enter('-7580690826400610936');" onmouseout="out('-7580690826400610936');" style=""> 545                 columnInfo.add(replaceInfo.getTargetTableAlias());                                       </span>
<span class="8071016449845654104" onmouseenter="enter('8071016449845654104');" onmouseout="out('8071016449845654104');" style=""> 546                 columnInfo.add(colAlias);                                                                </span>
<span class="-2937163626106946341" onmouseenter="enter('-2937163626106946341');" onmouseout="out('-2937163626106946341');" style=""> 547                 SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(columnInfo, sqlParserPos);          </span>
<span class="6977395894616298454" onmouseenter="enter('6977395894616298454');" onmouseout="out('6977395894616298454');" style=""> 548                 sqlNodes.add(sqlIdentifierAlias);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549             }                                                                                            </span>
<span  style=""> 550                                                                                                          </span>
<span class="-2192274943977569589" onmouseenter="enter('-2192274943977569589');" onmouseout="out('-2192274943977569589');" style=""> 551             return sqlNodes;                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 552         }else{                                                                                           </span>
<span class="-8039826041817422769" onmouseenter="enter('-8039826041817422769');" onmouseout="out('-8039826041817422769');" style=""> 553             throw new RuntimeException(&quot;is not a star select field.&quot; + selectNode);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555     }                                                                                                    </span>
<span  style=""> 556                                                                                                          </span>
<span class="-5931652736394605669" onmouseenter="enter('-5931652736394605669');" onmouseout="out('-5931652736394605669');" style=""> 557     private SqlNode replaceSelectFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo) {           </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 558         if (selectNode.getKind() == AS) {                                                                </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 559             SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                             </span>
<span class="-1521486087941699086" onmouseenter="enter('-1521486087941699086');" onmouseout="out('-1521486087941699086');" style=""> 560             SqlNode replaceNode = replaceSelectFieldName(leftNode, replaceInfo);                         </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 561             if (replaceNode != null) {                                                                   </span>
<span class="44744548385893691" onmouseenter="enter('44744548385893691');" onmouseout="out('44744548385893691');" style=""> 562                 ((SqlBasicCall) selectNode).getOperands()[0] = replaceNode;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563             }                                                                                            </span>
<span  style=""> 564                                                                                                          </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 565             return selectNode;                                                                           </span>
<span class="-4525236033469860943" onmouseenter="enter('-4525236033469860943');" onmouseout="out('-4525236033469860943');" style=""> 566         }else if(selectNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 567             SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                    </span>
<span  style=""> 568                                                                                                          </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 569             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 570                 return selectNode;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571             }                                                                                            </span>
<span  style=""> 572                                                                                                          </span>
<span class="5152547743275588251" onmouseenter="enter('5152547743275588251');" onmouseout="out('5152547743275588251');" style=""> 573             //Same level mappingTable                                                                    </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 574             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 574             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="-6523721893364253351" onmouseenter="enter('-6523721893364253351');" onmouseout="out('-6523721893364253351');" style=""> 575             if (mappingFieldName == null) {                                                              </span>
<span class="8276130366719222706" onmouseenter="enter('8276130366719222706');" onmouseout="out('8276130366719222706');" style=""> 576                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + selectNode.toString() );    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577             }                                                                                            </span>
<span  style=""> 578                                                                                                          </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 579             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2571352877158902005" onmouseenter="enter('2571352877158902005');" onmouseout="out('2571352877158902005');" style=""> 580             sqlIdentifier = sqlIdentifier.setName(1, mappingFieldName);                                  </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 581             return sqlIdentifier;                                                                        </span>
<span class="7580774735460232339" onmouseenter="enter('7580774735460232339');" onmouseout="out('7580774735460232339');" style=""> 582         }else if(selectNode.getKind() == LITERAL || selectNode.getKind() == LITERAL_CHAIN){//字面含义        </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 583             return selectNode;                                                                           </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 584         }else if(  AGGREGATE.contains(selectNode.getKind())                                              </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 585                 || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                      </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 586                 || COMPARISON.contains(selectNode.getKind())                                             </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 587                 || selectNode.getKind() == OTHER_FUNCTION                                                </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 588                 || selectNode.getKind() == DIVIDE                                                        </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 589                 || selectNode.getKind() == CAST                                                          </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 590                 || selectNode.getKind() == TRIM                                                          </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 591                 || selectNode.getKind() == TIMES                                                         </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 592                 || selectNode.getKind() == PLUS                                                          </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 593                 || selectNode.getKind() == NOT_IN                                                        </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 594                 || selectNode.getKind() == OR                                                            </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 595                 || selectNode.getKind() == AND                                                           </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 596                 || selectNode.getKind() == MINUS                                                         </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 597                 || selectNode.getKind() == TUMBLE                                                        </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 598                 || selectNode.getKind() == TUMBLE_START                                                  </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 599                 || selectNode.getKind() == TUMBLE_END                                                    </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 600                 || selectNode.getKind() == SESSION                                                       </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 601                 || selectNode.getKind() == SESSION_START                                                 </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 602                 || selectNode.getKind() == SESSION_END                                                   </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 603                 || selectNode.getKind() == HOP                                                           </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 604                 || selectNode.getKind() == HOP_START                                                     </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 605                 || selectNode.getKind() == HOP_END                                                       </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 606                 || selectNode.getKind() == BETWEEN                                                       </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 607                 || selectNode.getKind() == IS_NULL                                                       </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 608                 || selectNode.getKind() == IS_NOT_NULL                                                   </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 609                 || selectNode.getKind() == CONTAINS                                                      </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 610                 || selectNode.getKind() == TIMESTAMP_ADD                                                 </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 611                 || selectNode.getKind() == TIMESTAMP_DIFF                                                </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 612                 || selectNode.getKind() == LIKE                                                          </span>
<span  style=""> 613                                                                                                          </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 614                 ){                                                                                       </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 615             SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                       </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 616             for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                      </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 617                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 618                 if(sqlNode instanceof SqlLiteral){                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 619                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620                 }                                                                                        </span>
<span  style=""> 621                                                                                                          </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 622                 if(sqlNode instanceof SqlDataTypeSpec){                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 623                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624                 }                                                                                        </span>
<span  style=""> 625                                                                                                          </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 626                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 627                 if(replaceNode == null){                                                                 </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 628                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629                 }                                                                                        </span>
<span  style=""> 630                                                                                                          </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 631                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632             }                                                                                            </span>
<span  style=""> 633                                                                                                          </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 634             return selectNode;                                                                           </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 635         }else if(selectNode.getKind() == CASE){                                                          </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 636             SqlCase sqlCase = (SqlCase) selectNode;                                                      </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 637             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 638             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 639             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span  style=""> 640                                                                                                          </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 641             for(int i=0; i&lt;whenOperands.size(); i++){                                                    </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 642                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 643                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 644                 if (replaceNode != null) {                                                               </span>
<span class="827753515492975605" onmouseenter="enter('827753515492975605');" onmouseout="out('827753515492975605');" style=""> 645                     whenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647             }                                                                                            </span>
<span  style=""> 648                                                                                                          </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 649             for(int i=0; i&lt;thenOperands.size(); i++){                                                    </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 650                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 651                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 652                 if (replaceNode != null) {                                                               </span>
<span class="-4947674979480974151" onmouseenter="enter('-4947674979480974151');" onmouseout="out('-4947674979480974151');" style=""> 653                     thenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655             }                                                                                            </span>
<span  style=""> 656                                                                                                          </span>
<span class="-1702904876822094161" onmouseenter="enter('-1702904876822094161');" onmouseout="out('-1702904876822094161');" style=""> 657             ((SqlCase) selectNode).setOperand(3, replaceSelectFieldName(elseNode, replaceInfo));         </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 658             return selectNode;                                                                           </span>
<span class="-6373545674230253671" onmouseenter="enter('-6373545674230253671');" onmouseout="out('-6373545674230253671');" style=""> 659         }else if(selectNode.getKind() == OTHER){                                                         </span>
<span class="-5542086300788940380" onmouseenter="enter('-5542086300788940380');" onmouseout="out('-5542086300788940380');" style=""> 660             //不处理                                                                                        </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 661             return selectNode;                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 662         }else{                                                                                           </span>
<span class="1153766920564476840" onmouseenter="enter('1153766920564476840');" onmouseout="out('1153766920564476840');" style=""><abbr title=" 663             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNode.getKind()));"> 663             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665     }                                                                                                    </span>
<span  style=""> 666                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 667     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 668      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 668      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 669      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 670      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 671      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 672     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 672     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 673         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 674         if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 675             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 677         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678     }                                                                                                    </span>
<span  style=""> 679                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 680     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 681         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 682         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 683             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 684         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 685         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686     }                                                                                                    </span>
<span  style=""> 687                                                                                                          </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 688     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 688     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 689         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 690         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 691         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 692         for(SqlNode sqlNode : sqlNodeList){                                                              </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 693             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 694                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695             }                                                                                            </span>
<span  style=""> 696                                                                                                          </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 697             SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 698             SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];               </span>
<span  style=""> 699                                                                                                          </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 700             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 701             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span  style=""> 702                                                                                                          </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 703             String tableCol = &quot;&quot;;                                                                        </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 704             if(leftTableName.equalsIgnoreCase(specifyTableName)){                                        </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 705                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 706             }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                 </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 707                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 708             }else{                                                                                       </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 709                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 709                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 711             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 712             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713         }                                                                                                </span>
<span  style=""> 714                                                                                                          </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 715         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716     }                                                                                                    </span>
<span  style=""> 717                                                                                                          </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 718     protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                    </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 719                                      SqlNode pollSqlNode,                                                </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 720                                      Map&lt;String, Table&gt; tableCache,                                      </span>
<span class="-3293670501905922467" onmouseenter="enter('-3293670501905922467');" onmouseout="out('-3293670501905922467');" style=""> 721                                      List&lt;FieldReplaceInfo&gt; replaceInfoList) throws SqlParseException {  </span>
<span  style=""> 722                                                                                                          </span>
<span class="7772412594103241573" onmouseenter="enter('7772412594103241573');" onmouseout="out('7772412594103241573');" style=""> 723         AliasInfo aliasInfo = parseAsNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 724         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 725             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726         }                                                                                                </span>
<span  style=""> 727                                                                                                          </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 728         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 729         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 730         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span  style=""> 731                                                                                                          </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 732         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span  style=""> 733                                                                                                          </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 734         FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);        </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 735         if(fieldReplaceInfo == null){                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 736            return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737         }                                                                                                </span>
<span  style=""> 738                                                                                                          </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 739         //as 的源表                                                                                         </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 740         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 741         SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                 </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 742         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 743         for(FieldReplaceInfo tmp : replaceInfoList){                                                     </span>
<span class="7807393280391431617" onmouseenter="enter('7807393280391431617');" onmouseout="out('7807393280391431617');" style=""> 744             if(fromTableNameSet.contains(tmp.getTargetTableName())                                       </span>
<span class="-8987246733617074829" onmouseenter="enter('-8987246733617074829');" onmouseout="out('-8987246733617074829');" style=""> 745                     || fromTableNameSet.contains(tmp.getTargetTableAlias())){                            </span>
<span class="-8130963267335023429" onmouseenter="enter('-8130963267335023429');" onmouseout="out('-8130963267335023429');" style=""> 746                 fieldReplaceInfo.setPreNode(tmp);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 747                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749         }                                                                                                </span>
<span class="2047826278835391080" onmouseenter="enter('2047826278835391080');" onmouseout="out('2047826278835391080');" style=""> 750         replaceInfoList.add(fieldReplaceInfo);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751     }                                                                                                    </span>
<span  style=""> 752                                                                                                          </span>
<span class="4197581530070317287" onmouseenter="enter('4197581530070317287');" onmouseout="out('4197581530070317287');" style=""> 753     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache,                             </span>
<span class="-7423850058561480692" onmouseenter="enter('-7423850058561480692');" onmouseout="out('-7423850058561480692');" style=""><abbr title=" 754                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,"> 754                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv🔵</abbr></span>
<span class="-2956355081691304387" onmouseenter="enter('-2956355081691304387');" onmouseout="out('-2956355081691304387');" style=""> 755                          List&lt;FieldReplaceInfo&gt; replaceInfoList) throws Exception{                       </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 756         JoinInfo joinInfo = (JoinInfo) pollObj;                                                          </span>
<span  style=""> 757                                                                                                          </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 758         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 759         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 760         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 761         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span  style=""> 762                                                                                                          </span>
<span class="-3105793890099317611" onmouseenter="enter('-3105793890099317611');" onmouseout="out('-3105793890099317611');" style=""> 763         SqlKind sqlKind = joinInfo.getLeftNode().getKind();                                              </span>
<span class="9064898697795185402" onmouseenter="enter('9064898697795185402');" onmouseout="out('9064898697795185402');" style=""> 764         if(sqlKind == AS){                                                                               </span>
<span class="17281975900406720" onmouseenter="enter('17281975900406720');" onmouseout="out('17281975900406720');" style=""> 765             dealAsSourceTable(tableEnv, joinInfo.getLeftNode(), localTableCache, replaceInfoList);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766         }                                                                                                </span>
<span  style=""> 767                                                                                                          </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 768         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 768         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span  style=""> 769                                                                                                          </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 770         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 770         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 771         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span  style=""> 772                                                                                                          </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 773         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 774         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 775         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 776         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 777         if(sideTableInfo == null){                                                                       </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 778             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779         }                                                                                                </span>
<span  style=""> 780                                                                                                          </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 781         if(sideTableInfo == null){                                                                       </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 782             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783         }                                                                                                </span>
<span  style=""> 784                                                                                                          </span>
<span class="6668906180521634363" onmouseenter="enter('6668906180521634363');" onmouseout="out('6668906180521634363');" style=""> 785 //        if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){</span>
<span class="2570085130586631416" onmouseenter="enter('2570085130586631416');" onmouseout="out('2570085130586631416');" style=""> 786 //            throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);               </span>
<span class="-7859020312693891120" onmouseenter="enter('-7859020312693891120');" onmouseout="out('-7859020312693891120');" style=""> 787 //        }                                                                                              </span>
<span  style=""> 788                                                                                                          </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 789         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span  style=""> 790                                                                                                          </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 791         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 792         joinScope.addScope(rightScopeChild);                                                             </span>
<span  style=""> 793                                                                                                          </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 794         //获取两个表的所有字段                                                                                     </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 795         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 795         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span  style=""> 796                                                                                                          </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 797         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 798         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 799         if(targetTable == null){                                                                         </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 800             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801         }                                                                                                </span>
<span  style=""> 802                                                                                                          </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 803         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 803         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span  style=""> 804                                                                                                          </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 805         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span  style=""> 806                                                                                                          </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 807         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 808         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 809             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 809             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 810             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 811             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 812             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 812             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813         }                                                                                                </span>
<span  style=""> 814                                                                                                          </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 815         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 816         if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                        </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 817             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 817             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 818         }else{                                                                                           </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 819             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 819             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820         }                                                                                                </span>
<span  style=""> 821                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 822         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 823         RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);              </span>
<span  style=""> 824                                                                                                          </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 825         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 826         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span  style=""> 827                                                                                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 828         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 829         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span  style=""> 830                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 831         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 832         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 833         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 834         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span  style=""> 835                                                                                                          </span>
<span class="-3207655655806857927" onmouseenter="enter('-3207655655806857927');" onmouseout="out('-3207655655806857927');" style=""> 836         //判断之前是不是被替换过,被替换过则设置之前的替换信息作为上一个节点                                                              </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 837         for(FieldReplaceInfo tmp : replaceInfoList){                                                     </span>
<span class="6967693276121741260" onmouseenter="enter('6967693276121741260');" onmouseout="out('6967693276121741260');" style=""> 838             if(tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName())                    </span>
<span class="8344413733256472211" onmouseenter="enter('8344413733256472211');" onmouseout="out('8344413733256472211');" style=""> 839             ||tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableAlias())){                  </span>
<span class="-1629804985910745096" onmouseenter="enter('-1629804985910745096');" onmouseout="out('-1629804985910745096');" style=""> 840                 replaceInfo.setPreNode(tmp);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 841                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843         }                                                                                                </span>
<span  style=""> 844                                                                                                          </span>
<span class="2528453225163613561" onmouseenter="enter('2528453225163613561');" onmouseout="out('2528453225163613561');" style=""> 845         replaceInfoList.add(replaceInfo);                                                                </span>
<span  style=""> 846                                                                                                          </span>
<span class="6259278273454558932" onmouseenter="enter('6259278273454558932');" onmouseout="out('6259278273454558932');" style=""> 847         List&lt;String&gt; registeredTableName = Arrays.asList(tableEnv.listTables());                         </span>
<span class="6143756220473458570" onmouseenter="enter('6143756220473458570');" onmouseout="out('6143756220473458570');" style=""> 848         if (!registeredTableName.contains(joinInfo.getNewTableName())){                                  </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 849             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="-7674974637599312088" onmouseenter="enter('-7674974637599312088');" onmouseout="out('-7674974637599312088');" style=""> 850             tableEnv.registerTable(joinInfo.getNewTableName(), joinTable);                               </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 851             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853     }                                                                                                    </span>
<span  style=""> 854                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 855     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 856         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 857         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span  style=""> 858                                                                                                          </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""><abbr title=" 859         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);"> 859         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::ne🔵</abbr></span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 860         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 860         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(Typ🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 861         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862     }                                                                                                    </span>
<span  style=""> 863                                                                                                          </span>
<span  style=""> 864                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 865     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 866         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 867         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 868         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 869         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 870             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style=""> 871             if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 872                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 873             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 874                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 875                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 876                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 877                 fieldNames.add(fieldName);                                                               </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 878                 String fieldType = filed[filed.length - 1 ].trim();                                      </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 879                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 880                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 881                 if (fieldClass == tableField){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 882                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 883                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 884                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 885                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 888         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 889         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890     }                                                                                                    </span>
<span  style=""> 891                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  22                                                                                                          </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  23 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  24 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  25 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  26 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  27 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  28 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  29 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  30 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  31 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  32 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  33 import org.apache.flink.types.Row;                                                                       </span>
<span  style="">  34                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  35 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  36 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  37 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  38 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  39 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  40 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  41 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  42 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  43 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  44 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  45 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  46 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  47 import com.google.common.collect.Sets;                                                                   </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  48 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  49 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  50 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  51 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  52 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  53 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  54 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  55 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  56 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  57 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  58 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  59 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  60 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  61 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  62 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  63 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  64 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  65 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  66 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  67 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  68 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  69                                                                                                          </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  70 import java.sql.Timestamp;                                                                               </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  71 import java.time.LocalDateTime;                                                                          </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  72 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  73 import java.util.Collection;                                                                             </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  74 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  75 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  76 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  77 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  78 import java.util.Set;                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  80 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  81                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  83  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  84  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  85  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  86  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87  */                                                                                                      </span>
<span  style="">  88                                                                                                          </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  89 public class SideSqlExec {                                                                               </span>
<span  style="">  90                                                                                                          </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  91     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  92                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  93     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  94                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  95     private String tmpFields = null;                                                                     </span>
<span  style="">  96                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  97     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  98                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  99     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style=""> 100                                                                                                          </span>
<span class="-2568962717532337416" onmouseenter="enter('-2568962717532337416');" onmouseout="out('-2568962717532337416');" style=""><abbr title=" 101     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,"> 101     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment 🔵</abbr></span>
<span class="85465325218630864" onmouseenter="enter('85465325218630864');" onmouseout="out('85465325218630864');" style=""><abbr title=" 102                      Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) throws Exception {"> 102                      Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) thro🔵</abbr></span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style=""> 103         if(localSqlPluginPath == null){                                                                  </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style=""> 104             throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 107         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 108         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 109             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 110         } catch (Exception e) {                                                                          </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 111             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span  style=""> 113                                                                                                          </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style=""> 114         if(createView != null){                                                                          </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 115             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 116             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 117             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span  style=""> 119                                                                                                          </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 120         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 121         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="-1577132173025596093" onmouseenter="enter('-1577132173025596093');" onmouseout="out('-1577132173025596093');" style=""> 122         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet());                  </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 123         Object pollObj = null;                                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="6779353451040372641" onmouseenter="enter('6779353451040372641');" onmouseout="out('6779353451040372641');" style=""> 125         //need clean                                                                                     </span>
<span class="4055483294687718975" onmouseenter="enter('4055483294687718975');" onmouseout="out('4055483294687718975');" style=""> 126         boolean preIsSideJoin = false;                                                                   </span>
<span class="2266898631888830275" onmouseenter="enter('2266898631888830275');" onmouseout="out('2266898631888830275');" style=""> 127         List&lt;FieldReplaceInfo&gt; replaceInfoList = Lists.newArrayList();                                   </span>
<span  style=""> 128                                                                                                          </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 129         while((pollObj = exeQueue.poll()) != null){                                                      </span>
<span  style=""> 130                                                                                                          </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 131             if(pollObj instanceof SqlNode){                                                              </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 132                 SqlNode pollSqlNode = (SqlNode) pollObj;                                                 </span>
<span  style=""> 133                                                                                                          </span>
<span class="-3934441269421991372" onmouseenter="enter('-3934441269421991372');" onmouseout="out('-3934441269421991372');" style=""> 134                 if(preIsSideJoin){                                                                       </span>
<span class="313285673257348059" onmouseenter="enter('313285673257348059');" onmouseout="out('313285673257348059');" style=""> 135                     preIsSideJoin = false;                                                               </span>
<span class="-2618061440979010579" onmouseenter="enter('-2618061440979010579');" onmouseout="out('-2618061440979010579');" style=""> 136                     List&lt;String&gt; fieldNames = null;                                                      </span>
<span class="-7322309591596780027" onmouseenter="enter('-7322309591596780027');" onmouseout="out('-7322309591596780027');" style=""> 137                     for(FieldReplaceInfo replaceInfo : replaceInfoList){                                 </span>
<span class="2418913985965727773" onmouseenter="enter('2418913985965727773');" onmouseout="out('2418913985965727773');" style=""> 138                         fieldNames = Lists.newArrayList();                                               </span>
<span class="-6690427821834278824" onmouseenter="enter('-6690427821834278824');" onmouseout="out('-6690427821834278824');" style=""> 139                         replaceFieldName(pollSqlNode, replaceInfo);                                      </span>
<span class="8246822691580888265" onmouseenter="enter('8246822691580888265');" onmouseout="out('8246822691580888265');" style=""> 140                         addAliasForFieldNode(pollSqlNode, fieldNames, replaceInfo.getMappingTable());    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span  style=""> 143                                                                                                          </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 144                 if(pollSqlNode.getKind() == INSERT){                                                     </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 145 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146                     System.out.println(&quot;----------real exec sql-----------&quot; );                           </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147                     System.out.println(pollSqlNode.toString());                                          </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 149 ||||||| BASE                                                                                             </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                     System.out.println(&quot;----------real exec sql-----------&quot; );                           </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                     System.out.println(pollSqlNode.toString());                                          </span>
<span class="-7041171683301857607" onmouseenter="enter('-7041171683301857607');" onmouseout="out('-7041171683301857607');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString(), queryConfig);               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 153 =======                                                                                                  </span>
<span class="-7041171683301857607" onmouseenter="enter('-7041171683301857607');" onmouseout="out('-7041171683301857607');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString(), queryConfig);               </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 155 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 156                     if(LOG.isInfoEnabled()){                                                             </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 157                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                     }                                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 160                 }else if(pollSqlNode.getKind() == AS){                                                   </span>
<span class="-4906327517343466594" onmouseenter="enter('-4906327517343466594');" onmouseout="out('-4906327517343466594');" style=""> 161                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache, replaceInfoList);               </span>
<span  style=""> 162                                                                                                          </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 163                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 164                     SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                 </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 165                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 166                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 167                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span  style=""> 168                                                                                                          </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 169                 } else if (pollSqlNode.getKind() == SELECT){                                             </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 170                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 170                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 171                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span  style=""> 172                                                                                                          </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 173                     if (createView.getFieldsInfoStr() == null){                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 174                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 175                     } else {                                                                             </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 176                         if (checkFieldsInfo(createView, table)){                                         </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 177                             table = table.as(tmpFields);                                                 </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 178                             tableEnv.registerTable(createView.getTableName(), table);                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 179                         } else {                                                                         </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 180                             throw new RuntimeException(&quot;Fields mismatch&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                     }                                                                                    </span>
<span  style=""> 183                                                                                                          </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 184                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                 }                                                                                        </span>
<span  style=""> 186                                                                                                          </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 187             }else if (pollObj instanceof JoinInfo){                                                      </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 188                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-4508108017455823844" onmouseenter="enter('-4508108017455823844');" onmouseout="out('-4508108017455823844');" style=""> 189                 preIsSideJoin = true;                                                                    </span>
<span class="-9158044292308775618" onmouseenter="enter('-9158044292308775618');" onmouseout="out('-9158044292308775618');" style=""> 190                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv, replaceInfoList);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span  style=""> 196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 198      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 199      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 200      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 201      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 202      */                                                                                                  </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 203     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){        </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 204         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 205         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span  style=""> 206                                                                                                          </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 207         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 208         if(infoKind != SELECT){                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 209             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 212         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);   </span>
<span  style=""> 213                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 214         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 215         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 216             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 217             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 218             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 219             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span  style=""> 221                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 222         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 223         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 224         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 225         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 226         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span  style=""> 228                                                                                                          </span>
<span  style=""> 229                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 230     /**                                                                                                  </span>
<span class="-3820374652196669145" onmouseenter="enter('-3820374652196669145');" onmouseout="out('-3820374652196669145');" style=""> 231      * 添加字段别名                                                                                            </span>
<span class="9038438555178000204" onmouseenter="enter('9038438555178000204');" onmouseout="out('9038438555178000204');" style=""> 232      * @param pollSqlNode                                                                                </span>
<span class="-5133777749030939729" onmouseenter="enter('-5133777749030939729');" onmouseout="out('-5133777749030939729');" style=""> 233      * @param fieldList                                                                                  </span>
<span class="-2002961180008195570" onmouseenter="enter('-2002961180008195570');" onmouseout="out('-2002961180008195570');" style=""> 234      * @param mappingTable                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 235      */                                                                                                  </span>
<span class="-3955444104111901697" onmouseenter="enter('-3955444104111901697');" onmouseout="out('-3955444104111901697');" style=""><abbr title=" 236     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 236     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String,🔵</abbr></span>
<span class="-663927235385144722" onmouseenter="enter('-663927235385144722');" onmouseout="out('-663927235385144722');" style=""> 237         SqlKind sqlKind = pollSqlNode.getKind();                                                         </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 238         switch (sqlKind) {                                                                               </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 239             case INSERT:                                                                                 </span>
<span class="-3657774864843651643" onmouseenter="enter('-3657774864843651643');" onmouseout="out('-3657774864843651643');" style=""> 240                 SqlNode source = ((SqlInsert) pollSqlNode).getSource();                                  </span>
<span class="6134982029327154291" onmouseenter="enter('6134982029327154291');" onmouseout="out('6134982029327154291');" style=""> 241                 addAliasForFieldNode(source, fieldList, mappingTable);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 242                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 243             case AS:                                                                                     </span>
<span class="-6853425371672212621" onmouseenter="enter('-6853425371672212621');" onmouseout="out('-6853425371672212621');" style=""><abbr title=" 244                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTable);"> 244                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTab🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 245                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 246             case SELECT:                                                                                 </span>
<span class="-345466278028982068" onmouseenter="enter('-345466278028982068');" onmouseout="out('-345466278028982068');" style=""> 247                 SqlNodeList selectList = ((SqlSelect) pollSqlNode).getSelectList();                      </span>
<span class="-4478316650227403681" onmouseenter="enter('-4478316650227403681');" onmouseout="out('-4478316650227403681');" style=""> 248                 selectList.getList().forEach(node -&gt; {                                                   </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 249                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 250                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 251                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 252                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                         }                                                                                </span>
<span class="-4986679521926317286" onmouseenter="enter('-4986679521926317286');" onmouseout="out('-4986679521926317286');" style=""> 254                         // save real field                                                               </span>
<span class="2742839839262283647" onmouseenter="enter('2742839839262283647');" onmouseout="out('2742839839262283647');" style=""> 255                         String fieldName = sqlIdentifier.names.get(1);                                   </span>
<span class="-5921041769209732806" onmouseenter="enter('-5921041769209732806');" onmouseout="out('-5921041769209732806');" style=""><abbr title=" 256                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().containsKey(fieldName)) {"> 256                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap🔵</abbr></span>
<span class="-2287024865944183458" onmouseenter="enter('-2287024865944183458');" onmouseout="out('-2287024865944183458');" style=""> 257                             fieldList.add(fieldName);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258                         }                                                                                </span>
<span  style=""> 259                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 261                 });                                                                                      </span>
<span class="-8923237898045704845" onmouseenter="enter('-8923237898045704845');" onmouseout="out('-8923237898045704845');" style=""> 262                 for (int i = 0; i &lt; selectList.getList().size(); i++) {                                  </span>
<span class="-4321294484021988020" onmouseenter="enter('-4321294484021988020');" onmouseout="out('-4321294484021988020');" style=""> 263                     SqlNode node = selectList.get(i);                                                    </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 264                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 265                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 266                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 267                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268                         }                                                                                </span>
<span class="-170655463018543442" onmouseenter="enter('-170655463018543442');" onmouseout="out('-170655463018543442');" style=""> 269                         String name = sqlIdentifier.names.get(1);                                        </span>
<span class="-3204699988614579440" onmouseenter="enter('-3204699988614579440');" onmouseout="out('-3204699988614579440');" style=""> 270                         // avoid real field pv0 convert pv                                               </span>
<span class="6166166284113505247" onmouseenter="enter('6166166284113505247');" onmouseout="out('6166166284113505247');" style=""><abbr title=" 271                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring(0, name.length() - 1))) {"> 271                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.🔵</abbr></span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 272                             SqlOperator operator = new SqlAsOperator();                                  </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 273                             SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                          </span>
<span  style=""> 274                                                                                                          </span>
<span class="-2138283127011244558" onmouseenter="enter('-2138283127011244558');" onmouseout="out('-2138283127011244558');" style=""><abbr title=" 275                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() - 1), null, sqlParserPos);"> 275                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.l🔵</abbr></span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 276                             SqlNode[] sqlNodes = new SqlNode[2];                                         </span>
<span class="-2939555014928254235" onmouseenter="enter('-2939555014928254235');" onmouseout="out('-2939555014928254235');" style=""> 277                             sqlNodes[0] = sqlIdentifier;                                                 </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 278                             sqlNodes[1] = sqlIdentifierAlias;                                            </span>
<span class="172920197577317623" onmouseenter="enter('172920197577317623');" onmouseout="out('172920197577317623');" style=""><abbr title=" 279                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos);"> 279                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos🔵</abbr></span>
<span  style=""> 280                                                                                                          </span>
<span class="-6513758114426947797" onmouseenter="enter('-6513758114426947797');" onmouseout="out('-6513758114426947797');" style=""> 281                             selectList.set(i, sqlBasicCall);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 285                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 286             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 287                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span  style=""> 290                                                                                                          </span>
<span  style=""> 291                                                                                                          </span>
<span class="3897594848566528823" onmouseenter="enter('3897594848566528823');" onmouseout="out('3897594848566528823');" style=""> 292     public AliasInfo parseAsNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 293         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 294         if(sqlKind != AS){                                                                               </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 295             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span  style=""> 297                                                                                                          </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 298         SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                         </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 299         SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                       </span>
<span  style=""> 300                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 301         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 302         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 303         aliasInfo.setAlias(alias.toString());                                                            </span>
<span  style=""> 304                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 305         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="-8689302297966137516" onmouseenter="enter('-8689302297966137516');" onmouseout="out('-8689302297966137516');" style=""><abbr title=" 308     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 308     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, Stri🔵</abbr></span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 309         TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                  </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 310         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 311         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 312             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 313             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 314             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 315             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 316             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 318             sideOutTypes[i] = fieldInfo.getTypeInformation();                                            </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 319             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 321         return new RowTypeInfo(sideOutTypes, sideOutNames);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322     }                                                                                                    </span>
<span  style=""> 323                                                                                                          </span>
<span  style=""> 324                                                                                                          </span>
<span  style=""> 325                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 326     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 327         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 328             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 330         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331     }                                                                                                    </span>
<span  style=""> 332                                                                                                          </span>
<span class="4184261108342886546" onmouseenter="enter('4184261108342886546');" onmouseout="out('4184261108342886546');" style=""> 333     //需要考虑更多的情况                                                                                          </span>
<span class="-5866348515582828073" onmouseenter="enter('-5866348515582828073');" onmouseout="out('-5866348515582828073');" style=""> 334     private void replaceFieldName(SqlNode sqlNode, FieldReplaceInfo replaceInfo) {                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 335         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 336         switch (sqlKind) {                                                                               </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 337             case INSERT:                                                                                 </span>
<span class="1507566640229528779" onmouseenter="enter('1507566640229528779');" onmouseout="out('1507566640229528779');" style=""> 338                 SqlNode sqlSource = ((SqlInsert) sqlNode).getSource();                                   </span>
<span class="3539579188210716047" onmouseenter="enter('3539579188210716047');" onmouseout="out('3539579188210716047');" style=""> 339                 replaceFieldName(sqlSource, replaceInfo);                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 340                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 341             case AS:                                                                                     </span>
<span class="-2471580703701460163" onmouseenter="enter('-2471580703701460163');" onmouseout="out('-2471580703701460163');" style=""> 342                 SqlNode asNode = ((SqlBasicCall) sqlNode).getOperands()[0];                              </span>
<span class="2382936847570265491" onmouseenter="enter('2382936847570265491');" onmouseout="out('2382936847570265491');" style=""> 343                 replaceFieldName(asNode, replaceInfo);                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 344                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 345             case SELECT:                                                                                 </span>
<span class="7730902652365827282" onmouseenter="enter('7730902652365827282');" onmouseout="out('7730902652365827282');" style=""><abbr title=" 346                 SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName());"> 346                 SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTarget🔵</abbr></span>
<span class="-1465070514376240276" onmouseenter="enter('-1465070514376240276');" onmouseout="out('-1465070514376240276');" style=""> 347                 if(sqlSelect == null){                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 348                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349                 }                                                                                        </span>
<span  style=""> 350                                                                                                          </span>
<span class="-7911431356156617515" onmouseenter="enter('-7911431356156617515');" onmouseout="out('-7911431356156617515');" style=""> 351                 SqlNode sqlSource1 = sqlSelect.getFrom();                                                </span>
<span class="-4060139958118865814" onmouseenter="enter('-4060139958118865814');" onmouseout="out('-4060139958118865814');" style=""> 352                 if(sqlSource1.getKind() == AS){                                                          </span>
<span class="7708153722582291408" onmouseenter="enter('7708153722582291408');" onmouseout="out('7708153722582291408');" style=""> 353                     String tableName = ((SqlBasicCall)sqlSource1).getOperands()[0].toString();           </span>
<span class="-7976662112993336650" onmouseenter="enter('-7976662112993336650');" onmouseout="out('-7976662112993336650');" style=""> 354                     if(tableName.equalsIgnoreCase(replaceInfo.getTargetTableName())){                    </span>
<span class="5036423329776629809" onmouseenter="enter('5036423329776629809');" onmouseout="out('5036423329776629809');" style=""> 355                         SqlNodeList sqlSelectList = sqlSelect.getSelectList();                           </span>
<span class="4783458191183529265" onmouseenter="enter('4783458191183529265');" onmouseout="out('4783458191183529265');" style=""> 356                         SqlNode whereNode = sqlSelect.getWhere();                                        </span>
<span class="6069356713975423578" onmouseenter="enter('6069356713975423578');" onmouseout="out('6069356713975423578');" style=""> 357                         SqlNodeList sqlGroup = sqlSelect.getGroup();                                     </span>
<span  style=""> 358                                                                                                          </span>
<span class="2024933395694494313" onmouseenter="enter('2024933395694494313');" onmouseout="out('2024933395694494313');" style=""> 359                         //TODO 暂时不处理having                                                               </span>
<span class="-2928778695763881832" onmouseenter="enter('-2928778695763881832');" onmouseout="out('-2928778695763881832');" style=""> 360                         SqlNode sqlHaving = sqlSelect.getHaving();                                       </span>
<span  style=""> 361                                                                                                          </span>
<span class="-3614471078991347107" onmouseenter="enter('-3614471078991347107');" onmouseout="out('-3614471078991347107');" style=""> 362                         List&lt;SqlNode&gt; newSelectNodeList = Lists.newArrayList();                          </span>
<span class="4525830429471113267" onmouseenter="enter('4525830429471113267');" onmouseout="out('4525830429471113267');" style=""> 363                         for( int i=0; i&lt;sqlSelectList.getList().size(); i++){                            </span>
<span class="295237348129218365" onmouseenter="enter('295237348129218365');" onmouseout="out('295237348129218365');" style=""> 364                             SqlNode selectNode = sqlSelectList.getList().get(i);                         </span>
<span class="3005939127677060655" onmouseenter="enter('3005939127677060655');" onmouseout="out('3005939127677060655');" style=""> 365                             //特殊处理 isStar的标识                                                             </span>
<span class="-7362933676269921614" onmouseenter="enter('-7362933676269921614');" onmouseout="out('-7362933676269921614');" style=""><abbr title=" 366                             if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar()){"> 366                             if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar(🔵</abbr></span>
<span class="1426748103918852649" onmouseenter="enter('1426748103918852649');" onmouseout="out('1426748103918852649');" style=""><abbr title=" 367                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo);"> 367                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, re🔵</abbr></span>
<span class="-936038636053459659" onmouseenter="enter('-936038636053459659');" onmouseout="out('-936038636053459659');" style=""> 368                                 newSelectNodeList.addAll(replaceNodeList);                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 369                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370                             }                                                                            </span>
<span  style=""> 371                                                                                                          </span>
<span class="3570575360626670937" onmouseenter="enter('3570575360626670937');" onmouseout="out('3570575360626670937');" style=""> 372                             SqlNode replaceNode = replaceSelectFieldName(selectNode, replaceInfo);       </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 373                             if(replaceNode == null){                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 374                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375                             }                                                                            </span>
<span  style=""> 376                                                                                                          </span>
<span class="-2861561298429904330" onmouseenter="enter('-2861561298429904330');" onmouseout="out('-2861561298429904330');" style=""> 377                             //sqlSelectList.set(i, replaceNode);                                         </span>
<span class="1157087708345012360" onmouseenter="enter('1157087708345012360');" onmouseout="out('1157087708345012360');" style=""> 378                             newSelectNodeList.add(replaceNode);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379                         }                                                                                </span>
<span  style=""> 380                                                                                                          </span>
<span class="3723543992832155466" onmouseenter="enter('3723543992832155466');" onmouseout="out('3723543992832155466');" style=""><abbr title=" 381                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosition());"> 381                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getP🔵</abbr></span>
<span class="-8903961717282297850" onmouseenter="enter('-8903961717282297850');" onmouseout="out('-8903961717282297850');" style=""> 382                         sqlSelect.setSelectList(newSelectList);                                          </span>
<span  style=""> 383                                                                                                          </span>
<span class="-47820880813073829" onmouseenter="enter('-47820880813073829');" onmouseout="out('-47820880813073829');" style=""> 384                         //where                                                                          </span>
<span class="-2977999434516732521" onmouseenter="enter('-2977999434516732521');" onmouseout="out('-2977999434516732521');" style=""> 385                         if(whereNode != null){                                                           </span>
<span class="5185992084008387135" onmouseenter="enter('5185992084008387135');" onmouseout="out('5185992084008387135');" style=""> 386                             SqlNode[] sqlNodeList = ((SqlBasicCall)whereNode).getOperands();             </span>
<span class="3961659355684503168" onmouseenter="enter('3961659355684503168');" onmouseout="out('3961659355684503168');" style=""> 387                             for(int i =0; i&lt;sqlNodeList.length; i++) {                                   </span>
<span class="2172750173548984826" onmouseenter="enter('2172750173548984826');" onmouseout="out('2172750173548984826');" style=""> 388                                 SqlNode whereSqlNode = sqlNodeList[i];                                   </span>
<span class="-4477047106175359937" onmouseenter="enter('-4477047106175359937');" onmouseout="out('-4477047106175359937');" style=""> 389                                 SqlNode replaceNode = replaceNodeInfo(whereSqlNode, replaceInfo);        </span>
<span class="-1237302974526763563" onmouseenter="enter('-1237302974526763563');" onmouseout="out('-1237302974526763563');" style=""> 390                                 sqlNodeList[i] = replaceNode;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392                         }                                                                                </span>
<span class="6298777632396279516" onmouseenter="enter('6298777632396279516');" onmouseout="out('6298777632396279516');" style=""> 393                         if(sqlGroup != null &amp;&amp; CollectionUtils.isNotEmpty(sqlGroup.getList())){          </span>
<span class="-8564058694678267080" onmouseenter="enter('-8564058694678267080');" onmouseout="out('-8564058694678267080');" style=""> 394                             for( int i=0; i&lt;sqlGroup.getList().size(); i++){                             </span>
<span class="1364213940272952273" onmouseenter="enter('1364213940272952273');" onmouseout="out('1364213940272952273');" style=""> 395                                 SqlNode selectNode = sqlGroup.getList().get(i);                          </span>
<span class="3578364850198173029" onmouseenter="enter('3578364850198173029');" onmouseout="out('3578364850198173029');" style=""> 396                                 SqlNode replaceNode = replaceNodeInfo(selectNode, replaceInfo);          </span>
<span class="5715423325454336801" onmouseenter="enter('5715423325454336801');" onmouseout="out('5715423325454336801');" style=""> 397                                 sqlGroup.set(i, replaceNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 401                 }else{                                                                                   </span>
<span class="7951951008096051242" onmouseenter="enter('7951951008096051242');" onmouseout="out('7951951008096051242');" style=""> 402                     throw new RuntimeException(&quot;---not deal type:&quot; + sqlNode);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403                 }                                                                                        </span>
<span  style=""> 404                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 405                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 406             case UNION:                                                                                  </span>
<span class="-8185525423233229369" onmouseenter="enter('-8185525423233229369');" onmouseout="out('-8185525423233229369');" style=""> 407                 SqlNode unionLeft = ((SqlBasicCall) sqlNode).getOperands()[0];                           </span>
<span class="3590878486653773103" onmouseenter="enter('3590878486653773103');" onmouseout="out('3590878486653773103');" style=""> 408                 SqlNode unionRight = ((SqlBasicCall) sqlNode).getOperands()[1];                          </span>
<span class="12832057540049012" onmouseenter="enter('12832057540049012');" onmouseout="out('12832057540049012');" style=""> 409                 replaceFieldName(unionLeft, replaceInfo);                                                </span>
<span class="-8236931260571053140" onmouseenter="enter('-8236931260571053140');" onmouseout="out('-8236931260571053140');" style=""> 410                 replaceFieldName(unionRight, replaceInfo);                                               </span>
<span  style=""> 411                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 412                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 413             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 414                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="6726911406523213581" onmouseenter="enter('6726911406523213581');" onmouseout="out('6726911406523213581');" style=""> 415                 replaceFieldName(sqlOrderBy.query, replaceInfo);                                         </span>
<span class="-1619723091747707804" onmouseenter="enter('-1619723091747707804');" onmouseout="out('-1619723091747707804');" style=""> 416                 SqlNodeList orderFiledList = sqlOrderBy.orderList;                                       </span>
<span class="-5416337846474747128" onmouseenter="enter('-5416337846474747128');" onmouseout="out('-5416337846474747128');" style=""> 417                 for (int i=0 ;i&lt;orderFiledList.size();i++) {                                             </span>
<span class="3598769397463403835" onmouseenter="enter('3598769397463403835');" onmouseout="out('3598769397463403835');" style=""><abbr title=" 418                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTableAlias());"> 418                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getT🔵</abbr></span>
<span class="-1288993483926023903" onmouseenter="enter('-1288993483926023903');" onmouseout="out('-1288993483926023903');" style=""> 419                     orderFiledList.set(i, replaceNode);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420                 }                                                                                        </span>
<span  style=""> 421                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 422             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 423                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425     }                                                                                                    </span>
<span  style=""> 426                                                                                                          </span>
<span class="-4529709500477233937" onmouseenter="enter('-4529709500477233937');" onmouseout="out('-4529709500477233937');" style=""> 427     private SqlNode replaceOrderByTableName(SqlNode orderNode, String tableAlias) {                      </span>
<span class="-8843072586907859237" onmouseenter="enter('-8843072586907859237');" onmouseout="out('-8843072586907859237');" style=""> 428         if(orderNode.getKind() == IDENTIFIER){                                                           </span>
<span class="1286019212722079849" onmouseenter="enter('1286019212722079849');" onmouseout="out('1286019212722079849');" style=""> 429             SqlIdentifier sqlIdentifier = (SqlIdentifier) orderNode;                                     </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 430             if (sqlIdentifier.names.size() == 1) {                                                       </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 431                 return orderNode;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432             }                                                                                            </span>
<span class="4987076328947336547" onmouseenter="enter('4987076328947336547');" onmouseout="out('4987076328947336547');" style=""> 433             return sqlIdentifier.setName(0, tableAlias);                                                 </span>
<span class="6164370744345420381" onmouseenter="enter('6164370744345420381');" onmouseout="out('6164370744345420381');" style=""> 434         } else if (orderNode instanceof  SqlBasicCall) {                                                 </span>
<span class="4197878478620092735" onmouseenter="enter('4197878478620092735');" onmouseout="out('4197878478620092735');" style=""> 435             SqlBasicCall sqlBasicCall = (SqlBasicCall) orderNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 436             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 437                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="-7345169450449378118" onmouseenter="enter('-7345169450449378118');" onmouseout="out('-7345169450449378118');" style=""> 438                 sqlBasicCall.getOperands()[i] = replaceOrderByTableName(sqlNode , tableAlias);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439             }                                                                                            </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 440             return sqlBasicCall;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 441         } else {                                                                                         </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 442             return orderNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="4620342074554351588" onmouseenter="enter('4620342074554351588');" onmouseout="out('4620342074554351588');" style=""> 446     private SqlNode replaceNodeInfo(SqlNode groupNode, FieldReplaceInfo replaceInfo){                    </span>
<span class="-8006552962557562934" onmouseenter="enter('-8006552962557562934');" onmouseout="out('-8006552962557562934');" style=""> 447         if(groupNode.getKind() == IDENTIFIER){                                                           </span>
<span class="3769318911409416973" onmouseenter="enter('3769318911409416973');" onmouseout="out('3769318911409416973');" style=""> 448             SqlIdentifier sqlIdentifier = (SqlIdentifier) groupNode;                                     </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 449             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 450                 return sqlIdentifier;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451             }                                                                                            </span>
<span  style=""> 452                                                                                                          </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 453             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 453             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="1289832806545417263" onmouseenter="enter('1289832806545417263');" onmouseout="out('1289832806545417263');" style=""> 454             if(mappingFieldName == null){                                                                </span>
<span class="-3862759337385230883" onmouseenter="enter('-3862759337385230883');" onmouseout="out('-3862759337385230883');" style=""> 455                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + sqlIdentifier.toString() ); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456             }                                                                                            </span>
<span  style=""> 457                                                                                                          </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 458             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2521832232004155291" onmouseenter="enter('2521832232004155291');" onmouseout="out('2521832232004155291');" style=""> 459             return sqlIdentifier.setName(1, mappingFieldName);                                           </span>
<span class="6819015395036995114" onmouseenter="enter('6819015395036995114');" onmouseout="out('6819015395036995114');" style=""> 460         }else if(groupNode instanceof  SqlBasicCall){                                                    </span>
<span class="8961639140694724649" onmouseenter="enter('8961639140694724649');" onmouseout="out('8961639140694724649');" style=""> 461             SqlBasicCall sqlBasicCall = (SqlBasicCall) groupNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 462             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 463                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 464                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 465                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 466             }                                                                                            </span>
<span  style=""> 467                                                                                                          </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 468             return sqlBasicCall;                                                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 469         }else{                                                                                           </span>
<span class="-2985482133144580062" onmouseenter="enter('-2985482133144580062');" onmouseout="out('-2985482133144580062');" style=""> 470             return groupNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472     }                                                                                                    </span>
<span  style=""> 473                                                                                                          </span>
<span class="8999921149877150187" onmouseenter="enter('8999921149877150187');" onmouseout="out('8999921149877150187');" style=""> 474     public SqlNode filterNodeWithTargetName(SqlNode sqlNode, String targetTableName) {                   </span>
<span  style=""> 475                                                                                                          </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 476         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 477         switch (sqlKind){                                                                                </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 478             case SELECT:                                                                                 </span>
<span class="3690582093491335304" onmouseenter="enter('3690582093491335304');" onmouseout="out('3690582093491335304');" style=""> 479                 SqlNode fromNode = ((SqlSelect)sqlNode).getFrom();                                       </span>
<span class="-3145608785072750921" onmouseenter="enter('-3145608785072750921');" onmouseout="out('-3145608785072750921');" style=""><abbr title=" 480                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDENTIFIER){"> 480                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDE🔵</abbr></span>
<span class="-8703575627981044416" onmouseenter="enter('-8703575627981044416');" onmouseout="out('-8703575627981044416');" style=""><abbr title=" 481                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableName)){"> 481                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableN🔵</abbr></span>
<span class="4129664160573057591" onmouseenter="enter('4129664160573057591');" onmouseout="out('4129664160573057591');" style=""> 482                         return sqlNode;                                                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 483                     }else{                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 484                         return null;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 486                 }else{                                                                                   </span>
<span class="-487022337093825690" onmouseenter="enter('-487022337093825690');" onmouseout="out('-487022337093825690');" style=""> 487                     return filterNodeWithTargetName(fromNode, targetTableName);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488                 }                                                                                        </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 489             case AS:                                                                                     </span>
<span class="-1062165270197177560" onmouseenter="enter('-1062165270197177560');" onmouseout="out('-1062165270197177560');" style=""> 490                 SqlNode childNode = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-1638905337538821604" onmouseenter="enter('-1638905337538821604');" onmouseout="out('-1638905337538821604');" style=""> 491                 return filterNodeWithTargetName(childNode, targetTableName);                             </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 492             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 493                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-2733398086906527657" onmouseenter="enter('-2733398086906527657');" onmouseout="out('-2733398086906527657');" style=""> 494                 SqlNode rightNode =  ((SqlJoin)sqlNode).getRight();                                      </span>
<span class="2468445302541940347" onmouseenter="enter('2468445302541940347');" onmouseout="out('2468445302541940347');" style=""> 495                 SqlNode leftReturnNode = filterNodeWithTargetName(leftNode, targetTableName);            </span>
<span class="-8199943593633767670" onmouseenter="enter('-8199943593633767670');" onmouseout="out('-8199943593633767670');" style=""> 496                 SqlNode rightReturnNode = filterNodeWithTargetName(rightNode, targetTableName);          </span>
<span  style=""> 497                                                                                                          </span>
<span class="-394673487884933665" onmouseenter="enter('-394673487884933665');" onmouseout="out('-394673487884933665');" style=""> 498                 if(leftReturnNode != null) {                                                             </span>
<span class="7562823630460789719" onmouseenter="enter('7562823630460789719');" onmouseout="out('7562823630460789719');" style=""> 499                     return leftReturnNode;                                                               </span>
<span class="1020015460804008518" onmouseenter="enter('1020015460804008518');" onmouseout="out('1020015460804008518');" style=""> 500                 }else if(rightReturnNode != null){                                                       </span>
<span class="7420403991289947009" onmouseenter="enter('7420403991289947009');" onmouseout="out('7420403991289947009');" style=""> 501                     return rightReturnNode;                                                              </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 502                 }else{                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 503                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504                 }                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 505             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 506                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507         }                                                                                                </span>
<span  style=""> 508                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 509         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510     }                                                                                                    </span>
<span  style=""> 511                                                                                                          </span>
<span  style=""> 512                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 513     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 514         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""><abbr title=" 517     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 517     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 518         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 519         if(table == null){                                                                               </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 520             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521         }                                                                                                </span>
<span  style=""> 522                                                                                                          </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 523         if(table == null){                                                                               </span>
<span class="-2825016904896826066" onmouseenter="enter('-2825016904896826066');" onmouseout="out('-2825016904896826066');" style=""> 524             throw new RuntimeException(&quot;not register table &quot; + tableName);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span  style=""> 526                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 527         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span  style=""> 529                                                                                                          </span>
<span class="-8696523049985644897" onmouseenter="enter('-8696523049985644897');" onmouseout="out('-8696523049985644897');" style=""> 530     private List&lt;SqlNode&gt; replaceSelectStarFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo){  </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 531         SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                        </span>
<span class="-376697531199676299" onmouseenter="enter('-376697531199676299');" onmouseout="out('-376697531199676299');" style=""> 532         List&lt;SqlNode&gt; sqlNodes = Lists.newArrayList();                                                   </span>
<span class="-3220711380851181839" onmouseenter="enter('-3220711380851181839');" onmouseout="out('-3220711380851181839');" style=""> 533         if(sqlIdentifier.isStar()){//处理 [* or table.*]                                                   </span>
<span class="-8760640117888015743" onmouseenter="enter('-8760640117888015743');" onmouseout="out('-8760640117888015743');" style=""> 534             int identifierSize = sqlIdentifier.names.size();                                             </span>
<span class="-737230567623922483" onmouseenter="enter('-737230567623922483');" onmouseout="out('-737230567623922483');" style=""> 535             Collection&lt;String&gt; columns = null;                                                           </span>
<span class="-3878600943817580523" onmouseenter="enter('-3878600943817580523');" onmouseout="out('-3878600943817580523');" style=""> 536             if(identifierSize == 1){                                                                     </span>
<span class="439489357590017604" onmouseenter="enter('439489357590017604');" onmouseout="out('439489357590017604');" style=""> 537                 columns = replaceInfo.getMappingTable().values();                                        </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 538             }else{                                                                                       </span>
<span class="-6967503276601174325" onmouseenter="enter('-6967503276601174325');" onmouseout="out('-6967503276601174325');" style=""> 539                 columns = replaceInfo.getMappingTable().row(sqlIdentifier.names.get(0)).values();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540             }                                                                                            </span>
<span  style=""> 541                                                                                                          </span>
<span class="-8621425588629763030" onmouseenter="enter('-8621425588629763030');" onmouseout="out('-8621425588629763030');" style=""> 542             for(String colAlias : columns){                                                              </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 543                 SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                      </span>
<span class="7376564429850475234" onmouseenter="enter('7376564429850475234');" onmouseout="out('7376564429850475234');" style=""> 544                 List&lt;String&gt; columnInfo = Lists.newArrayList();                                          </span>
<span class="-7580690826400610936" onmouseenter="enter('-7580690826400610936');" onmouseout="out('-7580690826400610936');" style=""> 545                 columnInfo.add(replaceInfo.getTargetTableAlias());                                       </span>
<span class="8071016449845654104" onmouseenter="enter('8071016449845654104');" onmouseout="out('8071016449845654104');" style=""> 546                 columnInfo.add(colAlias);                                                                </span>
<span class="-2937163626106946341" onmouseenter="enter('-2937163626106946341');" onmouseout="out('-2937163626106946341');" style=""> 547                 SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(columnInfo, sqlParserPos);          </span>
<span class="6977395894616298454" onmouseenter="enter('6977395894616298454');" onmouseout="out('6977395894616298454');" style=""> 548                 sqlNodes.add(sqlIdentifierAlias);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549             }                                                                                            </span>
<span  style=""> 550                                                                                                          </span>
<span class="-2192274943977569589" onmouseenter="enter('-2192274943977569589');" onmouseout="out('-2192274943977569589');" style=""> 551             return sqlNodes;                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 552         }else{                                                                                           </span>
<span class="-8039826041817422769" onmouseenter="enter('-8039826041817422769');" onmouseout="out('-8039826041817422769');" style=""> 553             throw new RuntimeException(&quot;is not a star select field.&quot; + selectNode);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555     }                                                                                                    </span>
<span  style=""> 556                                                                                                          </span>
<span class="-5931652736394605669" onmouseenter="enter('-5931652736394605669');" onmouseout="out('-5931652736394605669');" style=""> 557     private SqlNode replaceSelectFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo) {           </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 558         if (selectNode.getKind() == AS) {                                                                </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 559             SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                             </span>
<span class="-1521486087941699086" onmouseenter="enter('-1521486087941699086');" onmouseout="out('-1521486087941699086');" style=""> 560             SqlNode replaceNode = replaceSelectFieldName(leftNode, replaceInfo);                         </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 561             if (replaceNode != null) {                                                                   </span>
<span class="44744548385893691" onmouseenter="enter('44744548385893691');" onmouseout="out('44744548385893691');" style=""> 562                 ((SqlBasicCall) selectNode).getOperands()[0] = replaceNode;                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563             }                                                                                            </span>
<span  style=""> 564                                                                                                          </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 565             return selectNode;                                                                           </span>
<span class="-4525236033469860943" onmouseenter="enter('-4525236033469860943');" onmouseout="out('-4525236033469860943');" style=""> 566         }else if(selectNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 567             SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                    </span>
<span  style=""> 568                                                                                                          </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 569             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 570                 return selectNode;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571             }                                                                                            </span>
<span  style=""> 572                                                                                                          </span>
<span class="5152547743275588251" onmouseenter="enter('5152547743275588251');" onmouseout="out('5152547743275588251');" style=""> 573             //Same level mappingTable                                                                    </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 574             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 574             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="-6523721893364253351" onmouseenter="enter('-6523721893364253351');" onmouseout="out('-6523721893364253351');" style=""> 575             if (mappingFieldName == null) {                                                              </span>
<span class="8276130366719222706" onmouseenter="enter('8276130366719222706');" onmouseout="out('8276130366719222706');" style=""> 576                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + selectNode.toString() );    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577             }                                                                                            </span>
<span  style=""> 578                                                                                                          </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 579             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2571352877158902005" onmouseenter="enter('2571352877158902005');" onmouseout="out('2571352877158902005');" style=""> 580             sqlIdentifier = sqlIdentifier.setName(1, mappingFieldName);                                  </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 581             return sqlIdentifier;                                                                        </span>
<span class="7580774735460232339" onmouseenter="enter('7580774735460232339');" onmouseout="out('7580774735460232339');" style=""> 582         }else if(selectNode.getKind() == LITERAL || selectNode.getKind() == LITERAL_CHAIN){//字面含义        </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 583             return selectNode;                                                                           </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 584         }else if(  AGGREGATE.contains(selectNode.getKind())                                              </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 585                 || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                      </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 586                 || COMPARISON.contains(selectNode.getKind())                                             </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 587                 || selectNode.getKind() == OTHER_FUNCTION                                                </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 588                 || selectNode.getKind() == DIVIDE                                                        </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 589                 || selectNode.getKind() == CAST                                                          </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 590                 || selectNode.getKind() == TRIM                                                          </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 591                 || selectNode.getKind() == TIMES                                                         </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 592                 || selectNode.getKind() == PLUS                                                          </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 593                 || selectNode.getKind() == NOT_IN                                                        </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 594                 || selectNode.getKind() == OR                                                            </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 595                 || selectNode.getKind() == AND                                                           </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 596                 || selectNode.getKind() == MINUS                                                         </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 597                 || selectNode.getKind() == TUMBLE                                                        </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 598                 || selectNode.getKind() == TUMBLE_START                                                  </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 599                 || selectNode.getKind() == TUMBLE_END                                                    </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 600                 || selectNode.getKind() == SESSION                                                       </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 601                 || selectNode.getKind() == SESSION_START                                                 </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 602                 || selectNode.getKind() == SESSION_END                                                   </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 603                 || selectNode.getKind() == HOP                                                           </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 604                 || selectNode.getKind() == HOP_START                                                     </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 605                 || selectNode.getKind() == HOP_END                                                       </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 606                 || selectNode.getKind() == BETWEEN                                                       </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 607                 || selectNode.getKind() == IS_NULL                                                       </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 608                 || selectNode.getKind() == IS_NOT_NULL                                                   </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 609                 || selectNode.getKind() == CONTAINS                                                      </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 610                 || selectNode.getKind() == TIMESTAMP_ADD                                                 </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 611                 || selectNode.getKind() == TIMESTAMP_DIFF                                                </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 612                 || selectNode.getKind() == LIKE                                                          </span>
<span  style=""> 613                                                                                                          </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 614                 ){                                                                                       </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 615             SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                       </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 616             for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                      </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 617                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 618                 if(sqlNode instanceof SqlLiteral){                                                       </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 619                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620                 }                                                                                        </span>
<span  style=""> 621                                                                                                          </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 622                 if(sqlNode instanceof SqlDataTypeSpec){                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 623                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624                 }                                                                                        </span>
<span  style=""> 625                                                                                                          </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 626                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 627                 if(replaceNode == null){                                                                 </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 628                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629                 }                                                                                        </span>
<span  style=""> 630                                                                                                          </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 631                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632             }                                                                                            </span>
<span  style=""> 633                                                                                                          </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 634             return selectNode;                                                                           </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 635         }else if(selectNode.getKind() == CASE){                                                          </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 636             SqlCase sqlCase = (SqlCase) selectNode;                                                      </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 637             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 638             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 639             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span  style=""> 640                                                                                                          </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 641             for(int i=0; i&lt;whenOperands.size(); i++){                                                    </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 642                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 643                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 644                 if (replaceNode != null) {                                                               </span>
<span class="827753515492975605" onmouseenter="enter('827753515492975605');" onmouseout="out('827753515492975605');" style=""> 645                     whenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647             }                                                                                            </span>
<span  style=""> 648                                                                                                          </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 649             for(int i=0; i&lt;thenOperands.size(); i++){                                                    </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 650                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 651                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 652                 if (replaceNode != null) {                                                               </span>
<span class="-4947674979480974151" onmouseenter="enter('-4947674979480974151');" onmouseout="out('-4947674979480974151');" style=""> 653                     thenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655             }                                                                                            </span>
<span  style=""> 656                                                                                                          </span>
<span class="-1702904876822094161" onmouseenter="enter('-1702904876822094161');" onmouseout="out('-1702904876822094161');" style=""> 657             ((SqlCase) selectNode).setOperand(3, replaceSelectFieldName(elseNode, replaceInfo));         </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 658             return selectNode;                                                                           </span>
<span class="-6373545674230253671" onmouseenter="enter('-6373545674230253671');" onmouseout="out('-6373545674230253671');" style=""> 659         }else if(selectNode.getKind() == OTHER){                                                         </span>
<span class="-5542086300788940380" onmouseenter="enter('-5542086300788940380');" onmouseout="out('-5542086300788940380');" style=""> 660             //不处理                                                                                        </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 661             return selectNode;                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 662         }else{                                                                                           </span>
<span class="1153766920564476840" onmouseenter="enter('1153766920564476840');" onmouseout="out('1153766920564476840');" style=""><abbr title=" 663             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNode.getKind()));"> 663             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665     }                                                                                                    </span>
<span  style=""> 666                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 667     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 668      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 668      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 669      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 670      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 671      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 672     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 672     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 673         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 674         if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 675             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 677         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678     }                                                                                                    </span>
<span  style=""> 679                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 680     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 681         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 682         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 683             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 684         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 685         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686     }                                                                                                    </span>
<span  style=""> 687                                                                                                          </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 688     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 688     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 689         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 690         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 691         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 692         for(SqlNode sqlNode : sqlNodeList){                                                              </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 693             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 694                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695             }                                                                                            </span>
<span  style=""> 696                                                                                                          </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 697             SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 698             SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];               </span>
<span  style=""> 699                                                                                                          </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 700             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 701             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span  style=""> 702                                                                                                          </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 703             String tableCol = &quot;&quot;;                                                                        </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 704             if(leftTableName.equalsIgnoreCase(specifyTableName)){                                        </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 705                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 706             }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                 </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 707                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 708             }else{                                                                                       </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 709                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 709                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 711             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 712             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713         }                                                                                                </span>
<span  style=""> 714                                                                                                          </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 715         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716     }                                                                                                    </span>
<span  style=""> 717                                                                                                          </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 718     protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                    </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 719                                      SqlNode pollSqlNode,                                                </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 720                                      Map&lt;String, Table&gt; tableCache,                                      </span>
<span class="-3293670501905922467" onmouseenter="enter('-3293670501905922467');" onmouseout="out('-3293670501905922467');" style=""> 721                                      List&lt;FieldReplaceInfo&gt; replaceInfoList) throws SqlParseException {  </span>
<span  style=""> 722                                                                                                          </span>
<span class="7772412594103241573" onmouseenter="enter('7772412594103241573');" onmouseout="out('7772412594103241573');" style=""> 723         AliasInfo aliasInfo = parseAsNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 724         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 725             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726         }                                                                                                </span>
<span  style=""> 727                                                                                                          </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 728         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 729         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 730         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span  style=""> 731                                                                                                          </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 732         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span  style=""> 733                                                                                                          </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 734         FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);        </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 735         if(fieldReplaceInfo == null){                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 736            return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737         }                                                                                                </span>
<span  style=""> 738                                                                                                          </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 739         //as 的源表                                                                                         </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 740         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 741         SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                 </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 742         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 743         for(FieldReplaceInfo tmp : replaceInfoList){                                                     </span>
<span class="7807393280391431617" onmouseenter="enter('7807393280391431617');" onmouseout="out('7807393280391431617');" style=""> 744             if(fromTableNameSet.contains(tmp.getTargetTableName())                                       </span>
<span class="-8987246733617074829" onmouseenter="enter('-8987246733617074829');" onmouseout="out('-8987246733617074829');" style=""> 745                     || fromTableNameSet.contains(tmp.getTargetTableAlias())){                            </span>
<span class="-8130963267335023429" onmouseenter="enter('-8130963267335023429');" onmouseout="out('-8130963267335023429');" style=""> 746                 fieldReplaceInfo.setPreNode(tmp);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 747                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749         }                                                                                                </span>
<span class="2047826278835391080" onmouseenter="enter('2047826278835391080');" onmouseout="out('2047826278835391080');" style=""> 750         replaceInfoList.add(fieldReplaceInfo);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751     }                                                                                                    </span>
<span  style=""> 752                                                                                                          </span>
<span class="4197581530070317287" onmouseenter="enter('4197581530070317287');" onmouseout="out('4197581530070317287');" style=""> 753     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache,                             </span>
<span class="-7423850058561480692" onmouseenter="enter('-7423850058561480692');" onmouseout="out('-7423850058561480692');" style=""><abbr title=" 754                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,"> 754                          Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv🔵</abbr></span>
<span class="-2956355081691304387" onmouseenter="enter('-2956355081691304387');" onmouseout="out('-2956355081691304387');" style=""> 755                          List&lt;FieldReplaceInfo&gt; replaceInfoList) throws Exception{                       </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 756         JoinInfo joinInfo = (JoinInfo) pollObj;                                                          </span>
<span  style=""> 757                                                                                                          </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 758         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 759         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 760         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 761         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span  style=""> 762                                                                                                          </span>
<span class="-3105793890099317611" onmouseenter="enter('-3105793890099317611');" onmouseout="out('-3105793890099317611');" style=""> 763         SqlKind sqlKind = joinInfo.getLeftNode().getKind();                                              </span>
<span class="9064898697795185402" onmouseenter="enter('9064898697795185402');" onmouseout="out('9064898697795185402');" style=""> 764         if(sqlKind == AS){                                                                               </span>
<span class="17281975900406720" onmouseenter="enter('17281975900406720');" onmouseout="out('17281975900406720');" style=""> 765             dealAsSourceTable(tableEnv, joinInfo.getLeftNode(), localTableCache, replaceInfoList);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766         }                                                                                                </span>
<span  style=""> 767                                                                                                          </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 768         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 768         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span  style=""> 769                                                                                                          </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 770         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 770         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 771         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span  style=""> 772                                                                                                          </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 773         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 774         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 775         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 776         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 777         if(sideTableInfo == null){                                                                       </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 778             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779         }                                                                                                </span>
<span  style=""> 780                                                                                                          </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 781         if(sideTableInfo == null){                                                                       </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 782             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783         }                                                                                                </span>
<span  style=""> 784                                                                                                          </span>
<span class="6668906180521634363" onmouseenter="enter('6668906180521634363');" onmouseout="out('6668906180521634363');" style=""> 785 //        if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){</span>
<span class="2570085130586631416" onmouseenter="enter('2570085130586631416');" onmouseout="out('2570085130586631416');" style=""> 786 //            throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);               </span>
<span class="-7859020312693891120" onmouseenter="enter('-7859020312693891120');" onmouseout="out('-7859020312693891120');" style=""> 787 //        }                                                                                              </span>
<span  style=""> 788                                                                                                          </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 789         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span  style=""> 790                                                                                                          </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 791         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 792         joinScope.addScope(rightScopeChild);                                                             </span>
<span  style=""> 793                                                                                                          </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 794         //获取两个表的所有字段                                                                                     </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 795         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 795         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span  style=""> 796                                                                                                          </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 797         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 798         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 799         if(targetTable == null){                                                                         </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 800             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 801         }                                                                                                </span>
<span  style=""> 802                                                                                                          </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 803         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 803         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span  style=""> 804                                                                                                          </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 805         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span  style=""> 806                                                                                                          </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 807         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 808         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 809             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 809             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 810             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 811             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 812             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 812             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813         }                                                                                                </span>
<span  style=""> 814                                                                                                          </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 815         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 816         if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                        </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 817             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 817             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 818         }else{                                                                                           </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 819             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 819             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820         }                                                                                                </span>
<span  style=""> 821                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 822         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 823         RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);              </span>
<span  style=""> 824                                                                                                          </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 825         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 826         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span  style=""> 827                                                                                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 828         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 829         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span  style=""> 830                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 831         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 832         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 833         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 834         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span  style=""> 835                                                                                                          </span>
<span class="-3207655655806857927" onmouseenter="enter('-3207655655806857927');" onmouseout="out('-3207655655806857927');" style=""> 836         //判断之前是不是被替换过,被替换过则设置之前的替换信息作为上一个节点                                                              </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 837         for(FieldReplaceInfo tmp : replaceInfoList){                                                     </span>
<span class="6967693276121741260" onmouseenter="enter('6967693276121741260');" onmouseout="out('6967693276121741260');" style=""> 838             if(tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName())                    </span>
<span class="8344413733256472211" onmouseenter="enter('8344413733256472211');" onmouseout="out('8344413733256472211');" style=""> 839             ||tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableAlias())){                  </span>
<span class="-1629804985910745096" onmouseenter="enter('-1629804985910745096');" onmouseout="out('-1629804985910745096');" style=""> 840                 replaceInfo.setPreNode(tmp);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 841                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 843         }                                                                                                </span>
<span  style=""> 844                                                                                                          </span>
<span class="2528453225163613561" onmouseenter="enter('2528453225163613561');" onmouseout="out('2528453225163613561');" style=""> 845         replaceInfoList.add(replaceInfo);                                                                </span>
<span  style=""> 846                                                                                                          </span>
<span class="6259278273454558932" onmouseenter="enter('6259278273454558932');" onmouseout="out('6259278273454558932');" style=""> 847         List&lt;String&gt; registeredTableName = Arrays.asList(tableEnv.listTables());                         </span>
<span class="6143756220473458570" onmouseenter="enter('6143756220473458570');" onmouseout="out('6143756220473458570');" style=""> 848         if (!registeredTableName.contains(joinInfo.getNewTableName())){                                  </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 849             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="-7674974637599312088" onmouseenter="enter('-7674974637599312088');" onmouseout="out('-7674974637599312088');" style=""> 850             tableEnv.registerTable(joinInfo.getNewTableName(), joinTable);                               </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 851             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853     }                                                                                                    </span>
<span  style=""> 854                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 855     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 856         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 857         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span  style=""> 858                                                                                                          </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""><abbr title=" 859         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);"> 859         String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::ne🔵</abbr></span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 860         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 860         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(Typ🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 861         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862     }                                                                                                    </span>
<span  style=""> 863                                                                                                          </span>
<span  style=""> 864                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 865     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 866         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 867         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 868         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 869         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 870             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style=""> 871             if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 872                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 873             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 874                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 875                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 876                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 877                 fieldNames.add(fieldName);                                                               </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 878                 String fieldType = filed[filed.length - 1 ].trim();                                      </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 879                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 880                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 881                 if (fieldClass == tableField){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 882                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 883                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 884                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 885                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 888         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 889         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890     }                                                                                                    </span>
<span  style=""> 891                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  18 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  20 import com.dtstack.flink.sql.enums.ECacheType;                                                           </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  21 import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                          </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  22 import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  23 import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                            </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  24 import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                     </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  25 import com.dtstack.flink.sql.util.ClassUtil;                                                             </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  26 import com.dtstack.flink.sql.util.ParseUtils;                                                            </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  27 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  28 import com.google.common.base.Preconditions;                                                             </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  29 import com.google.common.collect.HashBasedTable;                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  30 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  31 import com.google.common.collect.Maps;                                                                   </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  32 import com.google.common.collect.Sets;                                                                   </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  33 import java.sql.Timestamp;                                                                               </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="">  34 import java.time.LocalDateTime;                                                                          </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  35 import java.util.Arrays;                                                                                 </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  36 import java.util.Collection;                                                                             </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  37 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  38 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  39 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  40 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  41 import java.util.Set;                                                                                    </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  42 import org.apache.calcite.sql.SqlAsOperator;                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  43 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  44 import org.apache.calcite.sql.SqlDataTypeSpec;                                                           </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  45 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  46 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  47 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  48 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  49 import org.apache.calcite.sql.SqlLiteral;                                                                </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  50 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  51 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  52 import org.apache.calcite.sql.SqlOperator;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  53 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  54 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  55 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  56 import org.apache.calcite.sql.fun.SqlCase;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  57 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  58 import org.apache.calcite.sql.parser.SqlParserPos;                                                       </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  59 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  60 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  61 import org.apache.flink.api.common.typeinfo.TypeInformation;                                             </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="">  62 import org.apache.flink.api.common.typeinfo.Types;                                                       </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  63 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  64 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="">  65 import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  66 import org.apache.flink.streaming.api.datastream.DataStream;                                             </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  67 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  68 import org.apache.flink.table.api.TableSchema;                                                           </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  69 import org.apache.flink.table.api.java.StreamTableEnvironment;                                           </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  70 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  71 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  72 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  73 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  74 import static org.apache.calcite.sql.SqlKind.*;                                                          </span>
<span  style="">  75                                                                                                          </span>
<span  style="">  76                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  78  * Reason:                                                                                               </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  79  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  80  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  81  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  82  */                                                                                                      </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  83 public class SideSqlExec {                                                                               </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  84     private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                        </span>
<span  style="">  85                                                                                                          </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  86     private String localSqlPluginPath = null;                                                            </span>
<span  style="">  87                                                                                                          </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  88     private String tmpFields = null;                                                                     </span>
<span  style="">  89                                                                                                          </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  90     private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                      </span>
<span  style="">  91                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  92     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  93                                                                                                          </span>
<span class="-1344935053896969104" onmouseenter="enter('-1344935053896969104');" onmouseout="out('-1344935053896969104');" style=""><abbr title="  94     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv, Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) throws Exception {">  94     public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment 🔵</abbr></span>
<span class="-8459786232159972392" onmouseenter="enter('-8459786232159972392');" onmouseout="out('-8459786232159972392');" style="">  95         if (localSqlPluginPath == null) {                                                                </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style="">  96             throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style="">  98         localTableCache.putAll(tableCache);                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  99         try {                                                                                            </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 100             sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                          </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 101         } catch (java.lang.Exception e) {                                                                </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 102             LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103         }                                                                                                </span>
<span class="-2666540822034943406" onmouseenter="enter('-2666540822034943406');" onmouseout="out('-2666540822034943406');" style=""> 104         if (createView != null) {                                                                        </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 105             LOG.warn(&quot;create view info\n&quot;);                                                              </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 106             LOG.warn(createView.getExecSql());                                                           </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 107             LOG.warn(&quot;-----------------&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 109         SideSQLParser sideSQLParser = new SideSQLParser();                                               </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 110         sideSQLParser.setLocalTableCache(localTableCache);                                               </span>
<span class="-1577132173025596093" onmouseenter="enter('-1577132173025596093');" onmouseout="out('-1577132173025596093');" style=""> 111         Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet());                  </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 112         Object pollObj = null;                                                                           </span>
<span class="-8301438820195240834" onmouseenter="enter('-8301438820195240834');" onmouseout="out('-8301438820195240834');" style=""> 113         // need clean                                                                                    </span>
<span class="4055483294687718975" onmouseenter="enter('4055483294687718975');" onmouseout="out('4055483294687718975');" style=""> 114         boolean preIsSideJoin = false;                                                                   </span>
<span class="2266898631888830275" onmouseenter="enter('2266898631888830275');" onmouseout="out('2266898631888830275');" style=""> 115         List&lt;FieldReplaceInfo&gt; replaceInfoList = Lists.newArrayList();                                   </span>
<span class="-5058340944145416275" onmouseenter="enter('-5058340944145416275');" onmouseout="out('-5058340944145416275');" style=""> 116         while ((pollObj = exeQueue.poll()) != null) {                                                    </span>
<span class="-2443216094467354180" onmouseenter="enter('-2443216094467354180');" onmouseout="out('-2443216094467354180');" style=""> 117             if (pollObj instanceof SqlNode) {                                                            </span>
<span class="-7928777679656459385" onmouseenter="enter('-7928777679656459385');" onmouseout="out('-7928777679656459385');" style=""> 118                 SqlNode pollSqlNode = ((SqlNode) (pollObj));                                             </span>
<span class="-2747846521103571770" onmouseenter="enter('-2747846521103571770');" onmouseout="out('-2747846521103571770');" style=""> 119                 if (preIsSideJoin) {                                                                     </span>
<span class="313285673257348059" onmouseenter="enter('313285673257348059');" onmouseout="out('313285673257348059');" style=""> 120                     preIsSideJoin = false;                                                               </span>
<span class="-2618061440979010579" onmouseenter="enter('-2618061440979010579');" onmouseout="out('-2618061440979010579');" style=""> 121                     List&lt;String&gt; fieldNames = null;                                                      </span>
<span class="3253365708091092714" onmouseenter="enter('3253365708091092714');" onmouseout="out('3253365708091092714');" style=""> 122                     for (FieldReplaceInfo replaceInfo : replaceInfoList) {                               </span>
<span class="2418913985965727773" onmouseenter="enter('2418913985965727773');" onmouseout="out('2418913985965727773');" style=""> 123                         fieldNames = Lists.newArrayList();                                               </span>
<span class="-6690427821834278824" onmouseenter="enter('-6690427821834278824');" onmouseout="out('-6690427821834278824');" style=""> 124                         replaceFieldName(pollSqlNode, replaceInfo);                                      </span>
<span class="8246822691580888265" onmouseenter="enter('8246822691580888265');" onmouseout="out('8246822691580888265');" style=""> 125                         addAliasForFieldNode(pollSqlNode, fieldNames, replaceInfo.getMappingTable());    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127                 }                                                                                        </span>
<span class="-1675849540725983142" onmouseenter="enter('-1675849540725983142');" onmouseout="out('-1675849540725983142');" style=""> 128                 if (pollSqlNode.getKind() == INSERT) {                                                   </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style=""> 129                     FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                            </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 130                     if (LOG.isInfoEnabled()) {                                                           </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style=""> 131                         LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132                     }                                                                                    </span>
<span class="-2457059581629029056" onmouseenter="enter('-2457059581629029056');" onmouseout="out('-2457059581629029056');" style=""> 133                 } else if (pollSqlNode.getKind() == AS) {                                                </span>
<span class="-4906327517343466594" onmouseenter="enter('-4906327517343466594');" onmouseout="out('-4906327517343466594');" style=""> 134                     dealAsSourceTable(tableEnv, pollSqlNode, tableCache, replaceInfoList);               </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 135                 } else if (pollSqlNode.getKind() == WITH_ITEM) {                                         </span>
<span class="-5883854330896154202" onmouseenter="enter('-5883854330896154202');" onmouseout="out('-5883854330896154202');" style=""> 136                     SqlWithItem sqlWithItem = ((SqlWithItem) (pollSqlNode));                             </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 137                     String TableAlias = sqlWithItem.name.toString();                                     </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 138                     Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                       </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 139                     tableEnv.registerTable(TableAlias, table);                                           </span>
<span class="-5550860322814932769" onmouseenter="enter('-5550860322814932769');" onmouseout="out('-5550860322814932769');" style=""> 140                 } else if (pollSqlNode.getKind() == SELECT) {                                            </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""><abbr title=" 141                     Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);"> 141                     Preconditions.checkState(createView != null, &quot;select sql must included by create view🔵</abbr></span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 142                     Table table = tableEnv.sqlQuery(pollObj.toString());                                 </span>
<span class="2239810942967083761" onmouseenter="enter('2239810942967083761');" onmouseout="out('2239810942967083761');" style=""> 143                     if (createView.getFieldsInfoStr() == null) {                                         </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 144                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="4745325120447602784" onmouseenter="enter('4745325120447602784');" onmouseout="out('4745325120447602784');" style=""> 145                     } else if (checkFieldsInfo(createView, table)) {                                     </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 146                         table = table.as(tmpFields);                                                     </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 147                         tableEnv.registerTable(createView.getTableName(), table);                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 148                     } else {                                                                             </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 149                         throw new RuntimeException(&quot;Fields mismatch&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                     }                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 151                     localTableCache.put(createView.getTableName(), table);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                 }                                                                                        </span>
<span class="735190908606907144" onmouseenter="enter('735190908606907144');" onmouseout="out('735190908606907144');" style=""> 153             } else if (pollObj instanceof JoinInfo) {                                                    </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style=""> 154                 LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                  </span>
<span class="-4508108017455823844" onmouseenter="enter('-4508108017455823844');" onmouseout="out('-4508108017455823844');" style=""> 155                 preIsSideJoin = true;                                                                    </span>
<span class="-9158044292308775618" onmouseenter="enter('-9158044292308775618');" onmouseout="out('-9158044292308775618');" style=""> 156                 joinFun(pollObj, localTableCache, sideTableMap, tableEnv, replaceInfoList);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159     }                                                                                                    </span>
<span  style=""> 160                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 161     /**                                                                                                  </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 162      * 解析出as查询的表和字段的关系                                                                                   </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 163      * @param asSqlNode                                                                                  </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 164      * @param tableCache                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 165      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 166      */                                                                                                  </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 167     private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){        </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 168         SqlNode info = asSqlNode.getOperands()[0];                                                       </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 169         SqlNode alias = asSqlNode.getOperands()[1];                                                      </span>
<span  style=""> 170                                                                                                          </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 171         SqlKind infoKind = info.getKind();                                                               </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 172         if(infoKind != SELECT){                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 173             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174         }                                                                                                </span>
<span  style=""> 175                                                                                                          </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 176         List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);   </span>
<span  style=""> 177                                                                                                          </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 178         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 179         for (FieldInfo fieldInfo : extractFieldList) {                                                   </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 180             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 181             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 182             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 183             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span  style=""> 185                                                                                                          </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 186         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 187         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 188         replaceInfo.setTargetTableName(alias.toString());                                                </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 189         replaceInfo.setTargetTableAlias(alias.toString());                                               </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 190         return replaceInfo;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span  style=""> 192                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 193     /**                                                                                                  </span>
<span class="-3820374652196669145" onmouseenter="enter('-3820374652196669145');" onmouseout="out('-3820374652196669145');" style=""> 194      * 添加字段别名                                                                                            </span>
<span class="9038438555178000204" onmouseenter="enter('9038438555178000204');" onmouseout="out('9038438555178000204');" style=""> 195      * @param pollSqlNode                                                                                </span>
<span class="-5133777749030939729" onmouseenter="enter('-5133777749030939729');" onmouseout="out('-5133777749030939729');" style=""> 196      * @param fieldList                                                                                  </span>
<span class="-2002961180008195570" onmouseenter="enter('-2002961180008195570');" onmouseout="out('-2002961180008195570');" style=""> 197      * @param mappingTable                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 198      */                                                                                                  </span>
<span class="-3955444104111901697" onmouseenter="enter('-3955444104111901697');" onmouseout="out('-3955444104111901697');" style=""><abbr title=" 199     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 199     private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String,🔵</abbr></span>
<span class="-663927235385144722" onmouseenter="enter('-663927235385144722');" onmouseout="out('-663927235385144722');" style=""> 200         SqlKind sqlKind = pollSqlNode.getKind();                                                         </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 201         switch (sqlKind) {                                                                               </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 202             case INSERT:                                                                                 </span>
<span class="-3657774864843651643" onmouseenter="enter('-3657774864843651643');" onmouseout="out('-3657774864843651643');" style=""> 203                 SqlNode source = ((SqlInsert) pollSqlNode).getSource();                                  </span>
<span class="6134982029327154291" onmouseenter="enter('6134982029327154291');" onmouseout="out('6134982029327154291');" style=""> 204                 addAliasForFieldNode(source, fieldList, mappingTable);                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 205                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 206             case AS:                                                                                     </span>
<span class="-6853425371672212621" onmouseenter="enter('-6853425371672212621');" onmouseout="out('-6853425371672212621');" style=""><abbr title=" 207                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTable);"> 207                 addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTab🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 208                 break;                                                                                   </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 209             case SELECT:                                                                                 </span>
<span class="-345466278028982068" onmouseenter="enter('-345466278028982068');" onmouseout="out('-345466278028982068');" style=""> 210                 SqlNodeList selectList = ((SqlSelect) pollSqlNode).getSelectList();                      </span>
<span class="-4478316650227403681" onmouseenter="enter('-4478316650227403681');" onmouseout="out('-4478316650227403681');" style=""> 211                 selectList.getList().forEach(node -&gt; {                                                   </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 212                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 213                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 214                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 215                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                         }                                                                                </span>
<span class="-4986679521926317286" onmouseenter="enter('-4986679521926317286');" onmouseout="out('-4986679521926317286');" style=""> 217                         // save real field                                                               </span>
<span class="2742839839262283647" onmouseenter="enter('2742839839262283647');" onmouseout="out('2742839839262283647');" style=""> 218                         String fieldName = sqlIdentifier.names.get(1);                                   </span>
<span class="-5921041769209732806" onmouseenter="enter('-5921041769209732806');" onmouseout="out('-5921041769209732806');" style=""><abbr title=" 219                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().containsKey(fieldName)) {"> 219                         if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap🔵</abbr></span>
<span class="-2287024865944183458" onmouseenter="enter('-2287024865944183458');" onmouseout="out('-2287024865944183458');" style=""> 220                             fieldList.add(fieldName);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221                         }                                                                                </span>
<span  style=""> 222                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 224                 });                                                                                      </span>
<span class="-8923237898045704845" onmouseenter="enter('-8923237898045704845');" onmouseout="out('-8923237898045704845');" style=""> 225                 for (int i = 0; i &lt; selectList.getList().size(); i++) {                                  </span>
<span class="-4321294484021988020" onmouseenter="enter('-4321294484021988020');" onmouseout="out('-4321294484021988020');" style=""> 226                     SqlNode node = selectList.get(i);                                                    </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 227                     if (node.getKind() == IDENTIFIER) {                                                  </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 228                         SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 229                         if (sqlIdentifier.names.size() == 1) {                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 230                             return;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231                         }                                                                                </span>
<span class="-170655463018543442" onmouseenter="enter('-170655463018543442');" onmouseout="out('-170655463018543442');" style=""> 232                         String name = sqlIdentifier.names.get(1);                                        </span>
<span class="-3204699988614579440" onmouseenter="enter('-3204699988614579440');" onmouseout="out('-3204699988614579440');" style=""> 233                         // avoid real field pv0 convert pv                                               </span>
<span class="6166166284113505247" onmouseenter="enter('6166166284113505247');" onmouseout="out('6166166284113505247');" style=""><abbr title=" 234                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring(0, name.length() - 1))) {"> 234                         if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.🔵</abbr></span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 235                             SqlOperator operator = new SqlAsOperator();                                  </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 236                             SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                          </span>
<span  style=""> 237                                                                                                          </span>
<span class="-2138283127011244558" onmouseenter="enter('-2138283127011244558');" onmouseout="out('-2138283127011244558');" style=""><abbr title=" 238                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() - 1), null, sqlParserPos);"> 238                             SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.l🔵</abbr></span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 239                             SqlNode[] sqlNodes = new SqlNode[2];                                         </span>
<span class="-2939555014928254235" onmouseenter="enter('-2939555014928254235');" onmouseout="out('-2939555014928254235');" style=""> 240                             sqlNodes[0] = sqlIdentifier;                                                 </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 241                             sqlNodes[1] = sqlIdentifierAlias;                                            </span>
<span class="172920197577317623" onmouseenter="enter('172920197577317623');" onmouseout="out('172920197577317623');" style=""><abbr title=" 242                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos);"> 242                             SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos🔵</abbr></span>
<span  style=""> 243                                                                                                          </span>
<span class="-6513758114426947797" onmouseenter="enter('-6513758114426947797');" onmouseout="out('-6513758114426947797');" style=""> 244                             selectList.set(i, sqlBasicCall);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 248                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 249             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 250                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="3897594848566528823" onmouseenter="enter('3897594848566528823');" onmouseout="out('3897594848566528823');" style=""> 254     public AliasInfo parseAsNode(SqlNode sqlNode) throws SqlParseException {                             </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 255         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 256         if(sqlKind != AS){                                                                               </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 257             throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258         }                                                                                                </span>
<span  style=""> 259                                                                                                          </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 260         SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                         </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 261         SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                       </span>
<span  style=""> 262                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 263         AliasInfo aliasInfo = new AliasInfo();                                                           </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 264         aliasInfo.setName(info.toString());                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 265         aliasInfo.setAlias(alias.toString());                                                            </span>
<span  style=""> 266                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 267         return aliasInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268     }                                                                                                    </span>
<span  style=""> 269                                                                                                          </span>
<span class="-8689302297966137516" onmouseenter="enter('-8689302297966137516');" onmouseout="out('-8689302297966137516');" style=""><abbr title=" 270     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 270     public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, Stri🔵</abbr></span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 271         TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                  </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 272         String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                    </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 273         for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                             </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 274             FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                              </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 275             String tableName = fieldInfo.getTable();                                                     </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 276             String fieldName = fieldInfo.getFieldName();                                                 </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 277             String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);        </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 278             mappingTable.put(tableName, fieldName, mappingFieldName);                                    </span>
<span  style=""> 279                                                                                                          </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 280             sideOutTypes[i] = fieldInfo.getTypeInformation();                                            </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 281             sideOutNames[i] = mappingFieldName;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282         }                                                                                                </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 283         return new RowTypeInfo(sideOutTypes, sideOutNames);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284     }                                                                                                    </span>
<span  style=""> 285                                                                                                          </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 286     private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                  </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 287         if (typeInformation instanceof TimeIndicatorTypeInfo) {                                          </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style=""> 288             return TypeInformation.of(LocalDateTime.class);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289         }                                                                                                </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 290         return typeInformation;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span  style=""> 292                                                                                                          </span>
<span class="4184261108342886546" onmouseenter="enter('4184261108342886546');" onmouseout="out('4184261108342886546');" style=""> 293     //需要考虑更多的情况                                                                                          </span>
<span class="-5866348515582828073" onmouseenter="enter('-5866348515582828073');" onmouseout="out('-5866348515582828073');" style=""> 294     private void replaceFieldName(SqlNode sqlNode, FieldReplaceInfo replaceInfo) {                       </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 295         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 296         switch (sqlKind) {                                                                               </span>
<span class="-3229205352829537061" onmouseenter="enter('-3229205352829537061');" onmouseout="out('-3229205352829537061');" style=""> 297             case INSERT :                                                                                </span>
<span class="4923379117766569884" onmouseenter="enter('4923379117766569884');" onmouseout="out('4923379117766569884');" style=""> 298                 SqlNode sqlSource = ((SqlInsert) (sqlNode)).getSource();                                 </span>
<span class="3539579188210716047" onmouseenter="enter('3539579188210716047');" onmouseout="out('3539579188210716047');" style=""> 299                 replaceFieldName(sqlSource, replaceInfo);                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 300                 break;                                                                                   </span>
<span class="-7603101237578294688" onmouseenter="enter('-7603101237578294688');" onmouseout="out('-7603101237578294688');" style=""> 301             case AS :                                                                                    </span>
<span class="737388789989091895" onmouseenter="enter('737388789989091895');" onmouseout="out('737388789989091895');" style=""> 302                 SqlNode asNode = ((SqlBasicCall) (sqlNode)).getOperands()[0];                            </span>
<span class="2382936847570265491" onmouseenter="enter('2382936847570265491');" onmouseout="out('2382936847570265491');" style=""> 303                 replaceFieldName(asNode, replaceInfo);                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 304                 break;                                                                                   </span>
<span class="-3198951126756304146" onmouseenter="enter('-3198951126756304146');" onmouseout="out('-3198951126756304146');" style=""> 305             case SELECT :                                                                                </span>
<span class="-8251838171949724739" onmouseenter="enter('-8251838171949724739');" onmouseout="out('-8251838171949724739');" style=""><abbr title=" 306                 SqlSelect sqlSelect = ((SqlSelect) (filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName())));"> 306                 SqlSelect sqlSelect = ((SqlSelect) (filterNodeWithTargetName(sqlNode, replaceInfo.getTarg🔵</abbr></span>
<span class="7099775770423985787" onmouseenter="enter('7099775770423985787');" onmouseout="out('7099775770423985787');" style=""> 307                 if (sqlSelect == null) {                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308                     return;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309                 }                                                                                        </span>
<span class="-7911431356156617515" onmouseenter="enter('-7911431356156617515');" onmouseout="out('-7911431356156617515');" style=""> 310                 SqlNode sqlSource1 = sqlSelect.getFrom();                                                </span>
<span class="-1401089763187710510" onmouseenter="enter('-1401089763187710510');" onmouseout="out('-1401089763187710510');" style=""> 311                 if (sqlSource1.getKind() == AS) {                                                        </span>
<span class="1961436681049013136" onmouseenter="enter('1961436681049013136');" onmouseout="out('1961436681049013136');" style=""> 312                     String tableName = ((SqlBasicCall) (sqlSource1)).getOperands()[0].toString();        </span>
<span class="4429842221672537830" onmouseenter="enter('4429842221672537830');" onmouseout="out('4429842221672537830');" style=""> 313                     if (tableName.equalsIgnoreCase(replaceInfo.getTargetTableName())) {                  </span>
<span class="5036423329776629809" onmouseenter="enter('5036423329776629809');" onmouseout="out('5036423329776629809');" style=""> 314                         SqlNodeList sqlSelectList = sqlSelect.getSelectList();                           </span>
<span class="4783458191183529265" onmouseenter="enter('4783458191183529265');" onmouseout="out('4783458191183529265');" style=""> 315                         SqlNode whereNode = sqlSelect.getWhere();                                        </span>
<span class="6069356713975423578" onmouseenter="enter('6069356713975423578');" onmouseout="out('6069356713975423578');" style=""> 316                         SqlNodeList sqlGroup = sqlSelect.getGroup();                                     </span>
<span class="-8877897080287430541" onmouseenter="enter('-8877897080287430541');" onmouseout="out('-8877897080287430541');" style=""> 317                         // TODO 暂时不处理having                                                              </span>
<span class="-2928778695763881832" onmouseenter="enter('-2928778695763881832');" onmouseout="out('-2928778695763881832');" style=""> 318                         SqlNode sqlHaving = sqlSelect.getHaving();                                       </span>
<span class="-3614471078991347107" onmouseenter="enter('-3614471078991347107');" onmouseout="out('-3614471078991347107');" style=""> 319                         List&lt;SqlNode&gt; newSelectNodeList = Lists.newArrayList();                          </span>
<span class="8367397792596073196" onmouseenter="enter('8367397792596073196');" onmouseout="out('8367397792596073196');" style=""> 320                         for (int i = 0; i &lt; sqlSelectList.getList().size(); i++) {                       </span>
<span class="295237348129218365" onmouseenter="enter('295237348129218365');" onmouseout="out('295237348129218365');" style=""> 321                             SqlNode selectNode = sqlSelectList.getList().get(i);                         </span>
<span class="-5275514386061677345" onmouseenter="enter('-5275514386061677345');" onmouseout="out('-5275514386061677345');" style=""> 322                             // 特殊处理 isStar的标识                                                            </span>
<span class="8158247817315582634" onmouseenter="enter('8158247817315582634');" onmouseout="out('8158247817315582634');" style=""><abbr title=" 323                             if ((selectNode.getKind() == IDENTIFIER) &amp;&amp; ((SqlIdentifier) (selectNode)).isStar()) {"> 323                             if ((selectNode.getKind() == IDENTIFIER) &amp;&amp; ((SqlIdentifier) (selectNode)).is🔵</abbr></span>
<span class="1426748103918852649" onmouseenter="enter('1426748103918852649');" onmouseout="out('1426748103918852649');" style=""><abbr title=" 324                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo);"> 324                                 List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, re🔵</abbr></span>
<span class="-936038636053459659" onmouseenter="enter('-936038636053459659');" onmouseout="out('-936038636053459659');" style=""> 325                                 newSelectNodeList.addAll(replaceNodeList);                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 326                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327                             }                                                                            </span>
<span class="3570575360626670937" onmouseenter="enter('3570575360626670937');" onmouseout="out('3570575360626670937');" style=""> 328                             SqlNode replaceNode = replaceSelectFieldName(selectNode, replaceInfo);       </span>
<span class="-3838502176064539841" onmouseenter="enter('-3838502176064539841');" onmouseout="out('-3838502176064539841');" style=""> 329                             if (replaceNode == null) {                                                   </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 330                                 continue;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331                             }                                                                            </span>
<span class="1738798333366171043" onmouseenter="enter('1738798333366171043');" onmouseout="out('1738798333366171043');" style=""> 332                             // sqlSelectList.set(i, replaceNode);                                        </span>
<span class="1157087708345012360" onmouseenter="enter('1157087708345012360');" onmouseout="out('1157087708345012360');" style=""> 333                             newSelectNodeList.add(replaceNode);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334                         }                                                                                </span>
<span class="3723543992832155466" onmouseenter="enter('3723543992832155466');" onmouseout="out('3723543992832155466');" style=""><abbr title=" 335                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosition());"> 335                         SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getP🔵</abbr></span>
<span class="-8903961717282297850" onmouseenter="enter('-8903961717282297850');" onmouseout="out('-8903961717282297850');" style=""> 336                         sqlSelect.setSelectList(newSelectList);                                          </span>
<span class="-58892996998333290" onmouseenter="enter('-58892996998333290');" onmouseout="out('-58892996998333290');" style=""> 337                         // where                                                                         </span>
<span class="-7305457290747511703" onmouseenter="enter('-7305457290747511703');" onmouseout="out('-7305457290747511703');" style=""> 338                         if (whereNode != null) {                                                         </span>
<span class="-8249096356278156412" onmouseenter="enter('-8249096356278156412');" onmouseout="out('-8249096356278156412');" style=""> 339                             SqlNode[] sqlNodeList = ((SqlBasicCall) (whereNode)).getOperands();          </span>
<span class="9054338253906427319" onmouseenter="enter('9054338253906427319');" onmouseout="out('9054338253906427319');" style=""> 340                             for (int i = 0; i &lt; sqlNodeList.length; i++) {                               </span>
<span class="2172750173548984826" onmouseenter="enter('2172750173548984826');" onmouseout="out('2172750173548984826');" style=""> 341                                 SqlNode whereSqlNode = sqlNodeList[i];                                   </span>
<span class="-4477047106175359937" onmouseenter="enter('-4477047106175359937');" onmouseout="out('-4477047106175359937');" style=""> 342                                 SqlNode replaceNode = replaceNodeInfo(whereSqlNode, replaceInfo);        </span>
<span class="-1237302974526763563" onmouseenter="enter('-1237302974526763563');" onmouseout="out('-1237302974526763563');" style=""> 343                                 sqlNodeList[i] = replaceNode;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345                         }                                                                                </span>
<span class="9137014401456859461" onmouseenter="enter('9137014401456859461');" onmouseout="out('9137014401456859461');" style=""> 346                         if ((sqlGroup != null) &amp;&amp; CollectionUtils.isNotEmpty(sqlGroup.getList())) {      </span>
<span class="1774846266649672546" onmouseenter="enter('1774846266649672546');" onmouseout="out('1774846266649672546');" style=""> 347                             for (int i = 0; i &lt; sqlGroup.getList().size(); i++) {                        </span>
<span class="1364213940272952273" onmouseenter="enter('1364213940272952273');" onmouseout="out('1364213940272952273');" style=""> 348                                 SqlNode selectNode = sqlGroup.getList().get(i);                          </span>
<span class="3578364850198173029" onmouseenter="enter('3578364850198173029');" onmouseout="out('3578364850198173029');" style=""> 349                                 SqlNode replaceNode = replaceNodeInfo(selectNode, replaceInfo);          </span>
<span class="5715423325454336801" onmouseenter="enter('5715423325454336801');" onmouseout="out('5715423325454336801');" style=""> 350                                 sqlGroup.set(i, replaceNode);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 354                 } else {                                                                                 </span>
<span class="7951951008096051242" onmouseenter="enter('7951951008096051242');" onmouseout="out('7951951008096051242');" style=""> 355                     throw new RuntimeException(&quot;---not deal type:&quot; + sqlNode);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 357                 break;                                                                                   </span>
<span class="1238941309895419592" onmouseenter="enter('1238941309895419592');" onmouseout="out('1238941309895419592');" style=""> 358             case UNION :                                                                                 </span>
<span class="3847221911167009847" onmouseenter="enter('3847221911167009847');" onmouseout="out('3847221911167009847');" style=""> 359                 SqlNode unionLeft = ((SqlBasicCall) (sqlNode)).getOperands()[0];                         </span>
<span class="-4021192438573809697" onmouseenter="enter('-4021192438573809697');" onmouseout="out('-4021192438573809697');" style=""> 360                 SqlNode unionRight = ((SqlBasicCall) (sqlNode)).getOperands()[1];                        </span>
<span class="12832057540049012" onmouseenter="enter('12832057540049012');" onmouseout="out('12832057540049012');" style=""> 361                 replaceFieldName(unionLeft, replaceInfo);                                                </span>
<span class="-8236931260571053140" onmouseenter="enter('-8236931260571053140');" onmouseout="out('-8236931260571053140');" style=""> 362                 replaceFieldName(unionRight, replaceInfo);                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 363                 break;                                                                                   </span>
<span class="9103487536272409028" onmouseenter="enter('9103487536272409028');" onmouseout="out('9103487536272409028');" style=""> 364             case ORDER_BY :                                                                              </span>
<span class="-6096761147743361957" onmouseenter="enter('-6096761147743361957');" onmouseout="out('-6096761147743361957');" style=""> 365                 SqlOrderBy sqlOrderBy = ((SqlOrderBy) (sqlNode));                                        </span>
<span class="6726911406523213581" onmouseenter="enter('6726911406523213581');" onmouseout="out('6726911406523213581');" style=""> 366                 replaceFieldName(sqlOrderBy.query, replaceInfo);                                         </span>
<span class="-1619723091747707804" onmouseenter="enter('-1619723091747707804');" onmouseout="out('-1619723091747707804');" style=""> 367                 SqlNodeList orderFiledList = sqlOrderBy.orderList;                                       </span>
<span class="3718099336902841686" onmouseenter="enter('3718099336902841686');" onmouseout="out('3718099336902841686');" style=""> 368                 for (int i = 0; i &lt; orderFiledList.size(); i++) {                                        </span>
<span class="3598769397463403835" onmouseenter="enter('3598769397463403835');" onmouseout="out('3598769397463403835');" style=""><abbr title=" 369                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTableAlias());"> 369                     SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getT🔵</abbr></span>
<span class="-1288993483926023903" onmouseenter="enter('-1288993483926023903');" onmouseout="out('-1288993483926023903');" style=""> 370                     orderFiledList.set(i, replaceNode);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371                 }                                                                                        </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 372             default :                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 373                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="-4529709500477233937" onmouseenter="enter('-4529709500477233937');" onmouseout="out('-4529709500477233937');" style=""> 377     private SqlNode replaceOrderByTableName(SqlNode orderNode, String tableAlias) {                      </span>
<span class="-8843072586907859237" onmouseenter="enter('-8843072586907859237');" onmouseout="out('-8843072586907859237');" style=""> 378         if(orderNode.getKind() == IDENTIFIER){                                                           </span>
<span class="1286019212722079849" onmouseenter="enter('1286019212722079849');" onmouseout="out('1286019212722079849');" style=""> 379             SqlIdentifier sqlIdentifier = (SqlIdentifier) orderNode;                                     </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 380             if (sqlIdentifier.names.size() == 1) {                                                       </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 381                 return orderNode;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382             }                                                                                            </span>
<span class="4987076328947336547" onmouseenter="enter('4987076328947336547');" onmouseout="out('4987076328947336547');" style=""> 383             return sqlIdentifier.setName(0, tableAlias);                                                 </span>
<span class="6164370744345420381" onmouseenter="enter('6164370744345420381');" onmouseout="out('6164370744345420381');" style=""> 384         } else if (orderNode instanceof  SqlBasicCall) {                                                 </span>
<span class="4197878478620092735" onmouseenter="enter('4197878478620092735');" onmouseout="out('4197878478620092735');" style=""> 385             SqlBasicCall sqlBasicCall = (SqlBasicCall) orderNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 386             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 387                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="-7345169450449378118" onmouseenter="enter('-7345169450449378118');" onmouseout="out('-7345169450449378118');" style=""> 388                 sqlBasicCall.getOperands()[i] = replaceOrderByTableName(sqlNode , tableAlias);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389             }                                                                                            </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 390             return sqlBasicCall;                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391         } else {                                                                                         </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 392             return orderNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394     }                                                                                                    </span>
<span  style=""> 395                                                                                                          </span>
<span class="4620342074554351588" onmouseenter="enter('4620342074554351588');" onmouseout="out('4620342074554351588');" style=""> 396     private SqlNode replaceNodeInfo(SqlNode groupNode, FieldReplaceInfo replaceInfo){                    </span>
<span class="-8006552962557562934" onmouseenter="enter('-8006552962557562934');" onmouseout="out('-8006552962557562934');" style=""> 397         if(groupNode.getKind() == IDENTIFIER){                                                           </span>
<span class="3769318911409416973" onmouseenter="enter('3769318911409416973');" onmouseout="out('3769318911409416973');" style=""> 398             SqlIdentifier sqlIdentifier = (SqlIdentifier) groupNode;                                     </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 399             if(sqlIdentifier.names.size() == 1){                                                         </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 400                 return sqlIdentifier;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401             }                                                                                            </span>
<span  style=""> 402                                                                                                          </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 403             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 403             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="1289832806545417263" onmouseenter="enter('1289832806545417263');" onmouseout="out('1289832806545417263');" style=""> 404             if(mappingFieldName == null){                                                                </span>
<span class="-3862759337385230883" onmouseenter="enter('-3862759337385230883');" onmouseout="out('-3862759337385230883');" style=""> 405                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + sqlIdentifier.toString() ); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406             }                                                                                            </span>
<span  style=""> 407                                                                                                          </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 408             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2521832232004155291" onmouseenter="enter('2521832232004155291');" onmouseout="out('2521832232004155291');" style=""> 409             return sqlIdentifier.setName(1, mappingFieldName);                                           </span>
<span class="6819015395036995114" onmouseenter="enter('6819015395036995114');" onmouseout="out('6819015395036995114');" style=""> 410         }else if(groupNode instanceof  SqlBasicCall){                                                    </span>
<span class="8961639140694724649" onmouseenter="enter('8961639140694724649');" onmouseout="out('8961639140694724649');" style=""> 411             SqlBasicCall sqlBasicCall = (SqlBasicCall) groupNode;                                        </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 412             for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                   </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 413                 SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                  </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 414                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 415                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416             }                                                                                            </span>
<span  style=""> 417                                                                                                          </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 418             return sqlBasicCall;                                                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 419         }else{                                                                                           </span>
<span class="-2985482133144580062" onmouseenter="enter('-2985482133144580062');" onmouseout="out('-2985482133144580062');" style=""> 420             return groupNode;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422     }                                                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="8999921149877150187" onmouseenter="enter('8999921149877150187');" onmouseout="out('8999921149877150187');" style=""> 424     public SqlNode filterNodeWithTargetName(SqlNode sqlNode, String targetTableName) {                   </span>
<span  style=""> 425                                                                                                          </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 426         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 427         switch (sqlKind){                                                                                </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 428             case SELECT:                                                                                 </span>
<span class="3690582093491335304" onmouseenter="enter('3690582093491335304');" onmouseout="out('3690582093491335304');" style=""> 429                 SqlNode fromNode = ((SqlSelect)sqlNode).getFrom();                                       </span>
<span class="-3145608785072750921" onmouseenter="enter('-3145608785072750921');" onmouseout="out('-3145608785072750921');" style=""><abbr title=" 430                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDENTIFIER){"> 430                 if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDE🔵</abbr></span>
<span class="-8703575627981044416" onmouseenter="enter('-8703575627981044416');" onmouseout="out('-8703575627981044416');" style=""><abbr title=" 431                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableName)){"> 431                     if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableN🔵</abbr></span>
<span class="4129664160573057591" onmouseenter="enter('4129664160573057591');" onmouseout="out('4129664160573057591');" style=""> 432                         return sqlNode;                                                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 433                     }else{                                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 434                         return null;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 436                 }else{                                                                                   </span>
<span class="-487022337093825690" onmouseenter="enter('-487022337093825690');" onmouseout="out('-487022337093825690');" style=""> 437                     return filterNodeWithTargetName(fromNode, targetTableName);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438                 }                                                                                        </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 439             case AS:                                                                                     </span>
<span class="-1062165270197177560" onmouseenter="enter('-1062165270197177560');" onmouseout="out('-1062165270197177560');" style=""> 440                 SqlNode childNode = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-1638905337538821604" onmouseenter="enter('-1638905337538821604');" onmouseout="out('-1638905337538821604');" style=""> 441                 return filterNodeWithTargetName(childNode, targetTableName);                             </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 442             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 443                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-2733398086906527657" onmouseenter="enter('-2733398086906527657');" onmouseout="out('-2733398086906527657');" style=""> 444                 SqlNode rightNode =  ((SqlJoin)sqlNode).getRight();                                      </span>
<span class="2468445302541940347" onmouseenter="enter('2468445302541940347');" onmouseout="out('2468445302541940347');" style=""> 445                 SqlNode leftReturnNode = filterNodeWithTargetName(leftNode, targetTableName);            </span>
<span class="-8199943593633767670" onmouseenter="enter('-8199943593633767670');" onmouseout="out('-8199943593633767670');" style=""> 446                 SqlNode rightReturnNode = filterNodeWithTargetName(rightNode, targetTableName);          </span>
<span  style=""> 447                                                                                                          </span>
<span class="-394673487884933665" onmouseenter="enter('-394673487884933665');" onmouseout="out('-394673487884933665');" style=""> 448                 if(leftReturnNode != null) {                                                             </span>
<span class="7562823630460789719" onmouseenter="enter('7562823630460789719');" onmouseout="out('7562823630460789719');" style=""> 449                     return leftReturnNode;                                                               </span>
<span class="1020015460804008518" onmouseenter="enter('1020015460804008518');" onmouseout="out('1020015460804008518');" style=""> 450                 }else if(rightReturnNode != null){                                                       </span>
<span class="7420403991289947009" onmouseenter="enter('7420403991289947009');" onmouseout="out('7420403991289947009');" style=""> 451                     return rightReturnNode;                                                              </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 452                 }else{                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 453                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454                 }                                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 455             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 456                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457         }                                                                                                </span>
<span  style=""> 458                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 459         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460     }                                                                                                    </span>
<span  style=""> 461                                                                                                          </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 462     public void setLocalSqlPluginPath(String localSqlPluginPath) {                                       </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 463         this.localSqlPluginPath = localSqlPluginPath;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464     }                                                                                                    </span>
<span  style=""> 465                                                                                                          </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""><abbr title=" 466     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){"> 466     private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableNa🔵</abbr></span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 467         Table table = localTableCache.get(tableAlias);                                                   </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 468         if(table == null){                                                                               </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 469             table = localTableCache.get(tableName);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470         }                                                                                                </span>
<span  style=""> 471                                                                                                          </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 472         if(table == null){                                                                               </span>
<span class="-2825016904896826066" onmouseenter="enter('-2825016904896826066');" onmouseout="out('-2825016904896826066');" style=""> 473             throw new RuntimeException(&quot;not register table &quot; + tableName);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span  style=""> 475                                                                                                          </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 476         return table;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477     }                                                                                                    </span>
<span  style=""> 478                                                                                                          </span>
<span class="-8696523049985644897" onmouseenter="enter('-8696523049985644897');" onmouseout="out('-8696523049985644897');" style=""> 479     private List&lt;SqlNode&gt; replaceSelectStarFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo){  </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 480         SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                        </span>
<span class="-376697531199676299" onmouseenter="enter('-376697531199676299');" onmouseout="out('-376697531199676299');" style=""> 481         List&lt;SqlNode&gt; sqlNodes = Lists.newArrayList();                                                   </span>
<span class="-3220711380851181839" onmouseenter="enter('-3220711380851181839');" onmouseout="out('-3220711380851181839');" style=""> 482         if(sqlIdentifier.isStar()){//处理 [* or table.*]                                                   </span>
<span class="-8760640117888015743" onmouseenter="enter('-8760640117888015743');" onmouseout="out('-8760640117888015743');" style=""> 483             int identifierSize = sqlIdentifier.names.size();                                             </span>
<span class="-737230567623922483" onmouseenter="enter('-737230567623922483');" onmouseout="out('-737230567623922483');" style=""> 484             Collection&lt;String&gt; columns = null;                                                           </span>
<span class="-3878600943817580523" onmouseenter="enter('-3878600943817580523');" onmouseout="out('-3878600943817580523');" style=""> 485             if(identifierSize == 1){                                                                     </span>
<span class="439489357590017604" onmouseenter="enter('439489357590017604');" onmouseout="out('439489357590017604');" style=""> 486                 columns = replaceInfo.getMappingTable().values();                                        </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 487             }else{                                                                                       </span>
<span class="-6967503276601174325" onmouseenter="enter('-6967503276601174325');" onmouseout="out('-6967503276601174325');" style=""> 488                 columns = replaceInfo.getMappingTable().row(sqlIdentifier.names.get(0)).values();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489             }                                                                                            </span>
<span  style=""> 490                                                                                                          </span>
<span class="-8621425588629763030" onmouseenter="enter('-8621425588629763030');" onmouseout="out('-8621425588629763030');" style=""> 491             for(String colAlias : columns){                                                              </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 492                 SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                      </span>
<span class="7376564429850475234" onmouseenter="enter('7376564429850475234');" onmouseout="out('7376564429850475234');" style=""> 493                 List&lt;String&gt; columnInfo = Lists.newArrayList();                                          </span>
<span class="-7580690826400610936" onmouseenter="enter('-7580690826400610936');" onmouseout="out('-7580690826400610936');" style=""> 494                 columnInfo.add(replaceInfo.getTargetTableAlias());                                       </span>
<span class="8071016449845654104" onmouseenter="enter('8071016449845654104');" onmouseout="out('8071016449845654104');" style=""> 495                 columnInfo.add(colAlias);                                                                </span>
<span class="-2937163626106946341" onmouseenter="enter('-2937163626106946341');" onmouseout="out('-2937163626106946341');" style=""> 496                 SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(columnInfo, sqlParserPos);          </span>
<span class="6977395894616298454" onmouseenter="enter('6977395894616298454');" onmouseout="out('6977395894616298454');" style=""> 497                 sqlNodes.add(sqlIdentifierAlias);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498             }                                                                                            </span>
<span  style=""> 499                                                                                                          </span>
<span class="-2192274943977569589" onmouseenter="enter('-2192274943977569589');" onmouseout="out('-2192274943977569589');" style=""> 500             return sqlNodes;                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 501         }else{                                                                                           </span>
<span class="-8039826041817422769" onmouseenter="enter('-8039826041817422769');" onmouseout="out('-8039826041817422769');" style=""> 502             throw new RuntimeException(&quot;is not a star select field.&quot; + selectNode);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504     }                                                                                                    </span>
<span  style=""> 505                                                                                                          </span>
<span class="-5931652736394605669" onmouseenter="enter('-5931652736394605669');" onmouseout="out('-5931652736394605669');" style=""> 506     private SqlNode replaceSelectFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo) {           </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 507         if (selectNode.getKind() == AS) {                                                                </span>
<span class="-1537807880727101561" onmouseenter="enter('-1537807880727101561');" onmouseout="out('-1537807880727101561');" style=""> 508             SqlNode leftNode = ((SqlBasicCall) (selectNode)).getOperands()[0];                           </span>
<span class="-1521486087941699086" onmouseenter="enter('-1521486087941699086');" onmouseout="out('-1521486087941699086');" style=""> 509             SqlNode replaceNode = replaceSelectFieldName(leftNode, replaceInfo);                         </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 510             if (replaceNode != null) {                                                                   </span>
<span class="3429855690174102439" onmouseenter="enter('3429855690174102439');" onmouseout="out('3429855690174102439');" style=""> 511                 ((SqlBasicCall) (selectNode)).getOperands()[0] = replaceNode;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512             }                                                                                            </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 513             return selectNode;                                                                           </span>
<span class="-2484573391774826594" onmouseenter="enter('-2484573391774826594');" onmouseout="out('-2484573391774826594');" style=""> 514         } else if (selectNode.getKind() == IDENTIFIER) {                                                 </span>
<span class="-501065438478932756" onmouseenter="enter('-501065438478932756');" onmouseout="out('-501065438478932756');" style=""> 515             SqlIdentifier sqlIdentifier = ((SqlIdentifier) (selectNode));                                </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 516             if (sqlIdentifier.names.size() == 1) {                                                       </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 517                 return selectNode;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518             }                                                                                            </span>
<span class="6686616598951804805" onmouseenter="enter('6686616598951804805');" onmouseout="out('6686616598951804805');" style=""> 519             // Same level mappingTable                                                                   </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 520             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 520             String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSim🔵</abbr></span>
<span class="-6523721893364253351" onmouseenter="enter('-6523721893364253351');" onmouseout="out('-6523721893364253351');" style=""> 521             if (mappingFieldName == null) {                                                              </span>
<span class="-2592347056219775377" onmouseenter="enter('-2592347056219775377');" onmouseout="out('-2592347056219775377');" style=""> 522                 throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + selectNode.toString());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523             }                                                                                            </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 524             sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                 </span>
<span class="2571352877158902005" onmouseenter="enter('2571352877158902005');" onmouseout="out('2571352877158902005');" style=""> 525             sqlIdentifier = sqlIdentifier.setName(1, mappingFieldName);                                  </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 526             return sqlIdentifier;                                                                        </span>
<span class="7454495307889340449" onmouseenter="enter('7454495307889340449');" onmouseout="out('7454495307889340449');" style=""> 527         } else if ((selectNode.getKind() == LITERAL) || (selectNode.getKind() == LITERAL_CHAIN)) {       </span>
<span class="-6272979276160386196" onmouseenter="enter('-6272979276160386196');" onmouseout="out('-6272979276160386196');" style=""> 528             // 字面含义                                                                                      </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 529             return selectNode;                                                                           </span>
<span class="3850271869904858512" onmouseenter="enter('3850271869904858512');" onmouseout="out('3850271869904858512');" style=""><abbr title=" 530         } else if ((((((((((((((((((((((((((((AGGREGATE.contains(selectNode.getKind()) || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())) || COMPARISON.contains(selectNode.getKind())) || (selectNode.getKind() == OTHER_FUNCTION)) || (selectNode.getKind() == DIVIDE)) || (selectNode.getKind() == CAST)) || (selectNode.getKind() == TRIM)) || (selectNode.getKind() == TIMES)) || (selectNode.getKind() == PLUS)) || (selectNode.getKind() == NOT_IN)) || (selectNode.getKind() == OR)) || (selectNode.getKind() == AND)) || (selectNode.getKind() == MINUS)) || (selectNode.getKind() == TUMBLE)) || (selectNode.getKind() == TUMBLE_START)) || (selectNode.getKind() == TUMBLE_END)) || (selectNode.getKind() == SESSION)) || (selectNode.getKind() == SESSION_START)) || (selectNode.getKind() == SESSION_END)) || (selectNode.getKind() == HOP)) || (selectNode.getKind() == HOP_START)) || (selectNode.getKind() == HOP_END)) || (selectNode.getKind() == BETWEEN)) || (selectNode.getKind() == IS_NULL)) || (selectNode.getKind() == IS_NOT_NULL)) || (selectNode.getKind() == CONTAINS)) || (selectNode.getKind() == TIMESTAMP_ADD)) || (selectNode.getKind() == TIMESTAMP_DIFF)) || (selectNode.getKind() == LIKE)) {"> 530         } else if ((((((((((((((((((((((((((((AGGREGATE.contains(selectNode.getKind()) || AVG_AGG_FUNCTIO🔵</abbr></span>
<span class="1789264784310876595" onmouseenter="enter('1789264784310876595');" onmouseout="out('1789264784310876595');" style=""> 531             SqlBasicCall sqlBasicCall = ((SqlBasicCall) (selectNode));                                   </span>
<span class="-6461841638065859246" onmouseenter="enter('-6461841638065859246');" onmouseout="out('-6461841638065859246');" style=""> 532             for (int i = 0; i &lt; sqlBasicCall.getOperands().length; i++) {                                </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 533                 SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                         </span>
<span class="-4657964142739574978" onmouseenter="enter('-4657964142739574978');" onmouseout="out('-4657964142739574978');" style=""> 534                 if (sqlNode instanceof SqlLiteral) {                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 535                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536                 }                                                                                        </span>
<span class="-4675155589595463501" onmouseenter="enter('-4675155589595463501');" onmouseout="out('-4675155589595463501');" style=""> 537                 if (sqlNode instanceof SqlDataTypeSpec) {                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 538                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539                 }                                                                                        </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 540                 SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                      </span>
<span class="-3838502176064539841" onmouseenter="enter('-3838502176064539841');" onmouseout="out('-3838502176064539841');" style=""> 541                 if (replaceNode == null) {                                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 542                     continue;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543                 }                                                                                        </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 544                 sqlBasicCall.getOperands()[i] = replaceNode;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545             }                                                                                            </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 546             return selectNode;                                                                           </span>
<span class="6753725982943564752" onmouseenter="enter('6753725982943564752');" onmouseout="out('6753725982943564752');" style=""> 547         } else if (selectNode.getKind() == CASE) {                                                       </span>
<span class="-2316908184247217277" onmouseenter="enter('-2316908184247217277');" onmouseout="out('-2316908184247217277');" style=""> 548             SqlCase sqlCase = ((SqlCase) (selectNode));                                                  </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 549             SqlNodeList whenOperands = sqlCase.getWhenOperands();                                        </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 550             SqlNodeList thenOperands = sqlCase.getThenOperands();                                        </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 551             SqlNode elseNode = sqlCase.getElseOperand();                                                 </span>
<span class="5804242455667685406" onmouseenter="enter('5804242455667685406');" onmouseout="out('5804242455667685406');" style=""> 552             for (int i = 0; i &lt; whenOperands.size(); i++) {                                              </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 553                 SqlNode oneOperand = whenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 554                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 555                 if (replaceNode != null) {                                                               </span>
<span class="827753515492975605" onmouseenter="enter('827753515492975605');" onmouseout="out('827753515492975605');" style=""> 556                     whenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558             }                                                                                            </span>
<span class="-7770933914215809062" onmouseenter="enter('-7770933914215809062');" onmouseout="out('-7770933914215809062');" style=""> 559             for (int i = 0; i &lt; thenOperands.size(); i++) {                                              </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 560                 SqlNode oneOperand = thenOperands.get(i);                                                </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 561                 SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                   </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 562                 if (replaceNode != null) {                                                               </span>
<span class="-4947674979480974151" onmouseenter="enter('-4947674979480974151');" onmouseout="out('-4947674979480974151');" style=""> 563                     thenOperands.set(i, replaceNode);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565             }                                                                                            </span>
<span class="3510395921668546228" onmouseenter="enter('3510395921668546228');" onmouseout="out('3510395921668546228');" style=""> 566             ((SqlCase) (selectNode)).setOperand(3, replaceSelectFieldName(elseNode, replaceInfo));       </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 567             return selectNode;                                                                           </span>
<span class="-2308646561142794789" onmouseenter="enter('-2308646561142794789');" onmouseout="out('-2308646561142794789');" style=""> 568         } else if (selectNode.getKind() == OTHER) {                                                      </span>
<span class="5855067956998161694" onmouseenter="enter('5855067956998161694');" onmouseout="out('5855067956998161694');" style=""> 569             // 不处理                                                                                       </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 570             return selectNode;                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 571         } else {                                                                                         </span>
<span class="1153766920564476840" onmouseenter="enter('1153766920564476840');" onmouseout="out('1153766920564476840');" style=""><abbr title=" 572             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNode.getKind()));"> 572             throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574     }                                                                                                    </span>
<span  style=""> 575                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 576     /**                                                                                                  </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 577      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 577      * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., d🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 578      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 579      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 580      */                                                                                                  </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 581     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 581     private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInf🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 582         List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo); </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 583         if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 584             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 586         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587     }                                                                                                    </span>
<span  style=""> 588                                                                                                          </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 589     private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                      </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 590         List&lt;String&gt; res = Lists.newArrayList();                                                         </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 591         sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 592             res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 593         });                                                                                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 594         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595     }                                                                                                    </span>
<span  style=""> 596                                                                                                          </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 597     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 597     public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTa🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 598         List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 599         ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                 </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 600         List&lt;String&gt; conditionFields = Lists.newArrayList();                                             </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 601         for(SqlNode sqlNode : sqlNodeList){                                                              </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 602             if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                       </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 603                 throw new RuntimeException(&quot;not compare operator.&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604             }                                                                                            </span>
<span  style=""> 605                                                                                                          </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 606             SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 607             SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];               </span>
<span  style=""> 608                                                                                                          </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 609             String leftTableName = left.getComponent(0).getSimple();                                     </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 610             String rightTableName = right.getComponent(0).getSimple();                                   </span>
<span  style=""> 611                                                                                                          </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 612             String tableCol = &quot;&quot;;                                                                        </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 613             if(leftTableName.equalsIgnoreCase(specifyTableName)){                                        </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 614                 tableCol = left.getComponent(1).getSimple();                                             </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 615             }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                 </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 616                 tableCol = right.getComponent(1).getSimple();                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 617             }else{                                                                                       </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 618                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 618                 throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specify🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619             }                                                                                            </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 620             tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);               </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 621             conditionFields.add(tableCol);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 622         }                                                                                                </span>
<span  style=""> 623                                                                                                          </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 624         return conditionFields;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625     }                                                                                                    </span>
<span  style=""> 626                                                                                                          </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 627     protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                    </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 628                                      SqlNode pollSqlNode,                                                </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 629                                      Map&lt;String, Table&gt; tableCache,                                      </span>
<span class="-3293670501905922467" onmouseenter="enter('-3293670501905922467');" onmouseout="out('-3293670501905922467');" style=""> 630                                      List&lt;FieldReplaceInfo&gt; replaceInfoList) throws SqlParseException {  </span>
<span  style=""> 631                                                                                                          </span>
<span class="7772412594103241573" onmouseenter="enter('7772412594103241573');" onmouseout="out('7772412594103241573');" style=""> 632         AliasInfo aliasInfo = parseAsNode(pollSqlNode);                                                  </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 633         if (localTableCache.containsKey(aliasInfo.getName())) {                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 634             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635         }                                                                                                </span>
<span  style=""> 636                                                                                                          </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 637         Table table = tableEnv.sqlQuery(aliasInfo.getName());                                            </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 638         tableEnv.registerTable(aliasInfo.getAlias(), table);                                             </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 639         localTableCache.put(aliasInfo.getAlias(), table);                                                </span>
<span  style=""> 640                                                                                                          </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 641         LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                  </span>
<span  style=""> 642                                                                                                          </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 643         FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);        </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 644         if(fieldReplaceInfo == null){                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 645            return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646         }                                                                                                </span>
<span  style=""> 647                                                                                                          </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 648         //as 的源表                                                                                         </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 649         Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 650         SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                 </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 651         TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                         </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 652         for(FieldReplaceInfo tmp : replaceInfoList){                                                     </span>
<span class="7807393280391431617" onmouseenter="enter('7807393280391431617');" onmouseout="out('7807393280391431617');" style=""> 653             if(fromTableNameSet.contains(tmp.getTargetTableName())                                       </span>
<span class="-8987246733617074829" onmouseenter="enter('-8987246733617074829');" onmouseout="out('-8987246733617074829');" style=""> 654                     || fromTableNameSet.contains(tmp.getTargetTableAlias())){                            </span>
<span class="-8130963267335023429" onmouseenter="enter('-8130963267335023429');" onmouseout="out('-8130963267335023429');" style=""> 655                 fieldReplaceInfo.setPreNode(tmp);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 656                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658         }                                                                                                </span>
<span class="2047826278835391080" onmouseenter="enter('2047826278835391080');" onmouseout="out('2047826278835391080');" style=""> 659         replaceInfoList.add(fieldReplaceInfo);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660     }                                                                                                    </span>
<span  style=""> 661                                                                                                          </span>
<span class="6598491967499322401" onmouseenter="enter('6598491967499322401');" onmouseout="out('6598491967499322401');" style=""><abbr title=" 662     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv, List&lt;FieldReplaceInfo&gt; replaceInfoList) throws Exception {"> 662     private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache, Map&lt;String, AbstractSideTabl🔵</abbr></span>
<span class="2723345182979130952" onmouseenter="enter('2723345182979130952');" onmouseout="out('2723345182979130952');" style=""> 663         JoinInfo joinInfo = ((JoinInfo) (pollObj));                                                      </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 664         JoinScope joinScope = new JoinScope();                                                           </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 665         JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 666         leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                           </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 667         leftScopeChild.setTableName(joinInfo.getLeftTableName());                                        </span>
<span class="-3105793890099317611" onmouseenter="enter('-3105793890099317611');" onmouseout="out('-3105793890099317611');" style=""> 668         SqlKind sqlKind = joinInfo.getLeftNode().getKind();                                              </span>
<span class="5758769439521335262" onmouseenter="enter('5758769439521335262');" onmouseout="out('5758769439521335262');" style=""> 669         if (sqlKind == AS) {                                                                             </span>
<span class="17281975900406720" onmouseenter="enter('17281975900406720');" onmouseout="out('17281975900406720');" style=""> 670             dealAsSourceTable(tableEnv, joinInfo.getLeftNode(), localTableCache, replaceInfoList);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671         }                                                                                                </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 672         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 672         Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLe🔵</abbr></span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style=""><abbr title=" 673         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 673         RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSc🔵</abbr></span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 674         leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                     </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 675         JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                               </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 676         rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                         </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 677         rightScopeChild.setTableName(joinInfo.getRightTableName());                                      </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 678         AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());            </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 679         if (sideTableInfo == null) {                                                                     </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 680             sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681         }                                                                                                </span>
<span class="-4894423646294599023" onmouseenter="enter('-4894423646294599023');" onmouseout="out('-4894423646294599023');" style=""> 682         if (sideTableInfo == null) {                                                                     </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 683             throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 684         }                                                                                                </span>
<span class="6668906180521634363" onmouseenter="enter('6668906180521634363');" onmouseout="out('6668906180521634363');" style=""> 685 //        if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){</span>
<span class="2570085130586631416" onmouseenter="enter('2570085130586631416');" onmouseout="out('2570085130586631416');" style=""> 686 //            throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);               </span>
<span class="-7859020312693891120" onmouseenter="enter('-7859020312693891120');" onmouseout="out('-7859020312693891120');" style=""> 687 //        }                                                                                              </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 688         rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                  </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 689         joinScope.addScope(leftScopeChild);                                                              </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 690         joinScope.addScope(rightScopeChild);                                                             </span>
<span class="-5693279157941758931" onmouseenter="enter('-5693279157941758931');" onmouseout="out('-5693279157941758931');" style=""> 691         // 获取两个表的所有字段                                                                                    </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 692         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 692         List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), join🔵</abbr></span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 693         String leftTableAlias = joinInfo.getLeftTableAlias();                                            </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 694         Table targetTable = localTableCache.get(leftTableAlias);                                         </span>
<span class="7125781324026312556" onmouseenter="enter('7125781324026312556');" onmouseout="out('7125781324026312556');" style=""> 695         if (targetTable == null) {                                                                       </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 696             targetTable = localTableCache.get(joinInfo.getLeftTableName());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697         }                                                                                                </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style=""><abbr title=" 698         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 698         RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSc🔵</abbr></span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style=""> 699         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class); </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 700         //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async     </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 701         if (sideTableInfo.isPartitionedJoin()) {                                                         </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 702             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 702             List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTa🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 703             List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());            </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 704             int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();           </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style=""><abbr title=" 705             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 705             adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, ta🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706         }                                                                                                </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style=""> 707         DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                   </span>
<span class="9130962490964334732" onmouseenter="enter('9130962490964334732');" onmouseout="out('9130962490964334732');" style=""> 708         if (ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())) {                      </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 709             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 709             dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), 🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 710         } else {                                                                                         </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 711             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 711             dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSq🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712         }                                                                                                </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 713         HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                   </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 714         RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);              </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style=""> 715         TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                 </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style=""> 716         dsOut.getTransformation().setOutputType(tupleTypeInfo);                                          </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 717         String targetTableName = joinInfo.getNewTableName();                                             </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 718         String targetTableAlias = joinInfo.getNewTableAlias();                                           </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 719         FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                           </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 720         replaceInfo.setMappingTable(mappingTable);                                                       </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 721         replaceInfo.setTargetTableName(targetTableName);                                                 </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 722         replaceInfo.setTargetTableAlias(targetTableAlias);                                               </span>
<span class="-5824293522996244784" onmouseenter="enter('-5824293522996244784');" onmouseout="out('-5824293522996244784');" style=""> 723         // 判断之前是不是被替换过,被替换过则设置之前的替换信息作为上一个节点                                                             </span>
<span class="4139833526853409981" onmouseenter="enter('4139833526853409981');" onmouseout="out('4139833526853409981');" style=""> 724         for (FieldReplaceInfo tmp : replaceInfoList) {                                                   </span>
<span class="2057632755213126633" onmouseenter="enter('2057632755213126633');" onmouseout="out('2057632755213126633');" style=""><abbr title=" 725             if (tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName()) || tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableAlias())) {"> 725             if (tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName()) || tmp.getTargetTa🔵</abbr></span>
<span class="-1629804985910745096" onmouseenter="enter('-1629804985910745096');" onmouseout="out('-1629804985910745096');" style=""> 726                 replaceInfo.setPreNode(tmp);                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 727                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729         }                                                                                                </span>
<span class="2528453225163613561" onmouseenter="enter('2528453225163613561');" onmouseout="out('2528453225163613561');" style=""> 730         replaceInfoList.add(replaceInfo);                                                                </span>
<span class="6259278273454558932" onmouseenter="enter('6259278273454558932');" onmouseout="out('6259278273454558932');" style=""> 731         List&lt;String&gt; registeredTableName = Arrays.asList(tableEnv.listTables());                         </span>
<span class="-3858543157238049622" onmouseenter="enter('-3858543157238049622');" onmouseout="out('-3858543157238049622');" style=""> 732         if (!registeredTableName.contains(joinInfo.getNewTableName())) {                                 </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 733             Table joinTable = tableEnv.fromDataStream(dsOut);                                            </span>
<span class="-7674974637599312088" onmouseenter="enter('-7674974637599312088');" onmouseout="out('-7674974637599312088');" style=""> 734             tableEnv.registerTable(joinInfo.getNewTableName(), joinTable);                               </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 735             localTableCache.put(joinInfo.getNewTableName(), joinTable);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737     }                                                                                                    </span>
<span  style=""> 738                                                                                                          </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 739     private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                   </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 740         String[] fieldNames = schema.getFieldNames();                                                    </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 741         TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                        </span>
<span class="-9217050310751458121" onmouseenter="enter('-9217050310751458121');" onmouseout="out('-9217050310751458121');" style=""><abbr title=" 742         String[] projectedNames = Arrays.stream(fields).mapToObj(( i) -&gt; fieldNames[i]).toArray(String[]::new);"> 742         String[] projectedNames = Arrays.stream(fields).mapToObj(( i) -&gt; fieldNames[i]).toArray(String[]:🔵</abbr></span>
<span class="-8041204369174008942" onmouseenter="enter('-8041204369174008942');" onmouseout="out('-8041204369174008942');" style=""><abbr title=" 743         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(( i) -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 743         TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(( i) -&gt; fieldTypes[i]).toArray(🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 744         return new RowTypeInfo(projectedTypes, projectedNames);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745     }                                                                                                    </span>
<span  style=""> 746                                                                                                          </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 747     private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {          </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 748         List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                    </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 749         String fieldsInfo = result.getFieldsInfoStr();                                                   </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 750         String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                            </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 751         for (int i = 0; i &lt; fields.length; i++) {                                                        </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 752             String[] filed = fields[i].split(&quot;\\s&quot;);                                                     </span>
<span class="-8275782721208010319" onmouseenter="enter('-8275782721208010319');" onmouseout="out('-8275782721208010319');" style=""> 753             if ((filed.length &lt; 2) || (fields.length != table.getSchema().getFieldCount())) {            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 754                 return false;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 755             } else {                                                                                     </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 756                 String[] filedNameArr = new String[filed.length - 1];                                    </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 757                 System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                           </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 758                 String fieldName = String.join(&quot; &quot;, filedNameArr);                                       </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 759                 fieldNames.add(fieldName);                                                               </span>
<span class="5681537301300222292" onmouseenter="enter('5681537301300222292');" onmouseout="out('5681537301300222292');" style=""> 760                 String fieldType = filed[filed.length - 1].trim();                                       </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 761                 Class fieldClass = ClassUtil.stringConvertClass(fieldType);                              </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 762                 Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();               </span>
<span class="-2055572975849334800" onmouseenter="enter('-2055572975849334800');" onmouseout="out('-2055572975849334800');" style=""> 763                 if (fieldClass == tableField) {                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 764                     continue;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 765                 } else {                                                                                 </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 766                     return false;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 768             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769         }                                                                                                </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 770         tmpFields = String.join(&quot;,&quot;, fieldNames);                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 771         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773 }                                                                                                        </span>





















































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  23  import org.apache.flink.api.common.typeinfo.TypeInformation;                                                      </span>
<span class="-5176867084763361213" onmouseenter="enter('-5176867084763361213');" onmouseout="out('-5176867084763361213');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import org.apache.flink.api.common.typeinfo.Types;                                                                </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  25  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  26  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="-2654529550501634008" onmouseenter="enter('-2654529550501634008');" onmouseout="out('-2654529550501634008');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import org.apache.flink.api.java.typeutils.TupleTypeInfo;                                                         </span>
<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  28  import org.apache.flink.streaming.api.datastream.DataStream;                                                      </span>
<span class="2542322018203740202" onmouseenter="enter('2542322018203740202');" onmouseout="out('2542322018203740202');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import org.apache.flink.table.api.StreamQueryConfig;                                                              </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  30  import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  31  import org.apache.flink.table.api.TableSchema;                                                                    </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  32  import org.apache.flink.table.api.java.StreamTableEnvironment;                                                    </span>
<span class="-6266446094177003082" onmouseenter="enter('-6266446094177003082');" onmouseout="out('-6266446094177003082');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.apache.flink.table.runtime.CRowKeySelector;                                                            </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="5605277811729025111" onmouseenter="enter('5605277811729025111');" onmouseout="out('5605277811729025111');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import org.apache.flink.table.runtime.types.CRowTypeInfo;                                                         </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  36  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  37  import org.apache.flink.types.Row;                                                                                </span>
<span  style="">  38                                                                                                                    </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  39  import com.dtstack.flink.sql.enums.ECacheType;                                                                    </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  40  import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                                   </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  41  import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                         </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  42  import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                                     </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  43  import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                              </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  44  import com.dtstack.flink.sql.util.ClassUtil;                                                                      </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  45  import com.dtstack.flink.sql.util.ParseUtils;                                                                     </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  46  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  47  import com.google.common.base.Preconditions;                                                                      </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  48  import com.google.common.collect.HashBasedTable;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  49  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  50  import com.google.common.collect.Maps;                                                                            </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  51  import com.google.common.collect.Sets;                                                                            </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  52  import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  53  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  54  import org.apache.calcite.sql.SqlDataTypeSpec;                                                                    </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  55  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  56  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  57  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  58  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  59  import org.apache.calcite.sql.SqlLiteral;                                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  60  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  61  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  62  import org.apache.calcite.sql.SqlOperator;                                                                        </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  63  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  64  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  65  import org.apache.calcite.sql.SqlWithItem;                                                                        </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  66  import org.apache.calcite.sql.fun.SqlCase;                                                                        </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  67  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  68  import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  69  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  70  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  71  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  72  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  73                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  74  import java.sql.Timestamp;                                                                                        </span>
<span class="-608398790767092657" onmouseenter="enter('-608398790767092657');" onmouseout="out('-608398790767092657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +import java.time.LocalDateTime;                                                                                   </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  76  import java.util.Arrays;                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  77  import java.util.Collection;                                                                                      </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  78  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  79  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  80  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  81  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  82  import java.util.Set;                                                                                             </span>
<span  style="">  83                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  84  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  85                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  87   * Reason:                                                                                                        </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  88   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  89   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  90   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91   */                                                                                                               </span>
<span  style="">  92                                                                                                                    </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  93  public class SideSqlExec {                                                                                        </span>
<span  style="">  94                                                                                                                    </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  95      private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                                 </span>
<span  style="">  96                                                                                                                    </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  97      private String localSqlPluginPath = null;                                                                     </span>
<span  style="">  98                                                                                                                    </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  99      private String tmpFields = null;                                                                              </span>
<span  style=""> 100                                                                                                                    </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style=""> 101      private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                               </span>
<span  style=""> 102                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style=""> 103      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style=""> 104                                                                                                                    </span>
<span class="-2568962717532337416" onmouseenter="enter('-2568962717532337416');" onmouseout="out('-2568962717532337416');" style=""> 105      public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,</span>
<span class="1000260034925957386" onmouseenter="enter('1000260034925957386');" onmouseout="out('1000260034925957386');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 106 -                     Map&lt;String, Table&gt; tableCache, StreamQueryConfig queryConfig, CreateTmpTableParser.SqlParserResult createView) throws Exception {"> 106 -                     Map&lt;String, Table&gt; tableCache, StreamQueryConfig queryConfig, CreateTmpTableParser.SqlParserR🔵</abbr></span>
<span class="85465325218630864" onmouseenter="enter('85465325218630864');" onmouseout="out('85465325218630864');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 107 +                     Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) throws Exception {"> 107 +                     Map&lt;String, Table&gt; tableCache, CreateTmpTableParser.SqlParserResult createView) throws Except🔵</abbr></span>
<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style=""> 108          if(localSqlPluginPath == null){                                                                           </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style=""> 109              throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110          }                                                                                                         </span>
<span  style=""> 111                                                                                                                    </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 112          localTableCache.putAll(tableCache);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 113          try {                                                                                                     </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 114              sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 115          } catch (Exception e) {                                                                                   </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 116              LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117          }                                                                                                         </span>
<span  style=""> 118                                                                                                                    </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style=""> 119          if(createView != null){                                                                                   </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 120              LOG.warn(&quot;create view info\n&quot;);                                                                       </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 121              LOG.warn(createView.getExecSql());                                                                    </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 122              LOG.warn(&quot;-----------------&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123          }                                                                                                         </span>
<span  style=""> 124                                                                                                                    </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 125          SideSQLParser sideSQLParser = new SideSQLParser();                                                        </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 126          sideSQLParser.setLocalTableCache(localTableCache);                                                        </span>
<span class="-1577132173025596093" onmouseenter="enter('-1577132173025596093');" onmouseout="out('-1577132173025596093');" style=""> 127          Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet());                           </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 128          Object pollObj = null;                                                                                    </span>
<span  style=""> 129                                                                                                                    </span>
<span class="6779353451040372641" onmouseenter="enter('6779353451040372641');" onmouseout="out('6779353451040372641');" style=""> 130          //need clean                                                                                              </span>
<span class="4055483294687718975" onmouseenter="enter('4055483294687718975');" onmouseout="out('4055483294687718975');" style=""> 131          boolean preIsSideJoin = false;                                                                            </span>
<span class="2266898631888830275" onmouseenter="enter('2266898631888830275');" onmouseout="out('2266898631888830275');" style=""> 132          List&lt;FieldReplaceInfo&gt; replaceInfoList = Lists.newArrayList();                                            </span>
<span  style=""> 133                                                                                                                    </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 134          while((pollObj = exeQueue.poll()) != null){                                                               </span>
<span  style=""> 135                                                                                                                    </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 136              if(pollObj instanceof SqlNode){                                                                       </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 137                  SqlNode pollSqlNode = (SqlNode) pollObj;                                                          </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-3934441269421991372" onmouseenter="enter('-3934441269421991372');" onmouseout="out('-3934441269421991372');" style=""> 139                  if(preIsSideJoin){                                                                                </span>
<span class="313285673257348059" onmouseenter="enter('313285673257348059');" onmouseout="out('313285673257348059');" style=""> 140                      preIsSideJoin = false;                                                                        </span>
<span class="-2618061440979010579" onmouseenter="enter('-2618061440979010579');" onmouseout="out('-2618061440979010579');" style=""> 141                      List&lt;String&gt; fieldNames = null;                                                               </span>
<span class="-7322309591596780027" onmouseenter="enter('-7322309591596780027');" onmouseout="out('-7322309591596780027');" style=""> 142                      for(FieldReplaceInfo replaceInfo : replaceInfoList){                                          </span>
<span class="2418913985965727773" onmouseenter="enter('2418913985965727773');" onmouseout="out('2418913985965727773');" style=""> 143                          fieldNames = Lists.newArrayList();                                                        </span>
<span class="-6690427821834278824" onmouseenter="enter('-6690427821834278824');" onmouseout="out('-6690427821834278824');" style=""> 144                          replaceFieldName(pollSqlNode, replaceInfo);                                               </span>
<span class="8246822691580888265" onmouseenter="enter('8246822691580888265');" onmouseout="out('8246822691580888265');" style=""> 145                          addAliasForFieldNode(pollSqlNode, fieldNames, replaceInfo.getMappingTable());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                  }                                                                                                 </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 149                  if(pollSqlNode.getKind() == INSERT){                                                              </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style=""> 150                      System.out.println(&quot;----------real exec sql-----------&quot; );                                    </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style=""> 151                      System.out.println(pollSqlNode.toString());                                                   </span>
<span class="-7041171683301857607" onmouseenter="enter('-7041171683301857607');" onmouseout="out('-7041171683301857607');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -                    FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString(), queryConfig);                        </span>
<span class="4666335002906799727" onmouseenter="enter('4666335002906799727');" onmouseout="out('4666335002906799727');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                    FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString());                                     </span>
<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 154                      if(LOG.isInfoEnabled()){                                                                      </span>
<span class="8297270454157551832" onmouseenter="enter('8297270454157551832');" onmouseout="out('8297270454157551832');" style=""> 155                          LOG.info(&quot;exec sql: &quot; + pollSqlNode.toString());                                          </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                      }                                                                                             </span>
<span  style=""> 157                                                                                                                    </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 158                  }else if(pollSqlNode.getKind() == AS){                                                            </span>
<span class="-4906327517343466594" onmouseenter="enter('-4906327517343466594');" onmouseout="out('-4906327517343466594');" style=""> 159                      dealAsSourceTable(tableEnv, pollSqlNode, tableCache, replaceInfoList);                        </span>
<span  style=""> 160                                                                                                                    </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 161                  } else if (pollSqlNode.getKind() == WITH_ITEM) {                                                  </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 162                      SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                          </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 163                      String TableAlias = sqlWithItem.name.toString();                                              </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 164                      Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                                </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 165                      tableEnv.registerTable(TableAlias, table);                                                    </span>
<span  style=""> 166                                                                                                                    </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 167                  } else if (pollSqlNode.getKind() == SELECT){                                                      </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""> 168                      Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);      </span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 169                      Table table = tableEnv.sqlQuery(pollObj.toString());                                          </span>
<span  style=""> 170                                                                                                                    </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 171                      if (createView.getFieldsInfoStr() == null){                                                   </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 172                          tableEnv.registerTable(createView.getTableName(), table);                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 173                      } else {                                                                                      </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 174                          if (checkFieldsInfo(createView, table)){                                                  </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 175                              table = table.as(tmpFields);                                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 176                              tableEnv.registerTable(createView.getTableName(), table);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 177                          } else {                                                                                  </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 178                              throw new RuntimeException(&quot;Fields mismatch&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                      }                                                                                             </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 182                      localTableCache.put(createView.getTableName(), table);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183                  }                                                                                                 </span>
<span  style=""> 184                                                                                                                    </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 185              }else if (pollObj instanceof JoinInfo){                                                               </span>
<span class="-6732469083744011720" onmouseenter="enter('-6732469083744011720');" onmouseout="out('-6732469083744011720');" style=""> 186                  System.out.println(&quot;----------exec join info----------&quot;);                                         </span>
<span class="6437130050258637649" onmouseenter="enter('6437130050258637649');" onmouseout="out('6437130050258637649');" style=""> 187                  System.out.println(pollObj.toString());                                                           </span>

<span class="-4508108017455823844" onmouseenter="enter('-4508108017455823844');" onmouseout="out('-4508108017455823844');" style=""> 188                  preIsSideJoin = true;                                                                             </span>
<span class="-9158044292308775618" onmouseenter="enter('-9158044292308775618');" onmouseout="out('-9158044292308775618');" style=""> 189                  joinFun(pollObj, localTableCache, sideTableMap, tableEnv, replaceInfoList);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191          }                                                                                                         </span>
<span  style=""> 192                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span  style=""> 194                                                                                                                    </span>
<span  style=""> 195                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 196      /**                                                                                                           </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 197       * 解析出as查询的表和字段的关系                                                                                            </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 198       * @param asSqlNode                                                                                           </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 199       * @param tableCache                                                                                          </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 200       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 201       */                                                                                                           </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 202      private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){                 </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 203          SqlNode info = asSqlNode.getOperands()[0];                                                                </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 204          SqlNode alias = asSqlNode.getOperands()[1];                                                               </span>
<span  style=""> 205                                                                                                                    </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 206          SqlKind infoKind = info.getKind();                                                                        </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 207          if(infoKind != SELECT){                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 208              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span  style=""> 210                                                                                                                    </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 211          List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);            </span>
<span  style=""> 212                                                                                                                    </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 213          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 214          for (FieldInfo fieldInfo : extractFieldList) {                                                            </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 215              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 216              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 217              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 218              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219          }                                                                                                         </span>
<span  style=""> 220                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 221          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 222          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 223          replaceInfo.setTargetTableName(alias.toString());                                                         </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 224          replaceInfo.setTargetTableAlias(alias.toString());                                                        </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 225          return replaceInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226      }                                                                                                             </span>
<span  style=""> 227                                                                                                                    </span>
<span  style=""> 228                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 229      /**                                                                                                           </span>
<span class="-3820374652196669145" onmouseenter="enter('-3820374652196669145');" onmouseout="out('-3820374652196669145');" style=""> 230       * 添加字段别名                                                                                                     </span>
<span class="9038438555178000204" onmouseenter="enter('9038438555178000204');" onmouseout="out('9038438555178000204');" style=""> 231       * @param pollSqlNode                                                                                         </span>
<span class="-5133777749030939729" onmouseenter="enter('-5133777749030939729');" onmouseout="out('-5133777749030939729');" style=""> 232       * @param fieldList                                                                                           </span>
<span class="-2002961180008195570" onmouseenter="enter('-2002961180008195570');" onmouseout="out('-2002961180008195570');" style=""> 233       * @param mappingTable                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 234       */                                                                                                           </span>
<span class="-3955444104111901697" onmouseenter="enter('-3955444104111901697');" onmouseout="out('-3955444104111901697');" style=""><abbr title=" 235      private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 235      private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, 🔵</abbr></span>
<span class="-663927235385144722" onmouseenter="enter('-663927235385144722');" onmouseout="out('-663927235385144722');" style=""> 236          SqlKind sqlKind = pollSqlNode.getKind();                                                                  </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 237          switch (sqlKind) {                                                                                        </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 238              case INSERT:                                                                                          </span>
<span class="-3657774864843651643" onmouseenter="enter('-3657774864843651643');" onmouseout="out('-3657774864843651643');" style=""> 239                  SqlNode source = ((SqlInsert) pollSqlNode).getSource();                                           </span>
<span class="6134982029327154291" onmouseenter="enter('6134982029327154291');" onmouseout="out('6134982029327154291');" style=""> 240                  addAliasForFieldNode(source, fieldList, mappingTable);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 241                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 242              case AS:                                                                                              </span>
<span class="-6853425371672212621" onmouseenter="enter('-6853425371672212621');" onmouseout="out('-6853425371672212621');" style=""> 243                  addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTable);     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 244                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 245              case SELECT:                                                                                          </span>
<span class="-345466278028982068" onmouseenter="enter('-345466278028982068');" onmouseout="out('-345466278028982068');" style=""> 246                  SqlNodeList selectList = ((SqlSelect) pollSqlNode).getSelectList();                               </span>
<span class="-4478316650227403681" onmouseenter="enter('-4478316650227403681');" onmouseout="out('-4478316650227403681');" style=""> 247                  selectList.getList().forEach(node -&gt; {                                                            </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 248                      if (node.getKind() == IDENTIFIER) {                                                           </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 249                          SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                                       </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 250                          if (sqlIdentifier.names.size() == 1) {                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 251                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252                          }                                                                                         </span>
<span class="-4986679521926317286" onmouseenter="enter('-4986679521926317286');" onmouseout="out('-4986679521926317286');" style=""> 253                          // save real field                                                                        </span>
<span class="2742839839262283647" onmouseenter="enter('2742839839262283647');" onmouseout="out('2742839839262283647');" style=""> 254                          String fieldName = sqlIdentifier.names.get(1);                                            </span>
<span class="-5921041769209732806" onmouseenter="enter('-5921041769209732806');" onmouseout="out('-5921041769209732806');" style=""><abbr title=" 255                          if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().containsKey(fieldName)) {"> 255                          if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().contai🔵</abbr></span>
<span class="-2287024865944183458" onmouseenter="enter('-2287024865944183458');" onmouseout="out('-2287024865944183458');" style=""> 256                              fieldList.add(fieldName);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257                          }                                                                                         </span>
<span  style=""> 258                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 260                  });                                                                                               </span>
<span class="-8923237898045704845" onmouseenter="enter('-8923237898045704845');" onmouseout="out('-8923237898045704845');" style=""> 261                  for (int i = 0; i &lt; selectList.getList().size(); i++) {                                           </span>
<span class="-4321294484021988020" onmouseenter="enter('-4321294484021988020');" onmouseout="out('-4321294484021988020');" style=""> 262                      SqlNode node = selectList.get(i);                                                             </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 263                      if (node.getKind() == IDENTIFIER) {                                                           </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 264                          SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                                       </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 265                          if (sqlIdentifier.names.size() == 1) {                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 266                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267                          }                                                                                         </span>
<span class="-170655463018543442" onmouseenter="enter('-170655463018543442');" onmouseout="out('-170655463018543442');" style=""> 268                          String name = sqlIdentifier.names.get(1);                                                 </span>
<span class="-3204699988614579440" onmouseenter="enter('-3204699988614579440');" onmouseout="out('-3204699988614579440');" style=""> 269                          // avoid real field pv0 convert pv                                                        </span>
<span class="6166166284113505247" onmouseenter="enter('6166166284113505247');" onmouseout="out('6166166284113505247');" style=""><abbr title=" 270                          if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring(0, name.length() - 1))) {"> 270                          if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring🔵</abbr></span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 271                              SqlOperator operator = new SqlAsOperator();                                           </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 272                              SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                   </span>
<span  style=""> 273                                                                                                                    </span>
<span class="-2138283127011244558" onmouseenter="enter('-2138283127011244558');" onmouseout="out('-2138283127011244558');" style=""><abbr title=" 274                              SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() - 1), null, sqlParserPos);"> 274                              SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() -🔵</abbr></span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 275                              SqlNode[] sqlNodes = new SqlNode[2];                                                  </span>
<span class="-2939555014928254235" onmouseenter="enter('-2939555014928254235');" onmouseout="out('-2939555014928254235');" style=""> 276                              sqlNodes[0] = sqlIdentifier;                                                          </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 277                              sqlNodes[1] = sqlIdentifierAlias;                                                     </span>
<span class="172920197577317623" onmouseenter="enter('172920197577317623');" onmouseout="out('172920197577317623');" style=""> 278                              SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos);       </span>
<span  style=""> 279                                                                                                                    </span>
<span class="-6513758114426947797" onmouseenter="enter('-6513758114426947797');" onmouseout="out('-6513758114426947797');" style=""> 280                              selectList.set(i, sqlBasicCall);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 284                  break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 285              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 286                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288      }                                                                                                             </span>
<span  style=""> 289                                                                                                                    </span>
<span  style=""> 290                                                                                                                    </span>
<span class="3897594848566528823" onmouseenter="enter('3897594848566528823');" onmouseout="out('3897594848566528823');" style=""> 291      public AliasInfo parseAsNode(SqlNode sqlNode) throws SqlParseException {                                      </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 292          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 293          if(sqlKind != AS){                                                                                        </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 294              throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 297          SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                                  </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 298          SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                                </span>
<span  style=""> 299                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 300          AliasInfo aliasInfo = new AliasInfo();                                                                    </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 301          aliasInfo.setName(info.toString());                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 302          aliasInfo.setAlias(alias.toString());                                                                     </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 304          return aliasInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305      }                                                                                                             </span>
<span  style=""> 306                                                                                                                    </span>
<span class="-8689302297966137516" onmouseenter="enter('-8689302297966137516');" onmouseout="out('-8689302297966137516');" style=""><abbr title=" 307      public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 307      public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, Strin🔵</abbr></span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 308          TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                           </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 309          String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                             </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 310          for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                                      </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 311              FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                                       </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 312              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 313              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 314              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 315              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span  style=""> 316                                                                                                                    </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 317              sideOutTypes[i] = fieldInfo.getTypeInformation();                                                     </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 318              sideOutNames[i] = mappingFieldName;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319          }                                                                                                         </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 320          return new RowTypeInfo(sideOutTypes, sideOutNames);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span  style=""> 322                                                                                                                    </span>
<span  style=""> 323                                                                                                                    </span>
<span  style=""> 324                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -    /**                                                                                                           </span>
<span class="4027944609056411189" onmouseenter="enter('4027944609056411189');" onmouseout="out('4027944609056411189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -     *  对时间类型进行类型转换                                                                                               </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -     * @param leftTypeInfo                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -     * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -     */                                                                                                           </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -    private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                         </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -        TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];                </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -        TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                           </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -        for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                           </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -            sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -        }                                                                                                         </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -        RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());                    </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -        return rowTypeInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -                                                                                                                  </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 340      private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                           </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 341          if (typeInformation instanceof TimeIndicatorTypeInfo) {                                                   </span>
<span class="-6249974448261972874" onmouseenter="enter('-6249974448261972874');" onmouseout="out('-6249974448261972874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -            return TypeInformation.of(Timestamp.class);                                                           </span>
<span class="-4699013589387269243" onmouseenter="enter('-4699013589387269243');" onmouseout="out('-4699013589387269243');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +            return TypeInformation.of(LocalDateTime.class);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344          }                                                                                                         </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 345          return typeInformation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346      }                                                                                                             </span>
<span  style=""> 347                                                                                                                    </span>
<span class="4184261108342886546" onmouseenter="enter('4184261108342886546');" onmouseout="out('4184261108342886546');" style=""> 348      //需要考虑更多的情况                                                                                                   </span>
<span class="-5866348515582828073" onmouseenter="enter('-5866348515582828073');" onmouseout="out('-5866348515582828073');" style=""> 349      private void replaceFieldName(SqlNode sqlNode, FieldReplaceInfo replaceInfo) {                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 350          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 351          switch (sqlKind) {                                                                                        </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 352              case INSERT:                                                                                          </span>
<span class="1507566640229528779" onmouseenter="enter('1507566640229528779');" onmouseout="out('1507566640229528779');" style=""> 353                  SqlNode sqlSource = ((SqlInsert) sqlNode).getSource();                                            </span>
<span class="3539579188210716047" onmouseenter="enter('3539579188210716047');" onmouseout="out('3539579188210716047');" style=""> 354                  replaceFieldName(sqlSource, replaceInfo);                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 355                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 356              case AS:                                                                                              </span>
<span class="-2471580703701460163" onmouseenter="enter('-2471580703701460163');" onmouseout="out('-2471580703701460163');" style=""> 357                  SqlNode asNode = ((SqlBasicCall) sqlNode).getOperands()[0];                                       </span>
<span class="2382936847570265491" onmouseenter="enter('2382936847570265491');" onmouseout="out('2382936847570265491');" style=""> 358                  replaceFieldName(asNode, replaceInfo);                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 359                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 360              case SELECT:                                                                                          </span>
<span class="7730902652365827282" onmouseenter="enter('7730902652365827282');" onmouseout="out('7730902652365827282');" style=""><abbr title=" 361                  SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName());"> 361                  SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName🔵</abbr></span>
<span class="-1465070514376240276" onmouseenter="enter('-1465070514376240276');" onmouseout="out('-1465070514376240276');" style=""> 362                  if(sqlSelect == null){                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 363                      return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364                  }                                                                                                 </span>
<span  style=""> 365                                                                                                                    </span>
<span class="-7911431356156617515" onmouseenter="enter('-7911431356156617515');" onmouseout="out('-7911431356156617515');" style=""> 366                  SqlNode sqlSource1 = sqlSelect.getFrom();                                                         </span>
<span class="-4060139958118865814" onmouseenter="enter('-4060139958118865814');" onmouseout="out('-4060139958118865814');" style=""> 367                  if(sqlSource1.getKind() == AS){                                                                   </span>
<span class="7708153722582291408" onmouseenter="enter('7708153722582291408');" onmouseout="out('7708153722582291408');" style=""> 368                      String tableName = ((SqlBasicCall)sqlSource1).getOperands()[0].toString();                    </span>
<span class="-7976662112993336650" onmouseenter="enter('-7976662112993336650');" onmouseout="out('-7976662112993336650');" style=""> 369                      if(tableName.equalsIgnoreCase(replaceInfo.getTargetTableName())){                             </span>
<span class="5036423329776629809" onmouseenter="enter('5036423329776629809');" onmouseout="out('5036423329776629809');" style=""> 370                          SqlNodeList sqlSelectList = sqlSelect.getSelectList();                                    </span>
<span class="4783458191183529265" onmouseenter="enter('4783458191183529265');" onmouseout="out('4783458191183529265');" style=""> 371                          SqlNode whereNode = sqlSelect.getWhere();                                                 </span>
<span class="6069356713975423578" onmouseenter="enter('6069356713975423578');" onmouseout="out('6069356713975423578');" style=""> 372                          SqlNodeList sqlGroup = sqlSelect.getGroup();                                              </span>
<span  style=""> 373                                                                                                                    </span>
<span class="2024933395694494313" onmouseenter="enter('2024933395694494313');" onmouseout="out('2024933395694494313');" style=""> 374                          //TODO 暂时不处理having                                                                        </span>
<span class="-2928778695763881832" onmouseenter="enter('-2928778695763881832');" onmouseout="out('-2928778695763881832');" style=""> 375                          SqlNode sqlHaving = sqlSelect.getHaving();                                                </span>
<span  style=""> 376                                                                                                                    </span>
<span class="-3614471078991347107" onmouseenter="enter('-3614471078991347107');" onmouseout="out('-3614471078991347107');" style=""> 377                          List&lt;SqlNode&gt; newSelectNodeList = Lists.newArrayList();                                   </span>
<span class="4525830429471113267" onmouseenter="enter('4525830429471113267');" onmouseout="out('4525830429471113267');" style=""> 378                          for( int i=0; i&lt;sqlSelectList.getList().size(); i++){                                     </span>
<span class="295237348129218365" onmouseenter="enter('295237348129218365');" onmouseout="out('295237348129218365');" style=""> 379                              SqlNode selectNode = sqlSelectList.getList().get(i);                                  </span>
<span class="3005939127677060655" onmouseenter="enter('3005939127677060655');" onmouseout="out('3005939127677060655');" style=""> 380                              //特殊处理 isStar的标识                                                                      </span>
<span class="-7362933676269921614" onmouseenter="enter('-7362933676269921614');" onmouseout="out('-7362933676269921614');" style=""> 381                              if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar()){      </span>
<span class="1426748103918852649" onmouseenter="enter('1426748103918852649');" onmouseout="out('1426748103918852649');" style=""><abbr title=" 382                                  List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo);"> 382                                  List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo🔵</abbr></span>
<span class="-936038636053459659" onmouseenter="enter('-936038636053459659');" onmouseout="out('-936038636053459659');" style=""> 383                                  newSelectNodeList.addAll(replaceNodeList);                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 384                                  continue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                              }                                                                                     </span>
<span  style=""> 386                                                                                                                    </span>
<span class="3570575360626670937" onmouseenter="enter('3570575360626670937');" onmouseout="out('3570575360626670937');" style=""> 387                              SqlNode replaceNode = replaceSelectFieldName(selectNode, replaceInfo);                </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 388                              if(replaceNode == null){                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 389                                  continue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                              }                                                                                     </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-2861561298429904330" onmouseenter="enter('-2861561298429904330');" onmouseout="out('-2861561298429904330');" style=""> 392                              //sqlSelectList.set(i, replaceNode);                                                  </span>
<span class="1157087708345012360" onmouseenter="enter('1157087708345012360');" onmouseout="out('1157087708345012360');" style=""> 393                              newSelectNodeList.add(replaceNode);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394                          }                                                                                         </span>
<span  style=""> 395                                                                                                                    </span>
<span class="3723543992832155466" onmouseenter="enter('3723543992832155466');" onmouseout="out('3723543992832155466');" style=""><abbr title=" 396                          SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosition());"> 396                          SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosi🔵</abbr></span>
<span class="-8903961717282297850" onmouseenter="enter('-8903961717282297850');" onmouseout="out('-8903961717282297850');" style=""> 397                          sqlSelect.setSelectList(newSelectList);                                                   </span>
<span  style=""> 398                                                                                                                    </span>
<span class="-47820880813073829" onmouseenter="enter('-47820880813073829');" onmouseout="out('-47820880813073829');" style=""> 399                          //where                                                                                   </span>
<span class="-2977999434516732521" onmouseenter="enter('-2977999434516732521');" onmouseout="out('-2977999434516732521');" style=""> 400                          if(whereNode != null){                                                                    </span>
<span class="5185992084008387135" onmouseenter="enter('5185992084008387135');" onmouseout="out('5185992084008387135');" style=""> 401                              SqlNode[] sqlNodeList = ((SqlBasicCall)whereNode).getOperands();                      </span>
<span class="3961659355684503168" onmouseenter="enter('3961659355684503168');" onmouseout="out('3961659355684503168');" style=""> 402                              for(int i =0; i&lt;sqlNodeList.length; i++) {                                            </span>
<span class="2172750173548984826" onmouseenter="enter('2172750173548984826');" onmouseout="out('2172750173548984826');" style=""> 403                                  SqlNode whereSqlNode = sqlNodeList[i];                                            </span>
<span class="-4477047106175359937" onmouseenter="enter('-4477047106175359937');" onmouseout="out('-4477047106175359937');" style=""> 404                                  SqlNode replaceNode = replaceNodeInfo(whereSqlNode, replaceInfo);                 </span>
<span class="-1237302974526763563" onmouseenter="enter('-1237302974526763563');" onmouseout="out('-1237302974526763563');" style=""> 405                                  sqlNodeList[i] = replaceNode;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407                          }                                                                                         </span>
<span class="6298777632396279516" onmouseenter="enter('6298777632396279516');" onmouseout="out('6298777632396279516');" style=""> 408                          if(sqlGroup != null &amp;&amp; CollectionUtils.isNotEmpty(sqlGroup.getList())){                   </span>
<span class="-8564058694678267080" onmouseenter="enter('-8564058694678267080');" onmouseout="out('-8564058694678267080');" style=""> 409                              for( int i=0; i&lt;sqlGroup.getList().size(); i++){                                      </span>
<span class="1364213940272952273" onmouseenter="enter('1364213940272952273');" onmouseout="out('1364213940272952273');" style=""> 410                                  SqlNode selectNode = sqlGroup.getList().get(i);                                   </span>
<span class="3578364850198173029" onmouseenter="enter('3578364850198173029');" onmouseout="out('3578364850198173029');" style=""> 411                                  SqlNode replaceNode = replaceNodeInfo(selectNode, replaceInfo);                   </span>
<span class="5715423325454336801" onmouseenter="enter('5715423325454336801');" onmouseout="out('5715423325454336801');" style=""> 412                                  sqlGroup.set(i, replaceNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 416                  }else{                                                                                            </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style=""> 417                      //TODO                                                                                        </span>
<span class="-7176218527101706664" onmouseenter="enter('-7176218527101706664');" onmouseout="out('-7176218527101706664');" style=""> 418                      System.out.println(sqlNode);                                                                  </span>
<span class="7951951008096051242" onmouseenter="enter('7951951008096051242');" onmouseout="out('7951951008096051242');" style=""> 419                      throw new RuntimeException(&quot;---not deal type:&quot; + sqlNode);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420                  }                                                                                                 </span>
<span  style=""> 421                                                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 422                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 423              case UNION:                                                                                           </span>
<span class="-8185525423233229369" onmouseenter="enter('-8185525423233229369');" onmouseout="out('-8185525423233229369');" style=""> 424                  SqlNode unionLeft = ((SqlBasicCall) sqlNode).getOperands()[0];                                    </span>
<span class="3590878486653773103" onmouseenter="enter('3590878486653773103');" onmouseout="out('3590878486653773103');" style=""> 425                  SqlNode unionRight = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span class="12832057540049012" onmouseenter="enter('12832057540049012');" onmouseout="out('12832057540049012');" style=""> 426                  replaceFieldName(unionLeft, replaceInfo);                                                         </span>
<span class="-8236931260571053140" onmouseenter="enter('-8236931260571053140');" onmouseout="out('-8236931260571053140');" style=""> 427                  replaceFieldName(unionRight, replaceInfo);                                                        </span>
<span  style=""> 428                                                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 429                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 430              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 431                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="6726911406523213581" onmouseenter="enter('6726911406523213581');" onmouseout="out('6726911406523213581');" style=""> 432                  replaceFieldName(sqlOrderBy.query, replaceInfo);                                                  </span>
<span class="-1619723091747707804" onmouseenter="enter('-1619723091747707804');" onmouseout="out('-1619723091747707804');" style=""> 433                  SqlNodeList orderFiledList = sqlOrderBy.orderList;                                                </span>
<span class="-5416337846474747128" onmouseenter="enter('-5416337846474747128');" onmouseout="out('-5416337846474747128');" style=""> 434                  for (int i=0 ;i&lt;orderFiledList.size();i++) {                                                      </span>
<span class="3598769397463403835" onmouseenter="enter('3598769397463403835');" onmouseout="out('3598769397463403835');" style=""><abbr title=" 435                      SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTableAlias());"> 435                      SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTabl🔵</abbr></span>
<span class="-1288993483926023903" onmouseenter="enter('-1288993483926023903');" onmouseout="out('-1288993483926023903');" style=""> 436                      orderFiledList.set(i, replaceNode);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                  }                                                                                                 </span>
<span  style=""> 438                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 439              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 440                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442      }                                                                                                             </span>
<span  style=""> 443                                                                                                                    </span>
<span class="-4529709500477233937" onmouseenter="enter('-4529709500477233937');" onmouseout="out('-4529709500477233937');" style=""> 444      private SqlNode replaceOrderByTableName(SqlNode orderNode, String tableAlias) {                               </span>
<span class="-8843072586907859237" onmouseenter="enter('-8843072586907859237');" onmouseout="out('-8843072586907859237');" style=""> 445          if(orderNode.getKind() == IDENTIFIER){                                                                    </span>
<span class="1286019212722079849" onmouseenter="enter('1286019212722079849');" onmouseout="out('1286019212722079849');" style=""> 446              SqlIdentifier sqlIdentifier = (SqlIdentifier) orderNode;                                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 447              if (sqlIdentifier.names.size() == 1) {                                                                </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 448                  return orderNode;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449              }                                                                                                     </span>
<span class="4987076328947336547" onmouseenter="enter('4987076328947336547');" onmouseout="out('4987076328947336547');" style=""> 450              return sqlIdentifier.setName(0, tableAlias);                                                          </span>
<span class="6164370744345420381" onmouseenter="enter('6164370744345420381');" onmouseout="out('6164370744345420381');" style=""> 451          } else if (orderNode instanceof  SqlBasicCall) {                                                          </span>
<span class="4197878478620092735" onmouseenter="enter('4197878478620092735');" onmouseout="out('4197878478620092735');" style=""> 452              SqlBasicCall sqlBasicCall = (SqlBasicCall) orderNode;                                                 </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 453              for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                            </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 454                  SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                           </span>
<span class="-7345169450449378118" onmouseenter="enter('-7345169450449378118');" onmouseout="out('-7345169450449378118');" style=""> 455                  sqlBasicCall.getOperands()[i] = replaceOrderByTableName(sqlNode , tableAlias);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456              }                                                                                                     </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 457              return sqlBasicCall;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 458          } else {                                                                                                  </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 459              return orderNode;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 460          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461      }                                                                                                             </span>
<span  style=""> 462                                                                                                                    </span>
<span class="4620342074554351588" onmouseenter="enter('4620342074554351588');" onmouseout="out('4620342074554351588');" style=""> 463      private SqlNode replaceNodeInfo(SqlNode groupNode, FieldReplaceInfo replaceInfo){                             </span>
<span class="-8006552962557562934" onmouseenter="enter('-8006552962557562934');" onmouseout="out('-8006552962557562934');" style=""> 464          if(groupNode.getKind() == IDENTIFIER){                                                                    </span>
<span class="3769318911409416973" onmouseenter="enter('3769318911409416973');" onmouseout="out('3769318911409416973');" style=""> 465              SqlIdentifier sqlIdentifier = (SqlIdentifier) groupNode;                                              </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 466              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 467                  return sqlIdentifier;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468              }                                                                                                     </span>
<span  style=""> 469                                                                                                                    </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 470              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 470              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sq🔵</abbr></span>
<span class="1289832806545417263" onmouseenter="enter('1289832806545417263');" onmouseout="out('1289832806545417263');" style=""> 471              if(mappingFieldName == null){                                                                         </span>
<span class="-3862759337385230883" onmouseenter="enter('-3862759337385230883');" onmouseout="out('-3862759337385230883');" style=""> 472                  throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + sqlIdentifier.toString() );          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473              }                                                                                                     </span>
<span  style=""> 474                                                                                                                    </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 475              sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                          </span>
<span class="2521832232004155291" onmouseenter="enter('2521832232004155291');" onmouseout="out('2521832232004155291');" style=""> 476              return sqlIdentifier.setName(1, mappingFieldName);                                                    </span>
<span class="6819015395036995114" onmouseenter="enter('6819015395036995114');" onmouseout="out('6819015395036995114');" style=""> 477          }else if(groupNode instanceof  SqlBasicCall){                                                             </span>
<span class="8961639140694724649" onmouseenter="enter('8961639140694724649');" onmouseout="out('8961639140694724649');" style=""> 478              SqlBasicCall sqlBasicCall = (SqlBasicCall) groupNode;                                                 </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 479              for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                            </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 480                  SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                           </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 481                  SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                               </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 482                  sqlBasicCall.getOperands()[i] = replaceNode;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483              }                                                                                                     </span>
<span  style=""> 484                                                                                                                    </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 485              return sqlBasicCall;                                                                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 486          }else{                                                                                                    </span>
<span class="-2985482133144580062" onmouseenter="enter('-2985482133144580062');" onmouseout="out('-2985482133144580062');" style=""> 487              return groupNode;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489      }                                                                                                             </span>
<span  style=""> 490                                                                                                                    </span>
<span class="8999921149877150187" onmouseenter="enter('8999921149877150187');" onmouseout="out('8999921149877150187');" style=""> 491      public SqlNode filterNodeWithTargetName(SqlNode sqlNode, String targetTableName) {                            </span>
<span  style=""> 492                                                                                                                    </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 493          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 494          switch (sqlKind){                                                                                         </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 495              case SELECT:                                                                                          </span>
<span class="3690582093491335304" onmouseenter="enter('3690582093491335304');" onmouseout="out('3690582093491335304');" style=""> 496                  SqlNode fromNode = ((SqlSelect)sqlNode).getFrom();                                                </span>
<span class="-3145608785072750921" onmouseenter="enter('-3145608785072750921');" onmouseout="out('-3145608785072750921');" style=""> 497                  if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDENTIFIER){</span>
<span class="-8703575627981044416" onmouseenter="enter('-8703575627981044416');" onmouseout="out('-8703575627981044416');" style=""> 498                      if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableName)){   </span>
<span class="4129664160573057591" onmouseenter="enter('4129664160573057591');" onmouseout="out('4129664160573057591');" style=""> 499                          return sqlNode;                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 500                      }else{                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 501                          return null;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 503                  }else{                                                                                            </span>
<span class="-487022337093825690" onmouseenter="enter('-487022337093825690');" onmouseout="out('-487022337093825690');" style=""> 504                      return filterNodeWithTargetName(fromNode, targetTableName);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505                  }                                                                                                 </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 506              case AS:                                                                                              </span>
<span class="-1062165270197177560" onmouseenter="enter('-1062165270197177560');" onmouseout="out('-1062165270197177560');" style=""> 507                  SqlNode childNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-1638905337538821604" onmouseenter="enter('-1638905337538821604');" onmouseout="out('-1638905337538821604');" style=""> 508                  return filterNodeWithTargetName(childNode, targetTableName);                                      </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 509              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 510                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-2733398086906527657" onmouseenter="enter('-2733398086906527657');" onmouseout="out('-2733398086906527657');" style=""> 511                  SqlNode rightNode =  ((SqlJoin)sqlNode).getRight();                                               </span>
<span class="2468445302541940347" onmouseenter="enter('2468445302541940347');" onmouseout="out('2468445302541940347');" style=""> 512                  SqlNode leftReturnNode = filterNodeWithTargetName(leftNode, targetTableName);                     </span>
<span class="-8199943593633767670" onmouseenter="enter('-8199943593633767670');" onmouseout="out('-8199943593633767670');" style=""> 513                  SqlNode rightReturnNode = filterNodeWithTargetName(rightNode, targetTableName);                   </span>
<span  style=""> 514                                                                                                                    </span>
<span class="-394673487884933665" onmouseenter="enter('-394673487884933665');" onmouseout="out('-394673487884933665');" style=""> 515                  if(leftReturnNode != null) {                                                                      </span>
<span class="7562823630460789719" onmouseenter="enter('7562823630460789719');" onmouseout="out('7562823630460789719');" style=""> 516                      return leftReturnNode;                                                                        </span>
<span class="1020015460804008518" onmouseenter="enter('1020015460804008518');" onmouseout="out('1020015460804008518');" style=""> 517                  }else if(rightReturnNode != null){                                                                </span>
<span class="7420403991289947009" onmouseenter="enter('7420403991289947009');" onmouseout="out('7420403991289947009');" style=""> 518                      return rightReturnNode;                                                                       </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 519                  }else{                                                                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 520                      return null;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521                  }                                                                                                 </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 522              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 523                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524          }                                                                                                         </span>
<span  style=""> 525                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 526          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527      }                                                                                                             </span>
<span  style=""> 528                                                                                                                    </span>
<span  style=""> 529                                                                                                                    </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 530      public void setLocalSqlPluginPath(String localSqlPluginPath) {                                                </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 531          this.localSqlPluginPath = localSqlPluginPath;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532      }                                                                                                             </span>
<span  style=""> 533                                                                                                                    </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""> 534      private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){     </span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 535          Table table = localTableCache.get(tableAlias);                                                            </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 536          if(table == null){                                                                                        </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 537              table = localTableCache.get(tableName);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538          }                                                                                                         </span>
<span  style=""> 539                                                                                                                    </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 540          if(table == null){                                                                                        </span>
<span class="-2825016904896826066" onmouseenter="enter('-2825016904896826066');" onmouseout="out('-2825016904896826066');" style=""> 541              throw new RuntimeException(&quot;not register table &quot; + tableName);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542          }                                                                                                         </span>
<span  style=""> 543                                                                                                                    </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 544          return table;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545      }                                                                                                             </span>
<span  style=""> 546                                                                                                                    </span>
<span class="-8696523049985644897" onmouseenter="enter('-8696523049985644897');" onmouseout="out('-8696523049985644897');" style=""> 547      private List&lt;SqlNode&gt; replaceSelectStarFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo){           </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 548          SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                                 </span>
<span class="-376697531199676299" onmouseenter="enter('-376697531199676299');" onmouseout="out('-376697531199676299');" style=""> 549          List&lt;SqlNode&gt; sqlNodes = Lists.newArrayList();                                                            </span>
<span class="-3220711380851181839" onmouseenter="enter('-3220711380851181839');" onmouseout="out('-3220711380851181839');" style=""> 550          if(sqlIdentifier.isStar()){//处理 [* or table.*]                                                            </span>
<span class="-8760640117888015743" onmouseenter="enter('-8760640117888015743');" onmouseout="out('-8760640117888015743');" style=""> 551              int identifierSize = sqlIdentifier.names.size();                                                      </span>
<span class="-737230567623922483" onmouseenter="enter('-737230567623922483');" onmouseout="out('-737230567623922483');" style=""> 552              Collection&lt;String&gt; columns = null;                                                                    </span>
<span class="-3878600943817580523" onmouseenter="enter('-3878600943817580523');" onmouseout="out('-3878600943817580523');" style=""> 553              if(identifierSize == 1){                                                                              </span>
<span class="439489357590017604" onmouseenter="enter('439489357590017604');" onmouseout="out('439489357590017604');" style=""> 554                  columns = replaceInfo.getMappingTable().values();                                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 555              }else{                                                                                                </span>
<span class="-6967503276601174325" onmouseenter="enter('-6967503276601174325');" onmouseout="out('-6967503276601174325');" style=""> 556                  columns = replaceInfo.getMappingTable().row(sqlIdentifier.names.get(0)).values();                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557              }                                                                                                     </span>
<span  style=""> 558                                                                                                                    </span>
<span class="-8621425588629763030" onmouseenter="enter('-8621425588629763030');" onmouseout="out('-8621425588629763030');" style=""> 559              for(String colAlias : columns){                                                                       </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 560                  SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                               </span>
<span class="7376564429850475234" onmouseenter="enter('7376564429850475234');" onmouseout="out('7376564429850475234');" style=""> 561                  List&lt;String&gt; columnInfo = Lists.newArrayList();                                                   </span>
<span class="-7580690826400610936" onmouseenter="enter('-7580690826400610936');" onmouseout="out('-7580690826400610936');" style=""> 562                  columnInfo.add(replaceInfo.getTargetTableAlias());                                                </span>
<span class="8071016449845654104" onmouseenter="enter('8071016449845654104');" onmouseout="out('8071016449845654104');" style=""> 563                  columnInfo.add(colAlias);                                                                         </span>
<span class="-2937163626106946341" onmouseenter="enter('-2937163626106946341');" onmouseout="out('-2937163626106946341');" style=""> 564                  SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(columnInfo, sqlParserPos);                   </span>
<span class="6977395894616298454" onmouseenter="enter('6977395894616298454');" onmouseout="out('6977395894616298454');" style=""> 565                  sqlNodes.add(sqlIdentifierAlias);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566              }                                                                                                     </span>
<span  style=""> 567                                                                                                                    </span>
<span class="-2192274943977569589" onmouseenter="enter('-2192274943977569589');" onmouseout="out('-2192274943977569589');" style=""> 568              return sqlNodes;                                                                                      </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 569          }else{                                                                                                    </span>
<span class="-8039826041817422769" onmouseenter="enter('-8039826041817422769');" onmouseout="out('-8039826041817422769');" style=""> 570              throw new RuntimeException(&quot;is not a star select field.&quot; + selectNode);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572      }                                                                                                             </span>
<span  style=""> 573                                                                                                                    </span>
<span class="-5931652736394605669" onmouseenter="enter('-5931652736394605669');" onmouseout="out('-5931652736394605669');" style=""> 574      private SqlNode replaceSelectFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo) {                    </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 575          if (selectNode.getKind() == AS) {                                                                         </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 576              SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                                      </span>
<span class="-1521486087941699086" onmouseenter="enter('-1521486087941699086');" onmouseout="out('-1521486087941699086');" style=""> 577              SqlNode replaceNode = replaceSelectFieldName(leftNode, replaceInfo);                                  </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 578              if (replaceNode != null) {                                                                            </span>
<span class="44744548385893691" onmouseenter="enter('44744548385893691');" onmouseout="out('44744548385893691');" style=""> 579                  ((SqlBasicCall) selectNode).getOperands()[0] = replaceNode;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580              }                                                                                                     </span>
<span  style=""> 581                                                                                                                    </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 582              return selectNode;                                                                                    </span>
<span class="-4525236033469860943" onmouseenter="enter('-4525236033469860943');" onmouseout="out('-4525236033469860943');" style=""> 583          }else if(selectNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 584              SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                             </span>
<span  style=""> 585                                                                                                                    </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 586              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 587                  return selectNode;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588              }                                                                                                     </span>
<span  style=""> 589                                                                                                                    </span>
<span class="5152547743275588251" onmouseenter="enter('5152547743275588251');" onmouseout="out('5152547743275588251');" style=""> 590              //Same level mappingTable                                                                             </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 591              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 591              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sq🔵</abbr></span>
<span class="-6523721893364253351" onmouseenter="enter('-6523721893364253351');" onmouseout="out('-6523721893364253351');" style=""> 592              if (mappingFieldName == null) {                                                                       </span>
<span class="8276130366719222706" onmouseenter="enter('8276130366719222706');" onmouseout="out('8276130366719222706');" style=""> 593                  throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + selectNode.toString() );             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594              }                                                                                                     </span>
<span  style=""> 595                                                                                                                    </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 596              sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                          </span>
<span class="2571352877158902005" onmouseenter="enter('2571352877158902005');" onmouseout="out('2571352877158902005');" style=""> 597              sqlIdentifier = sqlIdentifier.setName(1, mappingFieldName);                                           </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 598              return sqlIdentifier;                                                                                 </span>
<span class="7580774735460232339" onmouseenter="enter('7580774735460232339');" onmouseout="out('7580774735460232339');" style=""> 599          }else if(selectNode.getKind() == LITERAL || selectNode.getKind() == LITERAL_CHAIN){//字面含义                 </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 600              return selectNode;                                                                                    </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 601          }else if(  AGGREGATE.contains(selectNode.getKind())                                                       </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 602                  || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                               </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 603                  || COMPARISON.contains(selectNode.getKind())                                                      </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 604                  || selectNode.getKind() == OTHER_FUNCTION                                                         </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 605                  || selectNode.getKind() == DIVIDE                                                                 </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 606                  || selectNode.getKind() == CAST                                                                   </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 607                  || selectNode.getKind() == TRIM                                                                   </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 608                  || selectNode.getKind() == TIMES                                                                  </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 609                  || selectNode.getKind() == PLUS                                                                   </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 610                  || selectNode.getKind() == NOT_IN                                                                 </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 611                  || selectNode.getKind() == OR                                                                     </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 612                  || selectNode.getKind() == AND                                                                    </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 613                  || selectNode.getKind() == MINUS                                                                  </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 614                  || selectNode.getKind() == TUMBLE                                                                 </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 615                  || selectNode.getKind() == TUMBLE_START                                                           </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 616                  || selectNode.getKind() == TUMBLE_END                                                             </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 617                  || selectNode.getKind() == SESSION                                                                </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 618                  || selectNode.getKind() == SESSION_START                                                          </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 619                  || selectNode.getKind() == SESSION_END                                                            </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 620                  || selectNode.getKind() == HOP                                                                    </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 621                  || selectNode.getKind() == HOP_START                                                              </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 622                  || selectNode.getKind() == HOP_END                                                                </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 623                  || selectNode.getKind() == BETWEEN                                                                </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 624                  || selectNode.getKind() == IS_NULL                                                                </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 625                  || selectNode.getKind() == IS_NOT_NULL                                                            </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 626                  || selectNode.getKind() == CONTAINS                                                               </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 627                  || selectNode.getKind() == TIMESTAMP_ADD                                                          </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 628                  || selectNode.getKind() == TIMESTAMP_DIFF                                                         </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 629                  || selectNode.getKind() == LIKE                                                                   </span>
<span  style=""> 630                                                                                                                    </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 631                  ){                                                                                                </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 632              SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                                </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 633              for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                               </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 634                  SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                                  </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 635                  if(sqlNode instanceof SqlLiteral){                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 636                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637                  }                                                                                                 </span>
<span  style=""> 638                                                                                                                    </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 639                  if(sqlNode instanceof SqlDataTypeSpec){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 640                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641                  }                                                                                                 </span>
<span  style=""> 642                                                                                                                    </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 643                  SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                               </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 644                  if(replaceNode == null){                                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 645                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646                  }                                                                                                 </span>
<span  style=""> 647                                                                                                                    </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 648                  sqlBasicCall.getOperands()[i] = replaceNode;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649              }                                                                                                     </span>
<span  style=""> 650                                                                                                                    </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 651              return selectNode;                                                                                    </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 652          }else if(selectNode.getKind() == CASE){                                                                   </span>
<span class="-6113591358780745482" onmouseenter="enter('-6113591358780745482');" onmouseout="out('-6113591358780745482');" style=""> 653              System.out.println(&quot;selectNode&quot;);                                                                     </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 654              SqlCase sqlCase = (SqlCase) selectNode;                                                               </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 655              SqlNodeList whenOperands = sqlCase.getWhenOperands();                                                 </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 656              SqlNodeList thenOperands = sqlCase.getThenOperands();                                                 </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 657              SqlNode elseNode = sqlCase.getElseOperand();                                                          </span>
<span  style=""> 658                                                                                                                    </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 659              for(int i=0; i&lt;whenOperands.size(); i++){                                                             </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 660                  SqlNode oneOperand = whenOperands.get(i);                                                         </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 661                  SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                            </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 662                  if (replaceNode != null) {                                                                        </span>
<span class="827753515492975605" onmouseenter="enter('827753515492975605');" onmouseout="out('827753515492975605');" style=""> 663                      whenOperands.set(i, replaceNode);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665              }                                                                                                     </span>
<span  style=""> 666                                                                                                                    </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 667              for(int i=0; i&lt;thenOperands.size(); i++){                                                             </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 668                  SqlNode oneOperand = thenOperands.get(i);                                                         </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 669                  SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                            </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 670                  if (replaceNode != null) {                                                                        </span>
<span class="-4947674979480974151" onmouseenter="enter('-4947674979480974151');" onmouseout="out('-4947674979480974151');" style=""> 671                      thenOperands.set(i, replaceNode);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673              }                                                                                                     </span>
<span  style=""> 674                                                                                                                    </span>
<span class="-1702904876822094161" onmouseenter="enter('-1702904876822094161');" onmouseout="out('-1702904876822094161');" style=""> 675              ((SqlCase) selectNode).setOperand(3, replaceSelectFieldName(elseNode, replaceInfo));                  </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 676              return selectNode;                                                                                    </span>
<span class="-6373545674230253671" onmouseenter="enter('-6373545674230253671');" onmouseout="out('-6373545674230253671');" style=""> 677          }else if(selectNode.getKind() == OTHER){                                                                  </span>
<span class="-5542086300788940380" onmouseenter="enter('-5542086300788940380');" onmouseout="out('-5542086300788940380');" style=""> 678              //不处理                                                                                                 </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 679              return selectNode;                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 680          }else{                                                                                                    </span>
<span class="1153766920564476840" onmouseenter="enter('1153766920564476840');" onmouseout="out('1153766920564476840');" style=""><abbr title=" 681              throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNode.getKind()));"> 681              throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNod🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683      }                                                                                                             </span>
<span  style=""> 684                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 685      /**                                                                                                           </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 686       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 686       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension 🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 687       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 688       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 689       */                                                                                                           </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 690      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 690      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTab🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 691          List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo);          </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 692          if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 693              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 695          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696      }                                                                                                             </span>
<span  style=""> 697                                                                                                                    </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 698      private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                               </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 699          List&lt;String&gt; res = Lists.newArrayList();                                                                  </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 700          sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                         </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 701              res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 702          });                                                                                                       </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 703          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704      }                                                                                                             </span>
<span  style=""> 705                                                                                                                    </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 706      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 706      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo s🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 707          List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                         </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 708          ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                          </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 709          List&lt;String&gt; conditionFields = Lists.newArrayList();                                                      </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 710          for(SqlNode sqlNode : sqlNodeList){                                                                       </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 711              if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                                </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 712                  throw new RuntimeException(&quot;not compare operator.&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713              }                                                                                                     </span>
<span  style=""> 714                                                                                                                    </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 715              SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                         </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 716              SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];                        </span>
<span  style=""> 717                                                                                                                    </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 718              String leftTableName = left.getComponent(0).getSimple();                                              </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 719              String rightTableName = right.getComponent(0).getSimple();                                            </span>
<span  style=""> 720                                                                                                                    </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 721              String tableCol = &quot;&quot;;                                                                                 </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 722              if(leftTableName.equalsIgnoreCase(specifyTableName)){                                                 </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 723                  tableCol = left.getComponent(1).getSimple();                                                      </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 724              }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                          </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 725                  tableCol = right.getComponent(1).getSimple();                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 726              }else{                                                                                                </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 727                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 727                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728              }                                                                                                     </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 729              tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);                        </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 730              conditionFields.add(tableCol);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731          }                                                                                                         </span>
<span  style=""> 732                                                                                                                    </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 733          return conditionFields;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734      }                                                                                                             </span>
<span  style=""> 735                                                                                                                    </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 736      protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                             </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 737                                       SqlNode pollSqlNode,                                                         </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 738                                       Map&lt;String, Table&gt; tableCache,                                               </span>
<span class="-3293670501905922467" onmouseenter="enter('-3293670501905922467');" onmouseout="out('-3293670501905922467');" style=""> 739                                       List&lt;FieldReplaceInfo&gt; replaceInfoList) throws SqlParseException {           </span>
<span  style=""> 740                                                                                                                    </span>
<span class="7772412594103241573" onmouseenter="enter('7772412594103241573');" onmouseout="out('7772412594103241573');" style=""> 741          AliasInfo aliasInfo = parseAsNode(pollSqlNode);                                                           </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 742          if (localTableCache.containsKey(aliasInfo.getName())) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 743              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744          }                                                                                                         </span>
<span  style=""> 745                                                                                                                    </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 746          Table table = tableEnv.sqlQuery(aliasInfo.getName());                                                     </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 747          tableEnv.registerTable(aliasInfo.getAlias(), table);                                                      </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 748          localTableCache.put(aliasInfo.getAlias(), table);                                                         </span>
<span  style=""> 749                                                                                                                    </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 750          LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                           </span>
<span  style=""> 751                                                                                                                    </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 752          FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);                 </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 753          if(fieldReplaceInfo == null){                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 754             return;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755          }                                                                                                         </span>
<span  style=""> 756                                                                                                                    </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 757          //as 的源表                                                                                                  </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 758          Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 759          SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                          </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 760          TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                                  </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 761          for(FieldReplaceInfo tmp : replaceInfoList){                                                              </span>
<span class="7807393280391431617" onmouseenter="enter('7807393280391431617');" onmouseout="out('7807393280391431617');" style=""> 762              if(fromTableNameSet.contains(tmp.getTargetTableName())                                                </span>
<span class="-8987246733617074829" onmouseenter="enter('-8987246733617074829');" onmouseout="out('-8987246733617074829');" style=""> 763                      || fromTableNameSet.contains(tmp.getTargetTableAlias())){                                     </span>
<span class="-8130963267335023429" onmouseenter="enter('-8130963267335023429');" onmouseout="out('-8130963267335023429');" style=""> 764                  fieldReplaceInfo.setPreNode(tmp);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 765                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767          }                                                                                                         </span>
<span class="2047826278835391080" onmouseenter="enter('2047826278835391080');" onmouseout="out('2047826278835391080');" style=""> 768          replaceInfoList.add(fieldReplaceInfo);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769      }                                                                                                             </span>
<span  style=""> 770                                                                                                                    </span>
<span class="4197581530070317287" onmouseenter="enter('4197581530070317287');" onmouseout="out('4197581530070317287');" style=""> 771      private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache,                                      </span>
<span class="-7423850058561480692" onmouseenter="enter('-7423850058561480692');" onmouseout="out('-7423850058561480692');" style=""> 772                           Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,        </span>
<span class="-2956355081691304387" onmouseenter="enter('-2956355081691304387');" onmouseout="out('-2956355081691304387');" style=""> 773                           List&lt;FieldReplaceInfo&gt; replaceInfoList) throws Exception{                                </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 774          JoinInfo joinInfo = (JoinInfo) pollObj;                                                                   </span>
<span  style=""> 775                                                                                                                    </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 776          JoinScope joinScope = new JoinScope();                                                                    </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 777          JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                         </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 778          leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                                    </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 779          leftScopeChild.setTableName(joinInfo.getLeftTableName());                                                 </span>
<span  style=""> 780                                                                                                                    </span>
<span class="-3105793890099317611" onmouseenter="enter('-3105793890099317611');" onmouseout="out('-3105793890099317611');" style=""> 781          SqlKind sqlKind = joinInfo.getLeftNode().getKind();                                                       </span>
<span class="9064898697795185402" onmouseenter="enter('9064898697795185402');" onmouseout="out('9064898697795185402');" style=""> 782          if(sqlKind == AS){                                                                                        </span>
<span class="17281975900406720" onmouseenter="enter('17281975900406720');" onmouseout="out('17281975900406720');" style=""> 783              dealAsSourceTable(tableEnv, joinInfo.getLeftNode(), localTableCache, replaceInfoList);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784          }                                                                                                         </span>
<span  style=""> 785                                                                                                                    </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 786          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 786          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableNa🔵</abbr></span>
<span class="5224542232803887157" onmouseenter="enter('5224542232803887157');" onmouseout="out('5224542232803887157');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 787 -        RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getTypes(), leftTable.getSchema().getColumnNames());"> 787 -        RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getTypes(), leftTable.getSchema().getColu🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 788 +                                                                                                                  </span>
<span class="-6003115091233455661" onmouseenter="enter('-6003115091233455661');" onmouseout="out('-6003115091233455661');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 789 +        RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().getFieldNames());"> 789 +        RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getFieldTypes(), leftTable.getSchema().ge🔵</abbr></span>
<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 790          leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                              </span>
<span  style=""> 791                                                                                                                    </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 792          JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                                        </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 793          rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                                  </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 794          rightScopeChild.setTableName(joinInfo.getRightTableName());                                               </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 795          AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());                     </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 796          if(sideTableInfo == null){                                                                                </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 797              sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798          }                                                                                                         </span>
<span  style=""> 799                                                                                                                    </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 800          if(sideTableInfo == null){                                                                                </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 801              throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802          }                                                                                                         </span>
<span  style=""> 803                                                                                                                    </span>
<span class="-4291640841301797203" onmouseenter="enter('-4291640841301797203');" onmouseout="out('-4291640841301797203');" style=""> 804          if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){           </span>
<span class="1819597685441785160" onmouseenter="enter('1819597685441785160');" onmouseout="out('1819597685441785160');" style=""> 805              throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806          }                                                                                                         </span>



<span  style=""> 807                                                                                                                    </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 808          rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                           </span>
<span  style=""> 809                                                                                                                    </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 810          joinScope.addScope(leftScopeChild);                                                                       </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 811          joinScope.addScope(rightScopeChild);                                                                      </span>
<span  style=""> 812                                                                                                                    </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 813          //获取两个表的所有字段                                                                                              </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 814          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 814          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, tr🔵</abbr></span>
<span  style=""> 815                                                                                                                    </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 816          String leftTableAlias = joinInfo.getLeftTableAlias();                                                     </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 817          Table targetTable = localTableCache.get(leftTableAlias);                                                  </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 818          if(targetTable == null){                                                                                  </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 819              targetTable = localTableCache.get(joinInfo.getLeftTableName());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820          }                                                                                                         </span>
<span  style=""> 821                                                                                                                    </span>
<span class="3450476289809538439" onmouseenter="enter('3450476289809538439');" onmouseout="out('3450476289809538439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 822 -        RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getTypes(), targetTable.getSchema().getColumnNames());"> 822 -        RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getTypes(), targetTable.getSchema().getColu🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 823 -                                                                                                                  </span>
<span class="-3004779098663820792" onmouseenter="enter('-3004779098663820792');" onmouseout="out('-3004779098663820792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 824 -        DataStream&lt;CRow&gt; adaptStream = tableEnv.toRetractStream(targetTable, org.apache.flink.types.Row.class)    </span>
<span class="3479563451496228205" onmouseenter="enter('3479563451496228205');" onmouseout="out('3479563451496228205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 825 -                .map((Tuple2&lt;Boolean, Row&gt; tp2) -&gt; {                                                              </span>
<span class="7833906289428987345" onmouseenter="enter('7833906289428987345');" onmouseout="out('7833906289428987345');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 826 -                    return new CRow(tp2.f1, tp2.f0);                                                              </span>
<span class="-8730504840947162971" onmouseenter="enter('-8730504840947162971');" onmouseout="out('-8730504840947162971');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 827 -                }).returns(CRow.class);                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 828 -                                                                                                                  </span>
<span class="-1157067725052643612" onmouseenter="enter('-1157067725052643612');" onmouseout="out('-1157067725052643612');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 829 +        RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().getFieldNames());"> 829 +        RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getFieldTypes(), targetTable.getSchema().ge🔵</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 830 +                                                                                                                  </span>
<span class="8331408572102109154" onmouseenter="enter('8331408572102109154');" onmouseout="out('8331408572102109154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 831 +        DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; adaptStream = tableEnv.toRetractStream(targetTable, Row.class);          </span>
<span  style=""> 832                                                                                                                    </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 833          //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async              </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 834          if (sideTableInfo.isPartitionedJoin()) {                                                                  </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 835              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 835              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 836              List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());                     </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 837              int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();                    </span>
<span class="-7482412719932836963" onmouseenter="enter('-7482412719932836963');" onmouseout="out('-7482412719932836963');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 838 -            adaptStream = adaptStream.keyBy(new CRowKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 838 -            adaptStream = adaptStream.keyBy(new CRowKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 839 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 840 -                                                                                                                  </span>
<span class="-1065289666164106717" onmouseenter="enter('-1065289666164106717');" onmouseout="out('-1065289666164106717');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 841 -        DataStream&lt;CRow&gt; dsOut = null;                                                                            </span>
<span class="-1034511431639552497" onmouseenter="enter('-1034511431639552497');" onmouseout="out('-1034511431639552497');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 842 +            adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 842 +            adaptStream = adaptStream.keyBy(new TupleKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 843 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 844 +                                                                                                                  </span>
<span class="8900898589811243168" onmouseenter="enter('8900898589811243168');" onmouseout="out('8900898589811243168');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 845 +        DataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; dsOut = null;                                                            </span>
<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 846          if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                                 </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 847              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 847              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlP🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 848          }else{                                                                                                    </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 849              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 849              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPa🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850          }                                                                                                         </span>
<span  style=""> 851                                                                                                                    </span>
<span class="1587039608171825646" onmouseenter="enter('1587039608171825646');" onmouseout="out('1587039608171825646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 852 -        // TODO  将嵌套表中的字段传递过去, 去除冗余的ROWtime                                                                       </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 853          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 854          RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);                       </span>
<span  style=""> 855                                                                                                                    </span>
<span class="-1611735526649110750" onmouseenter="enter('-1611735526649110750');" onmouseout="out('-1611735526649110750');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 856 -        CRowTypeInfo cRowTypeInfo = new CRowTypeInfo(sideOutTypeInfo);                                            </span>
<span class="-4428554219841205830" onmouseenter="enter('-4428554219841205830');" onmouseout="out('-4428554219841205830');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 857 -        dsOut.getTransformation().setOutputType(cRowTypeInfo);                                                    </span>
<span class="993314962060447081" onmouseenter="enter('993314962060447081');" onmouseout="out('993314962060447081');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 858 +        TupleTypeInfo tupleTypeInfo = new TupleTypeInfo(Types.BOOLEAN, sideOutTypeInfo);                          </span>
<span class="6600937869795732915" onmouseenter="enter('6600937869795732915');" onmouseout="out('6600937869795732915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 859 +        dsOut.getTransformation().setOutputType(tupleTypeInfo);                                                   </span>
<span  style=""> 860                                                                                                                    </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 861          String targetTableName = joinInfo.getNewTableName();                                                      </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 862          String targetTableAlias = joinInfo.getNewTableAlias();                                                    </span>
<span  style=""> 863                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 864          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 865          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 866          replaceInfo.setTargetTableName(targetTableName);                                                          </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 867          replaceInfo.setTargetTableAlias(targetTableAlias);                                                        </span>
<span  style=""> 868                                                                                                                    </span>
<span class="-3207655655806857927" onmouseenter="enter('-3207655655806857927');" onmouseout="out('-3207655655806857927');" style=""> 869          //判断之前是不是被替换过,被替换过则设置之前的替换信息作为上一个节点                                                                       </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 870          for(FieldReplaceInfo tmp : replaceInfoList){                                                              </span>
<span class="6967693276121741260" onmouseenter="enter('6967693276121741260');" onmouseout="out('6967693276121741260');" style=""> 871              if(tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName())                             </span>
<span class="8344413733256472211" onmouseenter="enter('8344413733256472211');" onmouseout="out('8344413733256472211');" style=""> 872              ||tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableAlias())){                           </span>
<span class="-1629804985910745096" onmouseenter="enter('-1629804985910745096');" onmouseout="out('-1629804985910745096');" style=""> 873                  replaceInfo.setPreNode(tmp);                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 874                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876          }                                                                                                         </span>
<span  style=""> 877                                                                                                                    </span>
<span class="2528453225163613561" onmouseenter="enter('2528453225163613561');" onmouseout="out('2528453225163613561');" style=""> 878          replaceInfoList.add(replaceInfo);                                                                         </span>
<span  style=""> 879                                                                                                                    </span>
<span class="1268462607712077740" onmouseenter="enter('1268462607712077740');" onmouseout="out('1268462607712077740');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 880 -        if (!tableEnv.isRegistered(joinInfo.getNewTableName())){                                                  </span>
<span class="6259278273454558932" onmouseenter="enter('6259278273454558932');" onmouseout="out('6259278273454558932');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 881 +        List&lt;String&gt; registeredTableName = Arrays.asList(tableEnv.listTables());                                  </span>
<span class="6143756220473458570" onmouseenter="enter('6143756220473458570');" onmouseout="out('6143756220473458570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 882 +        if (!registeredTableName.contains(joinInfo.getNewTableName())){                                           </span>
<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 883              Table joinTable = tableEnv.fromDataStream(dsOut);                                                     </span>
<span class="-7674974637599312088" onmouseenter="enter('-7674974637599312088');" onmouseout="out('-7674974637599312088');" style=""> 884              tableEnv.registerTable(joinInfo.getNewTableName(), joinTable);                                        </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 885              localTableCache.put(joinInfo.getNewTableName(), joinTable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887      }                                                                                                             </span>
<span  style=""> 888                                                                                                                    </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 889      private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                            </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 890          String[] fieldNames = schema.getFieldNames();                                                             </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 891          TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                                 </span>
<span  style=""> 892                                                                                                                    </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""> 893          String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);      </span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 894          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 894          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformat🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 895          return new RowTypeInfo(projectedTypes, projectedNames);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 896      }                                                                                                             </span>
<span  style=""> 897                                                                                                                    </span>
<span  style=""> 898                                                                                                                    </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 899      private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {                   </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 900          List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                             </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 901          String fieldsInfo = result.getFieldsInfoStr();                                                            </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 902          String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                                     </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 903          for (int i = 0; i &lt; fields.length; i++) {                                                                 </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 904              String[] filed = fields[i].split(&quot;\\s&quot;);                                                              </span>
<span class="-1166806966413379737" onmouseenter="enter('-1166806966413379737');" onmouseout="out('-1166806966413379737');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 905 -            if (filed.length &lt; 2 || fields.length != table.getSchema().getColumnNames().length){                  </span>
<span class="5889723123831816710" onmouseenter="enter('5889723123831816710');" onmouseout="out('5889723123831816710');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 906 +            if (filed.length &lt; 2 || fields.length != table.getSchema().getFieldCount()){                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 907                  return false;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 908              } else {                                                                                              </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 909                  String[] filedNameArr = new String[filed.length - 1];                                             </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 910                  System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                                    </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 911                  String fieldName = String.join(&quot; &quot;, filedNameArr);                                                </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 912                  fieldNames.add(fieldName);                                                                        </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 913                  String fieldType = filed[filed.length - 1 ].trim();                                               </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 914                  Class fieldClass = ClassUtil.stringConvertClass(fieldType);                                       </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 915                  Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();                        </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 916                  if (fieldClass == tableField){                                                                    </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 917                      continue;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 918                  } else {                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 919                      return false;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 920                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 921              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 922          }                                                                                                         </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 923          tmpFields = String.join(&quot;,&quot;, fieldNames);                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 924          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925      }                                                                                                             </span>
<span  style=""> 926                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  22                                                                                                                    </span>
<span class="-4869246525166490693" onmouseenter="enter('-4869246525166490693');" onmouseout="out('-4869246525166490693');" style="">  23  import org.apache.flink.api.common.typeinfo.TypeInformation;                                                      </span>

<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  24  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  25  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>

<span class="329774846923224587" onmouseenter="enter('329774846923224587');" onmouseout="out('329774846923224587');" style="">  26  import org.apache.flink.streaming.api.datastream.DataStream;                                                      </span>
<span class="2542322018203740202" onmouseenter="enter('2542322018203740202');" onmouseout="out('2542322018203740202');" style="">  27  import org.apache.flink.table.api.StreamQueryConfig;                                                              </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  28  import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-8888728238394280005" onmouseenter="enter('-8888728238394280005');" onmouseout="out('-8888728238394280005');" style="">  29  import org.apache.flink.table.api.TableSchema;                                                                    </span>
<span class="776922417053783834" onmouseenter="enter('776922417053783834');" onmouseout="out('776922417053783834');" style="">  30  import org.apache.flink.table.api.java.StreamTableEnvironment;                                                    </span>
<span class="-6266446094177003082" onmouseenter="enter('-6266446094177003082');" onmouseout="out('-6266446094177003082');" style="">  31  import org.apache.flink.table.runtime.CRowKeySelector;                                                            </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  32  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="5605277811729025111" onmouseenter="enter('5605277811729025111');" onmouseout="out('5605277811729025111');" style="">  33  import org.apache.flink.table.runtime.types.CRowTypeInfo;                                                         </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  34  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  35  import org.apache.flink.types.Row;                                                                                </span>
<span  style="">  36                                                                                                                    </span>
<span class="8826438848011158297" onmouseenter="enter('8826438848011158297');" onmouseout="out('8826438848011158297');" style="">  37  import com.dtstack.flink.sql.enums.ECacheType;                                                                    </span>
<span class="1760694872476698727" onmouseenter="enter('1760694872476698727');" onmouseout="out('1760694872476698727');" style="">  38  import com.dtstack.flink.sql.exec.FlinkSQLExec;                                                                   </span>
<span class="2626775214998945029" onmouseenter="enter('2626775214998945029');" onmouseout="out('2626775214998945029');" style="">  39  import com.dtstack.flink.sql.parser.CreateTmpTableParser;                                                         </span>
<span class="7697893187981436175" onmouseenter="enter('7697893187981436175');" onmouseout="out('7697893187981436175');" style="">  40  import com.dtstack.flink.sql.side.operator.SideAsyncOperator;                                                     </span>
<span class="-7456990469468101750" onmouseenter="enter('-7456990469468101750');" onmouseout="out('-7456990469468101750');" style="">  41  import com.dtstack.flink.sql.side.operator.SideWithAllCacheOperator;                                              </span>
<span class="4874498590411064411" onmouseenter="enter('4874498590411064411');" onmouseout="out('4874498590411064411');" style="">  42  import com.dtstack.flink.sql.util.ClassUtil;                                                                      </span>
<span class="-4585055968129153397" onmouseenter="enter('-4585055968129153397');" onmouseout="out('-4585055968129153397');" style="">  43  import com.dtstack.flink.sql.util.ParseUtils;                                                                     </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  44  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  45  import com.google.common.base.Preconditions;                                                                      </span>
<span class="-5849322492369628764" onmouseenter="enter('-5849322492369628764');" onmouseout="out('-5849322492369628764');" style="">  46  import com.google.common.collect.HashBasedTable;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  47  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  48  import com.google.common.collect.Maps;                                                                            </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  49  import com.google.common.collect.Sets;                                                                            </span>
<span class="-6347312057640942811" onmouseenter="enter('-6347312057640942811');" onmouseout="out('-6347312057640942811');" style="">  50  import org.apache.calcite.sql.SqlAsOperator;                                                                      </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  51  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="166699767162158130" onmouseenter="enter('166699767162158130');" onmouseout="out('166699767162158130');" style="">  52  import org.apache.calcite.sql.SqlDataTypeSpec;                                                                    </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  53  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  54  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  55  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  56  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="8852969977988754364" onmouseenter="enter('8852969977988754364');" onmouseout="out('8852969977988754364');" style="">  57  import org.apache.calcite.sql.SqlLiteral;                                                                         </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  58  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  59  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="2919518510870551176" onmouseenter="enter('2919518510870551176');" onmouseout="out('2919518510870551176');" style="">  60  import org.apache.calcite.sql.SqlOperator;                                                                        </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  61  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  62  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  63  import org.apache.calcite.sql.SqlWithItem;                                                                        </span>
<span class="7522331514027736252" onmouseenter="enter('7522331514027736252');" onmouseout="out('7522331514027736252');" style="">  64  import org.apache.calcite.sql.fun.SqlCase;                                                                        </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  65  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="-8475519504744506507" onmouseenter="enter('-8475519504744506507');" onmouseout="out('-8475519504744506507');" style="">  66  import org.apache.calcite.sql.parser.SqlParserPos;                                                                </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  67  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  68  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  69  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  70  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  71                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  72  import java.sql.Timestamp;                                                                                        </span>

<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  73  import java.util.Arrays;                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  74  import java.util.Collection;                                                                                      </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  75  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  76  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  77  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  78  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  79  import java.util.Set;                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  81  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span  style="">  82                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  84   * Reason:                                                                                                        </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  85   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  86   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  87   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88   */                                                                                                               </span>
<span  style="">  89                                                                                                                    </span>
<span class="-5079038956292767116" onmouseenter="enter('-5079038956292767116');" onmouseout="out('-5079038956292767116');" style="">  90  public class SideSqlExec {                                                                                        </span>
<span  style="">  91                                                                                                                    </span>
<span class="-8991898280301588076" onmouseenter="enter('-8991898280301588076');" onmouseout="out('-8991898280301588076');" style="">  92      private static final Logger LOG = LoggerFactory.getLogger(SideSqlExec.class);                                 </span>
<span  style="">  93                                                                                                                    </span>
<span class="-6334022460956670337" onmouseenter="enter('-6334022460956670337');" onmouseout="out('-6334022460956670337');" style="">  94      private String localSqlPluginPath = null;                                                                     </span>
<span  style="">  95                                                                                                                    </span>
<span class="-863593709646632598" onmouseenter="enter('-863593709646632598');" onmouseout="out('-863593709646632598');" style="">  96      private String tmpFields = null;                                                                              </span>
<span  style="">  97                                                                                                                    </span>
<span class="8878309237265342483" onmouseenter="enter('8878309237265342483');" onmouseout="out('8878309237265342483');" style="">  98      private SidePredicatesParser sidePredicatesParser = new SidePredicatesParser();                               </span>
<span  style="">  99                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style=""> 100      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-2568962717532337416" onmouseenter="enter('-2568962717532337416');" onmouseout="out('-2568962717532337416');" style=""> 102      public void exec(String sql, Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,</span>
<span class="1000260034925957386" onmouseenter="enter('1000260034925957386');" onmouseout="out('1000260034925957386');" style=""><abbr title=" 103                       Map&lt;String, Table&gt; tableCache, StreamQueryConfig queryConfig, CreateTmpTableParser.SqlParserResult createView) throws Exception {"> 103                       Map&lt;String, Table&gt; tableCache, StreamQueryConfig queryConfig, CreateTmpTableParser.SqlParserR🔵</abbr></span>

<span class="-7184346740499807144" onmouseenter="enter('-7184346740499807144');" onmouseout="out('-7184346740499807144');" style=""> 104          if(localSqlPluginPath == null){                                                                           </span>
<span class="4243357528698157424" onmouseenter="enter('4243357528698157424');" onmouseout="out('4243357528698157424');" style=""> 105              throw new RuntimeException(&quot;need to set localSqlPluginPath&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106          }                                                                                                         </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-6307578536739293325" onmouseenter="enter('-6307578536739293325');" onmouseout="out('-6307578536739293325');" style=""> 108          localTableCache.putAll(tableCache);                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 109          try {                                                                                                     </span>
<span class="-7778408363768085476" onmouseenter="enter('-7778408363768085476');" onmouseout="out('-7778408363768085476');" style=""> 110              sidePredicatesParser.fillPredicatesForSideTable(sql, sideTableMap);                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 111          } catch (Exception e) {                                                                                   </span>
<span class="-6535415982741029210" onmouseenter="enter('-6535415982741029210');" onmouseout="out('-6535415982741029210');" style=""> 112              LOG.error(&quot;fill predicates for sideTable fail &quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113          }                                                                                                         </span>
<span  style=""> 114                                                                                                                    </span>
<span class="5869130575145188486" onmouseenter="enter('5869130575145188486');" onmouseout="out('5869130575145188486');" style=""> 115          if(createView != null){                                                                                   </span>
<span class="-5051922790285322929" onmouseenter="enter('-5051922790285322929');" onmouseout="out('-5051922790285322929');" style=""> 116              LOG.warn(&quot;create view info\n&quot;);                                                                       </span>
<span class="4994977519661454238" onmouseenter="enter('4994977519661454238');" onmouseout="out('4994977519661454238');" style=""> 117              LOG.warn(createView.getExecSql());                                                                    </span>
<span class="-6048507734051622776" onmouseenter="enter('-6048507734051622776');" onmouseout="out('-6048507734051622776');" style=""> 118              LOG.warn(&quot;-----------------&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119          }                                                                                                         </span>
<span  style=""> 120                                                                                                                    </span>
<span class="3272289589011229925" onmouseenter="enter('3272289589011229925');" onmouseout="out('3272289589011229925');" style=""> 121          SideSQLParser sideSQLParser = new SideSQLParser();                                                        </span>
<span class="9221221341975786732" onmouseenter="enter('9221221341975786732');" onmouseout="out('9221221341975786732');" style=""> 122          sideSQLParser.setLocalTableCache(localTableCache);                                                        </span>
<span class="-1577132173025596093" onmouseenter="enter('-1577132173025596093');" onmouseout="out('-1577132173025596093');" style=""> 123          Queue&lt;Object&gt; exeQueue = sideSQLParser.getExeQueue(sql, sideTableMap.keySet());                           </span>
<span class="1917635497637273504" onmouseenter="enter('1917635497637273504');" onmouseout="out('1917635497637273504');" style=""> 124          Object pollObj = null;                                                                                    </span>
<span  style=""> 125                                                                                                                    </span>
<span class="6779353451040372641" onmouseenter="enter('6779353451040372641');" onmouseout="out('6779353451040372641');" style=""> 126          //need clean                                                                                              </span>
<span class="4055483294687718975" onmouseenter="enter('4055483294687718975');" onmouseout="out('4055483294687718975');" style=""> 127          boolean preIsSideJoin = false;                                                                            </span>
<span class="2266898631888830275" onmouseenter="enter('2266898631888830275');" onmouseout="out('2266898631888830275');" style=""> 128          List&lt;FieldReplaceInfo&gt; replaceInfoList = Lists.newArrayList();                                            </span>
<span  style=""> 129                                                                                                                    </span>
<span class="6128441282435403378" onmouseenter="enter('6128441282435403378');" onmouseout="out('6128441282435403378');" style=""> 130          while((pollObj = exeQueue.poll()) != null){                                                               </span>
<span  style=""> 131                                                                                                                    </span>
<span class="138624831707193108" onmouseenter="enter('138624831707193108');" onmouseout="out('138624831707193108');" style=""> 132              if(pollObj instanceof SqlNode){                                                                       </span>
<span class="-8817010307772649906" onmouseenter="enter('-8817010307772649906');" onmouseout="out('-8817010307772649906');" style=""> 133                  SqlNode pollSqlNode = (SqlNode) pollObj;                                                          </span>
<span  style=""> 134                                                                                                                    </span>
<span class="-3934441269421991372" onmouseenter="enter('-3934441269421991372');" onmouseout="out('-3934441269421991372');" style=""> 135                  if(preIsSideJoin){                                                                                </span>
<span class="313285673257348059" onmouseenter="enter('313285673257348059');" onmouseout="out('313285673257348059');" style=""> 136                      preIsSideJoin = false;                                                                        </span>
<span class="-2618061440979010579" onmouseenter="enter('-2618061440979010579');" onmouseout="out('-2618061440979010579');" style=""> 137                      List&lt;String&gt; fieldNames = null;                                                               </span>
<span class="-7322309591596780027" onmouseenter="enter('-7322309591596780027');" onmouseout="out('-7322309591596780027');" style=""> 138                      for(FieldReplaceInfo replaceInfo : replaceInfoList){                                          </span>
<span class="2418913985965727773" onmouseenter="enter('2418913985965727773');" onmouseout="out('2418913985965727773');" style=""> 139                          fieldNames = Lists.newArrayList();                                                        </span>
<span class="-6690427821834278824" onmouseenter="enter('-6690427821834278824');" onmouseout="out('-6690427821834278824');" style=""> 140                          replaceFieldName(pollSqlNode, replaceInfo);                                               </span>
<span class="8246822691580888265" onmouseenter="enter('8246822691580888265');" onmouseout="out('8246822691580888265');" style=""> 141                          addAliasForFieldNode(pollSqlNode, fieldNames, replaceInfo.getMappingTable());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                  }                                                                                                 </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2885719311179922220" onmouseenter="enter('-2885719311179922220');" onmouseout="out('-2885719311179922220');" style=""> 145                  if(pollSqlNode.getKind() == INSERT){                                                              </span>
<span class="-377775665442624374" onmouseenter="enter('-377775665442624374');" onmouseout="out('-377775665442624374');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -                    System.out.println(&quot;----------real exec sql-----------&quot; );                                    </span>
<span class="1909873149730143207" onmouseenter="enter('1909873149730143207');" onmouseout="out('1909873149730143207');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -                    System.out.println(pollSqlNode.toString());                                                   </span>
<span class="-7041171683301857607" onmouseenter="enter('-7041171683301857607');" onmouseout="out('-7041171683301857607');" style=""> 148                      FlinkSQLExec.sqlUpdate(tableEnv, pollSqlNode.toString(), queryConfig);                        </span>

<span class="3766255850891299565" onmouseenter="enter('3766255850891299565');" onmouseout="out('3766255850891299565');" style=""> 149                      if(LOG.isInfoEnabled()){                                                                      </span>
<span class="8297270454157551832" onmouseenter="enter('8297270454157551832');" onmouseout="out('8297270454157551832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -                        LOG.info(&quot;exec sql: &quot; + pollSqlNode.toString());                                          </span>
<span class="-5986232783970891998" onmouseenter="enter('-5986232783970891998');" onmouseout="out('-5986232783970891998');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                        LOG.info(&quot;----------real exec sql-----------\n{}&quot;, pollSqlNode.toString());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                      }                                                                                             </span>
<span  style=""> 153                                                                                                                    </span>
<span class="4666687505712980858" onmouseenter="enter('4666687505712980858');" onmouseout="out('4666687505712980858');" style=""> 154                  }else if(pollSqlNode.getKind() == AS){                                                            </span>
<span class="-4906327517343466594" onmouseenter="enter('-4906327517343466594');" onmouseout="out('-4906327517343466594');" style=""> 155                      dealAsSourceTable(tableEnv, pollSqlNode, tableCache, replaceInfoList);                        </span>
<span  style=""> 156                                                                                                                    </span>
<span class="4581342471671871622" onmouseenter="enter('4581342471671871622');" onmouseout="out('4581342471671871622');" style=""> 157                  } else if (pollSqlNode.getKind() == WITH_ITEM) {                                                  </span>
<span class="9089825500288046356" onmouseenter="enter('9089825500288046356');" onmouseout="out('9089825500288046356');" style=""> 158                      SqlWithItem sqlWithItem = (SqlWithItem) pollSqlNode;                                          </span>
<span class="-7674640876687845363" onmouseenter="enter('-7674640876687845363');" onmouseout="out('-7674640876687845363');" style=""> 159                      String TableAlias = sqlWithItem.name.toString();                                              </span>
<span class="2573668668184904794" onmouseenter="enter('2573668668184904794');" onmouseout="out('2573668668184904794');" style=""> 160                      Table table = tableEnv.sqlQuery(sqlWithItem.query.toString());                                </span>
<span class="2341577843786962651" onmouseenter="enter('2341577843786962651');" onmouseout="out('2341577843786962651');" style=""> 161                      tableEnv.registerTable(TableAlias, table);                                                    </span>
<span  style=""> 162                                                                                                                    </span>
<span class="-8892059869421071039" onmouseenter="enter('-8892059869421071039');" onmouseout="out('-8892059869421071039');" style=""> 163                  } else if (pollSqlNode.getKind() == SELECT){                                                      </span>
<span class="-1344441018307209750" onmouseenter="enter('-1344441018307209750');" onmouseout="out('-1344441018307209750');" style=""> 164                      Preconditions.checkState(createView != null, &quot;select sql must included by create view&quot;);      </span>
<span class="1694293925390283740" onmouseenter="enter('1694293925390283740');" onmouseout="out('1694293925390283740');" style=""> 165                      Table table = tableEnv.sqlQuery(pollObj.toString());                                          </span>
<span  style=""> 166                                                                                                                    </span>
<span class="-5832165917407529739" onmouseenter="enter('-5832165917407529739');" onmouseout="out('-5832165917407529739');" style=""> 167                      if (createView.getFieldsInfoStr() == null){                                                   </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 168                          tableEnv.registerTable(createView.getTableName(), table);                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 169                      } else {                                                                                      </span>
<span class="5288384657559945705" onmouseenter="enter('5288384657559945705');" onmouseout="out('5288384657559945705');" style=""> 170                          if (checkFieldsInfo(createView, table)){                                                  </span>
<span class="-9109211084540213069" onmouseenter="enter('-9109211084540213069');" onmouseout="out('-9109211084540213069');" style=""> 171                              table = table.as(tmpFields);                                                          </span>
<span class="-6627833070720611070" onmouseenter="enter('-6627833070720611070');" onmouseout="out('-6627833070720611070');" style=""> 172                              tableEnv.registerTable(createView.getTableName(), table);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 173                          } else {                                                                                  </span>
<span class="-4180003952862210397" onmouseenter="enter('-4180003952862210397');" onmouseout="out('-4180003952862210397');" style=""> 174                              throw new RuntimeException(&quot;Fields mismatch&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                      }                                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="-5831701022468144749" onmouseenter="enter('-5831701022468144749');" onmouseout="out('-5831701022468144749');" style=""> 178                      localTableCache.put(createView.getTableName(), table);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179                  }                                                                                                 </span>
<span  style=""> 180                                                                                                                    </span>
<span class="2267959141426380188" onmouseenter="enter('2267959141426380188');" onmouseout="out('2267959141426380188');" style=""> 181              }else if (pollObj instanceof JoinInfo){                                                               </span>
<span class="-6732469083744011720" onmouseenter="enter('-6732469083744011720');" onmouseout="out('-6732469083744011720');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -                System.out.println(&quot;----------exec join info----------&quot;);                                         </span>
<span class="6437130050258637649" onmouseenter="enter('6437130050258637649');" onmouseout="out('6437130050258637649');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -                System.out.println(pollObj.toString());                                                           </span>
<span class="-6196622619540139248" onmouseenter="enter('-6196622619540139248');" onmouseout="out('-6196622619540139248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                LOG.info(&quot;----------exec join info----------\n{}&quot;, pollObj.toString());                           </span>
<span class="-4508108017455823844" onmouseenter="enter('-4508108017455823844');" onmouseout="out('-4508108017455823844');" style=""> 185                  preIsSideJoin = true;                                                                             </span>
<span class="-9158044292308775618" onmouseenter="enter('-9158044292308775618');" onmouseout="out('-9158044292308775618');" style=""> 186                  joinFun(pollObj, localTableCache, sideTableMap, tableEnv, replaceInfoList);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188          }                                                                                                         </span>
<span  style=""> 189                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190      }                                                                                                             </span>
<span  style=""> 191                                                                                                                    </span>
<span  style=""> 192                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 193      /**                                                                                                           </span>
<span class="-7226459799151937672" onmouseenter="enter('-7226459799151937672');" onmouseout="out('-7226459799151937672');" style=""> 194       * 解析出as查询的表和字段的关系                                                                                            </span>
<span class="-4711911052088894915" onmouseenter="enter('-4711911052088894915');" onmouseout="out('-4711911052088894915');" style=""> 195       * @param asSqlNode                                                                                           </span>
<span class="-8172984871762282794" onmouseenter="enter('-8172984871762282794');" onmouseout="out('-8172984871762282794');" style=""> 196       * @param tableCache                                                                                          </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 197       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 198       */                                                                                                           </span>
<span class="-8315666616430025383" onmouseenter="enter('-8315666616430025383');" onmouseout="out('-8315666616430025383');" style=""> 199      private FieldReplaceInfo parseAsQuery(SqlBasicCall asSqlNode, Map&lt;String, Table&gt; tableCache){                 </span>
<span class="-4950849472737015743" onmouseenter="enter('-4950849472737015743');" onmouseout="out('-4950849472737015743');" style=""> 200          SqlNode info = asSqlNode.getOperands()[0];                                                                </span>
<span class="-6049998703041327008" onmouseenter="enter('-6049998703041327008');" onmouseout="out('-6049998703041327008');" style=""> 201          SqlNode alias = asSqlNode.getOperands()[1];                                                               </span>
<span  style=""> 202                                                                                                                    </span>
<span class="6169254144825097648" onmouseenter="enter('6169254144825097648');" onmouseout="out('6169254144825097648');" style=""> 203          SqlKind infoKind = info.getKind();                                                                        </span>
<span class="-8998816044463313680" onmouseenter="enter('-8998816044463313680');" onmouseout="out('-8998816044463313680');" style=""> 204          if(infoKind != SELECT){                                                                                   </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 205              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206          }                                                                                                         </span>
<span  style=""> 207                                                                                                                    </span>
<span class="1448651332248375248" onmouseenter="enter('1448651332248375248');" onmouseout="out('1448651332248375248');" style=""> 208          List&lt;FieldInfo&gt; extractFieldList = TableUtils.parserSelectField((SqlSelect) info, tableCache);            </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 210          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="-5476396715494077219" onmouseenter="enter('-5476396715494077219');" onmouseout="out('-5476396715494077219');" style=""> 211          for (FieldInfo fieldInfo : extractFieldList) {                                                            </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 212              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 213              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 214              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 215              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216          }                                                                                                         </span>
<span  style=""> 217                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 218          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 219          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="9115675088981905484" onmouseenter="enter('9115675088981905484');" onmouseout="out('9115675088981905484');" style=""> 220          replaceInfo.setTargetTableName(alias.toString());                                                         </span>
<span class="-6295883374697236710" onmouseenter="enter('-6295883374697236710');" onmouseout="out('-6295883374697236710');" style=""> 221          replaceInfo.setTargetTableAlias(alias.toString());                                                        </span>
<span class="2754859294214862032" onmouseenter="enter('2754859294214862032');" onmouseout="out('2754859294214862032');" style=""> 222          return replaceInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span  style=""> 224                                                                                                                    </span>
<span  style=""> 225                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 226      /**                                                                                                           </span>
<span class="-3820374652196669145" onmouseenter="enter('-3820374652196669145');" onmouseout="out('-3820374652196669145');" style=""> 227       * 添加字段别名                                                                                                     </span>
<span class="9038438555178000204" onmouseenter="enter('9038438555178000204');" onmouseout="out('9038438555178000204');" style=""> 228       * @param pollSqlNode                                                                                         </span>
<span class="-5133777749030939729" onmouseenter="enter('-5133777749030939729');" onmouseout="out('-5133777749030939729');" style=""> 229       * @param fieldList                                                                                           </span>
<span class="-2002961180008195570" onmouseenter="enter('-2002961180008195570');" onmouseout="out('-2002961180008195570');" style=""> 230       * @param mappingTable                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 231       */                                                                                                           </span>
<span class="-3955444104111901697" onmouseenter="enter('-3955444104111901697');" onmouseout="out('-3955444104111901697');" style=""><abbr title=" 232      private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 232      private void addAliasForFieldNode(SqlNode pollSqlNode, List&lt;String&gt; fieldList, HashBasedTable&lt;String, String, 🔵</abbr></span>
<span class="-663927235385144722" onmouseenter="enter('-663927235385144722');" onmouseout="out('-663927235385144722');" style=""> 233          SqlKind sqlKind = pollSqlNode.getKind();                                                                  </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 234          switch (sqlKind) {                                                                                        </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 235              case INSERT:                                                                                          </span>
<span class="-3657774864843651643" onmouseenter="enter('-3657774864843651643');" onmouseout="out('-3657774864843651643');" style=""> 236                  SqlNode source = ((SqlInsert) pollSqlNode).getSource();                                           </span>
<span class="6134982029327154291" onmouseenter="enter('6134982029327154291');" onmouseout="out('6134982029327154291');" style=""> 237                  addAliasForFieldNode(source, fieldList, mappingTable);                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 238                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 239              case AS:                                                                                              </span>
<span class="-6853425371672212621" onmouseenter="enter('-6853425371672212621');" onmouseout="out('-6853425371672212621');" style=""> 240                  addAliasForFieldNode(((SqlBasicCall) pollSqlNode).getOperands()[0], fieldList, mappingTable);     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 241                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 242              case SELECT:                                                                                          </span>
<span class="-345466278028982068" onmouseenter="enter('-345466278028982068');" onmouseout="out('-345466278028982068');" style=""> 243                  SqlNodeList selectList = ((SqlSelect) pollSqlNode).getSelectList();                               </span>
<span class="-4478316650227403681" onmouseenter="enter('-4478316650227403681');" onmouseout="out('-4478316650227403681');" style=""> 244                  selectList.getList().forEach(node -&gt; {                                                            </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 245                      if (node.getKind() == IDENTIFIER) {                                                           </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 246                          SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                                       </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 247                          if (sqlIdentifier.names.size() == 1) {                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 248                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                          }                                                                                         </span>
<span class="-4986679521926317286" onmouseenter="enter('-4986679521926317286');" onmouseout="out('-4986679521926317286');" style=""> 250                          // save real field                                                                        </span>
<span class="2742839839262283647" onmouseenter="enter('2742839839262283647');" onmouseout="out('2742839839262283647');" style=""> 251                          String fieldName = sqlIdentifier.names.get(1);                                            </span>
<span class="-5921041769209732806" onmouseenter="enter('-5921041769209732806');" onmouseout="out('-5921041769209732806');" style=""><abbr title=" 252                          if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().containsKey(fieldName)) {"> 252                          if (!fieldName.endsWith(&quot;0&quot;) || fieldName.endsWith(&quot;0&quot;) &amp;&amp; mappingTable.columnMap().contai🔵</abbr></span>
<span class="-2287024865944183458" onmouseenter="enter('-2287024865944183458');" onmouseout="out('-2287024865944183458');" style=""> 253                              fieldList.add(fieldName);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                          }                                                                                         </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 257                  });                                                                                               </span>
<span class="-8923237898045704845" onmouseenter="enter('-8923237898045704845');" onmouseout="out('-8923237898045704845');" style=""> 258                  for (int i = 0; i &lt; selectList.getList().size(); i++) {                                           </span>
<span class="-4321294484021988020" onmouseenter="enter('-4321294484021988020');" onmouseout="out('-4321294484021988020');" style=""> 259                      SqlNode node = selectList.get(i);                                                             </span>
<span class="-1705164696650123310" onmouseenter="enter('-1705164696650123310');" onmouseout="out('-1705164696650123310');" style=""> 260                      if (node.getKind() == IDENTIFIER) {                                                           </span>
<span class="-6805567368565268789" onmouseenter="enter('-6805567368565268789');" onmouseout="out('-6805567368565268789');" style=""> 261                          SqlIdentifier sqlIdentifier = (SqlIdentifier) node;                                       </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 262                          if (sqlIdentifier.names.size() == 1) {                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 263                              return;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                          }                                                                                         </span>
<span class="-170655463018543442" onmouseenter="enter('-170655463018543442');" onmouseout="out('-170655463018543442');" style=""> 265                          String name = sqlIdentifier.names.get(1);                                                 </span>
<span class="-3204699988614579440" onmouseenter="enter('-3204699988614579440');" onmouseout="out('-3204699988614579440');" style=""> 266                          // avoid real field pv0 convert pv                                                        </span>
<span class="6166166284113505247" onmouseenter="enter('6166166284113505247');" onmouseout="out('6166166284113505247');" style=""><abbr title=" 267                          if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring(0, name.length() - 1))) {"> 267                          if (name.endsWith(&quot;0&quot;) &amp;&amp;  !fieldList.contains(name) &amp;&amp; !fieldList.contains(name.substring🔵</abbr></span>
<span class="2981236818393294037" onmouseenter="enter('2981236818393294037');" onmouseout="out('2981236818393294037');" style=""> 268                              SqlOperator operator = new SqlAsOperator();                                           </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 269                              SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                   </span>
<span  style=""> 270                                                                                                                    </span>
<span class="-2138283127011244558" onmouseenter="enter('-2138283127011244558');" onmouseout="out('-2138283127011244558');" style=""><abbr title=" 271                              SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() - 1), null, sqlParserPos);"> 271                              SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(name.substring(0, name.length() -🔵</abbr></span>
<span class="-7310412248425019303" onmouseenter="enter('-7310412248425019303');" onmouseout="out('-7310412248425019303');" style=""> 272                              SqlNode[] sqlNodes = new SqlNode[2];                                                  </span>
<span class="-2939555014928254235" onmouseenter="enter('-2939555014928254235');" onmouseout="out('-2939555014928254235');" style=""> 273                              sqlNodes[0] = sqlIdentifier;                                                          </span>
<span class="-4093556188235461327" onmouseenter="enter('-4093556188235461327');" onmouseout="out('-4093556188235461327');" style=""> 274                              sqlNodes[1] = sqlIdentifierAlias;                                                     </span>
<span class="172920197577317623" onmouseenter="enter('172920197577317623');" onmouseout="out('172920197577317623');" style=""> 275                              SqlBasicCall sqlBasicCall = new SqlBasicCall(operator, sqlNodes, sqlParserPos);       </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-6513758114426947797" onmouseenter="enter('-6513758114426947797');" onmouseout="out('-6513758114426947797');" style=""> 277                              selectList.set(i, sqlBasicCall);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 281                  break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 282              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 283                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285      }                                                                                                             </span>
<span  style=""> 286                                                                                                                    </span>
<span  style=""> 287                                                                                                                    </span>
<span class="3897594848566528823" onmouseenter="enter('3897594848566528823');" onmouseout="out('3897594848566528823');" style=""> 288      public AliasInfo parseAsNode(SqlNode sqlNode) throws SqlParseException {                                      </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 289          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="3363188275491767702" onmouseenter="enter('3363188275491767702');" onmouseout="out('3363188275491767702');" style=""> 290          if(sqlKind != AS){                                                                                        </span>
<span class="1088430228081547460" onmouseenter="enter('1088430228081547460');" onmouseout="out('1088430228081547460');" style=""> 291              throw new RuntimeException(sqlNode + &quot; is not &#x27;as&#x27; operator&quot;);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292          }                                                                                                         </span>
<span  style=""> 293                                                                                                                    </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 294          SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                                  </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 295          SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                                </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 297          AliasInfo aliasInfo = new AliasInfo();                                                                    </span>
<span class="-5109084571101185803" onmouseenter="enter('-5109084571101185803');" onmouseout="out('-5109084571101185803');" style=""> 298          aliasInfo.setName(info.toString());                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 299          aliasInfo.setAlias(alias.toString());                                                                     </span>
<span  style=""> 300                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 301          return aliasInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-8689302297966137516" onmouseenter="enter('-8689302297966137516');" onmouseout="out('-8689302297966137516');" style=""><abbr title=" 304      public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, String&gt; mappingTable) {"> 304      public RowTypeInfo buildOutRowTypeInfo(List&lt;FieldInfo&gt; sideJoinFieldInfo, HashBasedTable&lt;String, String, Strin🔵</abbr></span>
<span class="-3566414926414695948" onmouseenter="enter('-3566414926414695948');" onmouseout="out('-3566414926414695948');" style=""> 305          TypeInformation[] sideOutTypes = new TypeInformation[sideJoinFieldInfo.size()];                           </span>
<span class="-637166731779412769" onmouseenter="enter('-637166731779412769');" onmouseout="out('-637166731779412769');" style=""> 306          String[] sideOutNames = new String[sideJoinFieldInfo.size()];                                             </span>
<span class="7438730024850909889" onmouseenter="enter('7438730024850909889');" onmouseout="out('7438730024850909889');" style=""> 307          for (int i = 0; i &lt; sideJoinFieldInfo.size(); i++) {                                                      </span>
<span class="2207877773063469724" onmouseenter="enter('2207877773063469724');" onmouseout="out('2207877773063469724');" style=""> 308              FieldInfo fieldInfo = sideJoinFieldInfo.get(i);                                                       </span>
<span class="5857084890364228557" onmouseenter="enter('5857084890364228557');" onmouseout="out('5857084890364228557');" style=""> 309              String tableName = fieldInfo.getTable();                                                              </span>
<span class="-8111306812434290998" onmouseenter="enter('-8111306812434290998');" onmouseout="out('-8111306812434290998');" style=""> 310              String fieldName = fieldInfo.getFieldName();                                                          </span>
<span class="4185539436596522295" onmouseenter="enter('4185539436596522295');" onmouseout="out('4185539436596522295');" style=""> 311              String mappingFieldName = ParseUtils.dealDuplicateFieldName(mappingTable, fieldName);                 </span>
<span class="-7827879044056282695" onmouseenter="enter('-7827879044056282695');" onmouseout="out('-7827879044056282695');" style=""> 312              mappingTable.put(tableName, fieldName, mappingFieldName);                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="4913645198555706594" onmouseenter="enter('4913645198555706594');" onmouseout="out('4913645198555706594');" style=""> 314              sideOutTypes[i] = fieldInfo.getTypeInformation();                                                     </span>
<span class="6276485717663783154" onmouseenter="enter('6276485717663783154');" onmouseout="out('6276485717663783154');" style=""> 315              sideOutNames[i] = mappingFieldName;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316          }                                                                                                         </span>
<span class="2691939759498133513" onmouseenter="enter('2691939759498133513');" onmouseout="out('2691939759498133513');" style=""> 317          return new RowTypeInfo(sideOutTypes, sideOutNames);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span  style=""> 320                                                                                                                    </span>
<span  style=""> 321                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 322      /**                                                                                                           </span>
<span class="4027944609056411189" onmouseenter="enter('4027944609056411189');" onmouseout="out('4027944609056411189');" style=""> 323       *  对时间类型进行类型转换                                                                                               </span>
<span class="-7981851073621455488" onmouseenter="enter('-7981851073621455488');" onmouseout="out('-7981851073621455488');" style=""> 324       * @param leftTypeInfo                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 325       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 326       */                                                                                                           </span>
<span class="109255438874014135" onmouseenter="enter('109255438874014135');" onmouseout="out('109255438874014135');" style=""> 327      private RowTypeInfo buildLeftTableOutType(RowTypeInfo leftTypeInfo) {                                         </span>
<span class="5269317691380571116" onmouseenter="enter('5269317691380571116');" onmouseout="out('5269317691380571116');" style=""> 328          TypeInformation[] sideOutTypes = new TypeInformation[leftTypeInfo.getFieldNames().length];                </span>
<span class="357447233987634249" onmouseenter="enter('357447233987634249');" onmouseout="out('357447233987634249');" style=""> 329          TypeInformation&lt;?&gt;[] fieldTypes = leftTypeInfo.getFieldTypes();                                           </span>
<span class="-7313385440196867180" onmouseenter="enter('-7313385440196867180');" onmouseout="out('-7313385440196867180');" style=""> 330          for (int i = 0; i &lt; sideOutTypes.length; i++) {                                                           </span>
<span class="-314833607359598646" onmouseenter="enter('-314833607359598646');" onmouseout="out('-314833607359598646');" style=""> 331              sideOutTypes[i] = convertTimeAttributeType(fieldTypes[i]);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332          }                                                                                                         </span>
<span class="-6446480870466684625" onmouseenter="enter('-6446480870466684625');" onmouseout="out('-6446480870466684625');" style=""> 333          RowTypeInfo rowTypeInfo = new RowTypeInfo(sideOutTypes, leftTypeInfo.getFieldNames());                    </span>
<span class="6189116692514123920" onmouseenter="enter('6189116692514123920');" onmouseout="out('6189116692514123920');" style=""> 334          return rowTypeInfo;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335      }                                                                                                             </span>
<span  style=""> 336                                                                                                                    </span>
<span class="2471506251995792847" onmouseenter="enter('2471506251995792847');" onmouseout="out('2471506251995792847');" style=""> 337      private TypeInformation convertTimeAttributeType(TypeInformation typeInformation) {                           </span>
<span class="2997926285576198837" onmouseenter="enter('2997926285576198837');" onmouseout="out('2997926285576198837');" style=""> 338          if (typeInformation instanceof TimeIndicatorTypeInfo) {                                                   </span>
<span class="-6249974448261972874" onmouseenter="enter('-6249974448261972874');" onmouseout="out('-6249974448261972874');" style=""> 339              return TypeInformation.of(Timestamp.class);                                                           </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340          }                                                                                                         </span>
<span class="6871348106862514693" onmouseenter="enter('6871348106862514693');" onmouseout="out('6871348106862514693');" style=""> 341          return typeInformation;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342      }                                                                                                             </span>
<span  style=""> 343                                                                                                                    </span>
<span class="4184261108342886546" onmouseenter="enter('4184261108342886546');" onmouseout="out('4184261108342886546');" style=""> 344      //需要考虑更多的情况                                                                                                   </span>
<span class="-5866348515582828073" onmouseenter="enter('-5866348515582828073');" onmouseout="out('-5866348515582828073');" style=""> 345      private void replaceFieldName(SqlNode sqlNode, FieldReplaceInfo replaceInfo) {                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 346          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 347          switch (sqlKind) {                                                                                        </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 348              case INSERT:                                                                                          </span>
<span class="1507566640229528779" onmouseenter="enter('1507566640229528779');" onmouseout="out('1507566640229528779');" style=""> 349                  SqlNode sqlSource = ((SqlInsert) sqlNode).getSource();                                            </span>
<span class="3539579188210716047" onmouseenter="enter('3539579188210716047');" onmouseout="out('3539579188210716047');" style=""> 350                  replaceFieldName(sqlSource, replaceInfo);                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 351                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 352              case AS:                                                                                              </span>
<span class="-2471580703701460163" onmouseenter="enter('-2471580703701460163');" onmouseout="out('-2471580703701460163');" style=""> 353                  SqlNode asNode = ((SqlBasicCall) sqlNode).getOperands()[0];                                       </span>
<span class="2382936847570265491" onmouseenter="enter('2382936847570265491');" onmouseout="out('2382936847570265491');" style=""> 354                  replaceFieldName(asNode, replaceInfo);                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 355                  break;                                                                                            </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 356              case SELECT:                                                                                          </span>
<span class="7730902652365827282" onmouseenter="enter('7730902652365827282');" onmouseout="out('7730902652365827282');" style=""><abbr title=" 357                  SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName());"> 357                  SqlSelect sqlSelect = (SqlSelect) filterNodeWithTargetName(sqlNode, replaceInfo.getTargetTableName🔵</abbr></span>
<span class="-1465070514376240276" onmouseenter="enter('-1465070514376240276');" onmouseout="out('-1465070514376240276');" style=""> 358                  if(sqlSelect == null){                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 359                      return;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360                  }                                                                                                 </span>
<span  style=""> 361                                                                                                                    </span>
<span class="-7911431356156617515" onmouseenter="enter('-7911431356156617515');" onmouseout="out('-7911431356156617515');" style=""> 362                  SqlNode sqlSource1 = sqlSelect.getFrom();                                                         </span>
<span class="-4060139958118865814" onmouseenter="enter('-4060139958118865814');" onmouseout="out('-4060139958118865814');" style=""> 363                  if(sqlSource1.getKind() == AS){                                                                   </span>
<span class="7708153722582291408" onmouseenter="enter('7708153722582291408');" onmouseout="out('7708153722582291408');" style=""> 364                      String tableName = ((SqlBasicCall)sqlSource1).getOperands()[0].toString();                    </span>
<span class="-7976662112993336650" onmouseenter="enter('-7976662112993336650');" onmouseout="out('-7976662112993336650');" style=""> 365                      if(tableName.equalsIgnoreCase(replaceInfo.getTargetTableName())){                             </span>
<span class="5036423329776629809" onmouseenter="enter('5036423329776629809');" onmouseout="out('5036423329776629809');" style=""> 366                          SqlNodeList sqlSelectList = sqlSelect.getSelectList();                                    </span>
<span class="4783458191183529265" onmouseenter="enter('4783458191183529265');" onmouseout="out('4783458191183529265');" style=""> 367                          SqlNode whereNode = sqlSelect.getWhere();                                                 </span>
<span class="6069356713975423578" onmouseenter="enter('6069356713975423578');" onmouseout="out('6069356713975423578');" style=""> 368                          SqlNodeList sqlGroup = sqlSelect.getGroup();                                              </span>
<span  style=""> 369                                                                                                                    </span>
<span class="2024933395694494313" onmouseenter="enter('2024933395694494313');" onmouseout="out('2024933395694494313');" style=""> 370                          //TODO 暂时不处理having                                                                        </span>
<span class="-2928778695763881832" onmouseenter="enter('-2928778695763881832');" onmouseout="out('-2928778695763881832');" style=""> 371                          SqlNode sqlHaving = sqlSelect.getHaving();                                                </span>
<span  style=""> 372                                                                                                                    </span>
<span class="-3614471078991347107" onmouseenter="enter('-3614471078991347107');" onmouseout="out('-3614471078991347107');" style=""> 373                          List&lt;SqlNode&gt; newSelectNodeList = Lists.newArrayList();                                   </span>
<span class="4525830429471113267" onmouseenter="enter('4525830429471113267');" onmouseout="out('4525830429471113267');" style=""> 374                          for( int i=0; i&lt;sqlSelectList.getList().size(); i++){                                     </span>
<span class="295237348129218365" onmouseenter="enter('295237348129218365');" onmouseout="out('295237348129218365');" style=""> 375                              SqlNode selectNode = sqlSelectList.getList().get(i);                                  </span>
<span class="3005939127677060655" onmouseenter="enter('3005939127677060655');" onmouseout="out('3005939127677060655');" style=""> 376                              //特殊处理 isStar的标识                                                                      </span>
<span class="-7362933676269921614" onmouseenter="enter('-7362933676269921614');" onmouseout="out('-7362933676269921614');" style=""> 377                              if(selectNode.getKind() == IDENTIFIER &amp;&amp; ((SqlIdentifier) selectNode).isStar()){      </span>
<span class="1426748103918852649" onmouseenter="enter('1426748103918852649');" onmouseout="out('1426748103918852649');" style=""><abbr title=" 378                                  List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo);"> 378                                  List&lt;SqlNode&gt; replaceNodeList = replaceSelectStarFieldName(selectNode, replaceInfo🔵</abbr></span>
<span class="-936038636053459659" onmouseenter="enter('-936038636053459659');" onmouseout="out('-936038636053459659');" style=""> 379                                  newSelectNodeList.addAll(replaceNodeList);                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 380                                  continue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                              }                                                                                     </span>
<span  style=""> 382                                                                                                                    </span>
<span class="3570575360626670937" onmouseenter="enter('3570575360626670937');" onmouseout="out('3570575360626670937');" style=""> 383                              SqlNode replaceNode = replaceSelectFieldName(selectNode, replaceInfo);                </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 384                              if(replaceNode == null){                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 385                                  continue;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386                              }                                                                                     </span>
<span  style=""> 387                                                                                                                    </span>
<span class="-2861561298429904330" onmouseenter="enter('-2861561298429904330');" onmouseout="out('-2861561298429904330');" style=""> 388                              //sqlSelectList.set(i, replaceNode);                                                  </span>
<span class="1157087708345012360" onmouseenter="enter('1157087708345012360');" onmouseout="out('1157087708345012360');" style=""> 389                              newSelectNodeList.add(replaceNode);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                          }                                                                                         </span>
<span  style=""> 391                                                                                                                    </span>
<span class="3723543992832155466" onmouseenter="enter('3723543992832155466');" onmouseout="out('3723543992832155466');" style=""><abbr title=" 392                          SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosition());"> 392                          SqlNodeList newSelectList = new SqlNodeList(newSelectNodeList, sqlSelectList.getParserPosi🔵</abbr></span>
<span class="-8903961717282297850" onmouseenter="enter('-8903961717282297850');" onmouseout="out('-8903961717282297850');" style=""> 393                          sqlSelect.setSelectList(newSelectList);                                                   </span>
<span  style=""> 394                                                                                                                    </span>
<span class="-47820880813073829" onmouseenter="enter('-47820880813073829');" onmouseout="out('-47820880813073829');" style=""> 395                          //where                                                                                   </span>
<span class="-2977999434516732521" onmouseenter="enter('-2977999434516732521');" onmouseout="out('-2977999434516732521');" style=""> 396                          if(whereNode != null){                                                                    </span>
<span class="5185992084008387135" onmouseenter="enter('5185992084008387135');" onmouseout="out('5185992084008387135');" style=""> 397                              SqlNode[] sqlNodeList = ((SqlBasicCall)whereNode).getOperands();                      </span>
<span class="3961659355684503168" onmouseenter="enter('3961659355684503168');" onmouseout="out('3961659355684503168');" style=""> 398                              for(int i =0; i&lt;sqlNodeList.length; i++) {                                            </span>
<span class="2172750173548984826" onmouseenter="enter('2172750173548984826');" onmouseout="out('2172750173548984826');" style=""> 399                                  SqlNode whereSqlNode = sqlNodeList[i];                                            </span>
<span class="-4477047106175359937" onmouseenter="enter('-4477047106175359937');" onmouseout="out('-4477047106175359937');" style=""> 400                                  SqlNode replaceNode = replaceNodeInfo(whereSqlNode, replaceInfo);                 </span>
<span class="-1237302974526763563" onmouseenter="enter('-1237302974526763563');" onmouseout="out('-1237302974526763563');" style=""> 401                                  sqlNodeList[i] = replaceNode;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403                          }                                                                                         </span>
<span class="6298777632396279516" onmouseenter="enter('6298777632396279516');" onmouseout="out('6298777632396279516');" style=""> 404                          if(sqlGroup != null &amp;&amp; CollectionUtils.isNotEmpty(sqlGroup.getList())){                   </span>
<span class="-8564058694678267080" onmouseenter="enter('-8564058694678267080');" onmouseout="out('-8564058694678267080');" style=""> 405                              for( int i=0; i&lt;sqlGroup.getList().size(); i++){                                      </span>
<span class="1364213940272952273" onmouseenter="enter('1364213940272952273');" onmouseout="out('1364213940272952273');" style=""> 406                                  SqlNode selectNode = sqlGroup.getList().get(i);                                   </span>
<span class="3578364850198173029" onmouseenter="enter('3578364850198173029');" onmouseout="out('3578364850198173029');" style=""> 407                                  SqlNode replaceNode = replaceNodeInfo(selectNode, replaceInfo);                   </span>
<span class="5715423325454336801" onmouseenter="enter('5715423325454336801');" onmouseout="out('5715423325454336801');" style=""> 408                                  sqlGroup.set(i, replaceNode);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 412                  }else{                                                                                            </span>
<span class="5468885380070811563" onmouseenter="enter('5468885380070811563');" onmouseout="out('5468885380070811563');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -                    //TODO                                                                                        </span>
<span class="-7176218527101706664" onmouseenter="enter('-7176218527101706664');" onmouseout="out('-7176218527101706664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -                    System.out.println(sqlNode);                                                                  </span>
<span class="7951951008096051242" onmouseenter="enter('7951951008096051242');" onmouseout="out('7951951008096051242');" style=""> 415                      throw new RuntimeException(&quot;---not deal type:&quot; + sqlNode);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416                  }                                                                                                 </span>
<span  style=""> 417                                                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 418                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 419              case UNION:                                                                                           </span>
<span class="-8185525423233229369" onmouseenter="enter('-8185525423233229369');" onmouseout="out('-8185525423233229369');" style=""> 420                  SqlNode unionLeft = ((SqlBasicCall) sqlNode).getOperands()[0];                                    </span>
<span class="3590878486653773103" onmouseenter="enter('3590878486653773103');" onmouseout="out('3590878486653773103');" style=""> 421                  SqlNode unionRight = ((SqlBasicCall) sqlNode).getOperands()[1];                                   </span>
<span class="12832057540049012" onmouseenter="enter('12832057540049012');" onmouseout="out('12832057540049012');" style=""> 422                  replaceFieldName(unionLeft, replaceInfo);                                                         </span>
<span class="-8236931260571053140" onmouseenter="enter('-8236931260571053140');" onmouseout="out('-8236931260571053140');" style=""> 423                  replaceFieldName(unionRight, replaceInfo);                                                        </span>
<span  style=""> 424                                                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 425                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 426              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 427                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="6726911406523213581" onmouseenter="enter('6726911406523213581');" onmouseout="out('6726911406523213581');" style=""> 428                  replaceFieldName(sqlOrderBy.query, replaceInfo);                                                  </span>
<span class="-1619723091747707804" onmouseenter="enter('-1619723091747707804');" onmouseout="out('-1619723091747707804');" style=""> 429                  SqlNodeList orderFiledList = sqlOrderBy.orderList;                                                </span>
<span class="-5416337846474747128" onmouseenter="enter('-5416337846474747128');" onmouseout="out('-5416337846474747128');" style=""> 430                  for (int i=0 ;i&lt;orderFiledList.size();i++) {                                                      </span>
<span class="3598769397463403835" onmouseenter="enter('3598769397463403835');" onmouseout="out('3598769397463403835');" style=""><abbr title=" 431                      SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTableAlias());"> 431                      SqlNode replaceNode = replaceOrderByTableName(orderFiledList.get(i), replaceInfo.getTargetTabl🔵</abbr></span>
<span class="-1288993483926023903" onmouseenter="enter('-1288993483926023903');" onmouseout="out('-1288993483926023903');" style=""> 432                      orderFiledList.set(i, replaceNode);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433                  }                                                                                                 </span>
<span  style=""> 434                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 435              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 436                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438      }                                                                                                             </span>
<span  style=""> 439                                                                                                                    </span>
<span class="-4529709500477233937" onmouseenter="enter('-4529709500477233937');" onmouseout="out('-4529709500477233937');" style=""> 440      private SqlNode replaceOrderByTableName(SqlNode orderNode, String tableAlias) {                               </span>
<span class="-8843072586907859237" onmouseenter="enter('-8843072586907859237');" onmouseout="out('-8843072586907859237');" style=""> 441          if(orderNode.getKind() == IDENTIFIER){                                                                    </span>
<span class="1286019212722079849" onmouseenter="enter('1286019212722079849');" onmouseout="out('1286019212722079849');" style=""> 442              SqlIdentifier sqlIdentifier = (SqlIdentifier) orderNode;                                              </span>
<span class="5334275776993480413" onmouseenter="enter('5334275776993480413');" onmouseout="out('5334275776993480413');" style=""> 443              if (sqlIdentifier.names.size() == 1) {                                                                </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 444                  return orderNode;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445              }                                                                                                     </span>
<span class="4987076328947336547" onmouseenter="enter('4987076328947336547');" onmouseout="out('4987076328947336547');" style=""> 446              return sqlIdentifier.setName(0, tableAlias);                                                          </span>
<span class="6164370744345420381" onmouseenter="enter('6164370744345420381');" onmouseout="out('6164370744345420381');" style=""> 447          } else if (orderNode instanceof  SqlBasicCall) {                                                          </span>
<span class="4197878478620092735" onmouseenter="enter('4197878478620092735');" onmouseout="out('4197878478620092735');" style=""> 448              SqlBasicCall sqlBasicCall = (SqlBasicCall) orderNode;                                                 </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 449              for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                            </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 450                  SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                           </span>
<span class="-7345169450449378118" onmouseenter="enter('-7345169450449378118');" onmouseout="out('-7345169450449378118');" style=""> 451                  sqlBasicCall.getOperands()[i] = replaceOrderByTableName(sqlNode , tableAlias);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452              }                                                                                                     </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 453              return sqlBasicCall;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 454          } else {                                                                                                  </span>
<span class="3658299151650011152" onmouseenter="enter('3658299151650011152');" onmouseout="out('3658299151650011152');" style=""> 455              return orderNode;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457      }                                                                                                             </span>
<span  style=""> 458                                                                                                                    </span>
<span class="4620342074554351588" onmouseenter="enter('4620342074554351588');" onmouseout="out('4620342074554351588');" style=""> 459      private SqlNode replaceNodeInfo(SqlNode groupNode, FieldReplaceInfo replaceInfo){                             </span>
<span class="-8006552962557562934" onmouseenter="enter('-8006552962557562934');" onmouseout="out('-8006552962557562934');" style=""> 460          if(groupNode.getKind() == IDENTIFIER){                                                                    </span>
<span class="3769318911409416973" onmouseenter="enter('3769318911409416973');" onmouseout="out('3769318911409416973');" style=""> 461              SqlIdentifier sqlIdentifier = (SqlIdentifier) groupNode;                                              </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 462              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 463                  return sqlIdentifier;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464              }                                                                                                     </span>
<span  style=""> 465                                                                                                                    </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 466              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 466              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sq🔵</abbr></span>
<span class="1289832806545417263" onmouseenter="enter('1289832806545417263');" onmouseout="out('1289832806545417263');" style=""> 467              if(mappingFieldName == null){                                                                         </span>
<span class="-3862759337385230883" onmouseenter="enter('-3862759337385230883');" onmouseout="out('-3862759337385230883');" style=""> 468                  throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + sqlIdentifier.toString() );          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469              }                                                                                                     </span>
<span  style=""> 470                                                                                                                    </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 471              sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                          </span>
<span class="2521832232004155291" onmouseenter="enter('2521832232004155291');" onmouseout="out('2521832232004155291');" style=""> 472              return sqlIdentifier.setName(1, mappingFieldName);                                                    </span>
<span class="6819015395036995114" onmouseenter="enter('6819015395036995114');" onmouseout="out('6819015395036995114');" style=""> 473          }else if(groupNode instanceof  SqlBasicCall){                                                             </span>
<span class="8961639140694724649" onmouseenter="enter('8961639140694724649');" onmouseout="out('8961639140694724649');" style=""> 474              SqlBasicCall sqlBasicCall = (SqlBasicCall) groupNode;                                                 </span>
<span class="-7573732783383249897" onmouseenter="enter('-7573732783383249897');" onmouseout="out('-7573732783383249897');" style=""> 475              for(int i=0; i&lt;sqlBasicCall.getOperandList().size(); i++){                                            </span>
<span class="100008651296407899" onmouseenter="enter('100008651296407899');" onmouseout="out('100008651296407899');" style=""> 476                  SqlNode sqlNode = sqlBasicCall.getOperandList().get(i);                                           </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 477                  SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                               </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 478                  sqlBasicCall.getOperands()[i] = replaceNode;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479              }                                                                                                     </span>
<span  style=""> 480                                                                                                                    </span>
<span class="-8358112570910588815" onmouseenter="enter('-8358112570910588815');" onmouseout="out('-8358112570910588815');" style=""> 481              return sqlBasicCall;                                                                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 482          }else{                                                                                                    </span>
<span class="-2985482133144580062" onmouseenter="enter('-2985482133144580062');" onmouseout="out('-2985482133144580062');" style=""> 483              return groupNode;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485      }                                                                                                             </span>
<span  style=""> 486                                                                                                                    </span>
<span class="8999921149877150187" onmouseenter="enter('8999921149877150187');" onmouseout="out('8999921149877150187');" style=""> 487      public SqlNode filterNodeWithTargetName(SqlNode sqlNode, String targetTableName) {                            </span>
<span  style=""> 488                                                                                                                    </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 489          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 490          switch (sqlKind){                                                                                         </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 491              case SELECT:                                                                                          </span>
<span class="3690582093491335304" onmouseenter="enter('3690582093491335304');" onmouseout="out('3690582093491335304');" style=""> 492                  SqlNode fromNode = ((SqlSelect)sqlNode).getFrom();                                                </span>
<span class="-3145608785072750921" onmouseenter="enter('-3145608785072750921');" onmouseout="out('-3145608785072750921');" style=""> 493                  if(fromNode.getKind() == AS &amp;&amp; ((SqlBasicCall)fromNode).getOperands()[0].getKind() == IDENTIFIER){</span>
<span class="-8703575627981044416" onmouseenter="enter('-8703575627981044416');" onmouseout="out('-8703575627981044416');" style=""> 494                      if(((SqlBasicCall)fromNode).getOperands()[0].toString().equalsIgnoreCase(targetTableName)){   </span>
<span class="4129664160573057591" onmouseenter="enter('4129664160573057591');" onmouseout="out('4129664160573057591');" style=""> 495                          return sqlNode;                                                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 496                      }else{                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 497                          return null;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 499                  }else{                                                                                            </span>
<span class="-487022337093825690" onmouseenter="enter('-487022337093825690');" onmouseout="out('-487022337093825690');" style=""> 500                      return filterNodeWithTargetName(fromNode, targetTableName);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501                  }                                                                                                 </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 502              case AS:                                                                                              </span>
<span class="-1062165270197177560" onmouseenter="enter('-1062165270197177560');" onmouseout="out('-1062165270197177560');" style=""> 503                  SqlNode childNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-1638905337538821604" onmouseenter="enter('-1638905337538821604');" onmouseout="out('-1638905337538821604');" style=""> 504                  return filterNodeWithTargetName(childNode, targetTableName);                                      </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 505              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 506                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-2733398086906527657" onmouseenter="enter('-2733398086906527657');" onmouseout="out('-2733398086906527657');" style=""> 507                  SqlNode rightNode =  ((SqlJoin)sqlNode).getRight();                                               </span>
<span class="2468445302541940347" onmouseenter="enter('2468445302541940347');" onmouseout="out('2468445302541940347');" style=""> 508                  SqlNode leftReturnNode = filterNodeWithTargetName(leftNode, targetTableName);                     </span>
<span class="-8199943593633767670" onmouseenter="enter('-8199943593633767670');" onmouseout="out('-8199943593633767670');" style=""> 509                  SqlNode rightReturnNode = filterNodeWithTargetName(rightNode, targetTableName);                   </span>
<span  style=""> 510                                                                                                                    </span>
<span class="-394673487884933665" onmouseenter="enter('-394673487884933665');" onmouseout="out('-394673487884933665');" style=""> 511                  if(leftReturnNode != null) {                                                                      </span>
<span class="7562823630460789719" onmouseenter="enter('7562823630460789719');" onmouseout="out('7562823630460789719');" style=""> 512                      return leftReturnNode;                                                                        </span>
<span class="1020015460804008518" onmouseenter="enter('1020015460804008518');" onmouseout="out('1020015460804008518');" style=""> 513                  }else if(rightReturnNode != null){                                                                </span>
<span class="7420403991289947009" onmouseenter="enter('7420403991289947009');" onmouseout="out('7420403991289947009');" style=""> 514                      return rightReturnNode;                                                                       </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 515                  }else{                                                                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 516                      return null;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517                  }                                                                                                 </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 518              default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 519                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520          }                                                                                                         </span>
<span  style=""> 521                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 522          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523      }                                                                                                             </span>
<span  style=""> 524                                                                                                                    </span>
<span  style=""> 525                                                                                                                    </span>
<span class="-6722855011181273565" onmouseenter="enter('-6722855011181273565');" onmouseout="out('-6722855011181273565');" style=""> 526      public void setLocalSqlPluginPath(String localSqlPluginPath) {                                                </span>
<span class="6258662942576926140" onmouseenter="enter('6258662942576926140');" onmouseout="out('6258662942576926140');" style=""> 527          this.localSqlPluginPath = localSqlPluginPath;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528      }                                                                                                             </span>
<span  style=""> 529                                                                                                                    </span>
<span class="2277905399441322839" onmouseenter="enter('2277905399441322839');" onmouseout="out('2277905399441322839');" style=""> 530      private Table getTableFromCache(Map&lt;String, Table&gt; localTableCache, String tableAlias, String tableName){     </span>
<span class="-6301156236825066460" onmouseenter="enter('-6301156236825066460');" onmouseout="out('-6301156236825066460');" style=""> 531          Table table = localTableCache.get(tableAlias);                                                            </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 532          if(table == null){                                                                                        </span>
<span class="-5960895848666330323" onmouseenter="enter('-5960895848666330323');" onmouseout="out('-5960895848666330323');" style=""> 533              table = localTableCache.get(tableName);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534          }                                                                                                         </span>
<span  style=""> 535                                                                                                                    </span>
<span class="2042916935617835771" onmouseenter="enter('2042916935617835771');" onmouseout="out('2042916935617835771');" style=""> 536          if(table == null){                                                                                        </span>
<span class="-2825016904896826066" onmouseenter="enter('-2825016904896826066');" onmouseout="out('-2825016904896826066');" style=""> 537              throw new RuntimeException(&quot;not register table &quot; + tableName);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538          }                                                                                                         </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-6017334383208509278" onmouseenter="enter('-6017334383208509278');" onmouseout="out('-6017334383208509278');" style=""> 540          return table;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541      }                                                                                                             </span>
<span  style=""> 542                                                                                                                    </span>
<span class="-8696523049985644897" onmouseenter="enter('-8696523049985644897');" onmouseout="out('-8696523049985644897');" style=""> 543      private List&lt;SqlNode&gt; replaceSelectStarFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo){           </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 544          SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                                 </span>
<span class="-376697531199676299" onmouseenter="enter('-376697531199676299');" onmouseout="out('-376697531199676299');" style=""> 545          List&lt;SqlNode&gt; sqlNodes = Lists.newArrayList();                                                            </span>
<span class="-3220711380851181839" onmouseenter="enter('-3220711380851181839');" onmouseout="out('-3220711380851181839');" style=""> 546          if(sqlIdentifier.isStar()){//处理 [* or table.*]                                                            </span>
<span class="-8760640117888015743" onmouseenter="enter('-8760640117888015743');" onmouseout="out('-8760640117888015743');" style=""> 547              int identifierSize = sqlIdentifier.names.size();                                                      </span>
<span class="-737230567623922483" onmouseenter="enter('-737230567623922483');" onmouseout="out('-737230567623922483');" style=""> 548              Collection&lt;String&gt; columns = null;                                                                    </span>
<span class="-3878600943817580523" onmouseenter="enter('-3878600943817580523');" onmouseout="out('-3878600943817580523');" style=""> 549              if(identifierSize == 1){                                                                              </span>
<span class="439489357590017604" onmouseenter="enter('439489357590017604');" onmouseout="out('439489357590017604');" style=""> 550                  columns = replaceInfo.getMappingTable().values();                                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 551              }else{                                                                                                </span>
<span class="-6967503276601174325" onmouseenter="enter('-6967503276601174325');" onmouseout="out('-6967503276601174325');" style=""> 552                  columns = replaceInfo.getMappingTable().row(sqlIdentifier.names.get(0)).values();                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553              }                                                                                                     </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-8621425588629763030" onmouseenter="enter('-8621425588629763030');" onmouseout="out('-8621425588629763030');" style=""> 555              for(String colAlias : columns){                                                                       </span>
<span class="-1667801166019875282" onmouseenter="enter('-1667801166019875282');" onmouseout="out('-1667801166019875282');" style=""> 556                  SqlParserPos sqlParserPos = new SqlParserPos(0, 0);                                               </span>
<span class="7376564429850475234" onmouseenter="enter('7376564429850475234');" onmouseout="out('7376564429850475234');" style=""> 557                  List&lt;String&gt; columnInfo = Lists.newArrayList();                                                   </span>
<span class="-7580690826400610936" onmouseenter="enter('-7580690826400610936');" onmouseout="out('-7580690826400610936');" style=""> 558                  columnInfo.add(replaceInfo.getTargetTableAlias());                                                </span>
<span class="8071016449845654104" onmouseenter="enter('8071016449845654104');" onmouseout="out('8071016449845654104');" style=""> 559                  columnInfo.add(colAlias);                                                                         </span>
<span class="-2937163626106946341" onmouseenter="enter('-2937163626106946341');" onmouseout="out('-2937163626106946341');" style=""> 560                  SqlIdentifier sqlIdentifierAlias = new SqlIdentifier(columnInfo, sqlParserPos);                   </span>
<span class="6977395894616298454" onmouseenter="enter('6977395894616298454');" onmouseout="out('6977395894616298454');" style=""> 561                  sqlNodes.add(sqlIdentifierAlias);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562              }                                                                                                     </span>
<span  style=""> 563                                                                                                                    </span>
<span class="-2192274943977569589" onmouseenter="enter('-2192274943977569589');" onmouseout="out('-2192274943977569589');" style=""> 564              return sqlNodes;                                                                                      </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 565          }else{                                                                                                    </span>
<span class="-8039826041817422769" onmouseenter="enter('-8039826041817422769');" onmouseout="out('-8039826041817422769');" style=""> 566              throw new RuntimeException(&quot;is not a star select field.&quot; + selectNode);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568      }                                                                                                             </span>
<span  style=""> 569                                                                                                                    </span>
<span class="-5931652736394605669" onmouseenter="enter('-5931652736394605669');" onmouseout="out('-5931652736394605669');" style=""> 570      private SqlNode replaceSelectFieldName(SqlNode selectNode, FieldReplaceInfo replaceInfo) {                    </span>
<span class="8103739576060170768" onmouseenter="enter('8103739576060170768');" onmouseout="out('8103739576060170768');" style=""> 571          if (selectNode.getKind() == AS) {                                                                         </span>
<span class="1510889832473438632" onmouseenter="enter('1510889832473438632');" onmouseout="out('1510889832473438632');" style=""> 572              SqlNode leftNode = ((SqlBasicCall) selectNode).getOperands()[0];                                      </span>
<span class="-1521486087941699086" onmouseenter="enter('-1521486087941699086');" onmouseout="out('-1521486087941699086');" style=""> 573              SqlNode replaceNode = replaceSelectFieldName(leftNode, replaceInfo);                                  </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 574              if (replaceNode != null) {                                                                            </span>
<span class="44744548385893691" onmouseenter="enter('44744548385893691');" onmouseout="out('44744548385893691');" style=""> 575                  ((SqlBasicCall) selectNode).getOperands()[0] = replaceNode;                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576              }                                                                                                     </span>
<span  style=""> 577                                                                                                                    </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 578              return selectNode;                                                                                    </span>
<span class="-4525236033469860943" onmouseenter="enter('-4525236033469860943');" onmouseout="out('-4525236033469860943');" style=""> 579          }else if(selectNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-3732912994311321816" onmouseenter="enter('-3732912994311321816');" onmouseout="out('-3732912994311321816');" style=""> 580              SqlIdentifier sqlIdentifier = (SqlIdentifier) selectNode;                                             </span>
<span  style=""> 581                                                                                                                    </span>
<span class="2651178788475624428" onmouseenter="enter('2651178788475624428');" onmouseout="out('2651178788475624428');" style=""> 582              if(sqlIdentifier.names.size() == 1){                                                                  </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 583                  return selectNode;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584              }                                                                                                     </span>
<span  style=""> 585                                                                                                                    </span>
<span class="5152547743275588251" onmouseenter="enter('5152547743275588251');" onmouseout="out('5152547743275588251');" style=""> 586              //Same level mappingTable                                                                             </span>
<span class="6407916945855257008" onmouseenter="enter('6407916945855257008');" onmouseout="out('6407916945855257008');" style=""><abbr title=" 587              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sqlIdentifier.getComponent(1).getSimple());"> 587              String mappingFieldName = replaceInfo.getTargetFieldName(sqlIdentifier.getComponent(0).getSimple(), sq🔵</abbr></span>
<span class="-6523721893364253351" onmouseenter="enter('-6523721893364253351');" onmouseout="out('-6523721893364253351');" style=""> 588              if (mappingFieldName == null) {                                                                       </span>
<span class="8276130366719222706" onmouseenter="enter('8276130366719222706');" onmouseout="out('8276130366719222706');" style=""> 589                  throw new RuntimeException(&quot;can&#x27;t find mapping fieldName:&quot; + selectNode.toString() );             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590              }                                                                                                     </span>
<span  style=""> 591                                                                                                                    </span>
<span class="-5890535765636234447" onmouseenter="enter('-5890535765636234447');" onmouseout="out('-5890535765636234447');" style=""> 592              sqlIdentifier = sqlIdentifier.setName(0, replaceInfo.getTargetTableAlias());                          </span>
<span class="2571352877158902005" onmouseenter="enter('2571352877158902005');" onmouseout="out('2571352877158902005');" style=""> 593              sqlIdentifier = sqlIdentifier.setName(1, mappingFieldName);                                           </span>
<span class="-847366074365989092" onmouseenter="enter('-847366074365989092');" onmouseout="out('-847366074365989092');" style=""> 594              return sqlIdentifier;                                                                                 </span>
<span class="7580774735460232339" onmouseenter="enter('7580774735460232339');" onmouseout="out('7580774735460232339');" style=""> 595          }else if(selectNode.getKind() == LITERAL || selectNode.getKind() == LITERAL_CHAIN){//字面含义                 </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 596              return selectNode;                                                                                    </span>
<span class="7025405726449532045" onmouseenter="enter('7025405726449532045');" onmouseout="out('7025405726449532045');" style=""> 597          }else if(  AGGREGATE.contains(selectNode.getKind())                                                       </span>
<span class="-6933542481251357306" onmouseenter="enter('-6933542481251357306');" onmouseout="out('-6933542481251357306');" style=""> 598                  || AVG_AGG_FUNCTIONS.contains(selectNode.getKind())                                               </span>
<span class="-2120439329066417772" onmouseenter="enter('-2120439329066417772');" onmouseout="out('-2120439329066417772');" style=""> 599                  || COMPARISON.contains(selectNode.getKind())                                                      </span>
<span class="6729191807379931332" onmouseenter="enter('6729191807379931332');" onmouseout="out('6729191807379931332');" style=""> 600                  || selectNode.getKind() == OTHER_FUNCTION                                                         </span>
<span class="-790540336783787818" onmouseenter="enter('-790540336783787818');" onmouseout="out('-790540336783787818');" style=""> 601                  || selectNode.getKind() == DIVIDE                                                                 </span>
<span class="8042439450870069301" onmouseenter="enter('8042439450870069301');" onmouseout="out('8042439450870069301');" style=""> 602                  || selectNode.getKind() == CAST                                                                   </span>
<span class="8131430949670321542" onmouseenter="enter('8131430949670321542');" onmouseout="out('8131430949670321542');" style=""> 603                  || selectNode.getKind() == TRIM                                                                   </span>
<span class="7539044465271514325" onmouseenter="enter('7539044465271514325');" onmouseout="out('7539044465271514325');" style=""> 604                  || selectNode.getKind() == TIMES                                                                  </span>
<span class="5017875227939513377" onmouseenter="enter('5017875227939513377');" onmouseout="out('5017875227939513377');" style=""> 605                  || selectNode.getKind() == PLUS                                                                   </span>
<span class="-8896687143784188803" onmouseenter="enter('-8896687143784188803');" onmouseout="out('-8896687143784188803');" style=""> 606                  || selectNode.getKind() == NOT_IN                                                                 </span>
<span class="-1863732027976694038" onmouseenter="enter('-1863732027976694038');" onmouseout="out('-1863732027976694038');" style=""> 607                  || selectNode.getKind() == OR                                                                     </span>
<span class="6505261652610820896" onmouseenter="enter('6505261652610820896');" onmouseout="out('6505261652610820896');" style=""> 608                  || selectNode.getKind() == AND                                                                    </span>
<span class="8098904506676885196" onmouseenter="enter('8098904506676885196');" onmouseout="out('8098904506676885196');" style=""> 609                  || selectNode.getKind() == MINUS                                                                  </span>
<span class="-157153081163608557" onmouseenter="enter('-157153081163608557');" onmouseout="out('-157153081163608557');" style=""> 610                  || selectNode.getKind() == TUMBLE                                                                 </span>
<span class="-2839638964097736537" onmouseenter="enter('-2839638964097736537');" onmouseout="out('-2839638964097736537');" style=""> 611                  || selectNode.getKind() == TUMBLE_START                                                           </span>
<span class="6482577849437391011" onmouseenter="enter('6482577849437391011');" onmouseout="out('6482577849437391011');" style=""> 612                  || selectNode.getKind() == TUMBLE_END                                                             </span>
<span class="6880276476651207951" onmouseenter="enter('6880276476651207951');" onmouseout="out('6880276476651207951');" style=""> 613                  || selectNode.getKind() == SESSION                                                                </span>
<span class="-5893490809135961202" onmouseenter="enter('-5893490809135961202');" onmouseout="out('-5893490809135961202');" style=""> 614                  || selectNode.getKind() == SESSION_START                                                          </span>
<span class="-1646114820326763405" onmouseenter="enter('-1646114820326763405');" onmouseout="out('-1646114820326763405');" style=""> 615                  || selectNode.getKind() == SESSION_END                                                            </span>
<span class="268793040563115559" onmouseenter="enter('268793040563115559');" onmouseout="out('268793040563115559');" style=""> 616                  || selectNode.getKind() == HOP                                                                    </span>
<span class="5104117061177388693" onmouseenter="enter('5104117061177388693');" onmouseout="out('5104117061177388693');" style=""> 617                  || selectNode.getKind() == HOP_START                                                              </span>
<span class="8235260830665848207" onmouseenter="enter('8235260830665848207');" onmouseout="out('8235260830665848207');" style=""> 618                  || selectNode.getKind() == HOP_END                                                                </span>
<span class="-3943236427179035086" onmouseenter="enter('-3943236427179035086');" onmouseout="out('-3943236427179035086');" style=""> 619                  || selectNode.getKind() == BETWEEN                                                                </span>
<span class="-4981553052649867721" onmouseenter="enter('-4981553052649867721');" onmouseout="out('-4981553052649867721');" style=""> 620                  || selectNode.getKind() == IS_NULL                                                                </span>
<span class="2062318608323297657" onmouseenter="enter('2062318608323297657');" onmouseout="out('2062318608323297657');" style=""> 621                  || selectNode.getKind() == IS_NOT_NULL                                                            </span>
<span class="-5717204280699012051" onmouseenter="enter('-5717204280699012051');" onmouseout="out('-5717204280699012051');" style=""> 622                  || selectNode.getKind() == CONTAINS                                                               </span>
<span class="-4225388998654687854" onmouseenter="enter('-4225388998654687854');" onmouseout="out('-4225388998654687854');" style=""> 623                  || selectNode.getKind() == TIMESTAMP_ADD                                                          </span>
<span class="-1992782825152874013" onmouseenter="enter('-1992782825152874013');" onmouseout="out('-1992782825152874013');" style=""> 624                  || selectNode.getKind() == TIMESTAMP_DIFF                                                         </span>
<span class="-1380076266281630813" onmouseenter="enter('-1380076266281630813');" onmouseout="out('-1380076266281630813');" style=""> 625                  || selectNode.getKind() == LIKE                                                                   </span>
<span  style=""> 626                                                                                                                    </span>
<span class="1769062068492699725" onmouseenter="enter('1769062068492699725');" onmouseout="out('1769062068492699725');" style=""> 627                  ){                                                                                                </span>
<span class="7946305415555164516" onmouseenter="enter('7946305415555164516');" onmouseout="out('7946305415555164516');" style=""> 628              SqlBasicCall sqlBasicCall = (SqlBasicCall) selectNode;                                                </span>
<span class="-6221234471722277998" onmouseenter="enter('-6221234471722277998');" onmouseout="out('-6221234471722277998');" style=""> 629              for(int i=0; i&lt;sqlBasicCall.getOperands().length; i++){                                               </span>
<span class="-6831609595517394087" onmouseenter="enter('-6831609595517394087');" onmouseout="out('-6831609595517394087');" style=""> 630                  SqlNode sqlNode = sqlBasicCall.getOperands()[i];                                                  </span>
<span class="92437031510630357" onmouseenter="enter('92437031510630357');" onmouseout="out('92437031510630357');" style=""> 631                  if(sqlNode instanceof SqlLiteral){                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 632                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633                  }                                                                                                 </span>
<span  style=""> 634                                                                                                                    </span>
<span class="-7655129146813432779" onmouseenter="enter('-7655129146813432779');" onmouseout="out('-7655129146813432779');" style=""> 635                  if(sqlNode instanceof SqlDataTypeSpec){                                                           </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 636                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637                  }                                                                                                 </span>
<span  style=""> 638                                                                                                                    </span>
<span class="7881018161937387163" onmouseenter="enter('7881018161937387163');" onmouseout="out('7881018161937387163');" style=""> 639                  SqlNode replaceNode = replaceSelectFieldName(sqlNode, replaceInfo);                               </span>
<span class="6730448349282232186" onmouseenter="enter('6730448349282232186');" onmouseout="out('6730448349282232186');" style=""> 640                  if(replaceNode == null){                                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 641                      continue;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642                  }                                                                                                 </span>
<span  style=""> 643                                                                                                                    </span>
<span class="347802466520365331" onmouseenter="enter('347802466520365331');" onmouseout="out('347802466520365331');" style=""> 644                  sqlBasicCall.getOperands()[i] = replaceNode;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645              }                                                                                                     </span>
<span  style=""> 646                                                                                                                    </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 647              return selectNode;                                                                                    </span>
<span class="2155507952934750451" onmouseenter="enter('2155507952934750451');" onmouseout="out('2155507952934750451');" style=""> 648          }else if(selectNode.getKind() == CASE){                                                                   </span>
<span class="-6113591358780745482" onmouseenter="enter('-6113591358780745482');" onmouseout="out('-6113591358780745482');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 649 -            System.out.println(&quot;selectNode&quot;);                                                                     </span>
<span class="-1390336112814264886" onmouseenter="enter('-1390336112814264886');" onmouseout="out('-1390336112814264886');" style=""> 650              SqlCase sqlCase = (SqlCase) selectNode;                                                               </span>
<span class="-3655271460728510010" onmouseenter="enter('-3655271460728510010');" onmouseout="out('-3655271460728510010');" style=""> 651              SqlNodeList whenOperands = sqlCase.getWhenOperands();                                                 </span>
<span class="8318973293639639494" onmouseenter="enter('8318973293639639494');" onmouseout="out('8318973293639639494');" style=""> 652              SqlNodeList thenOperands = sqlCase.getThenOperands();                                                 </span>
<span class="3014895614462197568" onmouseenter="enter('3014895614462197568');" onmouseout="out('3014895614462197568');" style=""> 653              SqlNode elseNode = sqlCase.getElseOperand();                                                          </span>
<span  style=""> 654                                                                                                                    </span>
<span class="6346785150356032184" onmouseenter="enter('6346785150356032184');" onmouseout="out('6346785150356032184');" style=""> 655              for(int i=0; i&lt;whenOperands.size(); i++){                                                             </span>
<span class="1734344807386881213" onmouseenter="enter('1734344807386881213');" onmouseout="out('1734344807386881213');" style=""> 656                  SqlNode oneOperand = whenOperands.get(i);                                                         </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 657                  SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                            </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 658                  if (replaceNode != null) {                                                                        </span>
<span class="827753515492975605" onmouseenter="enter('827753515492975605');" onmouseout="out('827753515492975605');" style=""> 659                      whenOperands.set(i, replaceNode);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 660                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661              }                                                                                                     </span>
<span  style=""> 662                                                                                                                    </span>
<span class="-8902171898794493922" onmouseenter="enter('-8902171898794493922');" onmouseout="out('-8902171898794493922');" style=""> 663              for(int i=0; i&lt;thenOperands.size(); i++){                                                             </span>
<span class="-3989978989358262134" onmouseenter="enter('-3989978989358262134');" onmouseout="out('-3989978989358262134');" style=""> 664                  SqlNode oneOperand = thenOperands.get(i);                                                         </span>
<span class="-5229900958041612772" onmouseenter="enter('-5229900958041612772');" onmouseout="out('-5229900958041612772');" style=""> 665                  SqlNode replaceNode = replaceSelectFieldName(oneOperand, replaceInfo);                            </span>
<span class="7546853924527679598" onmouseenter="enter('7546853924527679598');" onmouseout="out('7546853924527679598');" style=""> 666                  if (replaceNode != null) {                                                                        </span>
<span class="-4947674979480974151" onmouseenter="enter('-4947674979480974151');" onmouseout="out('-4947674979480974151');" style=""> 667                      thenOperands.set(i, replaceNode);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 669              }                                                                                                     </span>
<span  style=""> 670                                                                                                                    </span>
<span class="-1702904876822094161" onmouseenter="enter('-1702904876822094161');" onmouseout="out('-1702904876822094161');" style=""> 671              ((SqlCase) selectNode).setOperand(3, replaceSelectFieldName(elseNode, replaceInfo));                  </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 672              return selectNode;                                                                                    </span>
<span class="-6373545674230253671" onmouseenter="enter('-6373545674230253671');" onmouseout="out('-6373545674230253671');" style=""> 673          }else if(selectNode.getKind() == OTHER){                                                                  </span>
<span class="-5542086300788940380" onmouseenter="enter('-5542086300788940380');" onmouseout="out('-5542086300788940380');" style=""> 674              //不处理                                                                                                 </span>
<span class="3674056650915394868" onmouseenter="enter('3674056650915394868');" onmouseout="out('3674056650915394868');" style=""> 675              return selectNode;                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 676          }else{                                                                                                    </span>
<span class="1153766920564476840" onmouseenter="enter('1153766920564476840');" onmouseout="out('1153766920564476840');" style=""><abbr title=" 677              throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNode.getKind()));"> 677              throw new RuntimeException(String.format(&quot;not support node kind of %s to replace name now.&quot;, selectNod🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 678          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679      }                                                                                                             </span>
<span  style=""> 680                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 681      /**                                                                                                           </span>
<span class="5196638318686351881" onmouseenter="enter('5196638318686351881');" onmouseout="out('5196638318686351881');" style=""><abbr title=" 682       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension table is the primary key definition"> 682       * Analyzing conditions are very join the dimension tables include all equivalent conditions (i.e., dimension 🔵</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 683       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 684       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 685       */                                                                                                           </span>
<span class="4488554625343324946" onmouseenter="enter('4488554625343324946');" onmouseout="out('4488554625343324946');" style=""><abbr title=" 686      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTableInfo) {"> 686      private boolean checkJoinCondition(SqlNode conditionNode, String sideTableAlias, AbstractSideTableInfo sideTab🔵</abbr></span>
<span class="-6710736308674703771" onmouseenter="enter('-6710736308674703771');" onmouseout="out('-6710736308674703771');" style=""> 687          List&lt;String&gt; conditionFields = getConditionFields(conditionNode, sideTableAlias, sideTableInfo);          </span>
<span class="-3924194481322428470" onmouseenter="enter('-3924194481322428470');" onmouseout="out('-3924194481322428470');" style=""> 688          if(CollectionUtils.isEqualCollection(conditionFields, convertPrimaryAlias(sideTableInfo))){               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 689              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 691          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692      }                                                                                                             </span>
<span  style=""> 693                                                                                                                    </span>
<span class="572998504046101497" onmouseenter="enter('572998504046101497');" onmouseout="out('572998504046101497');" style=""> 694      private List&lt;String&gt; convertPrimaryAlias(AbstractSideTableInfo sideTableInfo) {                               </span>
<span class="-6700733268022775520" onmouseenter="enter('-6700733268022775520');" onmouseout="out('-6700733268022775520');" style=""> 695          List&lt;String&gt; res = Lists.newArrayList();                                                                  </span>
<span class="-1517278133900331130" onmouseenter="enter('-1517278133900331130');" onmouseout="out('-1517278133900331130');" style=""> 696          sideTableInfo.getPrimaryKeys().forEach(field -&gt; {                                                         </span>
<span class="2991641550935988694" onmouseenter="enter('2991641550935988694');" onmouseout="out('2991641550935988694');" style=""> 697              res.add(sideTableInfo.getPhysicalFields().getOrDefault(field, field));                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 698          });                                                                                                       </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 699          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 700      }                                                                                                             </span>
<span  style=""> 701                                                                                                                    </span>
<span class="-958139939083183834" onmouseenter="enter('-958139939083183834');" onmouseout="out('-958139939083183834');" style=""><abbr title=" 702      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo sideTableInfo){"> 702      public List&lt;String&gt; getConditionFields(SqlNode conditionNode, String specifyTableName, AbstractSideTableInfo s🔵</abbr></span>
<span class="-5667062641477778387" onmouseenter="enter('-5667062641477778387');" onmouseout="out('-5667062641477778387');" style=""> 703          List&lt;SqlNode&gt; sqlNodeList = Lists.newArrayList();                                                         </span>
<span class="5003747983397221043" onmouseenter="enter('5003747983397221043');" onmouseout="out('5003747983397221043');" style=""> 704          ParseUtils.parseAnd(conditionNode, sqlNodeList);                                                          </span>
<span class="331902561671078290" onmouseenter="enter('331902561671078290');" onmouseout="out('331902561671078290');" style=""> 705          List&lt;String&gt; conditionFields = Lists.newArrayList();                                                      </span>
<span class="-2336842894952786561" onmouseenter="enter('-2336842894952786561');" onmouseout="out('-2336842894952786561');" style=""> 706          for(SqlNode sqlNode : sqlNodeList){                                                                       </span>
<span class="-1235221313035004193" onmouseenter="enter('-1235221313035004193');" onmouseout="out('-1235221313035004193');" style=""> 707              if (!SqlKind.COMPARISON.contains(sqlNode.getKind())) {                                                </span>
<span class="4238811186041433324" onmouseenter="enter('4238811186041433324');" onmouseout="out('4238811186041433324');" style=""> 708                  throw new RuntimeException(&quot;not compare operator.&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709              }                                                                                                     </span>
<span  style=""> 710                                                                                                                    </span>
<span class="-7359051973666627295" onmouseenter="enter('-7359051973666627295');" onmouseout="out('-7359051973666627295');" style=""> 711              SqlIdentifier left = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[0];                         </span>
<span class="3465298874779506196" onmouseenter="enter('3465298874779506196');" onmouseout="out('3465298874779506196');" style=""> 712              SqlIdentifier right = (SqlIdentifier)((SqlBasicCall)sqlNode).getOperands()[1];                        </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-2670749344655178863" onmouseenter="enter('-2670749344655178863');" onmouseout="out('-2670749344655178863');" style=""> 714              String leftTableName = left.getComponent(0).getSimple();                                              </span>
<span class="5188110590184041827" onmouseenter="enter('5188110590184041827');" onmouseout="out('5188110590184041827');" style=""> 715              String rightTableName = right.getComponent(0).getSimple();                                            </span>
<span  style=""> 716                                                                                                                    </span>
<span class="8082853509369418918" onmouseenter="enter('8082853509369418918');" onmouseout="out('8082853509369418918');" style=""> 717              String tableCol = &quot;&quot;;                                                                                 </span>
<span class="3869855333927982135" onmouseenter="enter('3869855333927982135');" onmouseout="out('3869855333927982135');" style=""> 718              if(leftTableName.equalsIgnoreCase(specifyTableName)){                                                 </span>
<span class="4527748628163402760" onmouseenter="enter('4527748628163402760');" onmouseout="out('4527748628163402760');" style=""> 719                  tableCol = left.getComponent(1).getSimple();                                                      </span>
<span class="5068195286258055415" onmouseenter="enter('5068195286258055415');" onmouseout="out('5068195286258055415');" style=""> 720              }else if(rightTableName.equalsIgnoreCase(specifyTableName)){                                          </span>
<span class="4462633703217831544" onmouseenter="enter('4462633703217831544');" onmouseout="out('4462633703217831544');" style=""> 721                  tableCol = right.getComponent(1).getSimple();                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 722              }else{                                                                                                </span>
<span class="3783543445731730404" onmouseenter="enter('3783543445731730404');" onmouseout="out('3783543445731730404');" style=""><abbr title=" 723                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName));"> 723                  throw new RuntimeException(String.format(&quot;side table:%s join condition is wrong&quot;, specifyTableName🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724              }                                                                                                     </span>
<span class="-2325401555704525047" onmouseenter="enter('-2325401555704525047');" onmouseout="out('-2325401555704525047');" style=""> 725              tableCol = sideTableInfo.getPhysicalFields().getOrDefault(tableCol, tableCol);                        </span>
<span class="-4552234441929070616" onmouseenter="enter('-4552234441929070616');" onmouseout="out('-4552234441929070616');" style=""> 726              conditionFields.add(tableCol);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727          }                                                                                                         </span>
<span  style=""> 728                                                                                                                    </span>
<span class="4950082808497882460" onmouseenter="enter('4950082808497882460');" onmouseout="out('4950082808497882460');" style=""> 729          return conditionFields;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730      }                                                                                                             </span>
<span  style=""> 731                                                                                                                    </span>
<span class="-8173208587282838964" onmouseenter="enter('-8173208587282838964');" onmouseout="out('-8173208587282838964');" style=""> 732      protected void dealAsSourceTable(StreamTableEnvironment tableEnv,                                             </span>
<span class="9126592535894268017" onmouseenter="enter('9126592535894268017');" onmouseout="out('9126592535894268017');" style=""> 733                                       SqlNode pollSqlNode,                                                         </span>
<span class="-1493383746124052329" onmouseenter="enter('-1493383746124052329');" onmouseout="out('-1493383746124052329');" style=""> 734                                       Map&lt;String, Table&gt; tableCache,                                               </span>
<span class="-3293670501905922467" onmouseenter="enter('-3293670501905922467');" onmouseout="out('-3293670501905922467');" style=""> 735                                       List&lt;FieldReplaceInfo&gt; replaceInfoList) throws SqlParseException {           </span>
<span  style=""> 736                                                                                                                    </span>
<span class="7772412594103241573" onmouseenter="enter('7772412594103241573');" onmouseout="out('7772412594103241573');" style=""> 737          AliasInfo aliasInfo = parseAsNode(pollSqlNode);                                                           </span>
<span class="2461088292100865778" onmouseenter="enter('2461088292100865778');" onmouseout="out('2461088292100865778');" style=""> 738          if (localTableCache.containsKey(aliasInfo.getName())) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 739              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740          }                                                                                                         </span>
<span  style=""> 741                                                                                                                    </span>
<span class="-3390660419579622283" onmouseenter="enter('-3390660419579622283');" onmouseout="out('-3390660419579622283');" style=""> 742          Table table = tableEnv.sqlQuery(aliasInfo.getName());                                                     </span>
<span class="5901087968051131557" onmouseenter="enter('5901087968051131557');" onmouseout="out('5901087968051131557');" style=""> 743          tableEnv.registerTable(aliasInfo.getAlias(), table);                                                      </span>
<span class="1100939894023116874" onmouseenter="enter('1100939894023116874');" onmouseout="out('1100939894023116874');" style=""> 744          localTableCache.put(aliasInfo.getAlias(), table);                                                         </span>
<span  style=""> 745                                                                                                                    </span>
<span class="7353361537117728269" onmouseenter="enter('7353361537117728269');" onmouseout="out('7353361537117728269');" style=""> 746          LOG.info(&quot;Register Table {} by {}&quot;, aliasInfo.getAlias(), aliasInfo.getName());                           </span>
<span  style=""> 747                                                                                                                    </span>
<span class="-8665165690117838262" onmouseenter="enter('-8665165690117838262');" onmouseout="out('-8665165690117838262');" style=""> 748          FieldReplaceInfo fieldReplaceInfo = parseAsQuery((SqlBasicCall) pollSqlNode, tableCache);                 </span>
<span class="-7633956211129533821" onmouseenter="enter('-7633956211129533821');" onmouseout="out('-7633956211129533821');" style=""> 749          if(fieldReplaceInfo == null){                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 750             return;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751          }                                                                                                         </span>
<span  style=""> 752                                                                                                                    </span>
<span class="-6438671410831308886" onmouseenter="enter('-6438671410831308886');" onmouseout="out('-6438671410831308886');" style=""> 753          //as 的源表                                                                                                  </span>
<span class="-7252441079357822746" onmouseenter="enter('-7252441079357822746');" onmouseout="out('-7252441079357822746');" style=""> 754          Set&lt;String&gt; fromTableNameSet = Sets.newHashSet();                                                         </span>
<span class="-1390965398492412473" onmouseenter="enter('-1390965398492412473');" onmouseout="out('-1390965398492412473');" style=""> 755          SqlNode fromNode = ((SqlBasicCall)pollSqlNode).getOperands()[0];                                          </span>
<span class="8218826531385538687" onmouseenter="enter('8218826531385538687');" onmouseout="out('8218826531385538687');" style=""> 756          TableUtils.getFromTableInfo(fromNode, fromTableNameSet);                                                  </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 757          for(FieldReplaceInfo tmp : replaceInfoList){                                                              </span>
<span class="7807393280391431617" onmouseenter="enter('7807393280391431617');" onmouseout="out('7807393280391431617');" style=""> 758              if(fromTableNameSet.contains(tmp.getTargetTableName())                                                </span>
<span class="-8987246733617074829" onmouseenter="enter('-8987246733617074829');" onmouseout="out('-8987246733617074829');" style=""> 759                      || fromTableNameSet.contains(tmp.getTargetTableAlias())){                                     </span>
<span class="-8130963267335023429" onmouseenter="enter('-8130963267335023429');" onmouseout="out('-8130963267335023429');" style=""> 760                  fieldReplaceInfo.setPreNode(tmp);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 761                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763          }                                                                                                         </span>
<span class="2047826278835391080" onmouseenter="enter('2047826278835391080');" onmouseout="out('2047826278835391080');" style=""> 764          replaceInfoList.add(fieldReplaceInfo);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 765      }                                                                                                             </span>
<span  style=""> 766                                                                                                                    </span>
<span class="4197581530070317287" onmouseenter="enter('4197581530070317287');" onmouseout="out('4197581530070317287');" style=""> 767      private void joinFun(Object pollObj, Map&lt;String, Table&gt; localTableCache,                                      </span>
<span class="-7423850058561480692" onmouseenter="enter('-7423850058561480692');" onmouseout="out('-7423850058561480692');" style=""> 768                           Map&lt;String, AbstractSideTableInfo&gt; sideTableMap, StreamTableEnvironment tableEnv,        </span>
<span class="-2956355081691304387" onmouseenter="enter('-2956355081691304387');" onmouseout="out('-2956355081691304387');" style=""> 769                           List&lt;FieldReplaceInfo&gt; replaceInfoList) throws Exception{                                </span>
<span class="-3106951960183426296" onmouseenter="enter('-3106951960183426296');" onmouseout="out('-3106951960183426296');" style=""> 770          JoinInfo joinInfo = (JoinInfo) pollObj;                                                                   </span>
<span  style=""> 771                                                                                                                    </span>
<span class="-4580559439294190862" onmouseenter="enter('-4580559439294190862');" onmouseout="out('-4580559439294190862');" style=""> 772          JoinScope joinScope = new JoinScope();                                                                    </span>
<span class="-6383140859888654083" onmouseenter="enter('-6383140859888654083');" onmouseout="out('-6383140859888654083');" style=""> 773          JoinScope.ScopeChild leftScopeChild = new JoinScope.ScopeChild();                                         </span>
<span class="-5401707331330951256" onmouseenter="enter('-5401707331330951256');" onmouseout="out('-5401707331330951256');" style=""> 774          leftScopeChild.setAlias(joinInfo.getLeftTableAlias());                                                    </span>
<span class="5108424867732442426" onmouseenter="enter('5108424867732442426');" onmouseout="out('5108424867732442426');" style=""> 775          leftScopeChild.setTableName(joinInfo.getLeftTableName());                                                 </span>
<span  style=""> 776                                                                                                                    </span>
<span class="-3105793890099317611" onmouseenter="enter('-3105793890099317611');" onmouseout="out('-3105793890099317611');" style=""> 777          SqlKind sqlKind = joinInfo.getLeftNode().getKind();                                                       </span>
<span class="9064898697795185402" onmouseenter="enter('9064898697795185402');" onmouseout="out('9064898697795185402');" style=""> 778          if(sqlKind == AS){                                                                                        </span>
<span class="17281975900406720" onmouseenter="enter('17281975900406720');" onmouseout="out('17281975900406720');" style=""> 779              dealAsSourceTable(tableEnv, joinInfo.getLeftNode(), localTableCache, replaceInfoList);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780          }                                                                                                         </span>
<span  style=""> 781                                                                                                                    </span>
<span class="-2402361542513321069" onmouseenter="enter('-2402361542513321069');" onmouseout="out('-2402361542513321069');" style=""><abbr title=" 782          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableName());"> 782          Table leftTable = getTableFromCache(localTableCache, joinInfo.getLeftTableAlias(), joinInfo.getLeftTableNa🔵</abbr></span>
<span class="5224542232803887157" onmouseenter="enter('5224542232803887157');" onmouseout="out('5224542232803887157');" style=""><abbr title=" 783          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getTypes(), leftTable.getSchema().getColumnNames());"> 783          RowTypeInfo leftTypeInfo = new RowTypeInfo(leftTable.getSchema().getTypes(), leftTable.getSchema().getColu🔵</abbr></span>


<span class="-5303860989220332569" onmouseenter="enter('-5303860989220332569');" onmouseout="out('-5303860989220332569');" style=""> 784          leftScopeChild.setRowTypeInfo(leftTypeInfo);                                                              </span>
<span  style=""> 785                                                                                                                    </span>
<span class="3043795906382715340" onmouseenter="enter('3043795906382715340');" onmouseout="out('3043795906382715340');" style=""> 786          JoinScope.ScopeChild rightScopeChild = new JoinScope.ScopeChild();                                        </span>
<span class="2585249270397691815" onmouseenter="enter('2585249270397691815');" onmouseout="out('2585249270397691815');" style=""> 787          rightScopeChild.setAlias(joinInfo.getRightTableAlias());                                                  </span>
<span class="-5072747544386586876" onmouseenter="enter('-5072747544386586876');" onmouseout="out('-5072747544386586876');" style=""> 788          rightScopeChild.setTableName(joinInfo.getRightTableName());                                               </span>
<span class="-6382774479188932768" onmouseenter="enter('-6382774479188932768');" onmouseout="out('-6382774479188932768');" style=""> 789          AbstractSideTableInfo sideTableInfo = sideTableMap.get(joinInfo.getRightTableName());                     </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 790          if(sideTableInfo == null){                                                                                </span>
<span class="-5396801098824602905" onmouseenter="enter('-5396801098824602905');" onmouseout="out('-5396801098824602905');" style=""> 791              sideTableInfo = sideTableMap.get(joinInfo.getRightTableAlias());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792          }                                                                                                         </span>
<span  style=""> 793                                                                                                                    </span>
<span class="-2759210686353099969" onmouseenter="enter('-2759210686353099969');" onmouseout="out('-2759210686353099969');" style=""> 794          if(sideTableInfo == null){                                                                                </span>
<span class="450947362076537032" onmouseenter="enter('450947362076537032');" onmouseout="out('450947362076537032');" style=""> 795              throw new RuntimeException(&quot;can&#x27;t not find side table:&quot; + joinInfo.getRightTableName());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796          }                                                                                                         </span>
<span  style=""> 797                                                                                                                    </span>
<span class="-4291640841301797203" onmouseenter="enter('-4291640841301797203');" onmouseout="out('-4291640841301797203');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 798 -        if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){           </span>
<span class="1819597685441785160" onmouseenter="enter('1819597685441785160');" onmouseout="out('1819597685441785160');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 799 -            throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 800 -        }                                                                                                         </span>
<span class="6668906180521634363" onmouseenter="enter('6668906180521634363');" onmouseout="out('6668906180521634363');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 801 +//        if(!checkJoinCondition(joinInfo.getCondition(), joinInfo.getRightTableAlias(), sideTableInfo)){         </span>
<span class="2570085130586631416" onmouseenter="enter('2570085130586631416');" onmouseout="out('2570085130586631416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 802 +//            throw new RuntimeException(&quot;ON condition must contain all equal fields!!!&quot;);                        </span>
<span class="-7859020312693891120" onmouseenter="enter('-7859020312693891120');" onmouseout="out('-7859020312693891120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 803 +//        }                                                                                                       </span>
<span  style=""> 804                                                                                                                    </span>
<span class="-1562873445908102884" onmouseenter="enter('-1562873445908102884');" onmouseout="out('-1562873445908102884');" style=""> 805          rightScopeChild.setRowTypeInfo(sideTableInfo.getRowTypeInfo());                                           </span>
<span  style=""> 806                                                                                                                    </span>
<span class="-5776192160472100987" onmouseenter="enter('-5776192160472100987');" onmouseout="out('-5776192160472100987');" style=""> 807          joinScope.addScope(leftScopeChild);                                                                       </span>
<span class="6805588345897841594" onmouseenter="enter('6805588345897841594');" onmouseout="out('6805588345897841594');" style=""> 808          joinScope.addScope(rightScopeChild);                                                                      </span>
<span  style=""> 809                                                                                                                    </span>
<span class="-816440763270240777" onmouseenter="enter('-816440763270240777');" onmouseout="out('-816440763270240777');" style=""> 810          //获取两个表的所有字段                                                                                              </span>
<span class="-6198283029075022684" onmouseenter="enter('-6198283029075022684');" onmouseout="out('-6198283029075022684');" style=""><abbr title=" 811          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, true);"> 811          List&lt;FieldInfo&gt; sideJoinFieldInfo = ParserJoinField.getRowTypeInfo(joinInfo.getSelectNode(), joinScope, tr🔵</abbr></span>
<span  style=""> 812                                                                                                                    </span>
<span class="-1467815726997680818" onmouseenter="enter('-1467815726997680818');" onmouseout="out('-1467815726997680818');" style=""> 813          String leftTableAlias = joinInfo.getLeftTableAlias();                                                     </span>
<span class="-6434853421912213287" onmouseenter="enter('-6434853421912213287');" onmouseout="out('-6434853421912213287');" style=""> 814          Table targetTable = localTableCache.get(leftTableAlias);                                                  </span>
<span class="-6749372432358522016" onmouseenter="enter('-6749372432358522016');" onmouseout="out('-6749372432358522016');" style=""> 815          if(targetTable == null){                                                                                  </span>
<span class="8734197217231436839" onmouseenter="enter('8734197217231436839');" onmouseout="out('8734197217231436839');" style=""> 816              targetTable = localTableCache.get(joinInfo.getLeftTableName());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817          }                                                                                                         </span>
<span  style=""> 818                                                                                                                    </span>
<span class="3450476289809538439" onmouseenter="enter('3450476289809538439');" onmouseout="out('3450476289809538439');" style=""><abbr title=" 819          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getTypes(), targetTable.getSchema().getColumnNames());"> 819          RowTypeInfo typeInfo = new RowTypeInfo(targetTable.getSchema().getTypes(), targetTable.getSchema().getColu🔵</abbr></span>
<span  style=""> 820                                                                                                                    </span>
<span class="-3004779098663820792" onmouseenter="enter('-3004779098663820792');" onmouseout="out('-3004779098663820792');" style=""> 821          DataStream&lt;CRow&gt; adaptStream = tableEnv.toRetractStream(targetTable, org.apache.flink.types.Row.class)    </span>
<span class="3479563451496228205" onmouseenter="enter('3479563451496228205');" onmouseout="out('3479563451496228205');" style=""> 822                  .map((Tuple2&lt;Boolean, Row&gt; tp2) -&gt; {                                                              </span>
<span class="7833906289428987345" onmouseenter="enter('7833906289428987345');" onmouseout="out('7833906289428987345');" style=""> 823                      return new CRow(tp2.f1, tp2.f0);                                                              </span>
<span class="-8730504840947162971" onmouseenter="enter('-8730504840947162971');" onmouseout="out('-8730504840947162971');" style=""> 824                  }).returns(CRow.class);                                                                           </span>
<span  style=""> 825                                                                                                                    </span>



<span  style=""> 826                                                                                                                    </span>
<span class="-6082173173678345991" onmouseenter="enter('-6082173173678345991');" onmouseout="out('-6082173173678345991');" style=""> 827          //join side table before keyby ===&gt; Reducing the size of each dimension table cache of async              </span>
<span class="6301552848628110191" onmouseenter="enter('6301552848628110191');" onmouseout="out('6301552848628110191');" style=""> 828          if (sideTableInfo.isPartitionedJoin()) {                                                                  </span>
<span class="-4638861421651181765" onmouseenter="enter('-4638861421651181765');" onmouseout="out('-4638861421651181765');" style=""><abbr title=" 829              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(), sideTableInfo);"> 829              List&lt;String&gt; leftJoinColList = getConditionFields(joinInfo.getCondition(), joinInfo.getLeftTableAlias(🔵</abbr></span>
<span class="-1086375650130423707" onmouseenter="enter('-1086375650130423707');" onmouseout="out('-1086375650130423707');" style=""> 830              List&lt;String&gt; fieldNames = Arrays.asList(targetTable.getSchema().getFieldNames());                     </span>
<span class="2517152886952033206" onmouseenter="enter('2517152886952033206');" onmouseout="out('2517152886952033206');" style=""> 831              int[] keyIndex = leftJoinColList.stream().mapToInt(fieldNames::indexOf).toArray();                    </span>
<span class="-7482412719932836963" onmouseenter="enter('-7482412719932836963');" onmouseout="out('-7482412719932836963');" style=""><abbr title=" 832              adaptStream = adaptStream.keyBy(new CRowKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.getSchema())));"> 832              adaptStream = adaptStream.keyBy(new CRowKeySelector(keyIndex, projectedTypeInfo(keyIndex, targetTable.🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833          }                                                                                                         </span>
<span  style=""> 834                                                                                                                    </span>
<span class="-1065289666164106717" onmouseenter="enter('-1065289666164106717');" onmouseout="out('-1065289666164106717');" style=""> 835          DataStream&lt;CRow&gt; dsOut = null;                                                                            </span>




<span class="3901580925108094660" onmouseenter="enter('3901580925108094660');" onmouseout="out('3901580925108094660');" style=""> 836          if(ECacheType.ALL.name().equalsIgnoreCase(sideTableInfo.getCacheType())){                                 </span>
<span class="7101184136852303035" onmouseenter="enter('7101184136852303035');" onmouseout="out('7101184136852303035');" style=""><abbr title=" 837              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 837              dsOut = SideWithAllCacheOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlP🔵</abbr></span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 838          }else{                                                                                                    </span>
<span class="7683243294616380271" onmouseenter="enter('7683243294616380271');" onmouseout="out('7683243294616380271');" style=""><abbr title=" 839              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPath, typeInfo, joinInfo, sideJoinFieldInfo, sideTableInfo);"> 839              dsOut = SideAsyncOperator.getSideJoinDataStream(adaptStream, sideTableInfo.getType(), localSqlPluginPa🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840          }                                                                                                         </span>
<span  style=""> 841                                                                                                                    </span>
<span class="1587039608171825646" onmouseenter="enter('1587039608171825646');" onmouseout="out('1587039608171825646');" style=""> 842          // TODO  将嵌套表中的字段传递过去, 去除冗余的ROWtime                                                                       </span>
<span class="-3840015462696951757" onmouseenter="enter('-3840015462696951757');" onmouseout="out('-3840015462696951757');" style=""> 843          HashBasedTable&lt;String, String, String&gt; mappingTable = HashBasedTable.create();                            </span>
<span class="2474148199265091642" onmouseenter="enter('2474148199265091642');" onmouseout="out('2474148199265091642');" style=""> 844          RowTypeInfo sideOutTypeInfo = buildOutRowTypeInfo(sideJoinFieldInfo, mappingTable);                       </span>
<span  style=""> 845                                                                                                                    </span>
<span class="-1611735526649110750" onmouseenter="enter('-1611735526649110750');" onmouseout="out('-1611735526649110750');" style=""> 846          CRowTypeInfo cRowTypeInfo = new CRowTypeInfo(sideOutTypeInfo);                                            </span>
<span class="-4428554219841205830" onmouseenter="enter('-4428554219841205830');" onmouseout="out('-4428554219841205830');" style=""> 847          dsOut.getTransformation().setOutputType(cRowTypeInfo);                                                    </span>


<span  style=""> 848                                                                                                                    </span>
<span class="4836712590888983064" onmouseenter="enter('4836712590888983064');" onmouseout="out('4836712590888983064');" style=""> 849          String targetTableName = joinInfo.getNewTableName();                                                      </span>
<span class="-3094587764130774762" onmouseenter="enter('-3094587764130774762');" onmouseout="out('-3094587764130774762');" style=""> 850          String targetTableAlias = joinInfo.getNewTableAlias();                                                    </span>
<span  style=""> 851                                                                                                                    </span>
<span class="-913526733197814375" onmouseenter="enter('-913526733197814375');" onmouseout="out('-913526733197814375');" style=""> 852          FieldReplaceInfo replaceInfo = new FieldReplaceInfo();                                                    </span>
<span class="877285140377329660" onmouseenter="enter('877285140377329660');" onmouseout="out('877285140377329660');" style=""> 853          replaceInfo.setMappingTable(mappingTable);                                                                </span>
<span class="8710576405434192583" onmouseenter="enter('8710576405434192583');" onmouseout="out('8710576405434192583');" style=""> 854          replaceInfo.setTargetTableName(targetTableName);                                                          </span>
<span class="-6613112199475906839" onmouseenter="enter('-6613112199475906839');" onmouseout="out('-6613112199475906839');" style=""> 855          replaceInfo.setTargetTableAlias(targetTableAlias);                                                        </span>
<span  style=""> 856                                                                                                                    </span>
<span class="-3207655655806857927" onmouseenter="enter('-3207655655806857927');" onmouseout="out('-3207655655806857927');" style=""> 857          //判断之前是不是被替换过,被替换过则设置之前的替换信息作为上一个节点                                                                       </span>
<span class="3962421982275373463" onmouseenter="enter('3962421982275373463');" onmouseout="out('3962421982275373463');" style=""> 858          for(FieldReplaceInfo tmp : replaceInfoList){                                                              </span>
<span class="6967693276121741260" onmouseenter="enter('6967693276121741260');" onmouseout="out('6967693276121741260');" style=""> 859              if(tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableName())                             </span>
<span class="8344413733256472211" onmouseenter="enter('8344413733256472211');" onmouseout="out('8344413733256472211');" style=""> 860              ||tmp.getTargetTableName().equalsIgnoreCase(joinInfo.getLeftTableAlias())){                           </span>
<span class="-1629804985910745096" onmouseenter="enter('-1629804985910745096');" onmouseout="out('-1629804985910745096');" style=""> 861                  replaceInfo.setPreNode(tmp);                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 862                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864          }                                                                                                         </span>
<span  style=""> 865                                                                                                                    </span>
<span class="2528453225163613561" onmouseenter="enter('2528453225163613561');" onmouseout="out('2528453225163613561');" style=""> 866          replaceInfoList.add(replaceInfo);                                                                         </span>
<span  style=""> 867                                                                                                                    </span>
<span class="1268462607712077740" onmouseenter="enter('1268462607712077740');" onmouseout="out('1268462607712077740');" style=""> 868          if (!tableEnv.isRegistered(joinInfo.getNewTableName())){                                                  </span>


<span class="-9057257427162955657" onmouseenter="enter('-9057257427162955657');" onmouseout="out('-9057257427162955657');" style=""> 869              Table joinTable = tableEnv.fromDataStream(dsOut);                                                     </span>
<span class="-7674974637599312088" onmouseenter="enter('-7674974637599312088');" onmouseout="out('-7674974637599312088');" style=""> 870              tableEnv.registerTable(joinInfo.getNewTableName(), joinTable);                                        </span>
<span class="5569875846259576593" onmouseenter="enter('5569875846259576593');" onmouseout="out('5569875846259576593');" style=""> 871              localTableCache.put(joinInfo.getNewTableName(), joinTable);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873      }                                                                                                             </span>
<span  style=""> 874                                                                                                                    </span>
<span class="2503560481488678812" onmouseenter="enter('2503560481488678812');" onmouseout="out('2503560481488678812');" style=""> 875      private TypeInformation&lt;Row&gt; projectedTypeInfo(int[] fields, TableSchema schema) {                            </span>
<span class="-934325254904626531" onmouseenter="enter('-934325254904626531');" onmouseout="out('-934325254904626531');" style=""> 876          String[] fieldNames = schema.getFieldNames();                                                             </span>
<span class="4556717060829301814" onmouseenter="enter('4556717060829301814');" onmouseout="out('4556717060829301814');" style=""> 877          TypeInformation&lt;?&gt;[] fieldTypes = schema.getFieldTypes();                                                 </span>
<span  style=""> 878                                                                                                                    </span>
<span class="424178526470659793" onmouseenter="enter('424178526470659793');" onmouseout="out('424178526470659793');" style=""> 879          String[] projectedNames = Arrays.stream(fields).mapToObj(i -&gt; fieldNames[i]).toArray(String[]::new);      </span>
<span class="5411397013359382914" onmouseenter="enter('5411397013359382914');" onmouseout="out('5411397013359382914');" style=""><abbr title=" 880          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformation[]::new);"> 880          TypeInformation[] projectedTypes = Arrays.stream(fields).mapToObj(i -&gt; fieldTypes[i]).toArray(TypeInformat🔵</abbr></span>
<span class="-5627838059420262860" onmouseenter="enter('-5627838059420262860');" onmouseout="out('-5627838059420262860');" style=""> 881          return new RowTypeInfo(projectedTypes, projectedNames);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882      }                                                                                                             </span>
<span  style=""> 883                                                                                                                    </span>
<span  style=""> 884                                                                                                                    </span>
<span class="-410103274617159114" onmouseenter="enter('-410103274617159114');" onmouseout="out('-410103274617159114');" style=""> 885      private boolean checkFieldsInfo(CreateTmpTableParser.SqlParserResult result, Table table) {                   </span>
<span class="8925867441251499081" onmouseenter="enter('8925867441251499081');" onmouseout="out('8925867441251499081');" style=""> 886          List&lt;String&gt; fieldNames = new LinkedList&lt;&gt;();                                                             </span>
<span class="-5553816012496774052" onmouseenter="enter('-5553816012496774052');" onmouseout="out('-5553816012496774052');" style=""> 887          String fieldsInfo = result.getFieldsInfoStr();                                                            </span>
<span class="-5855731071361337066" onmouseenter="enter('-5855731071361337066');" onmouseout="out('-5855731071361337066');" style=""> 888          String[] fields = StringUtils.split(fieldsInfo, &quot;,&quot;);                                                     </span>
<span class="8167763809890058258" onmouseenter="enter('8167763809890058258');" onmouseout="out('8167763809890058258');" style=""> 889          for (int i = 0; i &lt; fields.length; i++) {                                                                 </span>
<span class="2947314498030065040" onmouseenter="enter('2947314498030065040');" onmouseout="out('2947314498030065040');" style=""> 890              String[] filed = fields[i].split(&quot;\\s&quot;);                                                              </span>
<span class="-1166806966413379737" onmouseenter="enter('-1166806966413379737');" onmouseout="out('-1166806966413379737');" style=""> 891              if (filed.length &lt; 2 || fields.length != table.getSchema().getColumnNames().length){                  </span>

<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 892                  return false;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 893              } else {                                                                                              </span>
<span class="-7518627407039835792" onmouseenter="enter('-7518627407039835792');" onmouseout="out('-7518627407039835792');" style=""> 894                  String[] filedNameArr = new String[filed.length - 1];                                             </span>
<span class="6064994574122217386" onmouseenter="enter('6064994574122217386');" onmouseout="out('6064994574122217386');" style=""> 895                  System.arraycopy(filed, 0, filedNameArr, 0, filed.length - 1);                                    </span>
<span class="-3029457015937137256" onmouseenter="enter('-3029457015937137256');" onmouseout="out('-3029457015937137256');" style=""> 896                  String fieldName = String.join(&quot; &quot;, filedNameArr);                                                </span>
<span class="-8037943253867791720" onmouseenter="enter('-8037943253867791720');" onmouseout="out('-8037943253867791720');" style=""> 897                  fieldNames.add(fieldName);                                                                        </span>
<span class="516386479555957316" onmouseenter="enter('516386479555957316');" onmouseout="out('516386479555957316');" style=""> 898                  String fieldType = filed[filed.length - 1 ].trim();                                               </span>
<span class="-8511761590344571010" onmouseenter="enter('-8511761590344571010');" onmouseout="out('-8511761590344571010');" style=""> 899                  Class fieldClass = ClassUtil.stringConvertClass(fieldType);                                       </span>
<span class="-351203522969775469" onmouseenter="enter('-351203522969775469');" onmouseout="out('-351203522969775469');" style=""> 900                  Class tableField = table.getSchema().getFieldType(i).get().getTypeClass();                        </span>
<span class="9126336856345087988" onmouseenter="enter('9126336856345087988');" onmouseout="out('9126336856345087988');" style=""> 901                  if (fieldClass == tableField){                                                                    </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 902                      continue;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 903                  } else {                                                                                          </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 904                      return false;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 906              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 907          }                                                                                                         </span>
<span class="-7181802501759976675" onmouseenter="enter('-7181802501759976675');" onmouseout="out('-7181802501759976675');" style=""> 908          tmpFields = String.join(&quot;,&quot;, fieldNames);                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 909          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910      }                                                                                                             </span>
<span  style=""> 911                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            