<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>62</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    62
                    <a href="61.html">prev</a>
                    <a href="63.html">next</a>
                    <a href="62_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_99d857f3383c60ae4ae008f74e7d2b32afe9c26a_app/src/main/java/com/arialyy/simple/single_task/SingleTaskActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a:app/src/main/java/com/arialyy/simple/single_task/SingleTaskActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^1:app/src/main/java/com/arialyy/simple/single_task/SingleTaskActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^2:app/src/main/java/com/arialyy/simple/single_task/SingleTaskActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;41154d47fb8664ddca206122d28b50a6a3b8e9a6:app/src/main/java/com/arialyy/simple/single_task/SingleTaskActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.content.Context;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.content.Intent;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import android.os.Bundle;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import android.os.Environment;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import android.os.Handler;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import android.os.Message;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import android.view.View;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import android.widget.Button;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import android.widget.ImageView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import android.widget.TextView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import android.widget.Toast;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import butterknife.Bind;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36 import com.arialyy.aria.core.DownloadEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37 import com.arialyy.aria.core.task.DownloadUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 import com.arialyy.aria.core.task.IDownloadListener;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44 import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60       //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62   @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64   @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65   @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66   @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67   @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68   @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69   private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70   private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72       String action = intent.getAction();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73       if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79   private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80     @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       super.handleMessage(msg);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       switch (msg.what) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83         case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85           long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           long len = task.getFileSize();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87           if (len == 0) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88             mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89           } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90             mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92           mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94         case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99         case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104           Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105           mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108         case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109           mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111           mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114         case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115           //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116           //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117           //    .show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118           mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121         case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122           mPb.setProgress(100);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123           Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124           mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           mCancel.setEnabled(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133    * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134    */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135   private void setBtState(boolean state) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136     mStart.setEnabled(state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     mStop.setEnabled(!state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140   @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146     super.onResume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   @Override protected void onDestroy() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     super.onDestroy();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157     return R.layout.activity_single;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161     super.init(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   private void init() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172       mPb.setProgress(p);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176   public void onClick(View view) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177     switch (view.getId()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178       case R.id.start:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181           start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183           resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       case R.id.stop:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187         stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       case R.id.cancel:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190         cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   private void resume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196     Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   private void start() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200     Aria.whit(this)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201         .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202         .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203         .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204         .start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   private void stop() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208     Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   private void cancel() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212     Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215   private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216     @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218           .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221     @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222       super.onTaskResume(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226     @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230     @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234     @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238     @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242     @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246 }</span>
 247 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252  * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253  * You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255  *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266 import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 import android.os.Environment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271 import android.os.Handler;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 import android.os.Message;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273 import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 import android.widget.Button;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279 import butterknife.Bind;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280 import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282 import com.arialyy.aria.core.DownloadEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283 import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284 import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292   public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293   public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294   public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295   public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296   public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297   public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298   public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300   private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302       &quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304   @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305   @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306   @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307   @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308   @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309   @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310   @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311   private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312   private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313     @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314       String action = intent.getAction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315       if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316         L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317       }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319   };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321   private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323       super.handleMessage(msg);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324       switch (msg.what) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325         case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326           Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327           long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328           long len = task.getFileSize();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329           if (len == 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330             mPb.setProgress(0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331           } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333           }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334           mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336         case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338           setBtState(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339           //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342           Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346           Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347           mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351           mPb.setProgress(0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352           Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353           mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356         case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357           //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358           //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359           //    .show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360           mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361           setBtState(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363         case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364           mPb.setProgress(100);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365           Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366           mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367           mCancel.setEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370       }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372   };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374   /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375    * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376    */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377   private void setBtState(boolean state) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378     mStart.setEnabled(state);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379     mStop.setEnabled(!state);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382   @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383     super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384     init();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387   @Override protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388     super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389     Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390     //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393   @Override protected void onDestroy() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394     super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395     //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399     return R.layout.activity_single;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403     super.init(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404     setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405     toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406     init();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407     Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410   private void init() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411     if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412       AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413       int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414       mPb.setProgress(p);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418   public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     switch (view.getId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420       case R.id.start:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423           start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425           resume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428       case R.id.stop:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431       case R.id.cancel:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432         cancel();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437   private void resume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438     Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441   private void start() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     Aria.whit(this)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443         .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444         .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         .start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449   private void stop() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453   private void cancel() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454     Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457   private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458     @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460           .sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463     @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464       super.onTaskResume(task);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468     @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476     @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484     @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 }</span>
 489 =======
 490 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.content.Context;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.content.Intent;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import android.os.Bundle;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import android.os.Environment;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import android.os.Handler;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import android.os.Message;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import android.view.View;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import android.widget.Button;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import android.widget.ImageView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import android.widget.TextView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import android.widget.Toast;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import butterknife.Bind;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36 import com.arialyy.aria.core.DownloadEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37 import com.arialyy.aria.core.task.DownloadUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 import com.arialyy.aria.core.task.IDownloadListener;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44 import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60       //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62   @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64   @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65   @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66   @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67   @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68   @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69   private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70   private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72       String action = intent.getAction();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73       if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79   private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80     @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       super.handleMessage(msg);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       switch (msg.what) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83         case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85           long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           long len = task.getFileSize();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87           if (len == 0) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88             mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89           } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90             mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92           mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94         case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99         case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104           Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105           mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108         case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109           mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111           mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114         case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115           //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116           //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117           //    .show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118           mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121         case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122           mPb.setProgress(100);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123           Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124           mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           mCancel.setEnabled(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133    * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134    */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135   private void setBtState(boolean state) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136     mStart.setEnabled(state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     mStop.setEnabled(!state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140   @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146     super.onResume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   @Override protected void onDestroy() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     super.onDestroy();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157     return R.layout.activity_single;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161     super.init(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   private void init() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172       mPb.setProgress(p);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176   public void onClick(View view) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177     switch (view.getId()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178       case R.id.start:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181           start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183           resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       case R.id.stop:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187         stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       case R.id.cancel:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190         cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   private void resume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196     Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   private void start() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200     Aria.whit(this)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201         .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202         .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203         .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204         .start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   private void stop() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208     Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   private void cancel() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212     Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215   private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216     @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218           .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221     @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222       super.onTaskResume(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226     @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230     @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234     @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238     @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242     @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246 }</span>
 247 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252  * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253  * You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255  *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266 import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 import android.os.Environment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271 import android.os.Handler;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 import android.os.Message;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273 import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 import android.widget.Button;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279 import butterknife.Bind;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280 import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282 import com.arialyy.aria.core.DownloadEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283 import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284 import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292   public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293   public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294   public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295   public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296   public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297   public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298   public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300   private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302       &quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304   @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305   @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306   @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307   @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308   @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309   @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310   @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311   private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312   private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313     @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314       String action = intent.getAction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315       if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316         L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317       }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319   };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321   private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323       super.handleMessage(msg);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324       switch (msg.what) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325         case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326           Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327           long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328           long len = task.getFileSize();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329           if (len == 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330             mPb.setProgress(0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331           } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333           }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334           mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336         case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338           setBtState(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339           //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342           Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346           Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347           mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351           mPb.setProgress(0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352           Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353           mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356         case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357           //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358           //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359           //    .show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360           mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361           setBtState(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363         case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364           mPb.setProgress(100);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365           Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366           mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367           mCancel.setEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368           setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369           break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370       }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372   };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374   /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375    * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376    */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377   private void setBtState(boolean state) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378     mStart.setEnabled(state);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379     mStop.setEnabled(!state);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382   @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383     super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384     init();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387   @Override protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388     super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389     Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390     //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393   @Override protected void onDestroy() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394     super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395     //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399     return R.layout.activity_single;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403     super.init(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404     setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405     toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406     init();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407     Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410   private void init() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411     if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412       AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413       int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414       mPb.setProgress(p);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418   public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     switch (view.getId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420       case R.id.start:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423           start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425           resume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428       case R.id.stop:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431       case R.id.cancel:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432         cancel();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437   private void resume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438     Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441   private void start() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     Aria.whit(this)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443         .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444         .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         .start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449   private void stop() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453   private void cancel() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454     Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457   private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458     @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460           .sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463     @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464       super.onTaskResume(task);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468     @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476     @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484     @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 }</span>
 489 =======
 490 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18 package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.content.Context;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.content.Intent;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import android.os.Bundle;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import android.os.Environment;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import android.os.Handler;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import android.os.Message;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import android.view.View;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import android.widget.Button;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import android.widget.ImageView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import android.widget.TextView;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import android.widget.Toast;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import butterknife.Bind;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36 import com.arialyy.aria.core.DownloadEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37 import com.arialyy.aria.core.task.DownloadUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 import com.arialyy.aria.core.task.IDownloadListener;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44 import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48   public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50   public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60       //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62   @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64   @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65   @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66   @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67   @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68   @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69   private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70   private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71     @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72       String action = intent.getAction();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73       if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79   private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80     @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       super.handleMessage(msg);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       switch (msg.what) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83         case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84           Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85           long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           long len = task.getFileSize();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87           if (len == 0) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88             mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89           } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90             mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91           }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92           mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94         case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97           //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99         case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104           Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105           mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108         case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109           mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110           Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111           mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114         case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115           //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116           //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117           //    .show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118           mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119           setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121         case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122           mPb.setProgress(100);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123           Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124           mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           mCancel.setEnabled(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127           break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130   };</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132   /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133    * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134    */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135   private void setBtState(boolean state) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136     mStart.setEnabled(state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     mStop.setEnabled(!state);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140   @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145   @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146     super.onResume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151   @Override protected void onDestroy() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152     super.onDestroy();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153     //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157     return R.layout.activity_single;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161     super.init(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     init();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168   private void init() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169     if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170       AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172       mPb.setProgress(p);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176   public void onClick(View view) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177     switch (view.getId()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178       case R.id.start:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181           start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183           resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       case R.id.stop:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187         stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       case R.id.cancel:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190         cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195   private void resume() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196     Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   private void start() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200     Aria.whit(this)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201         .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202         .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203         .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204         .start();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   private void stop() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208     Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   private void cancel() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212     Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215   private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216     @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218           .sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221     @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222       super.onTaskResume(task);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223       mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226     @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227       mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230     @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231       mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234     @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235       mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238     @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239       mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242     @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243       mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246 }</span>
 247 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 248 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 248 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 249 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250 </span>
 251 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.arialyy.simple.single_task;
  18  
  19  import android.content.BroadcastReceiver;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.os.Bundle;
  23  import android.os.Environment;
  24  import android.os.Handler;
  25  import android.os.Message;
  26  import android.support.v7.widget.Toolbar;
  27  import android.view.View;
  28  import android.widget.Button;
  29  import android.widget.ImageView;
  30  import android.widget.TextView;
  31  import android.widget.Toast;
  32  import butterknife.Bind;
  33  import com.arialyy.aria.core.AMTarget;
  34  import com.arialyy.aria.core.Aria;
  35  import com.arialyy.aria.core.DownloadEntity;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import com.arialyy.aria.core.task.DownloadUtil;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import com.arialyy.aria.core.task.IDownloadListener;</span>
  38  import com.arialyy.aria.core.task.Task;
  39  import com.arialyy.aria.util.CommonUtil;
  40  import com.arialyy.frame.util.show.L;
  41  import com.arialyy.simple.R;
  42  import com.arialyy.simple.base.BaseActivity;
  43  import com.arialyy.simple.databinding.ActivitySingleBinding;
  44  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  45  
  46  public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  47    public static final  int    DOWNLOAD_PRE      = 0x01;
  48    public static final  int    DOWNLOAD_STOP     = 0x02;
  49    public static final  int    DOWNLOAD_FAILE    = 0x03;
  50    public static final  int    DOWNLOAD_CANCEL   = 0x04;
  51    public static final  int    DOWNLOAD_RESUME   = 0x05;
  52    public static final  int    DOWNLOAD_COMPLETE = 0x06;
  53    public static final  int    DOWNLOAD_RUNNING  = 0x07;
  54  
  55    private static final String DOWNLOAD_URL      =
  56        //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -      &quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +      //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +      &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +      //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;</span>
  61    @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  62    @Bind(R.id.start)       Button                          mStart;
  63    @Bind(R.id.stop)        Button                          mStop;
  64    @Bind(R.id.cancel)      Button                          mCancel;
  65    @Bind(R.id.size)        TextView                        mSize;
  66    @Bind(R.id.toolbar)     Toolbar                         toolbar;
  67    @Bind(R.id.speed)       TextView                        mSpeed;
  68    @Bind(R.id.img)         ImageView                       mImg;
  69    private                 DownloadEntity                  mEntity;
  70    private BroadcastReceiver mReceiver = new BroadcastReceiver() {
  71      @Override public void onReceive(Context context, Intent intent) {
  72        String action = intent.getAction();
  73        if (action.equals(Aria.ACTION_START)) {
  74          L.d(&quot;START&quot;);
  75        }
  76      }
  77    };
  78  
  79    private Handler mUpdateHandler = new Handler() {
  80      @Override public void handleMessage(Message msg) {
  81        super.handleMessage(msg);
  82        switch (msg.what) {
  83          case DOWNLOAD_RUNNING:
  84            Task task = (Task) msg.obj;
  85            long current = task.getCurrentProgress();
  86            long len = task.getFileSize();
  87            if (len == 0) {
  88              mPb.setProgress(0);
  89            } else {
  90              mPb.setProgress((int) ((current * 100) / len));
  91            }
  92            mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);
  93            break;
  94          case DOWNLOAD_PRE:
  95            mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
  96            setBtState(false);
  97            //mStart.setText(&quot;暂停&quot;);
  98            break;
  99          case DOWNLOAD_FAILE:
 100            Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();
 101            setBtState(true);
 102            break;
 103          case DOWNLOAD_STOP:
 104            Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();
 105            mStart.setText(&quot;恢复&quot;);
 106            setBtState(true);
 107            break;
 108          case DOWNLOAD_CANCEL:
 109            mPb.setProgress(0);
 110            Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();
 111            mStart.setText(&quot;开始&quot;);
 112            setBtState(true);
 113            break;
 114          case DOWNLOAD_RESUME:
 115            //Toast.makeText(SingleTaskActivity.this,
 116            //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)
 117            //    .show();
 118            mStart.setText(&quot;暂停&quot;);
 119            setBtState(false);
 120            break;
 121          case DOWNLOAD_COMPLETE:
 122            mPb.setProgress(100);
 123            Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();
 124            mStart.setText(&quot;重新开始？&quot;);
 125            mCancel.setEnabled(false);
 126            setBtState(true);
 127            break;
 128        }
 129      }
 130    };
 131  
 132    /**
 133     * 设置start 和 stop 按钮状态
 134     */
 135    private void setBtState(boolean state) {
 136      mStart.setEnabled(state);
 137      mStop.setEnabled(!state);
 138    }
 139  
 140    @Override protected void onCreate(Bundle savedInstanceState) {
 141      super.onCreate(savedInstanceState);
 142      init();
 143    }
 144  
 145    @Override protected void onResume() {
 146      super.onResume();
 147      Aria.whit(this).addSchedulerListener(new MySchedulerListener());
 148      //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());
 149    }
 150  
 151    @Override protected void onDestroy() {
 152      super.onDestroy();
 153      //unregisterReceiver(mReceiver);
 154    }
 155  
 156    @Override protected int setLayoutId() {
 157      return R.layout.activity_single;
 158    }
 159  
 160    @Override protected void init(Bundle savedInstanceState) {
 161      super.init(savedInstanceState);
 162      setSupportActionBar(toolbar);
 163      toolbar.setTitle(&quot;单任务下载&quot;);
 164      init();
 165      Aria.get(this).openBroadcast(true);
 166    }
 167  
 168    private void init() {
 169      if (Aria.get(this).taskExists(DOWNLOAD_URL)) {
 170        AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);
 171        int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());
 172        mPb.setProgress(p);
 173      }
 174    }
 175  
 176    public void onClick(View view) {
 177      switch (view.getId()) {
 178        case R.id.start:
 179          String text = ((TextView) view).getText().toString();
 180          if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {
 181            start();
 182          } else if (text.equals(&quot;恢复&quot;)) {
 183            resume();
 184          }
 185          break;
 186        case R.id.stop:
 187          stop();
 188          break;
 189        case R.id.cancel:
 190          cancel();
 191          break;
 192      }
 193    }
 194  
 195    private void resume() {
 196      Aria.whit(this).load(DOWNLOAD_URL).resume();
 197    }
 198  
 199    private void start() {
 200      Aria.whit(this)
 201          .load(DOWNLOAD_URL)
 202          .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 203          .setDownloadName(&quot;test.apk&quot;)
 204          .start();
 205    }
 206  
 207    private void stop() {
 208      Aria.whit(this).load(DOWNLOAD_URL).stop();
 209    }
 210  
 211    private void cancel() {
 212      Aria.whit(this).load(DOWNLOAD_URL).cancel();
 213    }
 214  
 215    private class MySchedulerListener extends Aria.SimpleSchedulerListener {
 216      @Override public void onTaskStart(Task task) {
 217        mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 218            .sendToTarget();
 219      }
 220  
 221      @Override public void onTaskResume(Task task) {
 222        super.onTaskResume(task);
 223        mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();
 224      }
 225  
 226      @Override public void onTaskStop(Task task) {
 227        mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 228      }
 229  
 230      @Override public void onTaskCancel(Task task) {
 231        mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 232      }
 233  
 234      @Override public void onTaskFail(Task task) {
 235        mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 236      }
 237  
 238      @Override public void onTaskComplete(Task task) {
 239        mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 240      }
 241  
 242      @Override public void onTaskRunning(Task task) {
 243        mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 244      }
 245    }
 246  }</pre></td>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -/*</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 - * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 - * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 - * you may not use this file except in compliance with the License.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 - * You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 - *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 - * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 - * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 - * limitations under the License.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -package com.arialyy.simple.single_task;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import android.content.BroadcastReceiver;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import android.content.Context;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import android.content.Intent;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import android.os.Bundle;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import android.os.Environment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import android.os.Handler;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import android.os.Message;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import android.support.v7.widget.Toolbar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import android.view.View;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import android.widget.Button;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import android.widget.ImageView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import android.widget.TextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import android.widget.Toast;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import butterknife.Bind;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.arialyy.aria.core.AMTarget;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.arialyy.aria.core.Aria;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import com.arialyy.aria.core.DownloadEntity;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import com.arialyy.aria.core.task.Task;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import com.arialyy.aria.util.CommonUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -import com.arialyy.simple.R;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -import com.arialyy.simple.databinding.ActivitySingleBinding;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -  public static final  int    DOWNLOAD_PRE      = 0x01;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -  public static final  int    DOWNLOAD_STOP     = 0x02;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -  public static final  int    DOWNLOAD_FAILE    = 0x03;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -  public static final  int    DOWNLOAD_CANCEL   = 0x04;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -  public static final  int    DOWNLOAD_RESUME   = 0x05;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -  public static final  int    DOWNLOAD_COMPLETE = 0x06;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -  public static final  int    DOWNLOAD_RUNNING  = 0x07;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -  private static final String DOWNLOAD_URL      =</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -      //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -      &quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -  @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -  @Bind(R.id.start)       Button                          mStart;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -  @Bind(R.id.stop)        Button                          mStop;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -  @Bind(R.id.cancel)      Button                          mCancel;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -  @Bind(R.id.size)        TextView                        mSize;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -  @Bind(R.id.toolbar)     Toolbar                         toolbar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -  @Bind(R.id.speed)       TextView                        mSpeed;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -  @Bind(R.id.img)         ImageView                       mImg;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -  private                 DownloadEntity                  mEntity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -  private BroadcastReceiver mReceiver = new BroadcastReceiver() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -    @Override public void onReceive(Context context, Intent intent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -      String action = intent.getAction();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -      if (action.equals(Aria.ACTION_START)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -        L.d(&quot;START&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -  };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -  private Handler mUpdateHandler = new Handler() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -    @Override public void handleMessage(Message msg) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -      super.handleMessage(msg);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -      switch (msg.what) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        case DOWNLOAD_RUNNING:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -          Task task = (Task) msg.obj;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -          long current = task.getCurrentProgress();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -          long len = task.getFileSize();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -          if (len == 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -            mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -          } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -            mPb.setProgress((int) ((current * 100) / len));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -          }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -          mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) + &quot;/s&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -        case DOWNLOAD_PRE:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -          mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -          setBtState(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -          //mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -        case DOWNLOAD_FAILE:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -          Toast.makeText(SingleTaskActivity.this, &quot;下载失败&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -          setBtState(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -        case DOWNLOAD_STOP:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -          Toast.makeText(SingleTaskActivity.this, &quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -          mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -          setBtState(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -        case DOWNLOAD_CANCEL:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -          mPb.setProgress(0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -          Toast.makeText(SingleTaskActivity.this, &quot;取消下载&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -          mStart.setText(&quot;开始&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -          setBtState(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -        case DOWNLOAD_RESUME:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -          //Toast.makeText(SingleTaskActivity.this,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + CommonUtil.formatFileSize((Long) msg.obj), Toast.LENGTH_SHORT)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -          //    .show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -          mStart.setText(&quot;暂停&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -          setBtState(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        case DOWNLOAD_COMPLETE:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -          mPb.setProgress(100);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -          Toast.makeText(SingleTaskActivity.this, &quot;下载完成&quot;, Toast.LENGTH_SHORT).show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -          mStart.setText(&quot;重新开始？&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -          mCancel.setEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -          setBtState(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -          break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -      }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -  };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -  /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -   * 设置start 和 stop 按钮状态</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -   */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -  private void setBtState(boolean state) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    mStart.setEnabled(state);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -    mStop.setEnabled(!state);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -  @Override protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -    super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -    init();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -  @Override protected void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -    super.onResume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -    Aria.whit(this).addSchedulerListener(new MySchedulerListener());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -    //registerReceiver(mReceiver, getModule(DownloadModule.class).getDownloadFilter());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -  @Override protected void onDestroy() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -    super.onDestroy();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -    //unregisterReceiver(mReceiver);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -  @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -    return R.layout.activity_single;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -  @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -    super.init(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -    setSupportActionBar(toolbar);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -    toolbar.setTitle(&quot;单任务下载&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -    init();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -    Aria.get(this).openBroadcast(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -  private void init() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -      AMTarget target = Aria.whit(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -      int      p      = (int) (target.getCurrentProgress() * 100 / target.getFileSize());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -      mPb.setProgress(p);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -  public void onClick(View view) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -    switch (view.getId()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -      case R.id.start:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -        String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -        if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -          start();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -        } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -          resume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -        break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -      case R.id.stop:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -        stop();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -        break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -      case R.id.cancel:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -        cancel();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -        break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -  private void resume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -    Aria.whit(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -  private void start() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -    Aria.whit(this)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -        .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -        .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -        .setDownloadName(&quot;test.apk&quot;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -        .start();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -  private void stop() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -    Aria.whit(this).load(DOWNLOAD_URL).stop();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -  private void cancel() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -    Aria.whit(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -  private class MySchedulerListener extends Aria.SimpleSchedulerListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -    @Override public void onTaskStart(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -          .sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -    @Override public void onTaskResume(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -      super.onTaskResume(task);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getFileSize()).sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -    @Override public void onTaskStop(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -      mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -    @Override public void onTaskCancel(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -      mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 228 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -    @Override public void onTaskFail(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -      mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -    @Override public void onTaskComplete(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -      mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -    @Override public void onTaskRunning(Task task) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -  }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -}</span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            