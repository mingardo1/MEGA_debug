<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>402</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    402
                    <a href="401.html">prev</a>
                    <a href="403.html">next</a>
                    <a href="402_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_5553ee5c6410a412ab4ed61d9499805adee8995a_cassandra/cassandra-side/cassandra-async-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAsyncReqRow.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a:cassandra/cassandra-side/cassandra-async-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAsyncReqRow.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^1:cassandra/cassandra-side/cassandra-async-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAsyncReqRow.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^2:cassandra/cassandra-side/cassandra-async-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAsyncReqRow.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e0a10435dcb243a911c0405daebc6aa667d5119d:cassandra/cassandra-side/cassandra-async-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAsyncReqRow.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  20 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  21                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  22 import com.datastax.driver.core.*;                                                                       </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  23 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  24 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">  25 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-4677472867777569519" onmouseenter="enter('-4677472867777569519');" onmouseout="out('-4677472867777569519');" style="">  26 import com.dtstack.flink.sql.side.*;                                                                     </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  27 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  28 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  29 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="-8710273414755433249" onmouseenter="enter('-8710273414755433249');" onmouseout="out('-8710273414755433249');" style="">  30 import com.google.common.base.Function;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  31 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4265236954961374581" onmouseenter="enter('-4265236954961374581');" onmouseout="out('-4265236954961374581');" style="">  32 import com.google.common.util.concurrent.AsyncFunction;                                                  </span>
<span class="3392144801777607486" onmouseenter="enter('3392144801777607486');" onmouseout="out('3392144801777607486');" style="">  33 import com.google.common.util.concurrent.FutureCallback;                                                 </span>
<span class="-3207866063314364212" onmouseenter="enter('-3207866063314364212');" onmouseout="out('-3207866063314364212');" style="">  34 import com.google.common.util.concurrent.Futures;                                                        </span>
<span class="2803111898123627106" onmouseenter="enter('2803111898123627106');" onmouseout="out('2803111898123627106');" style="">  35 import com.google.common.util.concurrent.ListenableFuture;                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  36 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  37 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  38 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  39 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  40 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  41 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  45 import java.net.InetAddress;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  46 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  47 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49 import java.util.Map;                                                                                    </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  50 import java.util.TimeZone;                                                                               </span>
<span  style="">  51                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  53  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  54  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  55  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  56  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57  */                                                                                                      </span>
<span class="-137893776588311003" onmouseenter="enter('-137893776588311003');" onmouseout="out('-137893776588311003');" style="">  58 public class CassandraAsyncReqRow extends BaseAsyncReqRow {                                              </span>
<span  style="">  59                                                                                                          </span>
<span class="-474972292974325668" onmouseenter="enter('-474972292974325668');" onmouseout="out('-474972292974325668');" style="">  60     private static final long serialVersionUID = 6631584128079864735L;                                   </span>
<span  style="">  61                                                                                                          </span>
<span class="-8305758559523834163" onmouseenter="enter('-8305758559523834163');" onmouseout="out('-8305758559523834163');" style="">  62     private static final Logger LOG = LoggerFactory.getLogger(CassandraAsyncReqRow.class);               </span>
<span  style="">  63                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  64     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  65                                                                                                          </span>
<span class="-4149057034501610834" onmouseenter="enter('-4149057034501610834');" onmouseout="out('-4149057034501610834');" style="">  66     private final static int DEFAULT_VERTX_EVENT_LOOP_POOL_SIZE = 10;                                    </span>
<span  style="">  67                                                                                                          </span>
<span class="-4781889690315923879" onmouseenter="enter('-4781889690315923879');" onmouseout="out('-4781889690315923879');" style="">  68     private final static int DEFAULT_VERTX_WORKER_POOL_SIZE = 20;                                        </span>
<span  style="">  69                                                                                                          </span>
<span class="8731062638120855225" onmouseenter="enter('8731062638120855225');" onmouseout="out('8731062638120855225');" style="">  70     private final static int DEFAULT_MAX_DB_CONN_POOL_SIZE = 20;                                         </span>
<span  style="">  71                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  72     private transient Cluster cluster;                                                                   </span>
<span class="-8047386482861852310" onmouseenter="enter('-8047386482861852310');" onmouseout="out('-8047386482861852310');" style="">  73     private transient ListenableFuture session;                                                          </span>
<span class="-1659440015873934350" onmouseenter="enter('-1659440015873934350');" onmouseout="out('-1659440015873934350');" style="">  74     private transient CassandraSideTableInfo cassandraSideTableInfo;                                     </span>
<span  style="">  75                                                                                                          </span>
<span class="8250235661803572167" onmouseenter="enter('8250235661803572167');" onmouseout="out('8250235661803572167');" style=""><abbr title="  76     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  76     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoL🔵</abbr></span>
<span class="2131899768365277438" onmouseenter="enter('2131899768365277438');" onmouseout="out('2131899768365277438');" style=""><abbr title="  77         super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  77         super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outF🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span  style="">  80                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  82     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  83         super.open(parameters);                                                                          </span>
<span class="-5020317085273715278" onmouseenter="enter('-5020317085273715278');" onmouseout="out('-5020317085273715278');" style="">  84         cassandraSideTableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                   </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style="">  85         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86     }                                                                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="2688225595233570188" onmouseenter="enter('2688225595233570188');" onmouseout="out('2688225595233570188');" style="">  88     private void connCassandraDB(CassandraSideTableInfo tableInfo) {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  89         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style="">  90             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style="">  91                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style="">  92                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style="">  93                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title="  94                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();">  94                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : 🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title="  95                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();">  95                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tabl🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title="  96                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();">  96                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : ta🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""><abbr title="  97                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();">  97                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQue🔵</abbr></span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title="  98                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();">  98                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title="  99                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();">  99                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tabl🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 100                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 100                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 101                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 102                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 103                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 104                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 105                 String database = tableInfo.getDatabase();                                               </span>
<span  style=""> 106                                                                                                          </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 107                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 108                 //Read timeout or connection timeout Settings                                            </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 109                 SocketOptions so = new SocketOptions()                                                   </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 110                         .setReadTimeoutMillis(readTimeoutMillis)                                         </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 111                         .setConnectTimeoutMillis(connectTimeoutMillis);                                  </span>
<span  style=""> 112                                                                                                          </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 113                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 114                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 115                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 116                 PoolingOptions poolingOptions = new PoolingOptions()                                     </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 117                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 118                         .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)       </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 119                         //Have at least two connections to each machine in the cluster                   </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 120                         .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)           </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 121                         //There are up to eight connections to each machine in the cluster               </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 122                         .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)             </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 123                         .setMaxQueueSize(maxQueueSize)                                                   </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 124                         .setPoolTimeoutMillis(poolTimeoutMillis);                                        </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 125                 //重试策略                                                                                   </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 126                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 128                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 129                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 130                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131                 }                                                                                        </span>
<span  style=""> 132                                                                                                          </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 133                 if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {  </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 134                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 134                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 135                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 136                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 137                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 138                 } else {                                                                                 </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 139                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 139                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 140                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 141                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 142                             .withCredentials(userName, password)                                         </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 143                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 145                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="-6325263381803948308" onmouseenter="enter('-6325263381803948308');" onmouseout="out('-6325263381803948308');" style=""> 146                 session = cluster.connectAsync(database);                                                </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 147                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 149         } catch (Exception e) {                                                                          </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 150             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152     }                                                                                                    </span>
<span  style=""> 153                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 155     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 155     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span  style=""> 156                                                                                                          </span>
<span class="-1687696912388971385" onmouseenter="enter('-1687696912388971385');" onmouseout="out('-1687696912388971385');" style=""> 157         String key = buildCacheKey(inputParams);                                                         </span>
<span class="-3943135781211957390" onmouseenter="enter('-3943135781211957390');" onmouseout="out('-3943135781211957390');" style=""> 158         //connect Cassandra                                                                              </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 159         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span  style=""> 160                                                                                                          </span>
<span class="8882875172916837309" onmouseenter="enter('8882875172916837309');" onmouseout="out('8882875172916837309');" style=""><abbr title=" 161         String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTERING &quot;;"> 161         String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  AL🔵</abbr></span>
<span class="7235570087826307362" onmouseenter="enter('7235570087826307362');" onmouseout="out('7235570087826307362');" style=""> 162         LOG.info(&quot;sqlCondition:{}&quot; + sqlCondition);                                                      </span>
<span  style=""> 163                                                                                                          </span>
<span class="-4677553123577559654" onmouseenter="enter('-4677553123577559654');" onmouseout="out('-4677553123577559654');" style=""> 164         ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session,                          </span>
<span class="-8970210976886405807" onmouseenter="enter('-8970210976886405807');" onmouseout="out('-8970210976886405807');" style=""> 165                 new AsyncFunction&lt;Session, ResultSet&gt;() {                                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166                     @Override                                                                            </span>
<span class="7229846643571334073" onmouseenter="enter('7229846643571334073');" onmouseout="out('7229846643571334073');" style=""> 167                     public ListenableFuture&lt;ResultSet&gt; apply(Session session) throws Exception {         </span>
<span class="2429380307619353" onmouseenter="enter('2429380307619353');" onmouseout="out('2429380307619353');" style=""> 168                         return session.executeAsync(sqlCondition);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 170                 });                                                                                      </span>
<span  style=""> 171                                                                                                          </span>
<span class="-2519838970460094251" onmouseenter="enter('-2519838970460094251');" onmouseout="out('-2519838970460094251');" style=""> 172         ListenableFuture&lt;List&lt;com.datastax.driver.core.Row&gt;&gt; data = Futures.transform(resultSet,         </span>
<span class="3568556365730474127" onmouseenter="enter('3568556365730474127');" onmouseout="out('3568556365730474127');" style=""> 173                 new Function&lt;ResultSet, List&lt;com.datastax.driver.core.Row&gt;&gt;() {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 174                     @Override                                                                            </span>
<span class="7863554394934287512" onmouseenter="enter('7863554394934287512');" onmouseout="out('7863554394934287512');" style=""> 175                     public List&lt;com.datastax.driver.core.Row&gt; apply(ResultSet rs) {                      </span>
<span class="-6387242574642327798" onmouseenter="enter('-6387242574642327798');" onmouseout="out('-6387242574642327798');" style=""> 176                         return rs.all();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 178                 });                                                                                      </span>
<span  style=""> 179                                                                                                          </span>
<span class="8124054865584677185" onmouseenter="enter('8124054865584677185');" onmouseout="out('8124054865584677185');" style=""> 180         Futures.addCallback(data, new FutureCallback&lt;List&lt;com.datastax.driver.core.Row&gt;&gt;() {             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 181             @Override                                                                                    </span>
<span class="-7968962151066113330" onmouseenter="enter('-7968962151066113330');" onmouseout="out('-7968962151066113330');" style=""> 182             public void onSuccess(List&lt;com.datastax.driver.core.Row&gt; rows) {                             </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 183                 cluster.closeAsync();                                                                    </span>
<span class="347035494226818967" onmouseenter="enter('347035494226818967');" onmouseout="out('347035494226818967');" style=""> 184                 if (rows.size() &gt; 0) {                                                                   </span>
<span class="7732099395665198389" onmouseenter="enter('7732099395665198389');" onmouseout="out('7732099395665198389');" style=""> 185                     List&lt;com.datastax.driver.core.Row&gt; cacheContent = Lists.newArrayList();              </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 186                     List&lt;Row&gt; rowList = Lists.newArrayList();                                            </span>
<span class="3453890066790785332" onmouseenter="enter('3453890066790785332');" onmouseout="out('3453890066790785332');" style=""> 187                     for (com.datastax.driver.core.Row line : rows) {                                     </span>
<span class="-7049321919275001077" onmouseenter="enter('-7049321919275001077');" onmouseout="out('-7049321919275001077');" style=""> 188                         Row row = fillData(input, line);                                                 </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 189                         if (openCache()) {                                                               </span>
<span class="7674485238819480651" onmouseenter="enter('7674485238819480651');" onmouseout="out('7674485238819480651');" style=""> 190                             cacheContent.add(line);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                         }                                                                                </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 192                         rowList.add(row);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                     }                                                                                    </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 194                     RowDataComplete.completeRow(resultFuture, rowList);                                  </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 195                     if (openCache()) {                                                                   </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 196                         putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 198                 } else {                                                                                 </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 199                     dealMissKey(input, resultFuture);                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 200                     if (openCache()) {                                                                   </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 201                         putCache(key, CacheMissVal.getMissKeyObj());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202                     }                                                                                    </span>
<span class="-4250051014526489812" onmouseenter="enter('-4250051014526489812');" onmouseout="out('-4250051014526489812');" style=""> 203                     resultFuture.complete(Collections.EMPTY_LIST);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205             }                                                                                            </span>
<span  style=""> 206                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 207             @Override                                                                                    </span>
<span class="-728167789593706694" onmouseenter="enter('-728167789593706694');" onmouseout="out('-728167789593706694');" style=""> 208             public void onFailure(Throwable t) {                                                         </span>
<span class="5577700706288044893" onmouseenter="enter('5577700706288044893');" onmouseout="out('5577700706288044893');" style=""> 209                 LOG.error(&quot;Failed to retrieve the data: %s%n&quot;,                                           </span>
<span class="2555455608745013339" onmouseenter="enter('2555455608745013339');" onmouseout="out('2555455608745013339');" style=""> 210                         t.getMessage());                                                                 </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 211                 cluster.closeAsync();                                                                    </span>
<span class="1780061706453512804" onmouseenter="enter('1780061706453512804');" onmouseout="out('1780061706453512804');" style=""> 212                 resultFuture.completeExceptionally(t);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 214         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 217     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 218     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 219         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 220         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-2299905763852680760" onmouseenter="enter('-2299905763852680760');" onmouseout="out('-2299905763852680760');" style=""> 221             sb.append(ele.toString()).append(&quot;_&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 223         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="-1821575284166957660" onmouseenter="enter('-1821575284166957660');" onmouseout="out('-1821575284166957660');" style=""> 226     private String buildWhereCondition(Map&lt;String, Object&gt; inputParams){                                 </span>
<span class="5090364847803370614" onmouseenter="enter('5090364847803370614');" onmouseout="out('5090364847803370614');" style=""> 227         StringBuilder sb = new StringBuilder(&quot; where &quot;);                                                 </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style=""> 228         for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                   </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style=""><abbr title=" 229             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();"> 229             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getV🔵</abbr></span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style=""> 230             sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 232         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span  style=""> 234                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 235     @Override                                                                                            </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style=""> 236     public Row fillData(Row input, Object line) {                                                        </span>
<span class="-1556735922244622351" onmouseenter="enter('-1556735922244622351');" onmouseout="out('-1556735922244622351');" style=""> 237         com.datastax.driver.core.Row rowArray = (com.datastax.driver.core.Row) line;                     </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 238         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 239         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 240             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 241 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 243 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244         for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                   </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 245             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();"> 245             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getV🔵</abbr></span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246             sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251     @Override                                                                                            </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252     public Row fillData(Row input, Object line) {                                                        </span>
<span class="-1556735922244622351" onmouseenter="enter('-1556735922244622351');" onmouseout="out('-1556735922244622351');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         com.datastax.driver.core.Row rowArray = (com.datastax.driver.core.Row) line;                     </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 257             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 257             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258                                                                                                          </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265                                                                                                          </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 267 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 268             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 268             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269                                                                                                          </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 272                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 272                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 275 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 276             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span  style=""> 278                                                                                                          </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style=""> 279         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {              </span>
<span class="-844467095686898872" onmouseenter="enter('-844467095686898872');" onmouseout="out('-844467095686898872');" style=""> 280             if (rowArray == null) {                                                                      </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 281                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 282             } else {                                                                                     </span>
<span class="-7910331794290062112" onmouseenter="enter('-7910331794290062112');" onmouseout="out('-7910331794290062112');" style=""> 283                 row.setField(entry.getKey(), rowArray.getObject(entry.getValue()));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span  style=""> 286                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 287         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288     }                                                                                                    </span>
<span  style=""> 289                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 290     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 291     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 292         super.close();                                                                                   </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 293         if (cluster != null) {                                                                           </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 294             cluster.close();                                                                             </span>
<span class="-8433337576020477133" onmouseenter="enter('-8433337576020477133');" onmouseout="out('-8433337576020477133');" style=""> 295             cluster = null;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  20 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  21                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  22 import com.datastax.driver.core.*;                                                                       </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  23 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  24 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  25 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  26 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  27 import org.apache.flink.types.Row;                                                                       </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  28 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  29 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">  30 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-4677472867777569519" onmouseenter="enter('-4677472867777569519');" onmouseout="out('-4677472867777569519');" style="">  31 import com.dtstack.flink.sql.side.*;                                                                     </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  32 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  33 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  34 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="-8710273414755433249" onmouseenter="enter('-8710273414755433249');" onmouseout="out('-8710273414755433249');" style="">  35 import com.google.common.base.Function;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  36 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4265236954961374581" onmouseenter="enter('-4265236954961374581');" onmouseout="out('-4265236954961374581');" style="">  37 import com.google.common.util.concurrent.AsyncFunction;                                                  </span>
<span class="3392144801777607486" onmouseenter="enter('3392144801777607486');" onmouseout="out('3392144801777607486');" style="">  38 import com.google.common.util.concurrent.FutureCallback;                                                 </span>
<span class="-3207866063314364212" onmouseenter="enter('-3207866063314364212');" onmouseout="out('-3207866063314364212');" style="">  39 import com.google.common.util.concurrent.Futures;                                                        </span>
<span class="2803111898123627106" onmouseenter="enter('2803111898123627106');" onmouseout="out('2803111898123627106');" style="">  40 import com.google.common.util.concurrent.ListenableFuture;                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  41 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  45 import java.net.InetAddress;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  46 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  47 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  49 import java.util.Map;                                                                                    </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  50 import java.util.TimeZone;                                                                               </span>
<span  style="">  51                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  53  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  54  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  55  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  56  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57  */                                                                                                      </span>
<span class="-137893776588311003" onmouseenter="enter('-137893776588311003');" onmouseout="out('-137893776588311003');" style="">  58 public class CassandraAsyncReqRow extends BaseAsyncReqRow {                                              </span>
<span  style="">  59                                                                                                          </span>
<span class="-474972292974325668" onmouseenter="enter('-474972292974325668');" onmouseout="out('-474972292974325668');" style="">  60     private static final long serialVersionUID = 6631584128079864735L;                                   </span>
<span  style="">  61                                                                                                          </span>
<span class="-8305758559523834163" onmouseenter="enter('-8305758559523834163');" onmouseout="out('-8305758559523834163');" style="">  62     private static final Logger LOG = LoggerFactory.getLogger(CassandraAsyncReqRow.class);               </span>
<span  style="">  63                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  64     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  65                                                                                                          </span>
<span class="-4149057034501610834" onmouseenter="enter('-4149057034501610834');" onmouseout="out('-4149057034501610834');" style="">  66     private final static int DEFAULT_VERTX_EVENT_LOOP_POOL_SIZE = 10;                                    </span>
<span  style="">  67                                                                                                          </span>
<span class="-4781889690315923879" onmouseenter="enter('-4781889690315923879');" onmouseout="out('-4781889690315923879');" style="">  68     private final static int DEFAULT_VERTX_WORKER_POOL_SIZE = 20;                                        </span>
<span  style="">  69                                                                                                          </span>
<span class="8731062638120855225" onmouseenter="enter('8731062638120855225');" onmouseout="out('8731062638120855225');" style="">  70     private final static int DEFAULT_MAX_DB_CONN_POOL_SIZE = 20;                                         </span>
<span  style="">  71                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  72     private transient Cluster cluster;                                                                   </span>
<span class="-8047386482861852310" onmouseenter="enter('-8047386482861852310');" onmouseout="out('-8047386482861852310');" style="">  73     private transient ListenableFuture session;                                                          </span>
<span class="-1659440015873934350" onmouseenter="enter('-1659440015873934350');" onmouseout="out('-1659440015873934350');" style="">  74     private transient CassandraSideTableInfo cassandraSideTableInfo;                                     </span>
<span  style="">  75                                                                                                          </span>
<span class="8250235661803572167" onmouseenter="enter('8250235661803572167');" onmouseout="out('8250235661803572167');" style=""><abbr title="  76     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  76     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoL🔵</abbr></span>
<span class="2131899768365277438" onmouseenter="enter('2131899768365277438');" onmouseout="out('2131899768365277438');" style=""><abbr title="  77         super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  77         super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outF🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span  style="">  80                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  82     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  83         super.open(parameters);                                                                          </span>
<span class="-5020317085273715278" onmouseenter="enter('-5020317085273715278');" onmouseout="out('-5020317085273715278');" style="">  84         cassandraSideTableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                   </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style="">  85         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86     }                                                                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="2688225595233570188" onmouseenter="enter('2688225595233570188');" onmouseout="out('2688225595233570188');" style="">  88     private void connCassandraDB(CassandraSideTableInfo tableInfo) {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  89         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style="">  90             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style="">  91                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style="">  92                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style="">  93                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title="  94                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();">  94                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : 🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title="  95                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();">  95                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tabl🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title="  96                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();">  96                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : ta🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""><abbr title="  97                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();">  97                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQue🔵</abbr></span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title="  98                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();">  98                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title="  99                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();">  99                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tabl🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 100                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 100                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 101                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 102                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 103                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 104                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 105                 String database = tableInfo.getDatabase();                                               </span>
<span  style=""> 106                                                                                                          </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 107                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 108                 //Read timeout or connection timeout Settings                                            </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 109                 SocketOptions so = new SocketOptions()                                                   </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 110                         .setReadTimeoutMillis(readTimeoutMillis)                                         </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 111                         .setConnectTimeoutMillis(connectTimeoutMillis);                                  </span>
<span  style=""> 112                                                                                                          </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 113                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 114                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 115                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 116                 PoolingOptions poolingOptions = new PoolingOptions()                                     </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 117                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 118                         .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)       </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 119                         //Have at least two connections to each machine in the cluster                   </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 120                         .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)           </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 121                         //There are up to eight connections to each machine in the cluster               </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 122                         .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)             </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 123                         .setMaxQueueSize(maxQueueSize)                                                   </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 124                         .setPoolTimeoutMillis(poolTimeoutMillis);                                        </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 125                 //重试策略                                                                                   </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 126                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 128                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 129                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 130                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131                 }                                                                                        </span>
<span  style=""> 132                                                                                                          </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 133                 if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {  </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 134                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 134                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 135                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 136                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 137                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 138                 } else {                                                                                 </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 139                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 139                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 140                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 141                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 142                             .withCredentials(userName, password)                                         </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 143                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 145                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="-6325263381803948308" onmouseenter="enter('-6325263381803948308');" onmouseout="out('-6325263381803948308');" style=""> 146                 session = cluster.connectAsync(database);                                                </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 147                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 149         } catch (Exception e) {                                                                          </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 150             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152     }                                                                                                    </span>
<span  style=""> 153                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 155     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 155     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span  style=""> 156                                                                                                          </span>
<span class="-1687696912388971385" onmouseenter="enter('-1687696912388971385');" onmouseout="out('-1687696912388971385');" style=""> 157         String key = buildCacheKey(inputParams);                                                         </span>
<span class="-3943135781211957390" onmouseenter="enter('-3943135781211957390');" onmouseout="out('-3943135781211957390');" style=""> 158         //connect Cassandra                                                                              </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 159         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span  style=""> 160                                                                                                          </span>
<span class="8882875172916837309" onmouseenter="enter('8882875172916837309');" onmouseout="out('8882875172916837309');" style=""><abbr title=" 161         String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTERING &quot;;"> 161         String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  AL🔵</abbr></span>
<span class="7235570087826307362" onmouseenter="enter('7235570087826307362');" onmouseout="out('7235570087826307362');" style=""> 162         LOG.info(&quot;sqlCondition:{}&quot; + sqlCondition);                                                      </span>
<span  style=""> 163                                                                                                          </span>
<span class="-4677553123577559654" onmouseenter="enter('-4677553123577559654');" onmouseout="out('-4677553123577559654');" style=""> 164         ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session,                          </span>
<span class="-8970210976886405807" onmouseenter="enter('-8970210976886405807');" onmouseout="out('-8970210976886405807');" style=""> 165                 new AsyncFunction&lt;Session, ResultSet&gt;() {                                                </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166                     @Override                                                                            </span>
<span class="7229846643571334073" onmouseenter="enter('7229846643571334073');" onmouseout="out('7229846643571334073');" style=""> 167                     public ListenableFuture&lt;ResultSet&gt; apply(Session session) throws Exception {         </span>
<span class="2429380307619353" onmouseenter="enter('2429380307619353');" onmouseout="out('2429380307619353');" style=""> 168                         return session.executeAsync(sqlCondition);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 170                 });                                                                                      </span>
<span  style=""> 171                                                                                                          </span>
<span class="-2519838970460094251" onmouseenter="enter('-2519838970460094251');" onmouseout="out('-2519838970460094251');" style=""> 172         ListenableFuture&lt;List&lt;com.datastax.driver.core.Row&gt;&gt; data = Futures.transform(resultSet,         </span>
<span class="3568556365730474127" onmouseenter="enter('3568556365730474127');" onmouseout="out('3568556365730474127');" style=""> 173                 new Function&lt;ResultSet, List&lt;com.datastax.driver.core.Row&gt;&gt;() {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 174                     @Override                                                                            </span>
<span class="7863554394934287512" onmouseenter="enter('7863554394934287512');" onmouseout="out('7863554394934287512');" style=""> 175                     public List&lt;com.datastax.driver.core.Row&gt; apply(ResultSet rs) {                      </span>
<span class="-6387242574642327798" onmouseenter="enter('-6387242574642327798');" onmouseout="out('-6387242574642327798');" style=""> 176                         return rs.all();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                     }                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 178                 });                                                                                      </span>
<span  style=""> 179                                                                                                          </span>
<span class="8124054865584677185" onmouseenter="enter('8124054865584677185');" onmouseout="out('8124054865584677185');" style=""> 180         Futures.addCallback(data, new FutureCallback&lt;List&lt;com.datastax.driver.core.Row&gt;&gt;() {             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 181             @Override                                                                                    </span>
<span class="-7968962151066113330" onmouseenter="enter('-7968962151066113330');" onmouseout="out('-7968962151066113330');" style=""> 182             public void onSuccess(List&lt;com.datastax.driver.core.Row&gt; rows) {                             </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 183                 cluster.closeAsync();                                                                    </span>
<span class="347035494226818967" onmouseenter="enter('347035494226818967');" onmouseout="out('347035494226818967');" style=""> 184                 if (rows.size() &gt; 0) {                                                                   </span>
<span class="7732099395665198389" onmouseenter="enter('7732099395665198389');" onmouseout="out('7732099395665198389');" style=""> 185                     List&lt;com.datastax.driver.core.Row&gt; cacheContent = Lists.newArrayList();              </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 186                     List&lt;Row&gt; rowList = Lists.newArrayList();                                            </span>
<span class="3453890066790785332" onmouseenter="enter('3453890066790785332');" onmouseout="out('3453890066790785332');" style=""> 187                     for (com.datastax.driver.core.Row line : rows) {                                     </span>
<span class="-7049321919275001077" onmouseenter="enter('-7049321919275001077');" onmouseout="out('-7049321919275001077');" style=""> 188                         Row row = fillData(input, line);                                                 </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 189                         if (openCache()) {                                                               </span>
<span class="7674485238819480651" onmouseenter="enter('7674485238819480651');" onmouseout="out('7674485238819480651');" style=""> 190                             cacheContent.add(line);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                         }                                                                                </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 192                         rowList.add(row);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                     }                                                                                    </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 194                     RowDataComplete.completeRow(resultFuture, rowList);                                  </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 195                     if (openCache()) {                                                                   </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 196                         putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 198                 } else {                                                                                 </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 199                     dealMissKey(input, resultFuture);                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 200                     if (openCache()) {                                                                   </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 201                         putCache(key, CacheMissVal.getMissKeyObj());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202                     }                                                                                    </span>
<span class="-4250051014526489812" onmouseenter="enter('-4250051014526489812');" onmouseout="out('-4250051014526489812');" style=""> 203                     resultFuture.complete(Collections.EMPTY_LIST);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205             }                                                                                            </span>
<span  style=""> 206                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 207             @Override                                                                                    </span>
<span class="-728167789593706694" onmouseenter="enter('-728167789593706694');" onmouseout="out('-728167789593706694');" style=""> 208             public void onFailure(Throwable t) {                                                         </span>
<span class="5577700706288044893" onmouseenter="enter('5577700706288044893');" onmouseout="out('5577700706288044893');" style=""> 209                 LOG.error(&quot;Failed to retrieve the data: %s%n&quot;,                                           </span>
<span class="2555455608745013339" onmouseenter="enter('2555455608745013339');" onmouseout="out('2555455608745013339');" style=""> 210                         t.getMessage());                                                                 </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 211                 cluster.closeAsync();                                                                    </span>
<span class="1780061706453512804" onmouseenter="enter('1780061706453512804');" onmouseout="out('1780061706453512804');" style=""> 212                 resultFuture.completeExceptionally(t);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 214         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 217     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 218     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 219         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 220         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-2299905763852680760" onmouseenter="enter('-2299905763852680760');" onmouseout="out('-2299905763852680760');" style=""> 221             sb.append(ele.toString()).append(&quot;_&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 223         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="-1821575284166957660" onmouseenter="enter('-1821575284166957660');" onmouseout="out('-1821575284166957660');" style=""> 226     private String buildWhereCondition(Map&lt;String, Object&gt; inputParams){                                 </span>
<span class="5090364847803370614" onmouseenter="enter('5090364847803370614');" onmouseout="out('5090364847803370614');" style=""> 227         StringBuilder sb = new StringBuilder(&quot; where &quot;);                                                 </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style=""> 228         for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                   </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style=""><abbr title=" 229             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();"> 229             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getV🔵</abbr></span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style=""> 230             sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 232         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span  style=""> 234                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 235     @Override                                                                                            </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style=""> 236     public Row fillData(Row input, Object line) {                                                        </span>
<span class="-1556735922244622351" onmouseenter="enter('-1556735922244622351');" onmouseout="out('-1556735922244622351');" style=""> 237         com.datastax.driver.core.Row rowArray = (com.datastax.driver.core.Row) line;                     </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 238         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 239         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 240             Object obj = input.getField(entry.getValue());                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 241 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 243 ||||||| BASE                                                                                             </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 244             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 244             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245                                                                                                          </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250             row.setField(entry.getKey(), obj);                                                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 251 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 252             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 252             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253                                                                                                          </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 256                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 256                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 259 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 260             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261         }                                                                                                </span>
<span  style=""> 262                                                                                                          </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style=""> 263         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {              </span>
<span class="-844467095686898872" onmouseenter="enter('-844467095686898872');" onmouseout="out('-844467095686898872');" style=""> 264             if (rowArray == null) {                                                                      </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 265                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 266             } else {                                                                                     </span>
<span class="-7910331794290062112" onmouseenter="enter('-7910331794290062112');" onmouseout="out('-7910331794290062112');" style=""> 267                 row.setField(entry.getKey(), rowArray.getObject(entry.getValue()));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269         }                                                                                                </span>
<span  style=""> 270                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 271         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span  style=""> 273                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 274     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 275     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 276         super.close();                                                                                   </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 277         if (cluster != null) {                                                                           </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 278             cluster.close();                                                                             </span>
<span class="-8433337576020477133" onmouseenter="enter('-8433337576020477133');" onmouseout="out('-8433337576020477133');" style=""> 279             cluster = null;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282 }                                                                                                        </span>














</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  18 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  20 import com.datastax.driver.core.*;                                                                       </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  21 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  22 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">  23 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-4677472867777569519" onmouseenter="enter('-4677472867777569519');" onmouseout="out('-4677472867777569519');" style="">  24 import com.dtstack.flink.sql.side.*;                                                                     </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  25 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  26 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  27 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="-8710273414755433249" onmouseenter="enter('-8710273414755433249');" onmouseout="out('-8710273414755433249');" style="">  28 import com.google.common.base.Function;                                                                  </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  29 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4265236954961374581" onmouseenter="enter('-4265236954961374581');" onmouseout="out('-4265236954961374581');" style="">  30 import com.google.common.util.concurrent.AsyncFunction;                                                  </span>
<span class="3392144801777607486" onmouseenter="enter('3392144801777607486');" onmouseout="out('3392144801777607486');" style="">  31 import com.google.common.util.concurrent.FutureCallback;                                                 </span>
<span class="-3207866063314364212" onmouseenter="enter('-3207866063314364212');" onmouseout="out('-3207866063314364212');" style="">  32 import com.google.common.util.concurrent.Futures;                                                        </span>
<span class="2803111898123627106" onmouseenter="enter('2803111898123627106');" onmouseout="out('2803111898123627106');" style="">  33 import com.google.common.util.concurrent.ListenableFuture;                                               </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  34 import java.net.InetAddress;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  35 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  36 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  37 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  38 import java.util.Map;                                                                                    </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  39 import java.util.TimeZone;                                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  40 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  41 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  42 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  43 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  44 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  45 import org.apache.flink.types.Row;                                                                       </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  46 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  47 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  48                                                                                                          </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  51  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  52  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  53  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  54  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55  */                                                                                                      </span>
<span class="-137893776588311003" onmouseenter="enter('-137893776588311003');" onmouseout="out('-137893776588311003');" style="">  56 public class CassandraAsyncReqRow extends BaseAsyncReqRow {                                              </span>
<span class="-474972292974325668" onmouseenter="enter('-474972292974325668');" onmouseout="out('-474972292974325668');" style="">  57     private static final long serialVersionUID = 6631584128079864735L;                                   </span>
<span  style="">  58                                                                                                          </span>
<span class="-8305758559523834163" onmouseenter="enter('-8305758559523834163');" onmouseout="out('-8305758559523834163');" style="">  59     private static final Logger LOG = LoggerFactory.getLogger(CassandraAsyncReqRow.class);               </span>
<span  style="">  60                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  61     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  62                                                                                                          </span>
<span class="-4149057034501610834" onmouseenter="enter('-4149057034501610834');" onmouseout="out('-4149057034501610834');" style="">  63     private final static int DEFAULT_VERTX_EVENT_LOOP_POOL_SIZE = 10;                                    </span>
<span  style="">  64                                                                                                          </span>
<span class="-4781889690315923879" onmouseenter="enter('-4781889690315923879');" onmouseout="out('-4781889690315923879');" style="">  65     private final static int DEFAULT_VERTX_WORKER_POOL_SIZE = 20;                                        </span>
<span  style="">  66                                                                                                          </span>
<span class="8731062638120855225" onmouseenter="enter('8731062638120855225');" onmouseout="out('8731062638120855225');" style="">  67     private final static int DEFAULT_MAX_DB_CONN_POOL_SIZE = 20;                                         </span>
<span  style="">  68                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  69     private transient Cluster cluster;                                                                   </span>
<span  style="">  70                                                                                                          </span>
<span class="-8047386482861852310" onmouseenter="enter('-8047386482861852310');" onmouseout="out('-8047386482861852310');" style="">  71     private transient ListenableFuture session;                                                          </span>
<span  style="">  72                                                                                                          </span>
<span class="-1659440015873934350" onmouseenter="enter('-1659440015873934350');" onmouseout="out('-1659440015873934350');" style="">  73     private transient CassandraSideTableInfo cassandraSideTableInfo;                                     </span>
<span  style="">  74                                                                                                          </span>
<span class="8250235661803572167" onmouseenter="enter('8250235661803572167');" onmouseout="out('8250235661803572167');" style=""><abbr title="  75     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  75     public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoL🔵</abbr></span>
<span class="779721780244651642" onmouseenter="enter('779721780244651642');" onmouseout="out('779721780244651642');" style="">  76         super(new CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  79     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  80     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  81         super.open(parameters);                                                                          </span>
<span class="-8893176068651566957" onmouseenter="enter('-8893176068651566957');" onmouseout="out('-8893176068651566957');" style="">  82         cassandraSideTableInfo = ((CassandraSideTableInfo) (sideInfo.getSideTableInfo()));               </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style="">  83         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="2688225595233570188" onmouseenter="enter('2688225595233570188');" onmouseout="out('2688225595233570188');" style="">  86     private void connCassandraDB(CassandraSideTableInfo tableInfo) {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  87         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style="">  88             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style="">  89                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style="">  90                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style="">  91                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4782430379426707011" onmouseenter="enter('-4782430379426707011');" onmouseout="out('-4782430379426707011');" style=""><abbr title="  92                 Integer maxRequestsPerConnection = (tableInfo.getMaxRequestsPerConnection() == null) ? 1 : tableInfo.getMaxRequestsPerConnection();">  92                 Integer maxRequestsPerConnection = (tableInfo.getMaxRequestsPerConnection() == null) ? 1 🔵</abbr></span>
<span class="-2959983233728834429" onmouseenter="enter('-2959983233728834429');" onmouseout="out('-2959983233728834429');" style=""><abbr title="  93                 Integer coreConnectionsPerHost = (tableInfo.getCoreConnectionsPerHost() == null) ? 8 : tableInfo.getCoreConnectionsPerHost();">  93                 Integer coreConnectionsPerHost = (tableInfo.getCoreConnectionsPerHost() == null) ? 8 : ta🔵</abbr></span>
<span class="8832744314563358603" onmouseenter="enter('8832744314563358603');" onmouseout="out('8832744314563358603');" style=""><abbr title="  94                 Integer maxConnectionsPerHost = (tableInfo.getMaxConnectionsPerHost() == null) ? 32768 : tableInfo.getMaxConnectionsPerHost();">  94                 Integer maxConnectionsPerHost = (tableInfo.getMaxConnectionsPerHost() == null) ? 32768 : 🔵</abbr></span>
<span class="3961503531158931197" onmouseenter="enter('3961503531158931197');" onmouseout="out('3961503531158931197');" style=""><abbr title="  95                 Integer maxQueueSize = (tableInfo.getMaxQueueSize() == null) ? 100000 : tableInfo.getMaxQueueSize();">  95                 Integer maxQueueSize = (tableInfo.getMaxQueueSize() == null) ? 100000 : tableInfo.getMaxQ🔵</abbr></span>
<span class="-6994348591486560076" onmouseenter="enter('-6994348591486560076');" onmouseout="out('-6994348591486560076');" style=""><abbr title="  96                 Integer readTimeoutMillis = (tableInfo.getReadTimeoutMillis() == null) ? 60000 : tableInfo.getReadTimeoutMillis();">  96                 Integer readTimeoutMillis = (tableInfo.getReadTimeoutMillis() == null) ? 60000 : tableInf🔵</abbr></span>
<span class="-3816562610310084202" onmouseenter="enter('-3816562610310084202');" onmouseout="out('-3816562610310084202');" style=""><abbr title="  97                 Integer connectTimeoutMillis = (tableInfo.getConnectTimeoutMillis() == null) ? 60000 : tableInfo.getConnectTimeoutMillis();">  97                 Integer connectTimeoutMillis = (tableInfo.getConnectTimeoutMillis() == null) ? 60000 : ta🔵</abbr></span>
<span class="-596580868946876650" onmouseenter="enter('-596580868946876650');" onmouseout="out('-596580868946876650');" style=""><abbr title="  98                 Integer poolTimeoutMillis = (tableInfo.getPoolTimeoutMillis() == null) ? 60000 : tableInfo.getPoolTimeoutMillis();">  98                 Integer poolTimeoutMillis = (tableInfo.getPoolTimeoutMillis() == null) ? 60000 : tableInf🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style="">  99                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 100                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 101                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 102                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 103                 String database = tableInfo.getDatabase();                                               </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 104                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 105                 //Read timeout or connection timeout Settings                                            </span>
<span class="6310702936913058326" onmouseenter="enter('6310702936913058326');" onmouseout="out('6310702936913058326');" style=""><abbr title=" 106                 SocketOptions so = new SocketOptions().setReadTimeoutMillis(readTimeoutMillis).setConnectTimeoutMillis(connectTimeoutMillis);"> 106                 SocketOptions so = new SocketOptions().setReadTimeoutMillis(readTimeoutMillis).setConnect🔵</abbr></span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 107                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 108                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 109                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="8986923449121229528" onmouseenter="enter('8986923449121229528');" onmouseout="out('8986923449121229528');" style=""><abbr title=" 110                 PoolingOptions poolingOptions = //There are up to eight connections to each machine in the cluster"> 110                 PoolingOptions poolingOptions = //There are up to eight connections to each machine in th🔵</abbr></span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 111                         //Have at least two connections to each machine in the cluster                   </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 112                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="-7470761056979998062" onmouseenter="enter('-7470761056979998062');" onmouseout="out('-7470761056979998062');" style=""><abbr title=" 113                 new PoolingOptions().setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection).setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost).setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost).setMaxQueueSize(maxQueueSize).setPoolTimeoutMillis(poolTimeoutMillis);"> 113                 new PoolingOptions().setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnec🔵</abbr></span>
<span class="7009140327554883147" onmouseenter="enter('7009140327554883147');" onmouseout="out('7009140327554883147');" style=""> 114                 // 重试策略                                                                                  </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 115                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 116                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 117                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 118                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119                 }                                                                                        </span>
<span class="991380888600756778" onmouseenter="enter('991380888600756778');" onmouseout="out('991380888600756778');" style=""><abbr title=" 120                 if ((((userName == null) || userName.isEmpty()) || (password == null)) || password.isEmpty()) {"> 120                 if ((((userName == null) || userName.isEmpty()) || (password == null)) || password.isEmpt🔵</abbr></span>
<span class="3802514815758396017" onmouseenter="enter('3802514815758396017');" onmouseout="out('3802514815758396017');" style=""><abbr title=" 121                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy).withPort(cassandraPort).withPoolingOptions(poolingOptions).withSocketOptions(so).withQueryOptions(queryOptions).build();"> 121                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 122                 } else {                                                                                 </span>
<span class="8825572864862900210" onmouseenter="enter('8825572864862900210');" onmouseout="out('8825572864862900210');" style=""><abbr title=" 123                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy).withPort(cassandraPort).withPoolingOptions(poolingOptions).withSocketOptions(so).withCredentials(userName, password).withQueryOptions(queryOptions).build();"> 123                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 125                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="-6325263381803948308" onmouseenter="enter('-6325263381803948308');" onmouseout="out('-6325263381803948308');" style=""> 126                 session = cluster.connectAsync(database);                                                </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 127                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 129         } catch (java.lang.Exception e) {                                                                </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 130             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 135     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 135     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span class="-1687696912388971385" onmouseenter="enter('-1687696912388971385');" onmouseout="out('-1687696912388971385');" style=""> 136         String key = buildCacheKey(inputParams);                                                         </span>
<span class="-7543481252963867116" onmouseenter="enter('-7543481252963867116');" onmouseout="out('-7543481252963867116');" style=""> 137         // connect Cassandra                                                                             </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 138         connCassandraDB(cassandraSideTableInfo);                                                         </span>
<span class="8684725255804702151" onmouseenter="enter('8684725255804702151');" onmouseout="out('8684725255804702151');" style=""><abbr title=" 139         String sqlCondition = ((sideInfo.getSqlCondition() + &quot; &quot;) + buildWhereCondition(inputParams)) + &quot;  ALLOW FILTERING &quot;;"> 139         String sqlCondition = ((sideInfo.getSqlCondition() + &quot; &quot;) + buildWhereCondition(inputParams)) + &quot;🔵</abbr></span>
<span class="7235570087826307362" onmouseenter="enter('7235570087826307362');" onmouseout="out('7235570087826307362');" style=""> 140         LOG.info(&quot;sqlCondition:{}&quot; + sqlCondition);                                                      </span>
<span class="7534463150884306489" onmouseenter="enter('7534463150884306489');" onmouseout="out('7534463150884306489');" style=""><abbr title=" 141         ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session, new AsyncFunction&lt;Session, ResultSet&gt;() {"> 141         ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session, new AsyncFunction&lt;Session🔵</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 142             @Override                                                                                    </span>
<span class="7229846643571334073" onmouseenter="enter('7229846643571334073');" onmouseout="out('7229846643571334073');" style=""> 143             public ListenableFuture&lt;ResultSet&gt; apply(Session session) throws Exception {                 </span>
<span class="2429380307619353" onmouseenter="enter('2429380307619353');" onmouseout="out('2429380307619353');" style=""> 144                 return session.executeAsync(sqlCondition);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 146         });                                                                                              </span>
<span class="842859975496295822" onmouseenter="enter('842859975496295822');" onmouseout="out('842859975496295822');" style=""><abbr title=" 147         ListenableFuture&lt;List&lt;Row&gt;&gt; data = Futures.transform(resultSet, new Function&lt;ResultSet, List&lt;Row&gt;&gt;() {"> 147         ListenableFuture&lt;List&lt;Row&gt;&gt; data = Futures.transform(resultSet, new Function&lt;ResultSet, List&lt;Row&gt;🔵</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 148             @Override                                                                                    </span>
<span class="-7747471151794006118" onmouseenter="enter('-7747471151794006118');" onmouseout="out('-7747471151794006118');" style=""> 149             public List&lt;Row&gt; apply(ResultSet rs) {                                                       </span>
<span class="-6387242574642327798" onmouseenter="enter('-6387242574642327798');" onmouseout="out('-6387242574642327798');" style=""> 150                 return rs.all();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 152         });                                                                                              </span>
<span class="-1331680589845053930" onmouseenter="enter('-1331680589845053930');" onmouseout="out('-1331680589845053930');" style=""> 153         Futures.addCallback(data, new FutureCallback&lt;List&lt;Row&gt;&gt;() {                                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 154             @Override                                                                                    </span>
<span class="381862167729126143" onmouseenter="enter('381862167729126143');" onmouseout="out('381862167729126143');" style=""> 155             public void onSuccess(List&lt;Row&gt; rows) {                                                      </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 156                 cluster.closeAsync();                                                                    </span>
<span class="347035494226818967" onmouseenter="enter('347035494226818967');" onmouseout="out('347035494226818967');" style=""> 157                 if (rows.size() &gt; 0) {                                                                   </span>
<span class="695574945644985280" onmouseenter="enter('695574945644985280');" onmouseout="out('695574945644985280');" style=""> 158                     List&lt;Row&gt; cacheContent = Lists.newArrayList();                                       </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 159                     List&lt;Row&gt; rowList = Lists.newArrayList();                                            </span>
<span class="870482883557262977" onmouseenter="enter('870482883557262977');" onmouseout="out('870482883557262977');" style=""> 160                     for (Row line : rows) {                                                              </span>
<span class="-7049321919275001077" onmouseenter="enter('-7049321919275001077');" onmouseout="out('-7049321919275001077');" style=""> 161                         Row row = fillData(input, line);                                                 </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 162                         if (openCache()) {                                                               </span>
<span class="7674485238819480651" onmouseenter="enter('7674485238819480651');" onmouseout="out('7674485238819480651');" style=""> 163                             cacheContent.add(line);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                         }                                                                                </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 165                         rowList.add(row);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                     }                                                                                    </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 167                     RowDataComplete.completeRow(resultFuture, rowList);                                  </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 168                     if (openCache()) {                                                                   </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 169                         putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 171                 } else {                                                                                 </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 172                     dealMissKey(input, resultFuture);                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 173                     if (openCache()) {                                                                   </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 174                         putCache(key, CacheMissVal.getMissKeyObj());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                     }                                                                                    </span>
<span class="-4250051014526489812" onmouseenter="enter('-4250051014526489812');" onmouseout="out('-4250051014526489812');" style=""> 176                     resultFuture.complete(Collections.EMPTY_LIST);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178             }                                                                                            </span>
<span  style=""> 179                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 180             @Override                                                                                    </span>
<span class="-728167789593706694" onmouseenter="enter('-728167789593706694');" onmouseout="out('-728167789593706694');" style=""> 181             public void onFailure(Throwable t) {                                                         </span>
<span class="3913011627542202734" onmouseenter="enter('3913011627542202734');" onmouseout="out('3913011627542202734');" style=""> 182                 LOG.error(&quot;Failed to retrieve the data: %s%n&quot;, t.getMessage());                          </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 183                 cluster.closeAsync();                                                                    </span>
<span class="1780061706453512804" onmouseenter="enter('1780061706453512804');" onmouseout="out('1780061706453512804');" style=""> 184                 resultFuture.completeExceptionally(t);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 186         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 189     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 190     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 191         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 192         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-2299905763852680760" onmouseenter="enter('-2299905763852680760');" onmouseout="out('-2299905763852680760');" style=""> 193             sb.append(ele.toString()).append(&quot;_&quot;);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 195         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="-1821575284166957660" onmouseenter="enter('-1821575284166957660');" onmouseout="out('-1821575284166957660');" style=""> 198     private String buildWhereCondition(Map&lt;String, Object&gt; inputParams){                                 </span>
<span class="5090364847803370614" onmouseenter="enter('5090364847803370614');" onmouseout="out('5090364847803370614');" style=""> 199         StringBuilder sb = new StringBuilder(&quot; where &quot;);                                                 </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style=""> 200         for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                   </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style=""><abbr title=" 201             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();"> 201             Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getV🔵</abbr></span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style=""> 202             sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 204         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205     }                                                                                                    </span>
<span  style=""> 206                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 207     @Override                                                                                            </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style=""> 208     public Row fillData(Row input, Object line) {                                                        </span>
<span class="-3682228513110893976" onmouseenter="enter('-3682228513110893976');" onmouseout="out('-3682228513110893976');" style=""> 209         Row rowArray = ((Row) (line));                                                                   </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 210         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 211         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 212             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style=""> 213             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 214             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215         }                                                                                                </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style=""> 216         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {              </span>
<span class="-844467095686898872" onmouseenter="enter('-844467095686898872');" onmouseout="out('-844467095686898872');" style=""> 217             if (rowArray == null) {                                                                      </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 218                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 219             } else {                                                                                     </span>
<span class="-7910331794290062112" onmouseenter="enter('-7910331794290062112');" onmouseout="out('-7910331794290062112');" style=""> 220                 row.setField(entry.getKey(), rowArray.getObject(entry.getValue()));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 223         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224     }                                                                                                    </span>
<span  style=""> 225                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 226     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 227     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 228         super.close();                                                                                   </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 229         if (cluster != null) {                                                                           </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 230             cluster.close();                                                                             </span>
<span class="-8433337576020477133" onmouseenter="enter('-8433337576020477133');" onmouseout="out('-8433337576020477133');" style=""> 231             cluster = null;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234 }                                                                                                        </span>






























































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  20  package com.dtstack.flink.sql.side.cassandra;                                                                     </span>
<span  style="">  21                                                                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.flink.streaming.api.functions.async.ResultFuture;                                               </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import org.apache.flink.types.Row;                                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -                                                                                                                  </span>
<span class="-4674624431842718354" onmouseenter="enter('-4674624431842718354');" onmouseout="out('-4674624431842718354');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.datastax.driver.core.Cluster;                                                                          </span>
<span class="4630389600773953361" onmouseenter="enter('4630389600773953361');" onmouseout="out('4630389600773953361');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import com.datastax.driver.core.ConsistencyLevel;                                                                 </span>
<span class="-5077913371267042181" onmouseenter="enter('-5077913371267042181');" onmouseout="out('-5077913371267042181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import com.datastax.driver.core.HostDistance;                                                                     </span>
<span class="-8460078615292194921" onmouseenter="enter('-8460078615292194921');" onmouseout="out('-8460078615292194921');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import com.datastax.driver.core.PoolingOptions;                                                                   </span>
<span class="3500480560938999402" onmouseenter="enter('3500480560938999402');" onmouseout="out('3500480560938999402');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import com.datastax.driver.core.QueryOptions;                                                                     </span>
<span class="1295458347604392536" onmouseenter="enter('1295458347604392536');" onmouseout="out('1295458347604392536');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import com.datastax.driver.core.ResultSet;                                                                        </span>
<span class="-2921924295373051715" onmouseenter="enter('-2921924295373051715');" onmouseout="out('-2921924295373051715');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import com.datastax.driver.core.Session;                                                                          </span>
<span class="7536185860942072783" onmouseenter="enter('7536185860942072783');" onmouseout="out('7536185860942072783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import com.datastax.driver.core.SocketOptions;                                                                    </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import com.datastax.driver.core.*;                                                                                </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  38  import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                                       </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  39  import com.datastax.driver.core.policies.RetryPolicy;                                                             </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">  40  import com.dtstack.flink.sql.enums.ECacheContentType;                                                             </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                                </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import com.dtstack.flink.sql.side.CacheMissVal;                                                                   </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-4677472867777569519" onmouseenter="enter('-4677472867777569519');" onmouseout="out('-4677472867777569519');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import com.dtstack.flink.sql.side.*;                                                                              </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  47  import com.dtstack.flink.sql.side.cache.CacheObj;                                                                 </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  48  import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                         </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +import com.dtstack.flink.sql.util.RowDataComplete;                                                                </span>
<span class="-8710273414755433249" onmouseenter="enter('-8710273414755433249');" onmouseout="out('-8710273414755433249');" style="">  50  import com.google.common.base.Function;                                                                           </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  51  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4265236954961374581" onmouseenter="enter('-4265236954961374581');" onmouseout="out('-4265236954961374581');" style="">  52  import com.google.common.util.concurrent.AsyncFunction;                                                           </span>
<span class="3392144801777607486" onmouseenter="enter('3392144801777607486');" onmouseout="out('3392144801777607486');" style="">  53  import com.google.common.util.concurrent.FutureCallback;                                                          </span>
<span class="-3207866063314364212" onmouseenter="enter('-3207866063314364212');" onmouseout="out('-3207866063314364212');" style="">  54  import com.google.common.util.concurrent.Futures;                                                                 </span>
<span class="2803111898123627106" onmouseenter="enter('2803111898123627106');" onmouseout="out('2803111898123627106');" style="">  55  import com.google.common.util.concurrent.ListenableFuture;                                                        </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -import io.vertx.core.json.JsonArray;                                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  57  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import org.apache.flink.streaming.api.functions.async.ResultFuture;                                               </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import org.apache.flink.table.dataformat.BaseRow;                                                                 </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +import org.apache.flink.types.Row;                                                                                </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  63  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  64  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  65                                                                                                                    </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  66  import java.net.InetAddress;                                                                                      </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -import java.sql.Timestamp;                                                                                        </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  68  import java.util.ArrayList;                                                                                       </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +import java.util.Collections;                                                                                     </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  71  import java.util.Map;                                                                                             </span>

<span  style="">  72                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  73  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  74   * Reason:                                                                                                        </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  75   * Date: 2018/11/22                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  76   *                                                                                                                </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  77   * @author xuqianjin                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  78   */                                                                                                               </span>
<span class="-137893776588311003" onmouseenter="enter('-137893776588311003');" onmouseout="out('-137893776588311003');" style="">  79  public class CassandraAsyncReqRow extends BaseAsyncReqRow {                                                       </span>
<span  style="">  80                                                                                                                    </span>
<span class="-474972292974325668" onmouseenter="enter('-474972292974325668');" onmouseout="out('-474972292974325668');" style="">  81      private static final long serialVersionUID = 6631584128079864735L;                                            </span>
<span  style="">  82                                                                                                                    </span>
<span class="-8305758559523834163" onmouseenter="enter('-8305758559523834163');" onmouseout="out('-8305758559523834163');" style="">  83      private static final Logger LOG = LoggerFactory.getLogger(CassandraAsyncReqRow.class);                        </span>


<span  style="">  84                                                                                                                    </span>
<span class="-4149057034501610834" onmouseenter="enter('-4149057034501610834');" onmouseout="out('-4149057034501610834');" style="">  85      private final static int DEFAULT_VERTX_EVENT_LOOP_POOL_SIZE = 10;                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="-4781889690315923879" onmouseenter="enter('-4781889690315923879');" onmouseout="out('-4781889690315923879');" style="">  87      private final static int DEFAULT_VERTX_WORKER_POOL_SIZE = 20;                                                 </span>
<span  style="">  88                                                                                                                    </span>
<span class="8731062638120855225" onmouseenter="enter('8731062638120855225');" onmouseout="out('8731062638120855225');" style="">  89      private final static int DEFAULT_MAX_DB_CONN_POOL_SIZE = 20;                                                  </span>
<span  style="">  90                                                                                                                    </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  91      private transient Cluster cluster;                                                                            </span>
<span class="-8047386482861852310" onmouseenter="enter('-8047386482861852310');" onmouseout="out('-8047386482861852310');" style="">  92      private transient ListenableFuture session;                                                                   </span>
<span class="-1659440015873934350" onmouseenter="enter('-1659440015873934350');" onmouseout="out('-1659440015873934350');" style="">  93      private transient CassandraSideTableInfo cassandraSideTableInfo;                                              </span>
<span  style="">  94                                                                                                                    </span>
<span class="8250235661803572167" onmouseenter="enter('8250235661803572167');" onmouseout="out('8250235661803572167');" style=""><abbr title="  95      public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  95      public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Abst🔵</abbr></span>
<span class="2131899768365277438" onmouseenter="enter('2131899768365277438');" onmouseout="out('2131899768365277438');" style=""><abbr title="  96          super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  96          super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoL🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span  style="">  99                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 100      @Override                                                                                                     </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style=""> 101      public void open(Configuration parameters) throws Exception {                                                 </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style=""> 102          super.open(parameters);                                                                                   </span>
<span class="-5020317085273715278" onmouseenter="enter('-5020317085273715278');" onmouseout="out('-5020317085273715278');" style=""> 103          cassandraSideTableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                            </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 104          connCassandraDB(cassandraSideTableInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105      }                                                                                                             </span>
<span  style=""> 106                                                                                                                    </span>
<span class="2688225595233570188" onmouseenter="enter('2688225595233570188');" onmouseout="out('2688225595233570188');" style=""> 107      private void connCassandraDB(CassandraSideTableInfo tableInfo) {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 108          try {                                                                                                     </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 109              if (session == null) {                                                                                </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 110                  QueryOptions queryOptions = new QueryOptions();                                                   </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 111                  //The default consistency level for queries: ConsistencyLevel.TWO.                                </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 112                  queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                                        </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 113                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 113                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 114                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 114                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.get🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 115                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 115                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.g🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""> 116                  Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();</span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 117                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 117                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTi🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 118                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 118                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.get🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 119                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 119                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTi🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 120                  Integer cassandraPort = 0;                                                                        </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 121                  String address = tableInfo.getAddress();                                                          </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 122                  String userName = tableInfo.getUserName();                                                        </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 123                  String password = tableInfo.getPassword();                                                        </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 124                  String database = tableInfo.getDatabase();                                                        </span>
<span  style=""> 125                                                                                                                    </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 126                  ArrayList serversList = new ArrayList();                                                          </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 127                  //Read timeout or connection timeout Settings                                                     </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 128                  SocketOptions so = new SocketOptions()                                                            </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 129                          .setReadTimeoutMillis(readTimeoutMillis)                                                  </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 130                          .setConnectTimeoutMillis(connectTimeoutMillis);                                           </span>
<span  style=""> 131                                                                                                                    </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 132                  //The cluster USES hostdistance.local in the same machine room                                    </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 133                  //Hostdistance. REMOTE is used for different machine rooms                                        </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 134                  //Ignore use HostDistance. IGNORED                                                                </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 135                  PoolingOptions poolingOptions = new PoolingOptions()                                              </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 136                          //Each connection allows a maximum of 64 concurrent requests                              </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 137                          .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)                </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 138                          //Have at least two connections to each machine in the cluster                            </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 139                          .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)                    </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 140                          //There are up to eight connections to each machine in the cluster                        </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 141                          .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)                      </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 142                          .setMaxQueueSize(maxQueueSize)                                                            </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 143                          .setPoolTimeoutMillis(poolTimeoutMillis);                                                 </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 144                  //重试策略                                                                                            </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 145                  RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                             </span>
<span  style=""> 146                                                                                                                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 147                  for (String server : StringUtils.split(address, &quot;,&quot;)) {                                           </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 148                      cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                          </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 149                      serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                  }                                                                                                 </span>
<span  style=""> 151                                                                                                                    </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 152                  if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {           </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 153                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 154                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 155                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 156                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 157                  } else {                                                                                          </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 158                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 159                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 160                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 161                              .withCredentials(userName, password)                                                  </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 162                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                  }                                                                                                 </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 164                  // 建立连接 连接已存在的键空间                                                                                 </span>
<span class="-6325263381803948308" onmouseenter="enter('-6325263381803948308');" onmouseout="out('-6325263381803948308');" style=""> 165                  session = cluster.connectAsync(database);                                                         </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 166                  LOG.info(&quot;connect cassandra is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 168          } catch (Exception e) {                                                                                   </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 169              LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span  style=""> 172                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 173      @Override                                                                                                     </span>
<span class="-3645419592203298662" onmouseenter="enter('-3645419592203298662');" onmouseout="out('-3645419592203298662');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 174 -    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) throws Exception {"> 174 -    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) th🔵</abbr></span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 175 +    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 175 +    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) 🔵</abbr></span>
<span  style=""> 176                                                                                                                    </span>
<span class="-1687696912388971385" onmouseenter="enter('-1687696912388971385');" onmouseout="out('-1687696912388971385');" style=""> 177          String key = buildCacheKey(inputParams);                                                                  </span>
<span class="-3943135781211957390" onmouseenter="enter('-3943135781211957390');" onmouseout="out('-3943135781211957390');" style=""> 178          //connect Cassandra                                                                                       </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 179          connCassandraDB(cassandraSideTableInfo);                                                                  </span>
<span  style=""> 180                                                                                                                    </span>
<span class="8882875172916837309" onmouseenter="enter('8882875172916837309');" onmouseout="out('8882875172916837309');" style=""><abbr title=" 181          String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTERING &quot;;"> 181          String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTE🔵</abbr></span>
<span class="7235570087826307362" onmouseenter="enter('7235570087826307362');" onmouseout="out('7235570087826307362');" style=""> 182          LOG.info(&quot;sqlCondition:{}&quot; + sqlCondition);                                                               </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-4677553123577559654" onmouseenter="enter('-4677553123577559654');" onmouseout="out('-4677553123577559654');" style=""> 184          ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session,                                   </span>
<span class="-8970210976886405807" onmouseenter="enter('-8970210976886405807');" onmouseout="out('-8970210976886405807');" style=""> 185                  new AsyncFunction&lt;Session, ResultSet&gt;() {                                                         </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 186                      @Override                                                                                     </span>
<span class="7229846643571334073" onmouseenter="enter('7229846643571334073');" onmouseout="out('7229846643571334073');" style=""> 187                      public ListenableFuture&lt;ResultSet&gt; apply(Session session) throws Exception {                  </span>
<span class="2429380307619353" onmouseenter="enter('2429380307619353');" onmouseout="out('2429380307619353');" style=""> 188                          return session.executeAsync(sqlCondition);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 190                  });                                                                                               </span>
<span  style=""> 191                                                                                                                    </span>
<span class="-2519838970460094251" onmouseenter="enter('-2519838970460094251');" onmouseout="out('-2519838970460094251');" style=""> 192          ListenableFuture&lt;List&lt;com.datastax.driver.core.Row&gt;&gt; data = Futures.transform(resultSet,                  </span>
<span class="3568556365730474127" onmouseenter="enter('3568556365730474127');" onmouseout="out('3568556365730474127');" style=""> 193                  new Function&lt;ResultSet, List&lt;com.datastax.driver.core.Row&gt;&gt;() {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 194                      @Override                                                                                     </span>
<span class="7863554394934287512" onmouseenter="enter('7863554394934287512');" onmouseout="out('7863554394934287512');" style=""> 195                      public List&lt;com.datastax.driver.core.Row&gt; apply(ResultSet rs) {                               </span>
<span class="-6387242574642327798" onmouseenter="enter('-6387242574642327798');" onmouseout="out('-6387242574642327798');" style=""> 196                          return rs.all();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 198                  });                                                                                               </span>
<span  style=""> 199                                                                                                                    </span>
<span class="8124054865584677185" onmouseenter="enter('8124054865584677185');" onmouseout="out('8124054865584677185');" style=""> 200          Futures.addCallback(data, new FutureCallback&lt;List&lt;com.datastax.driver.core.Row&gt;&gt;() {                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 201              @Override                                                                                             </span>
<span class="-7968962151066113330" onmouseenter="enter('-7968962151066113330');" onmouseout="out('-7968962151066113330');" style=""> 202              public void onSuccess(List&lt;com.datastax.driver.core.Row&gt; rows) {                                      </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 203                  cluster.closeAsync();                                                                             </span>
<span class="347035494226818967" onmouseenter="enter('347035494226818967');" onmouseout="out('347035494226818967');" style=""> 204                  if (rows.size() &gt; 0) {                                                                            </span>
<span class="7732099395665198389" onmouseenter="enter('7732099395665198389');" onmouseout="out('7732099395665198389');" style=""> 205                      List&lt;com.datastax.driver.core.Row&gt; cacheContent = Lists.newArrayList();                       </span>
<span class="-3770803949601695435" onmouseenter="enter('-3770803949601695435');" onmouseout="out('-3770803949601695435');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -                    List&lt;CRow&gt; rowList = Lists.newArrayList();                                                    </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +                    List&lt;Row&gt; rowList = Lists.newArrayList();                                                     </span>
<span class="3453890066790785332" onmouseenter="enter('3453890066790785332');" onmouseout="out('3453890066790785332');" style=""> 208                      for (com.datastax.driver.core.Row line : rows) {                                              </span>
<span class="5316099920929274958" onmouseenter="enter('5316099920929274958');" onmouseout="out('5316099920929274958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -                        Row row = fillData(input.row(), line);                                                    </span>
<span class="-7049321919275001077" onmouseenter="enter('-7049321919275001077');" onmouseout="out('-7049321919275001077');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +                        Row row = fillData(input, line);                                                          </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 211                          if (openCache()) {                                                                        </span>
<span class="7674485238819480651" onmouseenter="enter('7674485238819480651');" onmouseout="out('7674485238819480651');" style=""> 212                              cacheContent.add(line);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213                          }                                                                                         </span>
<span class="5232888746699619450" onmouseenter="enter('5232888746699619450');" onmouseout="out('5232888746699619450');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -                        rowList.add(new CRow(row, input.change()));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -                    }                                                                                             </span>
<span class="510192174520611392" onmouseenter="enter('510192174520611392');" onmouseout="out('510192174520611392');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -                    resultFuture.complete(rowList);                                                               </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                        rowList.add(row);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                    }                                                                                             </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                    RowDataComplete.completeRow(resultFuture, rowList);                                           </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 220                      if (openCache()) {                                                                            </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 221                          putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 223                  } else {                                                                                          </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 224                      dealMissKey(input, resultFuture);                                                             </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 225                      if (openCache()) {                                                                            </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 226                          putCache(key, CacheMissVal.getMissKeyObj());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227                      }                                                                                             </span>
<span class="8035528279988960609" onmouseenter="enter('8035528279988960609');" onmouseout="out('8035528279988960609');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -                    resultFuture.complete(null);                                                                  </span>
<span class="-4250051014526489812" onmouseenter="enter('-4250051014526489812');" onmouseout="out('-4250051014526489812');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                    resultFuture.complete(Collections.EMPTY_LIST);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231              }                                                                                                     </span>
<span  style=""> 232                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 233              @Override                                                                                             </span>
<span class="-728167789593706694" onmouseenter="enter('-728167789593706694');" onmouseout="out('-728167789593706694');" style=""> 234              public void onFailure(Throwable t) {                                                                  </span>
<span class="5577700706288044893" onmouseenter="enter('5577700706288044893');" onmouseout="out('5577700706288044893');" style=""> 235                  LOG.error(&quot;Failed to retrieve the data: %s%n&quot;,                                                    </span>
<span class="2555455608745013339" onmouseenter="enter('2555455608745013339');" onmouseout="out('2555455608745013339');" style=""> 236                          t.getMessage());                                                                          </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 237                  cluster.closeAsync();                                                                             </span>
<span class="1780061706453512804" onmouseenter="enter('1780061706453512804');" onmouseout="out('1780061706453512804');" style=""> 238                  resultFuture.completeExceptionally(t);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 240          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241      }                                                                                                             </span>
<span  style=""> 242                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 243      @Override                                                                                                     </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 244      public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                                </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 245          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 246          for (Object ele : inputParams.values()) {                                                                 </span>
<span class="-2299905763852680760" onmouseenter="enter('-2299905763852680760');" onmouseout="out('-2299905763852680760');" style=""> 247              sb.append(ele.toString()).append(&quot;_&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 249          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250      }                                                                                                             </span>
<span  style=""> 251                                                                                                                    </span>
<span class="-1821575284166957660" onmouseenter="enter('-1821575284166957660');" onmouseout="out('-1821575284166957660');" style=""> 252      private String buildWhereCondition(Map&lt;String, Object&gt; inputParams){                                          </span>
<span class="5090364847803370614" onmouseenter="enter('5090364847803370614');" onmouseout="out('5090364847803370614');" style=""> 253          StringBuilder sb = new StringBuilder(&quot; where &quot;);                                                          </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style=""> 254          for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                            </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style=""> 255              Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();  </span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style=""> 256              sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 258          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259      }                                                                                                             </span>
<span  style=""> 260                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261      @Override                                                                                                     </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style=""> 262      public Row fillData(Row input, Object line) {                                                                 </span>
<span class="-1556735922244622351" onmouseenter="enter('-1556735922244622351');" onmouseout="out('-1556735922244622351');" style=""> 263          com.datastax.driver.core.Row rowArray = (com.datastax.driver.core.Row) line;                              </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 264          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 265          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 266              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 267 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 267 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -                                                                                                                  </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -                obj = ((Timestamp) obj).getTime();                                                                </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -                                                                                                                  </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +            obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                             </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 274              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275          }                                                                                                         </span>
<span  style=""> 276                                                                                                                    </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style=""> 277          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {                       </span>
<span class="-844467095686898872" onmouseenter="enter('-844467095686898872');" onmouseout="out('-844467095686898872');" style=""> 278              if (rowArray == null) {                                                                               </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 279                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 280              } else {                                                                                              </span>
<span class="-7910331794290062112" onmouseenter="enter('-7910331794290062112');" onmouseout="out('-7910331794290062112');" style=""> 281                  row.setField(entry.getKey(), rowArray.getObject(entry.getValue()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283          }                                                                                                         </span>
<span  style=""> 284                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 285          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286      }                                                                                                             </span>
<span  style=""> 287                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 288      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 289      public void close() throws Exception {                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 290          super.close();                                                                                            </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 291          if (cluster != null) {                                                                                    </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 292              cluster.close();                                                                                      </span>
<span class="-8433337576020477133" onmouseenter="enter('-8433337576020477133');" onmouseout="out('-8433337576020477133');" style=""> 293              cluster = null;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  20  package com.dtstack.flink.sql.side.cassandra;                                                                     </span>
<span  style="">  21                                                                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  22  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  23  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  24  import org.apache.flink.streaming.api.functions.async.ResultFuture;                                               </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  25  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  26  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  27  import org.apache.flink.types.Row;                                                                                </span>
<span  style="">  28                                                                                                                    </span>
<span class="-4674624431842718354" onmouseenter="enter('-4674624431842718354');" onmouseout="out('-4674624431842718354');" style="">  29  import com.datastax.driver.core.Cluster;                                                                          </span>
<span class="4630389600773953361" onmouseenter="enter('4630389600773953361');" onmouseout="out('4630389600773953361');" style="">  30  import com.datastax.driver.core.ConsistencyLevel;                                                                 </span>
<span class="-5077913371267042181" onmouseenter="enter('-5077913371267042181');" onmouseout="out('-5077913371267042181');" style="">  31  import com.datastax.driver.core.HostDistance;                                                                     </span>
<span class="-8460078615292194921" onmouseenter="enter('-8460078615292194921');" onmouseout="out('-8460078615292194921');" style="">  32  import com.datastax.driver.core.PoolingOptions;                                                                   </span>
<span class="3500480560938999402" onmouseenter="enter('3500480560938999402');" onmouseout="out('3500480560938999402');" style="">  33  import com.datastax.driver.core.QueryOptions;                                                                     </span>
<span class="1295458347604392536" onmouseenter="enter('1295458347604392536');" onmouseout="out('1295458347604392536');" style="">  34  import com.datastax.driver.core.ResultSet;                                                                        </span>
<span class="-2921924295373051715" onmouseenter="enter('-2921924295373051715');" onmouseout="out('-2921924295373051715');" style="">  35  import com.datastax.driver.core.Session;                                                                          </span>
<span class="7536185860942072783" onmouseenter="enter('7536185860942072783');" onmouseout="out('7536185860942072783');" style="">  36  import com.datastax.driver.core.SocketOptions;                                                                    </span>

<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  37  import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                                       </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  38  import com.datastax.driver.core.policies.RetryPolicy;                                                             </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">  39  import com.dtstack.flink.sql.enums.ECacheContentType;                                                             </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">  40  import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                                </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">  41  import com.dtstack.flink.sql.side.CacheMissVal;                                                                   </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  42  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  43  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  44  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>

<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  45  import com.dtstack.flink.sql.side.cache.CacheObj;                                                                 </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  46  import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                         </span>

<span class="-8710273414755433249" onmouseenter="enter('-8710273414755433249');" onmouseout="out('-8710273414755433249');" style="">  47  import com.google.common.base.Function;                                                                           </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  48  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4265236954961374581" onmouseenter="enter('-4265236954961374581');" onmouseout="out('-4265236954961374581');" style="">  49  import com.google.common.util.concurrent.AsyncFunction;                                                           </span>
<span class="3392144801777607486" onmouseenter="enter('3392144801777607486');" onmouseout="out('3392144801777607486');" style="">  50  import com.google.common.util.concurrent.FutureCallback;                                                          </span>
<span class="-3207866063314364212" onmouseenter="enter('-3207866063314364212');" onmouseout="out('-3207866063314364212');" style="">  51  import com.google.common.util.concurrent.Futures;                                                                 </span>
<span class="2803111898123627106" onmouseenter="enter('2803111898123627106');" onmouseout="out('2803111898123627106');" style="">  52  import com.google.common.util.concurrent.ListenableFuture;                                                        </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  53  import io.vertx.core.json.JsonArray;                                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  54  import org.apache.commons.lang3.StringUtils;                                                                      </span>





<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  55  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  56  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  57                                                                                                                    </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  58  import java.net.InetAddress;                                                                                      </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  59  import java.sql.Timestamp;                                                                                        </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  60  import java.util.ArrayList;                                                                                       </span>

<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  61  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  62  import java.util.Map;                                                                                             </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import java.util.TimeZone;                                                                                        </span>
<span  style="">  64                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  66   * Reason:                                                                                                        </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  67   * Date: 2018/11/22                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68   *                                                                                                                </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  69   * @author xuqianjin                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  70   */                                                                                                               </span>
<span class="-137893776588311003" onmouseenter="enter('-137893776588311003');" onmouseout="out('-137893776588311003');" style="">  71  public class CassandraAsyncReqRow extends BaseAsyncReqRow {                                                       </span>
<span  style="">  72                                                                                                                    </span>
<span class="-474972292974325668" onmouseenter="enter('-474972292974325668');" onmouseout="out('-474972292974325668');" style="">  73      private static final long serialVersionUID = 6631584128079864735L;                                            </span>
<span  style="">  74                                                                                                                    </span>
<span class="-8305758559523834163" onmouseenter="enter('-8305758559523834163');" onmouseout="out('-8305758559523834163');" style="">  75      private static final Logger LOG = LoggerFactory.getLogger(CassandraAsyncReqRow.class);                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +                                                                                                                  </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                               </span>
<span  style="">  78                                                                                                                    </span>
<span class="-4149057034501610834" onmouseenter="enter('-4149057034501610834');" onmouseout="out('-4149057034501610834');" style="">  79      private final static int DEFAULT_VERTX_EVENT_LOOP_POOL_SIZE = 10;                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="-4781889690315923879" onmouseenter="enter('-4781889690315923879');" onmouseout="out('-4781889690315923879');" style="">  81      private final static int DEFAULT_VERTX_WORKER_POOL_SIZE = 20;                                                 </span>
<span  style="">  82                                                                                                                    </span>
<span class="8731062638120855225" onmouseenter="enter('8731062638120855225');" onmouseout="out('8731062638120855225');" style="">  83      private final static int DEFAULT_MAX_DB_CONN_POOL_SIZE = 20;                                                  </span>
<span  style="">  84                                                                                                                    </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  85      private transient Cluster cluster;                                                                            </span>
<span class="-8047386482861852310" onmouseenter="enter('-8047386482861852310');" onmouseout="out('-8047386482861852310');" style="">  86      private transient ListenableFuture session;                                                                   </span>
<span class="-1659440015873934350" onmouseenter="enter('-1659440015873934350');" onmouseout="out('-1659440015873934350');" style="">  87      private transient CassandraSideTableInfo cassandraSideTableInfo;                                              </span>
<span  style="">  88                                                                                                                    </span>
<span class="8250235661803572167" onmouseenter="enter('8250235661803572167');" onmouseout="out('8250235661803572167');" style=""><abbr title="  89      public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  89      public CassandraAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Abst🔵</abbr></span>
<span class="2131899768365277438" onmouseenter="enter('2131899768365277438');" onmouseout="out('2131899768365277438');" style=""><abbr title="  90          super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  90          super(new com.dtstack.flink.sql.side.cassandra.CassandraAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoL🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91      }                                                                                                             </span>
<span  style="">  92                                                                                                                    </span>
<span  style="">  93                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94      @Override                                                                                                     </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  95      public void open(Configuration parameters) throws Exception {                                                 </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  96          super.open(parameters);                                                                                   </span>
<span class="-5020317085273715278" onmouseenter="enter('-5020317085273715278');" onmouseout="out('-5020317085273715278');" style="">  97          cassandraSideTableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                            </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style="">  98          connCassandraDB(cassandraSideTableInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="2688225595233570188" onmouseenter="enter('2688225595233570188');" onmouseout="out('2688225595233570188');" style=""> 101      private void connCassandraDB(CassandraSideTableInfo tableInfo) {                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 102          try {                                                                                                     </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 103              if (session == null) {                                                                                </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 104                  QueryOptions queryOptions = new QueryOptions();                                                   </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 105                  //The default consistency level for queries: ConsistencyLevel.TWO.                                </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 106                  queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                                        </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 107                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 107                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 108                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 108                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.get🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 109                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 109                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.g🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""> 110                  Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();</span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 111                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 111                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTi🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 112                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 112                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.get🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 113                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 113                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTi🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 114                  Integer cassandraPort = 0;                                                                        </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 115                  String address = tableInfo.getAddress();                                                          </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 116                  String userName = tableInfo.getUserName();                                                        </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 117                  String password = tableInfo.getPassword();                                                        </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 118                  String database = tableInfo.getDatabase();                                                        </span>
<span  style=""> 119                                                                                                                    </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 120                  ArrayList serversList = new ArrayList();                                                          </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 121                  //Read timeout or connection timeout Settings                                                     </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 122                  SocketOptions so = new SocketOptions()                                                            </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 123                          .setReadTimeoutMillis(readTimeoutMillis)                                                  </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 124                          .setConnectTimeoutMillis(connectTimeoutMillis);                                           </span>
<span  style=""> 125                                                                                                                    </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 126                  //The cluster USES hostdistance.local in the same machine room                                    </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 127                  //Hostdistance. REMOTE is used for different machine rooms                                        </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 128                  //Ignore use HostDistance. IGNORED                                                                </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 129                  PoolingOptions poolingOptions = new PoolingOptions()                                              </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 130                          //Each connection allows a maximum of 64 concurrent requests                              </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 131                          .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)                </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 132                          //Have at least two connections to each machine in the cluster                            </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 133                          .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)                    </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 134                          //There are up to eight connections to each machine in the cluster                        </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 135                          .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)                      </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 136                          .setMaxQueueSize(maxQueueSize)                                                            </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 137                          .setPoolTimeoutMillis(poolTimeoutMillis);                                                 </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 138                  //重试策略                                                                                            </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 139                  RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                             </span>
<span  style=""> 140                                                                                                                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 141                  for (String server : StringUtils.split(address, &quot;,&quot;)) {                                           </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 142                      cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                          </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 143                      serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                  }                                                                                                 </span>
<span  style=""> 145                                                                                                                    </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 146                  if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {           </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 147                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 148                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 149                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 150                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 151                  } else {                                                                                          </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 152                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 153                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 154                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 155                              .withCredentials(userName, password)                                                  </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 156                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                  }                                                                                                 </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 158                  // 建立连接 连接已存在的键空间                                                                                 </span>
<span class="-6325263381803948308" onmouseenter="enter('-6325263381803948308');" onmouseout="out('-6325263381803948308');" style=""> 159                  session = cluster.connectAsync(database);                                                         </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 160                  LOG.info(&quot;connect cassandra is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 162          } catch (Exception e) {                                                                                   </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 163              LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165      }                                                                                                             </span>
<span  style=""> 166                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 167      @Override                                                                                                     </span>
<span class="-3645419592203298662" onmouseenter="enter('-3645419592203298662');" onmouseout="out('-3645419592203298662');" style=""><abbr title=" 168      public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) throws Exception {"> 168      public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) th🔵</abbr></span>

<span  style=""> 169                                                                                                                    </span>
<span class="-1687696912388971385" onmouseenter="enter('-1687696912388971385');" onmouseout="out('-1687696912388971385');" style=""> 170          String key = buildCacheKey(inputParams);                                                                  </span>
<span class="-3943135781211957390" onmouseenter="enter('-3943135781211957390');" onmouseout="out('-3943135781211957390');" style=""> 171          //connect Cassandra                                                                                       </span>
<span class="-7529848090326611941" onmouseenter="enter('-7529848090326611941');" onmouseout="out('-7529848090326611941');" style=""> 172          connCassandraDB(cassandraSideTableInfo);                                                                  </span>
<span  style=""> 173                                                                                                                    </span>
<span class="8882875172916837309" onmouseenter="enter('8882875172916837309');" onmouseout="out('8882875172916837309');" style=""><abbr title=" 174          String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTERING &quot;;"> 174          String sqlCondition = sideInfo.getSqlCondition() + &quot; &quot; + buildWhereCondition(inputParams) + &quot;  ALLOW FILTE🔵</abbr></span>
<span class="7235570087826307362" onmouseenter="enter('7235570087826307362');" onmouseout="out('7235570087826307362');" style=""> 175          LOG.info(&quot;sqlCondition:{}&quot; + sqlCondition);                                                               </span>
<span  style=""> 176                                                                                                                    </span>
<span class="-4677553123577559654" onmouseenter="enter('-4677553123577559654');" onmouseout="out('-4677553123577559654');" style=""> 177          ListenableFuture&lt;ResultSet&gt; resultSet = Futures.transformAsync(session,                                   </span>
<span class="-8970210976886405807" onmouseenter="enter('-8970210976886405807');" onmouseout="out('-8970210976886405807');" style=""> 178                  new AsyncFunction&lt;Session, ResultSet&gt;() {                                                         </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 179                      @Override                                                                                     </span>
<span class="7229846643571334073" onmouseenter="enter('7229846643571334073');" onmouseout="out('7229846643571334073');" style=""> 180                      public ListenableFuture&lt;ResultSet&gt; apply(Session session) throws Exception {                  </span>
<span class="2429380307619353" onmouseenter="enter('2429380307619353');" onmouseout="out('2429380307619353');" style=""> 181                          return session.executeAsync(sqlCondition);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 183                  });                                                                                               </span>
<span  style=""> 184                                                                                                                    </span>
<span class="-2519838970460094251" onmouseenter="enter('-2519838970460094251');" onmouseout="out('-2519838970460094251');" style=""> 185          ListenableFuture&lt;List&lt;com.datastax.driver.core.Row&gt;&gt; data = Futures.transform(resultSet,                  </span>
<span class="3568556365730474127" onmouseenter="enter('3568556365730474127');" onmouseout="out('3568556365730474127');" style=""> 186                  new Function&lt;ResultSet, List&lt;com.datastax.driver.core.Row&gt;&gt;() {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 187                      @Override                                                                                     </span>
<span class="7863554394934287512" onmouseenter="enter('7863554394934287512');" onmouseout="out('7863554394934287512');" style=""> 188                      public List&lt;com.datastax.driver.core.Row&gt; apply(ResultSet rs) {                               </span>
<span class="-6387242574642327798" onmouseenter="enter('-6387242574642327798');" onmouseout="out('-6387242574642327798');" style=""> 189                          return rs.all();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                      }                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 191                  });                                                                                               </span>
<span  style=""> 192                                                                                                                    </span>
<span class="8124054865584677185" onmouseenter="enter('8124054865584677185');" onmouseout="out('8124054865584677185');" style=""> 193          Futures.addCallback(data, new FutureCallback&lt;List&lt;com.datastax.driver.core.Row&gt;&gt;() {                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 194              @Override                                                                                             </span>
<span class="-7968962151066113330" onmouseenter="enter('-7968962151066113330');" onmouseout="out('-7968962151066113330');" style=""> 195              public void onSuccess(List&lt;com.datastax.driver.core.Row&gt; rows) {                                      </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 196                  cluster.closeAsync();                                                                             </span>
<span class="347035494226818967" onmouseenter="enter('347035494226818967');" onmouseout="out('347035494226818967');" style=""> 197                  if (rows.size() &gt; 0) {                                                                            </span>
<span class="7732099395665198389" onmouseenter="enter('7732099395665198389');" onmouseout="out('7732099395665198389');" style=""> 198                      List&lt;com.datastax.driver.core.Row&gt; cacheContent = Lists.newArrayList();                       </span>
<span class="-3770803949601695435" onmouseenter="enter('-3770803949601695435');" onmouseout="out('-3770803949601695435');" style=""> 199                      List&lt;CRow&gt; rowList = Lists.newArrayList();                                                    </span>

<span class="3453890066790785332" onmouseenter="enter('3453890066790785332');" onmouseout="out('3453890066790785332');" style=""> 200                      for (com.datastax.driver.core.Row line : rows) {                                              </span>
<span class="5316099920929274958" onmouseenter="enter('5316099920929274958');" onmouseout="out('5316099920929274958');" style=""> 201                          Row row = fillData(input.row(), line);                                                    </span>

<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 202                          if (openCache()) {                                                                        </span>
<span class="7674485238819480651" onmouseenter="enter('7674485238819480651');" onmouseout="out('7674485238819480651');" style=""> 203                              cacheContent.add(line);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                          }                                                                                         </span>
<span class="5232888746699619450" onmouseenter="enter('5232888746699619450');" onmouseout="out('5232888746699619450');" style=""> 205                          rowList.add(new CRow(row, input.change()));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206                      }                                                                                             </span>
<span class="510192174520611392" onmouseenter="enter('510192174520611392');" onmouseout="out('510192174520611392');" style=""> 207                      resultFuture.complete(rowList);                                                               </span>



<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 208                      if (openCache()) {                                                                            </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 209                          putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211                  } else {                                                                                          </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 212                      dealMissKey(input, resultFuture);                                                             </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 213                      if (openCache()) {                                                                            </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 214                          putCache(key, CacheMissVal.getMissKeyObj());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215                      }                                                                                             </span>
<span class="8035528279988960609" onmouseenter="enter('8035528279988960609');" onmouseout="out('8035528279988960609');" style=""> 216                      resultFuture.complete(null);                                                                  </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218              }                                                                                                     </span>
<span  style=""> 219                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 220              @Override                                                                                             </span>
<span class="-728167789593706694" onmouseenter="enter('-728167789593706694');" onmouseout="out('-728167789593706694');" style=""> 221              public void onFailure(Throwable t) {                                                                  </span>
<span class="5577700706288044893" onmouseenter="enter('5577700706288044893');" onmouseout="out('5577700706288044893');" style=""> 222                  LOG.error(&quot;Failed to retrieve the data: %s%n&quot;,                                                    </span>
<span class="2555455608745013339" onmouseenter="enter('2555455608745013339');" onmouseout="out('2555455608745013339');" style=""> 223                          t.getMessage());                                                                          </span>
<span class="-2792394742141522863" onmouseenter="enter('-2792394742141522863');" onmouseout="out('-2792394742141522863');" style=""> 224                  cluster.closeAsync();                                                                             </span>
<span class="1780061706453512804" onmouseenter="enter('1780061706453512804');" onmouseout="out('1780061706453512804');" style=""> 225                  resultFuture.completeExceptionally(t);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 227          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228      }                                                                                                             </span>
<span  style=""> 229                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 230      @Override                                                                                                     </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 231      public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                                </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 232          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 233          for (Object ele : inputParams.values()) {                                                                 </span>
<span class="-2299905763852680760" onmouseenter="enter('-2299905763852680760');" onmouseout="out('-2299905763852680760');" style=""> 234              sb.append(ele.toString()).append(&quot;_&quot;);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 236          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237      }                                                                                                             </span>
<span  style=""> 238                                                                                                                    </span>
<span class="-1821575284166957660" onmouseenter="enter('-1821575284166957660');" onmouseout="out('-1821575284166957660');" style=""> 239      private String buildWhereCondition(Map&lt;String, Object&gt; inputParams){                                          </span>
<span class="5090364847803370614" onmouseenter="enter('5090364847803370614');" onmouseout="out('5090364847803370614');" style=""> 240          StringBuilder sb = new StringBuilder(&quot; where &quot;);                                                          </span>
<span class="-7053571210782116126" onmouseenter="enter('-7053571210782116126');" onmouseout="out('-7053571210782116126');" style=""> 241          for(Map.Entry&lt;String, Object&gt; entry : inputParams.entrySet()){                                            </span>
<span class="-3077711825568802702" onmouseenter="enter('-3077711825568802702');" onmouseout="out('-3077711825568802702');" style=""> 242              Object value = entry.getValue() instanceof String ? &quot;&#x27;&quot; + entry.getValue() + &quot;&#x27;&quot; : entry.getValue();  </span>
<span class="-2126749103831887182" onmouseenter="enter('-2126749103831887182');" onmouseout="out('-2126749103831887182');" style=""> 243              sb.append(String.format(&quot;%s = %s&quot;, entry.getKey(), value));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 245          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246      }                                                                                                             </span>
<span  style=""> 247                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 248      @Override                                                                                                     </span>
<span class="6361661721548771002" onmouseenter="enter('6361661721548771002');" onmouseout="out('6361661721548771002');" style=""> 249      public Row fillData(Row input, Object line) {                                                                 </span>
<span class="-1556735922244622351" onmouseenter="enter('-1556735922244622351');" onmouseout="out('-1556735922244622351');" style=""> 250          com.datastax.driver.core.Row rowArray = (com.datastax.driver.core.Row) line;                              </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 251          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 252          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 253              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style=""><abbr title=" 254              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 254              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style=""> 255                                                                                                                    </span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style=""> 256              if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -                obj = ((Timestamp) obj).getTime();                                                                </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +                //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260              }                                                                                                     </span>
<span  style=""> 261                                                                                                                    </span>

<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 262              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263          }                                                                                                         </span>
<span  style=""> 264                                                                                                                    </span>
<span class="7381526363521034737" onmouseenter="enter('7381526363521034737');" onmouseout="out('7381526363521034737');" style=""> 265          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getSideFieldIndex().entrySet()) {                       </span>
<span class="-844467095686898872" onmouseenter="enter('-844467095686898872');" onmouseout="out('-844467095686898872');" style=""> 266              if (rowArray == null) {                                                                               </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 267                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 268              } else {                                                                                              </span>
<span class="-7910331794290062112" onmouseenter="enter('-7910331794290062112');" onmouseout="out('-7910331794290062112');" style=""> 269                  row.setField(entry.getKey(), rowArray.getObject(entry.getValue()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271          }                                                                                                         </span>
<span  style=""> 272                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 273          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274      }                                                                                                             </span>
<span  style=""> 275                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 276      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 277      public void close() throws Exception {                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 278          super.close();                                                                                            </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 279          if (cluster != null) {                                                                                    </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 280              cluster.close();                                                                                      </span>
<span class="-8433337576020477133" onmouseenter="enter('-8433337576020477133');" onmouseout="out('-8433337576020477133');" style=""> 281              cluster = null;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            