<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>280 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;
                           &#x27;package com.automattic.simplenote;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import android.app.AlertDialog;\n&#x27;
                           &#x27;import android.app.ListActivity;\n&#x27;
                           &#x27;import android.content.Context;\n&#x27;
                           &#x27;import android.content.DialogInterface;\n&#x27;
                           &#x27;import android.database.Cursor;\n&#x27;
                           &#x27;import android.os.AsyncTask;\n&#x27;
                           &#x27;import android.os.Bundle;\n&#x27;
                           &#x27;import android.text.Html;\n&#x27;
                           &#x27;import android.text.Spannable;\n&#x27;
                           &#x27;import android.text.SpannableString;\n&#x27;
                           &#x27;import android.view.ActionMode;\n&#x27;
                           &#x27;import android.view.Menu;\n&#x27;
                           &#x27;import android.view.MenuInflater;\n&#x27;
                           &#x27;import android.view.MenuItem;\n&#x27;
                           &#x27;import android.view.View;\n&#x27;
                           &#x27;import android.view.ViewGroup;\n&#x27;
                           &#x27;import android.widget.AbsListView;\n&#x27;
                           &#x27;import android.widget.AdapterView;\n&#x27;
                           &#x27;import android.widget.CursorAdapter;\n&#x27;
                           &#x27;import android.widget.EditText;\n&#x27;
                           &#x27;import android.widget.ImageButton;\n&#x27;
                           &#x27;import android.widget.LinearLayout;\n&#x27;
                           &#x27;import android.widget.ListView;\n&#x27;
                           &#x27;import android.widget.TextView;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Note;\n&#x27;
                           &#x27;import com.automattic.simplenote.models.Tag;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.utils.ThemeUtils;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.automattic.simplenote.widgets.TypefaceSpan;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.google.android.gms.analytics.HitBuilders;\n&#x27;
                           &#x27;import com.google.android.gms.analytics.Tracker;\n&#x27;
                           &#x27;import com.simperium.client.Bucket;\n&#x27;
                           &#x27;import com.simperium.client.Bucket.ObjectCursor;\n&#x27;
                           &#x27;import &#x27;
                           &#x27;com.simperium.client.BucketObjectNameInvalid;\n&#x27;
                           &#x27;import com.simperium.client.Query;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;import java.util.List;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;/**\n&#x27;
                           &#x27; * Created by Dan Roundhill on 6/26/13. (In &#x27;
                           &#x27;Greece!)\n&#x27;
                           &#x27; */\n&#x27;
                           &#x27;public class TagsListActivity extends ListActivity &#x27;
                           &#x27;implements AdapterView.OnItemClickListener, &#x27;
                           &#x27;ActionMode.Callback, &#x27;
                           &#x27;AbsListView.MultiChoiceModeListener, &#x27;
                           &#x27;AdapterView.OnItemLongClickListener, &#x27;
                           &#x27;Bucket.Listener&lt;Tag&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private ActionMode mActionMode;\n&#x27;
                           &#x27;    private Bucket&lt;Tag&gt; mTagsBucket;\n&#x27;
                           &#x27;    private Bucket&lt;Note&gt; mNotesBucket;\n&#x27;
                           &#x27;    private TagsAdapter mTagsAdapter;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private Tracker mTracker;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onCreate(Bundle &#x27;
                           &#x27;savedInstanceState) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ThemeUtils.setTheme(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        super.onCreate(savedInstanceState);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;setContentView(R.layout.activity_tags_list);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        SpannableString s = new &#x27;
                           &#x27;SpannableString(getString(R.string.edit_tags));\n&#x27;
                           &#x27;        s.setSpan(new TypefaceSpan(this), 0, &#x27;
                           &#x27;s.length(),\n&#x27;
                           &#x27;                &#x27;
                           &#x27;Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n&#x27;
                           &#x27;        getActionBar().setTitle(s);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getActionBar().setDisplayHomeAsUpEnabled(true);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        TextView emptyTextView = &#x27;
                           &#x27;(TextView)findViewById(android.R.id.empty);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + &#x27;
                           &#x27;getString(R.string.no_tags_found) + &#x27;
                           &#x27;&quot;&lt;/strong&gt;&quot;));\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        ListView listView = getListView();\n&#x27;
                           &#x27;        &#x27;
                           &#x27;listView.setMultiChoiceModeListener(this);\n&#x27;
                           &#x27;        listView.setOnItemClickListener(this);\n&#x27;
                           &#x27;        // Disabling long press CAB action for now &#x27;
                           &#x27;since bulk deleting is incomplete\n&#x27;
                           &#x27;        // &#x27;
                           &#x27;listView.setOnItemLongClickListener(this);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        Simplenote application = (Simplenote) &#x27;
                           &#x27;getApplication();\n&#x27;
                           &#x27;        mTagsBucket = &#x27;
                           &#x27;application.getTagsBucket();\n&#x27;
                           &#x27;        mNotesBucket = &#x27;
                           &#x27;application.getNotesBucket();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTagsAdapter = new &#x27;
                           &#x27;TagsAdapter(getBaseContext(), null, 0);\n&#x27;
                           &#x27;        setListAdapter(mTagsAdapter);\n&#x27;
                           &#x27;        refreshTags();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mTracker = application.getTracker();\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onResume() {\n&#x27;
                           &#x27;        super.onResume();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        mNotesBucket.start();\n&#x27;
                           &#x27;        mTagsBucket.start();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.addOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    protected void onPause() {\n&#x27;
                           &#x27;        super.onPause();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnNetworkChangeListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnSaveObjectListener(this);\n&#x27;
                           &#x27;        &#x27;
                           &#x27;mTagsBucket.removeOnDeleteObjectListener(this);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    protected void refreshTags() {\n&#x27;
                           &#x27;        Query&lt;Tag&gt; tagQuery = &#x27;
                           &#x27;Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);\n&#x27;
                           &#x27;        ObjectCursor&lt;Tag&gt; cursor = &#x27;
                           &#x27;tagQuery.execute();\n&#x27;
                           &#x27;        mTagsAdapter.changeCursor(cursor);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onItemClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int row, long l) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final AlertDialog.Builder alert = new &#x27;
                           &#x27;AlertDialog.Builder(this);\n&#x27;
                           &#x27;        LinearLayout alertView = (LinearLayout) &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.edit_tag, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final Tag tag = &#x27;
                           &#x27;mTagsAdapter.getItem(row);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        final EditText tagNameEditText = &#x27;
                           &#x27;(EditText) &#x27;
                           &#x27;alertView.findViewById(R.id.tag_name_edit);\n&#x27;
                           &#x27;        tagNameEditText.setText(tag.getName());\n&#x27;
                           &#x27;        &#x27;
                           &#x27;tagNameEditText.setSelection(tagNameEditText.length());\n&#x27;
                           &#x27;        alert.setView(alertView);\n&#x27;
                           &#x27;        alert.setTitle(R.string.rename_tag);\n&#x27;
                           &#x27;        alert.setPositiveButton(R.string.save, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                String value = &#x27;
                           &#x27;tagNameEditText.getText().toString().trim();\n&#x27;
                           &#x27;                try {\n&#x27;
                           &#x27;                    tag.renameTo(value, &#x27;
                           &#x27;mNotesBucket);\n&#x27;
                           &#x27;                    mTracker.send(\n&#x27;
                           &#x27;                            new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setAction(&quot;edited_tag&quot;)\n&#x27;
                           &#x27;                                    &#x27;
                           &#x27;.setLabel(&quot;tag_alert_edit_box&quot;)\n&#x27;
                           &#x27;                                    .build()\n&#x27;
                           &#x27;                    );\n&#x27;
                           &#x27;                } catch (BucketObjectNameInvalid &#x27;
                           &#x27;e) {\n&#x27;
                           &#x27;                    &#x27;
                           &#x27;android.util.Log.e(Simplenote.TAG, &quot;Unable to &#x27;
                           &#x27;rename tag&quot;, e);\n&#x27;
                           &#x27;                    // TODO: show user a message &#x27;
                           &#x27;that new tag name is not ok\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.setNegativeButton(R.string.cancel, &#x27;
                           &#x27;new DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;            public void onClick(DialogInterface &#x27;
                           &#x27;dialog, int whichButton) {\n&#x27;
                           &#x27;                // Do nothing\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;        alert.show();\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // TODO: Finish bulk editing\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onCreateActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        MenuInflater inflater = &#x27;
                           &#x27;actionMode.getMenuInflater();\n&#x27;
                           &#x27;        inflater.inflate(R.menu.bulk_edit_tags, &#x27;
                           &#x27;menu);\n&#x27;
                           &#x27;        mActionMode = actionMode;\n&#x27;
                           &#x27;        return true;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onPrepareActionMode(ActionMode &#x27;
                           &#x27;actionMode, Menu menu) {\n&#x27;
                           &#x27;        return false;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onActionItemClicked(ActionMode &#x27;
                           &#x27;actionMode, MenuItem menuItem) {\n&#x27;
                           &#x27;        switch (menuItem.getItemId()) {\n&#x27;
                           &#x27;            case R.id.menu_delete:\n&#x27;
                           &#x27;                actionMode.finish(); // Action &#x27;
                           &#x27;picked, so close the CAB\n&#x27;
                           &#x27;                return true;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                return false;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDestroyActionMode(ActionMode &#x27;
                           &#x27;actionMode) {\n&#x27;
                           &#x27;        mActionMode = null;\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void &#x27;
                           &#x27;onItemCheckedStateChanged(ActionMode actionMode, &#x27;
                           &#x27;int i, long l, boolean b) {\n&#x27;
                           &#x27;        final int checkedCount = &#x27;
                           &#x27;getListView().getCheckedItemCount();\n&#x27;
                           &#x27;        switch (checkedCount) {\n&#x27;
                           &#x27;            case 0:\n&#x27;
                           &#x27;                actionMode.setSubtitle(null);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            case 1:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;One item &#x27;
                           &#x27;selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;            default:\n&#x27;
                           &#x27;                actionMode.setSubtitle(&quot;&quot; + &#x27;
                           &#x27;checkedCount + &quot; items selected&quot;);\n&#x27;
                           &#x27;                break;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onItemLongClick(AdapterView&lt;?&gt; &#x27;
                           &#x27;adapterView, View view, int position, long l) {\n&#x27;
                           &#x27;        &#x27;
                           &#x27;getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n&#x27;
                           &#x27;        getListView().setItemChecked(position, &#x27;
                           &#x27;true);\n&#x27;
                           &#x27;        if (mActionMode == null)\n&#x27;
                           &#x27;            startActionMode(this);\n&#x27;
                           &#x27;        //isCABDestroyed = false;\n&#x27;
                           &#x27;        return false; // so this action does not &#x27;
                           &#x27;consume the event!!!\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public boolean onOptionsItemSelected(MenuItem &#x27;
                           &#x27;item) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        if (item.getItemId() == android.R.id.home) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;            finish();\n&#x27;
                           &#x27;            return true;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        return super.onOptionsItemSelected(item);\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    // Tag Bucket listeners\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onChange(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Bucket.ChangeType type, String key) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onSaveObject(Bucket&lt;Tag&gt; bucket, &#x27;
                           &#x27;Tag object) {\n&#x27;
                           &#x27;        runOnUiThread(new Runnable() {\n&#x27;
                           &#x27;            @Override\n&#x27;
                           &#x27;            public void run() {\n&#x27;
                           &#x27;                refreshTags();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;        });\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    @Override\n&#x27;
                           &#x27;    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; &#x27;
                           &#x27;bucket, Tag object) {\n&#x27;
                           &#x27;        // noop\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class TagsAdapter extends &#x27;
                           &#x27;CursorAdapter {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private ObjectCursor&lt;Tag&gt; mCursor;\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public TagsAdapter(Context context, &#x27;
                           &#x27;ObjectCursor&lt;Tag&gt; c, int flags) {\n&#x27;
                           &#x27;            super(context, c, flags);\n&#x27;
                           &#x27;            mCursor = c;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        public void changeCursor(ObjectCursor&lt;Tag&gt; &#x27;
                           &#x27;cursor) {\n&#x27;
                           &#x27;            super.changeCursor(cursor);\n&#x27;
                           &#x27;            mCursor = cursor;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public Tag getItem(int row) {\n&#x27;
                           &#x27;            super.getItem(row);\n&#x27;
                           &#x27;            return mCursor.getObject();\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View getView(final int position, &#x27;
                           &#x27;View convertView, ViewGroup parent) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            mCursor.moveToPosition(position);\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            if (convertView == null) {\n&#x27;
                           &#x27;                convertView = &#x27;
                           &#x27;getLayoutInflater().inflate(R.layout.tags_list_row, &#x27;
                           &#x27;null);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            final Tag tag = mCursor.getObject();\n&#x27;
                           &#x27;            &#x27;
                           &#x27;convertView.setTag(tag.getSimperiumKey());\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            TextView tagTitle = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_name);\n&#x27;
                           &#x27;            TextView tagCountTextView = (TextView) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_count);\n&#x27;
                           &#x27;            tagTitle.setText(tag.getName());\n&#x27;
                           &#x27;            final int tagCount = &#x27;
                           &#x27;mNotesBucket.query().where(&quot;tags&quot;, &#x27;
                           &#x27;Query.ComparisonType.EQUAL_TO, &#x27;
                           &#x27;tag.getSimperiumKey()).count();\n&#x27;
                           &#x27;            if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                &#x27;
                           &#x27;tagCountTextView.setText(Integer.toString(tagCount));\n&#x27;
                           &#x27;            } else {\n&#x27;
                           &#x27;                tagCountTextView.setText(&quot;&quot;);\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            ImageButton deleteButton = &#x27;
                           &#x27;(ImageButton) &#x27;
                           &#x27;convertView.findViewById(R.id.tag_trash);\n&#x27;
                           &#x27;            deleteButton.setOnClickListener(new &#x27;
                           &#x27;View.OnClickListener() {\n&#x27;
                           &#x27;                @Override\n&#x27;
                           &#x27;                public void onClick(View view) {\n&#x27;
                           &#x27;                    if (tagCount == 0) {\n&#x27;
                           &#x27;                        deleteTag(tag);\n&#x27;
                           &#x27;                    } else if (tagCount &gt; 0) {\n&#x27;
                           &#x27;                        AlertDialog.Builder alert &#x27;
                           &#x27;= new AlertDialog.Builder(TagsListActivity.this);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setTitle(R.string.delete_tag);\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setMessage(getString(R.string.confirm_delete_tag));\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setPositiveButton(R.string.yes, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                deleteTag(tag);\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        &#x27;
                           &#x27;alert.setNegativeButton(R.string.no, new &#x27;
                           &#x27;DialogInterface.OnClickListener() {\n&#x27;
                           &#x27;                            public void &#x27;
                           &#x27;onClick(DialogInterface dialog, int whichButton) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                                // Do nothing, &#x27;
                           &#x27;just closing the dialog\n&#x27;
                           &#x27;                            }\n&#x27;
                           &#x27;                        });\n&#x27;
                           &#x27;                        alert.show();\n&#x27;
                           &#x27;                    }\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;            });\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;            return convertView;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        private void deleteTag(Tag tag) {\n&#x27;
                           &#x27;            tag.delete();\n&#x27;
                           &#x27;            new &#x27;
                           &#x27;removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, &#x27;
                           &#x27;tag);\n&#x27;
                           &#x27;            mTracker.send(\n&#x27;
                           &#x27;                    new &#x27;
                           &#x27;HitBuilders.EventBuilder()\n&#x27;
                           &#x27;                            .setCategory(&quot;tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setAction(&quot;deleted_tag&quot;)\n&#x27;
                           &#x27;                            &#x27;
                           &#x27;.setLabel(&quot;list_trash_button&quot;)\n&#x27;
                           &#x27;                            .build()\n&#x27;
                           &#x27;            );\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public View newView(Context context, &#x27;
                           &#x27;Cursor cursor, ViewGroup viewGroup) {\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        public void bindView(View view, Context &#x27;
                           &#x27;context, Cursor cursor) {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;    private class removeTagFromNotesTask extends &#x27;
                           &#x27;AsyncTask&lt;Tag, Void, Void&gt; {\n&#x27;
                           &#x27;\n&#x27;
                           &#x27;        @Override\n&#x27;
                           &#x27;        protected Void doInBackground(Tag... &#x27;
                           &#x27;removedTags) {\n&#x27;
                           &#x27;            Tag tag = removedTags[0];\n&#x27;
                           &#x27;            if (tag != null) {\n&#x27;
                           &#x27;                ObjectCursor&lt;Note&gt; notesCursor = &#x27;
                           &#x27;tag.findNotes(mNotesBucket);\n&#x27;
                           &#x27;                while (notesCursor.moveToNext()) &#x27;
                           &#x27;{\n&#x27;
                           &#x27;                    Note note = &#x27;
                           &#x27;notesCursor.getObject();\n&#x27;
                           &#x27;                    List&lt;String&gt; tags = &#x27;
                           &#x27;note.getTags();\n&#x27;
                           &#x27;                    tags.remove(tag.getName());\n&#x27;
                           &#x27;                    note.setTags(tags);\n&#x27;
                           &#x27;                    note.save();\n&#x27;
                           &#x27;                }\n&#x27;
                           &#x27;                notesCursor.close();\n&#x27;
                           &#x27;            }\n&#x27;
                           &#x27;            return null;\n&#x27;
                           &#x27;        }\n&#x27;
                           &#x27;    }\n&#x27;
                           &#x27;}\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;spork&#x27;, &#x27;baseline&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        