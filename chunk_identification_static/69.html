<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>69</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    69
                    <a href="68.html">prev</a>
                    <a href="70.html">next</a>
                    <a href="69_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_99d857f3383c60ae4ae008f74e7d2b32afe9c26a_Aria/src/main/java/com/arialyy/aria/core/task/SingleThreadTask.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a:Aria/src/main/java/com/arialyy/aria/core/task/SingleThreadTask.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^1:Aria/src/main/java/com/arialyy/aria/core/task/SingleThreadTask.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;99d857f3383c60ae4ae008f74e7d2b32afe9c26a^2:Aria/src/main/java/com/arialyy/aria/core/task/SingleThreadTask.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;41154d47fb8664ddca206122d28b50a6a3b8e9a6:Aria/src/main/java/com/arialyy/aria/core/task/SingleThreadTask.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18                                                                                                          </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.os.Message;                                                                               </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.Log;                                                                                 </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.IOException;                                                                              </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.InputStream;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.MalformedURLException;                                                                   </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.Properties;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 /**                                                                                                      </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35  * Created by lyy on 2017/1/18.                                                                          </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * 下载线程                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  */                                                                                                      </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 final class SingleThreadTask implements Runnable {                                                       </span>
<span class="1470163101604895715" onmouseenter="enter('1470163101604895715');" onmouseout="out('1470163101604895715');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39   private static final String TAG      = &quot;SingleThreadTask&quot;;                                             </span>
<span class="-8208396912512818633" onmouseenter="enter('-8208396912512818633');" onmouseout="out('-8208396912512818633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   // TODO: 2017/2/22 不能使用1024 否则最大速度不能超过3m                                                               </span>
<span class="4974613412433293449" onmouseenter="enter('4974613412433293449');" onmouseout="out('4974613412433293449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private static final int    BUF_SIZE = 8192;                                                           </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private DownloadUtil.ConfigEntity mConfigEntity;                                                       </span>
<span class="-6303535447758153931" onmouseenter="enter('-6303535447758153931');" onmouseout="out('-6303535447758153931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private String                    mConfigFPath;                                                        </span>
<span class="-4775463327054883269" onmouseenter="enter('-4775463327054883269');" onmouseout="out('-4775463327054883269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private              long   mChildCurrentLocation = 0;                                                 </span>
<span class="-7584862654373756153" onmouseenter="enter('-7584862654373756153');" onmouseout="out('-7584862654373756153');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private static final Object LOCK                  = new Object();                                      </span>
<span class="330503413895455987" onmouseenter="enter('330503413895455987');" onmouseout="out('330503413895455987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener      mListener;                                                              </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48                                                                                                          </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                         </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50       DownloadUtil.ConfigEntity downloadInfo) {                                                          </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51     mConstance = constance;                                                                              </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52     mListener = listener;                                                                                </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53     this.mConfigEntity = downloadInfo;                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54     if (mConfigEntity.isSupportBreakpoint) {                                                             </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55       mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   @Override public void run() {                                                                          </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     HttpURLConnection conn = null;                                                                       </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61     InputStream is = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     try {                                                                                                </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                     </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       //conn = (HttpURLConnection) url.openConnection();                                                 </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65       conn = ConnectionHelp.handleConnection(url);                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         Log.d(TAG, &quot;线程_&quot;                                                                                 </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68             + mConfigEntity.THREAD_ID                                                                    </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69             + &quot;_正在下载【开始位置 : &quot;                                                                            </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70             + mConfigEntity.START_LOCATION                                                               </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71             + &quot;，结束位置：&quot;                                                                                   </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72             + mConfigEntity.END_LOCATION                                                                 </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73             + &quot;】&quot;);                                                                                      </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         //在头里面请求下载开始位置和结束位置                                                                              </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75         conn.setRequestProperty(&quot;Range&quot;,                                                                 </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76             &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77       } else {                                                                                           </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79       }                                                                                                  </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                               </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                               </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       is = conn.getInputStream();                                                                        </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84       //创建可设置位置的文件                                                                                       </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       BufferedRandomAccessFile file =                                                                    </span>
<span class="-2610417709527163720" onmouseenter="enter('-2610417709527163720');" onmouseout="out('-2610417709527163720');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           new BufferedRandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;, BUF_SIZE);                        </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       //设置文件长度                                                                                           </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       file.seek(mConfigEntity.START_LOCATION);                                                           </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89                                                                                                          </span>
<span class="5708157117841091962" onmouseenter="enter('5708157117841091962');" onmouseout="out('5708157117841091962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90       byte[] buffer = new byte[BUF_SIZE];                                                                </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91       int len;                                                                                           </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92       //当前子线程的下载位置                                                                                       </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93       mChildCurrentLocation = mConfigEntity.START_LOCATION;                                              </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94       while ((len = is.read(buffer)) != -1) {                                                            </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95         if (mConstance.isCancel) {                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97         }                                                                                                </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98         if (mConstance.isStop) {                                                                         </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           Log.i(TAG, &quot;stop&quot;);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         //把下载数据数据写入文件                                                                                    </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         file.write(buffer, 0, len);                                                                      </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         progress(len);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105       }                                                                                                  </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       file.close();                                                                                      </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107       //close 为阻塞的，需要使用线程池来处理                                                                            </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108       is.close();                                                                                        </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109       conn.disconnect();                                                                                 </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110       if (mConstance.isCancel) {                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112       }                                                                                                  </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113       //停止状态不需要删除记录文件                                                                                    </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114       if (mConstance.isStop) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116       }                                                                                                  </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117       //支持断点的处理                                                                                          </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119         Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                           </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120         writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,             </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121             1 + &quot;&quot;);                                                                                     </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122         mListener.onChildComplete(mConfigEntity.END_LOCATION);                                           </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124         if (mConstance.isComplete()) {                                                                   </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128           }                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129           mConstance.isDownloading = false;                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130           mListener.onComplete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       } else {                                                                                           </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133         Log.i(TAG, &quot;下载任务完成&quot;);                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134         mConstance.isDownloading = false;                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136       }                                                                                                  </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     } catch (MalformedURLException e) {                                                                  </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     } catch (IOException e) {                                                                            </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,     </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143           e);                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144     } catch (Exception e) {                                                                              </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       mConstance.FAIL_NUM++;                                                                             </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146       failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    */                                                                                                    </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153   protected void stop() {                                                                                </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155       try {                                                                                              </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157           mConstance.STOP_NUM++;                                                                         </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           String location = String.valueOf(mChildCurrentLocation);                                       </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159           Log.d(TAG, &quot;thread_&quot;                                                                           </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160               + mConfigEntity.THREAD_ID                                                                  </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161               + &quot;_stop, stop location ==&gt; &quot;                                                              </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162               + mChildCurrentLocation);                                                                  </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163           writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,          </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164               location);                                                                                 </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165           if (mConstance.isStop()) {                                                                     </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166             Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167             mConstance.isDownloading = false;                                                            </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168             mListener.onStop(mConstance.CURRENT_LOCATION);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         } else {                                                                                         </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171           Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172           mConstance.isDownloading = false;                                                              </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173           mListener.onStop(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181   /**                                                                                                    </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182    * 下载中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183    */                                                                                                    </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   private void progress(long len) {                                                                      </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185     synchronized (LOCK) {                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       mChildCurrentLocation += len;                                                                      </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187       mConstance.CURRENT_LOCATION += len;                                                                </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-7214647733207450915" onmouseenter="enter('-7214647733207450915');" onmouseout="out('-7214647733207450915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       //mHandler.sendEmptyMessage(1);                                                                    </span>
<span class="-5965669542619336697" onmouseenter="enter('-5965669542619336697');" onmouseout="out('-5965669542619336697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190       //mHandler.post(t);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193                                                                                                          </span>
<span class="-265805331026522004" onmouseenter="enter('-265805331026522004');" onmouseout="out('-265805331026522004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194   Handler mHandler = new Handler(Looper.getMainLooper()) {                                               </span>
<span class="-1427939510718485574" onmouseenter="enter('-1427939510718485574');" onmouseout="out('-1427939510718485574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195     @Override public void handleMessage(Message msg) {                                                   </span>
<span class="631594066954408669" onmouseenter="enter('631594066954408669');" onmouseout="out('631594066954408669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196       super.handleMessage(msg);                                                                          </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     }                                                                                                    </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   };                                                                                                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200                                                                                                          </span>
<span class="6162039791573929553" onmouseenter="enter('6162039791573929553');" onmouseout="out('6162039791573929553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201   Thread t = new Thread(new Runnable() {                                                                 </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202     @Override public void run() {                                                                        </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   });                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206                                                                                                          </span>
<span class="-3086691770564224506" onmouseenter="enter('-3086691770564224506');" onmouseout="out('-3086691770564224506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   //Handler handler = new Handler(){                                                                     </span>
<span class="2764893303200817020" onmouseenter="enter('2764893303200817020');" onmouseout="out('2764893303200817020');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208   //  @Override public void handleMessage(Message msg) {                                                 </span>
<span class="1899026460107632807" onmouseenter="enter('1899026460107632807');" onmouseout="out('1899026460107632807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   //    super.handleMessage(msg);                                                                        </span>
<span class="-1683835654340753237" onmouseenter="enter('-1683835654340753237');" onmouseout="out('-1683835654340753237');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210   //    mListener.onProgress(mConstance.CURRENT_LOCATION);                                               </span>
<span class="2740629830860486557" onmouseenter="enter('2740629830860486557');" onmouseout="out('2740629830860486557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   //  }                                                                                                  </span>
<span class="1256134299569282437" onmouseenter="enter('1256134299569282437');" onmouseout="out('1256134299569282437');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212   //};                                                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213                                                                                                          </span>
<span class="548404083425373257" onmouseenter="enter('548404083425373257');" onmouseout="out('548404083425373257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214   Thread thread = new Thread();                                                                          </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218    */                                                                                                    </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219   protected void cancel() {                                                                              </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220     synchronized (LOCK) {                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);               </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         if (mConstance.isCancel()) {                                                                     </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228           }                                                                                              </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229           if (mConfigEntity.TEMP_FILE.exists()) {                                                        </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230             mConfigEntity.TEMP_FILE.delete();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231           }                                                                                              </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232           Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233           mConstance.isDownloading = false;                                                              </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234           mListener.onCancel();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236       } else {                                                                                           </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237         Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238         mConstance.isDownloading = false;                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239         mListener.onCancel();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244   /**                                                                                                    </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    * 下载失败                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246    */                                                                                                    </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247   private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,         </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248       Exception ex) {                                                                                    </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       try {                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251         mConstance.isDownloading = false;                                                                </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252         mConstance.isStop = true;                                                                        </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253         if (ex != null) {                                                                                </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254           Log.e(TAG, CommonUtil.getPrintException(ex));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255         }                                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257           if (currentLocation != -1) {                                                                   </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258             String location = String.valueOf(currentLocation);                                           </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259             writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260           }                                                                                              </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261           if (mConstance.isFail()) {                                                                     </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262             Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                     </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263             mListener.onFail();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265         } else {                                                                                         </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266           Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                       </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267           mListener.onFail();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276    * 将记录写入到配置文件                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277    */                                                                                                    </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278   private void writeConfig(String key, String record) throws IOException {                               </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     File configFile = new File(mConfigFPath);                                                            </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     Properties pro = CommonUtil.loadConfig(configFile);                                                  </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281     pro.setProperty(key, record);                                                                        </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     CommonUtil.saveConfig(configFile, pro);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284 }                                                                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 285 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300  */                                                                                                      </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302                                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303 import android.util.Log;                                                                                 </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 import java.io.IOException;                                                                              </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 import java.io.InputStream;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309 import java.net.HttpURLConnection;                                                                       </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 import java.net.MalformedURLException;                                                                   </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 import java.util.Properties;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 /**                                                                                                      </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315  * Created by lyy on 2017/1/18.                                                                          </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316  * 下载线程                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317  */                                                                                                      </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318 final class SingleThreadTask implements Runnable {                                                       </span>
<span class="-652388901466714347" onmouseenter="enter('-652388901466714347');" onmouseout="out('-652388901466714347');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319   private static final String TAG = &quot;SingleThreadTask&quot;;                                                  </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320   private DownloadUtil.ConfigEntity mConfigEntity;                                                       </span>
<span class="5711120372305423923" onmouseenter="enter('5711120372305423923');" onmouseout="out('5711120372305423923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321   private String mConfigFPath;                                                                           </span>
<span class="-6399687529328161680" onmouseenter="enter('-6399687529328161680');" onmouseout="out('-6399687529328161680');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322   private long mChildCurrentLocation = 0;                                                                </span>
<span class="4753550627703968447" onmouseenter="enter('4753550627703968447');" onmouseout="out('4753550627703968447');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323   private static final Object LOCK = new Object();                                                       </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324   private IDownloadListener mListener;                                                                   </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326                                                                                                          </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327   SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                         </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328       DownloadUtil.ConfigEntity downloadInfo) {                                                          </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329     mConstance = constance;                                                                              </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330     mListener = listener;                                                                                </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331     this.mConfigEntity = downloadInfo;                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332     if (mConfigEntity.isSupportBreakpoint) {                                                             </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333       mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337   @Override public void run() {                                                                          </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338     HttpURLConnection conn = null;                                                                       </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339     InputStream is = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340     try {                                                                                                </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341       URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                     </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342       //conn = (HttpURLConnection) url.openConnection();                                                 </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343       conn = ConnectionHelp.handleConnection(url);                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         Log.d(TAG, &quot;线程_&quot;                                                                                 </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346             + mConfigEntity.THREAD_ID                                                                    </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347             + &quot;_正在下载【开始位置 : &quot;                                                                            </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348             + mConfigEntity.START_LOCATION                                                               </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349             + &quot;，结束位置：&quot;                                                                                   </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350             + mConfigEntity.END_LOCATION                                                                 </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351             + &quot;】&quot;);                                                                                      </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352         //在头里面请求下载开始位置和结束位置                                                                              </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353         conn.setRequestProperty(&quot;Range&quot;,                                                                 </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354             &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355       } else {                                                                                           </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356         Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357       }                                                                                                  </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359       conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                               </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360       conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                               </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361       is = conn.getInputStream();                                                                        </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362       //创建可设置位置的文件                                                                                       </span>
<span class="-8226142622422211895" onmouseenter="enter('-8226142622422211895');" onmouseout="out('-8226142622422211895');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363       RandomAccessFile file = new RandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;);                      </span>
<span class="9067034587548083002" onmouseenter="enter('9067034587548083002');" onmouseout="out('9067034587548083002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364       //设置每条线程写入文件的位置                                                                                    </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365       file.seek(mConfigEntity.START_LOCATION);                                                           </span>
<span class="-6938993880531927464" onmouseenter="enter('-6938993880531927464');" onmouseout="out('-6938993880531927464');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366       byte[] buffer = new byte[1024];                                                                    </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367       int len;                                                                                           </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368       //当前子线程的下载位置                                                                                       </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369       mChildCurrentLocation = mConfigEntity.START_LOCATION;                                              </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370       while ((len = is.read(buffer)) != -1) {                                                            </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371         if (mConstance.isCancel) {                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373         }                                                                                                </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374         if (mConstance.isStop) {                                                                         </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375           Log.i(TAG, &quot;stop&quot;);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377         }                                                                                                </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378         //把下载数据数据写入文件                                                                                    </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         file.write(buffer, 0, len);                                                                      </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380         progress(len);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381       }                                                                                                  </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382       file.close();                                                                                      </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383       //close 为阻塞的，需要使用线程池来处理                                                                            </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384       is.close();                                                                                        </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385       conn.disconnect();                                                                                 </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386       if (mConstance.isCancel) {                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388       }                                                                                                  </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389       //停止状态不需要删除记录文件                                                                                    </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390       if (mConstance.isStop) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392       }                                                                                                  </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393       //支持断点的处理                                                                                          </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395         Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                           </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396         writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,             </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397             1 + &quot;&quot;);                                                                                     </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398         mListener.onChildComplete(mConfigEntity.END_LOCATION);                                           </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400         if (mConstance.isComplete()) {                                                                   </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404           }                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405           mConstance.isDownloading = false;                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406           mListener.onComplete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408       } else {                                                                                           </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         Log.i(TAG, &quot;下载任务完成&quot;);                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410         mConstance.isDownloading = false;                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412       }                                                                                                  </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413     } catch (MalformedURLException e) {                                                                  </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416     } catch (IOException e) {                                                                            </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,     </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419           e);                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     } catch (Exception e) {                                                                              </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421       mConstance.FAIL_NUM++;                                                                             </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422       failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428    */                                                                                                    </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429   protected void stop() {                                                                                </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431       try {                                                                                              </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433           mConstance.STOP_NUM++;                                                                         </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434           String location = String.valueOf(mChildCurrentLocation);                                       </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435           Log.d(TAG, &quot;thread_&quot;                                                                           </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436               + mConfigEntity.THREAD_ID                                                                  </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437               + &quot;_stop, stop location ==&gt; &quot;                                                              </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438               + mChildCurrentLocation);                                                                  </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439           writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,          </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440               location);                                                                                 </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441           if (mConstance.isStop()) {                                                                     </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442             Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443             mConstance.isDownloading = false;                                                            </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444             mListener.onStop(mConstance.CURRENT_LOCATION);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         } else {                                                                                         </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447           Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448           mConstance.isDownloading = false;                                                              </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449           mListener.onStop(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457   /**                                                                                                    </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458    * 下载中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459    */                                                                                                    </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460   private void progress(long len) {                                                                      </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461     synchronized (LOCK) {                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462       mChildCurrentLocation += len;                                                                      </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463       mConstance.CURRENT_LOCATION += len;                                                                </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470    */                                                                                                    </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471   protected void cancel() {                                                                              </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     synchronized (LOCK) {                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475         Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);               </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476         if (mConstance.isCancel()) {                                                                     </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480           }                                                                                              </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481           if (mConfigEntity.TEMP_FILE.exists()) {                                                        </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             mConfigEntity.TEMP_FILE.delete();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483           }                                                                                              </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484           Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485           mConstance.isDownloading = false;                                                              </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486           mListener.onCancel();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488       } else {                                                                                           </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489         Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490         mConstance.isDownloading = false;                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         mListener.onCancel();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496   /**                                                                                                    </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497    * 下载失败                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498    */                                                                                                    </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499   private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,         </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500       Exception ex) {                                                                                    </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502       try {                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503         mConstance.isDownloading = false;                                                                </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504         mConstance.isStop = true;                                                                        </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505         if (ex != null) {                                                                                </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506           Log.e(TAG, CommonUtil.getPrintException(ex));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507         }                                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509           if (currentLocation != -1) {                                                                   </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510             String location = String.valueOf(currentLocation);                                           </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511             writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512           }                                                                                              </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513           if (mConstance.isFail()) {                                                                     </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514             Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                     </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515             mListener.onFail();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517         } else {                                                                                         </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518           Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                       </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519           mListener.onFail();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528    * 将记录写入到配置文件                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529    */                                                                                                    </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530   private void writeConfig(String key, String record) throws IOException {                               </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531     File configFile = new File(mConfigFPath);                                                            </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532     Properties pro = CommonUtil.loadConfig(configFile);                                                  </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533     pro.setProperty(key, record);                                                                        </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534     CommonUtil.saveConfig(configFile, pro);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 537 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 538 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span></pre></td>
                            <td><pre><span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18                                                                                                          </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.os.Message;                                                                               </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.Log;                                                                                 </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.IOException;                                                                              </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.InputStream;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.MalformedURLException;                                                                   </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.Properties;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 /**                                                                                                      </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35  * Created by lyy on 2017/1/18.                                                                          </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * 下载线程                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  */                                                                                                      </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 final class SingleThreadTask implements Runnable {                                                       </span>
<span class="1470163101604895715" onmouseenter="enter('1470163101604895715');" onmouseout="out('1470163101604895715');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39   private static final String TAG      = &quot;SingleThreadTask&quot;;                                             </span>
<span class="-8208396912512818633" onmouseenter="enter('-8208396912512818633');" onmouseout="out('-8208396912512818633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   // TODO: 2017/2/22 不能使用1024 否则最大速度不能超过3m                                                               </span>
<span class="4974613412433293449" onmouseenter="enter('4974613412433293449');" onmouseout="out('4974613412433293449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private static final int    BUF_SIZE = 8192;                                                           </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private DownloadUtil.ConfigEntity mConfigEntity;                                                       </span>
<span class="-6303535447758153931" onmouseenter="enter('-6303535447758153931');" onmouseout="out('-6303535447758153931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private String                    mConfigFPath;                                                        </span>
<span class="-4775463327054883269" onmouseenter="enter('-4775463327054883269');" onmouseout="out('-4775463327054883269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private              long   mChildCurrentLocation = 0;                                                 </span>
<span class="-7584862654373756153" onmouseenter="enter('-7584862654373756153');" onmouseout="out('-7584862654373756153');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private static final Object LOCK                  = new Object();                                      </span>
<span class="330503413895455987" onmouseenter="enter('330503413895455987');" onmouseout="out('330503413895455987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener      mListener;                                                              </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48                                                                                                          </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                         </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50       DownloadUtil.ConfigEntity downloadInfo) {                                                          </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51     mConstance = constance;                                                                              </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52     mListener = listener;                                                                                </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53     this.mConfigEntity = downloadInfo;                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54     if (mConfigEntity.isSupportBreakpoint) {                                                             </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55       mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   @Override public void run() {                                                                          </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     HttpURLConnection conn = null;                                                                       </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61     InputStream is = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     try {                                                                                                </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                     </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       //conn = (HttpURLConnection) url.openConnection();                                                 </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65       conn = ConnectionHelp.handleConnection(url);                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         Log.d(TAG, &quot;线程_&quot;                                                                                 </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68             + mConfigEntity.THREAD_ID                                                                    </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69             + &quot;_正在下载【开始位置 : &quot;                                                                            </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70             + mConfigEntity.START_LOCATION                                                               </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71             + &quot;，结束位置：&quot;                                                                                   </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72             + mConfigEntity.END_LOCATION                                                                 </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73             + &quot;】&quot;);                                                                                      </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         //在头里面请求下载开始位置和结束位置                                                                              </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75         conn.setRequestProperty(&quot;Range&quot;,                                                                 </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76             &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77       } else {                                                                                           </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79       }                                                                                                  </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                               </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                               </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       is = conn.getInputStream();                                                                        </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84       //创建可设置位置的文件                                                                                       </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       BufferedRandomAccessFile file =                                                                    </span>
<span class="-2610417709527163720" onmouseenter="enter('-2610417709527163720');" onmouseout="out('-2610417709527163720');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           new BufferedRandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;, BUF_SIZE);                        </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       //设置文件长度                                                                                           </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       file.seek(mConfigEntity.START_LOCATION);                                                           </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89                                                                                                          </span>
<span class="5708157117841091962" onmouseenter="enter('5708157117841091962');" onmouseout="out('5708157117841091962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90       byte[] buffer = new byte[BUF_SIZE];                                                                </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91       int len;                                                                                           </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92       //当前子线程的下载位置                                                                                       </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93       mChildCurrentLocation = mConfigEntity.START_LOCATION;                                              </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94       while ((len = is.read(buffer)) != -1) {                                                            </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95         if (mConstance.isCancel) {                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97         }                                                                                                </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98         if (mConstance.isStop) {                                                                         </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           Log.i(TAG, &quot;stop&quot;);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         //把下载数据数据写入文件                                                                                    </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         file.write(buffer, 0, len);                                                                      </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         progress(len);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105       }                                                                                                  </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       file.close();                                                                                      </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107       //close 为阻塞的，需要使用线程池来处理                                                                            </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108       is.close();                                                                                        </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109       conn.disconnect();                                                                                 </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110       if (mConstance.isCancel) {                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112       }                                                                                                  </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113       //停止状态不需要删除记录文件                                                                                    </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114       if (mConstance.isStop) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116       }                                                                                                  </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117       //支持断点的处理                                                                                          </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119         Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                           </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120         writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,             </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121             1 + &quot;&quot;);                                                                                     </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122         mListener.onChildComplete(mConfigEntity.END_LOCATION);                                           </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124         if (mConstance.isComplete()) {                                                                   </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128           }                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129           mConstance.isDownloading = false;                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130           mListener.onComplete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       } else {                                                                                           </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133         Log.i(TAG, &quot;下载任务完成&quot;);                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134         mConstance.isDownloading = false;                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136       }                                                                                                  </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     } catch (MalformedURLException e) {                                                                  </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     } catch (IOException e) {                                                                            </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,     </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143           e);                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144     } catch (Exception e) {                                                                              </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       mConstance.FAIL_NUM++;                                                                             </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146       failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    */                                                                                                    </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153   protected void stop() {                                                                                </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155       try {                                                                                              </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157           mConstance.STOP_NUM++;                                                                         </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           String location = String.valueOf(mChildCurrentLocation);                                       </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159           Log.d(TAG, &quot;thread_&quot;                                                                           </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160               + mConfigEntity.THREAD_ID                                                                  </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161               + &quot;_stop, stop location ==&gt; &quot;                                                              </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162               + mChildCurrentLocation);                                                                  </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163           writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,          </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164               location);                                                                                 </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165           if (mConstance.isStop()) {                                                                     </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166             Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167             mConstance.isDownloading = false;                                                            </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168             mListener.onStop(mConstance.CURRENT_LOCATION);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         } else {                                                                                         </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171           Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172           mConstance.isDownloading = false;                                                              </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173           mListener.onStop(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181   /**                                                                                                    </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182    * 下载中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183    */                                                                                                    </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   private void progress(long len) {                                                                      </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185     synchronized (LOCK) {                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       mChildCurrentLocation += len;                                                                      </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187       mConstance.CURRENT_LOCATION += len;                                                                </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-7214647733207450915" onmouseenter="enter('-7214647733207450915');" onmouseout="out('-7214647733207450915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       //mHandler.sendEmptyMessage(1);                                                                    </span>
<span class="-5965669542619336697" onmouseenter="enter('-5965669542619336697');" onmouseout="out('-5965669542619336697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190       //mHandler.post(t);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193                                                                                                          </span>
<span class="-265805331026522004" onmouseenter="enter('-265805331026522004');" onmouseout="out('-265805331026522004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194   Handler mHandler = new Handler(Looper.getMainLooper()) {                                               </span>
<span class="-1427939510718485574" onmouseenter="enter('-1427939510718485574');" onmouseout="out('-1427939510718485574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195     @Override public void handleMessage(Message msg) {                                                   </span>
<span class="631594066954408669" onmouseenter="enter('631594066954408669');" onmouseout="out('631594066954408669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196       super.handleMessage(msg);                                                                          </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     }                                                                                                    </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   };                                                                                                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200                                                                                                          </span>
<span class="6162039791573929553" onmouseenter="enter('6162039791573929553');" onmouseout="out('6162039791573929553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201   Thread t = new Thread(new Runnable() {                                                                 </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202     @Override public void run() {                                                                        </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   });                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206                                                                                                          </span>
<span class="-3086691770564224506" onmouseenter="enter('-3086691770564224506');" onmouseout="out('-3086691770564224506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   //Handler handler = new Handler(){                                                                     </span>
<span class="2764893303200817020" onmouseenter="enter('2764893303200817020');" onmouseout="out('2764893303200817020');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208   //  @Override public void handleMessage(Message msg) {                                                 </span>
<span class="1899026460107632807" onmouseenter="enter('1899026460107632807');" onmouseout="out('1899026460107632807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   //    super.handleMessage(msg);                                                                        </span>
<span class="-1683835654340753237" onmouseenter="enter('-1683835654340753237');" onmouseout="out('-1683835654340753237');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210   //    mListener.onProgress(mConstance.CURRENT_LOCATION);                                               </span>
<span class="2740629830860486557" onmouseenter="enter('2740629830860486557');" onmouseout="out('2740629830860486557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   //  }                                                                                                  </span>
<span class="1256134299569282437" onmouseenter="enter('1256134299569282437');" onmouseout="out('1256134299569282437');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212   //};                                                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213                                                                                                          </span>
<span class="548404083425373257" onmouseenter="enter('548404083425373257');" onmouseout="out('548404083425373257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214   Thread thread = new Thread();                                                                          </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218    */                                                                                                    </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219   protected void cancel() {                                                                              </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220     synchronized (LOCK) {                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);               </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         if (mConstance.isCancel()) {                                                                     </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228           }                                                                                              </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229           if (mConfigEntity.TEMP_FILE.exists()) {                                                        </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230             mConfigEntity.TEMP_FILE.delete();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231           }                                                                                              </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232           Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233           mConstance.isDownloading = false;                                                              </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234           mListener.onCancel();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236       } else {                                                                                           </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237         Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238         mConstance.isDownloading = false;                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239         mListener.onCancel();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244   /**                                                                                                    </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    * 下载失败                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246    */                                                                                                    </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247   private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,         </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248       Exception ex) {                                                                                    </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       try {                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251         mConstance.isDownloading = false;                                                                </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252         mConstance.isStop = true;                                                                        </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253         if (ex != null) {                                                                                </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254           Log.e(TAG, CommonUtil.getPrintException(ex));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255         }                                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257           if (currentLocation != -1) {                                                                   </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258             String location = String.valueOf(currentLocation);                                           </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259             writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260           }                                                                                              </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261           if (mConstance.isFail()) {                                                                     </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262             Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                     </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263             mListener.onFail();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265         } else {                                                                                         </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266           Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                       </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267           mListener.onFail();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276    * 将记录写入到配置文件                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277    */                                                                                                    </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278   private void writeConfig(String key, String record) throws IOException {                               </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     File configFile = new File(mConfigFPath);                                                            </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     Properties pro = CommonUtil.loadConfig(configFile);                                                  </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281     pro.setProperty(key, record);                                                                        </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     CommonUtil.saveConfig(configFile, pro);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284 }                                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 285 ||||||| BASE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300  */                                                                                                      </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302                                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303 import android.util.Log;                                                                                 </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 import java.io.IOException;                                                                              </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 import java.io.InputStream;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309 import java.net.HttpURLConnection;                                                                       </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 import java.net.MalformedURLException;                                                                   </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 import java.util.Properties;                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 /**                                                                                                      </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315  * Created by lyy on 2017/1/18.                                                                          </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316  * 下载线程                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317  */                                                                                                      </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318 final class SingleThreadTask implements Runnable {                                                       </span>
<span class="-652388901466714347" onmouseenter="enter('-652388901466714347');" onmouseout="out('-652388901466714347');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319   private static final String TAG = &quot;SingleThreadTask&quot;;                                                  </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320   private DownloadUtil.ConfigEntity mConfigEntity;                                                       </span>
<span class="5711120372305423923" onmouseenter="enter('5711120372305423923');" onmouseout="out('5711120372305423923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321   private String mConfigFPath;                                                                           </span>
<span class="-6399687529328161680" onmouseenter="enter('-6399687529328161680');" onmouseout="out('-6399687529328161680');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322   private long mChildCurrentLocation = 0;                                                                </span>
<span class="4753550627703968447" onmouseenter="enter('4753550627703968447');" onmouseout="out('4753550627703968447');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323   private static final Object LOCK = new Object();                                                       </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324   private IDownloadListener mListener;                                                                   </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326                                                                                                          </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327   SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                         </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328       DownloadUtil.ConfigEntity downloadInfo) {                                                          </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329     mConstance = constance;                                                                              </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330     mListener = listener;                                                                                </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331     this.mConfigEntity = downloadInfo;                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332     if (mConfigEntity.isSupportBreakpoint) {                                                             </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333       mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337   @Override public void run() {                                                                          </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338     HttpURLConnection conn = null;                                                                       </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339     InputStream is = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340     try {                                                                                                </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341       URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                     </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342       //conn = (HttpURLConnection) url.openConnection();                                                 </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343       conn = ConnectionHelp.handleConnection(url);                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         Log.d(TAG, &quot;线程_&quot;                                                                                 </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346             + mConfigEntity.THREAD_ID                                                                    </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347             + &quot;_正在下载【开始位置 : &quot;                                                                            </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348             + mConfigEntity.START_LOCATION                                                               </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349             + &quot;，结束位置：&quot;                                                                                   </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350             + mConfigEntity.END_LOCATION                                                                 </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351             + &quot;】&quot;);                                                                                      </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352         //在头里面请求下载开始位置和结束位置                                                                              </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353         conn.setRequestProperty(&quot;Range&quot;,                                                                 </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354             &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355       } else {                                                                                           </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356         Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357       }                                                                                                  </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359       conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                               </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360       conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                               </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361       is = conn.getInputStream();                                                                        </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362       //创建可设置位置的文件                                                                                       </span>
<span class="-8226142622422211895" onmouseenter="enter('-8226142622422211895');" onmouseout="out('-8226142622422211895');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363       RandomAccessFile file = new RandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;);                      </span>
<span class="9067034587548083002" onmouseenter="enter('9067034587548083002');" onmouseout="out('9067034587548083002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364       //设置每条线程写入文件的位置                                                                                    </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365       file.seek(mConfigEntity.START_LOCATION);                                                           </span>
<span class="-6938993880531927464" onmouseenter="enter('-6938993880531927464');" onmouseout="out('-6938993880531927464');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366       byte[] buffer = new byte[1024];                                                                    </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367       int len;                                                                                           </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368       //当前子线程的下载位置                                                                                       </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369       mChildCurrentLocation = mConfigEntity.START_LOCATION;                                              </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370       while ((len = is.read(buffer)) != -1) {                                                            </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371         if (mConstance.isCancel) {                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373         }                                                                                                </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374         if (mConstance.isStop) {                                                                         </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375           Log.i(TAG, &quot;stop&quot;);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377         }                                                                                                </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378         //把下载数据数据写入文件                                                                                    </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         file.write(buffer, 0, len);                                                                      </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380         progress(len);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381       }                                                                                                  </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382       file.close();                                                                                      </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383       //close 为阻塞的，需要使用线程池来处理                                                                            </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384       is.close();                                                                                        </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385       conn.disconnect();                                                                                 </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386       if (mConstance.isCancel) {                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388       }                                                                                                  </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389       //停止状态不需要删除记录文件                                                                                    </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390       if (mConstance.isStop) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392       }                                                                                                  </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393       //支持断点的处理                                                                                          </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395         Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                           </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396         writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,             </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397             1 + &quot;&quot;);                                                                                     </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398         mListener.onChildComplete(mConfigEntity.END_LOCATION);                                           </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400         if (mConstance.isComplete()) {                                                                   </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404           }                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405           mConstance.isDownloading = false;                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406           mListener.onComplete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408       } else {                                                                                           </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         Log.i(TAG, &quot;下载任务完成&quot;);                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410         mConstance.isDownloading = false;                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412       }                                                                                                  </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413     } catch (MalformedURLException e) {                                                                  </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416     } catch (IOException e) {                                                                            </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,     </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419           e);                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     } catch (Exception e) {                                                                              </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421       mConstance.FAIL_NUM++;                                                                             </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422       failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428    */                                                                                                    </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429   protected void stop() {                                                                                </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431       try {                                                                                              </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433           mConstance.STOP_NUM++;                                                                         </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434           String location = String.valueOf(mChildCurrentLocation);                                       </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435           Log.d(TAG, &quot;thread_&quot;                                                                           </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436               + mConfigEntity.THREAD_ID                                                                  </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437               + &quot;_stop, stop location ==&gt; &quot;                                                              </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438               + mChildCurrentLocation);                                                                  </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439           writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,          </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440               location);                                                                                 </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441           if (mConstance.isStop()) {                                                                     </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442             Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443             mConstance.isDownloading = false;                                                            </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444             mListener.onStop(mConstance.CURRENT_LOCATION);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         } else {                                                                                         </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447           Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448           mConstance.isDownloading = false;                                                              </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449           mListener.onStop(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457   /**                                                                                                    </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458    * 下载中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459    */                                                                                                    </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460   private void progress(long len) {                                                                      </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461     synchronized (LOCK) {                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462       mChildCurrentLocation += len;                                                                      </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463       mConstance.CURRENT_LOCATION += len;                                                                </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470    */                                                                                                    </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471   protected void cancel() {                                                                              </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     synchronized (LOCK) {                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475         Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);               </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476         if (mConstance.isCancel()) {                                                                     </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480           }                                                                                              </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481           if (mConfigEntity.TEMP_FILE.exists()) {                                                        </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             mConfigEntity.TEMP_FILE.delete();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483           }                                                                                              </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484           Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485           mConstance.isDownloading = false;                                                              </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486           mListener.onCancel();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488       } else {                                                                                           </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489         Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490         mConstance.isDownloading = false;                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         mListener.onCancel();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496   /**                                                                                                    </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497    * 下载失败                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498    */                                                                                                    </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499   private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,         </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500       Exception ex) {                                                                                    </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502       try {                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503         mConstance.isDownloading = false;                                                                </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504         mConstance.isStop = true;                                                                        </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505         if (ex != null) {                                                                                </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506           Log.e(TAG, CommonUtil.getPrintException(ex));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507         }                                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509           if (currentLocation != -1) {                                                                   </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510             String location = String.valueOf(currentLocation);                                           </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511             writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512           }                                                                                              </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513           if (mConstance.isFail()) {                                                                     </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514             Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                     </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515             mListener.onFail();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517         } else {                                                                                         </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518           Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                       </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519           mListener.onFail();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528    * 将记录写入到配置文件                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529    */                                                                                                    </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530   private void writeConfig(String key, String record) throws IOException {                               </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531     File configFile = new File(mConfigFPath);                                                            </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532     Properties pro = CommonUtil.loadConfig(configFile);                                                  </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533     pro.setProperty(key, record);                                                                        </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534     CommonUtil.saveConfig(configFile, pro);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 537 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 538 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span></pre></td>
                            <td><pre><span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   2 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   3  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   4  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   5  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   6  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   7  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">   9  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  10  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  11  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  12  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  13  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  14  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  15  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  16  */                                                                                                      </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  17 package com.arialyy.aria.core.task;                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  18                                                                                                          </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  20 import android.os.Looper;                                                                                </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  21 import android.os.Message;                                                                               </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  22 import android.util.Log;                                                                                 </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import java.io.IOException;                                                                              </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import java.io.InputStream;                                                                              </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import java.io.RandomAccessFile;                                                                         </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import java.net.HttpURLConnection;                                                                       </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import java.net.MalformedURLException;                                                                   </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import java.net.URL;                                                                                     </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import java.util.Properties;                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 /**                                                                                                      </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35  * Created by lyy on 2017/1/18.                                                                          </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36  * 下载线程                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37  */                                                                                                      </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 final class SingleThreadTask implements Runnable {                                                       </span>
<span class="1470163101604895715" onmouseenter="enter('1470163101604895715');" onmouseout="out('1470163101604895715');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39   private static final String TAG      = &quot;SingleThreadTask&quot;;                                             </span>
<span class="-8208396912512818633" onmouseenter="enter('-8208396912512818633');" onmouseout="out('-8208396912512818633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40   // TODO: 2017/2/22 不能使用1024 否则最大速度不能超过3m                                                               </span>
<span class="4974613412433293449" onmouseenter="enter('4974613412433293449');" onmouseout="out('4974613412433293449');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   private static final int    BUF_SIZE = 8192;                                                           </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42   private DownloadUtil.ConfigEntity mConfigEntity;                                                       </span>
<span class="-6303535447758153931" onmouseenter="enter('-6303535447758153931');" onmouseout="out('-6303535447758153931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43   private String                    mConfigFPath;                                                        </span>
<span class="-4775463327054883269" onmouseenter="enter('-4775463327054883269');" onmouseout="out('-4775463327054883269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44   private              long   mChildCurrentLocation = 0;                                                 </span>
<span class="-7584862654373756153" onmouseenter="enter('-7584862654373756153');" onmouseout="out('-7584862654373756153');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45   private static final Object LOCK                  = new Object();                                      </span>
<span class="330503413895455987" onmouseenter="enter('330503413895455987');" onmouseout="out('330503413895455987');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46   private IDownloadListener      mListener;                                                              </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47   private DownloadStateConstance mConstance;                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48                                                                                                          </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49   SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                         </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50       DownloadUtil.ConfigEntity downloadInfo) {                                                          </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51     mConstance = constance;                                                                              </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52     mListener = listener;                                                                                </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53     this.mConfigEntity = downloadInfo;                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54     if (mConfigEntity.isSupportBreakpoint) {                                                             </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55       mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59   @Override public void run() {                                                                          </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     HttpURLConnection conn = null;                                                                       </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61     InputStream is = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62     try {                                                                                                </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63       URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                     </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64       //conn = (HttpURLConnection) url.openConnection();                                                 </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65       conn = ConnectionHelp.handleConnection(url);                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         Log.d(TAG, &quot;线程_&quot;                                                                                 </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68             + mConfigEntity.THREAD_ID                                                                    </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69             + &quot;_正在下载【开始位置 : &quot;                                                                            </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70             + mConfigEntity.START_LOCATION                                                               </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71             + &quot;，结束位置：&quot;                                                                                   </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72             + mConfigEntity.END_LOCATION                                                                 </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73             + &quot;】&quot;);                                                                                      </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74         //在头里面请求下载开始位置和结束位置                                                                              </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75         conn.setRequestProperty(&quot;Range&quot;,                                                                 </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76             &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77       } else {                                                                                           </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79       }                                                                                                  </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80       conn = ConnectionHelp.setConnectParam(conn);                                                       </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81       conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                               </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82       conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                               </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83       is = conn.getInputStream();                                                                        </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84       //创建可设置位置的文件                                                                                       </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85       BufferedRandomAccessFile file =                                                                    </span>
<span class="-2610417709527163720" onmouseenter="enter('-2610417709527163720');" onmouseout="out('-2610417709527163720');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86           new BufferedRandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;, BUF_SIZE);                        </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87       //设置文件长度                                                                                           </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88       file.seek(mConfigEntity.START_LOCATION);                                                           </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89                                                                                                          </span>
<span class="5708157117841091962" onmouseenter="enter('5708157117841091962');" onmouseout="out('5708157117841091962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90       byte[] buffer = new byte[BUF_SIZE];                                                                </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91       int len;                                                                                           </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92       //当前子线程的下载位置                                                                                       </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93       mChildCurrentLocation = mConfigEntity.START_LOCATION;                                              </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94       while ((len = is.read(buffer)) != -1) {                                                            </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95         if (mConstance.isCancel) {                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97         }                                                                                                </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98         if (mConstance.isStop) {                                                                         </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99           Log.i(TAG, &quot;stop&quot;);                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100           break;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         //把下载数据数据写入文件                                                                                    </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         file.write(buffer, 0, len);                                                                      </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         progress(len);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105       }                                                                                                  </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106       file.close();                                                                                      </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107       //close 为阻塞的，需要使用线程池来处理                                                                            </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108       is.close();                                                                                        </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109       conn.disconnect();                                                                                 </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110       if (mConstance.isCancel) {                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112       }                                                                                                  </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113       //停止状态不需要删除记录文件                                                                                    </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114       if (mConstance.isStop) {                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116       }                                                                                                  </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117       //支持断点的处理                                                                                          </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119         Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                           </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120         writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,             </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121             1 + &quot;&quot;);                                                                                     </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122         mListener.onChildComplete(mConfigEntity.END_LOCATION);                                           </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123         mConstance.COMPLETE_THREAD_NUM++;                                                                </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124         if (mConstance.isComplete()) {                                                                   </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128           }                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129           mConstance.isDownloading = false;                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130           mListener.onComplete();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132       } else {                                                                                           </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133         Log.i(TAG, &quot;下载任务完成&quot;);                                                                            </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134         mConstance.isDownloading = false;                                                                </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135         mListener.onComplete();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136       }                                                                                                  </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137     } catch (MalformedURLException e) {                                                                  </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     } catch (IOException e) {                                                                            </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141       mConstance.FAIL_NUM++;                                                                             </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142       failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,     </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143           e);                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144     } catch (Exception e) {                                                                              </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145       mConstance.FAIL_NUM++;                                                                             </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146       failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150   /**                                                                                                    </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151    * 停止下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152    */                                                                                                    </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153   protected void stop() {                                                                                </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155       try {                                                                                              </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157           mConstance.STOP_NUM++;                                                                         </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158           String location = String.valueOf(mChildCurrentLocation);                                       </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159           Log.d(TAG, &quot;thread_&quot;                                                                           </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160               + mConfigEntity.THREAD_ID                                                                  </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161               + &quot;_stop, stop location ==&gt; &quot;                                                              </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162               + mChildCurrentLocation);                                                                  </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163           writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,          </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164               location);                                                                                 </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165           if (mConstance.isStop()) {                                                                     </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166             Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167             mConstance.isDownloading = false;                                                            </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168             mListener.onStop(mConstance.CURRENT_LOCATION);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         } else {                                                                                         </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171           Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172           mConstance.isDownloading = false;                                                              </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173           mListener.onStop(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 178     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 179   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181   /**                                                                                                    </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182    * 下载中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183    */                                                                                                    </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184   private void progress(long len) {                                                                      </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185     synchronized (LOCK) {                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186       mChildCurrentLocation += len;                                                                      </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187       mConstance.CURRENT_LOCATION += len;                                                                </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-7214647733207450915" onmouseenter="enter('-7214647733207450915');" onmouseout="out('-7214647733207450915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189       //mHandler.sendEmptyMessage(1);                                                                    </span>
<span class="-5965669542619336697" onmouseenter="enter('-5965669542619336697');" onmouseout="out('-5965669542619336697');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190       //mHandler.post(t);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 191     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193                                                                                                          </span>
<span class="-265805331026522004" onmouseenter="enter('-265805331026522004');" onmouseout="out('-265805331026522004');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194   Handler mHandler = new Handler(Looper.getMainLooper()) {                                               </span>
<span class="-1427939510718485574" onmouseenter="enter('-1427939510718485574');" onmouseout="out('-1427939510718485574');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195     @Override public void handleMessage(Message msg) {                                                   </span>
<span class="631594066954408669" onmouseenter="enter('631594066954408669');" onmouseout="out('631594066954408669');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196       super.handleMessage(msg);                                                                          </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198     }                                                                                                    </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199   };                                                                                                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200                                                                                                          </span>
<span class="6162039791573929553" onmouseenter="enter('6162039791573929553');" onmouseout="out('6162039791573929553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201   Thread t = new Thread(new Runnable() {                                                                 </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 202     @Override public void run() {                                                                        </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 203       mListener.onProgress(mConstance.CURRENT_LOCATION);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 204     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 205   });                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 206                                                                                                          </span>
<span class="-3086691770564224506" onmouseenter="enter('-3086691770564224506');" onmouseout="out('-3086691770564224506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207   //Handler handler = new Handler(){                                                                     </span>
<span class="2764893303200817020" onmouseenter="enter('2764893303200817020');" onmouseout="out('2764893303200817020');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208   //  @Override public void handleMessage(Message msg) {                                                 </span>
<span class="1899026460107632807" onmouseenter="enter('1899026460107632807');" onmouseout="out('1899026460107632807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 209   //    super.handleMessage(msg);                                                                        </span>
<span class="-1683835654340753237" onmouseenter="enter('-1683835654340753237');" onmouseout="out('-1683835654340753237');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 210   //    mListener.onProgress(mConstance.CURRENT_LOCATION);                                               </span>
<span class="2740629830860486557" onmouseenter="enter('2740629830860486557');" onmouseout="out('2740629830860486557');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 211   //  }                                                                                                  </span>
<span class="1256134299569282437" onmouseenter="enter('1256134299569282437');" onmouseout="out('1256134299569282437');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 212   //};                                                                                                   </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 213                                                                                                          </span>
<span class="548404083425373257" onmouseenter="enter('548404083425373257');" onmouseout="out('548404083425373257');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 214   Thread thread = new Thread();                                                                          </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 216   /**                                                                                                    </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 217    * 取消下载                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218    */                                                                                                    </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 219   protected void cancel() {                                                                              </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220     synchronized (LOCK) {                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221       if (mConfigEntity.isSupportBreakpoint) {                                                           </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 222         mConstance.CANCEL_NUM++;                                                                         </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223         Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);               </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224         if (mConstance.isCancel()) {                                                                     </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225           File configFile = new File(mConfigFPath);                                                      </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226           if (configFile.exists()) {                                                                     </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227             configFile.delete();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228           }                                                                                              </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229           if (mConfigEntity.TEMP_FILE.exists()) {                                                        </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230             mConfigEntity.TEMP_FILE.delete();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 231           }                                                                                              </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 232           Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233           mConstance.isDownloading = false;                                                              </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234           mListener.onCancel();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236       } else {                                                                                           </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237         Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238         mConstance.isDownloading = false;                                                                </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239         mListener.onCancel();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 240       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 241     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 242   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 243                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 244   /**                                                                                                    </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 245    * 下载失败                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 246    */                                                                                                    </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 247   private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,         </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 248       Exception ex) {                                                                                    </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 249     synchronized (LOCK) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250       try {                                                                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 251         mConstance.isDownloading = false;                                                                </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 252         mConstance.isStop = true;                                                                        </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253         if (ex != null) {                                                                                </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254           Log.e(TAG, CommonUtil.getPrintException(ex));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255         }                                                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256         if (mConfigEntity.isSupportBreakpoint) {                                                         </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257           if (currentLocation != -1) {                                                                   </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258             String location = String.valueOf(currentLocation);                                           </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259             writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260           }                                                                                              </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 261           if (mConstance.isFail()) {                                                                     </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262             Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                     </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 263             mListener.onFail();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 264           }                                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265         } else {                                                                                         </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266           Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                       </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267           mListener.onFail();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268         }                                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269       } catch (IOException e) {                                                                          </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270         e.printStackTrace();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276    * 将记录写入到配置文件                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277    */                                                                                                    </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278   private void writeConfig(String key, String record) throws IOException {                               </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     File configFile = new File(mConfigFPath);                                                            </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280     Properties pro = CommonUtil.loadConfig(configFile);                                                  </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281     pro.setProperty(key, record);                                                                        </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282     CommonUtil.saveConfig(configFile, pro);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284 }                                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 285 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 286 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 286 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 287 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 289 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>























































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="">  16  package com.arialyy.aria.core.task;                                                                               </span>
<span  style="">  17                                                                                                                    </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  18 +import android.os.Handler;                                                                                        </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Looper;                                                                                         </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Message;                                                                                        </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  21  import android.util.Log;                                                                                          </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.util.BufferedRandomAccessFile;                                                            </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  23  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  24  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  25  import java.io.IOException;                                                                                       </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="">  26  import java.io.InputStream;                                                                                       </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="">  27  import java.io.RandomAccessFile;                                                                                  </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  28  import java.net.HttpURLConnection;                                                                                </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="">  29  import java.net.MalformedURLException;                                                                            </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  30  import java.net.URL;                                                                                              </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  31  import java.util.Properties;                                                                                      </span>
<span  style="">  32                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  33  /**                                                                                                               </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="">  34   * Created by lyy on 2017/1/18.                                                                                   </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="">  35   * 下载线程                                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  36   */                                                                                                               </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="">  37  final class SingleThreadTask implements Runnable {                                                                </span>
<span class="-652388901466714347" onmouseenter="enter('-652388901466714347');" onmouseout="out('-652388901466714347');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -  private static final String TAG = &quot;SingleThreadTask&quot;;                                                           </span>
<span class="1470163101604895715" onmouseenter="enter('1470163101604895715');" onmouseout="out('1470163101604895715');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +  private static final String TAG      = &quot;SingleThreadTask&quot;;                                                      </span>
<span class="-8208396912512818633" onmouseenter="enter('-8208396912512818633');" onmouseout="out('-8208396912512818633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +  // TODO: 2017/2/22 不能使用1024 否则最大速度不能超过3m                                                                        </span>
<span class="4974613412433293449" onmouseenter="enter('4974613412433293449');" onmouseout="out('4974613412433293449');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +  private static final int    BUF_SIZE = 8192;                                                                    </span>
<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="">  42    private DownloadUtil.ConfigEntity mConfigEntity;                                                                </span>
<span class="5711120372305423923" onmouseenter="enter('5711120372305423923');" onmouseout="out('5711120372305423923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -  private String mConfigFPath;                                                                                    </span>
<span class="-6399687529328161680" onmouseenter="enter('-6399687529328161680');" onmouseout="out('-6399687529328161680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -  private long mChildCurrentLocation = 0;                                                                         </span>
<span class="4753550627703968447" onmouseenter="enter('4753550627703968447');" onmouseout="out('4753550627703968447');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -  private static final Object LOCK = new Object();                                                                </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -  private IDownloadListener mListener;                                                                            </span>
<span class="-6303535447758153931" onmouseenter="enter('-6303535447758153931');" onmouseout="out('-6303535447758153931');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +  private String                    mConfigFPath;                                                                 </span>
<span class="-4775463327054883269" onmouseenter="enter('-4775463327054883269');" onmouseout="out('-4775463327054883269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +  private              long   mChildCurrentLocation = 0;                                                          </span>
<span class="-7584862654373756153" onmouseenter="enter('-7584862654373756153');" onmouseout="out('-7584862654373756153');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +  private static final Object LOCK                  = new Object();                                               </span>
<span class="330503413895455987" onmouseenter="enter('330503413895455987');" onmouseout="out('330503413895455987');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +  private IDownloadListener      mListener;                                                                       </span>
<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="">  51    private DownloadStateConstance mConstance;                                                                      </span>
<span  style="">  52                                                                                                                    </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="">  53    SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                                  </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="">  54        DownloadUtil.ConfigEntity downloadInfo) {                                                                   </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="">  55      mConstance = constance;                                                                                       </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  56      mListener = listener;                                                                                         </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="">  57      this.mConfigEntity = downloadInfo;                                                                            </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="">  58      if (mConfigEntity.isSupportBreakpoint) {                                                                      </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="">  59        mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61    }                                                                                                               </span>
<span  style="">  62                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  63    @Override public void run() {                                                                                   </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="">  64      HttpURLConnection conn = null;                                                                                </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="">  65      InputStream is = null;                                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  66      try {                                                                                                         </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="">  67        URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                              </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="">  68        //conn = (HttpURLConnection) url.openConnection();                                                          </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="">  69        conn = ConnectionHelp.handleConnection(url);                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="">  70        if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="">  71          Log.d(TAG, &quot;线程_&quot;                                                                                          </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="">  72              + mConfigEntity.THREAD_ID                                                                             </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="">  73              + &quot;_正在下载【开始位置 : &quot;                                                                                     </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="">  74              + mConfigEntity.START_LOCATION                                                                        </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="">  75              + &quot;，结束位置：&quot;                                                                                            </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="">  76              + mConfigEntity.END_LOCATION                                                                          </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="">  77              + &quot;】&quot;);                                                                                               </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="">  78          //在头里面请求下载开始位置和结束位置                                                                                       </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="">  79          conn.setRequestProperty(&quot;Range&quot;,                                                                          </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="">  80              &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  81        } else {                                                                                                    </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="">  82          Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83        }                                                                                                           </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="">  84        conn = ConnectionHelp.setConnectParam(conn);                                                                </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="">  85        conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                                        </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="">  86        conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                                        </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="">  87        is = conn.getInputStream();                                                                                 </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="">  88        //创建可设置位置的文件                                                                                                </span>
<span class="-8226142622422211895" onmouseenter="enter('-8226142622422211895');" onmouseout="out('-8226142622422211895');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -      RandomAccessFile file = new RandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;);                               </span>
<span class="9067034587548083002" onmouseenter="enter('9067034587548083002');" onmouseout="out('9067034587548083002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -      //设置每条线程写入文件的位置                                                                                             </span>
<span class="2674353001121820528" onmouseenter="enter('2674353001121820528');" onmouseout="out('2674353001121820528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +      BufferedRandomAccessFile file =                                                                             </span>
<span class="-2610417709527163720" onmouseenter="enter('-2610417709527163720');" onmouseout="out('-2610417709527163720');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +          new BufferedRandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;, BUF_SIZE);                                 </span>
<span class="-564508951971497574" onmouseenter="enter('-564508951971497574');" onmouseout="out('-564508951971497574');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +      //设置文件长度                                                                                                    </span>
<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="">  94        file.seek(mConfigEntity.START_LOCATION);                                                                    </span>
<span class="-6938993880531927464" onmouseenter="enter('-6938993880531927464');" onmouseout="out('-6938993880531927464');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -      byte[] buffer = new byte[1024];                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +                                                                                                                  </span>
<span class="5708157117841091962" onmouseenter="enter('5708157117841091962');" onmouseout="out('5708157117841091962');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +      byte[] buffer = new byte[BUF_SIZE];                                                                         </span>
<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="">  98        int len;                                                                                                    </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="">  99        //当前子线程的下载位置                                                                                                </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style=""> 100        mChildCurrentLocation = mConfigEntity.START_LOCATION;                                                       </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style=""> 101        while ((len = is.read(buffer)) != -1) {                                                                     </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style=""> 102          if (mConstance.isCancel) {                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 103            break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104          }                                                                                                         </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style=""> 105          if (mConstance.isStop) {                                                                                  </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style=""> 106            Log.i(TAG, &quot;stop&quot;);                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 107            break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108          }                                                                                                         </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style=""> 109          //把下载数据数据写入文件                                                                                             </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style=""> 110          file.write(buffer, 0, len);                                                                               </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style=""> 111          progress(len);                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112        }                                                                                                           </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style=""> 113        file.close();                                                                                               </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style=""> 114        //close 为阻塞的，需要使用线程池来处理                                                                                     </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style=""> 115        is.close();                                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style=""> 116        conn.disconnect();                                                                                          </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style=""> 117        if (mConstance.isCancel) {                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 118          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119        }                                                                                                           </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style=""> 120        //停止状态不需要删除记录文件                                                                                             </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style=""> 121        if (mConstance.isStop) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 122          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123        }                                                                                                           </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style=""> 124        //支持断点的处理                                                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style=""> 125        if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style=""> 126          Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                                    </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style=""> 127          writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,                      </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style=""> 128              1 + &quot;&quot;);                                                                                              </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style=""> 129          mListener.onChildComplete(mConfigEntity.END_LOCATION);                                                    </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style=""> 130          mConstance.COMPLETE_THREAD_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 131          if (mConstance.isComplete()) {                                                                            </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style=""> 132            File configFile = new File(mConfigFPath);                                                               </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style=""> 133            if (configFile.exists()) {                                                                              </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style=""> 134              configFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135            }                                                                                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 136            mConstance.isDownloading = false;                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 137            mListener.onComplete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138          }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 139        } else {                                                                                                    </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style=""> 140          Log.i(TAG, &quot;下载任务完成&quot;);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 141          mConstance.isDownloading = false;                                                                         </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 142          mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143        }                                                                                                           </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style=""> 144      } catch (MalformedURLException e) {                                                                           </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style=""> 145        mConstance.FAIL_NUM++;                                                                                      </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style=""> 146        failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 147      } catch (IOException e) {                                                                                     </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style=""> 148        mConstance.FAIL_NUM++;                                                                                      </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style=""> 149        failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,              </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style=""> 150            e);                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 151      } catch (Exception e) {                                                                                       </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style=""> 152        mConstance.FAIL_NUM++;                                                                                      </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style=""> 153        failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155    }                                                                                                               </span>
<span  style=""> 156                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 157    /**                                                                                                             </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style=""> 158     * 停止下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 159     */                                                                                                             </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style=""> 160    protected void stop() {                                                                                         </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style=""> 161      synchronized (LOCK) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 162        try {                                                                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style=""> 163          if (mConfigEntity.isSupportBreakpoint) {                                                                  </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 164            mConstance.STOP_NUM++;                                                                                  </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style=""> 165            String location = String.valueOf(mChildCurrentLocation);                                                </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style=""> 166            Log.d(TAG, &quot;thread_&quot;                                                                                    </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style=""> 167                + mConfigEntity.THREAD_ID                                                                           </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style=""> 168                + &quot;_stop, stop location ==&gt; &quot;                                                                       </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style=""> 169                + mChildCurrentLocation);                                                                           </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style=""> 170            writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,                   </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style=""> 171                location);                                                                                          </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style=""> 172            if (mConstance.isStop()) {                                                                              </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style=""> 173              Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 174              mConstance.isDownloading = false;                                                                     </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style=""> 175              mListener.onStop(mConstance.CURRENT_LOCATION);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176            }                                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 177          } else {                                                                                                  </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style=""> 178            Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                                </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 179            mConstance.isDownloading = false;                                                                       </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style=""> 180            mListener.onStop(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181          }                                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 182        } catch (IOException e) {                                                                                   </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 183          e.printStackTrace();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186    }                                                                                                               </span>
<span  style=""> 187                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 188    /**                                                                                                             </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style=""> 189     * 下载中                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 190     */                                                                                                             </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style=""> 191    private void progress(long len) {                                                                               </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style=""> 192      synchronized (LOCK) {                                                                                         </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style=""> 193        mChildCurrentLocation += len;                                                                               </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style=""> 194        mConstance.CURRENT_LOCATION += len;                                                                         </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 195        mListener.onProgress(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -  }                                                                                                               </span>
<span class="-7214647733207450915" onmouseenter="enter('-7214647733207450915');" onmouseout="out('-7214647733207450915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +      //mHandler.sendEmptyMessage(1);                                                                             </span>
<span class="-5965669542619336697" onmouseenter="enter('-5965669542619336697');" onmouseout="out('-5965669542619336697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +      //mHandler.post(t);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                                                                                                                  </span>
<span class="-265805331026522004" onmouseenter="enter('-265805331026522004');" onmouseout="out('-265805331026522004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +  Handler mHandler = new Handler(Looper.getMainLooper()) {                                                        </span>
<span class="-1427939510718485574" onmouseenter="enter('-1427939510718485574');" onmouseout="out('-1427939510718485574');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +    @Override public void handleMessage(Message msg) {                                                            </span>
<span class="631594066954408669" onmouseenter="enter('631594066954408669');" onmouseout="out('631594066954408669');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +      super.handleMessage(msg);                                                                                   </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 206 +      mListener.onProgress(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +    }                                                                                                             </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +  };                                                                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +                                                                                                                  </span>
<span class="6162039791573929553" onmouseenter="enter('6162039791573929553');" onmouseout="out('6162039791573929553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +  Thread t = new Thread(new Runnable() {                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +    @Override public void run() {                                                                                 </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +      mListener.onProgress(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +    }                                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +  });                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                                                                                                                  </span>
<span class="-3086691770564224506" onmouseenter="enter('-3086691770564224506');" onmouseout="out('-3086691770564224506');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +  //Handler handler = new Handler(){                                                                              </span>
<span class="2764893303200817020" onmouseenter="enter('2764893303200817020');" onmouseout="out('2764893303200817020');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +  //  @Override public void handleMessage(Message msg) {                                                          </span>
<span class="1899026460107632807" onmouseenter="enter('1899026460107632807');" onmouseout="out('1899026460107632807');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +  //    super.handleMessage(msg);                                                                                 </span>
<span class="-1683835654340753237" onmouseenter="enter('-1683835654340753237');" onmouseout="out('-1683835654340753237');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +  //    mListener.onProgress(mConstance.CURRENT_LOCATION);                                                        </span>
<span class="2740629830860486557" onmouseenter="enter('2740629830860486557');" onmouseout="out('2740629830860486557');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +  //  }                                                                                                           </span>
<span class="1256134299569282437" onmouseenter="enter('1256134299569282437');" onmouseout="out('1256134299569282437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +  //};                                                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                                                                                                                  </span>
<span class="548404083425373257" onmouseenter="enter('548404083425373257');" onmouseout="out('548404083425373257');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +  Thread thread = new Thread();                                                                                   </span>
<span  style=""> 224                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 225    /**                                                                                                             </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style=""> 226     * 取消下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 227     */                                                                                                             </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style=""> 228    protected void cancel() {                                                                                       </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style=""> 229      synchronized (LOCK) {                                                                                         </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style=""> 230        if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 231          mConstance.CANCEL_NUM++;                                                                                  </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style=""> 232          Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);                        </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style=""> 233          if (mConstance.isCancel()) {                                                                              </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style=""> 234            File configFile = new File(mConfigFPath);                                                               </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style=""> 235            if (configFile.exists()) {                                                                              </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style=""> 236              configFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237            }                                                                                                       </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style=""> 238            if (mConfigEntity.TEMP_FILE.exists()) {                                                                 </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style=""> 239              mConfigEntity.TEMP_FILE.delete();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240            }                                                                                                       </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style=""> 241            Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 242            mConstance.isDownloading = false;                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 243            mListener.onCancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244          }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 245        } else {                                                                                                    </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style=""> 246          Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                                </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 247          mConstance.isDownloading = false;                                                                         </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style=""> 248          mListener.onCancel();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251    }                                                                                                               </span>
<span  style=""> 252                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 253    /**                                                                                                             </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style=""> 254     * 下载失败                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 255     */                                                                                                             </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style=""> 256    private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,                  </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style=""> 257        Exception ex) {                                                                                             </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style=""> 258      synchronized (LOCK) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 259        try {                                                                                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style=""> 260          mConstance.isDownloading = false;                                                                         </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 261          mConstance.isStop = true;                                                                                 </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 262          if (ex != null) {                                                                                         </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style=""> 263            Log.e(TAG, CommonUtil.getPrintException(ex));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264          }                                                                                                         </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style=""> 265          if (mConfigEntity.isSupportBreakpoint) {                                                                  </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style=""> 266            if (currentLocation != -1) {                                                                            </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style=""> 267              String location = String.valueOf(currentLocation);                                                    </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style=""> 268              writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269            }                                                                                                       </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style=""> 270            if (mConstance.isFail()) {                                                                              </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style=""> 271              Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                              </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 272              mListener.onFail();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273            }                                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 274          } else {                                                                                                  </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style=""> 275            Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                                </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style=""> 276            mListener.onFail();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277          }                                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 278        } catch (IOException e) {                                                                                   </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 279          e.printStackTrace();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282    }                                                                                                               </span>
<span  style=""> 283                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 284    /**                                                                                                             </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 285     * 将记录写入到配置文件                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286     */                                                                                                             </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style=""> 287    private void writeConfig(String key, String record) throws IOException {                                        </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style=""> 288      File configFile = new File(mConfigFPath);                                                                     </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style=""> 289      Properties pro = CommonUtil.loadConfig(configFile);                                                           </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style=""> 290      pro.setProperty(key, record);                                                                                 </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style=""> 291      CommonUtil.saveConfig(configFile, pro);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   2 - * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   3 - *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   4 - * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   5 - * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   7 - *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   8 - *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  10 - * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  11 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  13 - * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  14 - * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  15 - */                                                                                                               </span>
<span class="-1768704711895145311" onmouseenter="enter('-1768704711895145311');" onmouseout="out('-1768704711895145311');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  16 -package com.arialyy.aria.core.task;                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  17 -                                                                                                                  </span>



<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  18 -import android.util.Log;                                                                                          </span>

<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import java.io.IOException;                                                                                       </span>
<span class="5631563232245871054" onmouseenter="enter('5631563232245871054');" onmouseout="out('5631563232245871054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import java.io.InputStream;                                                                                       </span>
<span class="-3877933607611446246" onmouseenter="enter('-3877933607611446246');" onmouseout="out('-3877933607611446246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import java.io.RandomAccessFile;                                                                                  </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import java.net.HttpURLConnection;                                                                                </span>
<span class="-1174886693236396621" onmouseenter="enter('-1174886693236396621');" onmouseout="out('-1174886693236396621');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import java.net.MalformedURLException;                                                                            </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import java.net.URL;                                                                                              </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import java.util.Properties;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -/**                                                                                                               </span>
<span class="-7765961215482575084" onmouseenter="enter('-7765961215482575084');" onmouseout="out('-7765961215482575084');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 - * Created by lyy on 2017/1/18.                                                                                   </span>
<span class="-3554269456611372941" onmouseenter="enter('-3554269456611372941');" onmouseout="out('-3554269456611372941');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 - * 下载线程                                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 - */                                                                                                               </span>
<span class="-8360678832300097967" onmouseenter="enter('-8360678832300097967');" onmouseout="out('-8360678832300097967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -final class SingleThreadTask implements Runnable {                                                                </span>
<span class="-652388901466714347" onmouseenter="enter('-652388901466714347');" onmouseout="out('-652388901466714347');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -  private static final String TAG = &quot;SingleThreadTask&quot;;                                                           </span>



<span class="-397551771063378344" onmouseenter="enter('-397551771063378344');" onmouseout="out('-397551771063378344');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -  private DownloadUtil.ConfigEntity mConfigEntity;                                                                </span>
<span class="5711120372305423923" onmouseenter="enter('5711120372305423923');" onmouseout="out('5711120372305423923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -  private String mConfigFPath;                                                                                    </span>
<span class="-6399687529328161680" onmouseenter="enter('-6399687529328161680');" onmouseout="out('-6399687529328161680');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -  private long mChildCurrentLocation = 0;                                                                         </span>
<span class="4753550627703968447" onmouseenter="enter('4753550627703968447');" onmouseout="out('4753550627703968447');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -  private static final Object LOCK = new Object();                                                                </span>
<span class="8085369704814778285" onmouseenter="enter('8085369704814778285');" onmouseout="out('8085369704814778285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -  private IDownloadListener mListener;                                                                            </span>




<span class="7070628333292412283" onmouseenter="enter('7070628333292412283');" onmouseout="out('7070628333292412283');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -  private DownloadStateConstance mConstance;                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -                                                                                                                  </span>
<span class="3312931446221493917" onmouseenter="enter('3312931446221493917');" onmouseout="out('3312931446221493917');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -  SingleThreadTask(DownloadStateConstance constance, IDownloadListener listener,                                  </span>
<span class="4563285781134859911" onmouseenter="enter('4563285781134859911');" onmouseout="out('4563285781134859911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -      DownloadUtil.ConfigEntity downloadInfo) {                                                                   </span>
<span class="3566983581481305406" onmouseenter="enter('3566983581481305406');" onmouseout="out('3566983581481305406');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -    mConstance = constance;                                                                                       </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -    mListener = listener;                                                                                         </span>
<span class="-1285485335208052941" onmouseenter="enter('-1285485335208052941');" onmouseout="out('-1285485335208052941');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -    this.mConfigEntity = downloadInfo;                                                                            </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -    if (mConfigEntity.isSupportBreakpoint) {                                                                      </span>
<span class="-5039803939476697557" onmouseenter="enter('-5039803939476697557');" onmouseout="out('-5039803939476697557');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -      mConfigFPath = downloadInfo.CONFIG_FILE_PATH;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -                                                                                                                  </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -  @Override public void run() {                                                                                   </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -    HttpURLConnection conn = null;                                                                                </span>
<span class="7188824888882858175" onmouseenter="enter('7188824888882858175');" onmouseout="out('7188824888882858175');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -    InputStream is = null;                                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -    try {                                                                                                         </span>
<span class="816935557391969782" onmouseenter="enter('816935557391969782');" onmouseout="out('816935557391969782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -      URL url = new URL(mConfigEntity.DOWNLOAD_URL);                                                              </span>
<span class="4937705470015508928" onmouseenter="enter('4937705470015508928');" onmouseout="out('4937705470015508928');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -      //conn = (HttpURLConnection) url.openConnection();                                                          </span>
<span class="2416147533931938115" onmouseenter="enter('2416147533931938115');" onmouseout="out('2416147533931938115');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -      conn = ConnectionHelp.handleConnection(url);                                                                </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -      if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="8764150366334549768" onmouseenter="enter('8764150366334549768');" onmouseout="out('8764150366334549768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -        Log.d(TAG, &quot;线程_&quot;                                                                                          </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -            + mConfigEntity.THREAD_ID                                                                             </span>
<span class="583975075544980646" onmouseenter="enter('583975075544980646');" onmouseout="out('583975075544980646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -            + &quot;_正在下载【开始位置 : &quot;                                                                                     </span>
<span class="4619538795603855664" onmouseenter="enter('4619538795603855664');" onmouseout="out('4619538795603855664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -            + mConfigEntity.START_LOCATION                                                                        </span>
<span class="1414052799773387521" onmouseenter="enter('1414052799773387521');" onmouseout="out('1414052799773387521');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -            + &quot;，结束位置：&quot;                                                                                            </span>
<span class="3629770269874290674" onmouseenter="enter('3629770269874290674');" onmouseout="out('3629770269874290674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -            + mConfigEntity.END_LOCATION                                                                          </span>
<span class="5293961668591776679" onmouseenter="enter('5293961668591776679');" onmouseout="out('5293961668591776679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -            + &quot;】&quot;);                                                                                               </span>
<span class="4723904053990122752" onmouseenter="enter('4723904053990122752');" onmouseout="out('4723904053990122752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -        //在头里面请求下载开始位置和结束位置                                                                                       </span>
<span class="6987365943658285925" onmouseenter="enter('6987365943658285925');" onmouseout="out('6987365943658285925');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -        conn.setRequestProperty(&quot;Range&quot;,                                                                          </span>
<span class="6547313668448593624" onmouseenter="enter('6547313668448593624');" onmouseout="out('6547313668448593624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -            &quot;bytes=&quot; + mConfigEntity.START_LOCATION + &quot;-&quot; + mConfigEntity.END_LOCATION);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -      } else {                                                                                                    </span>
<span class="-2151721794510105146" onmouseenter="enter('-2151721794510105146');" onmouseout="out('-2151721794510105146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -        Log.w(TAG, &quot;该下载不支持断点，即将重新下载&quot;);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -      }                                                                                                           </span>
<span class="2062133901627510982" onmouseenter="enter('2062133901627510982');" onmouseout="out('2062133901627510982');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -      conn = ConnectionHelp.setConnectParam(conn);                                                                </span>
<span class="3204270820120486432" onmouseenter="enter('3204270820120486432');" onmouseout="out('3204270820120486432');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -      conn.setConnectTimeout(mConstance.CONNECT_TIME_OUT);                                                        </span>
<span class="7044538571262162068" onmouseenter="enter('7044538571262162068');" onmouseout="out('7044538571262162068');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -      conn.setReadTimeout(mConstance.READ_TIME_OUT);  //设置读取流的等待时间,必须设置该参数                                        </span>
<span class="5793775624822468820" onmouseenter="enter('5793775624822468820');" onmouseout="out('5793775624822468820');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -      is = conn.getInputStream();                                                                                 </span>
<span class="6008792529703335941" onmouseenter="enter('6008792529703335941');" onmouseout="out('6008792529703335941');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -      //创建可设置位置的文件                                                                                                </span>
<span class="-8226142622422211895" onmouseenter="enter('-8226142622422211895');" onmouseout="out('-8226142622422211895');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -      RandomAccessFile file = new RandomAccessFile(mConfigEntity.TEMP_FILE, &quot;rwd&quot;);                               </span>
<span class="9067034587548083002" onmouseenter="enter('9067034587548083002');" onmouseout="out('9067034587548083002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -      //设置每条线程写入文件的位置                                                                                             </span>



<span class="-7076309416241955665" onmouseenter="enter('-7076309416241955665');" onmouseout="out('-7076309416241955665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -      file.seek(mConfigEntity.START_LOCATION);                                                                    </span>
<span class="-6938993880531927464" onmouseenter="enter('-6938993880531927464');" onmouseout="out('-6938993880531927464');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -      byte[] buffer = new byte[1024];                                                                             </span>


<span class="-7903416535408841722" onmouseenter="enter('-7903416535408841722');" onmouseout="out('-7903416535408841722');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -      int len;                                                                                                    </span>
<span class="3138455259752569647" onmouseenter="enter('3138455259752569647');" onmouseout="out('3138455259752569647');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -      //当前子线程的下载位置                                                                                                </span>
<span class="-4788879635620405633" onmouseenter="enter('-4788879635620405633');" onmouseout="out('-4788879635620405633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -      mChildCurrentLocation = mConfigEntity.START_LOCATION;                                                       </span>
<span class="5842484437643368684" onmouseenter="enter('5842484437643368684');" onmouseout="out('5842484437643368684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -      while ((len = is.read(buffer)) != -1) {                                                                     </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -        if (mConstance.isCancel) {                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -          break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -        }                                                                                                         </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -        if (mConstance.isStop) {                                                                                  </span>
<span class="665315701494837831" onmouseenter="enter('665315701494837831');" onmouseout="out('665315701494837831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -          Log.i(TAG, &quot;stop&quot;);                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -          break;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        }                                                                                                         </span>
<span class="7798962991815049328" onmouseenter="enter('7798962991815049328');" onmouseout="out('7798962991815049328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -        //把下载数据数据写入文件                                                                                             </span>
<span class="-4129797627510689978" onmouseenter="enter('-4129797627510689978');" onmouseout="out('-4129797627510689978');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -        file.write(buffer, 0, len);                                                                               </span>
<span class="8473656345309576423" onmouseenter="enter('8473656345309576423');" onmouseout="out('8473656345309576423');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -        progress(len);                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -      }                                                                                                           </span>
<span class="1889599257633295839" onmouseenter="enter('1889599257633295839');" onmouseout="out('1889599257633295839');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -      file.close();                                                                                               </span>
<span class="7455183510817002712" onmouseenter="enter('7455183510817002712');" onmouseout="out('7455183510817002712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -      //close 为阻塞的，需要使用线程池来处理                                                                                     </span>
<span class="3040061483633451140" onmouseenter="enter('3040061483633451140');" onmouseout="out('3040061483633451140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -      is.close();                                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -      conn.disconnect();                                                                                          </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -      if (mConstance.isCancel) {                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -      }                                                                                                           </span>
<span class="7978760431128663882" onmouseenter="enter('7978760431128663882');" onmouseout="out('7978760431128663882');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -      //停止状态不需要删除记录文件                                                                                             </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -      if (mConstance.isStop) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -      }                                                                                                           </span>
<span class="266087097310221191" onmouseenter="enter('266087097310221191');" onmouseout="out('266087097310221191');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -      //支持断点的处理                                                                                                   </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -      if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="5464233522206347984" onmouseenter="enter('5464233522206347984');" onmouseout="out('5464233522206347984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -        Log.i(TAG, &quot;线程【&quot; + mConfigEntity.THREAD_ID + &quot;】下载完毕&quot;);                                                    </span>
<span class="7074204752059887931" onmouseenter="enter('7074204752059887931');" onmouseout="out('7074204752059887931');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -        writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_state_&quot; + mConfigEntity.THREAD_ID,                      </span>
<span class="1867438172260348529" onmouseenter="enter('1867438172260348529');" onmouseout="out('1867438172260348529');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -            1 + &quot;&quot;);                                                                                              </span>
<span class="-3761251283525442118" onmouseenter="enter('-3761251283525442118');" onmouseout="out('-3761251283525442118');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -        mListener.onChildComplete(mConfigEntity.END_LOCATION);                                                    </span>
<span class="-337774801975969950" onmouseenter="enter('-337774801975969950');" onmouseout="out('-337774801975969950');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -        mConstance.COMPLETE_THREAD_NUM++;                                                                         </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -        if (mConstance.isComplete()) {                                                                            </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -          File configFile = new File(mConfigFPath);                                                               </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -          if (configFile.exists()) {                                                                              </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -            configFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -          }                                                                                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -          mConstance.isDownloading = false;                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -          mListener.onComplete();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -      } else {                                                                                                    </span>
<span class="-8368401679920527752" onmouseenter="enter('-8368401679920527752');" onmouseout="out('-8368401679920527752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -        Log.i(TAG, &quot;下载任务完成&quot;);                                                                                     </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -        mConstance.isDownloading = false;                                                                         </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -        mListener.onComplete();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -      }                                                                                                           </span>
<span class="-2378851849123394425" onmouseenter="enter('-2378851849123394425');" onmouseout="out('-2378851849123394425');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -    } catch (MalformedURLException e) {                                                                           </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -      mConstance.FAIL_NUM++;                                                                                      </span>
<span class="-7358878949154829627" onmouseenter="enter('-7358878949154829627');" onmouseout="out('-7358878949154829627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -      failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载链接异常&quot;, e);                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -    } catch (IOException e) {                                                                                     </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -      mConstance.FAIL_NUM++;                                                                                      </span>
<span class="-6875922028586607088" onmouseenter="enter('-6875922028586607088');" onmouseout="out('-6875922028586607088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -      failDownload(mConfigEntity, mChildCurrentLocation, &quot;下载失败【&quot; + mConfigEntity.DOWNLOAD_URL + &quot;】&quot;,              </span>
<span class="3570386608421457326" onmouseenter="enter('3570386608421457326');" onmouseout="out('3570386608421457326');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -          e);                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -    } catch (Exception e) {                                                                                       </span>
<span class="-8453043176550445318" onmouseenter="enter('-8453043176550445318');" onmouseout="out('-8453043176550445318');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -      mConstance.FAIL_NUM++;                                                                                      </span>
<span class="1879361776557062140" onmouseenter="enter('1879361776557062140');" onmouseout="out('1879361776557062140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -      failDownload(mConfigEntity, mChildCurrentLocation, &quot;获取流失败&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -  /**                                                                                                             </span>
<span class="7755328866638560569" onmouseenter="enter('7755328866638560569');" onmouseout="out('7755328866638560569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -   * 停止下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -   */                                                                                                             </span>
<span class="-6109623269633229152" onmouseenter="enter('-6109623269633229152');" onmouseout="out('-6109623269633229152');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -  protected void stop() {                                                                                         </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -    synchronized (LOCK) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -      try {                                                                                                       </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -        if (mConfigEntity.isSupportBreakpoint) {                                                                  </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -          mConstance.STOP_NUM++;                                                                                  </span>
<span class="-2188152939818168356" onmouseenter="enter('-2188152939818168356');" onmouseout="out('-2188152939818168356');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -          String location = String.valueOf(mChildCurrentLocation);                                                </span>
<span class="3390577158668237010" onmouseenter="enter('3390577158668237010');" onmouseout="out('3390577158668237010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -          Log.d(TAG, &quot;thread_&quot;                                                                                    </span>
<span class="7494026576600939520" onmouseenter="enter('7494026576600939520');" onmouseout="out('7494026576600939520');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -              + mConfigEntity.THREAD_ID                                                                           </span>
<span class="-5949892276544715857" onmouseenter="enter('-5949892276544715857');" onmouseout="out('-5949892276544715857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -              + &quot;_stop, stop location ==&gt; &quot;                                                                       </span>
<span class="4908663763400924313" onmouseenter="enter('4908663763400924313');" onmouseout="out('4908663763400924313');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -              + mChildCurrentLocation);                                                                           </span>
<span class="-9164700786061409483" onmouseenter="enter('-9164700786061409483');" onmouseout="out('-9164700786061409483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -          writeConfig(mConfigEntity.TEMP_FILE.getName() + &quot;_record_&quot; + mConfigEntity.THREAD_ID,                   </span>
<span class="1289395260926210278" onmouseenter="enter('1289395260926210278');" onmouseout="out('1289395260926210278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -              location);                                                                                          </span>
<span class="9141431509258210267" onmouseenter="enter('9141431509258210267');" onmouseout="out('9141431509258210267');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -          if (mConstance.isStop()) {                                                                              </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -            Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -            mConstance.isDownloading = false;                                                                     </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -            mListener.onStop(mConstance.CURRENT_LOCATION);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -          }                                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -        } else {                                                                                                  </span>
<span class="-8279550611123347337" onmouseenter="enter('-8279550611123347337');" onmouseout="out('-8279550611123347337');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -          Log.d(TAG, &quot;++++++++++++++++ onStop +++++++++++++++++&quot;);                                                </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -          mConstance.isDownloading = false;                                                                       </span>
<span class="-5079066552547844832" onmouseenter="enter('-5079066552547844832');" onmouseout="out('-5079066552547844832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -          mListener.onStop(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -        }                                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -      } catch (IOException e) {                                                                                   </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -        e.printStackTrace();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -  /**                                                                                                             </span>
<span class="7866565969200819017" onmouseenter="enter('7866565969200819017');" onmouseout="out('7866565969200819017');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -   * 下载中                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -   */                                                                                                             </span>
<span class="-6470630405301830235" onmouseenter="enter('-6470630405301830235');" onmouseout="out('-6470630405301830235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -  private void progress(long len) {                                                                               </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -    synchronized (LOCK) {                                                                                         </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -      mChildCurrentLocation += len;                                                                               </span>
<span class="1713351000491228849" onmouseenter="enter('1713351000491228849');" onmouseout="out('1713351000491228849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -      mConstance.CURRENT_LOCATION += len;                                                                         </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -      mListener.onProgress(mConstance.CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -  }                                                                                                               </span>


























<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -  /**                                                                                                             </span>
<span class="8520049766391668792" onmouseenter="enter('8520049766391668792');" onmouseout="out('8520049766391668792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -   * 取消下载                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -   */                                                                                                             </span>
<span class="-5090873953521436391" onmouseenter="enter('-5090873953521436391');" onmouseout="out('-5090873953521436391');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -  protected void cancel() {                                                                                       </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -    synchronized (LOCK) {                                                                                         </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -      if (mConfigEntity.isSupportBreakpoint) {                                                                    </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -        mConstance.CANCEL_NUM++;                                                                                  </span>
<span class="-5117462905067450123" onmouseenter="enter('-5117462905067450123');" onmouseout="out('-5117462905067450123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -        Log.d(TAG, &quot;++++++++++ thread_&quot; + mConfigEntity.THREAD_ID + &quot;_cancel ++++++++++&quot;);                        </span>
<span class="3680447163888194506" onmouseenter="enter('3680447163888194506');" onmouseout="out('3680447163888194506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -        if (mConstance.isCancel()) {                                                                              </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -          File configFile = new File(mConfigFPath);                                                               </span>
<span class="4644102897066041763" onmouseenter="enter('4644102897066041763');" onmouseout="out('4644102897066041763');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -          if (configFile.exists()) {                                                                              </span>
<span class="4322651730015769388" onmouseenter="enter('4322651730015769388');" onmouseout="out('4322651730015769388');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -            configFile.delete();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -          }                                                                                                       </span>
<span class="-8883635698551977578" onmouseenter="enter('-8883635698551977578');" onmouseout="out('-8883635698551977578');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -          if (mConfigEntity.TEMP_FILE.exists()) {                                                                 </span>
<span class="7430639987987438272" onmouseenter="enter('7430639987987438272');" onmouseout="out('7430639987987438272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -            mConfigEntity.TEMP_FILE.delete();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -          }                                                                                                       </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -          Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                              </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -          mConstance.isDownloading = false;                                                                       </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -          mListener.onCancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -      } else {                                                                                                    </span>
<span class="-393909137067808426" onmouseenter="enter('-393909137067808426');" onmouseout="out('-393909137067808426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -        Log.d(TAG, &quot;++++++++++++++++ onCancel +++++++++++++++++&quot;);                                                </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -        mConstance.isDownloading = false;                                                                         </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -        mListener.onCancel();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -  /**                                                                                                             </span>
<span class="2920117999023933300" onmouseenter="enter('2920117999023933300');" onmouseout="out('2920117999023933300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -   * 下载失败                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -   */                                                                                                             </span>
<span class="6697221446723939771" onmouseenter="enter('6697221446723939771');" onmouseout="out('6697221446723939771');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -  private void failDownload(DownloadUtil.ConfigEntity dEntity, long currentLocation, String msg,                  </span>
<span class="5645489074987864032" onmouseenter="enter('5645489074987864032');" onmouseout="out('5645489074987864032');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -      Exception ex) {                                                                                             </span>
<span class="-889825015365812481" onmouseenter="enter('-889825015365812481');" onmouseout="out('-889825015365812481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -    synchronized (LOCK) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 217 -      try {                                                                                                       </span>
<span class="5532514216383183890" onmouseenter="enter('5532514216383183890');" onmouseout="out('5532514216383183890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -        mConstance.isDownloading = false;                                                                         </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 219 -        mConstance.isStop = true;                                                                                 </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -        if (ex != null) {                                                                                         </span>
<span class="-3018458756283500494" onmouseenter="enter('-3018458756283500494');" onmouseout="out('-3018458756283500494');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 221 -          Log.e(TAG, CommonUtil.getPrintException(ex));                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -        }                                                                                                         </span>
<span class="-3660174199881799539" onmouseenter="enter('-3660174199881799539');" onmouseout="out('-3660174199881799539');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -        if (mConfigEntity.isSupportBreakpoint) {                                                                  </span>
<span class="-4990659299325509163" onmouseenter="enter('-4990659299325509163');" onmouseout="out('-4990659299325509163');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -          if (currentLocation != -1) {                                                                            </span>
<span class="-6424384084608841951" onmouseenter="enter('-6424384084608841951');" onmouseout="out('-6424384084608841951');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -            String location = String.valueOf(currentLocation);                                                    </span>
<span class="1765504094967316685" onmouseenter="enter('1765504094967316685');" onmouseout="out('1765504094967316685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -            writeConfig(dEntity.TEMP_FILE.getName() + &quot;_record_&quot; + dEntity.THREAD_ID, location);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -          }                                                                                                       </span>
<span class="-6546059360587161903" onmouseenter="enter('-6546059360587161903');" onmouseout="out('-6546059360587161903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -          if (mConstance.isFail()) {                                                                              </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -            Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                              </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -            mListener.onFail();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 231 -          }                                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 232 -        } else {                                                                                                  </span>
<span class="8427211351660429154" onmouseenter="enter('8427211351660429154');" onmouseout="out('8427211351660429154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -          Log.d(TAG, &quot;++++++++++++++++ onFail +++++++++++++++++&quot;);                                                </span>
<span class="2561797712113071733" onmouseenter="enter('2561797712113071733');" onmouseout="out('2561797712113071733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -          mListener.onFail();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -        }                                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 236 -      } catch (IOException e) {                                                                                   </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -        e.printStackTrace();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 241 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -  /**                                                                                                             </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -   * 将记录写入到配置文件                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 244 -   */                                                                                                             </span>
<span class="7358027807632572879" onmouseenter="enter('7358027807632572879');" onmouseout="out('7358027807632572879');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 245 -  private void writeConfig(String key, String record) throws IOException {                                        </span>
<span class="-1577345122608602685" onmouseenter="enter('-1577345122608602685');" onmouseout="out('-1577345122608602685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -    File configFile = new File(mConfigFPath);                                                                     </span>
<span class="115828992914752190" onmouseenter="enter('115828992914752190');" onmouseout="out('115828992914752190');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 247 -    Properties pro = CommonUtil.loadConfig(configFile);                                                           </span>
<span class="-6017476066585833064" onmouseenter="enter('-6017476066585833064');" onmouseout="out('-6017476066585833064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 248 -    pro.setProperty(key, record);                                                                                 </span>
<span class="-3337375674950754379" onmouseenter="enter('-3337375674950754379');" onmouseout="out('-3337375674950754379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 249 -    CommonUtil.saveConfig(configFile, pro);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 250 -  }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 251 -}                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            