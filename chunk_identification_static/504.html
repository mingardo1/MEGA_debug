<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>504</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    504
                    <a href="503.html">prev</a>
                    <a href="505.html">next</a>
                    <a href="504_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_fb6068711e9082e8c3732bafbba78c750536283d_src/com/android/launcher3/LauncherBackupHelper.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;fb6068711e9082e8c3732bafbba78c750536283d:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;fb6068711e9082e8c3732bafbba78c750536283d^1:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;fb6068711e9082e8c3732bafbba78c750536283d^2:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;daac9736e82aa1c14e11841d602338de20669727:src/com/android/launcher3/LauncherBackupHelper.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [bj], [s], [s]], subset: [[bj], [bsj], [s]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  18 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  19 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  20                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  21 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  22 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  23 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  24 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  25 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  26 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  27 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  28 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  29 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  30 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  31 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  32 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span  style="">  33                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  34 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  35 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  36 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  37 import android.app.backup.BackupManager;                                                                 </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="">  38 import android.appwidget.AppWidgetManager;                                                               </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">  39 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  40 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  41 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  42 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  43 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  44 import android.content.Intent;                                                                           </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  45 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  46 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  47 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  48 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  49 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  50 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  51 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  52 import android.util.Log;                                                                                 </span>
<span  style="">  53                                                                                                          </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  54 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  55 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  56 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  57 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  58 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  60 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  61 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  62 import java.util.List;                                                                                   </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  63 import java.util.Set;                                                                                    </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  64 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  65                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  66 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  67  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  68  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  69 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span  style="">  70                                                                                                          </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  71     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  72     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  73     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span class="8681536538150810745" onmouseenter="enter('8681536538150810745');" onmouseout="out('8681536538150810745');" style="">  74     private static final boolean DEBUG_PAYLOAD = false;                                                  </span>
<span  style="">  75                                                                                                          </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  76     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  77                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  78     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  79     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  81     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  82     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  83                                                                                                          </span>
<span class="-9115528851843838744" onmouseenter="enter('-9115528851843838744');" onmouseout="out('-9115528851843838744');" style="">  84     public static final int IMAGE_COMPRESSION_QUALITY = 75;                                              </span>
<span  style="">  85                                                                                                          </span>
<span class="-3087488215496878471" onmouseenter="enter('-3087488215496878471');" onmouseout="out('-3087488215496878471');" style="">  86     public static final String LAUNCHER_PREFIX = &quot;L&quot;;                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="-1120390505463346401" onmouseenter="enter('-1120390505463346401');" onmouseout="out('-1120390505463346401');" style="">  88     public static final String LAUNCHER_PREFS_PREFIX = &quot;LP&quot;;                                             </span>
<span  style="">  89                                                                                                          </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  90     private static final Bitmap.CompressFormat IMAGE_FORMAT =                                            </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  91             android.graphics.Bitmap.CompressFormat.PNG;                                                  </span>
<span  style="">  92                                                                                                          </span>
<span class="-6320109508039674215" onmouseenter="enter('-6320109508039674215');" onmouseout="out('-6320109508039674215');" style="">  93     private static BackupManager sBackupManager;                                                         </span>
<span  style="">  94                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  95     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  96             Favorites._ID,                     // 0                                                      </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  97             Favorites.MODIFIED,                // 1                                                      </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  98             Favorites.INTENT,                  // 2                                                      </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  99             Favorites.APPWIDGET_PROVIDER,      // 3                                                      </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style=""> 100             Favorites.APPWIDGET_ID,            // 4                                                      </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style=""> 101             Favorites.CELLX,                   // 5                                                      </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 102             Favorites.CELLY,                   // 6                                                      </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 103             Favorites.CONTAINER,               // 7                                                      </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 104             Favorites.ICON,                    // 8                                                      </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 105             Favorites.ICON_PACKAGE,            // 9                                                      </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 106             Favorites.ICON_RESOURCE,           // 10                                                     </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 107             Favorites.ICON_TYPE,               // 11                                                     </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 108             Favorites.ITEM_TYPE,               // 12                                                     </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 109             Favorites.SCREEN,                  // 13                                                     </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 110             Favorites.SPANX,                   // 14                                                     </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 111             Favorites.SPANY,                   // 15                                                     </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 112             Favorites.TITLE,                   // 16                                                     </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 113             Favorites.PROFILE_ID,              // 17                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 114     };                                                                                                   </span>
<span  style=""> 115                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 116     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 117     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 118     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 119     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 120     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 121     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 122     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 123     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 124     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 125     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 126     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 127     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 128     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 129     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 130     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 131     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 132     private static final int TITLE_INDEX = 16;                                                           </span>
<span class="-3666133504327950845" onmouseenter="enter('-3666133504327950845');" onmouseout="out('-3666133504327950845');" style=""> 133     private static final int PROFILE_ID_INDEX = 17;                                                      </span>
<span  style=""> 134                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 135     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 136             WorkspaceScreens._ID,              // 0                                                      </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 137             WorkspaceScreens.MODIFIED,         // 1                                                      </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 138             WorkspaceScreens.SCREEN_RANK       // 2                                                      </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 139     };                                                                                                   </span>
<span  style=""> 140                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 141     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 142                                                                                                          </span>
<span class="1370853386149545885" onmouseenter="enter('1370853386149545885');" onmouseout="out('1370853386149545885');" style=""> 143     private static IconCache mIconCache;                                                                 </span>
<span  style=""> 144                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 145     private final Context mContext;                                                                      </span>
<span  style=""> 146                                                                                                          </span>
<span class="-8743166978913928813" onmouseenter="enter('-8743166978913928813');" onmouseout="out('-8743166978913928813');" style=""> 147     private final boolean mRestoreEnabled;                                                               </span>
<span  style=""> 148                                                                                                          </span>
<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style=""> 149     private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                    </span>
<span  style=""> 150                                                                                                          </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 151     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span  style=""> 152                                                                                                          </span>
<span class="2664402437757712713" onmouseenter="enter('2664402437757712713');" onmouseout="out('2664402437757712713');" style=""> 153     public LauncherBackupHelper(Context context, boolean restoreEnabled) {                               </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 154         mContext = context;                                                                              </span>
<span class="3162096380580590348" onmouseenter="enter('3162096380580590348');" onmouseout="out('3162096380580590348');" style=""> 155         mRestoreEnabled = restoreEnabled;                                                                </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 156         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157     }                                                                                                    </span>
<span  style=""> 158                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 159     private void dataChanged() {                                                                         </span>
<span class="-6280593186860143288" onmouseenter="enter('-6280593186860143288');" onmouseout="out('-6280593186860143288');" style=""> 160         if (sBackupManager == null) {                                                                    </span>
<span class="-1682111607995772618" onmouseenter="enter('-1682111607995772618');" onmouseout="out('-1682111607995772618');" style=""> 161             sBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-8519501381186315635" onmouseenter="enter('-8519501381186315635');" onmouseout="out('-8519501381186315635');" style=""> 163         sBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 167      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 168      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 169      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 170      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 171      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 172      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 173      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 174      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 175      * @param newState notes for the next backup                                                         </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 176      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 177      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 178     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 179     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 180             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 181         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 182                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 183         Journal in = readJournal(oldState);                                                              </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 184         Journal out = new Journal();                                                                     </span>
<span  style=""> 185                                                                                                          </span>
<span class="-3253084867092672816" onmouseenter="enter('-3253084867092672816');" onmouseout="out('-3253084867092672816');" style=""> 186         long lastBackupTime = in.t;                                                                      </span>
<span class="8932370774979500270" onmouseenter="enter('8932370774979500270');" onmouseout="out('8932370774979500270');" style=""> 187         out.t = System.currentTimeMillis();                                                              </span>
<span class="-1600347970264493336" onmouseenter="enter('-1600347970264493336');" onmouseout="out('-1600347970264493336');" style=""> 188         out.rows = 0;                                                                                    </span>
<span class="2725575623770373107" onmouseenter="enter('2725575623770373107');" onmouseout="out('2725575623770373107');" style=""> 189         out.bytes = 0;                                                                                   </span>
<span  style=""> 190                                                                                                          </span>
<span class="-8521392564577701566" onmouseenter="enter('-8521392564577701566');" onmouseout="out('-8521392564577701566');" style=""> 191         Log.v(TAG, &quot;lastBackupTime = &quot; + lastBackupTime);                                                </span>
<span  style=""> 192                                                                                                          </span>
<span class="4700072589631005259" onmouseenter="enter('4700072589631005259');" onmouseout="out('4700072589631005259');" style=""> 193         ArrayList&lt;Key&gt; keys = new ArrayList&lt;Key&gt;();                                                      </span>
<span class="903881481365121859" onmouseenter="enter('903881481365121859');" onmouseout="out('903881481365121859');" style=""> 194         if (launcherIsReady()) {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 195             try {                                                                                        </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style=""> 196                 backupFavorites(in, data, out, keys);                                                    </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style=""> 197                 backupScreens(in, data, out, keys);                                                      </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style=""> 198                 backupIcons(in, data, out, keys);                                                        </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style=""> 199                 backupWidgets(in, data, out, keys);                                                      </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 200             } catch (IOException e) {                                                                    </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 201                 Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span class="-3926881627572885151" onmouseenter="enter('-3926881627572885151');" onmouseout="out('-3926881627572885151');" style=""> 203             out.key = keys.toArray(new BackupProtos.Key[keys.size()]);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 204         } else {                                                                                         </span>
<span class="-3169554028816730380" onmouseenter="enter('-3169554028816730380');" onmouseout="out('-3169554028816730380');" style=""> 205             out = in;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 208 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 209 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-6592699891127791070" onmouseenter="enter('-6592699891127791070');" onmouseout="out('-6592699891127791070');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210         out.key = keys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                            </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         writeJournal(newState, out);                                                                     </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217      *                                                                                                   </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218      * &lt;P&gt;Keys may arrive in any order.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="273471296519358434" onmouseenter="enter('273471296519358434');" onmouseout="out('273471296519358434');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224         Log.v(TAG, &quot;restoreEntity&quot;);                                                                     </span>
<span class="5593645157390984354" onmouseenter="enter('5593645157390984354');" onmouseout="out('5593645157390984354');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225         if (mKeys == null) {                                                                             </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226             mKeys = new ArrayList&lt;Key&gt;();                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 227 =======                                                                                                  </span>
<span class="-2322857033322689801" onmouseenter="enter('-2322857033322689801');" onmouseout="out('-2322857033322689801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         out.key = keys.toArray(BackupProtos.Key.emptyArray());                                           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 229 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 230         writeJournal(newState, out);                                                                     </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style=""> 231         Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 234     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 235      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 236      *                                                                                                   </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style=""> 237      * &lt;P&gt;Keys may arrive in any order.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 238      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 239      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 240      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 241     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 242     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="6512574494365423863" onmouseenter="enter('6512574494365423863');" onmouseout="out('6512574494365423863');" style=""> 243         if (VERBOSE) Log.v(TAG, &quot;restoreEntity&quot;);                                                        </span>
<span class="-3135534305680812023" onmouseenter="enter('-3135534305680812023');" onmouseout="out('-3135534305680812023');" style=""> 244         byte[] buffer = new byte[512];                                                                   </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 245             String backupKey = data.getKey();                                                            </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 246             int dataSize = data.size();                                                                  </span>
<span class="2382724363113702568" onmouseenter="enter('2382724363113702568');" onmouseout="out('2382724363113702568');" style=""> 247             if (buffer.length &lt; dataSize) {                                                              </span>
<span class="8352923365759736689" onmouseenter="enter('8352923365759736689');" onmouseout="out('8352923365759736689');" style=""> 248                 buffer = new byte[dataSize];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249             }                                                                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 250             Key key = null;                                                                              </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 251         int bytesRead = 0;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 252         try {                                                                                            </span>
<span class="-6009766373469064808" onmouseenter="enter('-6009766373469064808');" onmouseout="out('-6009766373469064808');" style=""> 253             bytesRead = data.read(buffer, 0, dataSize);                                                  </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 254             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 255         } catch (IOException e) {                                                                        </span>
<span class="-1433318685117734483" onmouseenter="enter('-1433318685117734483');" onmouseout="out('-1433318685117734483');" style=""> 256             Log.e(TAG, &quot;failed to read entity from restore data&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 258         try {                                                                                            </span>
<span class="-3712536663698109807" onmouseenter="enter('-3712536663698109807');" onmouseout="out('-3712536663698109807');" style=""> 259             key = backupKeyToKey(backupKey);                                                             </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 260             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 261             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 262                 case Key.FAVORITE:                                                                       </span>
<span class="-8176296956220002371" onmouseenter="enter('-8176296956220002371');" onmouseout="out('-8176296956220002371');" style=""> 263                     restoreFavorite(key, buffer, dataSize, mKeys);                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 264                     break;                                                                               </span>
<span  style=""> 265                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 266                 case Key.SCREEN:                                                                         </span>
<span class="-2747327735226535589" onmouseenter="enter('-2747327735226535589');" onmouseout="out('-2747327735226535589');" style=""> 267                     restoreScreen(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 268                     break;                                                                               </span>
<span  style=""> 269                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 270                 case Key.ICON:                                                                           </span>
<span class="-5346432636907736484" onmouseenter="enter('-5346432636907736484');" onmouseout="out('-5346432636907736484');" style=""> 271                     restoreIcon(key, buffer, dataSize, mKeys);                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 272                     break;                                                                               </span>
<span  style=""> 273                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 274                 case Key.WIDGET:                                                                         </span>
<span class="-7791331080833002730" onmouseenter="enter('-7791331080833002730');" onmouseout="out('-7791331080833002730');" style=""> 275                     restoreWidget(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 276                     break;                                                                               </span>
<span  style=""> 277                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 278                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 279                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 280                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281             }                                                                                            </span>
<span class="2253361419748107399" onmouseenter="enter('2253361419748107399');" onmouseout="out('2253361419748107399');" style=""> 282         } catch (KeyParsingException e) {                                                                </span>
<span class="-562496230350101976" onmouseenter="enter('-562496230350101976');" onmouseout="out('-562496230350101976');" style=""> 283             Log.w(TAG, &quot;ignoring unparsable backup key: &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284         }                                                                                                </span>
<span  style=""> 285                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 288     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 289      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 290      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 291      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 292      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 293     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 294     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style=""> 295         // clear the output journal time, to force a full backup to                                      </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style=""> 296         // will catch any changes the restore process might have made                                    </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 297         Journal out = new Journal();                                                                     </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style=""> 298         out.t = 0;                                                                                       </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 299 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1416391524744539097" onmouseenter="enter('-1416391524744539097');" onmouseout="out('-1416391524744539097');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 300         out.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                     </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 301 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4763841258929064204" onmouseenter="enter('4763841258929064204');" onmouseout="out('4763841258929064204');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302         out.key = mKeys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                           </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303         writeJournal(newState, out);                                                                     </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304         Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                         </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305         mKeys.clear();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316      * @throws IOException                                                                               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 317 =======                                                                                                  </span>
<span class="-4698345167913557184" onmouseenter="enter('-4698345167913557184');" onmouseout="out('-4698345167913557184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318         out.key = mKeys.toArray(BackupProtos.Key.emptyArray());                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 319 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 320         writeJournal(newState, out);                                                                     </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style=""> 321         Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                         </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 322         mKeys.clear();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323     }                                                                                                    </span>
<span  style=""> 324                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 325     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 326      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 327      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 328      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 329      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 330      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 331      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 332      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 333      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 334      */                                                                                                  </span>
<span class="7131268859945314485" onmouseenter="enter('7131268859945314485');" onmouseout="out('7131268859945314485');" style=""> 335     private void backupFavorites(Journal in, BackupDataOutput data, Journal out,                         </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 336             ArrayList&lt;Key&gt; keys)                                                                         </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 337             throws IOException {                                                                         </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 338         // read the old ID set                                                                           </span>
<span class="1222708127935075798" onmouseenter="enter('1222708127935075798');" onmouseout="out('1222708127935075798');" style=""> 339         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.FAVORITE, in);                                      </span>
<span class="-6977244754148926833" onmouseenter="enter('-6977244754148926833');" onmouseout="out('-6977244754148926833');" style=""> 340         if (DEBUG) Log.d(TAG, &quot;favorite savedIds.size()=&quot; + savedIds.size());                            </span>
<span  style=""> 341                                                                                                          </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 342         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 343         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 344         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 345         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 346                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 347         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 348         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 349             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 350             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 351                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 352                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 353                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 354                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 355                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 356                 currentIds.add(backupKey);                                                               </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style=""> 357                 if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                               </span>
<span class="7001118594211601319" onmouseenter="enter('7001118594211601319');" onmouseout="out('7001118594211601319');" style=""> 358                     byte[] blob = packFavorite(cursor);                                                  </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 359                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 360                 } else {                                                                                 </span>
<span class="8521612769654249253" onmouseenter="enter('8521612769654249253');" onmouseout="out('8521612769654249253');" style=""> 361                     if (VERBOSE) Log.v(TAG, &quot;favorite &quot; + id + &quot; was too old: &quot; + updateTime);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 364         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 365             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366         }                                                                                                </span>
<span class="1671673783823377819" onmouseenter="enter('1671673783823377819');" onmouseout="out('1671673783823377819');" style=""> 367         if (DEBUG) Log.d(TAG, &quot;favorite currentIds.size()=&quot; + currentIds.size());                        </span>
<span  style=""> 368                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 369         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 370         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 371         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span  style=""> 373                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 374     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 375      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 376      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 377      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 378      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 379      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 380      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 381      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 382      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 383      */                                                                                                  </span>
<span class="-1219322022397821860" onmouseenter="enter('-1219322022397821860');" onmouseout="out('-1219322022397821860');" style=""> 384     private void restoreFavorite(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {            </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 385         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 386         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 387                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 388                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 389         if (!mRestoreEnabled) {                                                                          </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 390             if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 391             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392         }                                                                                                </span>
<span  style=""> 393                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 394         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 395             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4257623264587280611" onmouseenter="enter('4257623264587280611');" onmouseout="out('4257623264587280611');" style=""> 396             ContentValues values = unpackFavorite(buffer, 0, dataSize);                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style=""> 397             cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                    </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 398         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-2029498838376156786" onmouseenter="enter('-2029498838376156786');" onmouseout="out('-2029498838376156786');" style=""> 399             Log.e(TAG, &quot;failed to decode favorite&quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 403     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 404      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 405      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 406      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 407      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 408      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 409      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 410      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 411      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 412      */                                                                                                  </span>
<span class="1451925655210067336" onmouseenter="enter('1451925655210067336');" onmouseout="out('1451925655210067336');" style=""> 413     private void backupScreens(Journal in, BackupDataOutput data, Journal out,                           </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 414             ArrayList&lt;Key&gt; keys)                                                                         </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 415             throws IOException {                                                                         </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 416         // read the old ID set                                                                           </span>
<span class="-5113344219820420639" onmouseenter="enter('-5113344219820420639');" onmouseout="out('-5113344219820420639');" style=""> 417         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.SCREEN, in);                                        </span>
<span class="2041232408079356493" onmouseenter="enter('2041232408079356493');" onmouseout="out('2041232408079356493');" style=""> 418         if (DEBUG) Log.d(TAG, &quot;screen savedIds.size()=&quot; + savedIds.size());                              </span>
<span  style=""> 419                                                                                                          </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 420         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 421         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 422         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 423                 null, null, null);                                                                       </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 424         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 425         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 426             cursor.moveToPosition(-1);                                                                   </span>
<span class="-678679666922988121" onmouseenter="enter('-678679666922988121');" onmouseout="out('-678679666922988121');" style=""> 427             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + in.t);                                     </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 428             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 429                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 430                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 431                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 432                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 433                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 434                 currentIds.add(backupKey);                                                               </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style=""> 435                 if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                               </span>
<span class="30579954798815384" onmouseenter="enter('30579954798815384');" onmouseout="out('30579954798815384');" style=""> 436                     byte[] blob = packScreen(cursor);                                                    </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 437                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 438                 } else {                                                                                 </span>
<span class="-8953978356667297356" onmouseenter="enter('-8953978356667297356');" onmouseout="out('-8953978356667297356');" style=""> 439                     if (VERBOSE) Log.v(TAG, &quot;screen &quot; + id + &quot; was too old: &quot; + updateTime);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 442         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 443             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444         }                                                                                                </span>
<span class="5642954527140901409" onmouseenter="enter('5642954527140901409');" onmouseout="out('5642954527140901409');" style=""> 445         if (DEBUG) Log.d(TAG, &quot;screen currentIds.size()=&quot; + currentIds.size());                          </span>
<span  style=""> 446                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 447         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 448         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 449         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 450     }                                                                                                    </span>
<span  style=""> 451                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 452     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 453      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 454      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 455      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 456      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 457      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 458      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 459      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 460      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 461      */                                                                                                  </span>
<span class="-7250675390519322058" onmouseenter="enter('-7250675390519322058');" onmouseout="out('-7250675390519322058');" style=""> 462     private void restoreScreen(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 463         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 464         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 465                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 466                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 467         if (!mRestoreEnabled) {                                                                          </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 468             if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 469             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470         }                                                                                                </span>
<span  style=""> 471                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 472         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 473             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4024968274688095863" onmouseenter="enter('4024968274688095863');" onmouseout="out('4024968274688095863');" style=""> 474             ContentValues values = unpackScreen(buffer, 0, dataSize);                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 475             cr.insert(WorkspaceScreens.CONTENT_URI, values);                                             </span>
<span  style=""> 476                                                                                                          </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 477         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1711302190142484945" onmouseenter="enter('-1711302190142484945');" onmouseout="out('-1711302190142484945');" style=""> 478             Log.e(TAG, &quot;failed to decode screen&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480     }                                                                                                    </span>
<span  style=""> 481                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 482     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 483      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 484      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 485      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 486      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 487      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 488      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 489      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 490      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 491      */                                                                                                  </span>
<span class="599391339335107838" onmouseenter="enter('599391339335107838');" onmouseout="out('599391339335107838');" style=""> 492     private void backupIcons(Journal in, BackupDataOutput data, Journal out,                             </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 493             ArrayList&lt;Key&gt; keys) throws IOException {                                                    </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 494         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style=""> 495         if (!initializeIconCache()) {                                                                    </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 496             dataChanged(); // try again later                                                            </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style=""> 497             if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 498             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 500         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 501         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 502         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span  style=""> 503                                                                                                          </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 504         // read the old ID set                                                                           </span>
<span class="5971436892288320278" onmouseenter="enter('5971436892288320278');" onmouseout="out('5971436892288320278');" style=""> 505         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.ICON, in);                                          </span>
<span class="-8460076387801577925" onmouseenter="enter('-8460076387801577925');" onmouseout="out('-8460076387801577925');" style=""> 506         if (DEBUG) Log.d(TAG, &quot;icon savedIds.size()=&quot; + savedIds.size());                                </span>
<span  style=""> 507                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 508         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 509         int startRows = out.rows;                                                                        </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 510         if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                            </span>
<span  style=""> 511                                                                                                          </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 512         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 513                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 514                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 515         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 516                 where, null, null);                                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 517         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 518         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 519             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 520             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 521                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 522                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 523                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 524                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 525                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 526                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 527                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 528                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 529                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 530                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 531                         currentIds.add(backupKey);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 532                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 533                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534                     }                                                                                    </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 535                     if (savedIds.contains(backupKey)) {                                                  </span>
<span class="-8671855074852006779" onmouseenter="enter('-8671855074852006779');" onmouseout="out('-8671855074852006779');" style=""> 536                         if (VERBOSE) Log.v(TAG, &quot;already saved icon &quot; + backupKey);                      </span>
<span  style=""> 537                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 538                         // remember that we already backed this up previously                            </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 539                         keys.add(key);                                                                   </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 540                     } else if (backupKey != null) {                                                      </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 541                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                     </span>
<span class="-9006656974661932570" onmouseenter="enter('-9006656974661932570');" onmouseout="out('-9006656974661932570');" style=""> 542                         if ((out.rows - startRows) &lt; MAX_ICONS_PER_PASS) {                               </span>
<span class="8708467958147908091" onmouseenter="enter('8708467958147908091');" onmouseout="out('8708467958147908091');" style=""> 543                             if (VERBOSE) Log.v(TAG, &quot;saving icon &quot; + backupKey);                         </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 544                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 545                             keys.add(key);                                                               </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 546                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-1917944616523216064" onmouseenter="enter('-1917944616523216064');" onmouseout="out('-1917944616523216064');" style=""> 547                                 byte[] blob = packIcon(dpi, icon);                                       </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 548                                 writeRowToBackup(key, blob, out, data);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 550                         } else {                                                                         </span>
<span class="-7058657490284379944" onmouseenter="enter('-7058657490284379944');" onmouseout="out('-7058657490284379944');" style=""> 551                             if (VERBOSE) Log.d(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 552                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 553                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 556                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 557                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 558                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 559                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560                 }                                                                                        </span>
<span  style=""> 561                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 563         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 564             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565         }                                                                                                </span>
<span class="2508143952868696771" onmouseenter="enter('2508143952868696771');" onmouseout="out('2508143952868696771');" style=""> 566         if (DEBUG) Log.d(TAG, &quot;icon currentIds.size()=&quot; + currentIds.size());                            </span>
<span  style=""> 567                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 568         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 569         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 570         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571     }                                                                                                    </span>
<span  style=""> 572                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 573     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 574      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 575      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 576      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 577      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 578      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 579      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 580      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 581      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 582      */                                                                                                  </span>
<span class="3418786705842277190" onmouseenter="enter('3418786705842277190');" onmouseout="out('3418786705842277190');" style=""> 583     private void restoreIcon(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 584         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 585         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 586                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 587                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 588         try {                                                                                            </span>
<span class="-1273277075539844188" onmouseenter="enter('-1273277075539844188');" onmouseout="out('-1273277075539844188');" style=""> 589             Resource res = unpackIcon(buffer, 0, dataSize);                                              </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 590             if (DEBUG) {                                                                                 </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 591                 Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592             }                                                                                            </span>
<span class="-3352481463774338191" onmouseenter="enter('-3352481463774338191');" onmouseout="out('-3352481463774338191');" style=""> 593             if (DEBUG_PAYLOAD) {                                                                         </span>
<span class="-4521366973706198444" onmouseenter="enter('-4521366973706198444');" onmouseout="out('-4521366973706198444');" style=""> 594                 Log.d(TAG, &quot;read &quot; +                                                                     </span>
<span class="-9086841055072808764" onmouseenter="enter('-9086841055072808764');" onmouseout="out('-9086841055072808764');" style=""> 595                         Base64.encodeToString(res.data, 0, res.data.length,                              </span>
<span class="6738045639769732117" onmouseenter="enter('6738045639769732117');" onmouseout="out('6738045639769732117');" style=""> 596                                 Base64.NO_WRAP));                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597             }                                                                                            </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 598             Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                   </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 599             if (icon == null) {                                                                          </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 600                 Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601             }                                                                                            </span>
<span  style=""> 602                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 603             if (!mRestoreEnabled) {                                                                      </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 604                 if (VERBOSE) {                                                                           </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 605                     Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 607                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 608             } else {                                                                                     </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 609                 if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                         </span>
<span class="8408986404382537202" onmouseenter="enter('8408986404382537202');" onmouseout="out('8408986404382537202');" style=""> 610                 IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name),             </span>
<span class="6231676971894754004" onmouseenter="enter('6231676971894754004');" onmouseout="out('6231676971894754004');" style=""> 611                         icon, res.dpi);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 613         } catch (IOException e) {                                                                        </span>
<span class="2331121584648893440" onmouseenter="enter('2331121584648893440');" onmouseout="out('2331121584648893440');" style=""> 614             Log.d(TAG, &quot;failed to save restored icon for: &quot; + key.name, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616     }                                                                                                    </span>
<span  style=""> 617                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 618     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 619      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 620      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 621      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 622      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 623      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 624      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 625      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 626      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 627      */                                                                                                  </span>
<span class="-982237492458374713" onmouseenter="enter('-982237492458374713');" onmouseout="out('-982237492458374713');" style=""> 628     private void backupWidgets(Journal in, BackupDataOutput data, Journal out,                           </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 629             ArrayList&lt;Key&gt; keys) throws IOException {                                                    </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 630         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 631         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style=""> 632         if (appState == null || !initializeIconCache()) {                                                </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style=""> 633             Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 634             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 636         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 637         final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                     </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 638         final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);               </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 639         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 640         final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                      </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style=""> 641         if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                    </span>
<span  style=""> 642                                                                                                          </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 643         // read the old ID set                                                                           </span>
<span class="-852429832136699702" onmouseenter="enter('-852429832136699702');" onmouseout="out('-852429832136699702');" style=""> 644         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.WIDGET, in);                                        </span>
<span class="-2616909315275324814" onmouseenter="enter('-2616909315275324814');" onmouseout="out('-2616909315275324814');" style=""> 645         if (DEBUG) Log.d(TAG, &quot;widgets savedIds.size()=&quot; + savedIds.size());                             </span>
<span  style=""> 646                                                                                                          </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 647         int startRows = out.rows;                                                                        </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 648         if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                            </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 649         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 650                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 651         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 652                 where, null, null);                                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 653         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 654         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 655             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 656             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 657                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 658                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 659                 final int spanX = cursor.getInt(SPANX_INDEX);                                            </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 660                 final int spanY = cursor.getInt(SPANY_INDEX);                                            </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 661                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 662                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 663                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 664                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 665                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 666                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 667                     currentIds.add(backupKey);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 668                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 669                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670                 }                                                                                        </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 671                 if (savedIds.contains(backupKey)) {                                                      </span>
<span class="-8428771999657462146" onmouseenter="enter('-8428771999657462146');" onmouseout="out('-8428771999657462146');" style=""> 672                     if (VERBOSE) Log.v(TAG, &quot;already saved widget &quot; + backupKey);                        </span>
<span  style=""> 673                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 674                     // remember that we already backed this up previously                                </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 675                     keys.add(key);                                                                       </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 676                 } else if (backupKey != null) {                                                          </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 677                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                         </span>
<span class="-5873889847669281246" onmouseenter="enter('-5873889847669281246');" onmouseout="out('-5873889847669281246');" style=""> 678                     if ((out.rows - startRows) &lt; MAX_WIDGETS_PER_PASS) {                                 </span>
<span class="-4960779571857458493" onmouseenter="enter('-4960779571857458493');" onmouseout="out('-4960779571857458493');" style=""> 679                         if (VERBOSE) Log.v(TAG, &quot;saving widget &quot; + backupKey);                           </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style=""> 680                         previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                        </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style=""> 681                                 spanY * profile.cellHeightPx, widgetSpacingLayout);                      </span>
<span class="-4963176699005952762" onmouseenter="enter('-4963176699005952762');" onmouseout="out('-4963176699005952762');" style=""> 682                         byte[] blob = packWidget(dpi, previewLoader, mIconCache, provider);              </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 683                         keys.add(key);                                                                   </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 684                         writeRowToBackup(key, blob, out, data);                                          </span>
<span  style=""> 685                                                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 686                     } else {                                                                             </span>
<span class="-2793925555163198542" onmouseenter="enter('-2793925555163198542');" onmouseout="out('-2793925555163198542');" style=""> 687                         if (VERBOSE) Log.d(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 688                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 689                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 693         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 694             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695         }                                                                                                </span>
<span class="7930052468528100382" onmouseenter="enter('7930052468528100382');" onmouseout="out('7930052468528100382');" style=""> 696         if (DEBUG) Log.d(TAG, &quot;widget currentIds.size()=&quot; + currentIds.size());                          </span>
<span  style=""> 697                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 698         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 699         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 700         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701     }                                                                                                    </span>
<span  style=""> 702                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 703     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 704      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 705      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 706      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 707      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 708      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 709      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 710      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 711      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 712      */                                                                                                  </span>
<span class="-2743597305724887598" onmouseenter="enter('-2743597305724887598');" onmouseout="out('-2743597305724887598');" style=""> 713     private void restoreWidget(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 714         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 715         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 716                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 717         try {                                                                                            </span>
<span class="6880516999183343771" onmouseenter="enter('6880516999183343771');" onmouseout="out('6880516999183343771');" style=""> 718             Widget widget = unpackWidget(buffer, 0, dataSize);                                           </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 719             if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                        </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 720             if (widget.icon.data != null)  {                                                             </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 721                 Bitmap icon = BitmapFactory                                                              </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 722                         .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                  </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 723                 if (icon == null) {                                                                      </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 724                     Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 725                 } else {                                                                                 </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style=""> 726                     IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),  </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style=""> 727                             icon, widget.icon.dpi);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729             }                                                                                            </span>
<span  style=""> 730                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 731             if (!mRestoreEnabled) {                                                                      </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 732                 if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 733                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 734             } else {                                                                                     </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 735                 // future site of widget table mutation                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736             }                                                                                            </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 737         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1867545559162052515" onmouseenter="enter('-1867545559162052515');" onmouseout="out('-1867545559162052515');" style=""> 738             Log.e(TAG, &quot;failed to decode widget&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740     }                                                                                                    </span>
<span  style=""> 741                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 742     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 743      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 744      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 745      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 746      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 747     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 748         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 749         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 750         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 751         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 752         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753     }                                                                                                    </span>
<span  style=""> 754                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 755     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 756      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 757      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 758      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 759      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 760     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 761         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 762         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 763         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 764         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 765         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766     }                                                                                                    </span>
<span  style=""> 767                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 768     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 769     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 770         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771     }                                                                                                    </span>
<span  style=""> 772                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 773     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="3565153267272331252" onmouseenter="enter('3565153267272331252');" onmouseout="out('3565153267272331252');" style=""> 774     private Key backupKeyToKey(String backupKey) throws KeyParsingException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 775         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 776             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 777             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 778                 key = null;                                                                              </span>
<span class="7886037428699907314" onmouseenter="enter('7886037428699907314');" onmouseout="out('7886037428699907314');" style=""> 779                 throw new KeyParsingException(&quot;invalid key read from stream&quot; + backupKey);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 781             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 782         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 783             throw new KeyParsingException(e);                                                            </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 784         } catch (IllegalArgumentException e) {                                                           </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 785             throw new KeyParsingException(e);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787     }                                                                                                    </span>
<span  style=""> 788                                                                                                          </span>
<span class="-9026907230628270971" onmouseenter="enter('-9026907230628270971');" onmouseout="out('-9026907230628270971');" style=""> 789     private String getKeyName(Key key) {                                                                 </span>
<span class="-7992041348690575973" onmouseenter="enter('-7992041348690575973');" onmouseout="out('-7992041348690575973');" style=""> 790         if (TextUtils.isEmpty(key.name)) {                                                               </span>
<span class="3948647275026092398" onmouseenter="enter('3948647275026092398');" onmouseout="out('3948647275026092398');" style=""> 791             return Long.toString(key.id);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 792         } else {                                                                                         </span>
<span class="-8847809052433174647" onmouseenter="enter('-8847809052433174647');" onmouseout="out('-8847809052433174647');" style=""> 793             return key.name;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794         }                                                                                                </span>
<span  style=""> 795                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796     }                                                                                                    </span>
<span  style=""> 797                                                                                                          </span>
<span class="-3302500785890956613" onmouseenter="enter('-3302500785890956613');" onmouseout="out('-3302500785890956613');" style=""> 798     private String geKeyType(Key key) {                                                                  </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 799         switch (key.type) {                                                                              </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 800             case Key.FAVORITE:                                                                           </span>
<span class="-6693583981393703832" onmouseenter="enter('-6693583981393703832');" onmouseout="out('-6693583981393703832');" style=""> 801                 return &quot;favorite&quot;;                                                                       </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 802             case Key.SCREEN:                                                                             </span>
<span class="-935980872443992001" onmouseenter="enter('-935980872443992001');" onmouseout="out('-935980872443992001');" style=""> 803                 return &quot;screen&quot;;                                                                         </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 804             case Key.ICON:                                                                               </span>
<span class="-6438997020167939033" onmouseenter="enter('-6438997020167939033');" onmouseout="out('-6438997020167939033');" style=""> 805                 return &quot;icon&quot;;                                                                           </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 806             case Key.WIDGET:                                                                             </span>
<span class="875584635155758752" onmouseenter="enter('875584635155758752');" onmouseout="out('875584635155758752');" style=""> 807                 return &quot;widget&quot;;                                                                         </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 808             default:                                                                                     </span>
<span class="-9117731612531303028" onmouseenter="enter('-9117731612531303028');" onmouseout="out('-9117731612531303028');" style=""> 809                 return &quot;anonymous&quot;;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811     }                                                                                                    </span>
<span  style=""> 812                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 813     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 814     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 815         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 816         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 817         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 818         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 819         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 820             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 822         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823     }                                                                                                    </span>
<span  style=""> 824                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 825     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4378147688590970666" onmouseenter="enter('-4378147688590970666');" onmouseout="out('-4378147688590970666');" style=""> 826     private byte[] packFavorite(Cursor c) {                                                              </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 827         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 828         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 829         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 830         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 831         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 832         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 833         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 834         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 835         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 836         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 837             String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                        </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 838             if (!TextUtils.isEmpty(iconPackage)) {                                                       </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 839                 favorite.iconPackage = iconPackage;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840             }                                                                                            </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 841             String iconResource = c.getString(ICON_RESOURCE_INDEX);                                      </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 842             if (!TextUtils.isEmpty(iconResource)) {                                                      </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 843                 favorite.iconResource = iconResource;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 846         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 847             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 848             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 849                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 851         }                                                                                                </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 852         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 853         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 854             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 856         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 857         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 858             try {                                                                                        </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 859                 Intent intent = Intent.parseUri(intentDescription, 0);                                   </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 860                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 861                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 862             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 863                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864            }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 866         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 867         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 868             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 869             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 870             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 871                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873         }                                                                                                </span>
<span  style=""> 874                                                                                                          </span>
<span class="-8315891601108782355" onmouseenter="enter('-8315891601108782355');" onmouseout="out('-8315891601108782355');" style=""> 875         return writeCheckedBytes(favorite);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876     }                                                                                                    </span>
<span  style=""> 877                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 878     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5696583694055723136" onmouseenter="enter('-5696583694055723136');" onmouseout="out('-5696583694055723136');" style=""> 879     private ContentValues unpackFavorite(byte[] buffer, int offset, int dataSize)                        </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 880             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 881         Favorite favorite = new Favorite();                                                              </span>
<span class="1666030682203596411" onmouseenter="enter('1666030682203596411');" onmouseout="out('1666030682203596411');" style=""> 882         MessageNano.mergeFrom(favorite, readCheckedBytes(buffer, offset, dataSize));                     </span>
<span class="-8746500302928937436" onmouseenter="enter('-8746500302928937436');" onmouseout="out('-8746500302928937436');" style=""> 883         if (VERBOSE) Log.v(TAG, &quot;unpacked favorite &quot; + favorite.itemType + &quot;, &quot; +                        </span>
<span class="-5821514453449777802" onmouseenter="enter('-5821514453449777802');" onmouseout="out('-5821514453449777802');" style=""> 884                 (TextUtils.isEmpty(favorite.title) ? favorite.id : favorite.title));                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 885         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 886         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 887         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 888         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 889         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 890         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 891         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 892         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 893         values.put(Favorites.ICON_TYPE, favorite.iconType);                                              </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 894         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 895             values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                    </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 896             values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 898         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 899             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900         }                                                                                                </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 901         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 902             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 903         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 904             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 906         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 907             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 908         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 909         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style=""> 910                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 911         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 912         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 913                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 914         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style=""> 915                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 916         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 917             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 918                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 919             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 920             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 921             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 922                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 923                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 924                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 925         } else {                                                                                         </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 926             // Let LauncherModel know we&#x27;ve been here.                                                   </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 927             values.put(LauncherSettings.Favorites.RESTORED, 1);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928         }                                                                                                </span>
<span  style=""> 929                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 930         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 933     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-1055302898918768280" onmouseenter="enter('-1055302898918768280');" onmouseout="out('-1055302898918768280');" style=""> 934     private byte[] packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 935         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 936         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 937         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span  style=""> 938                                                                                                          </span>
<span class="-8008243495242652634" onmouseenter="enter('-8008243495242652634');" onmouseout="out('-8008243495242652634');" style=""> 939         return writeCheckedBytes(screen);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 940     }                                                                                                    </span>
<span  style=""> 941                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 942     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="6886240294794970082" onmouseenter="enter('6886240294794970082');" onmouseout="out('6886240294794970082');" style=""> 943     private ContentValues unpackScreen(byte[] buffer, int offset, int dataSize)                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 944             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 945         Screen screen = new Screen();                                                                    </span>
<span class="5997669843530195787" onmouseenter="enter('5997669843530195787');" onmouseout="out('5997669843530195787');" style=""> 946         MessageNano.mergeFrom(screen, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-8455088715171122130" onmouseenter="enter('-8455088715171122130');" onmouseout="out('-8455088715171122130');" style=""> 947         if (VERBOSE) Log.v(TAG, &quot;unpacked screen &quot; + screen.id + &quot;/&quot; + screen.rank);                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 948         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 949         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 950         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 951         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952     }                                                                                                    </span>
<span  style=""> 953                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 954     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="1129196888280545123" onmouseenter="enter('1129196888280545123');" onmouseout="out('1129196888280545123');" style=""> 955     private byte[] packIcon(int dpi, Bitmap icon) {                                                      </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 956         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 957         res.dpi = dpi;                                                                                   </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 958         ByteArrayOutputStream os = new ByteArrayOutputStream();                                          </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 959         if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 960             res.data = os.toByteArray();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961         }                                                                                                </span>
<span class="-2324310893561295790" onmouseenter="enter('-2324310893561295790');" onmouseout="out('-2324310893561295790');" style=""> 962         return writeCheckedBytes(res);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963     }                                                                                                    </span>
<span  style=""> 964                                                                                                          </span>
<span class="-8685556113116579868" onmouseenter="enter('-8685556113116579868');" onmouseout="out('-8685556113116579868');" style=""> 965     /** Deserialize an icon resource from persistence, after verifying checksum wrapper. */              </span>
<span class="-6700621194159108538" onmouseenter="enter('-6700621194159108538');" onmouseout="out('-6700621194159108538');" style=""> 966     private static Resource unpackIcon(byte[] buffer, int offset, int dataSize)                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 967             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 968         Resource res = new Resource();                                                                   </span>
<span class="760491121676290671" onmouseenter="enter('760491121676290671');" onmouseout="out('760491121676290671');" style=""> 969         MessageNano.mergeFrom(res, readCheckedBytes(buffer, offset, dataSize));                          </span>
<span class="4102854592882680519" onmouseenter="enter('4102854592882680519');" onmouseout="out('4102854592882680519');" style=""> 970         if (VERBOSE) Log.v(TAG, &quot;unpacked icon &quot; + res.dpi + &quot;/&quot; + res.data.length);                     </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 971         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972     }                                                                                                    </span>
<span  style=""> 973                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 974     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-476988516990873332" onmouseenter="enter('-476988516990873332');" onmouseout="out('-476988516990873332');" style=""> 975     private byte[] packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,           </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style=""> 976             ComponentName provider) {                                                                    </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style=""> 977         final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 978         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 979         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 980         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 981         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 982         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 983             widget.icon = new Resource();                                                                </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style=""> 984             Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);       </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 985             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 986             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 987             if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                            </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style=""> 988                 widget.icon.data = os.toByteArray();                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 989                 widget.icon.dpi = dpi;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 990             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 991         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 992         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style=""> 993             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style=""> 994             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 995             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style=""> 996             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style=""> 997                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style=""> 998                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 999             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1000         }                                                                                                </span>
<span class="-6092547598221684616" onmouseenter="enter('-6092547598221684616');" onmouseout="out('-6092547598221684616');" style="">1001         return writeCheckedBytes(widget);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1002     }                                                                                                    </span>
<span  style="">1003                                                                                                          </span>
<span class="2267681228426618803" onmouseenter="enter('2267681228426618803');" onmouseout="out('2267681228426618803');" style="">1004     /** Deserialize a widget from persistence, after verifying checksum wrapper. */                      </span>
<span class="478875287574324925" onmouseenter="enter('478875287574324925');" onmouseout="out('478875287574324925');" style="">1005     private Widget unpackWidget(byte[] buffer, int offset, int dataSize)                                 </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1006             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1007         Widget widget = new Widget();                                                                    </span>
<span class="-594535766013271981" onmouseenter="enter('-594535766013271981');" onmouseout="out('-594535766013271981');" style="">1008         MessageNano.mergeFrom(widget, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-6614366492544728686" onmouseenter="enter('-6614366492544728686');" onmouseout="out('-6614366492544728686');" style="">1009         if (VERBOSE) Log.v(TAG, &quot;unpacked widget &quot; + widget.provider);                                   </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1010         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1011     }                                                                                                    </span>
<span  style="">1012                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1013     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1014      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1015      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1016      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1017      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1018      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1019      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="">1020      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1021      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1022     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1023         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1024         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1025             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1027         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1028         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1029             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1030             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1031             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1032                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1033                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1034                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1035                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1036                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1037                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1038                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1039                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1040                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1041                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1042                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1043                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1044                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1045                             bytesRead += result;                                                         </span>
<span class="-8507805265236222004" onmouseenter="enter('-8507805265236222004');" onmouseout="out('-8507805265236222004');" style="">1046                             if (DEBUG &amp;&amp; (bytesRead % 100 == 0)) {                                       </span>
<span class="3263531768832665724" onmouseenter="enter('3263531768832665724');" onmouseout="out('3263531768832665724');" style="">1047                                 Log.d(TAG, &quot;read some bytes: &quot; + bytesRead);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1048                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1049                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1050                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1051                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1052                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1054                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1055                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1056                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1057                     }                                                                                    </span>
<span  style="">1058                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1059                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1060                     try {                                                                                </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style="">1061                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));          </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1062                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1063                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1064                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1065                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1066                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1067                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1068                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1069                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1070                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1071                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1072                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1073                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1074                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1075                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1076             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1077         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1078             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1079         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1080             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1081                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1082             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1083                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1084             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1085         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1086         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1087     }                                                                                                    </span>
<span  style="">1088                                                                                                          </span>
<span class="1857887861945457945" onmouseenter="enter('1857887861945457945');" onmouseout="out('1857887861945457945');" style="">1089     private void writeRowToBackup(Key key, byte[] blob, Journal out,                                     </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1090             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-8570409028541836443" onmouseenter="enter('-8570409028541836443');" onmouseout="out('-8570409028541836443');" style="">1091         String backupKey = keyToBackupKey(key);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1092         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1093         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="7907644802080103671" onmouseenter="enter('7907644802080103671');" onmouseout="out('7907644802080103671');" style="">1094         out.rows++;                                                                                      </span>
<span class="-565229434051730696" onmouseenter="enter('-565229434051730696');" onmouseout="out('-565229434051730696');" style="">1095         out.bytes += blob.length;                                                                        </span>
<span class="7477494328045094252" onmouseenter="enter('7477494328045094252');" onmouseout="out('7477494328045094252');" style="">1096         if (VERBOSE) Log.v(TAG, &quot;saving &quot; + geKeyType(key) + &quot; &quot; + backupKey + &quot;: &quot; +                    </span>
<span class="188331799762465007" onmouseenter="enter('188331799762465007');" onmouseout="out('188331799762465007');" style="">1097                 getKeyName(key) + &quot;/&quot; + blob.length);                                                    </span>
<span class="9073034288274959985" onmouseenter="enter('9073034288274959985');" onmouseout="out('9073034288274959985');" style="">1098         if(DEBUG_PAYLOAD) {                                                                              </span>
<span class="-7017497320803160772" onmouseenter="enter('-7017497320803160772');" onmouseout="out('-7017497320803160772');" style="">1099             String encoded = Base64.encodeToString(blob, 0, blob.length, Base64.NO_WRAP);                </span>
<span class="-998151031530761193" onmouseenter="enter('-998151031530761193');" onmouseout="out('-998151031530761193');" style="">1100             final int chunkSize = 1024;                                                                  </span>
<span class="4942461364046774481" onmouseenter="enter('4942461364046774481');" onmouseout="out('4942461364046774481');" style="">1101             for (int offset = 0; offset &lt; encoded.length(); offset += chunkSize) {                       </span>
<span class="7644631075752865640" onmouseenter="enter('7644631075752865640');" onmouseout="out('7644631075752865640');" style="">1102                 int end = offset + chunkSize;                                                            </span>
<span class="-7525499051306958146" onmouseenter="enter('-7525499051306958146');" onmouseout="out('-7525499051306958146');" style="">1103                 end = Math.min(end, encoded.length());                                                   </span>
<span class="-5356592555400346432" onmouseenter="enter('-5356592555400346432');" onmouseout="out('-5356592555400346432');" style="">1104                 Log.w(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1106         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1107     }                                                                                                    </span>
<span  style="">1108                                                                                                          </span>
<span class="2702098317253578682" onmouseenter="enter('2702098317253578682');" onmouseout="out('2702098317253578682');" style="">1109     private Set&lt;String&gt; getSavedIdsByType(int type, Journal in) {                                        </span>
<span class="-49943749293500978" onmouseenter="enter('-49943749293500978');" onmouseout="out('-49943749293500978');" style="">1110         Set&lt;String&gt; savedIds = new HashSet&lt;String&gt;();                                                    </span>
<span class="-7898804644582645533" onmouseenter="enter('-7898804644582645533');" onmouseout="out('-7898804644582645533');" style="">1111         for(int i = 0; i &lt; in.key.length; i++) {                                                         </span>
<span class="8349919170880076083" onmouseenter="enter('8349919170880076083');" onmouseout="out('8349919170880076083');" style="">1112             Key key = in.key[i];                                                                         </span>
<span class="-5995133320761897029" onmouseenter="enter('-5995133320761897029');" onmouseout="out('-5995133320761897029');" style="">1113             if (key.type == type) {                                                                      </span>
<span class="3576075164739381606" onmouseenter="enter('3576075164739381606');" onmouseout="out('3576075164739381606');" style="">1114                 savedIds.add(keyToBackupKey(key));                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1115             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1116         }                                                                                                </span>
<span class="-5348725939705536872" onmouseenter="enter('-5348725939705536872');" onmouseout="out('-5348725939705536872');" style="">1117         return savedIds;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1118     }                                                                                                    </span>
<span  style="">1119                                                                                                          </span>
<span class="-695874875282614773" onmouseenter="enter('-695874875282614773');" onmouseout="out('-695874875282614773');" style="">1120     private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data)               </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1121             throws IOException {                                                                         </span>
<span class="-4851536707927267136" onmouseenter="enter('-4851536707927267136');" onmouseout="out('-4851536707927267136');" style="">1122         int rows = 0;                                                                                    </span>
<span class="-713409252568618308" onmouseenter="enter('-713409252568618308');" onmouseout="out('-713409252568618308');" style="">1123         for(String deleted: deletedIds) {                                                                </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style="">1124             if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                 </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style="">1125             data.writeEntityHeader(deleted, -1);                                                         </span>
<span class="3376167913476125145" onmouseenter="enter('3376167913476125145');" onmouseout="out('3376167913476125145');" style="">1126             rows++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1127         }                                                                                                </span>
<span class="7304487908762689425" onmouseenter="enter('7304487908762689425');" onmouseout="out('7304487908762689425');" style="">1128         return rows;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1129     }                                                                                                    </span>
<span  style="">1130                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1131     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1132      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1133      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1134      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1135      * in that case, do a full backup.                                                                   </span>
<span  style="">1136                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1137      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1138      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1139      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1140     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1141         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1142         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1143             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1144             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1145             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1146             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1147             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1148         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1149             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1150         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1151     }                                                                                                    </span>
<span  style="">1152                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1153     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1154     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1155         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1156         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1157         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1158         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1159         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1160         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1161     }                                                                                                    </span>
<span  style="">1162                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1163     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="5021637008110274727" onmouseenter="enter('5021637008110274727');" onmouseout="out('5021637008110274727');" style="">1164     private static byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize)                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1165             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1166         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-3959921631204962332" onmouseenter="enter('-3959921631204962332');" onmouseout="out('-3959921631204962332');" style="">1167         MessageNano.mergeFrom(wrapper, buffer, offset, dataSize);                                        </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1168         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1169         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1170         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1171             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1173         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1174     }                                                                                                    </span>
<span  style="">1175                                                                                                          </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style="">1176     private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                   </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style="">1177         if (mWidgetMap == null) {                                                                        </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style="">1178             List&lt;AppWidgetProviderInfo&gt; widgets =                                                        </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="">1179                     AppWidgetManager.getInstance(mContext).getInstalledProviders();                      </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="">1180             mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());              </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="">1181             for (AppWidgetProviderInfo info : widgets) {                                                 </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="">1182                 mWidgetMap.put(info.provider, info);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1183             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1184         }                                                                                                </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="">1185         return mWidgetMap.get(component);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1186     }                                                                                                    </span>
<span  style="">1187                                                                                                          </span>
<span  style="">1188                                                                                                          </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="">1189     private boolean initializeIconCache() {                                                              </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="">1190         if (mIconCache != null) {                                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1191             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1192         }                                                                                                </span>
<span  style="">1193                                                                                                          </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="">1194         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="">1195         if (appState == null) {                                                                          </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="">1196             Throwable stackTrace = new Throwable();                                                      </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="">1197             stackTrace.fillInStackTrace();                                                               </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="">1198             Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1199             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1200         }                                                                                                </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="">1201         mIconCache = appState.getIconCache();                                                            </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="">1202         return mIconCache != null;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1203     }                                                                                                    </span>
<span  style="">1204                                                                                                          </span>
<span  style="">1205                                                                                                          </span>
<span class="-342082428602666517" onmouseenter="enter('-342082428602666517');" onmouseout="out('-342082428602666517');" style="">1206    // check if the launcher is in a state to support backup                                              </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1207     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1208         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1209         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1210         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1211             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1212             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1214         cursor.close();                                                                                  </span>
<span  style="">1215                                                                                                          </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="">1216         if (!initializeIconCache()) {                                                                    </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1217             // launcher services are unavailable, try again later                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="">1218             dataChanged();                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1219             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220         }                                                                                                </span>
<span  style="">1221                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1222         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1223     }                                                                                                    </span>
<span  style="">1224                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1225     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1226         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1227                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1228     }                                                                                                    </span>
<span  style="">1229                                                                                                          </span>
<span class="9065001176904994716" onmouseenter="enter('9065001176904994716');" onmouseout="out('9065001176904994716');" style="">1230     private class KeyParsingException extends Throwable {                                                </span>
<span class="6514561846306478812" onmouseenter="enter('6514561846306478812');" onmouseout="out('6514561846306478812');" style="">1231         private KeyParsingException(Throwable cause) {                                                   </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1232             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1233         }                                                                                                </span>
<span  style="">1234                                                                                                          </span>
<span class="8465822963319034792" onmouseenter="enter('8465822963319034792');" onmouseout="out('8465822963319034792');" style="">1235         public KeyParsingException(String reason) {                                                      </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1236             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1237         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1238     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1239 }                                                                                                        </span>








</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  18 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  19 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span  style="">  20                                                                                                          </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  21 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  22 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  23 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  24 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  25 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  26 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  27 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  28 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  29 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  30 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  31 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  32 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span  style="">  33                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  34 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  35 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  36 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  37 import android.app.backup.BackupManager;                                                                 </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="">  38 import android.appwidget.AppWidgetManager;                                                               </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">  39 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  40 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  41 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  42 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  43 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  44 import android.content.Intent;                                                                           </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  45 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  46 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  47 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  48 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  49 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  50 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  51 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  52 import android.util.Log;                                                                                 </span>
<span  style="">  53                                                                                                          </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  54 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  55 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  56 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  57 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  58 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  59 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  60 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  61 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  62 import java.util.List;                                                                                   </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  63 import java.util.Set;                                                                                    </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  64 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  65                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  66 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  67  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  68  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  69 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span  style="">  70                                                                                                          </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  71     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  72     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  73     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span class="8681536538150810745" onmouseenter="enter('8681536538150810745');" onmouseout="out('8681536538150810745');" style="">  74     private static final boolean DEBUG_PAYLOAD = false;                                                  </span>
<span  style="">  75                                                                                                          </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  76     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  77                                                                                                          </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  78     /** icons are large, dribble them out */                                                             </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  79     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  81     /** widgets contain previews, which are very large, dribble them out */                              </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  82     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  83                                                                                                          </span>
<span class="-9115528851843838744" onmouseenter="enter('-9115528851843838744');" onmouseout="out('-9115528851843838744');" style="">  84     public static final int IMAGE_COMPRESSION_QUALITY = 75;                                              </span>
<span  style="">  85                                                                                                          </span>
<span class="-3087488215496878471" onmouseenter="enter('-3087488215496878471');" onmouseout="out('-3087488215496878471');" style="">  86     public static final String LAUNCHER_PREFIX = &quot;L&quot;;                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="-1120390505463346401" onmouseenter="enter('-1120390505463346401');" onmouseout="out('-1120390505463346401');" style="">  88     public static final String LAUNCHER_PREFS_PREFIX = &quot;LP&quot;;                                             </span>
<span  style="">  89                                                                                                          </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  90     private static final Bitmap.CompressFormat IMAGE_FORMAT =                                            </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  91             android.graphics.Bitmap.CompressFormat.PNG;                                                  </span>
<span  style="">  92                                                                                                          </span>
<span class="-6320109508039674215" onmouseenter="enter('-6320109508039674215');" onmouseout="out('-6320109508039674215');" style="">  93     private static BackupManager sBackupManager;                                                         </span>
<span  style="">  94                                                                                                          </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  95     private static final String[] FAVORITE_PROJECTION = {                                                </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  96             Favorites._ID,                     // 0                                                      </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  97             Favorites.MODIFIED,                // 1                                                      </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  98             Favorites.INTENT,                  // 2                                                      </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  99             Favorites.APPWIDGET_PROVIDER,      // 3                                                      </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style=""> 100             Favorites.APPWIDGET_ID,            // 4                                                      </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style=""> 101             Favorites.CELLX,                   // 5                                                      </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 102             Favorites.CELLY,                   // 6                                                      </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 103             Favorites.CONTAINER,               // 7                                                      </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 104             Favorites.ICON,                    // 8                                                      </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 105             Favorites.ICON_PACKAGE,            // 9                                                      </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 106             Favorites.ICON_RESOURCE,           // 10                                                     </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 107             Favorites.ICON_TYPE,               // 11                                                     </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 108             Favorites.ITEM_TYPE,               // 12                                                     </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 109             Favorites.SCREEN,                  // 13                                                     </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 110             Favorites.SPANX,                   // 14                                                     </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 111             Favorites.SPANY,                   // 15                                                     </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 112             Favorites.TITLE,                   // 16                                                     </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style=""> 113             Favorites.PROFILE_ID,              // 17                                                     </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 114     };                                                                                                   </span>
<span  style=""> 115                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 116     private static final int ID_INDEX = 0;                                                               </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 117     private static final int ID_MODIFIED = 1;                                                            </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 118     private static final int INTENT_INDEX = 2;                                                           </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 119     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 120     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 121     private static final int CELLX_INDEX = 5;                                                            </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 122     private static final int CELLY_INDEX = 6;                                                            </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 123     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 124     private static final int ICON_INDEX = 8;                                                             </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 125     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 126     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 127     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 128     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 129     private static final int SCREEN_INDEX = 13;                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 130     private static final int SPANX_INDEX = 14;                                                           </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 131     private static final int SPANY_INDEX = 15;                                                           </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 132     private static final int TITLE_INDEX = 16;                                                           </span>
<span class="-3666133504327950845" onmouseenter="enter('-3666133504327950845');" onmouseout="out('-3666133504327950845');" style=""> 133     private static final int PROFILE_ID_INDEX = 17;                                                      </span>
<span  style=""> 134                                                                                                          </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 135     private static final String[] SCREEN_PROJECTION = {                                                  </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 136             WorkspaceScreens._ID,              // 0                                                      </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 137             WorkspaceScreens.MODIFIED,         // 1                                                      </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 138             WorkspaceScreens.SCREEN_RANK       // 2                                                      </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 139     };                                                                                                   </span>
<span  style=""> 140                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 141     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 142                                                                                                          </span>
<span class="1370853386149545885" onmouseenter="enter('1370853386149545885');" onmouseout="out('1370853386149545885');" style=""> 143     private static IconCache mIconCache;                                                                 </span>
<span  style=""> 144                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 145     private final Context mContext;                                                                      </span>
<span  style=""> 146                                                                                                          </span>
<span class="-8743166978913928813" onmouseenter="enter('-8743166978913928813');" onmouseout="out('-8743166978913928813');" style=""> 147     private final boolean mRestoreEnabled;                                                               </span>
<span  style=""> 148                                                                                                          </span>
<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style=""> 149     private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                    </span>
<span  style=""> 150                                                                                                          </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 151     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span  style=""> 152                                                                                                          </span>
<span class="2664402437757712713" onmouseenter="enter('2664402437757712713');" onmouseout="out('2664402437757712713');" style=""> 153     public LauncherBackupHelper(Context context, boolean restoreEnabled) {                               </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 154         mContext = context;                                                                              </span>
<span class="3162096380580590348" onmouseenter="enter('3162096380580590348');" onmouseout="out('3162096380580590348');" style=""> 155         mRestoreEnabled = restoreEnabled;                                                                </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 156         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157     }                                                                                                    </span>
<span  style=""> 158                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 159     private void dataChanged() {                                                                         </span>
<span class="-6280593186860143288" onmouseenter="enter('-6280593186860143288');" onmouseout="out('-6280593186860143288');" style=""> 160         if (sBackupManager == null) {                                                                    </span>
<span class="-1682111607995772618" onmouseenter="enter('-1682111607995772618');" onmouseout="out('-1682111607995772618');" style=""> 161             sBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-8519501381186315635" onmouseenter="enter('-8519501381186315635');" onmouseout="out('-8519501381186315635');" style=""> 163         sBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 167      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 168      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 169      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 170      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 171      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 172      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 173      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 174      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 175      * @param newState notes for the next backup                                                         </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 176      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 177      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 178     @Override                                                                                            </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 179     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                      </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 180             ParcelFileDescriptor newState) {                                                             </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style=""> 181         if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                             </span>
<span  style=""> 182                                                                                                          </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 183         Journal in = readJournal(oldState);                                                              </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 184         Journal out = new Journal();                                                                     </span>
<span  style=""> 185                                                                                                          </span>
<span class="-3253084867092672816" onmouseenter="enter('-3253084867092672816');" onmouseout="out('-3253084867092672816');" style=""> 186         long lastBackupTime = in.t;                                                                      </span>
<span class="8932370774979500270" onmouseenter="enter('8932370774979500270');" onmouseout="out('8932370774979500270');" style=""> 187         out.t = System.currentTimeMillis();                                                              </span>
<span class="-1600347970264493336" onmouseenter="enter('-1600347970264493336');" onmouseout="out('-1600347970264493336');" style=""> 188         out.rows = 0;                                                                                    </span>
<span class="2725575623770373107" onmouseenter="enter('2725575623770373107');" onmouseout="out('2725575623770373107');" style=""> 189         out.bytes = 0;                                                                                   </span>
<span  style=""> 190                                                                                                          </span>
<span class="1052445760685633825" onmouseenter="enter('1052445760685633825');" onmouseout="out('1052445760685633825');" style=""> 191         Log.v(TAG, &quot;lastBackupTime=&quot; + lastBackupTime);                                                  </span>
<span  style=""> 192                                                                                                          </span>
<span class="4700072589631005259" onmouseenter="enter('4700072589631005259');" onmouseout="out('4700072589631005259');" style=""> 193         ArrayList&lt;Key&gt; keys = new ArrayList&lt;Key&gt;();                                                      </span>
<span class="903881481365121859" onmouseenter="enter('903881481365121859');" onmouseout="out('903881481365121859');" style=""> 194         if (launcherIsReady()) {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 195         try {                                                                                            </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style=""> 196             backupFavorites(in, data, out, keys);                                                        </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style=""> 197             backupScreens(in, data, out, keys);                                                          </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style=""> 198             backupIcons(in, data, out, keys);                                                            </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style=""> 199             backupWidgets(in, data, out, keys);                                                          </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 200         } catch (IOException e) {                                                                        </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 201             Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202         }                                                                                                </span>
<span class="-3926881627572885151" onmouseenter="enter('-3926881627572885151');" onmouseout="out('-3926881627572885151');" style=""> 203             out.key = keys.toArray(new BackupProtos.Key[keys.size()]);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 204         } else {                                                                                         </span>
<span class="-3169554028816730380" onmouseenter="enter('-3169554028816730380');" onmouseout="out('-3169554028816730380');" style=""> 205             out = in;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 208 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 209 ||||||| BASE                                                                                             </span>
<span class="-6592699891127791070" onmouseenter="enter('-6592699891127791070');" onmouseout="out('-6592699891127791070');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210         out.key = keys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                            </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         writeJournal(newState, out);                                                                     </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 214 =======                                                                                                  </span>
<span class="-2322857033322689801" onmouseenter="enter('-2322857033322689801');" onmouseout="out('-2322857033322689801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215         out.key = keys.toArray(BackupProtos.Key.emptyArray());                                           </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 216 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 217         writeJournal(newState, out);                                                                     </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style=""> 218         Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219     }                                                                                                    </span>
<span  style=""> 220                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 221     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 222      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 223      *                                                                                                   </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style=""> 224      * &lt;P&gt;Keys may arrive in any order.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 225      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 226      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 227      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 228     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 229     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="6512574494365423863" onmouseenter="enter('6512574494365423863');" onmouseout="out('6512574494365423863');" style=""> 230         if (VERBOSE) Log.v(TAG, &quot;restoreEntity&quot;);                                                        </span>
<span class="-3135534305680812023" onmouseenter="enter('-3135534305680812023');" onmouseout="out('-3135534305680812023');" style=""> 231         byte[] buffer = new byte[512];                                                                   </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 232             String backupKey = data.getKey();                                                            </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 233             int dataSize = data.size();                                                                  </span>
<span class="2382724363113702568" onmouseenter="enter('2382724363113702568');" onmouseout="out('2382724363113702568');" style=""> 234             if (buffer.length &lt; dataSize) {                                                              </span>
<span class="8352923365759736689" onmouseenter="enter('8352923365759736689');" onmouseout="out('8352923365759736689');" style=""> 235                 buffer = new byte[dataSize];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236             }                                                                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 237             Key key = null;                                                                              </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 238         int bytesRead = 0;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 239         try {                                                                                            </span>
<span class="-6009766373469064808" onmouseenter="enter('-6009766373469064808');" onmouseout="out('-6009766373469064808');" style=""> 240             bytesRead = data.read(buffer, 0, dataSize);                                                  </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 241             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 242         } catch (IOException e) {                                                                        </span>
<span class="-1433318685117734483" onmouseenter="enter('-1433318685117734483');" onmouseout="out('-1433318685117734483');" style=""> 243             Log.e(TAG, &quot;failed to read entity from restore data&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 245         try {                                                                                            </span>
<span class="-3712536663698109807" onmouseenter="enter('-3712536663698109807');" onmouseout="out('-3712536663698109807');" style=""> 246             key = backupKeyToKey(backupKey);                                                             </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 247             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 248             switch (key.type) {                                                                          </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 249                 case Key.FAVORITE:                                                                       </span>
<span class="-8176296956220002371" onmouseenter="enter('-8176296956220002371');" onmouseout="out('-8176296956220002371');" style=""> 250                     restoreFavorite(key, buffer, dataSize, mKeys);                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 251                     break;                                                                               </span>
<span  style=""> 252                                                                                                          </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 253                 case Key.SCREEN:                                                                         </span>
<span class="-2747327735226535589" onmouseenter="enter('-2747327735226535589');" onmouseout="out('-2747327735226535589');" style=""> 254                     restoreScreen(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 255                     break;                                                                               </span>
<span  style=""> 256                                                                                                          </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 257                 case Key.ICON:                                                                           </span>
<span class="-5346432636907736484" onmouseenter="enter('-5346432636907736484');" onmouseout="out('-5346432636907736484');" style=""> 258                     restoreIcon(key, buffer, dataSize, mKeys);                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 259                     break;                                                                               </span>
<span  style=""> 260                                                                                                          </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 261                 case Key.WIDGET:                                                                         </span>
<span class="-7791331080833002730" onmouseenter="enter('-7791331080833002730');" onmouseout="out('-7791331080833002730');" style=""> 262                     restoreWidget(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 263                     break;                                                                               </span>
<span  style=""> 264                                                                                                          </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 265                 default:                                                                                 </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 266                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 267                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268             }                                                                                            </span>
<span class="2253361419748107399" onmouseenter="enter('2253361419748107399');" onmouseout="out('2253361419748107399');" style=""> 269         } catch (KeyParsingException e) {                                                                </span>
<span class="-562496230350101976" onmouseenter="enter('-562496230350101976');" onmouseout="out('-562496230350101976');" style=""> 270             Log.w(TAG, &quot;ignoring unparsable backup key: &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271         }                                                                                                </span>
<span  style=""> 272                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273     }                                                                                                    </span>
<span  style=""> 274                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 275     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 276      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 277      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 278      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 279      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 280     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 281     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style=""> 282         // clear the output journal time, to force a full backup to                                      </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style=""> 283         // will catch any changes the restore process might have made                                    </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 284         Journal out = new Journal();                                                                     </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style=""> 285         out.t = 0;                                                                                       </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 286 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-1416391524744539097" onmouseenter="enter('-1416391524744539097');" onmouseout="out('-1416391524744539097');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 287         out.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                     </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 288 ||||||| BASE                                                                                             </span>
<span class="4763841258929064204" onmouseenter="enter('4763841258929064204');" onmouseout="out('4763841258929064204');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289         out.key = mKeys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 290 =======                                                                                                  </span>
<span class="-4698345167913557184" onmouseenter="enter('-4698345167913557184');" onmouseout="out('-4698345167913557184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291         out.key = mKeys.toArray(BackupProtos.Key.emptyArray());                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 292 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 293         writeJournal(newState, out);                                                                     </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style=""> 294         Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                         </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 295         mKeys.clear();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 298     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 299      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 300      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 301      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 302      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 303      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 304      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 305      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 306      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 307      */                                                                                                  </span>
<span class="7131268859945314485" onmouseenter="enter('7131268859945314485');" onmouseout="out('7131268859945314485');" style=""> 308     private void backupFavorites(Journal in, BackupDataOutput data, Journal out,                         </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 309             ArrayList&lt;Key&gt; keys)                                                                         </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 310             throws IOException {                                                                         </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 311         // read the old ID set                                                                           </span>
<span class="1222708127935075798" onmouseenter="enter('1222708127935075798');" onmouseout="out('1222708127935075798');" style=""> 312         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.FAVORITE, in);                                      </span>
<span class="-6977244754148926833" onmouseenter="enter('-6977244754148926833');" onmouseout="out('-6977244754148926833');" style=""> 313         if (DEBUG) Log.d(TAG, &quot;favorite savedIds.size()=&quot; + savedIds.size());                            </span>
<span  style=""> 314                                                                                                          </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 315         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 316         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 317         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 318         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style=""> 319                 getUserSelectionArg(), null, null);                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 320         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 321         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 322             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 323             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 324                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 325                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 326                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 327                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 328                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 329                 currentIds.add(backupKey);                                                               </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style=""> 330                 if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                               </span>
<span class="7001118594211601319" onmouseenter="enter('7001118594211601319');" onmouseout="out('7001118594211601319');" style=""> 331                     byte[] blob = packFavorite(cursor);                                                  </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 332                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 333                 } else {                                                                                 </span>
<span class="8521612769654249253" onmouseenter="enter('8521612769654249253');" onmouseout="out('8521612769654249253');" style=""> 334                     if (VERBOSE) Log.v(TAG, &quot;favorite &quot; + id + &quot; was too old: &quot; + updateTime);           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 337         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 338             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339         }                                                                                                </span>
<span class="1671673783823377819" onmouseenter="enter('1671673783823377819');" onmouseout="out('1671673783823377819');" style=""> 340         if (DEBUG) Log.d(TAG, &quot;favorite currentIds.size()=&quot; + currentIds.size());                        </span>
<span  style=""> 341                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 342         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 343         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 344         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345     }                                                                                                    </span>
<span  style=""> 346                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 347     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 348      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 349      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 350      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 351      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 352      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 353      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 354      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 355      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 356      */                                                                                                  </span>
<span class="-1219322022397821860" onmouseenter="enter('-1219322022397821860');" onmouseout="out('-1219322022397821860');" style=""> 357     private void restoreFavorite(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {            </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style=""> 358         if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                         </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 359         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 360                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 361                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 362         if (!mRestoreEnabled) {                                                                          </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 363             if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 364             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365         }                                                                                                </span>
<span  style=""> 366                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 367         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 368             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4257623264587280611" onmouseenter="enter('4257623264587280611');" onmouseout="out('4257623264587280611');" style=""> 369             ContentValues values = unpackFavorite(buffer, 0, dataSize);                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style=""> 370             cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                    </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 371         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-2029498838376156786" onmouseenter="enter('-2029498838376156786');" onmouseout="out('-2029498838376156786');" style=""> 372             Log.e(TAG, &quot;failed to decode favorite&quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 376     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 377      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 378      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 379      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 380      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 381      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 382      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 383      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 384      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 385      */                                                                                                  </span>
<span class="1451925655210067336" onmouseenter="enter('1451925655210067336');" onmouseout="out('1451925655210067336');" style=""> 386     private void backupScreens(Journal in, BackupDataOutput data, Journal out,                           </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 387             ArrayList&lt;Key&gt; keys)                                                                         </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 388             throws IOException {                                                                         </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 389         // read the old ID set                                                                           </span>
<span class="-5113344219820420639" onmouseenter="enter('-5113344219820420639');" onmouseout="out('-5113344219820420639');" style=""> 390         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.SCREEN, in);                                        </span>
<span class="2041232408079356493" onmouseenter="enter('2041232408079356493');" onmouseout="out('2041232408079356493');" style=""> 391         if (DEBUG) Log.d(TAG, &quot;screen savedIds.size()=&quot; + savedIds.size());                              </span>
<span  style=""> 392                                                                                                          </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 393         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 394         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 395         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                        </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 396                 null, null, null);                                                                       </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 397         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 399             cursor.moveToPosition(-1);                                                                   </span>
<span class="-678679666922988121" onmouseenter="enter('-678679666922988121');" onmouseout="out('-678679666922988121');" style=""> 400             if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + in.t);                                     </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 401             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 402                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 403                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 404                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 405                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 406                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 407                 currentIds.add(backupKey);                                                               </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style=""> 408                 if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                               </span>
<span class="30579954798815384" onmouseenter="enter('30579954798815384');" onmouseout="out('30579954798815384');" style=""> 409                     byte[] blob = packScreen(cursor);                                                    </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 410                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 411                 } else {                                                                                 </span>
<span class="-8953978356667297356" onmouseenter="enter('-8953978356667297356');" onmouseout="out('-8953978356667297356');" style=""> 412                     if (VERBOSE) Log.v(TAG, &quot;screen &quot; + id + &quot; was too old: &quot; + updateTime);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 415         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 416             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417         }                                                                                                </span>
<span class="5642954527140901409" onmouseenter="enter('5642954527140901409');" onmouseout="out('5642954527140901409');" style=""> 418         if (DEBUG) Log.d(TAG, &quot;screen currentIds.size()=&quot; + currentIds.size());                          </span>
<span  style=""> 419                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 420         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 421         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 422         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423     }                                                                                                    </span>
<span  style=""> 424                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 425     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 426      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 427      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 428      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 429      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 430      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 431      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 432      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 433      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 434      */                                                                                                  </span>
<span class="-7250675390519322058" onmouseenter="enter('-7250675390519322058');" onmouseout="out('-7250675390519322058');" style=""> 435     private void restoreScreen(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style=""> 436         if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 437         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 438                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 439                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 440         if (!mRestoreEnabled) {                                                                          </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 441             if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 442             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443         }                                                                                                </span>
<span  style=""> 444                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 445         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 446             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4024968274688095863" onmouseenter="enter('4024968274688095863');" onmouseout="out('4024968274688095863');" style=""> 447             ContentValues values = unpackScreen(buffer, 0, dataSize);                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 448             cr.insert(WorkspaceScreens.CONTENT_URI, values);                                             </span>
<span  style=""> 449                                                                                                          </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 450         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1711302190142484945" onmouseenter="enter('-1711302190142484945');" onmouseout="out('-1711302190142484945');" style=""> 451             Log.e(TAG, &quot;failed to decode screen&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453     }                                                                                                    </span>
<span  style=""> 454                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 455     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 456      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 457      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 458      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 459      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 460      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 461      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 462      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 463      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 464      */                                                                                                  </span>
<span class="599391339335107838" onmouseenter="enter('599391339335107838');" onmouseout="out('599391339335107838');" style=""> 465     private void backupIcons(Journal in, BackupDataOutput data, Journal out,                             </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 466             ArrayList&lt;Key&gt; keys) throws IOException {                                                    </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 467         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style=""> 468         if (!initializeIconCache()) {                                                                    </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 469             dataChanged(); // try again later                                                            </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style=""> 470             if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 471             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 473         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 474         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 475         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span  style=""> 476                                                                                                          </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 477         // read the old ID set                                                                           </span>
<span class="5971436892288320278" onmouseenter="enter('5971436892288320278');" onmouseout="out('5971436892288320278');" style=""> 478         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.ICON, in);                                          </span>
<span class="-8460076387801577925" onmouseenter="enter('-8460076387801577925');" onmouseout="out('-8460076387801577925');" style=""> 479         if (DEBUG) Log.d(TAG, &quot;icon savedIds.size()=&quot; + savedIds.size());                                </span>
<span  style=""> 480                                                                                                          </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 481         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 482         int startRows = out.rows;                                                                        </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 483         if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                            </span>
<span  style=""> 484                                                                                                          </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style=""> 485         String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +      </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style=""> 486                 Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                    </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style=""> 487                 getUserSelectionArg();                                                                   </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 488         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 489                 where, null, null);                                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 490         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 491         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 492             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 493             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 494                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 495                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 496                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 497                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 498                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 499                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 500                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 501                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 502                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 503                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 504                         currentIds.add(backupKey);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 505                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 506                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507                     }                                                                                    </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 508                     if (savedIds.contains(backupKey)) {                                                  </span>
<span class="-8671855074852006779" onmouseenter="enter('-8671855074852006779');" onmouseout="out('-8671855074852006779');" style=""> 509                         if (VERBOSE) Log.v(TAG, &quot;already saved icon &quot; + backupKey);                      </span>
<span  style=""> 510                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 511                         // remember that we already backed this up previously                            </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 512                         keys.add(key);                                                                   </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 513                     } else if (backupKey != null) {                                                      </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 514                         if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                     </span>
<span class="-9006656974661932570" onmouseenter="enter('-9006656974661932570');" onmouseout="out('-9006656974661932570');" style=""> 515                         if ((out.rows - startRows) &lt; MAX_ICONS_PER_PASS) {                               </span>
<span class="8708467958147908091" onmouseenter="enter('8708467958147908091');" onmouseout="out('8708467958147908091');" style=""> 516                             if (VERBOSE) Log.v(TAG, &quot;saving icon &quot; + backupKey);                         </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 517                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 518                             keys.add(key);                                                               </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style=""> 519                             if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {         </span>
<span class="-1917944616523216064" onmouseenter="enter('-1917944616523216064');" onmouseout="out('-1917944616523216064');" style=""> 520                                 byte[] blob = packIcon(dpi, icon);                                       </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 521                                 writeRowToBackup(key, blob, out, data);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 523                         } else {                                                                         </span>
<span class="-7058657490284379944" onmouseenter="enter('-7058657490284379944');" onmouseout="out('-7058657490284379944');" style=""> 524                             if (VERBOSE) Log.d(TAG, &quot;deferring icon backup &quot; + backupKey);               </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 525                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 526                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 529                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 530                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 531                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 532                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533                 }                                                                                        </span>
<span  style=""> 534                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 536         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 537             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538         }                                                                                                </span>
<span class="2508143952868696771" onmouseenter="enter('2508143952868696771');" onmouseout="out('2508143952868696771');" style=""> 539         if (DEBUG) Log.d(TAG, &quot;icon currentIds.size()=&quot; + currentIds.size());                            </span>
<span  style=""> 540                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 541         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 542         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 543         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544     }                                                                                                    </span>
<span  style=""> 545                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 546     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 547      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 548      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 549      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 550      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 551      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 552      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 553      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 554      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 555      */                                                                                                  </span>
<span class="3418786705842277190" onmouseenter="enter('3418786705842277190');" onmouseout="out('3418786705842277190');" style=""> 556     private void restoreIcon(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style=""> 557         if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                             </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 558         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 559                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span  style=""> 560                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 561         try {                                                                                            </span>
<span class="-1273277075539844188" onmouseenter="enter('-1273277075539844188');" onmouseout="out('-1273277075539844188');" style=""> 562             Resource res = unpackIcon(buffer, 0, dataSize);                                              </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 563             if (DEBUG) {                                                                                 </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style=""> 564                 Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565             }                                                                                            </span>
<span class="-3352481463774338191" onmouseenter="enter('-3352481463774338191');" onmouseout="out('-3352481463774338191');" style=""> 566             if (DEBUG_PAYLOAD) {                                                                         </span>
<span class="-4521366973706198444" onmouseenter="enter('-4521366973706198444');" onmouseout="out('-4521366973706198444');" style=""> 567                 Log.d(TAG, &quot;read &quot; +                                                                     </span>
<span class="-9086841055072808764" onmouseenter="enter('-9086841055072808764');" onmouseout="out('-9086841055072808764');" style=""> 568                     Base64.encodeToString(res.data, 0, res.data.length,                                  </span>
<span class="6738045639769732117" onmouseenter="enter('6738045639769732117');" onmouseout="out('6738045639769732117');" style=""> 569                             Base64.NO_WRAP));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570             }                                                                                            </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 571             Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                   </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 572             if (icon == null) {                                                                          </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 573                 Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574             }                                                                                            </span>
<span  style=""> 575                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 576             if (!mRestoreEnabled) {                                                                      </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 577                 if (VERBOSE) {                                                                           </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 578                     Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 580                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 581             } else {                                                                                     </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style=""> 582                 if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                         </span>
<span class="8408986404382537202" onmouseenter="enter('8408986404382537202');" onmouseout="out('8408986404382537202');" style=""> 583                 IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name),             </span>
<span class="6231676971894754004" onmouseenter="enter('6231676971894754004');" onmouseout="out('6231676971894754004');" style=""> 584                         icon, res.dpi);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 586         } catch (IOException e) {                                                                        </span>
<span class="2331121584648893440" onmouseenter="enter('2331121584648893440');" onmouseout="out('2331121584648893440');" style=""> 587             Log.d(TAG, &quot;failed to save restored icon for: &quot; + key.name, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589     }                                                                                                    </span>
<span  style=""> 590                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 591     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 592      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 593      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 594      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 595      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 596      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 597      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 598      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 599      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 600      */                                                                                                  </span>
<span class="-982237492458374713" onmouseenter="enter('-982237492458374713');" onmouseout="out('-982237492458374713');" style=""> 601     private void backupWidgets(Journal in, BackupDataOutput data, Journal out,                           </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 602             ArrayList&lt;Key&gt; keys) throws IOException {                                                    </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 603         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 604         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style=""> 605         if (appState == null || !initializeIconCache()) {                                                </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style=""> 606             Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 607             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 609         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 610         final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                     </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 611         final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);               </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 612         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 613         final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                      </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style=""> 614         if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                    </span>
<span  style=""> 615                                                                                                          </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 616         // read the old ID set                                                                           </span>
<span class="-852429832136699702" onmouseenter="enter('-852429832136699702');" onmouseout="out('-852429832136699702');" style=""> 617         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.WIDGET, in);                                        </span>
<span class="-2616909315275324814" onmouseenter="enter('-2616909315275324814');" onmouseout="out('-2616909315275324814');" style=""> 618         if (DEBUG) Log.d(TAG, &quot;widgets savedIds.size()=&quot; + savedIds.size());                             </span>
<span  style=""> 619                                                                                                          </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 620         int startRows = out.rows;                                                                        </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 621         if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                            </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style=""> 622         String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;               </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style=""> 623                 + getUserSelectionArg();                                                                 </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 624         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                             </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 625                 where, null, null);                                                                      </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 626         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 627         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 628             cursor.moveToPosition(-1);                                                                   </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 629             while(cursor.moveToNext()) {                                                                 </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 630                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 631                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 632                 final int spanX = cursor.getInt(SPANX_INDEX);                                            </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 633                 final int spanY = cursor.getInt(SPANY_INDEX);                                            </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 634                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 635                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 636                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 637                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 638                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 639                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 640                     currentIds.add(backupKey);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 641                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 642                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643                 }                                                                                        </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 644                 if (savedIds.contains(backupKey)) {                                                      </span>
<span class="-8428771999657462146" onmouseenter="enter('-8428771999657462146');" onmouseout="out('-8428771999657462146');" style=""> 645                     if (VERBOSE) Log.v(TAG, &quot;already saved widget &quot; + backupKey);                        </span>
<span  style=""> 646                                                                                                          </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 647                     // remember that we already backed this up previously                                </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 648                     keys.add(key);                                                                       </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 649                 } else if (backupKey != null) {                                                          </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 650                     if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                         </span>
<span class="-5873889847669281246" onmouseenter="enter('-5873889847669281246');" onmouseout="out('-5873889847669281246');" style=""> 651                     if ((out.rows - startRows) &lt; MAX_WIDGETS_PER_PASS) {                                 </span>
<span class="-4960779571857458493" onmouseenter="enter('-4960779571857458493');" onmouseout="out('-4960779571857458493');" style=""> 652                         if (VERBOSE) Log.v(TAG, &quot;saving widget &quot; + backupKey);                           </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style=""> 653                         previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                        </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style=""> 654                                 spanY * profile.cellHeightPx, widgetSpacingLayout);                      </span>
<span class="-4963176699005952762" onmouseenter="enter('-4963176699005952762');" onmouseout="out('-4963176699005952762');" style=""> 655                         byte[] blob = packWidget(dpi, previewLoader, mIconCache, provider);              </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 656                         keys.add(key);                                                                   </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 657                         writeRowToBackup(key, blob, out, data);                                          </span>
<span  style=""> 658                                                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 659                     } else {                                                                             </span>
<span class="-2793925555163198542" onmouseenter="enter('-2793925555163198542');" onmouseout="out('-2793925555163198542');" style=""> 660                         if (VERBOSE) Log.d(TAG, &quot;deferring widget backup &quot; + backupKey);                 </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 661                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 662                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 663                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 666         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 667             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668         }                                                                                                </span>
<span class="7930052468528100382" onmouseenter="enter('7930052468528100382');" onmouseout="out('7930052468528100382');" style=""> 669         if (DEBUG) Log.d(TAG, &quot;widget currentIds.size()=&quot; + currentIds.size());                          </span>
<span  style=""> 670                                                                                                          </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 671         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 672         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 673         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674     }                                                                                                    </span>
<span  style=""> 675                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 676     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 677      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 678      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 679      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 680      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 681      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 682      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 683      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 684      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 685      */                                                                                                  </span>
<span class="-2743597305724887598" onmouseenter="enter('-2743597305724887598');" onmouseout="out('-2743597305724887598');" style=""> 686     private void restoreWidget(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style=""> 687         if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                           </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 688         if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                         </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 689                 Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 690         try {                                                                                            </span>
<span class="6880516999183343771" onmouseenter="enter('6880516999183343771');" onmouseout="out('6880516999183343771');" style=""> 691             Widget widget = unpackWidget(buffer, 0, dataSize);                                           </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 692             if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                        </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 693             if (widget.icon.data != null)  {                                                             </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 694                 Bitmap icon = BitmapFactory                                                              </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 695                         .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                  </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 696                 if (icon == null) {                                                                      </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 697                     Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 698                 } else {                                                                                 </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style=""> 699                     IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),  </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style=""> 700                             icon, widget.icon.dpi);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 701                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 702             }                                                                                            </span>
<span  style=""> 703                                                                                                          </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 704             if (!mRestoreEnabled) {                                                                      </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style=""> 705                 if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 706                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 707             } else {                                                                                     </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 708                 // future site of widget table mutation                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709             }                                                                                            </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 710         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1867545559162052515" onmouseenter="enter('-1867545559162052515');" onmouseout="out('-1867545559162052515');" style=""> 711             Log.e(TAG, &quot;failed to decode widget&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713     }                                                                                                    </span>
<span  style=""> 714                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 715     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 716      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 717      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 718      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 719      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 720     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 721         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 722         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 723         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 724         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 725         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726     }                                                                                                    </span>
<span  style=""> 727                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 728     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 729      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 730      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 731      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 732      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 733     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 734         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 735         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 736         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 737         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 738         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739     }                                                                                                    </span>
<span  style=""> 740                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 741     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 742     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 743         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744     }                                                                                                    </span>
<span  style=""> 745                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 746     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="3565153267272331252" onmouseenter="enter('3565153267272331252');" onmouseout="out('3565153267272331252');" style=""> 747     private Key backupKeyToKey(String backupKey) throws KeyParsingException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 748         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 749             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 750             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 751                 key = null;                                                                              </span>
<span class="7886037428699907314" onmouseenter="enter('7886037428699907314');" onmouseout="out('7886037428699907314');" style=""> 752                 throw new KeyParsingException(&quot;invalid key read from stream&quot; + backupKey);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 754             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 755         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 756             throw new KeyParsingException(e);                                                            </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 757         } catch (IllegalArgumentException e) {                                                           </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 758             throw new KeyParsingException(e);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 759         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760     }                                                                                                    </span>
<span  style=""> 761                                                                                                          </span>
<span class="-9026907230628270971" onmouseenter="enter('-9026907230628270971');" onmouseout="out('-9026907230628270971');" style=""> 762     private String getKeyName(Key key) {                                                                 </span>
<span class="-7992041348690575973" onmouseenter="enter('-7992041348690575973');" onmouseout="out('-7992041348690575973');" style=""> 763         if (TextUtils.isEmpty(key.name)) {                                                               </span>
<span class="3948647275026092398" onmouseenter="enter('3948647275026092398');" onmouseout="out('3948647275026092398');" style=""> 764             return Long.toString(key.id);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 765         } else {                                                                                         </span>
<span class="-8847809052433174647" onmouseenter="enter('-8847809052433174647');" onmouseout="out('-8847809052433174647');" style=""> 766             return key.name;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767         }                                                                                                </span>
<span  style=""> 768                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769     }                                                                                                    </span>
<span  style=""> 770                                                                                                          </span>
<span class="-3302500785890956613" onmouseenter="enter('-3302500785890956613');" onmouseout="out('-3302500785890956613');" style=""> 771     private String geKeyType(Key key) {                                                                  </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 772         switch (key.type) {                                                                              </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 773             case Key.FAVORITE:                                                                           </span>
<span class="-6693583981393703832" onmouseenter="enter('-6693583981393703832');" onmouseout="out('-6693583981393703832');" style=""> 774                 return &quot;favorite&quot;;                                                                       </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 775             case Key.SCREEN:                                                                             </span>
<span class="-935980872443992001" onmouseenter="enter('-935980872443992001');" onmouseout="out('-935980872443992001');" style=""> 776                 return &quot;screen&quot;;                                                                         </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 777             case Key.ICON:                                                                               </span>
<span class="-6438997020167939033" onmouseenter="enter('-6438997020167939033');" onmouseout="out('-6438997020167939033');" style=""> 778                 return &quot;icon&quot;;                                                                           </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 779             case Key.WIDGET:                                                                             </span>
<span class="875584635155758752" onmouseenter="enter('875584635155758752');" onmouseout="out('875584635155758752');" style=""> 780                 return &quot;widget&quot;;                                                                         </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 781             default:                                                                                     </span>
<span class="-9117731612531303028" onmouseenter="enter('-9117731612531303028');" onmouseout="out('-9117731612531303028');" style=""> 782                 return &quot;anonymous&quot;;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784     }                                                                                                    </span>
<span  style=""> 785                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 786     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 787     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 788         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 789         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 790         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 791         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 792         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 793             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 795         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796     }                                                                                                    </span>
<span  style=""> 797                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 798     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4378147688590970666" onmouseenter="enter('-4378147688590970666');" onmouseout="out('-4378147688590970666');" style=""> 799     private byte[] packFavorite(Cursor c) {                                                              </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 800         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 801         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 802         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 803         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 804         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 805         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 806         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 807         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 808         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 809         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 810             String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                        </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 811             if (!TextUtils.isEmpty(iconPackage)) {                                                       </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 812                 favorite.iconPackage = iconPackage;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813             }                                                                                            </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 814             String iconResource = c.getString(ICON_RESOURCE_INDEX);                                      </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 815             if (!TextUtils.isEmpty(iconResource)) {                                                      </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 816                 favorite.iconResource = iconResource;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 819         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 820             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 821             if (blob != null &amp;&amp; blob.length &gt; 0) {                                                       </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 822                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824         }                                                                                                </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 825         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 826         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 827             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 829         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 830         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 831             try {                                                                                        </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 832                 Intent intent = Intent.parseUri(intentDescription, 0);                                   </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 833                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 834                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 835             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 836                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837            }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 839         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 840         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 841             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 842             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 843             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 844                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846         }                                                                                                </span>
<span  style=""> 847                                                                                                          </span>
<span class="-8315891601108782355" onmouseenter="enter('-8315891601108782355');" onmouseout="out('-8315891601108782355');" style=""> 848         return writeCheckedBytes(favorite);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849     }                                                                                                    </span>
<span  style=""> 850                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 851     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="-5696583694055723136" onmouseenter="enter('-5696583694055723136');" onmouseout="out('-5696583694055723136');" style=""> 852     private ContentValues unpackFavorite(byte[] buffer, int offset, int dataSize)                        </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 853             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 854         Favorite favorite = new Favorite();                                                              </span>
<span class="1666030682203596411" onmouseenter="enter('1666030682203596411');" onmouseout="out('1666030682203596411');" style=""> 855         MessageNano.mergeFrom(favorite, readCheckedBytes(buffer, offset, dataSize));                     </span>
<span class="-8746500302928937436" onmouseenter="enter('-8746500302928937436');" onmouseout="out('-8746500302928937436');" style=""> 856         if (VERBOSE) Log.v(TAG, &quot;unpacked favorite &quot; + favorite.itemType + &quot;, &quot; +                        </span>
<span class="-5821514453449777802" onmouseenter="enter('-5821514453449777802');" onmouseout="out('-5821514453449777802');" style=""> 857                 (TextUtils.isEmpty(favorite.title) ? favorite.id : favorite.title));                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 858         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 859         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 860         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 861         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 862         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 863         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 864         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 865         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 866         values.put(Favorites.ICON_TYPE, favorite.iconType);                                              </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 867         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 868             values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                    </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 869             values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 871         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 872             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873         }                                                                                                </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 874         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 875             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 876         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 877             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 879         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 880             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 882         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span  style=""> 883                                                                                                          </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 884         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style=""> 885         long userSerialNumber =                                                                          </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style=""> 886                 UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);            </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 887         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span  style=""> 888                                                                                                          </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 889         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 890             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 891                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 893             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style=""> 894             values.put(LauncherSettings.Favorites.RESTORED,                                              </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style=""> 895                     LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                            </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style=""> 896                     LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                      </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style=""> 897                     LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 898         } else {                                                                                         </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 899             // Let LauncherModel know we&#x27;ve been here.                                                   </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 900             values.put(LauncherSettings.Favorites.RESTORED, 1);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 901         }                                                                                                </span>
<span  style=""> 902                                                                                                          </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 903         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 904     }                                                                                                    </span>
<span  style=""> 905                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 906     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-1055302898918768280" onmouseenter="enter('-1055302898918768280');" onmouseout="out('-1055302898918768280');" style=""> 907     private byte[] packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 908         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 909         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 910         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span  style=""> 911                                                                                                          </span>
<span class="-8008243495242652634" onmouseenter="enter('-8008243495242652634');" onmouseout="out('-8008243495242652634');" style=""> 912         return writeCheckedBytes(screen);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 913     }                                                                                                    </span>
<span  style=""> 914                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 915     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="6886240294794970082" onmouseenter="enter('6886240294794970082');" onmouseout="out('6886240294794970082');" style=""> 916     private ContentValues unpackScreen(byte[] buffer, int offset, int dataSize)                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 917             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 918         Screen screen = new Screen();                                                                    </span>
<span class="5997669843530195787" onmouseenter="enter('5997669843530195787');" onmouseout="out('5997669843530195787');" style=""> 919         MessageNano.mergeFrom(screen, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-8455088715171122130" onmouseenter="enter('-8455088715171122130');" onmouseout="out('-8455088715171122130');" style=""> 920         if (VERBOSE) Log.v(TAG, &quot;unpacked screen &quot; + screen.id + &quot;/&quot; + screen.rank);                     </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 921         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 922         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 923         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 924         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925     }                                                                                                    </span>
<span  style=""> 926                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 927     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="1129196888280545123" onmouseenter="enter('1129196888280545123');" onmouseout="out('1129196888280545123');" style=""> 928     private byte[] packIcon(int dpi, Bitmap icon) {                                                      </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 929         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 930         res.dpi = dpi;                                                                                   </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 931         ByteArrayOutputStream os = new ByteArrayOutputStream();                                          </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 932         if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 933             res.data = os.toByteArray();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 934         }                                                                                                </span>
<span class="-2324310893561295790" onmouseenter="enter('-2324310893561295790');" onmouseout="out('-2324310893561295790');" style=""> 935         return writeCheckedBytes(res);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 936     }                                                                                                    </span>
<span  style=""> 937                                                                                                          </span>
<span class="-8685556113116579868" onmouseenter="enter('-8685556113116579868');" onmouseout="out('-8685556113116579868');" style=""> 938     /** Deserialize an icon resource from persistence, after verifying checksum wrapper. */              </span>
<span class="-6700621194159108538" onmouseenter="enter('-6700621194159108538');" onmouseout="out('-6700621194159108538');" style=""> 939     private static Resource unpackIcon(byte[] buffer, int offset, int dataSize)                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 940             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 941         Resource res = new Resource();                                                                   </span>
<span class="760491121676290671" onmouseenter="enter('760491121676290671');" onmouseout="out('760491121676290671');" style=""> 942         MessageNano.mergeFrom(res, readCheckedBytes(buffer, offset, dataSize));                          </span>
<span class="4102854592882680519" onmouseenter="enter('4102854592882680519');" onmouseout="out('4102854592882680519');" style=""> 943         if (VERBOSE) Log.v(TAG, &quot;unpacked icon &quot; + res.dpi + &quot;/&quot; + res.data.length);                     </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 944         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 945     }                                                                                                    </span>
<span  style=""> 946                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 947     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-476988516990873332" onmouseenter="enter('-476988516990873332');" onmouseout="out('-476988516990873332');" style=""> 948     private byte[] packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,           </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style=""> 949             ComponentName provider) {                                                                    </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style=""> 950         final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 951         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 952         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 953         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 954         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 955         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 956             widget.icon = new Resource();                                                                </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style=""> 957             Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);       </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 958             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 959             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 960             if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                            </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style=""> 961                 widget.icon.data = os.toByteArray();                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 962                 widget.icon.dpi = dpi;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 965         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style=""> 966             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style=""> 967             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 968             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style=""> 969             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style=""> 970                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style=""> 971                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 973         }                                                                                                </span>
<span class="-6092547598221684616" onmouseenter="enter('-6092547598221684616');" onmouseout="out('-6092547598221684616');" style=""> 974         return writeCheckedBytes(widget);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975     }                                                                                                    </span>
<span  style=""> 976                                                                                                          </span>
<span class="2267681228426618803" onmouseenter="enter('2267681228426618803');" onmouseout="out('2267681228426618803');" style=""> 977     /** Deserialize a widget from persistence, after verifying checksum wrapper. */                      </span>
<span class="478875287574324925" onmouseenter="enter('478875287574324925');" onmouseout="out('478875287574324925');" style=""> 978     private Widget unpackWidget(byte[] buffer, int offset, int dataSize)                                 </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 979             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 980         Widget widget = new Widget();                                                                    </span>
<span class="-594535766013271981" onmouseenter="enter('-594535766013271981');" onmouseout="out('-594535766013271981');" style=""> 981         MessageNano.mergeFrom(widget, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-6614366492544728686" onmouseenter="enter('-6614366492544728686');" onmouseout="out('-6614366492544728686');" style=""> 982         if (VERBOSE) Log.v(TAG, &quot;unpacked widget &quot; + widget.provider);                                   </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style=""> 983         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984     }                                                                                                    </span>
<span  style=""> 985                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 986     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style=""> 987      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 988      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style=""> 989      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style=""> 990      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 991      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style=""> 992      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style=""> 993      * @return a Journal protocol buffer                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 994      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style=""> 995     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 996         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style=""> 997         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 998             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 999         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1000         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1001         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1002             int availableBytes = inStream.available();                                                   </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="">1003             if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                        </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1004             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1005                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1006                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1007                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1008                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1009                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1010                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1011                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1012                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1013                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1014                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1015                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1016                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1017                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1018                             bytesRead += result;                                                         </span>
<span class="-8507805265236222004" onmouseenter="enter('-8507805265236222004');" onmouseout="out('-8507805265236222004');" style="">1019                             if (DEBUG &amp;&amp; (bytesRead % 100 == 0)) {                                       </span>
<span class="3263531768832665724" onmouseenter="enter('3263531768832665724');" onmouseout="out('3263531768832665724');" style="">1020                                 Log.d(TAG, &quot;read some bytes: &quot; + bytesRead);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1021                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1022                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1023                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1024                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1025                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1027                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1028                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1029                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1030                     }                                                                                    </span>
<span  style="">1031                                                                                                          </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1032                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1033                     try {                                                                                </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style="">1034                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));          </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1035                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1036                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1037                         availableBytes = 0;                                                              </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="">1038                         if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);              </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1039                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1040                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1041                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1042                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1043                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1044                 }                                                                                        </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1045                 if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                               </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1046                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1047                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1048                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1049             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1050         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1051             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1052         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1053             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1054                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1055             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1056                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1057             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1058         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1059         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1060     }                                                                                                    </span>
<span  style="">1061                                                                                                          </span>
<span class="1857887861945457945" onmouseenter="enter('1857887861945457945');" onmouseout="out('1857887861945457945');" style="">1062     private void writeRowToBackup(Key key, byte[] blob, Journal out,                                     </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1063             BackupDataOutput data) throws IOException {                                                  </span>
<span class="-8570409028541836443" onmouseenter="enter('-8570409028541836443');" onmouseout="out('-8570409028541836443');" style="">1064         String backupKey = keyToBackupKey(key);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1065         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1066         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="7907644802080103671" onmouseenter="enter('7907644802080103671');" onmouseout="out('7907644802080103671');" style="">1067         out.rows++;                                                                                      </span>
<span class="-565229434051730696" onmouseenter="enter('-565229434051730696');" onmouseout="out('-565229434051730696');" style="">1068         out.bytes += blob.length;                                                                        </span>
<span class="7477494328045094252" onmouseenter="enter('7477494328045094252');" onmouseout="out('7477494328045094252');" style="">1069         if (VERBOSE) Log.v(TAG, &quot;saving &quot; + geKeyType(key) + &quot; &quot; + backupKey + &quot;: &quot; +                    </span>
<span class="188331799762465007" onmouseenter="enter('188331799762465007');" onmouseout="out('188331799762465007');" style="">1070                 getKeyName(key) + &quot;/&quot; + blob.length);                                                    </span>
<span class="9073034288274959985" onmouseenter="enter('9073034288274959985');" onmouseout="out('9073034288274959985');" style="">1071         if(DEBUG_PAYLOAD) {                                                                              </span>
<span class="-7017497320803160772" onmouseenter="enter('-7017497320803160772');" onmouseout="out('-7017497320803160772');" style="">1072             String encoded = Base64.encodeToString(blob, 0, blob.length, Base64.NO_WRAP);                </span>
<span class="-998151031530761193" onmouseenter="enter('-998151031530761193');" onmouseout="out('-998151031530761193');" style="">1073             final int chunkSize = 1024;                                                                  </span>
<span class="4942461364046774481" onmouseenter="enter('4942461364046774481');" onmouseout="out('4942461364046774481');" style="">1074             for (int offset = 0; offset &lt; encoded.length(); offset += chunkSize) {                       </span>
<span class="7644631075752865640" onmouseenter="enter('7644631075752865640');" onmouseout="out('7644631075752865640');" style="">1075                 int end = offset + chunkSize;                                                            </span>
<span class="-7525499051306958146" onmouseenter="enter('-7525499051306958146');" onmouseout="out('-7525499051306958146');" style="">1076                 end = Math.min(end, encoded.length());                                                   </span>
<span class="-5356592555400346432" onmouseenter="enter('-5356592555400346432');" onmouseout="out('-5356592555400346432');" style="">1077                 Log.w(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1078             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1079         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080     }                                                                                                    </span>
<span  style="">1081                                                                                                          </span>
<span class="2702098317253578682" onmouseenter="enter('2702098317253578682');" onmouseout="out('2702098317253578682');" style="">1082     private Set&lt;String&gt; getSavedIdsByType(int type, Journal in) {                                        </span>
<span class="-49943749293500978" onmouseenter="enter('-49943749293500978');" onmouseout="out('-49943749293500978');" style="">1083         Set&lt;String&gt; savedIds = new HashSet&lt;String&gt;();                                                    </span>
<span class="-7898804644582645533" onmouseenter="enter('-7898804644582645533');" onmouseout="out('-7898804644582645533');" style="">1084         for(int i = 0; i &lt; in.key.length; i++) {                                                         </span>
<span class="8349919170880076083" onmouseenter="enter('8349919170880076083');" onmouseout="out('8349919170880076083');" style="">1085             Key key = in.key[i];                                                                         </span>
<span class="-5995133320761897029" onmouseenter="enter('-5995133320761897029');" onmouseout="out('-5995133320761897029');" style="">1086             if (key.type == type) {                                                                      </span>
<span class="3576075164739381606" onmouseenter="enter('3576075164739381606');" onmouseout="out('3576075164739381606');" style="">1087                 savedIds.add(keyToBackupKey(key));                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1088             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1089         }                                                                                                </span>
<span class="-5348725939705536872" onmouseenter="enter('-5348725939705536872');" onmouseout="out('-5348725939705536872');" style="">1090         return savedIds;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1091     }                                                                                                    </span>
<span  style="">1092                                                                                                          </span>
<span class="-695874875282614773" onmouseenter="enter('-695874875282614773');" onmouseout="out('-695874875282614773');" style="">1093     private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data)               </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1094             throws IOException {                                                                         </span>
<span class="-4851536707927267136" onmouseenter="enter('-4851536707927267136');" onmouseout="out('-4851536707927267136');" style="">1095         int rows = 0;                                                                                    </span>
<span class="-713409252568618308" onmouseenter="enter('-713409252568618308');" onmouseout="out('-713409252568618308');" style="">1096         for(String deleted: deletedIds) {                                                                </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style="">1097             if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                 </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style="">1098             data.writeEntityHeader(deleted, -1);                                                         </span>
<span class="3376167913476125145" onmouseenter="enter('3376167913476125145');" onmouseout="out('3376167913476125145');" style="">1099             rows++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1100         }                                                                                                </span>
<span class="7304487908762689425" onmouseenter="enter('7304487908762689425');" onmouseout="out('7304487908762689425');" style="">1101         return rows;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102     }                                                                                                    </span>
<span  style="">1103                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1104     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1105      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1106      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1107      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1108      * in that case, do a full backup.                                                                   </span>
<span  style="">1109                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1110      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1111      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1112      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1113     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1114         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1115         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1116             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1117             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1118             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1119             outStream.close();                                                                           </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="">1120             if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1121         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1122             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1123         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1124     }                                                                                                    </span>
<span  style="">1125                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1126     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1127     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1128         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1129         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1130         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1131         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1132         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1133         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1134     }                                                                                                    </span>
<span  style="">1135                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1136     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="5021637008110274727" onmouseenter="enter('5021637008110274727');" onmouseout="out('5021637008110274727');" style="">1137     private static byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize)                      </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1138             throws InvalidProtocolBufferNanoException {                                                  </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1139         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-3959921631204962332" onmouseenter="enter('-3959921631204962332');" onmouseout="out('-3959921631204962332');" style="">1140         MessageNano.mergeFrom(wrapper, buffer, offset, dataSize);                                        </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1141         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1142         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1143         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1144             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1145         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1146         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1147     }                                                                                                    </span>
<span  style="">1148                                                                                                          </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style="">1149     private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                   </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style="">1150         if (mWidgetMap == null) {                                                                        </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style="">1151             List&lt;AppWidgetProviderInfo&gt; widgets =                                                        </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="">1152                     AppWidgetManager.getInstance(mContext).getInstalledProviders();                      </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="">1153             mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());              </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="">1154             for (AppWidgetProviderInfo info : widgets) {                                                 </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="">1155                 mWidgetMap.put(info.provider, info);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1156             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1157         }                                                                                                </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="">1158         return mWidgetMap.get(component);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1159     }                                                                                                    </span>
<span  style="">1160                                                                                                          </span>
<span  style="">1161                                                                                                          </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="">1162     private boolean initializeIconCache() {                                                              </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="">1163         if (mIconCache != null) {                                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1164             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165         }                                                                                                </span>
<span  style="">1166                                                                                                          </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="">1167         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="">1168         if (appState == null) {                                                                          </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="">1169             Throwable stackTrace = new Throwable();                                                      </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="">1170             stackTrace.fillInStackTrace();                                                               </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="">1171             Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1172             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1173         }                                                                                                </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="">1174         mIconCache = appState.getIconCache();                                                            </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="">1175         return mIconCache != null;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176     }                                                                                                    </span>
<span  style="">1177                                                                                                          </span>
<span  style="">1178                                                                                                          </span>
<span class="-342082428602666517" onmouseenter="enter('-342082428602666517');" onmouseout="out('-342082428602666517');" style="">1179    // check if the launcher is in a state to support backup                                              </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1180     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1181         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1182         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1183         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1184             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1185             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1186         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1187         cursor.close();                                                                                  </span>
<span  style="">1188                                                                                                          </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="">1189         if (!initializeIconCache()) {                                                                    </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1190             // launcher services are unavailable, try again later                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="">1191             dataChanged();                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1192             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1193         }                                                                                                </span>
<span  style="">1194                                                                                                          </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1195         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1196     }                                                                                                    </span>
<span  style="">1197                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1198     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1199         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1200                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1201     }                                                                                                    </span>
<span  style="">1202                                                                                                          </span>
<span class="9065001176904994716" onmouseenter="enter('9065001176904994716');" onmouseout="out('9065001176904994716');" style="">1203     private class KeyParsingException extends Throwable {                                                </span>
<span class="6514561846306478812" onmouseenter="enter('6514561846306478812');" onmouseout="out('6514561846306478812');" style="">1204         private KeyParsingException(Throwable cause) {                                                   </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1205             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span  style="">1207                                                                                                          </span>
<span class="8465822963319034792" onmouseenter="enter('8465822963319034792');" onmouseout="out('8465822963319034792');" style="">1208         public KeyParsingException(String reason) {                                                      </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1209             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1210         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1211     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1212 }                                                                                                        </span>



































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2  * Copyright (C) 2013 The Android Open Source Project                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  16 package com.android.launcher3;                                                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  18 import android.app.backup.BackupDataInputStream;                                                         </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  19 import android.app.backup.BackupDataOutput;                                                              </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  20 import android.app.backup.BackupHelper;                                                                  </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  21 import android.app.backup.BackupManager;                                                                 </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="">  22 import android.appwidget.AppWidgetManager;                                                               </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">  23 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  24 import android.content.ComponentName;                                                                    </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  25 import android.content.ContentResolver;                                                                  </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">  26 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  27 import android.content.Context;                                                                          </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  28 import android.content.Intent;                                                                           </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  29 import android.database.Cursor;                                                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  30 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  31 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  32 import android.graphics.drawable.Drawable;                                                               </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  33 import android.os.ParcelFileDescriptor;                                                                  </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  34 import android.text.TextUtils;                                                                           </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  35 import android.util.Base64;                                                                              </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  36 import android.util.Log;                                                                                 </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  37 import com.android.launcher3.LauncherSettings.Favorites;                                                 </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  38 import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                          </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  39 import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                         </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  40 import com.android.launcher3.backup.BackupProtos.Favorite;                                               </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  41 import com.android.launcher3.backup.BackupProtos.Journal;                                                </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  42 import com.android.launcher3.backup.BackupProtos.Key;                                                    </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  43 import com.android.launcher3.backup.BackupProtos.Resource;                                               </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  44 import com.android.launcher3.backup.BackupProtos.Screen;                                                 </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  45 import com.android.launcher3.backup.BackupProtos.Widget;                                                 </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  46 import com.android.launcher3.backup.BackupProtos;                                                        </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="">  47 import com.android.launcher3.compat.UserHandleCompat;                                                    </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="">  48 import com.android.launcher3.compat.UserManagerCompat;                                                   </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  49 import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                      </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  50 import com.google.protobuf.nano.MessageNano;                                                             </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  51 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  52 import java.io.FileInputStream;                                                                          </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  53 import java.io.FileOutputStream;                                                                         </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  54 import java.io.IOException;                                                                              </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  55 import java.net.URISyntaxException;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  56 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  57 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  58 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  59 import java.util.List;                                                                                   </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  60 import java.util.Set;                                                                                    </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  61 import java.util.zip.CRC32;                                                                              </span>
<span  style="">  62                                                                                                          </span>
<span  style="">  63                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  64 /**                                                                                                      </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  65  * Persist the launcher home state across calamities.                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  66  */                                                                                                      </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  67 public class LauncherBackupHelper implements BackupHelper {                                              </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  68     private static final String TAG = &quot;LauncherBackupHelper&quot;;                                            </span>
<span  style="">  69                                                                                                          </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="">  70     private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                            </span>
<span  style="">  71                                                                                                          </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="">  72     private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                </span>
<span  style="">  73                                                                                                          </span>
<span class="8681536538150810745" onmouseenter="enter('8681536538150810745');" onmouseout="out('8681536538150810745');" style="">  74     private static final boolean DEBUG_PAYLOAD = false;                                                  </span>
<span  style="">  75                                                                                                          </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  76     private static final int MAX_JOURNAL_SIZE = 1000000;                                                 </span>
<span  style="">  77                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  78     /**                                                                                                  </span>
<span class="-8065821024341297110" onmouseenter="enter('-8065821024341297110');" onmouseout="out('-8065821024341297110');" style="">  79      * icons are large, dribble them out                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80      */                                                                                                  </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  81     private static final int MAX_ICONS_PER_PASS = 10;                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83     /**                                                                                                  </span>
<span class="3256952212797886844" onmouseenter="enter('3256952212797886844');" onmouseout="out('3256952212797886844');" style="">  84      * widgets contain previews, which are very large, dribble them out                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85      */                                                                                                  </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  86     private static final int MAX_WIDGETS_PER_PASS = 5;                                                   </span>
<span  style="">  87                                                                                                          </span>
<span class="-9115528851843838744" onmouseenter="enter('-9115528851843838744');" onmouseout="out('-9115528851843838744');" style="">  88     public static final int IMAGE_COMPRESSION_QUALITY = 75;                                              </span>
<span  style="">  89                                                                                                          </span>
<span class="-3087488215496878471" onmouseenter="enter('-3087488215496878471');" onmouseout="out('-3087488215496878471');" style="">  90     public static final String LAUNCHER_PREFIX = &quot;L&quot;;                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-1120390505463346401" onmouseenter="enter('-1120390505463346401');" onmouseout="out('-1120390505463346401');" style="">  92     public static final String LAUNCHER_PREFS_PREFIX = &quot;LP&quot;;                                             </span>
<span  style="">  93                                                                                                          </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  94     private static final Bitmap.CompressFormat IMAGE_FORMAT =                                            </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  95             android.graphics.Bitmap.CompressFormat.PNG;                                                  </span>
<span  style="">  96                                                                                                          </span>
<span class="-6320109508039674215" onmouseenter="enter('-6320109508039674215');" onmouseout="out('-6320109508039674215');" style="">  97     private static BackupManager sBackupManager;                                                         </span>
<span  style="">  98                                                                                                          </span>
<span class="1587707096878894918" onmouseenter="enter('1587707096878894918');" onmouseout="out('1587707096878894918');" style="">  99     private static final String[] FAVORITE_PROJECTION = new java.lang.String[]{ Favorites._ID, // 0      </span>
<span class="-8910357097358992059" onmouseenter="enter('-8910357097358992059');" onmouseout="out('-8910357097358992059');" style=""> 100     Favorites.MODIFIED, // 1                                                                             </span>
<span class="-749201270860763817" onmouseenter="enter('-749201270860763817');" onmouseout="out('-749201270860763817');" style=""> 101     Favorites.INTENT, // 2                                                                               </span>
<span class="-612495736897876596" onmouseenter="enter('-612495736897876596');" onmouseout="out('-612495736897876596');" style=""> 102     Favorites.APPWIDGET_PROVIDER// 3                                                                     </span>
<span class="-473832312104535176" onmouseenter="enter('-473832312104535176');" onmouseout="out('-473832312104535176');" style=""> 103     , Favorites.APPWIDGET_ID// 4                                                                         </span>
<span class="-1182115164275757502" onmouseenter="enter('-1182115164275757502');" onmouseout="out('-1182115164275757502');" style=""> 104     , Favorites.CELLX, // 5                                                                              </span>
<span class="8245952406225141877" onmouseenter="enter('8245952406225141877');" onmouseout="out('8245952406225141877');" style=""> 105     Favorites.CELLY, // 6                                                                                </span>
<span class="-2109237276185492425" onmouseenter="enter('-2109237276185492425');" onmouseout="out('-2109237276185492425');" style=""> 106     Favorites.CONTAINER, // 7                                                                            </span>
<span class="-8366598762535535129" onmouseenter="enter('-8366598762535535129');" onmouseout="out('-8366598762535535129');" style=""> 107     Favorites.ICON, // 8                                                                                 </span>
<span class="-5846463741772655790" onmouseenter="enter('-5846463741772655790');" onmouseout="out('-5846463741772655790');" style=""> 108     Favorites.ICON_PACKAGE// 9                                                                           </span>
<span class="-4677027537604723244" onmouseenter="enter('-4677027537604723244');" onmouseout="out('-4677027537604723244');" style=""> 109     , Favorites.ICON_RESOURCE// 10                                                                       </span>
<span class="5793011790737682514" onmouseenter="enter('5793011790737682514');" onmouseout="out('5793011790737682514');" style=""> 110     , Favorites.ICON_TYPE, // 11                                                                         </span>
<span class="3850117922988643466" onmouseenter="enter('3850117922988643466');" onmouseout="out('3850117922988643466');" style=""> 111     Favorites.ITEM_TYPE, // 12                                                                           </span>
<span class="-6475101418922352990" onmouseenter="enter('-6475101418922352990');" onmouseout="out('-6475101418922352990');" style=""> 112     Favorites.SCREEN, // 13                                                                              </span>
<span class="5128229125325386907" onmouseenter="enter('5128229125325386907');" onmouseout="out('5128229125325386907');" style=""> 113     Favorites.SPANX, // 14                                                                               </span>
<span class="-6122457275871599674" onmouseenter="enter('-6122457275871599674');" onmouseout="out('-6122457275871599674');" style=""> 114     Favorites.SPANY, // 15                                                                               </span>
<span class="-1948317659803091992" onmouseenter="enter('-1948317659803091992');" onmouseout="out('-1948317659803091992');" style=""> 115     Favorites.TITLE, // 16                                                                               </span>
<span class="-9070001208305093510" onmouseenter="enter('-9070001208305093510');" onmouseout="out('-9070001208305093510');" style=""> 116             // 17                                                                                        </span>
<span class="-2890535297606459661" onmouseenter="enter('-2890535297606459661');" onmouseout="out('-2890535297606459661');" style=""> 117     Favorites.PROFILE_ID };                                                                              </span>
<span  style=""> 118                                                                                                          </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 119     private static final int ID_INDEX = 0;                                                               </span>
<span  style=""> 120                                                                                                          </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 121     private static final int ID_MODIFIED = 1;                                                            </span>
<span  style=""> 122                                                                                                          </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 123     private static final int INTENT_INDEX = 2;                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 125     private static final int APPWIDGET_PROVIDER_INDEX = 3;                                               </span>
<span  style=""> 126                                                                                                          </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 127     private static final int APPWIDGET_ID_INDEX = 4;                                                     </span>
<span  style=""> 128                                                                                                          </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 129     private static final int CELLX_INDEX = 5;                                                            </span>
<span  style=""> 130                                                                                                          </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 131     private static final int CELLY_INDEX = 6;                                                            </span>
<span  style=""> 132                                                                                                          </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 133     private static final int CONTAINER_INDEX = 7;                                                        </span>
<span  style=""> 134                                                                                                          </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 135     private static final int ICON_INDEX = 8;                                                             </span>
<span  style=""> 136                                                                                                          </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 137     private static final int ICON_PACKAGE_INDEX = 9;                                                     </span>
<span  style=""> 138                                                                                                          </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 139     private static final int ICON_RESOURCE_INDEX = 10;                                                   </span>
<span  style=""> 140                                                                                                          </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 141     private static final int ICON_TYPE_INDEX = 11;                                                       </span>
<span  style=""> 142                                                                                                          </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 143     private static final int ITEM_TYPE_INDEX = 12;                                                       </span>
<span  style=""> 144                                                                                                          </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 145     private static final int SCREEN_INDEX = 13;                                                          </span>
<span  style=""> 146                                                                                                          </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 147     private static final int SPANX_INDEX = 14;                                                           </span>
<span  style=""> 148                                                                                                          </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 149     private static final int SPANY_INDEX = 15;                                                           </span>
<span  style=""> 150                                                                                                          </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 151     private static final int TITLE_INDEX = 16;                                                           </span>
<span  style=""> 152                                                                                                          </span>
<span class="-3666133504327950845" onmouseenter="enter('-3666133504327950845');" onmouseout="out('-3666133504327950845');" style=""> 153     private static final int PROFILE_ID_INDEX = 17;                                                      </span>
<span  style=""> 154                                                                                                          </span>
<span class="5285461630596938806" onmouseenter="enter('5285461630596938806');" onmouseout="out('5285461630596938806');" style=""> 155     private static final String[] SCREEN_PROJECTION = new java.lang.String[]{ WorkspaceScreens._ID, // 0 </span>
<span class="5467950075629427988" onmouseenter="enter('5467950075629427988');" onmouseout="out('5467950075629427988');" style=""> 156     WorkspaceScreens.MODIFIED// 1                                                                        </span>
<span class="8292622880428981651" onmouseenter="enter('8292622880428981651');" onmouseout="out('8292622880428981651');" style=""> 157     , WorkspaceScreens.SCREEN_RANK// 2                                                                   </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 158      };                                                                                                  </span>
<span  style=""> 159                                                                                                          </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 160     private static final int SCREEN_RANK_INDEX = 2;                                                      </span>
<span  style=""> 161                                                                                                          </span>
<span class="1370853386149545885" onmouseenter="enter('1370853386149545885');" onmouseout="out('1370853386149545885');" style=""> 162     private static IconCache mIconCache;                                                                 </span>
<span  style=""> 163                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 164     private final Context mContext;                                                                      </span>
<span  style=""> 165                                                                                                          </span>
<span class="-8743166978913928813" onmouseenter="enter('-8743166978913928813');" onmouseout="out('-8743166978913928813');" style=""> 166     private final boolean mRestoreEnabled;                                                               </span>
<span  style=""> 167                                                                                                          </span>
<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style=""> 168     private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style=""> 170     private final ArrayList&lt;Key&gt; mKeys;                                                                  </span>
<span  style=""> 171                                                                                                          </span>
<span class="2664402437757712713" onmouseenter="enter('2664402437757712713');" onmouseout="out('2664402437757712713');" style=""> 172     public LauncherBackupHelper(Context context, boolean restoreEnabled) {                               </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 173         mContext = context;                                                                              </span>
<span class="3162096380580590348" onmouseenter="enter('3162096380580590348');" onmouseout="out('3162096380580590348');" style=""> 174         mRestoreEnabled = restoreEnabled;                                                                </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 175         mKeys = new ArrayList&lt;Key&gt;();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 178     private void dataChanged() {                                                                         </span>
<span class="-6280593186860143288" onmouseenter="enter('-6280593186860143288');" onmouseout="out('-6280593186860143288');" style=""> 179         if (sBackupManager == null) {                                                                    </span>
<span class="-1682111607995772618" onmouseenter="enter('-1682111607995772618');" onmouseout="out('-1682111607995772618');" style=""> 180             sBackupManager = new BackupManager(mContext);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span class="-8519501381186315635" onmouseenter="enter('-8519501381186315635');" onmouseout="out('-8519501381186315635');" style=""> 182         sBackupManager.dataChanged();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 185     /**                                                                                                  </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 186      * Back up launcher data so we can restore the user&#x27;s state on a new device.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 187      *                                                                                                   </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 188      * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 189      *                                                                                                   </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 190      * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 191      *                                                                                                   </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 192      * @param oldState notes from the last backup                                                        </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 193      * @param data incremental key/value pairs to persist off-device                                     </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 194      * @param newState notes for the next backup                                                         </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 195      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 196      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 197     @Override                                                                                            </span>
<span class="-5806703195927255708" onmouseenter="enter('-5806703195927255708');" onmouseout="out('-5806703195927255708');" style=""><abbr title=" 198     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor newState) {"> 198     public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data, ParcelFileDescriptor </abbr></span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 199         if (VERBOSE) {                                                                                   </span>
<span class="-5617118756948088857" onmouseenter="enter('-5617118756948088857');" onmouseout="out('-5617118756948088857');" style=""> 200             Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 202         Journal in = readJournal(oldState);                                                              </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 203         Journal out = new Journal();                                                                     </span>
<span class="-3253084867092672816" onmouseenter="enter('-3253084867092672816');" onmouseout="out('-3253084867092672816');" style=""> 204         long lastBackupTime = in.t;                                                                      </span>
<span class="8932370774979500270" onmouseenter="enter('8932370774979500270');" onmouseout="out('8932370774979500270');" style=""> 205         out.t = System.currentTimeMillis();                                                              </span>
<span class="-1600347970264493336" onmouseenter="enter('-1600347970264493336');" onmouseout="out('-1600347970264493336');" style=""> 206         out.rows = 0;                                                                                    </span>
<span class="2725575623770373107" onmouseenter="enter('2725575623770373107');" onmouseout="out('2725575623770373107');" style=""> 207         out.bytes = 0;                                                                                   </span>
<span class="-8521392564577701566" onmouseenter="enter('-8521392564577701566');" onmouseout="out('-8521392564577701566');" style=""> 208         Log.v(TAG, &quot;lastBackupTime = &quot; + lastBackupTime);                                                </span>
<span class="4700072589631005259" onmouseenter="enter('4700072589631005259');" onmouseout="out('4700072589631005259');" style=""> 209         ArrayList&lt;Key&gt; keys = new ArrayList&lt;Key&gt;();                                                      </span>
<span class="903881481365121859" onmouseenter="enter('903881481365121859');" onmouseout="out('903881481365121859');" style=""> 210         if (launcherIsReady()) {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 211             try {                                                                                        </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style=""> 212                 backupFavorites(in, data, out, keys);                                                    </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style=""> 213                 backupScreens(in, data, out, keys);                                                      </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style=""> 214                 backupIcons(in, data, out, keys);                                                        </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style=""> 215                 backupWidgets(in, data, out, keys);                                                      </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 216             } catch (IOException e) {                                                                    </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 217                 Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218             }                                                                                            </span>
<span class="2835649801843193313" onmouseenter="enter('2835649801843193313');" onmouseout="out('2835649801843193313');" style=""> 219             out.key = keys.toArray(                                                                      </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 220 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="7232861906191176410" onmouseenter="enter('7232861906191176410');" onmouseout="out('7232861906191176410');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221 new BackupProtos.Key[keys.size()]                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 222 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 223 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 223 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 224 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225                                                                                                          </span>
<span class="-153425872965740534" onmouseenter="enter('-153425872965740534');" onmouseout="out('-153425872965740534');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 BackupProtos.Key.emptyArray()                                                                            </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 227 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 228             );                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 229         } else {                                                                                         </span>
<span class="-3169554028816730380" onmouseenter="enter('-3169554028816730380');" onmouseout="out('-3169554028816730380');" style=""> 230             out = in;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231         }                                                                                                </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 232         writeJournal(newState, out);                                                                     </span>
<span class="-6171008479900262399" onmouseenter="enter('-6171008479900262399');" onmouseout="out('-6171008479900262399');" style=""> 233         Log.v(TAG, (((&quot;onBackup: wrote &quot; + out.bytes) + &quot;b in &quot;) + out.rows) + &quot; rows.&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234     }                                                                                                    </span>
<span  style=""> 235                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 236     /**                                                                                                  </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 237      * Restore launcher configuration from the restored data stream.                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 238      *                                                                                                   </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style=""> 239      * &lt;P&gt;Keys may arrive in any order.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 240      *                                                                                                   </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 241      * @param data the key/value pair from the server                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 242      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 243     @Override                                                                                            </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 244     public void restoreEntity(BackupDataInputStream data) {                                              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 245         if (VERBOSE) {                                                                                   </span>
<span class="273471296519358434" onmouseenter="enter('273471296519358434');" onmouseout="out('273471296519358434');" style=""> 246             Log.v(TAG, &quot;restoreEntity&quot;);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247         }                                                                                                </span>
<span class="-3135534305680812023" onmouseenter="enter('-3135534305680812023');" onmouseout="out('-3135534305680812023');" style=""> 248         byte[] buffer = new byte[512];                                                                   </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 249         String backupKey = data.getKey();                                                                </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 250         int dataSize = data.size();                                                                      </span>
<span class="2382724363113702568" onmouseenter="enter('2382724363113702568');" onmouseout="out('2382724363113702568');" style=""> 251         if (buffer.length &lt; dataSize) {                                                                  </span>
<span class="8352923365759736689" onmouseenter="enter('8352923365759736689');" onmouseout="out('8352923365759736689');" style=""> 252             buffer = new byte[dataSize];                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253         }                                                                                                </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 254         Key key = null;                                                                                  </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 255         int bytesRead = 0;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 256         try {                                                                                            </span>
<span class="-6009766373469064808" onmouseenter="enter('-6009766373469064808');" onmouseout="out('-6009766373469064808');" style=""> 257             bytesRead = data.read(buffer, 0, dataSize);                                                  </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 258             if (DEBUG) {                                                                                 </span>
<span class="8996496803609627725" onmouseenter="enter('8996496803609627725');" onmouseout="out('8996496803609627725');" style=""> 259                 Log.d(TAG, (((&quot;read &quot; + bytesRead) + &quot; of &quot;) + dataSize) + &quot; available&quot;);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 261         } catch (IOException e) {                                                                        </span>
<span class="-1433318685117734483" onmouseenter="enter('-1433318685117734483');" onmouseout="out('-1433318685117734483');" style=""> 262             Log.e(TAG, &quot;failed to read entity from restore data&quot;, e);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 264         try {                                                                                            </span>
<span class="-3712536663698109807" onmouseenter="enter('-3712536663698109807');" onmouseout="out('-3712536663698109807');" style=""> 265             key = backupKeyToKey(backupKey);                                                             </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style=""> 266             mKeys.add(key);                                                                              </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 267             switch (key.type) {                                                                          </span>
<span class="6496334887013597344" onmouseenter="enter('6496334887013597344');" onmouseout="out('6496334887013597344');" style=""> 268                 case Key.FAVORITE :                                                                      </span>
<span class="-8176296956220002371" onmouseenter="enter('-8176296956220002371');" onmouseout="out('-8176296956220002371');" style=""> 269                     restoreFavorite(key, buffer, dataSize, mKeys);                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 270                     break;                                                                               </span>
<span class="287087988598936739" onmouseenter="enter('287087988598936739');" onmouseout="out('287087988598936739');" style=""> 271                 case Key.SCREEN :                                                                        </span>
<span class="-2747327735226535589" onmouseenter="enter('-2747327735226535589');" onmouseout="out('-2747327735226535589');" style=""> 272                     restoreScreen(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 273                     break;                                                                               </span>
<span class="-8891757616372688198" onmouseenter="enter('-8891757616372688198');" onmouseout="out('-8891757616372688198');" style=""> 274                 case Key.ICON :                                                                          </span>
<span class="-5346432636907736484" onmouseenter="enter('-5346432636907736484');" onmouseout="out('-5346432636907736484');" style=""> 275                     restoreIcon(key, buffer, dataSize, mKeys);                                           </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 276                     break;                                                                               </span>
<span class="-8481070254821362106" onmouseenter="enter('-8481070254821362106');" onmouseout="out('-8481070254821362106');" style=""> 277                 case Key.WIDGET :                                                                        </span>
<span class="-7791331080833002730" onmouseenter="enter('-7791331080833002730');" onmouseout="out('-7791331080833002730');" style=""> 278                     restoreWidget(key, buffer, dataSize, mKeys);                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 279                     break;                                                                               </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 280                 default :                                                                                </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 281                     Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 282                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283             }                                                                                            </span>
<span class="3868320131851668860" onmouseenter="enter('3868320131851668860');" onmouseout="out('3868320131851668860');" style=""> 284         } catch (LauncherBackupHelper.KeyParsingException e) {                                           </span>
<span class="-562496230350101976" onmouseenter="enter('-562496230350101976');" onmouseout="out('-562496230350101976');" style=""> 285             Log.w(TAG, &quot;ignoring unparsable backup key: &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 289     /**                                                                                                  </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 290      * Record the restore state for the next backup.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 291      *                                                                                                   </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 292      * @param newState notes about the backup state after restore.                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 293      */                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 294     @Override                                                                                            </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 295     public void writeNewStateDescription(ParcelFileDescriptor newState) {                                </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style=""> 296         // clear the output journal time, to force a full backup to                                      </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style=""> 297         // will catch any changes the restore process might have made                                    </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 298         Journal out = new Journal();                                                                     </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style=""> 299         out.t = 0;                                                                                       </span>
<span class="1589222105877950778" onmouseenter="enter('1589222105877950778');" onmouseout="out('1589222105877950778');" style=""> 300         out.key = mKeys.toArray(                                                                         </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 301 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="7549715955516966742" onmouseenter="enter('7549715955516966742');" onmouseout="out('7549715955516966742');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 302 new BackupProtos.Key[mKeys.size()]                                                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 303 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 304 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 304 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 305 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306                                                                                                          </span>
<span class="-153425872965740534" onmouseenter="enter('-153425872965740534');" onmouseout="out('-153425872965740534');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307 BackupProtos.Key.emptyArray()                                                                            </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 308 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 309         );                                                                                               </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 310         writeJournal(newState, out);                                                                     </span>
<span class="3921358839589246179" onmouseenter="enter('3921358839589246179');" onmouseout="out('3921358839589246179');" style=""> 311         Log.v(TAG, (&quot;onRestore: read &quot; + mKeys.size()) + &quot; rows&quot;);                                       </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 312         mKeys.clear();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313     }                                                                                                    </span>
<span  style=""> 314                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 315     /**                                                                                                  </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 316      * Write all modified favorites to the data stream.                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 317      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 318      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 319      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 320      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 321      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 322      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 323      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 324      */                                                                                                  </span>
<span class="-5828672769058996195" onmouseenter="enter('-5828672769058996195');" onmouseout="out('-5828672769058996195');" style=""><abbr title=" 325     private void backupFavorites(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throws IOException {"> 325     private void backupFavorites(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) thr</abbr></span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 326         // read the old ID set                                                                           </span>
<span class="1222708127935075798" onmouseenter="enter('1222708127935075798');" onmouseout="out('1222708127935075798');" style=""> 327         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.FAVORITE, in);                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 328         if (DEBUG) {                                                                                     </span>
<span class="-6549545043435382004" onmouseenter="enter('-6549545043435382004');" onmouseout="out('-6549545043435382004');" style=""> 329             Log.d(TAG, &quot;favorite savedIds.size()=&quot; + savedIds.size());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330         }                                                                                                </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 331         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 332         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 333         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="4122938018113407665" onmouseenter="enter('4122938018113407665');" onmouseout="out('4122938018113407665');" style=""><abbr title=" 334         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, getUserSelectionArg(), null, null);"> 334         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, getUserSelectionArg(), null,</abbr></span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 335         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 336         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 337             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 338             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 339                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 340                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 341                 Key key = getKey(Key.FAVORITE, id);                                                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 342                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 343                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 344                 currentIds.add(backupKey);                                                               </span>
<span class="8597803433463224008" onmouseenter="enter('8597803433463224008');" onmouseout="out('8597803433463224008');" style=""> 345                 if ((!savedIds.contains(backupKey)) || (updateTime &gt;= in.t)) {                           </span>
<span class="7001118594211601319" onmouseenter="enter('7001118594211601319');" onmouseout="out('7001118594211601319');" style=""> 346                     byte[] blob = packFavorite(cursor);                                                  </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 347                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-4667499092301415404" onmouseenter="enter('-4667499092301415404');" onmouseout="out('-4667499092301415404');" style=""> 348                 } else if (VERBOSE) {                                                                    </span>
<span class="7714874320517139096" onmouseenter="enter('7714874320517139096');" onmouseout="out('7714874320517139096');" style=""> 349                     Log.v(TAG, ((&quot;favorite &quot; + id) + &quot; was too old: &quot;) + updateTime);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 352         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 353             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 355         if (DEBUG) {                                                                                     </span>
<span class="7116353596589907037" onmouseenter="enter('7116353596589907037');" onmouseout="out('7116353596589907037');" style=""> 356             Log.d(TAG, &quot;favorite currentIds.size()=&quot; + currentIds.size());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 358         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 359         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 360         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361     }                                                                                                    </span>
<span  style=""> 362                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 363     /**                                                                                                  </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 364      * Read a favorite from the stream.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 365      *                                                                                                   </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 366      * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 367      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 368      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 369      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 370      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 371      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 372      */                                                                                                  </span>
<span class="-1219322022397821860" onmouseenter="enter('-1219322022397821860');" onmouseout="out('-1219322022397821860');" style=""> 373     private void restoreFavorite(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {            </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 374         if (VERBOSE) {                                                                                   </span>
<span class="-6123834741244844948" onmouseenter="enter('-6123834741244844948');" onmouseout="out('-6123834741244844948');" style=""> 375             Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 377         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 378             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 378             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379         }                                                                                                </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 380         if (!mRestoreEnabled) {                                                                          </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 381             if (VERBOSE) {                                                                               </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 382                 Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 384             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 386         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 387             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4257623264587280611" onmouseenter="enter('4257623264587280611');" onmouseout="out('4257623264587280611');" style=""> 388             ContentValues values = unpackFavorite(buffer, 0, dataSize);                                  </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style=""> 389             cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                    </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 390         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-2029498838376156786" onmouseenter="enter('-2029498838376156786');" onmouseout="out('-2029498838376156786');" style=""> 391             Log.e(TAG, &quot;failed to decode favorite&quot;, e);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393     }                                                                                                    </span>
<span  style=""> 394                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 395     /**                                                                                                  </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 396      * Write all modified screens to the data stream.                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 397      *                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 398      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 399      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 400      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 401      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 402      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 403      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 404      */                                                                                                  </span>
<span class="-5161588098750863950" onmouseenter="enter('-5161588098750863950');" onmouseout="out('-5161588098750863950');" style=""><abbr title=" 405     private void backupScreens(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throws IOException {"> 405     private void backupScreens(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throw</abbr></span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 406         // read the old ID set                                                                           </span>
<span class="-5113344219820420639" onmouseenter="enter('-5113344219820420639');" onmouseout="out('-5113344219820420639');" style=""> 407         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.SCREEN, in);                                        </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 408         if (DEBUG) {                                                                                     </span>
<span class="1669711708771741088" onmouseenter="enter('1669711708771741088');" onmouseout="out('1669711708771741088');" style=""> 409             Log.d(TAG, &quot;screen savedIds.size()=&quot; + savedIds.size());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410         }                                                                                                </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 411         // persist things that have changed since the last backup                                        </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 412         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="5586984363480542310" onmouseenter="enter('5586984363480542310');" onmouseout="out('5586984363480542310');" style=""> 413         Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION, null, null, null);     </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 414         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 415         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 416             cursor.moveToPosition(-1);                                                                   </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 417             if (DEBUG) {                                                                                 </span>
<span class="5597473855001477999" onmouseenter="enter('5597473855001477999');" onmouseout="out('5597473855001477999');" style=""> 418                 Log.d(TAG, &quot;dumping screens after: &quot; + in.t);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 419             }                                                                                            </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 420             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 421                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 422                 final long updateTime = cursor.getLong(ID_MODIFIED);                                     </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 423                 Key key = getKey(Key.SCREEN, id);                                                        </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 424                 keys.add(key);                                                                           </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style=""> 425                 final String backupKey = keyToBackupKey(key);                                            </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 426                 currentIds.add(backupKey);                                                               </span>
<span class="8597803433463224008" onmouseenter="enter('8597803433463224008');" onmouseout="out('8597803433463224008');" style=""> 427                 if ((!savedIds.contains(backupKey)) || (updateTime &gt;= in.t)) {                           </span>
<span class="30579954798815384" onmouseenter="enter('30579954798815384');" onmouseout="out('30579954798815384');" style=""> 428                     byte[] blob = packScreen(cursor);                                                    </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 429                     writeRowToBackup(key, blob, out, data);                                              </span>
<span class="-4667499092301415404" onmouseenter="enter('-4667499092301415404');" onmouseout="out('-4667499092301415404');" style=""> 430                 } else if (VERBOSE) {                                                                    </span>
<span class="8938028411648254945" onmouseenter="enter('8938028411648254945');" onmouseout="out('8938028411648254945');" style=""> 431                     Log.v(TAG, ((&quot;screen &quot; + id) + &quot; was too old: &quot;) + updateTime);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 434         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 435             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 437         if (DEBUG) {                                                                                     </span>
<span class="-3760195197697080539" onmouseenter="enter('-3760195197697080539');" onmouseout="out('-3760195197697080539');" style=""> 438             Log.d(TAG, &quot;screen currentIds.size()=&quot; + currentIds.size());                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439         }                                                                                                </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 440         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 441         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 442         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443     }                                                                                                    </span>
<span  style=""> 444                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 445     /**                                                                                                  </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 446      * Read a screen from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 447      *                                                                                                   </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 448      * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 449      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 450      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 451      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 452      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 453      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 454      */                                                                                                  </span>
<span class="-7250675390519322058" onmouseenter="enter('-7250675390519322058');" onmouseout="out('-7250675390519322058');" style=""> 455     private void restoreScreen(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 456         if (VERBOSE) {                                                                                   </span>
<span class="-7359569920478585703" onmouseenter="enter('-7359569920478585703');" onmouseout="out('-7359569920478585703');" style=""> 457             Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 459         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 460             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 460             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461         }                                                                                                </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 462         if (!mRestoreEnabled) {                                                                          </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 463             if (VERBOSE) {                                                                               </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 464                 Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 466             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 468         try {                                                                                            </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 469             ContentResolver cr = mContext.getContentResolver();                                          </span>
<span class="4024968274688095863" onmouseenter="enter('4024968274688095863');" onmouseout="out('4024968274688095863');" style=""> 470             ContentValues values = unpackScreen(buffer, 0, dataSize);                                    </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style=""> 471             cr.insert(WorkspaceScreens.CONTENT_URI, values);                                             </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 472         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1711302190142484945" onmouseenter="enter('-1711302190142484945');" onmouseout="out('-1711302190142484945');" style=""> 473             Log.e(TAG, &quot;failed to decode screen&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475     }                                                                                                    </span>
<span  style=""> 476                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 477     /**                                                                                                  </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 478      * Write all the static icon resources we need to render placeholders                                </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 479      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 480      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 481      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 482      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 483      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 484      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 485      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 486      */                                                                                                  </span>
<span class="-4087831295791484247" onmouseenter="enter('-4087831295791484247');" onmouseout="out('-4087831295791484247');" style=""><abbr title=" 487     private void backupIcons(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throws IOException {"> 487     private void backupIcons(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throws </abbr></span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 488         // persist icons that haven&#x27;t been persisted yet                                                 </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style=""> 489         if (!initializeIconCache()) {                                                                    </span>
<span class="-2059547764143880365" onmouseenter="enter('-2059547764143880365');" onmouseout="out('-2059547764143880365');" style=""> 490             dataChanged();// try again later                                                             </span>
<span  style=""> 491                                                                                                          </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 492             if (DEBUG) {                                                                                 </span>
<span class="-3828704949317225958" onmouseenter="enter('-3828704949317225958');" onmouseout="out('-3828704949317225958');" style=""> 493                 Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 495             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 497         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 498         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style=""> 499         final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                           </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 500         // read the old ID set                                                                           </span>
<span class="5971436892288320278" onmouseenter="enter('5971436892288320278');" onmouseout="out('5971436892288320278');" style=""> 501         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.ICON, in);                                          </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 502         if (DEBUG) {                                                                                     </span>
<span class="-829799691611778878" onmouseenter="enter('-829799691611778878');" onmouseout="out('-829799691611778878');" style=""> 503             Log.d(TAG, &quot;icon savedIds.size()=&quot; + savedIds.size());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504         }                                                                                                </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style=""> 505         // Don&#x27;t backup apps in other profiles for now.                                                  </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 506         int startRows = out.rows;                                                                        </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 507         if (DEBUG) {                                                                                     </span>
<span class="5696176562095524507" onmouseenter="enter('5696176562095524507');" onmouseout="out('5696176562095524507');" style=""> 508             Log.d(TAG, &quot;starting here: &quot; + startRows);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 509         }                                                                                                </span>
<span class="-6932835081018188666" onmouseenter="enter('-6932835081018188666');" onmouseout="out('-6932835081018188666');" style=""><abbr title=" 510         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; OR &quot;) + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_SHORTCUT) + &quot;) AND &quot;) + getUserSelectionArg();"> 510         String where = ((((((((&quot;(&quot; + Favorites.ITEM_TYPE) + &quot;=&quot;) + Favorites.ITEM_TYPE_APPLICATION) + &quot; O</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 511         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 512         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 513         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 514             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 515             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 516                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 517                 final String intentDescription = cursor.getString(INTENT_INDEX);                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 518                 try {                                                                                    </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 519                     Intent intent = Intent.parseUri(intentDescription, 0);                               </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 520                     ComponentName cn = intent.getComponent();                                            </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 521                     Key key = null;                                                                      </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 522                     String backupKey = null;                                                             </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 523                     if (cn != null) {                                                                    </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 524                         key = getKey(Key.ICON, cn.flattenToShortString());                               </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 525                         backupKey = keyToBackupKey(key);                                                 </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 526                         currentIds.add(backupKey);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 527                     } else {                                                                             </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 528                         Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529                     }                                                                                    </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 530                     if (savedIds.contains(backupKey)) {                                                  </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 531                         if (VERBOSE) {                                                                   </span>
<span class="-6454553475014877975" onmouseenter="enter('-6454553475014877975');" onmouseout="out('-6454553475014877975');" style=""> 532                             Log.v(TAG, &quot;already saved icon &quot; + backupKey);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533                         }                                                                                </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 534                         // remember that we already backed this up previously                            </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 535                         keys.add(key);                                                                   </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 536                     } else if (backupKey != null) {                                                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 537                         if (DEBUG) {                                                                     </span>
<span class="-7302826635543531832" onmouseenter="enter('-7302826635543531832');" onmouseout="out('-7302826635543531832');" style=""> 538                             Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539                         }                                                                                </span>
<span class="-9006656974661932570" onmouseenter="enter('-9006656974661932570');" onmouseout="out('-9006656974661932570');" style=""> 540                         if ((out.rows - startRows) &lt; MAX_ICONS_PER_PASS) {                               </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 541                             if (VERBOSE) {                                                               </span>
<span class="3035565962718021402" onmouseenter="enter('3035565962718021402');" onmouseout="out('3035565962718021402');" style=""> 542                                 Log.v(TAG, &quot;saving icon &quot; + backupKey);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543                             }                                                                            </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style=""> 544                             Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                      </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 545                             keys.add(key);                                                               </span>
<span class="8052636830342996642" onmouseenter="enter('8052636830342996642');" onmouseout="out('8052636830342996642');" style=""> 546                             if ((icon != null) &amp;&amp; (!mIconCache.isDefaultIcon(icon, myUserHandle))) {     </span>
<span class="-1917944616523216064" onmouseenter="enter('-1917944616523216064');" onmouseout="out('-1917944616523216064');" style=""> 547                                 byte[] blob = packIcon(dpi, icon);                                       </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 548                                 writeRowToBackup(key, blob, out, data);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 550                         } else {                                                                         </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 551                             if (VERBOSE) {                                                               </span>
<span class="3425130385014319439" onmouseenter="enter('3425130385014319439');" onmouseout="out('3425130385014319439');" style=""> 552                                 Log.d(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553                             }                                                                            </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 554                             // too many icons for this pass, request another.                            </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 555                             dataChanged();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557                     }                                                                                    </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 558                 } catch (URISyntaxException e) {                                                         </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style=""> 559                     Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 560                 } catch (IOException e) {                                                                </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style=""> 561                     Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 564         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 565             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 567         if (DEBUG) {                                                                                     </span>
<span class="-7253722111472819937" onmouseenter="enter('-7253722111472819937');" onmouseout="out('-7253722111472819937');" style=""> 568             Log.d(TAG, &quot;icon currentIds.size()=&quot; + currentIds.size());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569         }                                                                                                </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 570         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 571         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 572         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573     }                                                                                                    </span>
<span  style=""> 574                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 575     /**                                                                                                  </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 576      * Read an icon from the stream.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 577      *                                                                                                   </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 578      * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 579      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 580      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 581      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 582      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 583      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 584      */                                                                                                  </span>
<span class="3418786705842277190" onmouseenter="enter('3418786705842277190');" onmouseout="out('3418786705842277190');" style=""> 585     private void restoreIcon(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 586         if (VERBOSE) {                                                                                   </span>
<span class="-4078819072521132180" onmouseenter="enter('-4078819072521132180');" onmouseout="out('-4078819072521132180');" style=""> 587             Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 589         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 590             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 590             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 592         try {                                                                                            </span>
<span class="-1273277075539844188" onmouseenter="enter('-1273277075539844188');" onmouseout="out('-1273277075539844188');" style=""> 593             Resource res = unpackIcon(buffer, 0, dataSize);                                              </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 594             if (DEBUG) {                                                                                 </span>
<span class="1496105702580132456" onmouseenter="enter('1496105702580132456');" onmouseout="out('1496105702580132456');" style=""> 595                 Log.d(TAG, (&quot;unpacked &quot; + res.dpi) + &quot; dpi icon&quot;);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596             }                                                                                            </span>
<span class="-3352481463774338191" onmouseenter="enter('-3352481463774338191');" onmouseout="out('-3352481463774338191');" style=""> 597             if (DEBUG_PAYLOAD) {                                                                         </span>
<span class="3691847881254289959" onmouseenter="enter('3691847881254289959');" onmouseout="out('3691847881254289959');" style=""><abbr title=" 598                 Log.d(TAG, &quot;read &quot; + Base64.encodeToString(res.data, 0, res.data.length, Base64.NO_WRAP));"> 598                 Log.d(TAG, &quot;read &quot; + Base64.encodeToString(res.data, 0, res.data.length, Base64.NO_WRAP))</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599             }                                                                                            </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 600             Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                   </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 601             if (icon == null) {                                                                          </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 602                 Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603             }                                                                                            </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 604             if (!mRestoreEnabled) {                                                                      </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 605                 if (VERBOSE) {                                                                           </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 606                     Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 608                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 609             } else {                                                                                     </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 610                 if (VERBOSE) {                                                                           </span>
<span class="7868918963870702505" onmouseenter="enter('7868918963870702505');" onmouseout="out('7868918963870702505');" style=""> 611                     Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612                 }                                                                                        </span>
<span class="-6103588571021946959" onmouseenter="enter('-6103588571021946959');" onmouseout="out('-6103588571021946959');" style=""><abbr title=" 613                 IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name), icon, res.dpi);"> 613                 IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name), icon, res.dp</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 615         } catch (IOException e) {                                                                        </span>
<span class="2331121584648893440" onmouseenter="enter('2331121584648893440');" onmouseout="out('2331121584648893440');" style=""> 616             Log.d(TAG, &quot;failed to save restored icon for: &quot; + key.name, e);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618     }                                                                                                    </span>
<span  style=""> 619                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 620     /**                                                                                                  </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 621      * Write all the static widget resources we need to render placeholders                              </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 622      * for a package that is not installed.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 623      *                                                                                                   </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 624      * @param in notes from last backup                                                                  </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 625      * @param data output stream for key/value pairs                                                     </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 626      * @param out notes about this backup                                                                </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 627      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 628      * @throws IOException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 629      */                                                                                                  </span>
<span class="-398372270071780989" onmouseenter="enter('-398372270071780989');" onmouseout="out('-398372270071780989');" style=""><abbr title=" 630     private void backupWidgets(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throws IOException {"> 630     private void backupWidgets(Journal in, BackupDataOutput data, Journal out, ArrayList&lt;Key&gt; keys) throw</abbr></span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 631         // persist static widget info that hasn&#x27;t been persisted yet                                     </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 632         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="4074295919043432488" onmouseenter="enter('4074295919043432488');" onmouseout="out('4074295919043432488');" style=""> 633         if ((appState == null) || (!initializeIconCache())) {                                            </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style=""> 634             Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 635             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636         }                                                                                                </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 637         final ContentResolver cr = mContext.getContentResolver();                                        </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 638         final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                     </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 639         final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);               </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 640         final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                          </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 641         final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                      </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 642         if (DEBUG) {                                                                                     </span>
<span class="230755112894366171" onmouseenter="enter('230755112894366171');" onmouseout="out('230755112894366171');" style=""> 643             Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 645         // read the old ID set                                                                           </span>
<span class="-852429832136699702" onmouseenter="enter('-852429832136699702');" onmouseout="out('-852429832136699702');" style=""> 646         Set&lt;String&gt; savedIds = getSavedIdsByType(Key.WIDGET, in);                                        </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 647         if (DEBUG) {                                                                                     </span>
<span class="3786283813384421422" onmouseenter="enter('3786283813384421422');" onmouseout="out('3786283813384421422');" style=""> 648             Log.d(TAG, &quot;widgets savedIds.size()=&quot; + savedIds.size());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649         }                                                                                                </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 650         int startRows = out.rows;                                                                        </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 651         if (DEBUG) {                                                                                     </span>
<span class="5696176562095524507" onmouseenter="enter('5696176562095524507');" onmouseout="out('5696176562095524507');" style=""> 652             Log.d(TAG, &quot;starting here: &quot; + startRows);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653         }                                                                                                </span>
<span class="-6307972240176527729" onmouseenter="enter('-6307972240176527729');" onmouseout="out('-6307972240176527729');" style=""><abbr title=" 654         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUserSelectionArg();"> 654         String where = (((Favorites.ITEM_TYPE + &quot;=&quot;) + Favorites.ITEM_TYPE_APPWIDGET) + &quot; AND &quot;) + getUse</abbr></span>
<span class="-6766008609016485436" onmouseenter="enter('-6766008609016485436');" onmouseout="out('-6766008609016485436');" style=""> 655         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, where, null, null);         </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 656         Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 657         try {                                                                                            </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 658             cursor.moveToPosition(-1);                                                                   </span>
<span class="-679463407698125917" onmouseenter="enter('-679463407698125917');" onmouseout="out('-679463407698125917');" style=""> 659             while (cursor.moveToNext()) {                                                                </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 660                 final long id = cursor.getLong(ID_INDEX);                                                </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 661                 final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                  </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 662                 final int spanX = cursor.getInt(SPANX_INDEX);                                            </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 663                 final int spanY = cursor.getInt(SPANY_INDEX);                                            </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 664                 final ComponentName provider = ComponentName.unflattenFromString(providerName);          </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 665                 Key key = null;                                                                          </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 666                 String backupKey = null;                                                                 </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 667                 if (provider != null) {                                                                  </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 668                     key = getKey(Key.WIDGET, providerName);                                              </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 669                     backupKey = keyToBackupKey(key);                                                     </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 670                     currentIds.add(backupKey);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 671                 } else {                                                                                 </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 672                     Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673                 }                                                                                        </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 674                 if (savedIds.contains(backupKey)) {                                                      </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 675                     if (VERBOSE) {                                                                       </span>
<span class="2671247773477463199" onmouseenter="enter('2671247773477463199');" onmouseout="out('2671247773477463199');" style=""> 676                         Log.v(TAG, &quot;already saved widget &quot; + backupKey);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 677                     }                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 678                     // remember that we already backed this up previously                                </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 679                     keys.add(key);                                                                       </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 680                 } else if (backupKey != null) {                                                          </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 681                     if (DEBUG) {                                                                         </span>
<span class="-7302826635543531832" onmouseenter="enter('-7302826635543531832');" onmouseout="out('-7302826635543531832');" style=""> 682                         Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683                     }                                                                                    </span>
<span class="-5873889847669281246" onmouseenter="enter('-5873889847669281246');" onmouseout="out('-5873889847669281246');" style=""> 684                     if ((out.rows - startRows) &lt; MAX_WIDGETS_PER_PASS) {                                 </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 685                         if (VERBOSE) {                                                                   </span>
<span class="891232458404654608" onmouseenter="enter('891232458404654608');" onmouseout="out('891232458404654608');" style=""> 686                             Log.v(TAG, &quot;saving widget &quot; + backupKey);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687                         }                                                                                </span>
<span class="1039412399366971290" onmouseenter="enter('1039412399366971290');" onmouseout="out('1039412399366971290');" style=""><abbr title=" 688                         previewLoader.setPreviewSize(spanX * profile.cellWidthPx, spanY * profile.cellHeightPx, widgetSpacingLayout);"> 688                         previewLoader.setPreviewSize(spanX * profile.cellWidthPx, spanY * profile.cellHei</abbr></span>
<span class="-4963176699005952762" onmouseenter="enter('-4963176699005952762');" onmouseout="out('-4963176699005952762');" style=""> 689                         byte[] blob = packWidget(dpi, previewLoader, mIconCache, provider);              </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 690                         keys.add(key);                                                                   </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 691                         writeRowToBackup(key, blob, out, data);                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 692                     } else {                                                                             </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 693                         if (VERBOSE) {                                                                   </span>
<span class="3643536606953363095" onmouseenter="enter('3643536606953363095');" onmouseout="out('3643536606953363095');" style=""> 694                             Log.d(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695                         }                                                                                </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 696                         // too many widgets for this pass, request another.                              </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 697                         dataChanged();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 700             }                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 701         } finally {                                                                                      </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 702             cursor.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 704         if (DEBUG) {                                                                                     </span>
<span class="1257276834645053319" onmouseenter="enter('1257276834645053319');" onmouseout="out('1257276834645053319');" style=""> 705             Log.d(TAG, &quot;widget currentIds.size()=&quot; + currentIds.size());                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706         }                                                                                                </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 707         // these IDs must have been deleted                                                              </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 708         savedIds.removeAll(currentIds);                                                                  </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 709         out.rows += removeDeletedKeysFromBackup(savedIds, data);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710     }                                                                                                    </span>
<span  style=""> 711                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 712     /**                                                                                                  </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 713      * Read a widget from the stream.                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 714      *                                                                                                   </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 715      * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 716      *                                                                                                   </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 717      * @param key identifier for the row                                                                 </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 718      * @param buffer the serialized proto from the stream, may be larger than dataSize                   </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 719      * @param dataSize the size of the proto from the stream                                             </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 720      * @param keys keys to mark as clean in the notes for next backup                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 721      */                                                                                                  </span>
<span class="-2743597305724887598" onmouseenter="enter('-2743597305724887598');" onmouseout="out('-2743597305724887598');" style=""> 722     private void restoreWidget(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 723         if (VERBOSE) {                                                                                   </span>
<span class="-6524290342693786597" onmouseenter="enter('-6524290342693786597');" onmouseout="out('-6524290342693786597');" style=""> 724             Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725         }                                                                                                </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 726         if (DEBUG) {                                                                                     </span>
<span class="3008094503899310157" onmouseenter="enter('3008094503899310157');" onmouseout="out('3008094503899310157');" style=""><abbr title=" 727             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));"> 727             Log.d(TAG, ((&quot;read (&quot; + buffer.length) + &quot;): &quot;) + Base64.encodeToString(buffer, 0, dataSize, </abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 729         try {                                                                                            </span>
<span class="6880516999183343771" onmouseenter="enter('6880516999183343771');" onmouseout="out('6880516999183343771');" style=""> 730             Widget widget = unpackWidget(buffer, 0, dataSize);                                           </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style=""> 731             if (DEBUG) {                                                                                 </span>
<span class="-9093045750186824630" onmouseenter="enter('-9093045750186824630');" onmouseout="out('-9093045750186824630');" style=""> 732                 Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733             }                                                                                            </span>
<span class="-2352547474915147862" onmouseenter="enter('-2352547474915147862');" onmouseout="out('-2352547474915147862');" style=""> 734             if (widget.icon.data != null) {                                                              </span>
<span class="-4697846519687927474" onmouseenter="enter('-4697846519687927474');" onmouseout="out('-4697846519687927474');" style=""><abbr title=" 735                 Bitmap icon = BitmapFactory.decodeByteArray(widget.icon.data, 0, widget.icon.data.length);"> 735                 Bitmap icon = BitmapFactory.decodeByteArray(widget.icon.data, 0, widget.icon.data.length)</abbr></span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 736                 if (icon == null) {                                                                      </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 737                     Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 738                 } else {                                                                                 </span>
<span class="1293379614539574777" onmouseenter="enter('1293379614539574777');" onmouseout="out('1293379614539574777');" style=""><abbr title=" 739                     IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider), icon, widget.icon.dpi);"> 739                     IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider), i</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741             }                                                                                            </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style=""> 742             if (!mRestoreEnabled) {                                                                      </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 743                 if (VERBOSE) {                                                                           </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style=""> 744                     Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 746                 return;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 747             } else {                                                                                     </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style=""> 748                 // future site of widget table mutation                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749             }                                                                                            </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 750         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-1867545559162052515" onmouseenter="enter('-1867545559162052515');" onmouseout="out('-1867545559162052515');" style=""> 751             Log.e(TAG, &quot;failed to decode widget&quot;, e);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 752         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 753     }                                                                                                    </span>
<span  style=""> 754                                                                                                          </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 755     /** create a new key, with an integer ID.                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 756      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 757      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 758      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 759      */                                                                                                  </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 760     private Key getKey(int type, long id) {                                                              </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 761         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 762         key.type = type;                                                                                 </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 763         key.id = id;                                                                                     </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 764         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 765         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766     }                                                                                                    </span>
<span  style=""> 767                                                                                                          </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 768     /** create a new key for a named object.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 769      *                                                                                                   </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 770      * &lt;P&gt; Keys contain their own checksum instead of using                                              </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 771      * the heavy-weight CheckedMessage wrapper.                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 772      */                                                                                                  </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 773     private Key getKey(int type, String name) {                                                          </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 774         Key key = new Key();                                                                             </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 775         key.type = type;                                                                                 </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 776         key.name = name;                                                                                 </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 777         key.checksum = checkKey(key);                                                                    </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 778         return key;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779     }                                                                                                    </span>
<span  style=""> 780                                                                                                          </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 781     /** keys need to be strings, serialize and encode. */                                                </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 782     private String keyToBackupKey(Key key) {                                                             </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 783         return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 784     }                                                                                                    </span>
<span  style=""> 785                                                                                                          </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 786     /** keys need to be strings, decode and parse. */                                                    </span>
<span class="3565153267272331252" onmouseenter="enter('3565153267272331252');" onmouseout="out('3565153267272331252');" style=""> 787     private Key backupKeyToKey(String backupKey) throws KeyParsingException {                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 788         try {                                                                                            </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 789             Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                           </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 790             if (key.checksum != checkKey(key)) {                                                         </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 791                 key = null;                                                                              </span>
<span class="7886037428699907314" onmouseenter="enter('7886037428699907314');" onmouseout="out('7886037428699907314');" style=""> 792                 throw new KeyParsingException(&quot;invalid key read from stream&quot; + backupKey);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 793             }                                                                                            </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 794             return key;                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 795         } catch (InvalidProtocolBufferNanoException e) {                                                 </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 796             throw new KeyParsingException(e);                                                            </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 797         } catch (IllegalArgumentException e) {                                                           </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 798             throw new KeyParsingException(e);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800     }                                                                                                    </span>
<span  style=""> 801                                                                                                          </span>
<span class="-9026907230628270971" onmouseenter="enter('-9026907230628270971');" onmouseout="out('-9026907230628270971');" style=""> 802     private String getKeyName(Key key) {                                                                 </span>
<span class="-7992041348690575973" onmouseenter="enter('-7992041348690575973');" onmouseout="out('-7992041348690575973');" style=""> 803         if (TextUtils.isEmpty(key.name)) {                                                               </span>
<span class="3948647275026092398" onmouseenter="enter('3948647275026092398');" onmouseout="out('3948647275026092398');" style=""> 804             return Long.toString(key.id);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 805         } else {                                                                                         </span>
<span class="-8847809052433174647" onmouseenter="enter('-8847809052433174647');" onmouseout="out('-8847809052433174647');" style=""> 806             return key.name;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807         }                                                                                                </span>
<span  style=""> 808                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809     }                                                                                                    </span>
<span  style=""> 810                                                                                                          </span>
<span class="-3302500785890956613" onmouseenter="enter('-3302500785890956613');" onmouseout="out('-3302500785890956613');" style=""> 811     private String geKeyType(Key key) {                                                                  </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 812         switch (key.type) {                                                                              </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 813             case Key.FAVORITE:                                                                           </span>
<span class="-6693583981393703832" onmouseenter="enter('-6693583981393703832');" onmouseout="out('-6693583981393703832');" style=""> 814                 return &quot;favorite&quot;;                                                                       </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 815             case Key.SCREEN:                                                                             </span>
<span class="-935980872443992001" onmouseenter="enter('-935980872443992001');" onmouseout="out('-935980872443992001');" style=""> 816                 return &quot;screen&quot;;                                                                         </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 817             case Key.ICON:                                                                               </span>
<span class="-6438997020167939033" onmouseenter="enter('-6438997020167939033');" onmouseout="out('-6438997020167939033');" style=""> 818                 return &quot;icon&quot;;                                                                           </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 819             case Key.WIDGET:                                                                             </span>
<span class="875584635155758752" onmouseenter="enter('875584635155758752');" onmouseout="out('875584635155758752');" style=""> 820                 return &quot;widget&quot;;                                                                         </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 821             default:                                                                                     </span>
<span class="-9117731612531303028" onmouseenter="enter('-9117731612531303028');" onmouseout="out('-9117731612531303028');" style=""> 822                 return &quot;anonymous&quot;;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824     }                                                                                                    </span>
<span  style=""> 825                                                                                                          </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 826     /** Compute the checksum over the important bits of a key. */                                        </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 827     private long checkKey(Key key) {                                                                     </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 828         CRC32 checksum = new CRC32();                                                                    </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 829         checksum.update(key.type);                                                                       </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 830         checksum.update((int) (key.id &amp; 0xffff));                                                        </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 831         checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 832         if (!TextUtils.isEmpty(key.name)) {                                                              </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 833             checksum.update(key.name.getBytes());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834         }                                                                                                </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 835         return checksum.getValue();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836     }                                                                                                    </span>
<span  style=""> 837                                                                                                          </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 838     /** Serialize a Favorite for persistence, including a checksum wrapper. */                           </span>
<span class="-4378147688590970666" onmouseenter="enter('-4378147688590970666');" onmouseout="out('-4378147688590970666');" style=""> 839     private byte[] packFavorite(Cursor c) {                                                              </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 840         Favorite favorite = new Favorite();                                                              </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 841         favorite.id = c.getLong(ID_INDEX);                                                               </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 842         favorite.screen = c.getInt(SCREEN_INDEX);                                                        </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 843         favorite.container = c.getInt(CONTAINER_INDEX);                                                  </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 844         favorite.cellX = c.getInt(CELLX_INDEX);                                                          </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 845         favorite.cellY = c.getInt(CELLY_INDEX);                                                          </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 846         favorite.spanX = c.getInt(SPANX_INDEX);                                                          </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 847         favorite.spanY = c.getInt(SPANY_INDEX);                                                          </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 848         favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                   </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 849         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 850             String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                        </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 851             if (!TextUtils.isEmpty(iconPackage)) {                                                       </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 852                 favorite.iconPackage = iconPackage;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853             }                                                                                            </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 854             String iconResource = c.getString(ICON_RESOURCE_INDEX);                                      </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 855             if (!TextUtils.isEmpty(iconResource)) {                                                      </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 856                 favorite.iconResource = iconResource;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 858         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 859         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 860             byte[] blob = c.getBlob(ICON_INDEX);                                                         </span>
<span class="-7768091047370598017" onmouseenter="enter('-7768091047370598017');" onmouseout="out('-7768091047370598017');" style=""> 861             if ((blob != null) &amp;&amp; (blob.length &gt; 0)) {                                                   </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 862                 favorite.icon = blob;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 864         }                                                                                                </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 865         String title = c.getString(TITLE_INDEX);                                                         </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 866         if (!TextUtils.isEmpty(title)) {                                                                 </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 867             favorite.title = title;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868         }                                                                                                </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style=""> 869         String intentDescription = c.getString(INTENT_INDEX);                                            </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style=""> 870         if (!TextUtils.isEmpty(intentDescription)) {                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 871             try {                                                                                        </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 872                 Intent intent = Intent.parseUri(intentDescription, 0);                                   </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style=""> 873                 intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                              </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style=""> 874                 favorite.intent = intent.toUri(0);                                                       </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 875             } catch (URISyntaxException e) {                                                             </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style=""> 876                 Log.e(TAG, &quot;Invalid intent&quot;, e);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878         }                                                                                                </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 879         favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                   </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 880         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 881             favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                         </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 882             String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                            </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 883             if (!TextUtils.isEmpty(appWidgetProvider)) {                                                 </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 884                 favorite.appWidgetProvider = appWidgetProvider;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 885             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886         }                                                                                                </span>
<span class="-8315891601108782355" onmouseenter="enter('-8315891601108782355');" onmouseout="out('-8315891601108782355');" style=""> 887         return writeCheckedBytes(favorite);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888     }                                                                                                    </span>
<span  style=""> 889                                                                                                          </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 890     /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                    </span>
<span class="3268340933811099299" onmouseenter="enter('3268340933811099299');" onmouseout="out('3268340933811099299');" style=""><abbr title=" 891     private ContentValues unpackFavorite(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNanoException {"> 891     private ContentValues unpackFavorite(byte[] buffer, int offset, int dataSize) throws InvalidProtocolB</abbr></span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 892         Favorite favorite = new Favorite();                                                              </span>
<span class="1666030682203596411" onmouseenter="enter('1666030682203596411');" onmouseout="out('1666030682203596411');" style=""> 893         MessageNano.mergeFrom(favorite, readCheckedBytes(buffer, offset, dataSize));                     </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 894         if (VERBOSE) {                                                                                   </span>
<span class="-1304622888080116163" onmouseenter="enter('-1304622888080116163');" onmouseout="out('-1304622888080116163');" style=""><abbr title=" 895             Log.v(TAG, ((&quot;unpacked favorite &quot; + favorite.itemType) + &quot;, &quot;) + (TextUtils.isEmpty(favorite.title) ? favorite.id : favorite.title));"> 895             Log.v(TAG, ((&quot;unpacked favorite &quot; + favorite.itemType) + &quot;, &quot;) + (TextUtils.isEmpty(favorite.</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 896         }                                                                                                </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 897         ContentValues values = new ContentValues();                                                      </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style=""> 898         values.put(Favorites._ID, favorite.id);                                                          </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style=""> 899         values.put(Favorites.SCREEN, favorite.screen);                                                   </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style=""> 900         values.put(Favorites.CONTAINER, favorite.container);                                             </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style=""> 901         values.put(Favorites.CELLX, favorite.cellX);                                                     </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style=""> 902         values.put(Favorites.CELLY, favorite.cellY);                                                     </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style=""> 903         values.put(Favorites.SPANX, favorite.spanX);                                                     </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style=""> 904         values.put(Favorites.SPANY, favorite.spanY);                                                     </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style=""> 905         values.put(Favorites.ICON_TYPE, favorite.iconType);                                              </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 906         if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                         </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style=""> 907             values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                    </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style=""> 908             values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 909         }                                                                                                </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 910         if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                           </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style=""> 911             values.put(Favorites.ICON, favorite.icon);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912         }                                                                                                </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style=""> 913         if (!TextUtils.isEmpty(favorite.title)) {                                                        </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style=""> 914             values.put(Favorites.TITLE, favorite.title);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 915         } else {                                                                                         </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style=""> 916             values.put(Favorites.TITLE, &quot;&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917         }                                                                                                </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style=""> 918         if (!TextUtils.isEmpty(favorite.intent)) {                                                       </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style=""> 919             values.put(Favorites.INTENT, favorite.intent);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 920         }                                                                                                </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style=""> 921         values.put(Favorites.ITEM_TYPE, favorite.itemType);                                              </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style=""> 922         UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                 </span>
<span class="927954047226477943" onmouseenter="enter('927954047226477943');" onmouseout="out('927954047226477943');" style=""><abbr title=" 923         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);"> 923         long userSerialNumber = UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHand</abbr></span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style=""> 924         values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                             </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 925         if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                        </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style=""> 926             if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                        </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style=""> 927                 values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928             }                                                                                            </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style=""> 929             values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                    </span>
<span class="4553452473703868579" onmouseenter="enter('4553452473703868579');" onmouseout="out('4553452473703868579');" style=""><abbr title=" 930             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY) | LauncherAppWidgetInfo.FLAG_UI_NOT_READY);"> 930             values.put(LauncherSettings.Favorites.RESTORED, (LauncherAppWidgetInfo.FLAG_ID_NOT_VALID | La</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 931         } else {                                                                                         </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style=""> 932             // Let LauncherModel know we&#x27;ve been here.                                                   </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style=""> 933             values.put(LauncherSettings.Favorites.RESTORED, 1);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 934         }                                                                                                </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 935         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 936     }                                                                                                    </span>
<span  style=""> 937                                                                                                          </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 938     /** Serialize a Screen for persistence, including a checksum wrapper. */                             </span>
<span class="-1055302898918768280" onmouseenter="enter('-1055302898918768280');" onmouseout="out('-1055302898918768280');" style=""> 939     private byte[] packScreen(Cursor c) {                                                                </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 940         Screen screen = new Screen();                                                                    </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 941         screen.id = c.getLong(ID_INDEX);                                                                 </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 942         screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                       </span>
<span  style=""> 943                                                                                                          </span>
<span class="-8008243495242652634" onmouseenter="enter('-8008243495242652634');" onmouseout="out('-8008243495242652634');" style=""> 944         return writeCheckedBytes(screen);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 945     }                                                                                                    </span>
<span  style=""> 946                                                                                                          </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 947     /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                      </span>
<span class="-4502054042265205794" onmouseenter="enter('-4502054042265205794');" onmouseout="out('-4502054042265205794');" style=""><abbr title=" 948     private ContentValues unpackScreen(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNanoException {"> 948     private ContentValues unpackScreen(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBuf</abbr></span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 949         Screen screen = new Screen();                                                                    </span>
<span class="5997669843530195787" onmouseenter="enter('5997669843530195787');" onmouseout="out('5997669843530195787');" style=""> 950         MessageNano.mergeFrom(screen, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 951         if (VERBOSE) {                                                                                   </span>
<span class="-6397898295986560434" onmouseenter="enter('-6397898295986560434');" onmouseout="out('-6397898295986560434');" style=""> 952             Log.v(TAG, ((&quot;unpacked screen &quot; + screen.id) + &quot;/&quot;) + screen.rank);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 953         }                                                                                                </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 954         ContentValues values = new ContentValues();                                                      </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style=""> 955         values.put(WorkspaceScreens._ID, screen.id);                                                     </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style=""> 956         values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                           </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style=""> 957         return values;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 958     }                                                                                                    </span>
<span  style=""> 959                                                                                                          </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 960     /** Serialize an icon Resource for persistence, including a checksum wrapper. */                     </span>
<span class="1129196888280545123" onmouseenter="enter('1129196888280545123');" onmouseout="out('1129196888280545123');" style=""> 961     private byte[] packIcon(int dpi, Bitmap icon) {                                                      </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 962         Resource res = new Resource();                                                                   </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 963         res.dpi = dpi;                                                                                   </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 964         ByteArrayOutputStream os = new ByteArrayOutputStream();                                          </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 965         if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 966             res.data = os.toByteArray();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 967         }                                                                                                </span>
<span class="-2324310893561295790" onmouseenter="enter('-2324310893561295790');" onmouseout="out('-2324310893561295790');" style=""> 968         return writeCheckedBytes(res);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 969     }                                                                                                    </span>
<span  style=""> 970                                                                                                          </span>
<span class="-8685556113116579868" onmouseenter="enter('-8685556113116579868');" onmouseout="out('-8685556113116579868');" style=""> 971     /** Deserialize an icon resource from persistence, after verifying checksum wrapper. */              </span>
<span class="6704844096795089653" onmouseenter="enter('6704844096795089653');" onmouseout="out('6704844096795089653');" style=""><abbr title=" 972     private static Resource unpackIcon(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNanoException {"> 972     private static Resource unpackIcon(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBuf</abbr></span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 973         Resource res = new Resource();                                                                   </span>
<span class="760491121676290671" onmouseenter="enter('760491121676290671');" onmouseout="out('760491121676290671');" style=""> 974         MessageNano.mergeFrom(res, readCheckedBytes(buffer, offset, dataSize));                          </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style=""> 975         if (VERBOSE) {                                                                                   </span>
<span class="-7563174566491530804" onmouseenter="enter('-7563174566491530804');" onmouseout="out('-7563174566491530804');" style=""> 976             Log.v(TAG, ((&quot;unpacked icon &quot; + res.dpi) + &quot;/&quot;) + res.data.length);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977         }                                                                                                </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 978         return res;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979     }                                                                                                    </span>
<span  style=""> 980                                                                                                          </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 981     /** Serialize a widget for persistence, including a checksum wrapper. */                             </span>
<span class="-476988516990873332" onmouseenter="enter('-476988516990873332');" onmouseout="out('-476988516990873332');" style=""> 982     private byte[] packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,           </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style=""> 983             ComponentName provider) {                                                                    </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style=""> 984         final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                          </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 985         Widget widget = new Widget();                                                                    </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 986         widget.provider = provider.flattenToShortString();                                               </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 987         widget.label = info.label;                                                                       </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 988         widget.configure = info.configure != null;                                                       </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 989         if (info.icon != 0) {                                                                            </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 990             widget.icon = new Resource();                                                                </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style=""> 991             Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);       </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 992             Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                             </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 993             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 994             if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                            </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style=""> 995                 widget.icon.data = os.toByteArray();                                                     </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 996                 widget.icon.dpi = dpi;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 997             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 998         }                                                                                                </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 999         if (info.previewImage != 0) {                                                                    </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="">1000             widget.preview = new Resource();                                                             </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="">1001             Bitmap preview = previewLoader.generateWidgetPreview(info, null);                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="">1002             ByteArrayOutputStream os = new ByteArrayOutputStream();                                      </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="">1003             if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                         </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="">1004                 widget.preview.data = os.toByteArray();                                                  </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="">1005                 widget.preview.dpi = dpi;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1006             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007         }                                                                                                </span>
<span class="-6092547598221684616" onmouseenter="enter('-6092547598221684616');" onmouseout="out('-6092547598221684616');" style="">1008         return writeCheckedBytes(widget);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1009     }                                                                                                    </span>
<span  style="">1010                                                                                                          </span>
<span class="2267681228426618803" onmouseenter="enter('2267681228426618803');" onmouseout="out('2267681228426618803');" style="">1011     /** Deserialize a widget from persistence, after verifying checksum wrapper. */                      </span>
<span class="-131168851441758444" onmouseenter="enter('-131168851441758444');" onmouseout="out('-131168851441758444');" style=""><abbr title="1012     private Widget unpackWidget(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNanoException {">1012     private Widget unpackWidget(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNano</abbr></span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1013         Widget widget = new Widget();                                                                    </span>
<span class="-594535766013271981" onmouseenter="enter('-594535766013271981');" onmouseout="out('-594535766013271981');" style="">1014         MessageNano.mergeFrom(widget, readCheckedBytes(buffer, offset, dataSize));                       </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1015         if (VERBOSE) {                                                                                   </span>
<span class="-1797714350779278739" onmouseenter="enter('-1797714350779278739');" onmouseout="out('-1797714350779278739');" style="">1016             Log.v(TAG, &quot;unpacked widget &quot; + widget.provider);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017         }                                                                                                </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1018         return widget;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1019     }                                                                                                    </span>
<span  style="">1020                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1021     /**                                                                                                  </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1022      * Read the old journal from the input file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1023      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1024      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1025      * in that case, do a full backup.                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1026      *                                                                                                   </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1027      * @param oldState the read-0only file descriptor pointing to the old journal                        </span>
<span class="8396039089471161322" onmouseenter="enter('8396039089471161322');" onmouseout="out('8396039089471161322');" style="">1028      * @return a Journal protocol bugffer                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1029      */                                                                                                  </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1030     private Journal readJournal(ParcelFileDescriptor oldState) {                                         </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1031         Journal journal = new Journal();                                                                 </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1032         if (oldState == null) {                                                                          </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1033             return journal;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1034         }                                                                                                </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1035         FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1036         try {                                                                                            </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="">1037             int availableBytes = inStream.available();                                                   </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style="">1038             if (DEBUG) {                                                                                 </span>
<span class="-4677767181497664910" onmouseenter="enter('-4677767181497664910');" onmouseout="out('-4677767181497664910');" style="">1039                 Log.d(TAG, &quot;available &quot; + availableBytes);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1040             }                                                                                            </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="">1041             if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                     </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="">1042                 byte[] buffer = new byte[availableBytes];                                                </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1043                 int bytesRead = 0;                                                                       </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="">1044                 boolean valid = false;                                                                   </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="">1045                 InvalidProtocolBufferNanoException lastProtoException = null;                            </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="">1046                 while (availableBytes &gt; 0) {                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1047                     try {                                                                                </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="">1048                         // OMG what are you doing? This is crazy inefficient!                            </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="">1049                         // If we read a byte that is not ours, we will cause trouble: b/12491813         </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="">1050                         // However, we don&#x27;t know how many bytes to expect (oops).                       </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="">1051                         // So we have to step through *slowly*, watching for the end.                    </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="">1052                         int result = inStream.read(buffer, bytesRead, 1);                                </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1053                         if (result &gt; 0) {                                                                </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="">1054                             availableBytes -= result;                                                    </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1055                             bytesRead += result;                                                         </span>
<span class="-2041262107973838270" onmouseenter="enter('-2041262107973838270');" onmouseout="out('-2041262107973838270');" style="">1056                             if (DEBUG &amp;&amp; ((bytesRead % 100) == 0)) {                                     </span>
<span class="3263531768832665724" onmouseenter="enter('3263531768832665724');" onmouseout="out('3263531768832665724');" style="">1057                                 Log.d(TAG, &quot;read some bytes: &quot; + bytesRead);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1058                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1059                         } else {                                                                         </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="">1060                             Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                 </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="">1061                             // stop reading and see what there is to parse                               </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1062                             availableBytes = 0;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1063                         }                                                                                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1064                     } catch (IOException e) {                                                            </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1065                         buffer = null;                                                                   </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1066                         availableBytes = 0;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067                     }                                                                                    </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="">1068                     // check the buffer to see if we have a valid journal                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1069                     try {                                                                                </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style="">1070                         MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));          </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="">1071                         // if we are here, then we have read a valid, checksum-verified journal          </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="">1072                         valid = true;                                                                    </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="">1073                         availableBytes = 0;                                                              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1074                         if (VERBOSE) {                                                                   </span>
<span class="4872365076470334422" onmouseenter="enter('4872365076470334422');" onmouseout="out('4872365076470334422');" style="">1075                             Log.v(TAG, (&quot;read &quot; + bytesRead) + &quot; bytes of journal&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1076                         }                                                                                </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="">1077                     } catch (InvalidProtocolBufferNanoException e) {                                     </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="">1078                         // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.     </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="">1079                         lastProtoException = e;                                                          </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="">1080                         journal.clear();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1081                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1082                 }                                                                                        </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style="">1083                 if (DEBUG) {                                                                             </span>
<span class="2120539684482410325" onmouseenter="enter('2120539684482410325');" onmouseout="out('2120539684482410325');" style="">1084                     Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1085                 }                                                                                        </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="">1086                 if (!valid) {                                                                            </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="">1087                     Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1088                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1089             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1090         } catch (IOException e) {                                                                        </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1091             Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1092         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1093             try {                                                                                        </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1094                 inStream.close();                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1095             } catch (IOException e) {                                                                    </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="">1096                 Log.w(TAG, &quot;failed to close the journal&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1097             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1098         }                                                                                                </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1099         return journal;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1100     }                                                                                                    </span>
<span  style="">1101                                                                                                          </span>
<span class="3706786417409392873" onmouseenter="enter('3706786417409392873');" onmouseout="out('3706786417409392873');" style=""><abbr title="1102     private void writeRowToBackup(Key key, byte[] blob, Journal out, BackupDataOutput data) throws IOException {">1102     private void writeRowToBackup(Key key, byte[] blob, Journal out, BackupDataOutput data) throws IOExce</abbr></span>
<span class="-8570409028541836443" onmouseenter="enter('-8570409028541836443');" onmouseout="out('-8570409028541836443');" style="">1103         String backupKey = keyToBackupKey(key);                                                          </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1104         data.writeEntityHeader(backupKey, blob.length);                                                  </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1105         data.writeEntityData(blob, blob.length);                                                         </span>
<span class="7907644802080103671" onmouseenter="enter('7907644802080103671');" onmouseout="out('7907644802080103671');" style="">1106         out.rows++;                                                                                      </span>
<span class="-565229434051730696" onmouseenter="enter('-565229434051730696');" onmouseout="out('-565229434051730696');" style="">1107         out.bytes += blob.length;                                                                        </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1108         if (VERBOSE) {                                                                                   </span>
<span class="2783491080834281550" onmouseenter="enter('2783491080834281550');" onmouseout="out('2783491080834281550');" style=""><abbr title="1109             Log.v(TAG, ((((((&quot;saving &quot; + geKeyType(key)) + &quot; &quot;) + backupKey) + &quot;: &quot;) + getKeyName(key)) + &quot;/&quot;) + blob.length);">1109             Log.v(TAG, ((((((&quot;saving &quot; + geKeyType(key)) + &quot; &quot;) + backupKey) + &quot;: &quot;) + getKeyName(key)) +</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1110         }                                                                                                </span>
<span class="-3352481463774338191" onmouseenter="enter('-3352481463774338191');" onmouseout="out('-3352481463774338191');" style="">1111         if (DEBUG_PAYLOAD) {                                                                             </span>
<span class="-7017497320803160772" onmouseenter="enter('-7017497320803160772');" onmouseout="out('-7017497320803160772');" style="">1112             String encoded = Base64.encodeToString(blob, 0, blob.length, Base64.NO_WRAP);                </span>
<span class="-998151031530761193" onmouseenter="enter('-998151031530761193');" onmouseout="out('-998151031530761193');" style="">1113             final int chunkSize = 1024;                                                                  </span>
<span class="4942461364046774481" onmouseenter="enter('4942461364046774481');" onmouseout="out('4942461364046774481');" style="">1114             for (int offset = 0; offset &lt; encoded.length(); offset += chunkSize) {                       </span>
<span class="7644631075752865640" onmouseenter="enter('7644631075752865640');" onmouseout="out('7644631075752865640');" style="">1115                 int end = offset + chunkSize;                                                            </span>
<span class="-7525499051306958146" onmouseenter="enter('-7525499051306958146');" onmouseout="out('-7525499051306958146');" style="">1116                 end = Math.min(end, encoded.length());                                                   </span>
<span class="-5356592555400346432" onmouseenter="enter('-5356592555400346432');" onmouseout="out('-5356592555400346432');" style="">1117                 Log.w(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1118             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1120     }                                                                                                    </span>
<span  style="">1121                                                                                                          </span>
<span class="2702098317253578682" onmouseenter="enter('2702098317253578682');" onmouseout="out('2702098317253578682');" style="">1122     private Set&lt;String&gt; getSavedIdsByType(int type, Journal in) {                                        </span>
<span class="-49943749293500978" onmouseenter="enter('-49943749293500978');" onmouseout="out('-49943749293500978');" style="">1123         Set&lt;String&gt; savedIds = new HashSet&lt;String&gt;();                                                    </span>
<span class="-7898804644582645533" onmouseenter="enter('-7898804644582645533');" onmouseout="out('-7898804644582645533');" style="">1124         for(int i = 0; i &lt; in.key.length; i++) {                                                         </span>
<span class="8349919170880076083" onmouseenter="enter('8349919170880076083');" onmouseout="out('8349919170880076083');" style="">1125             Key key = in.key[i];                                                                         </span>
<span class="-5995133320761897029" onmouseenter="enter('-5995133320761897029');" onmouseout="out('-5995133320761897029');" style="">1126             if (key.type == type) {                                                                      </span>
<span class="3576075164739381606" onmouseenter="enter('3576075164739381606');" onmouseout="out('3576075164739381606');" style="">1127                 savedIds.add(keyToBackupKey(key));                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1128             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1129         }                                                                                                </span>
<span class="-5348725939705536872" onmouseenter="enter('-5348725939705536872');" onmouseout="out('-5348725939705536872');" style="">1130         return savedIds;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1131     }                                                                                                    </span>
<span  style="">1132                                                                                                          </span>
<span class="4907110337131109782" onmouseenter="enter('4907110337131109782');" onmouseout="out('4907110337131109782');" style=""><abbr title="1133     private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data) throws IOException {">1133     private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data) throws IOExcep</abbr></span>
<span class="-4851536707927267136" onmouseenter="enter('-4851536707927267136');" onmouseout="out('-4851536707927267136');" style="">1134         int rows = 0;                                                                                    </span>
<span class="-4323424976188301090" onmouseenter="enter('-4323424976188301090');" onmouseout="out('-4323424976188301090');" style="">1135         for (String deleted : deletedIds) {                                                              </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1136             if (VERBOSE) {                                                                               </span>
<span class="1150942118378003601" onmouseenter="enter('1150942118378003601');" onmouseout="out('1150942118378003601');" style="">1137                 Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1138             }                                                                                            </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style="">1139             data.writeEntityHeader(deleted, -1);                                                         </span>
<span class="3376167913476125145" onmouseenter="enter('3376167913476125145');" onmouseout="out('3376167913476125145');" style="">1140             rows++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1141         }                                                                                                </span>
<span class="7304487908762689425" onmouseenter="enter('7304487908762689425');" onmouseout="out('7304487908762689425');" style="">1142         return rows;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1143     }                                                                                                    </span>
<span  style="">1144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1145     /**                                                                                                  </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1146      * Write the new journal to the output file.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1147      *                                                                                                   </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1148      * In the event of any error, just pretend we didn&#x27;t have a journal,                                 </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1149      * in that case, do a full backup.                                                                   </span>
<span  style="">1150                                                                                                          </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1151      * @param newState the write-only file descriptor pointing to the new journal                        </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1152      * @param journal a Journal protocol buffer                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1153      */                                                                                                  </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1154     private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                          </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1155         FileOutputStream outStream = null;                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1156         try {                                                                                            </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1157             outStream = new FileOutputStream(newState.getFileDescriptor());                              </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="">1158             final byte[] journalBytes = writeCheckedBytes(journal);                                      </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="">1159             outStream.write(journalBytes);                                                               </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1160             outStream.close();                                                                           </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="">1161             if (VERBOSE) {                                                                               </span>
<span class="7354776045593417459" onmouseenter="enter('7354776045593417459');" onmouseout="out('7354776045593417459');" style="">1162                 Log.v(TAG, (&quot;wrote &quot; + journalBytes.length) + &quot; bytes of journal&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1163             }                                                                                            </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1164         } catch (IOException e) {                                                                        </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="">1165             Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1166         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1167     }                                                                                                    </span>
<span  style="">1168                                                                                                          </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1169     /** Wrap a proto in a CheckedMessage and compute the checksum. */                                    </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1170     private byte[] writeCheckedBytes(MessageNano proto) {                                                </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1171         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1172         wrapper.payload = MessageNano.toByteArray(proto);                                                </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1173         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1174         checksum.update(wrapper.payload);                                                                </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1175         wrapper.checksum = checksum.getValue();                                                          </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1176         return MessageNano.toByteArray(wrapper);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1177     }                                                                                                    </span>
<span  style="">1178                                                                                                          </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1179     /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                         </span>
<span class="-219769448460165956" onmouseenter="enter('-219769448460165956');" onmouseout="out('-219769448460165956');" style=""><abbr title="1180     private static byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize) throws InvalidProtocolBufferNanoException {">1180     private static byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize) throws InvalidProtoco</abbr></span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1181         CheckedMessage wrapper = new CheckedMessage();                                                   </span>
<span class="-3959921631204962332" onmouseenter="enter('-3959921631204962332');" onmouseout="out('-3959921631204962332');" style="">1182         MessageNano.mergeFrom(wrapper, buffer, offset, dataSize);                                        </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1183         CRC32 checksum = new CRC32();                                                                    </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1184         checksum.update(wrapper.payload);                                                                </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1185         if (wrapper.checksum != checksum.getValue()) {                                                   </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1186             throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1187         }                                                                                                </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1188         return wrapper.payload;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1189     }                                                                                                    </span>
<span  style="">1190                                                                                                          </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style="">1191     private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                   </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style="">1192         if (mWidgetMap == null) {                                                                        </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style="">1193             List&lt;AppWidgetProviderInfo&gt; widgets =                                                        </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="">1194                     AppWidgetManager.getInstance(mContext).getInstalledProviders();                      </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="">1195             mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());              </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="">1196             for (AppWidgetProviderInfo info : widgets) {                                                 </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="">1197                 mWidgetMap.put(info.provider, info);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1199         }                                                                                                </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="">1200         return mWidgetMap.get(component);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1201     }                                                                                                    </span>
<span  style="">1202                                                                                                          </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="">1203     private boolean initializeIconCache() {                                                              </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="">1204         if (mIconCache != null) {                                                                        </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1205             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="">1207         final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                        </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="">1208         if (appState == null) {                                                                          </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="">1209             Throwable stackTrace = new Throwable();                                                      </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="">1210             stackTrace.fillInStackTrace();                                                               </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="">1211             Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1212             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213         }                                                                                                </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="">1214         mIconCache = appState.getIconCache();                                                            </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="">1215         return mIconCache != null;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1216     }                                                                                                    </span>
<span  style="">1217                                                                                                          </span>
<span class="-342082428602666517" onmouseenter="enter('-342082428602666517');" onmouseout="out('-342082428602666517');" style="">1218 // check if the launcher is in a state to support backup                                                 </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="">1219     private boolean launcherIsReady() {                                                                  </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="">1220         ContentResolver cr = mContext.getContentResolver();                                              </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="">1221         Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);          </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="">1222         if (cursor == null) {                                                                            </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="">1223             // launcher data has been wiped, do nothing                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1224             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1225         }                                                                                                </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="">1226         cursor.close();                                                                                  </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="">1227         if (!initializeIconCache()) {                                                                    </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="">1228             // launcher services are unavailable, try again later                                        </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="">1229             dataChanged();                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1230             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1231         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1232         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1233     }                                                                                                    </span>
<span  style="">1234                                                                                                          </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="">1235     private String getUserSelectionArg() {                                                               </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="">1236         return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                      </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="">1237                 .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1238     }                                                                                                    </span>
<span  style="">1239                                                                                                          </span>
<span class="9065001176904994716" onmouseenter="enter('9065001176904994716');" onmouseout="out('9065001176904994716');" style="">1240     private class KeyParsingException extends Throwable {                                                </span>
<span class="6514561846306478812" onmouseenter="enter('6514561846306478812');" onmouseout="out('6514561846306478812');" style="">1241         private KeyParsingException(Throwable cause) {                                                   </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1242             super(cause);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1243         }                                                                                                </span>
<span  style="">1244                                                                                                          </span>
<span class="8465822963319034792" onmouseenter="enter('8465822963319034792');" onmouseout="out('8465822963319034792');" style="">1245         public KeyParsingException(String reason) {                                                      </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1246             super(reason);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1247         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1248     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1249 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2   * Copyright (C) 2013 The Android Open Source Project                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  16 -                                                                                                                  </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  17  package com.android.launcher3;                                                                                    </span>
<span  style="">  18                                                                                                                    </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  19  import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                               </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  20  import com.google.protobuf.nano.MessageNano;                                                                      </span>
<span  style="">  21                                                                                                                    </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  22  import com.android.launcher3.LauncherSettings.Favorites;                                                          </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  23  import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                                   </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  24  import com.android.launcher3.backup.BackupProtos;                                                                 </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  25  import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                                  </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  26  import com.android.launcher3.backup.BackupProtos.Favorite;                                                        </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  27  import com.android.launcher3.backup.BackupProtos.Journal;                                                         </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  28  import com.android.launcher3.backup.BackupProtos.Key;                                                             </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  29  import com.android.launcher3.backup.BackupProtos.Resource;                                                        </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  30  import com.android.launcher3.backup.BackupProtos.Screen;                                                          </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  31  import com.android.launcher3.backup.BackupProtos.Widget;                                                          </span>
<span class="-8849211230761127863" onmouseenter="enter('-8849211230761127863');" onmouseout="out('-8849211230761127863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import com.android.launcher3.compat.UserManagerCompat;                                                            </span>
<span class="6372524458266053383" onmouseenter="enter('6372524458266053383');" onmouseout="out('6372524458266053383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import com.android.launcher3.compat.UserHandleCompat;                                                             </span>
<span  style="">  34                                                                                                                    </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  35  import android.app.backup.BackupDataInputStream;                                                                  </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  37  import android.app.backup.BackupHelper;                                                                           </span>
<span class="5040189396268993593" onmouseenter="enter('5040189396268993593');" onmouseout="out('5040189396268993593');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import android.app.backup.BackupDataInput;                                                                        </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  40  import android.app.backup.BackupManager;                                                                          </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="">  41  import android.appwidget.AppWidgetManager;                                                                        </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">  42  import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  43  import android.content.ComponentName;                                                                             </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  44  import android.content.ContentResolver;                                                                           </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  46  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  47  import android.content.Intent;                                                                                    </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  48  import android.database.Cursor;                                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  49  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  50  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  51  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  52  import android.os.ParcelFileDescriptor;                                                                           </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  53  import android.text.TextUtils;                                                                                    </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  54  import android.util.Base64;                                                                                       </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  55  import android.util.Log;                                                                                          </span>
<span  style="">  56                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  57  import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  58  import java.io.FileInputStream;                                                                                   </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  59  import java.io.FileOutputStream;                                                                                  </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  60  import java.io.IOException;                                                                                       </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  61  import java.net.URISyntaxException;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  62  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  63  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  64  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  65  import java.util.List;                                                                                            </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  66  import java.util.Set;                                                                                             </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  67  import java.util.zip.CRC32;                                                                                       </span>
<span  style="">  68                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  69  /**                                                                                                               </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  70   * Persist the launcher home state across calamities.                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  71   */                                                                                                               </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  72  public class LauncherBackupHelper implements BackupHelper {                                                       </span>
<span  style="">  73                                                                                                                    </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  74      private static final String TAG = &quot;LauncherBackupHelper&quot;;                                                     </span>
<span class="-423333459707984477" onmouseenter="enter('-423333459707984477');" onmouseout="out('-423333459707984477');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -    private static final boolean DEBUG = false;                                                                   </span>
<span class="1537823244566372262" onmouseenter="enter('1537823244566372262');" onmouseout="out('1537823244566372262');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +    private static final boolean VERBOSE = LauncherBackupAgentHelper.VERBOSE;                                     </span>
<span class="9127186519263571594" onmouseenter="enter('9127186519263571594');" onmouseout="out('9127186519263571594');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    private static final boolean DEBUG = LauncherBackupAgentHelper.DEBUG;                                         </span>
<span class="8681536538150810745" onmouseenter="enter('8681536538150810745');" onmouseout="out('8681536538150810745');" style="">  78      private static final boolean DEBUG_PAYLOAD = false;                                                           </span>
<span  style="">  79                                                                                                                    </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  80      private static final int MAX_JOURNAL_SIZE = 1000000;                                                          </span>
<span  style="">  81                                                                                                                    </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  82      /** icons are large, dribble them out */                                                                      </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  83      private static final int MAX_ICONS_PER_PASS = 10;                                                             </span>
<span  style="">  84                                                                                                                    </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  85      /** widgets contain previews, which are very large, dribble them out */                                       </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  86      private static final int MAX_WIDGETS_PER_PASS = 5;                                                            </span>
<span  style="">  87                                                                                                                    </span>
<span class="-9115528851843838744" onmouseenter="enter('-9115528851843838744');" onmouseout="out('-9115528851843838744');" style="">  88      public static final int IMAGE_COMPRESSION_QUALITY = 75;                                                       </span>
<span  style="">  89                                                                                                                    </span>
<span class="-3087488215496878471" onmouseenter="enter('-3087488215496878471');" onmouseout="out('-3087488215496878471');" style="">  90      public static final String LAUNCHER_PREFIX = &quot;L&quot;;                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                                                                                                                  </span>
<span class="-1120390505463346401" onmouseenter="enter('-1120390505463346401');" onmouseout="out('-1120390505463346401');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +    public static final String LAUNCHER_PREFS_PREFIX = &quot;LP&quot;;                                                      </span>
<span  style="">  93                                                                                                                    </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  94      private static final Bitmap.CompressFormat IMAGE_FORMAT =                                                     </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  95              android.graphics.Bitmap.CompressFormat.PNG;                                                           </span>
<span  style="">  96                                                                                                                    </span>
<span class="-6320109508039674215" onmouseenter="enter('-6320109508039674215');" onmouseout="out('-6320109508039674215');" style="">  97      private static BackupManager sBackupManager;                                                                  </span>
<span  style="">  98                                                                                                                    </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  99      private static final String[] FAVORITE_PROJECTION = {                                                         </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style=""> 100              Favorites._ID,                     // 0                                                               </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style=""> 101              Favorites.MODIFIED,                // 1                                                               </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style=""> 102              Favorites.INTENT,                  // 2                                                               </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style=""> 103              Favorites.APPWIDGET_PROVIDER,      // 3                                                               </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style=""> 104              Favorites.APPWIDGET_ID,            // 4                                                               </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style=""> 105              Favorites.CELLX,                   // 5                                                               </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style=""> 106              Favorites.CELLY,                   // 6                                                               </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style=""> 107              Favorites.CONTAINER,               // 7                                                               </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 108              Favorites.ICON,                    // 8                                                               </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 109              Favorites.ICON_PACKAGE,            // 9                                                               </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 110              Favorites.ICON_RESOURCE,           // 10                                                              </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 111              Favorites.ICON_TYPE,               // 11                                                              </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 112              Favorites.ITEM_TYPE,               // 12                                                              </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 113              Favorites.SCREEN,                  // 13                                                              </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 114              Favorites.SPANX,                   // 14                                                              </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 115              Favorites.SPANY,                   // 15                                                              </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 116              Favorites.TITLE,                   // 16                                                              </span>
<span class="-2648188025495045674" onmouseenter="enter('-2648188025495045674');" onmouseout="out('-2648188025495045674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +            Favorites.PROFILE_ID,              // 17                                                              </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 118      };                                                                                                            </span>
<span  style=""> 119                                                                                                                    </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 120      private static final int ID_INDEX = 0;                                                                        </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 121      private static final int ID_MODIFIED = 1;                                                                     </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 122      private static final int INTENT_INDEX = 2;                                                                    </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 123      private static final int APPWIDGET_PROVIDER_INDEX = 3;                                                        </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 124      private static final int APPWIDGET_ID_INDEX = 4;                                                              </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 125      private static final int CELLX_INDEX = 5;                                                                     </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 126      private static final int CELLY_INDEX = 6;                                                                     </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 127      private static final int CONTAINER_INDEX = 7;                                                                 </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 128      private static final int ICON_INDEX = 8;                                                                      </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 129      private static final int ICON_PACKAGE_INDEX = 9;                                                              </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 130      private static final int ICON_RESOURCE_INDEX = 10;                                                            </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 131      private static final int ICON_TYPE_INDEX = 11;                                                                </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 132      private static final int ITEM_TYPE_INDEX = 12;                                                                </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 133      private static final int SCREEN_INDEX = 13;                                                                   </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 134      private static final int SPANX_INDEX = 14;                                                                    </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 135      private static final int SPANY_INDEX = 15;                                                                    </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 136      private static final int TITLE_INDEX = 16;                                                                    </span>
<span class="-3666133504327950845" onmouseenter="enter('-3666133504327950845');" onmouseout="out('-3666133504327950845');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +    private static final int PROFILE_ID_INDEX = 17;                                                               </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 139      private static final String[] SCREEN_PROJECTION = {                                                           </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 140              WorkspaceScreens._ID,              // 0                                                               </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 141              WorkspaceScreens.MODIFIED,         // 1                                                               </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 142              WorkspaceScreens.SCREEN_RANK       // 2                                                               </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 143      };                                                                                                            </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 145      private static final int SCREEN_RANK_INDEX = 2;                                                               </span>
<span  style=""> 146                                                                                                                    </span>
<span class="1370853386149545885" onmouseenter="enter('1370853386149545885');" onmouseout="out('1370853386149545885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +    private static IconCache mIconCache;                                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 149      private final Context mContext;                                                                               </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-8743166978913928813" onmouseenter="enter('-8743166978913928813');" onmouseout="out('-8743166978913928813');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    private final boolean mRestoreEnabled;                                                                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                                                                                                                  </span>
<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style=""> 153      private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                             </span>
<span  style=""> 154                                                                                                                    </span>
<span class="2729926087087724486" onmouseenter="enter('2729926087087724486');" onmouseout="out('2729926087087724486');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -    private ArrayList&lt;Key&gt; mKeys;                                                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -                                                                                                                  </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -    public LauncherBackupHelper(Context context) {                                                                </span>
<span class="-5494560231232629871" onmouseenter="enter('-5494560231232629871');" onmouseout="out('-5494560231232629871');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +    private final ArrayList&lt;Key&gt; mKeys;                                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                                                                                                                  </span>
<span class="2664402437757712713" onmouseenter="enter('2664402437757712713');" onmouseout="out('2664402437757712713');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +    public LauncherBackupHelper(Context context, boolean restoreEnabled) {                                        </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 161          mContext = context;                                                                                       </span>
<span class="3162096380580590348" onmouseenter="enter('3162096380580590348');" onmouseout="out('3162096380580590348');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +        mRestoreEnabled = restoreEnabled;                                                                         </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +        mKeys = new ArrayList&lt;Key&gt;();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 166      private void dataChanged() {                                                                                  </span>
<span class="-6280593186860143288" onmouseenter="enter('-6280593186860143288');" onmouseout="out('-6280593186860143288');" style=""> 167          if (sBackupManager == null) {                                                                             </span>
<span class="-1682111607995772618" onmouseenter="enter('-1682111607995772618');" onmouseout="out('-1682111607995772618');" style=""> 168              sBackupManager = new BackupManager(mContext);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169          }                                                                                                         </span>
<span class="-8519501381186315635" onmouseenter="enter('-8519501381186315635');" onmouseout="out('-8519501381186315635');" style=""> 170          sBackupManager.dataChanged();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span  style=""> 172                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 173      /**                                                                                                           </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 174       * Back up launcher data so we can restore the user&#x27;s state on a new device.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 175       *                                                                                                            </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 176       * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 177       *                                                                                                            </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 178       * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 179       *                                                                                                            </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 180       * @param oldState notes from the last backup                                                                 </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 181       * @param data incremental key/value pairs to persist off-device                                              </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 182       * @param newState notes for the next backup                                                                  </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 183       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 184       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 185      @Override                                                                                                     </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 186      public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                               </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 187              ParcelFileDescriptor newState) {                                                                      </span>
<span class="-5617118756948088857" onmouseenter="enter('-5617118756948088857');" onmouseout="out('-5617118756948088857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -        Log.v(TAG, &quot;onBackup&quot;);                                                                                   </span>
<span class="-3526383347385120602" onmouseenter="enter('-3526383347385120602');" onmouseout="out('-3526383347385120602');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +        if (VERBOSE) Log.v(TAG, &quot;onBackup&quot;);                                                                      </span>
<span  style=""> 190                                                                                                                    </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 191          Journal in = readJournal(oldState);                                                                       </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 192          Journal out = new Journal();                                                                              </span>
<span  style=""> 193                                                                                                                    </span>
<span class="-3253084867092672816" onmouseenter="enter('-3253084867092672816');" onmouseout="out('-3253084867092672816');" style=""> 194          long lastBackupTime = in.t;                                                                               </span>
<span class="8932370774979500270" onmouseenter="enter('8932370774979500270');" onmouseout="out('8932370774979500270');" style=""> 195          out.t = System.currentTimeMillis();                                                                       </span>
<span class="-1600347970264493336" onmouseenter="enter('-1600347970264493336');" onmouseout="out('-1600347970264493336');" style=""> 196          out.rows = 0;                                                                                             </span>
<span class="2725575623770373107" onmouseenter="enter('2725575623770373107');" onmouseout="out('2725575623770373107');" style=""> 197          out.bytes = 0;                                                                                            </span>
<span  style=""> 198                                                                                                                    </span>
<span class="1052445760685633825" onmouseenter="enter('1052445760685633825');" onmouseout="out('1052445760685633825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -        Log.v(TAG, &quot;lastBackupTime=&quot; + lastBackupTime);                                                           </span>
<span class="-8521392564577701566" onmouseenter="enter('-8521392564577701566');" onmouseout="out('-8521392564577701566');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +        Log.v(TAG, &quot;lastBackupTime = &quot; + lastBackupTime);                                                         </span>
<span  style=""> 201                                                                                                                    </span>
<span class="4700072589631005259" onmouseenter="enter('4700072589631005259');" onmouseout="out('4700072589631005259');" style=""> 202          ArrayList&lt;Key&gt; keys = new ArrayList&lt;Key&gt;();                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -        try {                                                                                                     </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -            backupFavorites(in, data, out, keys);                                                                 </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -            backupScreens(in, data, out, keys);                                                                   </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -            backupIcons(in, data, out, keys);                                                                     </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -            backupWidgets(in, data, out, keys);                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -        } catch (IOException e) {                                                                                 </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -            Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -                                                                                                                  </span>
<span class="-6592699891127791070" onmouseenter="enter('-6592699891127791070');" onmouseout="out('-6592699891127791070');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -        out.key = keys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                                     </span>
<span class="903881481365121859" onmouseenter="enter('903881481365121859');" onmouseout="out('903881481365121859');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +        if (launcherIsReady()) {                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +            try {                                                                                                 </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                backupFavorites(in, data, out, keys);                                                             </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                backupScreens(in, data, out, keys);                                                               </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                backupIcons(in, data, out, keys);                                                                 </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                backupWidgets(in, data, out, keys);                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +            } catch (IOException e) {                                                                             </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +            }                                                                                                     </span>
<span class="-3926881627572885151" onmouseenter="enter('-3926881627572885151');" onmouseout="out('-3926881627572885151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +            out.key = keys.toArray(new BackupProtos.Key[keys.size()]);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +        } else {                                                                                                  </span>
<span class="-3169554028816730380" onmouseenter="enter('-3169554028816730380');" onmouseout="out('-3169554028816730380');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +            out = in;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                                                                                                                  </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 227          writeJournal(newState, out);                                                                              </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style=""> 228          Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229      }                                                                                                             </span>
<span  style=""> 230                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 231      /**                                                                                                           </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 232       * Restore launcher configuration from the restored data stream.                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 233       *                                                                                                            </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style=""> 234       * &lt;P&gt;Keys may arrive in any order.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 235       *                                                                                                            </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 236       * @param data the key/value pair from the server                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 237       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 238      @Override                                                                                                     </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 239      public void restoreEntity(BackupDataInputStream data) {                                                       </span>
<span class="273471296519358434" onmouseenter="enter('273471296519358434');" onmouseout="out('273471296519358434');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -        Log.v(TAG, &quot;restoreEntity&quot;);                                                                              </span>
<span class="5593645157390984354" onmouseenter="enter('5593645157390984354');" onmouseout="out('5593645157390984354');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 241 -        if (mKeys == null) {                                                                                      </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -            mKeys = new ArrayList&lt;Key&gt;();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -        }                                                                                                         </span>
<span class="6512574494365423863" onmouseenter="enter('6512574494365423863');" onmouseout="out('6512574494365423863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +        if (VERBOSE) Log.v(TAG, &quot;restoreEntity&quot;);                                                                 </span>
<span class="-3135534305680812023" onmouseenter="enter('-3135534305680812023');" onmouseout="out('-3135534305680812023');" style=""> 245          byte[] buffer = new byte[512];                                                                            </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 246              String backupKey = data.getKey();                                                                     </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 247              int dataSize = data.size();                                                                           </span>
<span class="2382724363113702568" onmouseenter="enter('2382724363113702568');" onmouseout="out('2382724363113702568');" style=""> 248              if (buffer.length &lt; dataSize) {                                                                       </span>
<span class="8352923365759736689" onmouseenter="enter('8352923365759736689');" onmouseout="out('8352923365759736689');" style=""> 249                  buffer = new byte[dataSize];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250              }                                                                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 251              Key key = null;                                                                                       </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 252          int bytesRead = 0;                                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 253          try {                                                                                                     </span>
<span class="-6009766373469064808" onmouseenter="enter('-6009766373469064808');" onmouseout="out('-6009766373469064808');" style=""> 254              bytesRead = data.read(buffer, 0, dataSize);                                                           </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 255              if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 256          } catch (IOException e) {                                                                                 </span>
<span class="-8762864952874435126" onmouseenter="enter('-8762864952874435126');" onmouseout="out('-8762864952874435126');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -            Log.d(TAG, &quot;failed to read entity from restore data&quot;, e);                                             </span>
<span class="-1433318685117734483" onmouseenter="enter('-1433318685117734483');" onmouseout="out('-1433318685117734483');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +            Log.e(TAG, &quot;failed to read entity from restore data&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 260          try {                                                                                                     </span>
<span class="-3712536663698109807" onmouseenter="enter('-3712536663698109807');" onmouseout="out('-3712536663698109807');" style=""> 261              key = backupKeyToKey(backupKey);                                                                      </span>
<span class="-5236906212031758004" onmouseenter="enter('-5236906212031758004');" onmouseout="out('-5236906212031758004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +            mKeys.add(key);                                                                                       </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 263              switch (key.type) {                                                                                   </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 264                  case Key.FAVORITE:                                                                                </span>
<span class="-8176296956220002371" onmouseenter="enter('-8176296956220002371');" onmouseout="out('-8176296956220002371');" style=""> 265                      restoreFavorite(key, buffer, dataSize, mKeys);                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 266                      break;                                                                                        </span>
<span  style=""> 267                                                                                                                    </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 268                  case Key.SCREEN:                                                                                  </span>
<span class="-2747327735226535589" onmouseenter="enter('-2747327735226535589');" onmouseout="out('-2747327735226535589');" style=""> 269                      restoreScreen(key, buffer, dataSize, mKeys);                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 270                      break;                                                                                        </span>
<span  style=""> 271                                                                                                                    </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 272                  case Key.ICON:                                                                                    </span>
<span class="-5346432636907736484" onmouseenter="enter('-5346432636907736484');" onmouseout="out('-5346432636907736484');" style=""> 273                      restoreIcon(key, buffer, dataSize, mKeys);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 274                      break;                                                                                        </span>
<span  style=""> 275                                                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 276                  case Key.WIDGET:                                                                                  </span>
<span class="-7791331080833002730" onmouseenter="enter('-7791331080833002730');" onmouseout="out('-7791331080833002730');" style=""> 277                      restoreWidget(key, buffer, dataSize, mKeys);                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 278                      break;                                                                                        </span>
<span  style=""> 279                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 280                  default:                                                                                          </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 281                      Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 282                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283              }                                                                                                     </span>
<span class="2253361419748107399" onmouseenter="enter('2253361419748107399');" onmouseout="out('2253361419748107399');" style=""> 284          } catch (KeyParsingException e) {                                                                         </span>
<span class="-562496230350101976" onmouseenter="enter('-562496230350101976');" onmouseout="out('-562496230350101976');" style=""> 285              Log.w(TAG, &quot;ignoring unparsable backup key: &quot; + backupKey);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286          }                                                                                                         </span>
<span  style=""> 287                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288      }                                                                                                             </span>
<span  style=""> 289                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 290      /**                                                                                                           </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 291       * Record the restore state for the next backup.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 292       *                                                                                                            </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 293       * @param newState notes about the backup state after restore.                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 294       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 295      @Override                                                                                                     </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 296      public void writeNewStateDescription(ParcelFileDescriptor newState) {                                         </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style=""> 297          // clear the output journal time, to force a full backup to                                               </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style=""> 298          // will catch any changes the restore process might have made                                             </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 299          Journal out = new Journal();                                                                              </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style=""> 300          out.t = 0;                                                                                                </span>
<span class="4763841258929064204" onmouseenter="enter('4763841258929064204');" onmouseout="out('4763841258929064204');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -        out.key = mKeys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                                    </span>
<span class="-1416391524744539097" onmouseenter="enter('-1416391524744539097');" onmouseout="out('-1416391524744539097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +        out.key = mKeys.toArray(new BackupProtos.Key[mKeys.size()]);                                              </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 303          writeJournal(newState, out);                                                                              </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style=""> 304          Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                                  </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 305          mKeys.clear();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 308      /**                                                                                                           </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 309       * Write all modified favorites to the data stream.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 310       *                                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 311       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 312       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 313       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 314       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 315       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 316       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 317       */                                                                                                           </span>
<span class="7131268859945314485" onmouseenter="enter('7131268859945314485');" onmouseout="out('7131268859945314485');" style=""> 318      private void backupFavorites(Journal in, BackupDataOutput data, Journal out,                                  </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 319              ArrayList&lt;Key&gt; keys)                                                                                  </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 320              throws IOException {                                                                                  </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 321          // read the old ID set                                                                                    </span>
<span class="1222708127935075798" onmouseenter="enter('1222708127935075798');" onmouseout="out('1222708127935075798');" style=""> 322          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.FAVORITE, in);                                               </span>
<span class="-6977244754148926833" onmouseenter="enter('-6977244754148926833');" onmouseout="out('-6977244754148926833');" style=""> 323          if (DEBUG) Log.d(TAG, &quot;favorite savedIds.size()=&quot; + savedIds.size());                                     </span>
<span  style=""> 324                                                                                                                    </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 325          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 326          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +        // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 328          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -                null, null, null);                                                                                </span>
<span class="-6902239210170798589" onmouseenter="enter('-6902239210170798589');" onmouseout="out('-6902239210170798589');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +                getUserSelectionArg(), null, null);                                                               </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 331          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 332          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 333              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 334              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 335                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 336                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 337                  Key key = getKey(Key.FAVORITE, id);                                                               </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 338                  keys.add(key);                                                                                    </span>
<span class="-1456188938196663667" onmouseenter="enter('-1456188938196663667');" onmouseout="out('-1456188938196663667');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -                currentIds.add(keyToBackupKey(key));                                                              </span>
<span class="6808253458123068684" onmouseenter="enter('6808253458123068684');" onmouseout="out('6808253458123068684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -                if (updateTime &gt; in.t) {                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +                final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                currentIds.add(backupKey);                                                                        </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +                if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                                        </span>
<span class="7001118594211601319" onmouseenter="enter('7001118594211601319');" onmouseout="out('7001118594211601319');" style=""> 344                      byte[] blob = packFavorite(cursor);                                                           </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 345                      writeRowToBackup(key, blob, out, data);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +                } else {                                                                                          </span>
<span class="8521612769654249253" onmouseenter="enter('8521612769654249253');" onmouseout="out('8521612769654249253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +                    if (VERBOSE) Log.v(TAG, &quot;favorite &quot; + id + &quot; was too old: &quot; + updateTime);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 350          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 351              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352          }                                                                                                         </span>
<span class="1671673783823377819" onmouseenter="enter('1671673783823377819');" onmouseout="out('1671673783823377819');" style=""> 353          if (DEBUG) Log.d(TAG, &quot;favorite currentIds.size()=&quot; + currentIds.size());                                 </span>
<span  style=""> 354                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 355          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 356          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 357          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358      }                                                                                                             </span>
<span  style=""> 359                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 360      /**                                                                                                           </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 361       * Read a favorite from the stream.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 362       *                                                                                                            </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 363       * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 364       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 365       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 366       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 367       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 368       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 369       */                                                                                                           </span>
<span class="-1219322022397821860" onmouseenter="enter('-1219322022397821860');" onmouseout="out('-1219322022397821860');" style=""> 370      private void restoreFavorite(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                     </span>
<span class="1710737497733264210" onmouseenter="enter('1710737497733264210');" onmouseout="out('1710737497733264210');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -        Log.v(TAG, &quot;unpacking favorite &quot; + key.id + &quot; (&quot; + dataSize + &quot; bytes)&quot;);                                 </span>
<span class="-6724711968188439671" onmouseenter="enter('-6724711968188439671');" onmouseout="out('-6724711968188439671');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 372 +        if (VERBOSE) Log.v(TAG, &quot;unpacking favorite &quot; + key.id);                                                  </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 373          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 374                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 375                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -        try {                                                                                                     </span>
<span class="-444181517361003992" onmouseenter="enter('-444181517361003992');" onmouseout="out('-444181517361003992');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -            Favorite favorite =  unpackFavorite(buffer, 0, dataSize);                                             </span>
<span class="8353775591472986192" onmouseenter="enter('8353775591472986192');" onmouseout="out('8353775591472986192');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -            if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + favorite.itemType);                                               </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +        if (!mRestoreEnabled) {                                                                                   </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +            if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +                                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +        try {                                                                                                     </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +            ContentResolver cr = mContext.getContentResolver();                                                   </span>
<span class="4257623264587280611" onmouseenter="enter('4257623264587280611');" onmouseout="out('4257623264587280611');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +            ContentValues values = unpackFavorite(buffer, 0, dataSize);                                           </span>
<span class="-1772646669374892986" onmouseenter="enter('-1772646669374892986');" onmouseout="out('-1772646669374892986');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +            cr.insert(Favorites.CONTENT_URI_NO_NOTIFICATION, values);                                             </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 388          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -            Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>
<span class="-2029498838376156786" onmouseenter="enter('-2029498838376156786');" onmouseout="out('-2029498838376156786');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +            Log.e(TAG, &quot;failed to decode favorite&quot;, e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392      }                                                                                                             </span>
<span  style=""> 393                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 394      /**                                                                                                           </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 395       * Write all modified screens to the data stream.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 396       *                                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 397       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 398       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 399       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 400       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 401       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 402       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 403       */                                                                                                           </span>
<span class="1451925655210067336" onmouseenter="enter('1451925655210067336');" onmouseout="out('1451925655210067336');" style=""> 404      private void backupScreens(Journal in, BackupDataOutput data, Journal out,                                    </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 405              ArrayList&lt;Key&gt; keys)                                                                                  </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 406              throws IOException {                                                                                  </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 407          // read the old ID set                                                                                    </span>
<span class="-5113344219820420639" onmouseenter="enter('-5113344219820420639');" onmouseout="out('-5113344219820420639');" style=""> 408          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.SCREEN, in);                                                 </span>
<span class="2041232408079356493" onmouseenter="enter('2041232408079356493');" onmouseout="out('2041232408079356493');" style=""> 409          if (DEBUG) Log.d(TAG, &quot;screen savedIds.size()=&quot; + savedIds.size());                                       </span>
<span  style=""> 410                                                                                                                    </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 411          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 412          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 413          Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                                 </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 414                  null, null, null);                                                                                </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 415          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 416          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 417              cursor.moveToPosition(-1);                                                                            </span>
<span class="-678679666922988121" onmouseenter="enter('-678679666922988121');" onmouseout="out('-678679666922988121');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +            if (DEBUG) Log.d(TAG, &quot;dumping screens after: &quot; + in.t);                                              </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 419              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 420                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 421                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 422                  Key key = getKey(Key.SCREEN, id);                                                                 </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 423                  keys.add(key);                                                                                    </span>
<span class="-1456188938196663667" onmouseenter="enter('-1456188938196663667');" onmouseout="out('-1456188938196663667');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -                currentIds.add(keyToBackupKey(key));                                                              </span>
<span class="6808253458123068684" onmouseenter="enter('6808253458123068684');" onmouseout="out('6808253458123068684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -                if (updateTime &gt; in.t) {                                                                          </span>
<span class="825743902804633473" onmouseenter="enter('825743902804633473');" onmouseout="out('825743902804633473');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +                final String backupKey = keyToBackupKey(key);                                                     </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +                currentIds.add(backupKey);                                                                        </span>
<span class="5185062278068694868" onmouseenter="enter('5185062278068694868');" onmouseout="out('5185062278068694868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +                if (!savedIds.contains(backupKey) || updateTime &gt;= in.t) {                                        </span>
<span class="30579954798815384" onmouseenter="enter('30579954798815384');" onmouseout="out('30579954798815384');" style=""> 429                      byte[] blob = packScreen(cursor);                                                             </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 430                      writeRowToBackup(key, blob, out, data);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +                } else {                                                                                          </span>
<span class="-8953978356667297356" onmouseenter="enter('-8953978356667297356');" onmouseout="out('-8953978356667297356');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +                    if (VERBOSE) Log.v(TAG, &quot;screen &quot; + id + &quot; was too old: &quot; + updateTime);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 435          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 436              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span class="5642954527140901409" onmouseenter="enter('5642954527140901409');" onmouseout="out('5642954527140901409');" style=""> 438          if (DEBUG) Log.d(TAG, &quot;screen currentIds.size()=&quot; + currentIds.size());                                   </span>
<span  style=""> 439                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 440          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 441          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 442          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443      }                                                                                                             </span>
<span  style=""> 444                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 445      /**                                                                                                           </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 446       * Read a screen from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 447       *                                                                                                            </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 448       * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 449       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 450       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 451       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 452       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 453       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 454       */                                                                                                           </span>
<span class="-7250675390519322058" onmouseenter="enter('-7250675390519322058');" onmouseout="out('-7250675390519322058');" style=""> 455      private void restoreScreen(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                       </span>
<span class="-7359569920478585703" onmouseenter="enter('-7359569920478585703');" onmouseout="out('-7359569920478585703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -        Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                                 </span>
<span class="4573297726509540276" onmouseenter="enter('4573297726509540276');" onmouseout="out('4573297726509540276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 457 +        if (VERBOSE) Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 458          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 459                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -        try {                                                                                                     </span>
<span class="5251244504663034495" onmouseenter="enter('5251244504663034495');" onmouseout="out('5251244504663034495');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -            Screen screen = unpackScreen(buffer, 0, dataSize);                                                    </span>
<span class="5267833213520539167" onmouseenter="enter('5267833213520539167');" onmouseout="out('5267833213520539167');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -            if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + screen.rank);                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 463 +                                                                                                                  </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +        if (!mRestoreEnabled) {                                                                                   </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 465 +            if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +            return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +                                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +        try {                                                                                                     </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 470 +            ContentResolver cr = mContext.getContentResolver();                                                   </span>
<span class="4024968274688095863" onmouseenter="enter('4024968274688095863');" onmouseout="out('4024968274688095863');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 471 +            ContentValues values = unpackScreen(buffer, 0, dataSize);                                             </span>
<span class="-4287824043646414514" onmouseenter="enter('-4287824043646414514');" onmouseout="out('-4287824043646414514');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 472 +            cr.insert(WorkspaceScreens.CONTENT_URI, values);                                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 473 +                                                                                                                  </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 474          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -            Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>
<span class="-1711302190142484945" onmouseenter="enter('-1711302190142484945');" onmouseout="out('-1711302190142484945');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 476 +            Log.e(TAG, &quot;failed to decode screen&quot;, e);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478      }                                                                                                             </span>
<span  style=""> 479                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 480      /**                                                                                                           </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 481       * Write all the static icon resources we need to render placeholders                                         </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 482       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 483       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 484       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 485       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 486       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 487       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 488       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 489       */                                                                                                           </span>
<span class="599391339335107838" onmouseenter="enter('599391339335107838');" onmouseout="out('599391339335107838');" style=""> 490      private void backupIcons(Journal in, BackupDataOutput data, Journal out,                                      </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 491              ArrayList&lt;Key&gt; keys) throws IOException {                                                             </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 492          // persist icons that haven&#x27;t been persisted yet                                                          </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -        if (appState == null) {                                                                                   </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +        if (!initializeIconCache()) {                                                                             </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 496              dataChanged(); // try again later                                                                     </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style=""> 497              if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 498              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 500          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="149427024973172530" onmouseenter="enter('149427024973172530');" onmouseout="out('149427024973172530');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -        final IconCache iconCache = appState.getIconCache();                                                      </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 502          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7212397924363484279" onmouseenter="enter('-7212397924363484279');" onmouseout="out('-7212397924363484279');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +        final UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                    </span>
<span  style=""> 504                                                                                                                    </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 505          // read the old ID set                                                                                    </span>
<span class="5971436892288320278" onmouseenter="enter('5971436892288320278');" onmouseout="out('5971436892288320278');" style=""> 506          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.ICON, in);                                                   </span>
<span class="-8460076387801577925" onmouseenter="enter('-8460076387801577925');" onmouseout="out('-8460076387801577925');" style=""> 507          if (DEBUG) Log.d(TAG, &quot;icon savedIds.size()=&quot; + savedIds.size());                                         </span>
<span  style=""> 508                                                                                                                    </span>
<span class="2626596867202985341" onmouseenter="enter('2626596867202985341');" onmouseout="out('2626596867202985341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +        // Don&#x27;t backup apps in other profiles for now.                                                           </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 510          int startRows = out.rows;                                                                                 </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 511          if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                                     </span>
<span class="-4292763550535280363" onmouseenter="enter('-4292763550535280363');" onmouseout="out('-4292763550535280363');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 512 -        String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION;                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 513 +                                                                                                                  </span>
<span class="6080020458928059366" onmouseenter="enter('6080020458928059366');" onmouseout="out('6080020458928059366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 514 +        String where = &quot;(&quot; + Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION + &quot; OR &quot; +               </span>
<span class="848065456699094851" onmouseenter="enter('848065456699094851');" onmouseout="out('848065456699094851');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 515 +                Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_SHORTCUT + &quot;) AND &quot; +                             </span>
<span class="-8930859756961504374" onmouseenter="enter('-8930859756961504374');" onmouseout="out('-8930859756961504374');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 516 +                getUserSelectionArg();                                                                            </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 517          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 518                  where, null, null);                                                                               </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 519          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 520          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 521              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 522              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 523                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 524                  final String intentDescription = cursor.getString(INTENT_INDEX);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 525                  try {                                                                                             </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 526                      Intent intent = Intent.parseUri(intentDescription, 0);                                        </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 527                      ComponentName cn = intent.getComponent();                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 528                      Key key = null;                                                                               </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 529                      String backupKey = null;                                                                      </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 530                      if (cn != null) {                                                                             </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 531                          key = getKey(Key.ICON, cn.flattenToShortString());                                        </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 532                          backupKey = keyToBackupKey(key);                                                          </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 533                          currentIds.add(backupKey);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 534                      } else {                                                                                      </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 535                          Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536                      }                                                                                             </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 537                      if (savedIds.contains(backupKey)) {                                                           </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 538 -                        if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                                 </span>
<span class="-8671855074852006779" onmouseenter="enter('-8671855074852006779');" onmouseout="out('-8671855074852006779');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 539 +                        if (VERBOSE) Log.v(TAG, &quot;already saved icon &quot; + backupKey);                               </span>
<span  style=""> 540                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 541                          // remember that we already backed this up previously                                     </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 542                          keys.add(key);                                                                            </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 543                      } else if (backupKey != null) {                                                               </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 544                          if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                              </span>
<span class="-9006656974661932570" onmouseenter="enter('-9006656974661932570');" onmouseout="out('-9006656974661932570');" style=""> 545                          if ((out.rows - startRows) &lt; MAX_ICONS_PER_PASS) {                                        </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 546 -                            if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                                    </span>
<span class="-5470035225995042850" onmouseenter="enter('-5470035225995042850');" onmouseout="out('-5470035225995042850');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 547 -                            Bitmap icon = iconCache.getIcon(intent);                                              </span>
<span class="8708467958147908091" onmouseenter="enter('8708467958147908091');" onmouseout="out('8708467958147908091');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 548 +                            if (VERBOSE) Log.v(TAG, &quot;saving icon &quot; + backupKey);                                  </span>
<span class="-7226267782728338090" onmouseenter="enter('-7226267782728338090');" onmouseout="out('-7226267782728338090');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +                            Bitmap icon = mIconCache.getIcon(intent, myUserHandle);                               </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 550                              keys.add(key);                                                                        </span>
<span class="-8248254087701230428" onmouseenter="enter('-8248254087701230428');" onmouseout="out('-8248254087701230428');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 551 -                            if (icon != null &amp;&amp; !iconCache.isDefaultIcon(icon)) {                                 </span>
<span class="622069302121830952" onmouseenter="enter('622069302121830952');" onmouseout="out('622069302121830952');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +                            if (icon != null &amp;&amp; !mIconCache.isDefaultIcon(icon, myUserHandle)) {                  </span>
<span class="-1917944616523216064" onmouseenter="enter('-1917944616523216064');" onmouseout="out('-1917944616523216064');" style=""> 553                                  byte[] blob = packIcon(dpi, icon);                                                </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 554                                  writeRowToBackup(key, blob, out, data);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 556                          } else {                                                                                  </span>
<span class="3481547132000423214" onmouseenter="enter('3481547132000423214');" onmouseout="out('3481547132000423214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -                            if (DEBUG) Log.d(TAG, &quot;scheduling another run for icon &quot; + backupKey);                </span>
<span class="-7058657490284379944" onmouseenter="enter('-7058657490284379944');" onmouseout="out('-7058657490284379944');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 558 +                            if (VERBOSE) Log.d(TAG, &quot;deferring icon backup &quot; + backupKey);                        </span>
<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 559                              // too many icons for this pass, request another.                                     </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 560                              dataChanged();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562                      }                                                                                             </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 563                  } catch (URISyntaxException e) {                                                                  </span>
<span class="-2603583536470475189" onmouseenter="enter('-2603583536470475189');" onmouseout="out('-2603583536470475189');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 564 -                    Log.w(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>
<span class="8042182106447087010" onmouseenter="enter('8042182106447087010');" onmouseout="out('8042182106447087010');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 565 +                    Log.e(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 566                  } catch (IOException e) {                                                                         </span>
<span class="2092789497893549384" onmouseenter="enter('2092789497893549384');" onmouseout="out('2092789497893549384');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 567 -                    Log.w(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>
<span class="6244542050410690875" onmouseenter="enter('6244542050410690875');" onmouseout="out('6244542050410690875');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 568 +                    Log.e(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569                  }                                                                                                 </span>
<span  style=""> 570                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 572          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 573              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574          }                                                                                                         </span>
<span class="2508143952868696771" onmouseenter="enter('2508143952868696771');" onmouseout="out('2508143952868696771');" style=""> 575          if (DEBUG) Log.d(TAG, &quot;icon currentIds.size()=&quot; + currentIds.size());                                     </span>
<span  style=""> 576                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 577          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 578          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 579          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580      }                                                                                                             </span>
<span  style=""> 581                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 582      /**                                                                                                           </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 583       * Read an icon from the stream.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 584       *                                                                                                            </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 585       * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 586       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 587       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 588       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 589       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 590       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 591       */                                                                                                           </span>
<span class="3418786705842277190" onmouseenter="enter('3418786705842277190');" onmouseout="out('3418786705842277190');" style=""> 592      private void restoreIcon(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                         </span>
<span class="-4078819072521132180" onmouseenter="enter('-4078819072521132180');" onmouseout="out('-4078819072521132180');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 593 -        Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                                   </span>
<span class="-8029005287501619488" onmouseenter="enter('-8029005287501619488');" onmouseout="out('-8029005287501619488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +        if (VERBOSE) Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                      </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 595          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 596                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +                                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 598          try {                                                                                                     </span>
<span class="-1273277075539844188" onmouseenter="enter('-1273277075539844188');" onmouseout="out('-1273277075539844188');" style=""> 599              Resource res = unpackIcon(buffer, 0, dataSize);                                                       </span>
<span class="1340215949763938765" onmouseenter="enter('1340215949763938765');" onmouseout="out('1340215949763938765');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 600 -            if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + res.dpi);                                                         </span>
<span class="3021569960171327606" onmouseenter="enter('3021569960171327606');" onmouseout="out('3021569960171327606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 601 -            if (DEBUG) Log.d(TAG, &quot;read &quot; +                                                                       </span>
<span class="-9086841055072808764" onmouseenter="enter('-9086841055072808764');" onmouseout="out('-9086841055072808764');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 602 -                    Base64.encodeToString(res.data, 0, res.data.length,                                           </span>
<span class="6738045639769732117" onmouseenter="enter('6738045639769732117');" onmouseout="out('6738045639769732117');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 603 -                            Base64.NO_WRAP));                                                                     </span>
<span class="-2534158762775343293" onmouseenter="enter('-2534158762775343293');" onmouseout="out('-2534158762775343293');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +            if (DEBUG) {                                                                                          </span>
<span class="7247426689234184094" onmouseenter="enter('7247426689234184094');" onmouseout="out('7247426689234184094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +                Log.d(TAG, &quot;unpacked &quot; + res.dpi + &quot; dpi icon&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +            }                                                                                                     </span>
<span class="-3352481463774338191" onmouseenter="enter('-3352481463774338191');" onmouseout="out('-3352481463774338191');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +            if (DEBUG_PAYLOAD) {                                                                                  </span>
<span class="-4521366973706198444" onmouseenter="enter('-4521366973706198444');" onmouseout="out('-4521366973706198444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +                Log.d(TAG, &quot;read &quot; +                                                                              </span>
<span class="-9086841055072808764" onmouseenter="enter('-9086841055072808764');" onmouseout="out('-9086841055072808764');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +                        Base64.encodeToString(res.data, 0, res.data.length,                                       </span>
<span class="6738045639769732117" onmouseenter="enter('6738045639769732117');" onmouseout="out('6738045639769732117');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 610 +                                Base64.NO_WRAP));                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 611 +            }                                                                                                     </span>
<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 612              Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                            </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 613              if (icon == null) {                                                                                   </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 614                  Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615              }                                                                                                     </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -        } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -            Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 618 +                                                                                                                  </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 619 +            if (!mRestoreEnabled) {                                                                               </span>
<span class="-5101619137400565428" onmouseenter="enter('-5101619137400565428');" onmouseout="out('-5101619137400565428');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 620 +                if (VERBOSE) {                                                                                    </span>
<span class="5151546546315060729" onmouseenter="enter('5151546546315060729');" onmouseout="out('5151546546315060729');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 621 +                    Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 622 +                }                                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 623 +                return;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 624 +            } else {                                                                                              </span>
<span class="-2563420149233287296" onmouseenter="enter('-2563420149233287296');" onmouseout="out('-2563420149233287296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 625 +                if (VERBOSE) Log.v(TAG, &quot;saving restored icon as: &quot; + key.name);                                  </span>
<span class="8408986404382537202" onmouseenter="enter('8408986404382537202');" onmouseout="out('8408986404382537202');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 626 +                IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(key.name),                      </span>
<span class="6231676971894754004" onmouseenter="enter('6231676971894754004');" onmouseout="out('6231676971894754004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 627 +                        icon, res.dpi);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 628 +            }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +        } catch (IOException e) {                                                                                 </span>
<span class="2331121584648893440" onmouseenter="enter('2331121584648893440');" onmouseout="out('2331121584648893440');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 630 +            Log.d(TAG, &quot;failed to save restored icon for: &quot; + key.name, e);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632      }                                                                                                             </span>
<span  style=""> 633                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 634      /**                                                                                                           </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 635       * Write all the static widget resources we need to render placeholders                                       </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 636       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 637       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 638       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 639       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 640       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 641       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 642       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 643       */                                                                                                           </span>
<span class="-982237492458374713" onmouseenter="enter('-982237492458374713');" onmouseout="out('-982237492458374713');" style=""> 644      private void backupWidgets(Journal in, BackupDataOutput data, Journal out,                                    </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 645              ArrayList&lt;Key&gt; keys) throws IOException {                                                             </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 646          // persist static widget info that hasn&#x27;t been persisted yet                                              </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 647          final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 648 -        if (appState == null) {                                                                                   </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 649 -            dataChanged(); // try again later                                                                     </span>
<span class="6858868851065541463" onmouseenter="enter('6858868851065541463');" onmouseout="out('6858868851065541463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 650 -            if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying widget backup&quot;);                         </span>
<span class="3171498958920755873" onmouseenter="enter('3171498958920755873');" onmouseout="out('3171498958920755873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 651 +        if (appState == null || !initializeIconCache()) {                                                         </span>
<span class="-8001735677136208699" onmouseenter="enter('-8001735677136208699');" onmouseout="out('-8001735677136208699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 652 +            Log.w(TAG, &quot;Failed to get icon cache during restore&quot;);                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 653              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 654          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 655          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 656          final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                              </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 657          final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);                        </span>
<span class="149427024973172530" onmouseenter="enter('149427024973172530');" onmouseout="out('149427024973172530');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 658 -        final IconCache iconCache = appState.getIconCache();                                                      </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 659          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 660          final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                               </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style=""> 661          if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                             </span>
<span  style=""> 662                                                                                                                    </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 663          // read the old ID set                                                                                    </span>
<span class="-852429832136699702" onmouseenter="enter('-852429832136699702');" onmouseout="out('-852429832136699702');" style=""> 664          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.WIDGET, in);                                                 </span>
<span class="-2616909315275324814" onmouseenter="enter('-2616909315275324814');" onmouseout="out('-2616909315275324814');" style=""> 665          if (DEBUG) Log.d(TAG, &quot;widgets savedIds.size()=&quot; + savedIds.size());                                      </span>
<span  style=""> 666                                                                                                                    </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 667          int startRows = out.rows;                                                                                 </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 668          if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                                     </span>
<span class="2063981078009346021" onmouseenter="enter('2063981078009346021');" onmouseout="out('2063981078009346021');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 669 -        String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET;                                 </span>
<span class="-721903767167984418" onmouseenter="enter('-721903767167984418');" onmouseout="out('-721903767167984418');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 670 +        String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET + &quot; AND &quot;                        </span>
<span class="3916454504107746048" onmouseenter="enter('3916454504107746048');" onmouseout="out('3916454504107746048');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 671 +                + getUserSelectionArg();                                                                          </span>
<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 672          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 673                  where, null, null);                                                                               </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 674          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 675          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 676              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 677              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 678                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 679                  final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                           </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 680                  final int spanX = cursor.getInt(SPANX_INDEX);                                                     </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 681                  final int spanY = cursor.getInt(SPANY_INDEX);                                                     </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 682                  final ComponentName provider = ComponentName.unflattenFromString(providerName);                   </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 683                  Key key = null;                                                                                   </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 684                  String backupKey = null;                                                                          </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 685                  if (provider != null) {                                                                           </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 686                      key = getKey(Key.WIDGET, providerName);                                                       </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 687                      backupKey = keyToBackupKey(key);                                                              </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 688                      currentIds.add(backupKey);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 689                  } else {                                                                                          </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 690                      Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691                  }                                                                                                 </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 692                  if (savedIds.contains(backupKey)) {                                                               </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 693 -                    if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                   </span>
<span class="-8428771999657462146" onmouseenter="enter('-8428771999657462146');" onmouseout="out('-8428771999657462146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 694 +                    if (VERBOSE) Log.v(TAG, &quot;already saved widget &quot; + backupKey);                                 </span>
<span  style=""> 695                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 696                      // remember that we already backed this up previously                                         </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 697                      keys.add(key);                                                                                </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 698                  } else if (backupKey != null) {                                                                   </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 699                      if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                                  </span>
<span class="-5873889847669281246" onmouseenter="enter('-5873889847669281246');" onmouseout="out('-5873889847669281246');" style=""> 700                      if ((out.rows - startRows) &lt; MAX_WIDGETS_PER_PASS) {                                          </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 701 -                        if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                                      </span>
<span class="-4960779571857458493" onmouseenter="enter('-4960779571857458493');" onmouseout="out('-4960779571857458493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 702 +                        if (VERBOSE) Log.v(TAG, &quot;saving widget &quot; + backupKey);                                    </span>
<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style=""> 703                          previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                                 </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style=""> 704                                  spanY * profile.cellHeightPx, widgetSpacingLayout);                               </span>
<span class="6921082708123014497" onmouseenter="enter('6921082708123014497');" onmouseout="out('6921082708123014497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 705 -                        byte[] blob = packWidget(dpi, previewLoader, iconCache, provider);                        </span>
<span class="-4963176699005952762" onmouseenter="enter('-4963176699005952762');" onmouseout="out('-4963176699005952762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 706 +                        byte[] blob = packWidget(dpi, previewLoader, mIconCache, provider);                       </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 707                          keys.add(key);                                                                            </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 708                          writeRowToBackup(key, blob, out, data);                                                   </span>
<span  style=""> 709                                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 710                      } else {                                                                                      </span>
<span class="-3116095515592516710" onmouseenter="enter('-3116095515592516710');" onmouseout="out('-3116095515592516710');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 711 -                        if (DEBUG) Log.d(TAG, &quot;scheduling another run for widget &quot; + backupKey);                  </span>
<span class="-2793925555163198542" onmouseenter="enter('-2793925555163198542');" onmouseout="out('-2793925555163198542');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 712 +                        if (VERBOSE) Log.d(TAG, &quot;deferring widget backup &quot; + backupKey);                          </span>
<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 713                          // too many widgets for this pass, request another.                                       </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 714                          dataChanged();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 718          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 719              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720          }                                                                                                         </span>
<span class="7930052468528100382" onmouseenter="enter('7930052468528100382');" onmouseout="out('7930052468528100382');" style=""> 721          if (DEBUG) Log.d(TAG, &quot;widget currentIds.size()=&quot; + currentIds.size());                                   </span>
<span  style=""> 722                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 723          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 724          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 725          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726      }                                                                                                             </span>
<span  style=""> 727                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 728      /**                                                                                                           </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 729       * Read a widget from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 730       *                                                                                                            </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 731       * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 732       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 733       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 734       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 735       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 736       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 737       */                                                                                                           </span>
<span class="-2743597305724887598" onmouseenter="enter('-2743597305724887598');" onmouseout="out('-2743597305724887598');" style=""> 738      private void restoreWidget(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                       </span>
<span class="-6524290342693786597" onmouseenter="enter('-6524290342693786597');" onmouseout="out('-6524290342693786597');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 739 -        Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                                 </span>
<span class="-6776953247643516346" onmouseenter="enter('-6776953247643516346');" onmouseout="out('-6776953247643516346');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 740 +        if (VERBOSE) Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                    </span>
<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 741          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 742                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 743          try {                                                                                                     </span>
<span class="6880516999183343771" onmouseenter="enter('6880516999183343771');" onmouseout="out('6880516999183343771');" style=""> 744              Widget widget = unpackWidget(buffer, 0, dataSize);                                                    </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 745              if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                 </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 746              if (widget.icon.data != null)  {                                                                      </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 747                  Bitmap icon = BitmapFactory                                                                       </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 748                          .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                           </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 749                  if (icon == null) {                                                                               </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 750                      Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 751 +                } else {                                                                                          </span>
<span class="-5118804049175440922" onmouseenter="enter('-5118804049175440922');" onmouseout="out('-5118804049175440922');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 752 +                    IconCache.preloadIcon(mContext, ComponentName.unflattenFromString(widget.provider),           </span>
<span class="-4542677240226290463" onmouseenter="enter('-4542677240226290463');" onmouseout="out('-4542677240226290463');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 753 +                            icon, widget.icon.dpi);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 754                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755              }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 756 +                                                                                                                  </span>
<span class="-354721924667496270" onmouseenter="enter('-354721924667496270');" onmouseout="out('-354721924667496270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 757 +            if (!mRestoreEnabled) {                                                                               </span>
<span class="-6115184810135010085" onmouseenter="enter('-6115184810135010085');" onmouseout="out('-6115184810135010085');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 758 +                if (VERBOSE) Log.v(TAG, &quot;restore not enabled: skipping database mutation&quot;);                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 759 +                return;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 760 +            } else {                                                                                              </span>
<span class="3006510902671207879" onmouseenter="enter('3006510902671207879');" onmouseout="out('3006510902671207879');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 761 +                // future site of widget table mutation                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 762 +            }                                                                                                     </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 763          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 764 -            Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>
<span class="-1867545559162052515" onmouseenter="enter('-1867545559162052515');" onmouseout="out('-1867545559162052515');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 765 +            Log.e(TAG, &quot;failed to decode widget&quot;, e);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767      }                                                                                                             </span>
<span  style=""> 768                                                                                                                    </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 769      /** create a new key, with an integer ID.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 770       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 771       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 772       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 773       */                                                                                                           </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 774      private Key getKey(int type, long id) {                                                                       </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 775          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 776          key.type = type;                                                                                          </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 777          key.id = id;                                                                                              </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 778          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 779          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780      }                                                                                                             </span>
<span  style=""> 781                                                                                                                    </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 782      /** create a new key for a named object.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 783       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 784       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 785       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 786       */                                                                                                           </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 787      private Key getKey(int type, String name) {                                                                   </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 788          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 789          key.type = type;                                                                                          </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 790          key.name = name;                                                                                          </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 791          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 792          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 793      }                                                                                                             </span>
<span  style=""> 794                                                                                                                    </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 795      /** keys need to be strings, serialize and encode. */                                                         </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 796      private String keyToBackupKey(Key key) {                                                                      </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 797          return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798      }                                                                                                             </span>
<span  style=""> 799                                                                                                                    </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 800      /** keys need to be strings, decode and parse. */                                                             </span>
<span class="3565153267272331252" onmouseenter="enter('3565153267272331252');" onmouseout="out('3565153267272331252');" style=""> 801      private Key backupKeyToKey(String backupKey) throws KeyParsingException {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 802          try {                                                                                                     </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 803              Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                                    </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 804              if (key.checksum != checkKey(key)) {                                                                  </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 805                  key = null;                                                                                       </span>
<span class="7886037428699907314" onmouseenter="enter('7886037428699907314');" onmouseout="out('7886037428699907314');" style=""> 806                  throw new KeyParsingException(&quot;invalid key read from stream&quot; + backupKey);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807              }                                                                                                     </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 808              return key;                                                                                           </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 809          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 810              throw new KeyParsingException(e);                                                                     </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 811          } catch (IllegalArgumentException e) {                                                                    </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 812              throw new KeyParsingException(e);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814      }                                                                                                             </span>
<span  style=""> 815                                                                                                                    </span>
<span class="-9026907230628270971" onmouseenter="enter('-9026907230628270971');" onmouseout="out('-9026907230628270971');" style=""> 816      private String getKeyName(Key key) {                                                                          </span>
<span class="-7992041348690575973" onmouseenter="enter('-7992041348690575973');" onmouseout="out('-7992041348690575973');" style=""> 817          if (TextUtils.isEmpty(key.name)) {                                                                        </span>
<span class="3948647275026092398" onmouseenter="enter('3948647275026092398');" onmouseout="out('3948647275026092398');" style=""> 818              return Long.toString(key.id);                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 819          } else {                                                                                                  </span>
<span class="-8847809052433174647" onmouseenter="enter('-8847809052433174647');" onmouseout="out('-8847809052433174647');" style=""> 820              return key.name;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821          }                                                                                                         </span>
<span  style=""> 822                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823      }                                                                                                             </span>
<span  style=""> 824                                                                                                                    </span>
<span class="-3302500785890956613" onmouseenter="enter('-3302500785890956613');" onmouseout="out('-3302500785890956613');" style=""> 825      private String geKeyType(Key key) {                                                                           </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 826          switch (key.type) {                                                                                       </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 827              case Key.FAVORITE:                                                                                    </span>
<span class="-6693583981393703832" onmouseenter="enter('-6693583981393703832');" onmouseout="out('-6693583981393703832');" style=""> 828                  return &quot;favorite&quot;;                                                                                </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 829              case Key.SCREEN:                                                                                      </span>
<span class="-935980872443992001" onmouseenter="enter('-935980872443992001');" onmouseout="out('-935980872443992001');" style=""> 830                  return &quot;screen&quot;;                                                                                  </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 831              case Key.ICON:                                                                                        </span>
<span class="-6438997020167939033" onmouseenter="enter('-6438997020167939033');" onmouseout="out('-6438997020167939033');" style=""> 832                  return &quot;icon&quot;;                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 833              case Key.WIDGET:                                                                                      </span>
<span class="875584635155758752" onmouseenter="enter('875584635155758752');" onmouseout="out('875584635155758752');" style=""> 834                  return &quot;widget&quot;;                                                                                  </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 835              default:                                                                                              </span>
<span class="-9117731612531303028" onmouseenter="enter('-9117731612531303028');" onmouseout="out('-9117731612531303028');" style=""> 836                  return &quot;anonymous&quot;;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838      }                                                                                                             </span>
<span  style=""> 839                                                                                                                    </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 840      /** Compute the checksum over the important bits of a key. */                                                 </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 841      private long checkKey(Key key) {                                                                              </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 842          CRC32 checksum = new CRC32();                                                                             </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 843          checksum.update(key.type);                                                                                </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 844          checksum.update((int) (key.id &amp; 0xffff));                                                                 </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 845          checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                         </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 846          if (!TextUtils.isEmpty(key.name)) {                                                                       </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 847              checksum.update(key.name.getBytes());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 848          }                                                                                                         </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 849          return checksum.getValue();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850      }                                                                                                             </span>
<span  style=""> 851                                                                                                                    </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 852      /** Serialize a Favorite for persistence, including a checksum wrapper. */                                    </span>
<span class="-4378147688590970666" onmouseenter="enter('-4378147688590970666');" onmouseout="out('-4378147688590970666');" style=""> 853      private byte[] packFavorite(Cursor c) {                                                                       </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 854          Favorite favorite = new Favorite();                                                                       </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 855          favorite.id = c.getLong(ID_INDEX);                                                                        </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 856          favorite.screen = c.getInt(SCREEN_INDEX);                                                                 </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 857          favorite.container = c.getInt(CONTAINER_INDEX);                                                           </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 858          favorite.cellX = c.getInt(CELLX_INDEX);                                                                   </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 859          favorite.cellY = c.getInt(CELLY_INDEX);                                                                   </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 860          favorite.spanX = c.getInt(SPANX_INDEX);                                                                   </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 861          favorite.spanY = c.getInt(SPANY_INDEX);                                                                   </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 862          favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                            </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 863          if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 864              String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                                 </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 865              if (!TextUtils.isEmpty(iconPackage)) {                                                                </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 866                  favorite.iconPackage = iconPackage;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867              }                                                                                                     </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 868              String iconResource = c.getString(ICON_RESOURCE_INDEX);                                               </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 869              if (!TextUtils.isEmpty(iconResource)) {                                                               </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 870                  favorite.iconResource = iconResource;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872          }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 873          if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 874              byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 875              if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 876                  favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878          }                                                                                                         </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 879          String title = c.getString(TITLE_INDEX);                                                                  </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 880          if (!TextUtils.isEmpty(title)) {                                                                          </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 881              favorite.title = title;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882          }                                                                                                         </span>
<span class="4847614394231974705" onmouseenter="enter('4847614394231974705');" onmouseout="out('4847614394231974705');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 883 -        String intent = c.getString(INTENT_INDEX);                                                                </span>
<span class="7524736680884469493" onmouseenter="enter('7524736680884469493');" onmouseout="out('7524736680884469493');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 884 -        if (!TextUtils.isEmpty(intent)) {                                                                         </span>
<span class="5898358777330144092" onmouseenter="enter('5898358777330144092');" onmouseout="out('5898358777330144092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 885 -            favorite.intent = intent;                                                                             </span>
<span class="-9205747587729404596" onmouseenter="enter('-9205747587729404596');" onmouseout="out('-9205747587729404596');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 886 +        String intentDescription = c.getString(INTENT_INDEX);                                                     </span>
<span class="7915361486140027823" onmouseenter="enter('7915361486140027823');" onmouseout="out('7915361486140027823');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 887 +        if (!TextUtils.isEmpty(intentDescription)) {                                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 888 +            try {                                                                                                 </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 889 +                Intent intent = Intent.parseUri(intentDescription, 0);                                            </span>
<span class="8002461636322923420" onmouseenter="enter('8002461636322923420');" onmouseout="out('8002461636322923420');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 890 +                intent.removeExtra(ItemInfo.EXTRA_PROFILE);                                                       </span>
<span class="1304563527072325215" onmouseenter="enter('1304563527072325215');" onmouseout="out('1304563527072325215');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 891 +                favorite.intent = intent.toUri(0);                                                                </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 892 +            } catch (URISyntaxException e) {                                                                      </span>
<span class="-4396463668071491797" onmouseenter="enter('-4396463668071491797');" onmouseout="out('-4396463668071491797');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 893 +                Log.e(TAG, &quot;Invalid intent&quot;, e);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 894 +           }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 895          }                                                                                                         </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 896          favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 897          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 898              favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                                  </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 899              String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                                     </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 900              if (!TextUtils.isEmpty(appWidgetProvider)) {                                                          </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 901                  favorite.appWidgetProvider = appWidgetProvider;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 902              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903          }                                                                                                         </span>
<span  style=""> 904                                                                                                                    </span>
<span class="-8315891601108782355" onmouseenter="enter('-8315891601108782355');" onmouseout="out('-8315891601108782355');" style=""> 905          return writeCheckedBytes(favorite);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 906      }                                                                                                             </span>
<span  style=""> 907                                                                                                                    </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 908      /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                             </span>
<span class="-5885969248246737782" onmouseenter="enter('-5885969248246737782');" onmouseout="out('-5885969248246737782');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 909 -    private Favorite unpackFavorite(byte[] buffer, int offset, int dataSize)                                      </span>
<span class="-5696583694055723136" onmouseenter="enter('-5696583694055723136');" onmouseout="out('-5696583694055723136');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 910 +    private ContentValues unpackFavorite(byte[] buffer, int offset, int dataSize)                                 </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 911              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 912          Favorite favorite = new Favorite();                                                                       </span>
<span class="1666030682203596411" onmouseenter="enter('1666030682203596411');" onmouseout="out('1666030682203596411');" style=""> 913          MessageNano.mergeFrom(favorite, readCheckedBytes(buffer, offset, dataSize));                              </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 914 -        return favorite;                                                                                          </span>
<span class="-8746500302928937436" onmouseenter="enter('-8746500302928937436');" onmouseout="out('-8746500302928937436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 915 +        if (VERBOSE) Log.v(TAG, &quot;unpacked favorite &quot; + favorite.itemType + &quot;, &quot; +                                 </span>
<span class="-5821514453449777802" onmouseenter="enter('-5821514453449777802');" onmouseout="out('-5821514453449777802');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 916 +                (TextUtils.isEmpty(favorite.title) ? favorite.id : favorite.title));                              </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 917 +        ContentValues values = new ContentValues();                                                               </span>
<span class="-5057525284014551894" onmouseenter="enter('-5057525284014551894');" onmouseout="out('-5057525284014551894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 918 +        values.put(Favorites._ID, favorite.id);                                                                   </span>
<span class="227759343033021636" onmouseenter="enter('227759343033021636');" onmouseout="out('227759343033021636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 919 +        values.put(Favorites.SCREEN, favorite.screen);                                                            </span>
<span class="3683418126830249054" onmouseenter="enter('3683418126830249054');" onmouseout="out('3683418126830249054');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 920 +        values.put(Favorites.CONTAINER, favorite.container);                                                      </span>
<span class="-5613401489459940119" onmouseenter="enter('-5613401489459940119');" onmouseout="out('-5613401489459940119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 921 +        values.put(Favorites.CELLX, favorite.cellX);                                                              </span>
<span class="8908086969051808488" onmouseenter="enter('8908086969051808488');" onmouseout="out('8908086969051808488');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 922 +        values.put(Favorites.CELLY, favorite.cellY);                                                              </span>
<span class="4334927000029544221" onmouseenter="enter('4334927000029544221');" onmouseout="out('4334927000029544221');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 923 +        values.put(Favorites.SPANX, favorite.spanX);                                                              </span>
<span class="-2016410735079266899" onmouseenter="enter('-2016410735079266899');" onmouseout="out('-2016410735079266899');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 924 +        values.put(Favorites.SPANY, favorite.spanY);                                                              </span>
<span class="3957938163625726620" onmouseenter="enter('3957938163625726620');" onmouseout="out('3957938163625726620');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 925 +        values.put(Favorites.ICON_TYPE, favorite.iconType);                                                       </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 926 +        if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="7887169379204839684" onmouseenter="enter('7887169379204839684');" onmouseout="out('7887169379204839684');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 927 +            values.put(Favorites.ICON_PACKAGE, favorite.iconPackage);                                             </span>
<span class="-2295229206718536881" onmouseenter="enter('-2295229206718536881');" onmouseout="out('-2295229206718536881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 928 +            values.put(Favorites.ICON_RESOURCE, favorite.iconResource);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 929 +        }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 930 +        if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="-3993670925010304939" onmouseenter="enter('-3993670925010304939');" onmouseout="out('-3993670925010304939');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 931 +            values.put(Favorites.ICON, favorite.icon);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 932 +        }                                                                                                         </span>
<span class="-8152447740977489292" onmouseenter="enter('-8152447740977489292');" onmouseout="out('-8152447740977489292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 933 +        if (!TextUtils.isEmpty(favorite.title)) {                                                                 </span>
<span class="-1412910428804617702" onmouseenter="enter('-1412910428804617702');" onmouseout="out('-1412910428804617702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 934 +            values.put(Favorites.TITLE, favorite.title);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 935 +        } else {                                                                                                  </span>
<span class="-2304467574324483153" onmouseenter="enter('-2304467574324483153');" onmouseout="out('-2304467574324483153');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 936 +            values.put(Favorites.TITLE, &quot;&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 937 +        }                                                                                                         </span>
<span class="3963404797748147033" onmouseenter="enter('3963404797748147033');" onmouseout="out('3963404797748147033');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 938 +        if (!TextUtils.isEmpty(favorite.intent)) {                                                                </span>
<span class="-1608345469245771411" onmouseenter="enter('-1608345469245771411');" onmouseout="out('-1608345469245771411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 939 +            values.put(Favorites.INTENT, favorite.intent);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 940 +        }                                                                                                         </span>
<span class="-4558658989504091570" onmouseenter="enter('-4558658989504091570');" onmouseout="out('-4558658989504091570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 941 +        values.put(Favorites.ITEM_TYPE, favorite.itemType);                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 942 +                                                                                                                  </span>
<span class="1209398903698813497" onmouseenter="enter('1209398903698813497');" onmouseout="out('1209398903698813497');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 943 +        UserHandleCompat myUserHandle = UserHandleCompat.myUserHandle();                                          </span>
<span class="-6371368302765339463" onmouseenter="enter('-6371368302765339463');" onmouseout="out('-6371368302765339463');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 944 +        long userSerialNumber =                                                                                   </span>
<span class="7793727039528191097" onmouseenter="enter('7793727039528191097');" onmouseout="out('7793727039528191097');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 945 +                UserManagerCompat.getInstance(mContext).getSerialNumberForUser(myUserHandle);                     </span>
<span class="-1880957120536425376" onmouseenter="enter('-1880957120536425376');" onmouseout="out('-1880957120536425376');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 946 +        values.put(LauncherSettings.Favorites.PROFILE_ID, userSerialNumber);                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 947 +                                                                                                                  </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 948 +        if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="298875864430596390" onmouseenter="enter('298875864430596390');" onmouseout="out('298875864430596390');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 949 +            if (!TextUtils.isEmpty(favorite.appWidgetProvider)) {                                                 </span>
<span class="7981916891141046731" onmouseenter="enter('7981916891141046731');" onmouseout="out('7981916891141046731');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 950 +                values.put(Favorites.APPWIDGET_PROVIDER, favorite.appWidgetProvider);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 951 +            }                                                                                                     </span>
<span class="2729592901829338511" onmouseenter="enter('2729592901829338511');" onmouseout="out('2729592901829338511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 952 +            values.put(Favorites.APPWIDGET_ID, favorite.appWidgetId);                                             </span>
<span class="-3056571748664136340" onmouseenter="enter('-3056571748664136340');" onmouseout="out('-3056571748664136340');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 953 +            values.put(LauncherSettings.Favorites.RESTORED,                                                       </span>
<span class="-8035781287430809914" onmouseenter="enter('-8035781287430809914');" onmouseout="out('-8035781287430809914');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 954 +                    LauncherAppWidgetInfo.FLAG_ID_NOT_VALID |                                                     </span>
<span class="-3350326397777021458" onmouseenter="enter('-3350326397777021458');" onmouseout="out('-3350326397777021458');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 955 +                    LauncherAppWidgetInfo.FLAG_PROVIDER_NOT_READY |                                               </span>
<span class="-6346814242342868675" onmouseenter="enter('-6346814242342868675');" onmouseout="out('-6346814242342868675');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 956 +                    LauncherAppWidgetInfo.FLAG_UI_NOT_READY);                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 957 +        } else {                                                                                                  </span>
<span class="-6134112534332255782" onmouseenter="enter('-6134112534332255782');" onmouseout="out('-6134112534332255782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 958 +            // Let LauncherModel know we&#x27;ve been here.                                                            </span>
<span class="-297795690427787430" onmouseenter="enter('-297795690427787430');" onmouseout="out('-297795690427787430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 959 +            values.put(LauncherSettings.Favorites.RESTORED, 1);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 960 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 961 +                                                                                                                  </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 962 +        return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963      }                                                                                                             </span>
<span  style=""> 964                                                                                                                    </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 965      /** Serialize a Screen for persistence, including a checksum wrapper. */                                      </span>
<span class="-1055302898918768280" onmouseenter="enter('-1055302898918768280');" onmouseout="out('-1055302898918768280');" style=""> 966      private byte[] packScreen(Cursor c) {                                                                         </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 967          Screen screen = new Screen();                                                                             </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 968          screen.id = c.getLong(ID_INDEX);                                                                          </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 969          screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                                </span>
<span  style=""> 970                                                                                                                    </span>
<span class="-8008243495242652634" onmouseenter="enter('-8008243495242652634');" onmouseout="out('-8008243495242652634');" style=""> 971          return writeCheckedBytes(screen);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972      }                                                                                                             </span>
<span  style=""> 973                                                                                                                    </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 974      /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                               </span>
<span class="4829208427200429786" onmouseenter="enter('4829208427200429786');" onmouseout="out('4829208427200429786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 975 -    private Screen unpackScreen(byte[] buffer, int offset, int dataSize)                                          </span>
<span class="6886240294794970082" onmouseenter="enter('6886240294794970082');" onmouseout="out('6886240294794970082');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 976 +    private ContentValues unpackScreen(byte[] buffer, int offset, int dataSize)                                   </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 977              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 978          Screen screen = new Screen();                                                                             </span>
<span class="5997669843530195787" onmouseenter="enter('5997669843530195787');" onmouseout="out('5997669843530195787');" style=""> 979          MessageNano.mergeFrom(screen, readCheckedBytes(buffer, offset, dataSize));                                </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 980 -        return screen;                                                                                            </span>
<span class="-8455088715171122130" onmouseenter="enter('-8455088715171122130');" onmouseout="out('-8455088715171122130');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 981 +        if (VERBOSE) Log.v(TAG, &quot;unpacked screen &quot; + screen.id + &quot;/&quot; + screen.rank);                              </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 982 +        ContentValues values = new ContentValues();                                                               </span>
<span class="-6981692163715114678" onmouseenter="enter('-6981692163715114678');" onmouseout="out('-6981692163715114678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 983 +        values.put(WorkspaceScreens._ID, screen.id);                                                              </span>
<span class="3810079161779100912" onmouseenter="enter('3810079161779100912');" onmouseout="out('3810079161779100912');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 984 +        values.put(WorkspaceScreens.SCREEN_RANK, screen.rank);                                                    </span>
<span class="-1403866763234897512" onmouseenter="enter('-1403866763234897512');" onmouseout="out('-1403866763234897512');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 985 +        return values;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 986      }                                                                                                             </span>
<span  style=""> 987                                                                                                                    </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 988      /** Serialize an icon Resource for persistence, including a checksum wrapper. */                              </span>
<span class="1129196888280545123" onmouseenter="enter('1129196888280545123');" onmouseout="out('1129196888280545123');" style=""> 989      private byte[] packIcon(int dpi, Bitmap icon) {                                                               </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 990          Resource res = new Resource();                                                                            </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 991          res.dpi = dpi;                                                                                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 992          ByteArrayOutputStream os = new ByteArrayOutputStream();                                                   </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 993          if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                         </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 994              res.data = os.toByteArray();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 995          }                                                                                                         </span>
<span class="-2324310893561295790" onmouseenter="enter('-2324310893561295790');" onmouseout="out('-2324310893561295790');" style=""> 996          return writeCheckedBytes(res);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 997      }                                                                                                             </span>
<span  style=""> 998                                                                                                                    </span>
<span class="-8685556113116579868" onmouseenter="enter('-8685556113116579868');" onmouseout="out('-8685556113116579868');" style=""> 999      /** Deserialize an icon resource from persistence, after verifying checksum wrapper. */                       </span>
<span class="-8887428982837555818" onmouseenter="enter('-8887428982837555818');" onmouseout="out('-8887428982837555818');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1000 -    private Resource unpackIcon(byte[] buffer, int offset, int dataSize)                                          </span>
<span class="-6700621194159108538" onmouseenter="enter('-6700621194159108538');" onmouseout="out('-6700621194159108538');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1001 +    private static Resource unpackIcon(byte[] buffer, int offset, int dataSize)                                   </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1002              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style="">1003          Resource res = new Resource();                                                                            </span>
<span class="760491121676290671" onmouseenter="enter('760491121676290671');" onmouseout="out('760491121676290671');" style="">1004          MessageNano.mergeFrom(res, readCheckedBytes(buffer, offset, dataSize));                                   </span>
<span class="4102854592882680519" onmouseenter="enter('4102854592882680519');" onmouseout="out('4102854592882680519');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1005 +        if (VERBOSE) Log.v(TAG, &quot;unpacked icon &quot; + res.dpi + &quot;/&quot; + res.data.length);                              </span>
<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style="">1006          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007      }                                                                                                             </span>
<span  style="">1008                                                                                                                    </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style="">1009      /** Serialize a widget for persistence, including a checksum wrapper. */                                      </span>
<span class="-476988516990873332" onmouseenter="enter('-476988516990873332');" onmouseout="out('-476988516990873332');" style="">1010      private byte[] packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,                    </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style="">1011              ComponentName provider) {                                                                             </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style="">1012          final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                                   </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1013          Widget widget = new Widget();                                                                             </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style="">1014          widget.provider = provider.flattenToShortString();                                                        </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style="">1015          widget.label = info.label;                                                                                </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style="">1016          widget.configure = info.configure != null;                                                                </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style="">1017          if (info.icon != 0) {                                                                                     </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style="">1018              widget.icon = new Resource();                                                                         </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style="">1019              Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);                </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style="">1020              Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                                      </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="">1021              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style="">1022              if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                     </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style="">1023                  widget.icon.data = os.toByteArray();                                                              </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style="">1024                  widget.icon.dpi = dpi;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1025              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026          }                                                                                                         </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style="">1027          if (info.previewImage != 0) {                                                                             </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style="">1028              widget.preview = new Resource();                                                                      </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style="">1029              Bitmap preview = previewLoader.generateWidgetPreview(info, null);                                     </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style="">1030              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style="">1031              if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                  </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style="">1032                  widget.preview.data = os.toByteArray();                                                           </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style="">1033                  widget.preview.dpi = dpi;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1034              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035          }                                                                                                         </span>
<span class="-6092547598221684616" onmouseenter="enter('-6092547598221684616');" onmouseout="out('-6092547598221684616');" style="">1036          return writeCheckedBytes(widget);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1037      }                                                                                                             </span>
<span  style="">1038                                                                                                                    </span>
<span class="2267681228426618803" onmouseenter="enter('2267681228426618803');" onmouseout="out('2267681228426618803');" style="">1039      /** Deserialize a widget from persistence, after verifying checksum wrapper. */                               </span>
<span class="478875287574324925" onmouseenter="enter('478875287574324925');" onmouseout="out('478875287574324925');" style="">1040      private Widget unpackWidget(byte[] buffer, int offset, int dataSize)                                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1041              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style="">1042          Widget widget = new Widget();                                                                             </span>
<span class="-594535766013271981" onmouseenter="enter('-594535766013271981');" onmouseout="out('-594535766013271981');" style="">1043          MessageNano.mergeFrom(widget, readCheckedBytes(buffer, offset, dataSize));                                </span>
<span class="-6614366492544728686" onmouseenter="enter('-6614366492544728686');" onmouseout="out('-6614366492544728686');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1044 +        if (VERBOSE) Log.v(TAG, &quot;unpacked widget &quot; + widget.provider);                                            </span>
<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style="">1045          return widget;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1046      }                                                                                                             </span>
<span  style="">1047                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1048      /**                                                                                                           </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style="">1049       * Read the old journal from the input file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1050       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1051       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1052       * in that case, do a full backup.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1053       *                                                                                                            </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style="">1054       * @param oldState the read-0only file descriptor pointing to the old journal                                 </span>
<span class="8396039089471161322" onmouseenter="enter('8396039089471161322');" onmouseout="out('8396039089471161322');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1055 -     * @return a Journal protocol bugffer                                                                         </span>
<span class="6080034867877680287" onmouseenter="enter('6080034867877680287');" onmouseout="out('6080034867877680287');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1056 +     * @return a Journal protocol buffer                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1057       */                                                                                                           </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style="">1058      private Journal readJournal(ParcelFileDescriptor oldState) {                                                  </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style="">1059          Journal journal = new Journal();                                                                          </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style="">1060          if (oldState == null) {                                                                                   </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1061              return journal;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1062          }                                                                                                         </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style="">1063          FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1064          try {                                                                                                     </span>
<span class="209452004938020976" onmouseenter="enter('209452004938020976');" onmouseout="out('209452004938020976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1065 -            int remaining = inStream.available();                                                                 </span>
<span class="6131565461738203738" onmouseenter="enter('6131565461738203738');" onmouseout="out('6131565461738203738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1066 -            if (DEBUG) Log.d(TAG, &quot;available &quot; + remaining);                                                      </span>
<span class="-267483951981107204" onmouseenter="enter('-267483951981107204');" onmouseout="out('-267483951981107204');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1067 -            if (remaining &lt; MAX_JOURNAL_SIZE) {                                                                   </span>
<span class="-3947342340233403995" onmouseenter="enter('-3947342340233403995');" onmouseout="out('-3947342340233403995');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1068 -                byte[] buffer = new byte[remaining];                                                              </span>
<span class="-8222525296249693075" onmouseenter="enter('-8222525296249693075');" onmouseout="out('-8222525296249693075');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1069 +            int availableBytes = inStream.available();                                                            </span>
<span class="5055872873099741449" onmouseenter="enter('5055872873099741449');" onmouseout="out('5055872873099741449');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1070 +            if (DEBUG) Log.d(TAG, &quot;available &quot; + availableBytes);                                                 </span>
<span class="-9053208959600560106" onmouseenter="enter('-9053208959600560106');" onmouseout="out('-9053208959600560106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1071 +            if (availableBytes &lt; MAX_JOURNAL_SIZE) {                                                              </span>
<span class="8385081513416328759" onmouseenter="enter('8385081513416328759');" onmouseout="out('8385081513416328759');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1072 +                byte[] buffer = new byte[availableBytes];                                                         </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style="">1073                  int bytesRead = 0;                                                                                </span>
<span class="4297703130763568857" onmouseenter="enter('4297703130763568857');" onmouseout="out('4297703130763568857');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1074 -                while (remaining &gt; 0) {                                                                           </span>
<span class="7830219073317457234" onmouseenter="enter('7830219073317457234');" onmouseout="out('7830219073317457234');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1075 +                boolean valid = false;                                                                            </span>
<span class="818941733718125717" onmouseenter="enter('818941733718125717');" onmouseout="out('818941733718125717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1076 +                InvalidProtocolBufferNanoException lastProtoException = null;                                     </span>
<span class="8034329976536329423" onmouseenter="enter('8034329976536329423');" onmouseout="out('8034329976536329423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1077 +                while (availableBytes &gt; 0) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1078                      try {                                                                                         </span>
<span class="-2823215339347274650" onmouseenter="enter('-2823215339347274650');" onmouseout="out('-2823215339347274650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1079 -                        int result = inStream.read(buffer, bytesRead, remaining);                                 </span>
<span class="907334414277682510" onmouseenter="enter('907334414277682510');" onmouseout="out('907334414277682510');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1080 +                        // OMG what are you doing? This is crazy inefficient!                                     </span>
<span class="6139057602607651129" onmouseenter="enter('6139057602607651129');" onmouseout="out('6139057602607651129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1081 +                        // If we read a byte that is not ours, we will cause trouble: b/12491813                  </span>
<span class="-1583449373743596068" onmouseenter="enter('-1583449373743596068');" onmouseout="out('-1583449373743596068');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1082 +                        // However, we don&#x27;t know how many bytes to expect (oops).                                </span>
<span class="7230628237558975108" onmouseenter="enter('7230628237558975108');" onmouseout="out('7230628237558975108');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1083 +                        // So we have to step through *slowly*, watching for the end.                             </span>
<span class="3200094316398419997" onmouseenter="enter('3200094316398419997');" onmouseout="out('3200094316398419997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1084 +                        int result = inStream.read(buffer, bytesRead, 1);                                         </span>
<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style="">1085                          if (result &gt; 0) {                                                                         </span>
<span class="3314126743897022072" onmouseenter="enter('3314126743897022072');" onmouseout="out('3314126743897022072');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1086 -                            if (DEBUG) Log.d(TAG, &quot;read some bytes: &quot; + result);                                  </span>
<span class="-3086923976409317546" onmouseenter="enter('-3086923976409317546');" onmouseout="out('-3086923976409317546');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1087 -                            remaining -= result;                                                                  </span>
<span class="-629539658942439655" onmouseenter="enter('-629539658942439655');" onmouseout="out('-629539658942439655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1088 +                            availableBytes -= result;                                                             </span>
<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style="">1089                              bytesRead += result;                                                                  </span>
<span class="-8507805265236222004" onmouseenter="enter('-8507805265236222004');" onmouseout="out('-8507805265236222004');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1090 +                            if (DEBUG &amp;&amp; (bytesRead % 100 == 0)) {                                                </span>
<span class="3263531768832665724" onmouseenter="enter('3263531768832665724');" onmouseout="out('3263531768832665724');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1091 +                                Log.d(TAG, &quot;read some bytes: &quot; + bytesRead);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1092 +                            }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1093                          } else {                                                                                  </span>
<span class="8751875442808071737" onmouseenter="enter('8751875442808071737');" onmouseout="out('8751875442808071737');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1094 -                            // stop reading ands see what there is to parse                                       </span>
<span class="5775781333784661132" onmouseenter="enter('5775781333784661132');" onmouseout="out('5775781333784661132');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1095 -                            Log.w(TAG, &quot;read error: &quot; + result);                                                  </span>
<span class="504541059767922271" onmouseenter="enter('504541059767922271');" onmouseout="out('504541059767922271');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1096 -                            remaining = 0;                                                                        </span>
<span class="-292218358454127445" onmouseenter="enter('-292218358454127445');" onmouseout="out('-292218358454127445');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1097 +                            Log.w(TAG, &quot;unexpected end of file while reading journal.&quot;);                          </span>
<span class="-4439654097158745160" onmouseenter="enter('-4439654097158745160');" onmouseout="out('-4439654097158745160');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1098 +                            // stop reading and see what there is to parse                                        </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1099 +                            availableBytes = 0;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1100                          }                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1101                      } catch (IOException e) {                                                                     </span>
<span class="8747165501767895818" onmouseenter="enter('8747165501767895818');" onmouseout="out('8747165501767895818');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1102 -                        Log.w(TAG, &quot;failed to read the journal&quot;, e);                                              </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style="">1103                          buffer = null;                                                                            </span>
<span class="504541059767922271" onmouseenter="enter('504541059767922271');" onmouseout="out('504541059767922271');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1104 -                        remaining = 0;                                                                            </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1105 +                        availableBytes = 0;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1106 +                    }                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1107 +                                                                                                                  </span>
<span class="3636629314004899204" onmouseenter="enter('3636629314004899204');" onmouseout="out('3636629314004899204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1108 +                    // check the buffer to see if we have a valid journal                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1109 +                    try {                                                                                         </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1110 +                        MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));                   </span>
<span class="6516619113806770328" onmouseenter="enter('6516619113806770328');" onmouseout="out('6516619113806770328');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1111 +                        // if we are here, then we have read a valid, checksum-verified journal                   </span>
<span class="-3262102469002205115" onmouseenter="enter('-3262102469002205115');" onmouseout="out('-3262102469002205115');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1112 +                        valid = true;                                                                             </span>
<span class="5720794747520189141" onmouseenter="enter('5720794747520189141');" onmouseout="out('5720794747520189141');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1113 +                        availableBytes = 0;                                                                       </span>
<span class="-4638348795708162134" onmouseenter="enter('-4638348795708162134');" onmouseout="out('-4638348795708162134');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1114 +                        if (VERBOSE) Log.v(TAG, &quot;read &quot; + bytesRead + &quot; bytes of journal&quot;);                       </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1115 +                    } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="2169031391763951920" onmouseenter="enter('2169031391763951920');" onmouseout="out('2169031391763951920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1116 +                        // if we don&#x27;t have the whole journal yet, mergeFrom will throw. keep going.              </span>
<span class="7112012373297597929" onmouseenter="enter('7112012373297597929');" onmouseout="out('7112012373297597929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1117 +                        lastProtoException = e;                                                                   </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1118 +                        journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1120                  }                                                                                                 </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style="">1121                  if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1122 -                                                                                                                  </span>
<span class="-7980038940658798272" onmouseenter="enter('-7980038940658798272');" onmouseout="out('-7980038940658798272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1123 -                if (buffer != null) {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1124 -                    try {                                                                                         </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1125 -                        MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));                   </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1126 -                    } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="-7778790307007077779" onmouseenter="enter('-7778790307007077779');" onmouseout="out('-7778790307007077779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1127 -                        Log.d(TAG, &quot;failed to read the journal&quot;, e);                                              </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1128 -                        journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1129 -                    }                                                                                             </span>
<span class="546049431288159645" onmouseenter="enter('546049431288159645');" onmouseout="out('546049431288159645');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1130 +                if (!valid) {                                                                                     </span>
<span class="-8034690500041652530" onmouseenter="enter('-8034690500041652530');" onmouseout="out('-8034690500041652530');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1131 +                    Log.w(TAG, &quot;could not find a valid journal&quot;, lastProtoException);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1132                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1133              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1134          } catch (IOException e) {                                                                                 </span>
<span class="-8689995825070518460" onmouseenter="enter('-8689995825070518460');" onmouseout="out('-8689995825070518460');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1135 -            Log.d(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1136 +            Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">1137          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1138              try {                                                                                                 </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style="">1139                  inStream.close();                                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1140              } catch (IOException e) {                                                                             </span>
<span class="-8689995825070518460" onmouseenter="enter('-8689995825070518460');" onmouseout="out('-8689995825070518460');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1141 -                Log.d(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>
<span class="-2446950282696617528" onmouseenter="enter('-2446950282696617528');" onmouseout="out('-2446950282696617528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1142 +                Log.w(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1143              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1144          }                                                                                                         </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style="">1145          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1146      }                                                                                                             </span>
<span  style="">1147                                                                                                                    </span>
<span class="1857887861945457945" onmouseenter="enter('1857887861945457945');" onmouseout="out('1857887861945457945');" style="">1148      private void writeRowToBackup(Key key, byte[] blob, Journal out,                                              </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style="">1149              BackupDataOutput data) throws IOException {                                                           </span>
<span class="-8570409028541836443" onmouseenter="enter('-8570409028541836443');" onmouseout="out('-8570409028541836443');" style="">1150          String backupKey = keyToBackupKey(key);                                                                   </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style="">1151          data.writeEntityHeader(backupKey, blob.length);                                                           </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style="">1152          data.writeEntityData(blob, blob.length);                                                                  </span>
<span class="7907644802080103671" onmouseenter="enter('7907644802080103671');" onmouseout="out('7907644802080103671');" style="">1153          out.rows++;                                                                                               </span>
<span class="-565229434051730696" onmouseenter="enter('-565229434051730696');" onmouseout="out('-565229434051730696');" style="">1154          out.bytes += blob.length;                                                                                 </span>
<span class="4102122871293332284" onmouseenter="enter('4102122871293332284');" onmouseout="out('4102122871293332284');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1155 -        Log.v(TAG, &quot;saving &quot; + geKeyType(key) + &quot; &quot; + backupKey + &quot;: &quot; +                                          </span>
<span class="7477494328045094252" onmouseenter="enter('7477494328045094252');" onmouseout="out('7477494328045094252');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1156 +        if (VERBOSE) Log.v(TAG, &quot;saving &quot; + geKeyType(key) + &quot; &quot; + backupKey + &quot;: &quot; +                             </span>
<span class="188331799762465007" onmouseenter="enter('188331799762465007');" onmouseout="out('188331799762465007');" style="">1157                  getKeyName(key) + &quot;/&quot; + blob.length);                                                             </span>
<span class="9073034288274959985" onmouseenter="enter('9073034288274959985');" onmouseout="out('9073034288274959985');" style="">1158          if(DEBUG_PAYLOAD) {                                                                                       </span>
<span class="-7017497320803160772" onmouseenter="enter('-7017497320803160772');" onmouseout="out('-7017497320803160772');" style="">1159              String encoded = Base64.encodeToString(blob, 0, blob.length, Base64.NO_WRAP);                         </span>
<span class="-998151031530761193" onmouseenter="enter('-998151031530761193');" onmouseout="out('-998151031530761193');" style="">1160              final int chunkSize = 1024;                                                                           </span>
<span class="4942461364046774481" onmouseenter="enter('4942461364046774481');" onmouseout="out('4942461364046774481');" style="">1161              for (int offset = 0; offset &lt; encoded.length(); offset += chunkSize) {                                </span>
<span class="7644631075752865640" onmouseenter="enter('7644631075752865640');" onmouseout="out('7644631075752865640');" style="">1162                  int end = offset + chunkSize;                                                                     </span>
<span class="-7525499051306958146" onmouseenter="enter('-7525499051306958146');" onmouseout="out('-7525499051306958146');" style="">1163                  end = Math.min(end, encoded.length());                                                            </span>
<span class="-8734171954713192043" onmouseenter="enter('-8734171954713192043');" onmouseout="out('-8734171954713192043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1164 -                Log.d(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                            </span>
<span class="-5356592555400346432" onmouseenter="enter('-5356592555400346432');" onmouseout="out('-5356592555400346432');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1165 +                Log.w(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1166              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1167          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1168      }                                                                                                             </span>
<span  style="">1169                                                                                                                    </span>
<span class="2702098317253578682" onmouseenter="enter('2702098317253578682');" onmouseout="out('2702098317253578682');" style="">1170      private Set&lt;String&gt; getSavedIdsByType(int type, Journal in) {                                                 </span>
<span class="-49943749293500978" onmouseenter="enter('-49943749293500978');" onmouseout="out('-49943749293500978');" style="">1171          Set&lt;String&gt; savedIds = new HashSet&lt;String&gt;();                                                             </span>
<span class="-7898804644582645533" onmouseenter="enter('-7898804644582645533');" onmouseout="out('-7898804644582645533');" style="">1172          for(int i = 0; i &lt; in.key.length; i++) {                                                                  </span>
<span class="8349919170880076083" onmouseenter="enter('8349919170880076083');" onmouseout="out('8349919170880076083');" style="">1173              Key key = in.key[i];                                                                                  </span>
<span class="-5995133320761897029" onmouseenter="enter('-5995133320761897029');" onmouseout="out('-5995133320761897029');" style="">1174              if (key.type == type) {                                                                               </span>
<span class="3576075164739381606" onmouseenter="enter('3576075164739381606');" onmouseout="out('3576075164739381606');" style="">1175                  savedIds.add(keyToBackupKey(key));                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1177          }                                                                                                         </span>
<span class="-5348725939705536872" onmouseenter="enter('-5348725939705536872');" onmouseout="out('-5348725939705536872');" style="">1178          return savedIds;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1179      }                                                                                                             </span>
<span  style="">1180                                                                                                                    </span>
<span class="-695874875282614773" onmouseenter="enter('-695874875282614773');" onmouseout="out('-695874875282614773');" style="">1181      private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data)                        </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style="">1182              throws IOException {                                                                                  </span>
<span class="-4851536707927267136" onmouseenter="enter('-4851536707927267136');" onmouseout="out('-4851536707927267136');" style="">1183          int rows = 0;                                                                                             </span>
<span class="-713409252568618308" onmouseenter="enter('-713409252568618308');" onmouseout="out('-713409252568618308');" style="">1184          for(String deleted: deletedIds) {                                                                         </span>
<span class="4732917519475294710" onmouseenter="enter('4732917519475294710');" onmouseout="out('4732917519475294710');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1185 -            Log.v(TAG, &quot;dropping icon &quot; + deleted);                                                               </span>
<span class="-3189759540528112886" onmouseenter="enter('-3189759540528112886');" onmouseout="out('-3189759540528112886');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1186 +            if (VERBOSE) Log.v(TAG, &quot;dropping deleted item &quot; + deleted);                                          </span>
<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style="">1187              data.writeEntityHeader(deleted, -1);                                                                  </span>
<span class="3376167913476125145" onmouseenter="enter('3376167913476125145');" onmouseout="out('3376167913476125145');" style="">1188              rows++;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1189          }                                                                                                         </span>
<span class="7304487908762689425" onmouseenter="enter('7304487908762689425');" onmouseout="out('7304487908762689425');" style="">1190          return rows;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1191      }                                                                                                             </span>
<span  style="">1192                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1193      /**                                                                                                           </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style="">1194       * Write the new journal to the output file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1195       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style="">1196       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style="">1197       * in that case, do a full backup.                                                                            </span>
<span  style="">1198                                                                                                                    </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style="">1199       * @param newState the write-only file descriptor pointing to the new journal                                 </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style="">1200       * @param journal a Journal protocol buffer                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1201       */                                                                                                           </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style="">1202      private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                                   </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style="">1203          FileOutputStream outStream = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1204          try {                                                                                                     </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style="">1205              outStream = new FileOutputStream(newState.getFileDescriptor());                                       </span>
<span class="4957080333838569527" onmouseenter="enter('4957080333838569527');" onmouseout="out('4957080333838569527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1206 -            outStream.write(writeCheckedBytes(journal));                                                          </span>
<span class="-1759647434080066625" onmouseenter="enter('-1759647434080066625');" onmouseout="out('-1759647434080066625');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1207 +            final byte[] journalBytes = writeCheckedBytes(journal);                                               </span>
<span class="-2037215022654815479" onmouseenter="enter('-2037215022654815479');" onmouseout="out('-2037215022654815479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1208 +            outStream.write(journalBytes);                                                                        </span>
<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style="">1209              outStream.close();                                                                                    </span>
<span class="-6689614621021779753" onmouseenter="enter('-6689614621021779753');" onmouseout="out('-6689614621021779753');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1210 +            if (VERBOSE) Log.v(TAG, &quot;wrote &quot; + journalBytes.length + &quot; bytes of journal&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">1211          } catch (IOException e) {                                                                                 </span>
<span class="578587342631886863" onmouseenter="enter('578587342631886863');" onmouseout="out('578587342631886863');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1212 -            Log.d(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>
<span class="8212395174939587559" onmouseenter="enter('8212395174939587559');" onmouseout="out('8212395174939587559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1213 +            Log.w(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1214          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215      }                                                                                                             </span>
<span  style="">1216                                                                                                                    </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style="">1217      /** Wrap a proto in a CheckedMessage and compute the checksum. */                                             </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style="">1218      private byte[] writeCheckedBytes(MessageNano proto) {                                                         </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1219          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style="">1220          wrapper.payload = MessageNano.toByteArray(proto);                                                         </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1221          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1222          checksum.update(wrapper.payload);                                                                         </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style="">1223          wrapper.checksum = checksum.getValue();                                                                   </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style="">1224          return MessageNano.toByteArray(wrapper);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1225      }                                                                                                             </span>
<span  style="">1226                                                                                                                    </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style="">1227      /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                                  </span>
<span class="-3297587107245109372" onmouseenter="enter('-3297587107245109372');" onmouseout="out('-3297587107245109372');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1228 -    private byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize)                                      </span>
<span class="5021637008110274727" onmouseenter="enter('5021637008110274727');" onmouseout="out('5021637008110274727');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1229 +    private static byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize)                               </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style="">1230              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style="">1231          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="-3959921631204962332" onmouseenter="enter('-3959921631204962332');" onmouseout="out('-3959921631204962332');" style="">1232          MessageNano.mergeFrom(wrapper, buffer, offset, dataSize);                                                 </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style="">1233          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style="">1234          checksum.update(wrapper.payload);                                                                         </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style="">1235          if (wrapper.checksum != checksum.getValue()) {                                                            </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style="">1236              throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1237          }                                                                                                         </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style="">1238          return wrapper.payload;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1239      }                                                                                                             </span>
<span  style="">1240                                                                                                                    </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style="">1241      private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                            </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style="">1242          if (mWidgetMap == null) {                                                                                 </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style="">1243              List&lt;AppWidgetProviderInfo&gt; widgets =                                                                 </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="">1244                      AppWidgetManager.getInstance(mContext).getInstalledProviders();                               </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="">1245              mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());                       </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="">1246              for (AppWidgetProviderInfo info : widgets) {                                                          </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="">1247                  mWidgetMap.put(info.provider, info);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1248              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1249          }                                                                                                         </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="">1250          return mWidgetMap.get(component);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1251      }                                                                                                             </span>
<span  style="">1252                                                                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1253 +                                                                                                                  </span>
<span class="-3747865328185427292" onmouseenter="enter('-3747865328185427292');" onmouseout="out('-3747865328185427292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1254 +    private boolean initializeIconCache() {                                                                       </span>
<span class="786459695793008309" onmouseenter="enter('786459695793008309');" onmouseout="out('786459695793008309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1255 +        if (mIconCache != null) {                                                                                 </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1256 +            return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1257 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1258 +                                                                                                                  </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1259 +        final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1260 +        if (appState == null) {                                                                                   </span>
<span class="-1606020641700129220" onmouseenter="enter('-1606020641700129220');" onmouseout="out('-1606020641700129220');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1261 +            Throwable stackTrace = new Throwable();                                                               </span>
<span class="4026238654429205346" onmouseenter="enter('4026238654429205346');" onmouseout="out('4026238654429205346');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1262 +            stackTrace.fillInStackTrace();                                                                        </span>
<span class="3094768706025518149" onmouseenter="enter('3094768706025518149');" onmouseout="out('3094768706025518149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1263 +            Log.w(TAG, &quot;Failed to get app state during backup/restore&quot;, stackTrace);                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1264 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1265 +        }                                                                                                         </span>
<span class="5846627122202929436" onmouseenter="enter('5846627122202929436');" onmouseout="out('5846627122202929436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1266 +        mIconCache = appState.getIconCache();                                                                     </span>
<span class="-110431678061537477" onmouseenter="enter('-110431678061537477');" onmouseout="out('-110431678061537477');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1267 +        return mIconCache != null;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1268 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1269 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1270 +                                                                                                                  </span>
<span class="-342082428602666517" onmouseenter="enter('-342082428602666517');" onmouseout="out('-342082428602666517');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1271 +   // check if the launcher is in a state to support backup                                                       </span>
<span class="-3921026684143455901" onmouseenter="enter('-3921026684143455901');" onmouseout="out('-3921026684143455901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1272 +    private boolean launcherIsReady() {                                                                           </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1273 +        ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="8028245348924782748" onmouseenter="enter('8028245348924782748');" onmouseout="out('8028245348924782748');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1274 +        Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION, null, null, null);                   </span>
<span class="9195402332648821309" onmouseenter="enter('9195402332648821309');" onmouseout="out('9195402332648821309');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1275 +        if (cursor == null) {                                                                                     </span>
<span class="-6084639342042991888" onmouseenter="enter('-6084639342042991888');" onmouseout="out('-6084639342042991888');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1276 +            // launcher data has been wiped, do nothing                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1277 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1278 +        }                                                                                                         </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1279 +        cursor.close();                                                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1280 +                                                                                                                  </span>
<span class="8726608254804971373" onmouseenter="enter('8726608254804971373');" onmouseout="out('8726608254804971373');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1281 +        if (!initializeIconCache()) {                                                                             </span>
<span class="-6326393835865025186" onmouseenter="enter('-6326393835865025186');" onmouseout="out('-6326393835865025186');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1282 +            // launcher services are unavailable, try again later                                                 </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1283 +            dataChanged();                                                                                        </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1284 +            return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1285 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1286 +                                                                                                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1287 +        return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1288 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1289 +                                                                                                                  </span>
<span class="6182962876347425274" onmouseenter="enter('6182962876347425274');" onmouseout="out('6182962876347425274');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1290 +    private String getUserSelectionArg() {                                                                        </span>
<span class="3633686097277461000" onmouseenter="enter('3633686097277461000');" onmouseout="out('3633686097277461000');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1291 +        return Favorites.PROFILE_ID + &#x27;=&#x27; + UserManagerCompat.getInstance(mContext)                               </span>
<span class="3956672966574459179" onmouseenter="enter('3956672966574459179');" onmouseout="out('3956672966574459179');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1292 +                .getSerialNumberForUser(UserHandleCompat.myUserHandle());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1293 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1294 +                                                                                                                  </span>
<span class="9065001176904994716" onmouseenter="enter('9065001176904994716');" onmouseout="out('9065001176904994716');" style="">1295      private class KeyParsingException extends Throwable {                                                         </span>
<span class="6514561846306478812" onmouseenter="enter('6514561846306478812');" onmouseout="out('6514561846306478812');" style="">1296          private KeyParsingException(Throwable cause) {                                                            </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1297              super(cause);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1298          }                                                                                                         </span>
<span  style="">1299                                                                                                                    </span>
<span class="8465822963319034792" onmouseenter="enter('8465822963319034792');" onmouseout="out('8465822963319034792');" style="">1300          public KeyParsingException(String reason) {                                                               </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1301              super(reason);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1302          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1303      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1304  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="4969256359214059167" onmouseenter="enter('4969256359214059167');" onmouseout="out('4969256359214059167');" style="">   2   * Copyright (C) 2013 The Android Open Source Project                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span  style="">  16                                                                                                                    </span>
<span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">  17  package com.android.launcher3;                                                                                    </span>
<span  style="">  18                                                                                                                    </span>
<span class="2553580970615242525" onmouseenter="enter('2553580970615242525');" onmouseout="out('2553580970615242525');" style="">  19  import com.google.protobuf.nano.InvalidProtocolBufferNanoException;                                               </span>
<span class="9016159056427105700" onmouseenter="enter('9016159056427105700');" onmouseout="out('9016159056427105700');" style="">  20  import com.google.protobuf.nano.MessageNano;                                                                      </span>
<span  style="">  21                                                                                                                    </span>
<span class="6281159490246877388" onmouseenter="enter('6281159490246877388');" onmouseout="out('6281159490246877388');" style="">  22  import com.android.launcher3.LauncherSettings.Favorites;                                                          </span>
<span class="2604554111414051906" onmouseenter="enter('2604554111414051906');" onmouseout="out('2604554111414051906');" style="">  23  import com.android.launcher3.LauncherSettings.WorkspaceScreens;                                                   </span>
<span class="2942386635485451486" onmouseenter="enter('2942386635485451486');" onmouseout="out('2942386635485451486');" style="">  24  import com.android.launcher3.backup.BackupProtos;                                                                 </span>
<span class="6732934128798372069" onmouseenter="enter('6732934128798372069');" onmouseout="out('6732934128798372069');" style="">  25  import com.android.launcher3.backup.BackupProtos.CheckedMessage;                                                  </span>
<span class="-470395914476795830" onmouseenter="enter('-470395914476795830');" onmouseout="out('-470395914476795830');" style="">  26  import com.android.launcher3.backup.BackupProtos.Favorite;                                                        </span>
<span class="-4828980057331993555" onmouseenter="enter('-4828980057331993555');" onmouseout="out('-4828980057331993555');" style="">  27  import com.android.launcher3.backup.BackupProtos.Journal;                                                         </span>
<span class="2275439564588877525" onmouseenter="enter('2275439564588877525');" onmouseout="out('2275439564588877525');" style="">  28  import com.android.launcher3.backup.BackupProtos.Key;                                                             </span>
<span class="7652063300114405263" onmouseenter="enter('7652063300114405263');" onmouseout="out('7652063300114405263');" style="">  29  import com.android.launcher3.backup.BackupProtos.Resource;                                                        </span>
<span class="-1667818281446651204" onmouseenter="enter('-1667818281446651204');" onmouseout="out('-1667818281446651204');" style="">  30  import com.android.launcher3.backup.BackupProtos.Screen;                                                          </span>
<span class="-3183978893032457170" onmouseenter="enter('-3183978893032457170');" onmouseout="out('-3183978893032457170');" style="">  31  import com.android.launcher3.backup.BackupProtos.Widget;                                                          </span>


<span  style="">  32                                                                                                                    </span>
<span class="8857279766087459374" onmouseenter="enter('8857279766087459374');" onmouseout="out('8857279766087459374');" style="">  33  import android.app.backup.BackupDataInputStream;                                                                  </span>

<span class="7544079269087913177" onmouseenter="enter('7544079269087913177');" onmouseout="out('7544079269087913177');" style="">  34  import android.app.backup.BackupHelper;                                                                           </span>
<span class="5040189396268993593" onmouseenter="enter('5040189396268993593');" onmouseout="out('5040189396268993593');" style="">  35  import android.app.backup.BackupDataInput;                                                                        </span>
<span class="-7932750791098909281" onmouseenter="enter('-7932750791098909281');" onmouseout="out('-7932750791098909281');" style="">  36  import android.app.backup.BackupDataOutput;                                                                       </span>
<span class="-709080104637427777" onmouseenter="enter('-709080104637427777');" onmouseout="out('-709080104637427777');" style="">  37  import android.app.backup.BackupManager;                                                                          </span>
<span class="8802236814006375919" onmouseenter="enter('8802236814006375919');" onmouseout="out('8802236814006375919');" style="">  38  import android.appwidget.AppWidgetManager;                                                                        </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">  39  import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">  40  import android.content.ComponentName;                                                                             </span>
<span class="6126857652515451632" onmouseenter="enter('6126857652515451632');" onmouseout="out('6126857652515451632');" style="">  41  import android.content.ContentResolver;                                                                           </span>

<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  42  import android.content.Context;                                                                                   </span>
<span class="6568903789857736568" onmouseenter="enter('6568903789857736568');" onmouseout="out('6568903789857736568');" style="">  43  import android.content.Intent;                                                                                    </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  44  import android.database.Cursor;                                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  45  import android.graphics.Bitmap;                                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  46  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  47  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="-5436718358296125427" onmouseenter="enter('-5436718358296125427');" onmouseout="out('-5436718358296125427');" style="">  48  import android.os.ParcelFileDescriptor;                                                                           </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  49  import android.text.TextUtils;                                                                                    </span>
<span class="-2607782279353440751" onmouseenter="enter('-2607782279353440751');" onmouseout="out('-2607782279353440751');" style="">  50  import android.util.Base64;                                                                                       </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  51  import android.util.Log;                                                                                          </span>
<span  style="">  52                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  53  import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-535075201057145249" onmouseenter="enter('-535075201057145249');" onmouseout="out('-535075201057145249');" style="">  54  import java.io.FileInputStream;                                                                                   </span>
<span class="4915709264156936957" onmouseenter="enter('4915709264156936957');" onmouseout="out('4915709264156936957');" style="">  55  import java.io.FileOutputStream;                                                                                  </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  56  import java.io.IOException;                                                                                       </span>
<span class="7911689652558139170" onmouseenter="enter('7911689652558139170');" onmouseout="out('7911689652558139170');" style="">  57  import java.net.URISyntaxException;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  58  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  59  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  60  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  61  import java.util.List;                                                                                            </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  62  import java.util.Set;                                                                                             </span>
<span class="-1652219607605312777" onmouseenter="enter('-1652219607605312777');" onmouseout="out('-1652219607605312777');" style="">  63  import java.util.zip.CRC32;                                                                                       </span>
<span  style="">  64                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65  /**                                                                                                               </span>
<span class="1395282344398365169" onmouseenter="enter('1395282344398365169');" onmouseout="out('1395282344398365169');" style="">  66   * Persist the launcher home state across calamities.                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  67   */                                                                                                               </span>
<span class="-6768872970855017521" onmouseenter="enter('-6768872970855017521');" onmouseout="out('-6768872970855017521');" style="">  68  public class LauncherBackupHelper implements BackupHelper {                                                       </span>
<span  style="">  69                                                                                                                    </span>
<span class="4489328289386464593" onmouseenter="enter('4489328289386464593');" onmouseout="out('4489328289386464593');" style="">  70      private static final String TAG = &quot;LauncherBackupHelper&quot;;                                                     </span>
<span class="-423333459707984477" onmouseenter="enter('-423333459707984477');" onmouseout="out('-423333459707984477');" style="">  71      private static final boolean DEBUG = false;                                                                   </span>


<span class="8681536538150810745" onmouseenter="enter('8681536538150810745');" onmouseout="out('8681536538150810745');" style="">  72      private static final boolean DEBUG_PAYLOAD = false;                                                           </span>
<span  style="">  73                                                                                                                    </span>
<span class="1161857868437564555" onmouseenter="enter('1161857868437564555');" onmouseout="out('1161857868437564555');" style="">  74      private static final int MAX_JOURNAL_SIZE = 1000000;                                                          </span>
<span  style="">  75                                                                                                                    </span>
<span class="4712019298517837223" onmouseenter="enter('4712019298517837223');" onmouseout="out('4712019298517837223');" style="">  76      /** icons are large, dribble them out */                                                                      </span>
<span class="-779115681544952916" onmouseenter="enter('-779115681544952916');" onmouseout="out('-779115681544952916');" style="">  77      private static final int MAX_ICONS_PER_PASS = 10;                                                             </span>
<span  style="">  78                                                                                                                    </span>
<span class="-7045601518513606280" onmouseenter="enter('-7045601518513606280');" onmouseout="out('-7045601518513606280');" style="">  79      /** widgets contain previews, which are very large, dribble them out */                                       </span>
<span class="-2548414910089919426" onmouseenter="enter('-2548414910089919426');" onmouseout="out('-2548414910089919426');" style="">  80      private static final int MAX_WIDGETS_PER_PASS = 5;                                                            </span>
<span  style="">  81                                                                                                                    </span>
<span class="-9115528851843838744" onmouseenter="enter('-9115528851843838744');" onmouseout="out('-9115528851843838744');" style="">  82      public static final int IMAGE_COMPRESSION_QUALITY = 75;                                                       </span>
<span  style="">  83                                                                                                                    </span>
<span class="-3087488215496878471" onmouseenter="enter('-3087488215496878471');" onmouseout="out('-3087488215496878471');" style="">  84      public static final String LAUNCHER_PREFIX = &quot;L&quot;;                                                             </span>


<span  style="">  85                                                                                                                    </span>
<span class="-4364432584197837483" onmouseenter="enter('-4364432584197837483');" onmouseout="out('-4364432584197837483');" style="">  86      private static final Bitmap.CompressFormat IMAGE_FORMAT =                                                     </span>
<span class="5099577487618485009" onmouseenter="enter('5099577487618485009');" onmouseout="out('5099577487618485009');" style="">  87              android.graphics.Bitmap.CompressFormat.PNG;                                                           </span>
<span  style="">  88                                                                                                                    </span>
<span class="-6320109508039674215" onmouseenter="enter('-6320109508039674215');" onmouseout="out('-6320109508039674215');" style="">  89      private static BackupManager sBackupManager;                                                                  </span>
<span  style="">  90                                                                                                                    </span>
<span class="5008988108498238583" onmouseenter="enter('5008988108498238583');" onmouseout="out('5008988108498238583');" style="">  91      private static final String[] FAVORITE_PROJECTION = {                                                         </span>
<span class="4134824840800420124" onmouseenter="enter('4134824840800420124');" onmouseout="out('4134824840800420124');" style="">  92              Favorites._ID,                     // 0                                                               </span>
<span class="-1205778905450990718" onmouseenter="enter('-1205778905450990718');" onmouseout="out('-1205778905450990718');" style="">  93              Favorites.MODIFIED,                // 1                                                               </span>
<span class="1569486687918224576" onmouseenter="enter('1569486687918224576');" onmouseout="out('1569486687918224576');" style="">  94              Favorites.INTENT,                  // 2                                                               </span>
<span class="-977017778240261949" onmouseenter="enter('-977017778240261949');" onmouseout="out('-977017778240261949');" style="">  95              Favorites.APPWIDGET_PROVIDER,      // 3                                                               </span>
<span class="6084679647204283773" onmouseenter="enter('6084679647204283773');" onmouseout="out('6084679647204283773');" style="">  96              Favorites.APPWIDGET_ID,            // 4                                                               </span>
<span class="1241517900891567439" onmouseenter="enter('1241517900891567439');" onmouseout="out('1241517900891567439');" style="">  97              Favorites.CELLX,                   // 5                                                               </span>
<span class="5871334076566705303" onmouseenter="enter('5871334076566705303');" onmouseout="out('5871334076566705303');" style="">  98              Favorites.CELLY,                   // 6                                                               </span>
<span class="3414932834400080811" onmouseenter="enter('3414932834400080811');" onmouseout="out('3414932834400080811');" style="">  99              Favorites.CONTAINER,               // 7                                                               </span>
<span class="-4290296282740739560" onmouseenter="enter('-4290296282740739560');" onmouseout="out('-4290296282740739560');" style=""> 100              Favorites.ICON,                    // 8                                                               </span>
<span class="5030023493390410577" onmouseenter="enter('5030023493390410577');" onmouseout="out('5030023493390410577');" style=""> 101              Favorites.ICON_PACKAGE,            // 9                                                               </span>
<span class="2842325617890583883" onmouseenter="enter('2842325617890583883');" onmouseout="out('2842325617890583883');" style=""> 102              Favorites.ICON_RESOURCE,           // 10                                                              </span>
<span class="4134184993188476" onmouseenter="enter('4134184993188476');" onmouseout="out('4134184993188476');" style=""> 103              Favorites.ICON_TYPE,               // 11                                                              </span>
<span class="-3793110027828795152" onmouseenter="enter('-3793110027828795152');" onmouseout="out('-3793110027828795152');" style=""> 104              Favorites.ITEM_TYPE,               // 12                                                              </span>
<span class="2631108127809650422" onmouseenter="enter('2631108127809650422');" onmouseout="out('2631108127809650422');" style=""> 105              Favorites.SCREEN,                  // 13                                                              </span>
<span class="-5819797928581181226" onmouseenter="enter('-5819797928581181226');" onmouseout="out('-5819797928581181226');" style=""> 106              Favorites.SPANX,                   // 14                                                              </span>
<span class="5403841959402436676" onmouseenter="enter('5403841959402436676');" onmouseout="out('5403841959402436676');" style=""> 107              Favorites.SPANY,                   // 15                                                              </span>
<span class="7031912707649541749" onmouseenter="enter('7031912707649541749');" onmouseout="out('7031912707649541749');" style=""> 108              Favorites.TITLE,                   // 16                                                              </span>

<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 109      };                                                                                                            </span>
<span  style=""> 110                                                                                                                    </span>
<span class="7112766258656465094" onmouseenter="enter('7112766258656465094');" onmouseout="out('7112766258656465094');" style=""> 111      private static final int ID_INDEX = 0;                                                                        </span>
<span class="-151634183950320006" onmouseenter="enter('-151634183950320006');" onmouseout="out('-151634183950320006');" style=""> 112      private static final int ID_MODIFIED = 1;                                                                     </span>
<span class="4413707923046453455" onmouseenter="enter('4413707923046453455');" onmouseout="out('4413707923046453455');" style=""> 113      private static final int INTENT_INDEX = 2;                                                                    </span>
<span class="-4788809974407216747" onmouseenter="enter('-4788809974407216747');" onmouseout="out('-4788809974407216747');" style=""> 114      private static final int APPWIDGET_PROVIDER_INDEX = 3;                                                        </span>
<span class="-331790961892024758" onmouseenter="enter('-331790961892024758');" onmouseout="out('-331790961892024758');" style=""> 115      private static final int APPWIDGET_ID_INDEX = 4;                                                              </span>
<span class="6095390086784989815" onmouseenter="enter('6095390086784989815');" onmouseout="out('6095390086784989815');" style=""> 116      private static final int CELLX_INDEX = 5;                                                                     </span>
<span class="7393117540207988094" onmouseenter="enter('7393117540207988094');" onmouseout="out('7393117540207988094');" style=""> 117      private static final int CELLY_INDEX = 6;                                                                     </span>
<span class="8748120236288734551" onmouseenter="enter('8748120236288734551');" onmouseout="out('8748120236288734551');" style=""> 118      private static final int CONTAINER_INDEX = 7;                                                                 </span>
<span class="7316008240004069686" onmouseenter="enter('7316008240004069686');" onmouseout="out('7316008240004069686');" style=""> 119      private static final int ICON_INDEX = 8;                                                                      </span>
<span class="-8860474748601817185" onmouseenter="enter('-8860474748601817185');" onmouseout="out('-8860474748601817185');" style=""> 120      private static final int ICON_PACKAGE_INDEX = 9;                                                              </span>
<span class="3713314466407058962" onmouseenter="enter('3713314466407058962');" onmouseout="out('3713314466407058962');" style=""> 121      private static final int ICON_RESOURCE_INDEX = 10;                                                            </span>
<span class="-5916322258887035397" onmouseenter="enter('-5916322258887035397');" onmouseout="out('-5916322258887035397');" style=""> 122      private static final int ICON_TYPE_INDEX = 11;                                                                </span>
<span class="-8536142204522319207" onmouseenter="enter('-8536142204522319207');" onmouseout="out('-8536142204522319207');" style=""> 123      private static final int ITEM_TYPE_INDEX = 12;                                                                </span>
<span class="6984666790529713720" onmouseenter="enter('6984666790529713720');" onmouseout="out('6984666790529713720');" style=""> 124      private static final int SCREEN_INDEX = 13;                                                                   </span>
<span class="-7512701537156409533" onmouseenter="enter('-7512701537156409533');" onmouseout="out('-7512701537156409533');" style=""> 125      private static final int SPANX_INDEX = 14;                                                                    </span>
<span class="-7955588880713977237" onmouseenter="enter('-7955588880713977237');" onmouseout="out('-7955588880713977237');" style=""> 126      private static final int SPANY_INDEX = 15;                                                                    </span>
<span class="6482889960046821049" onmouseenter="enter('6482889960046821049');" onmouseout="out('6482889960046821049');" style=""> 127      private static final int TITLE_INDEX = 16;                                                                    </span>

<span  style=""> 128                                                                                                                    </span>
<span class="-1959518376194228215" onmouseenter="enter('-1959518376194228215');" onmouseout="out('-1959518376194228215');" style=""> 129      private static final String[] SCREEN_PROJECTION = {                                                           </span>
<span class="2081168444189344388" onmouseenter="enter('2081168444189344388');" onmouseout="out('2081168444189344388');" style=""> 130              WorkspaceScreens._ID,              // 0                                                               </span>
<span class="8836389693028923378" onmouseenter="enter('8836389693028923378');" onmouseout="out('8836389693028923378');" style=""> 131              WorkspaceScreens.MODIFIED,         // 1                                                               </span>
<span class="8959891003776894035" onmouseenter="enter('8959891003776894035');" onmouseout="out('8959891003776894035');" style=""> 132              WorkspaceScreens.SCREEN_RANK       // 2                                                               </span>
<span class="2468309323999483380" onmouseenter="enter('2468309323999483380');" onmouseout="out('2468309323999483380');" style=""> 133      };                                                                                                            </span>
<span  style=""> 134                                                                                                                    </span>
<span class="-2568422109854869469" onmouseenter="enter('-2568422109854869469');" onmouseout="out('-2568422109854869469');" style=""> 135      private static final int SCREEN_RANK_INDEX = 2;                                                               </span>
<span  style=""> 136                                                                                                                    </span>


<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 137      private final Context mContext;                                                                               </span>
<span  style=""> 138                                                                                                                    </span>


<span class="-1462808052933612154" onmouseenter="enter('-1462808052933612154');" onmouseout="out('-1462808052933612154');" style=""> 139      private HashMap&lt;ComponentName, AppWidgetProviderInfo&gt; mWidgetMap;                                             </span>
<span  style=""> 140                                                                                                                    </span>
<span class="2729926087087724486" onmouseenter="enter('2729926087087724486');" onmouseout="out('2729926087087724486');" style=""> 141      private ArrayList&lt;Key&gt; mKeys;                                                                                 </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-8450163871224689268" onmouseenter="enter('-8450163871224689268');" onmouseout="out('-8450163871224689268');" style=""> 143      public LauncherBackupHelper(Context context) {                                                                </span>



<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 144          mContext = context;                                                                                       </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145      }                                                                                                             </span>
<span  style=""> 146                                                                                                                    </span>
<span class="4041484292609647560" onmouseenter="enter('4041484292609647560');" onmouseout="out('4041484292609647560');" style=""> 147      private void dataChanged() {                                                                                  </span>
<span class="-6280593186860143288" onmouseenter="enter('-6280593186860143288');" onmouseout="out('-6280593186860143288');" style=""> 148          if (sBackupManager == null) {                                                                             </span>
<span class="-1682111607995772618" onmouseenter="enter('-1682111607995772618');" onmouseout="out('-1682111607995772618');" style=""> 149              sBackupManager = new BackupManager(mContext);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150          }                                                                                                         </span>
<span class="-8519501381186315635" onmouseenter="enter('-8519501381186315635');" onmouseout="out('-8519501381186315635');" style=""> 151          sBackupManager.dataChanged();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152      }                                                                                                             </span>
<span  style=""> 153                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 154      /**                                                                                                           </span>
<span class="4007750081972218883" onmouseenter="enter('4007750081972218883');" onmouseout="out('4007750081972218883');" style=""> 155       * Back up launcher data so we can restore the user&#x27;s state on a new device.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 156       *                                                                                                            </span>
<span class="-4629442993201541587" onmouseenter="enter('-4629442993201541587');" onmouseout="out('-4629442993201541587');" style=""> 157       * &lt;P&gt;The journal is a timestamp and a list of keys that were saved as of that time.                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 158       *                                                                                                            </span>
<span class="6579578117957779074" onmouseenter="enter('6579578117957779074');" onmouseout="out('6579578117957779074');" style=""> 159       * &lt;P&gt;Keys may come back in any order, so each key/value is one complete row of the database.                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 160       *                                                                                                            </span>
<span class="4778169502414636404" onmouseenter="enter('4778169502414636404');" onmouseout="out('4778169502414636404');" style=""> 161       * @param oldState notes from the last backup                                                                 </span>
<span class="2110943546779915020" onmouseenter="enter('2110943546779915020');" onmouseout="out('2110943546779915020');" style=""> 162       * @param data incremental key/value pairs to persist off-device                                              </span>
<span class="1468223601237178589" onmouseenter="enter('1468223601237178589');" onmouseout="out('1468223601237178589');" style=""> 163       * @param newState notes for the next backup                                                                  </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 164       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 165       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166      @Override                                                                                                     </span>
<span class="94151059472079616" onmouseenter="enter('94151059472079616');" onmouseout="out('94151059472079616');" style=""> 167      public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,                               </span>
<span class="-7046338878138625575" onmouseenter="enter('-7046338878138625575');" onmouseout="out('-7046338878138625575');" style=""> 168              ParcelFileDescriptor newState) {                                                                      </span>
<span class="-5617118756948088857" onmouseenter="enter('-5617118756948088857');" onmouseout="out('-5617118756948088857');" style=""> 169          Log.v(TAG, &quot;onBackup&quot;);                                                                                   </span>

<span  style=""> 170                                                                                                                    </span>
<span class="1956650257168334315" onmouseenter="enter('1956650257168334315');" onmouseout="out('1956650257168334315');" style=""> 171          Journal in = readJournal(oldState);                                                                       </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 172          Journal out = new Journal();                                                                              </span>
<span  style=""> 173                                                                                                                    </span>
<span class="-3253084867092672816" onmouseenter="enter('-3253084867092672816');" onmouseout="out('-3253084867092672816');" style=""> 174          long lastBackupTime = in.t;                                                                               </span>
<span class="8932370774979500270" onmouseenter="enter('8932370774979500270');" onmouseout="out('8932370774979500270');" style=""> 175          out.t = System.currentTimeMillis();                                                                       </span>
<span class="-1600347970264493336" onmouseenter="enter('-1600347970264493336');" onmouseout="out('-1600347970264493336');" style=""> 176          out.rows = 0;                                                                                             </span>
<span class="2725575623770373107" onmouseenter="enter('2725575623770373107');" onmouseout="out('2725575623770373107');" style=""> 177          out.bytes = 0;                                                                                            </span>
<span  style=""> 178                                                                                                                    </span>
<span class="1052445760685633825" onmouseenter="enter('1052445760685633825');" onmouseout="out('1052445760685633825');" style=""> 179          Log.v(TAG, &quot;lastBackupTime=&quot; + lastBackupTime);                                                           </span>

<span  style=""> 180                                                                                                                    </span>
<span class="4700072589631005259" onmouseenter="enter('4700072589631005259');" onmouseout="out('4700072589631005259');" style=""> 181          ArrayList&lt;Key&gt; keys = new ArrayList&lt;Key&gt;();                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 182          try {                                                                                                     </span>
<span class="-4981606321761591773" onmouseenter="enter('-4981606321761591773');" onmouseout="out('-4981606321761591773');" style=""> 183              backupFavorites(in, data, out, keys);                                                                 </span>
<span class="-4717117978324292655" onmouseenter="enter('-4717117978324292655');" onmouseout="out('-4717117978324292655');" style=""> 184              backupScreens(in, data, out, keys);                                                                   </span>
<span class="1899397613694889272" onmouseenter="enter('1899397613694889272');" onmouseout="out('1899397613694889272');" style=""> 185              backupIcons(in, data, out, keys);                                                                     </span>
<span class="1425353643943690990" onmouseenter="enter('1425353643943690990');" onmouseout="out('1425353643943690990');" style=""> 186              backupWidgets(in, data, out, keys);                                                                   </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 187          } catch (IOException e) {                                                                                 </span>
<span class="-301849362123503566" onmouseenter="enter('-301849362123503566');" onmouseout="out('-301849362123503566');" style=""> 188              Log.e(TAG, &quot;launcher backup has failed&quot;, e);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189          }                                                                                                         </span>
<span  style=""> 190                                                                                                                    </span>
<span class="-6592699891127791070" onmouseenter="enter('-6592699891127791070');" onmouseout="out('-6592699891127791070');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -        out.key = keys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                                     </span>
<span class="-2322857033322689801" onmouseenter="enter('-2322857033322689801');" onmouseout="out('-2322857033322689801');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +        out.key = keys.toArray(BackupProtos.Key.emptyArray());                                                    </span>













<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 193          writeJournal(newState, out);                                                                              </span>
<span class="9173942242660687541" onmouseenter="enter('9173942242660687541');" onmouseout="out('9173942242660687541');" style=""> 194          Log.v(TAG, &quot;onBackup: wrote &quot; + out.bytes + &quot;b in &quot; + out.rows + &quot; rows.&quot;);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195      }                                                                                                             </span>
<span  style=""> 196                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197      /**                                                                                                           </span>
<span class="6553049345615788331" onmouseenter="enter('6553049345615788331');" onmouseout="out('6553049345615788331');" style=""> 198       * Restore launcher configuration from the restored data stream.                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 199       *                                                                                                            </span>
<span class="9214738515131468383" onmouseenter="enter('9214738515131468383');" onmouseout="out('9214738515131468383');" style=""> 200       * &lt;P&gt;Keys may arrive in any order.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 201       *                                                                                                            </span>
<span class="7050636553560411000" onmouseenter="enter('7050636553560411000');" onmouseout="out('7050636553560411000');" style=""> 202       * @param data the key/value pair from the server                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 203       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 204      @Override                                                                                                     </span>
<span class="-5495101838183610989" onmouseenter="enter('-5495101838183610989');" onmouseout="out('-5495101838183610989');" style=""> 205      public void restoreEntity(BackupDataInputStream data) {                                                       </span>
<span class="273471296519358434" onmouseenter="enter('273471296519358434');" onmouseout="out('273471296519358434');" style=""> 206          Log.v(TAG, &quot;restoreEntity&quot;);                                                                              </span>
<span class="5593645157390984354" onmouseenter="enter('5593645157390984354');" onmouseout="out('5593645157390984354');" style=""> 207          if (mKeys == null) {                                                                                      </span>
<span class="7024230567193516388" onmouseenter="enter('7024230567193516388');" onmouseout="out('7024230567193516388');" style=""> 208              mKeys = new ArrayList&lt;Key&gt;();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>

<span class="-3135534305680812023" onmouseenter="enter('-3135534305680812023');" onmouseout="out('-3135534305680812023');" style=""> 210          byte[] buffer = new byte[512];                                                                            </span>
<span class="8198258575060341941" onmouseenter="enter('8198258575060341941');" onmouseout="out('8198258575060341941');" style=""> 211              String backupKey = data.getKey();                                                                     </span>
<span class="4134034884263311046" onmouseenter="enter('4134034884263311046');" onmouseout="out('4134034884263311046');" style=""> 212              int dataSize = data.size();                                                                           </span>
<span class="2382724363113702568" onmouseenter="enter('2382724363113702568');" onmouseout="out('2382724363113702568');" style=""> 213              if (buffer.length &lt; dataSize) {                                                                       </span>
<span class="8352923365759736689" onmouseenter="enter('8352923365759736689');" onmouseout="out('8352923365759736689');" style=""> 214                  buffer = new byte[dataSize];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215              }                                                                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 216              Key key = null;                                                                                       </span>
<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 217          int bytesRead = 0;                                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 218          try {                                                                                                     </span>
<span class="-6009766373469064808" onmouseenter="enter('-6009766373469064808');" onmouseout="out('-6009766373469064808');" style=""> 219              bytesRead = data.read(buffer, 0, dataSize);                                                           </span>
<span class="4319115303782376258" onmouseenter="enter('4319115303782376258');" onmouseout="out('4319115303782376258');" style=""> 220              if (DEBUG) Log.d(TAG, &quot;read &quot; + bytesRead + &quot; of &quot; + dataSize + &quot; available&quot;);                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 221          } catch (IOException e) {                                                                                 </span>
<span class="-8762864952874435126" onmouseenter="enter('-8762864952874435126');" onmouseout="out('-8762864952874435126');" style=""> 222              Log.d(TAG, &quot;failed to read entity from restore data&quot;, e);                                             </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224          try {                                                                                                     </span>
<span class="-3712536663698109807" onmouseenter="enter('-3712536663698109807');" onmouseout="out('-3712536663698109807');" style=""> 225              key = backupKeyToKey(backupKey);                                                                      </span>

<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 226              switch (key.type) {                                                                                   </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 227                  case Key.FAVORITE:                                                                                </span>
<span class="-8176296956220002371" onmouseenter="enter('-8176296956220002371');" onmouseout="out('-8176296956220002371');" style=""> 228                      restoreFavorite(key, buffer, dataSize, mKeys);                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 229                      break;                                                                                        </span>
<span  style=""> 230                                                                                                                    </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 231                  case Key.SCREEN:                                                                                  </span>
<span class="-2747327735226535589" onmouseenter="enter('-2747327735226535589');" onmouseout="out('-2747327735226535589');" style=""> 232                      restoreScreen(key, buffer, dataSize, mKeys);                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 233                      break;                                                                                        </span>
<span  style=""> 234                                                                                                                    </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 235                  case Key.ICON:                                                                                    </span>
<span class="-5346432636907736484" onmouseenter="enter('-5346432636907736484');" onmouseout="out('-5346432636907736484');" style=""> 236                      restoreIcon(key, buffer, dataSize, mKeys);                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 237                      break;                                                                                        </span>
<span  style=""> 238                                                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 239                  case Key.WIDGET:                                                                                  </span>
<span class="-7791331080833002730" onmouseenter="enter('-7791331080833002730');" onmouseout="out('-7791331080833002730');" style=""> 240                      restoreWidget(key, buffer, dataSize, mKeys);                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 241                      break;                                                                                        </span>
<span  style=""> 242                                                                                                                    </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 243                  default:                                                                                          </span>
<span class="-3706787405276569699" onmouseenter="enter('-3706787405276569699');" onmouseout="out('-3706787405276569699');" style=""> 244                      Log.w(TAG, &quot;unknown restore entity type: &quot; + key.type);                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 245                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246              }                                                                                                     </span>
<span class="2253361419748107399" onmouseenter="enter('2253361419748107399');" onmouseout="out('2253361419748107399');" style=""> 247          } catch (KeyParsingException e) {                                                                         </span>
<span class="-562496230350101976" onmouseenter="enter('-562496230350101976');" onmouseout="out('-562496230350101976');" style=""> 248              Log.w(TAG, &quot;ignoring unparsable backup key: &quot; + backupKey);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249          }                                                                                                         </span>
<span  style=""> 250                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251      }                                                                                                             </span>
<span  style=""> 252                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 253      /**                                                                                                           </span>
<span class="6031558035642427604" onmouseenter="enter('6031558035642427604');" onmouseout="out('6031558035642427604');" style=""> 254       * Record the restore state for the next backup.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 255       *                                                                                                            </span>
<span class="-1431728798768770214" onmouseenter="enter('-1431728798768770214');" onmouseout="out('-1431728798768770214');" style=""> 256       * @param newState notes about the backup state after restore.                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 257       */                                                                                                           </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 258      @Override                                                                                                     </span>
<span class="-1059536714068585208" onmouseenter="enter('-1059536714068585208');" onmouseout="out('-1059536714068585208');" style=""> 259      public void writeNewStateDescription(ParcelFileDescriptor newState) {                                         </span>
<span class="5549282736252467518" onmouseenter="enter('5549282736252467518');" onmouseout="out('5549282736252467518');" style=""> 260          // clear the output journal time, to force a full backup to                                               </span>
<span class="-6530879399114095302" onmouseenter="enter('-6530879399114095302');" onmouseout="out('-6530879399114095302');" style=""> 261          // will catch any changes the restore process might have made                                             </span>
<span class="1398308908303096739" onmouseenter="enter('1398308908303096739');" onmouseout="out('1398308908303096739');" style=""> 262          Journal out = new Journal();                                                                              </span>
<span class="2257882001369213967" onmouseenter="enter('2257882001369213967');" onmouseout="out('2257882001369213967');" style=""> 263          out.t = 0;                                                                                                </span>
<span class="4763841258929064204" onmouseenter="enter('4763841258929064204');" onmouseout="out('4763841258929064204');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -        out.key = mKeys.toArray(BackupProtos.Key.EMPTY_ARRAY);                                                    </span>
<span class="-4698345167913557184" onmouseenter="enter('-4698345167913557184');" onmouseout="out('-4698345167913557184');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +        out.key = mKeys.toArray(BackupProtos.Key.emptyArray());                                                   </span>
<span class="2981836101446850230" onmouseenter="enter('2981836101446850230');" onmouseout="out('2981836101446850230');" style=""> 266          writeJournal(newState, out);                                                                              </span>
<span class="1918123416380614996" onmouseenter="enter('1918123416380614996');" onmouseout="out('1918123416380614996');" style=""> 267          Log.v(TAG, &quot;onRestore: read &quot; + mKeys.size() + &quot; rows&quot;);                                                  </span>
<span class="-2533941602160621404" onmouseenter="enter('-2533941602160621404');" onmouseout="out('-2533941602160621404');" style=""> 268          mKeys.clear();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269      }                                                                                                             </span>
<span  style=""> 270                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 271      /**                                                                                                           </span>
<span class="5558380409961124766" onmouseenter="enter('5558380409961124766');" onmouseout="out('5558380409961124766');" style=""> 272       * Write all modified favorites to the data stream.                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 273       *                                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 274       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 275       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 276       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 277       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 278       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 279       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 280       */                                                                                                           </span>
<span class="7131268859945314485" onmouseenter="enter('7131268859945314485');" onmouseout="out('7131268859945314485');" style=""> 281      private void backupFavorites(Journal in, BackupDataOutput data, Journal out,                                  </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 282              ArrayList&lt;Key&gt; keys)                                                                                  </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 283              throws IOException {                                                                                  </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 284          // read the old ID set                                                                                    </span>
<span class="1222708127935075798" onmouseenter="enter('1222708127935075798');" onmouseout="out('1222708127935075798');" style=""> 285          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.FAVORITE, in);                                               </span>
<span class="-6977244754148926833" onmouseenter="enter('-6977244754148926833');" onmouseout="out('-6977244754148926833');" style=""> 286          if (DEBUG) Log.d(TAG, &quot;favorite savedIds.size()=&quot; + savedIds.size());                                     </span>
<span  style=""> 287                                                                                                                    </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 288          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 289          ContentResolver cr = mContext.getContentResolver();                                                       </span>

<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 290          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 291                  null, null, null);                                                                                </span>

<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 292          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 293          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 294              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 295              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 296                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 297                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="2378943574431007150" onmouseenter="enter('2378943574431007150');" onmouseout="out('2378943574431007150');" style=""> 298                  Key key = getKey(Key.FAVORITE, id);                                                               </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 299                  keys.add(key);                                                                                    </span>
<span class="-1456188938196663667" onmouseenter="enter('-1456188938196663667');" onmouseout="out('-1456188938196663667');" style=""> 300                  currentIds.add(keyToBackupKey(key));                                                              </span>
<span class="6808253458123068684" onmouseenter="enter('6808253458123068684');" onmouseout="out('6808253458123068684');" style=""> 301                  if (updateTime &gt; in.t) {                                                                          </span>



<span class="7001118594211601319" onmouseenter="enter('7001118594211601319');" onmouseout="out('7001118594211601319');" style=""> 302                      byte[] blob = packFavorite(cursor);                                                           </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 303                      writeRowToBackup(key, blob, out, data);                                                       </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 306          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 307              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="1671673783823377819" onmouseenter="enter('1671673783823377819');" onmouseout="out('1671673783823377819');" style=""> 309          if (DEBUG) Log.d(TAG, &quot;favorite currentIds.size()=&quot; + currentIds.size());                                 </span>
<span  style=""> 310                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 311          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 312          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 313          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314      }                                                                                                             </span>
<span  style=""> 315                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 316      /**                                                                                                           </span>
<span class="2555296685726222002" onmouseenter="enter('2555296685726222002');" onmouseout="out('2555296685726222002');" style=""> 317       * Read a favorite from the stream.                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 318       *                                                                                                            </span>
<span class="-7150320210880442303" onmouseenter="enter('-7150320210880442303');" onmouseout="out('-7150320210880442303');" style=""> 319       * &lt;P&gt;Keys arrive in any order, so screens and containers may not exist yet.                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 320       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 321       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 322       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 323       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 324       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 325       */                                                                                                           </span>
<span class="-1219322022397821860" onmouseenter="enter('-1219322022397821860');" onmouseout="out('-1219322022397821860');" style=""> 326      private void restoreFavorite(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                     </span>
<span class="1710737497733264210" onmouseenter="enter('1710737497733264210');" onmouseout="out('1710737497733264210');" style=""> 327          Log.v(TAG, &quot;unpacking favorite &quot; + key.id + &quot; (&quot; + dataSize + &quot; bytes)&quot;);                                 </span>

<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 328          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 329                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span  style=""> 330                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 331          try {                                                                                                     </span>
<span class="-444181517361003992" onmouseenter="enter('-444181517361003992');" onmouseout="out('-444181517361003992');" style=""> 332              Favorite favorite =  unpackFavorite(buffer, 0, dataSize);                                             </span>
<span class="8353775591472986192" onmouseenter="enter('8353775591472986192');" onmouseout="out('8353775591472986192');" style=""> 333              if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + favorite.itemType);                                               </span>









<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 334          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style=""> 335              Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337      }                                                                                                             </span>
<span  style=""> 338                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 339      /**                                                                                                           </span>
<span class="5812597988304417126" onmouseenter="enter('5812597988304417126');" onmouseout="out('5812597988304417126');" style=""> 340       * Write all modified screens to the data stream.                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 341       *                                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 342       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 343       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 344       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 345       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 346       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 347       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 348       */                                                                                                           </span>
<span class="1451925655210067336" onmouseenter="enter('1451925655210067336');" onmouseout="out('1451925655210067336');" style=""> 349      private void backupScreens(Journal in, BackupDataOutput data, Journal out,                                    </span>
<span class="-7856406666337102113" onmouseenter="enter('-7856406666337102113');" onmouseout="out('-7856406666337102113');" style=""> 350              ArrayList&lt;Key&gt; keys)                                                                                  </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 351              throws IOException {                                                                                  </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 352          // read the old ID set                                                                                    </span>
<span class="-5113344219820420639" onmouseenter="enter('-5113344219820420639');" onmouseout="out('-5113344219820420639');" style=""> 353          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.SCREEN, in);                                                 </span>
<span class="2041232408079356493" onmouseenter="enter('2041232408079356493');" onmouseout="out('2041232408079356493');" style=""> 354          if (DEBUG) Log.d(TAG, &quot;screen savedIds.size()=&quot; + savedIds.size());                                       </span>
<span  style=""> 355                                                                                                                    </span>
<span class="-9079358124010006295" onmouseenter="enter('-9079358124010006295');" onmouseout="out('-9079358124010006295');" style=""> 356          // persist things that have changed since the last backup                                                 </span>
<span class="-1515433452198747868" onmouseenter="enter('-1515433452198747868');" onmouseout="out('-1515433452198747868');" style=""> 357          ContentResolver cr = mContext.getContentResolver();                                                       </span>
<span class="7072215736036879875" onmouseenter="enter('7072215736036879875');" onmouseout="out('7072215736036879875');" style=""> 358          Cursor cursor = cr.query(WorkspaceScreens.CONTENT_URI, SCREEN_PROJECTION,                                 </span>
<span class="1813857635974235262" onmouseenter="enter('1813857635974235262');" onmouseout="out('1813857635974235262');" style=""> 359                  null, null, null);                                                                                </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 360          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 361          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 362              cursor.moveToPosition(-1);                                                                            </span>

<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 363              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 364                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7883218842558287785" onmouseenter="enter('7883218842558287785');" onmouseout="out('7883218842558287785');" style=""> 365                  final long updateTime = cursor.getLong(ID_MODIFIED);                                              </span>
<span class="-2540325315233272973" onmouseenter="enter('-2540325315233272973');" onmouseout="out('-2540325315233272973');" style=""> 366                  Key key = getKey(Key.SCREEN, id);                                                                 </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 367                  keys.add(key);                                                                                    </span>
<span class="-1456188938196663667" onmouseenter="enter('-1456188938196663667');" onmouseout="out('-1456188938196663667');" style=""> 368                  currentIds.add(keyToBackupKey(key));                                                              </span>
<span class="6808253458123068684" onmouseenter="enter('6808253458123068684');" onmouseout="out('6808253458123068684');" style=""> 369                  if (updateTime &gt; in.t) {                                                                          </span>



<span class="30579954798815384" onmouseenter="enter('30579954798815384');" onmouseout="out('30579954798815384');" style=""> 370                      byte[] blob = packScreen(cursor);                                                             </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 371                      writeRowToBackup(key, blob, out, data);                                                       </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 374          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 375              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376          }                                                                                                         </span>
<span class="5642954527140901409" onmouseenter="enter('5642954527140901409');" onmouseout="out('5642954527140901409');" style=""> 377          if (DEBUG) Log.d(TAG, &quot;screen currentIds.size()=&quot; + currentIds.size());                                   </span>
<span  style=""> 378                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 379          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 380          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 381          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382      }                                                                                                             </span>
<span  style=""> 383                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 384      /**                                                                                                           </span>
<span class="-8584787694969062218" onmouseenter="enter('-8584787694969062218');" onmouseout="out('-8584787694969062218');" style=""> 385       * Read a screen from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 386       *                                                                                                            </span>
<span class="-1204412081059209020" onmouseenter="enter('-1204412081059209020');" onmouseout="out('-1204412081059209020');" style=""> 387       * &lt;P&gt;Keys arrive in any order, so children of this screen may already exist.                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 388       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 389       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 390       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 391       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 392       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 393       */                                                                                                           </span>
<span class="-7250675390519322058" onmouseenter="enter('-7250675390519322058');" onmouseout="out('-7250675390519322058');" style=""> 394      private void restoreScreen(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                       </span>
<span class="-7359569920478585703" onmouseenter="enter('-7359569920478585703');" onmouseout="out('-7359569920478585703');" style=""> 395          Log.v(TAG, &quot;unpacking screen &quot; + key.id);                                                                 </span>

<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 396          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 397                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398          try {                                                                                                     </span>
<span class="5251244504663034495" onmouseenter="enter('5251244504663034495');" onmouseout="out('5251244504663034495');" style=""> 399              Screen screen = unpackScreen(buffer, 0, dataSize);                                                    </span>
<span class="5267833213520539167" onmouseenter="enter('5267833213520539167');" onmouseout="out('5267833213520539167');" style=""> 400              if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + screen.rank);                                                     </span>











<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 401          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style=""> 402              Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404      }                                                                                                             </span>
<span  style=""> 405                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 406      /**                                                                                                           </span>
<span class="5470162797378250208" onmouseenter="enter('5470162797378250208');" onmouseout="out('5470162797378250208');" style=""> 407       * Write all the static icon resources we need to render placeholders                                         </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 408       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 409       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 410       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 411       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 412       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 413       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 414       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 415       */                                                                                                           </span>
<span class="599391339335107838" onmouseenter="enter('599391339335107838');" onmouseout="out('599391339335107838');" style=""> 416      private void backupIcons(Journal in, BackupDataOutput data, Journal out,                                      </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 417              ArrayList&lt;Key&gt; keys) throws IOException {                                                             </span>
<span class="-696520213704903388" onmouseenter="enter('-696520213704903388');" onmouseout="out('-696520213704903388');" style=""> 418          // persist icons that haven&#x27;t been persisted yet                                                          </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 419          final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style=""> 420          if (appState == null) {                                                                                   </span>

<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 421              dataChanged(); // try again later                                                                     </span>
<span class="-8112704428397532174" onmouseenter="enter('-8112704428397532174');" onmouseout="out('-8112704428397532174');" style=""> 422              if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying icon backup&quot;);                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 423              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 425          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="149427024973172530" onmouseenter="enter('149427024973172530');" onmouseout="out('149427024973172530');" style=""> 426          final IconCache iconCache = appState.getIconCache();                                                      </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 427          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>

<span  style=""> 428                                                                                                                    </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 429          // read the old ID set                                                                                    </span>
<span class="5971436892288320278" onmouseenter="enter('5971436892288320278');" onmouseout="out('5971436892288320278');" style=""> 430          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.ICON, in);                                                   </span>
<span class="-8460076387801577925" onmouseenter="enter('-8460076387801577925');" onmouseout="out('-8460076387801577925');" style=""> 431          if (DEBUG) Log.d(TAG, &quot;icon savedIds.size()=&quot; + savedIds.size());                                         </span>
<span  style=""> 432                                                                                                                    </span>

<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 433          int startRows = out.rows;                                                                                 </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 434          if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                                     </span>
<span class="-4292763550535280363" onmouseenter="enter('-4292763550535280363');" onmouseout="out('-4292763550535280363');" style=""> 435          String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPLICATION;                               </span>




<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 436          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 437                  where, null, null);                                                                               </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 438          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 439          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 440              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 441              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 442                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="-6243527749617200946" onmouseenter="enter('-6243527749617200946');" onmouseout="out('-6243527749617200946');" style=""> 443                  final String intentDescription = cursor.getString(INTENT_INDEX);                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 444                  try {                                                                                             </span>
<span class="-2295343962261265791" onmouseenter="enter('-2295343962261265791');" onmouseout="out('-2295343962261265791');" style=""> 445                      Intent intent = Intent.parseUri(intentDescription, 0);                                        </span>
<span class="3077177432662788710" onmouseenter="enter('3077177432662788710');" onmouseout="out('3077177432662788710');" style=""> 446                      ComponentName cn = intent.getComponent();                                                     </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 447                      Key key = null;                                                                               </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 448                      String backupKey = null;                                                                      </span>
<span class="3459055710499452007" onmouseenter="enter('3459055710499452007');" onmouseout="out('3459055710499452007');" style=""> 449                      if (cn != null) {                                                                             </span>
<span class="-6529550520447655416" onmouseenter="enter('-6529550520447655416');" onmouseout="out('-6529550520447655416');" style=""> 450                          key = getKey(Key.ICON, cn.flattenToShortString());                                        </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 451                          backupKey = keyToBackupKey(key);                                                          </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 452                          currentIds.add(backupKey);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 453                      } else {                                                                                      </span>
<span class="-5138655067357587325" onmouseenter="enter('-5138655067357587325');" onmouseout="out('-5138655067357587325');" style=""> 454                          Log.w(TAG, &quot;empty intent on application favorite: &quot; + id);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455                      }                                                                                             </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 456                      if (savedIds.contains(backupKey)) {                                                           </span>
<span class="8517000909350015455" onmouseenter="enter('8517000909350015455');" onmouseout="out('8517000909350015455');" style=""> 457                          if (DEBUG) Log.d(TAG, &quot;already saved icon &quot; + backupKey);                                 </span>

<span  style=""> 458                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 459                          // remember that we already backed this up previously                                     </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 460                          keys.add(key);                                                                            </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 461                      } else if (backupKey != null) {                                                               </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 462                          if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                              </span>
<span class="-9006656974661932570" onmouseenter="enter('-9006656974661932570');" onmouseout="out('-9006656974661932570');" style=""> 463                          if ((out.rows - startRows) &lt; MAX_ICONS_PER_PASS) {                                        </span>
<span class="1803535539435404169" onmouseenter="enter('1803535539435404169');" onmouseout="out('1803535539435404169');" style=""> 464                              if (DEBUG) Log.d(TAG, &quot;saving icon &quot; + backupKey);                                    </span>
<span class="-5470035225995042850" onmouseenter="enter('-5470035225995042850');" onmouseout="out('-5470035225995042850');" style=""> 465                              Bitmap icon = iconCache.getIcon(intent);                                              </span>


<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 466                              keys.add(key);                                                                        </span>
<span class="-8248254087701230428" onmouseenter="enter('-8248254087701230428');" onmouseout="out('-8248254087701230428');" style=""> 467                              if (icon != null &amp;&amp; !iconCache.isDefaultIcon(icon)) {                                 </span>

<span class="-1917944616523216064" onmouseenter="enter('-1917944616523216064');" onmouseout="out('-1917944616523216064');" style=""> 468                                  byte[] blob = packIcon(dpi, icon);                                                </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 469                                  writeRowToBackup(key, blob, out, data);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 471                          } else {                                                                                  </span>
<span class="3481547132000423214" onmouseenter="enter('3481547132000423214');" onmouseout="out('3481547132000423214');" style=""> 472                              if (DEBUG) Log.d(TAG, &quot;scheduling another run for icon &quot; + backupKey);                </span>

<span class="-1106578277425065730" onmouseenter="enter('-1106578277425065730');" onmouseout="out('-1106578277425065730');" style=""> 473                              // too many icons for this pass, request another.                                     </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 474                              dataChanged();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476                      }                                                                                             </span>
<span class="900563632545065451" onmouseenter="enter('900563632545065451');" onmouseout="out('900563632545065451');" style=""> 477                  } catch (URISyntaxException e) {                                                                  </span>
<span class="-2603583536470475189" onmouseenter="enter('-2603583536470475189');" onmouseout="out('-2603583536470475189');" style=""> 478                      Log.w(TAG, &quot;invalid URI on application favorite: &quot; + id);                                     </span>

<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 479                  } catch (IOException e) {                                                                         </span>
<span class="2092789497893549384" onmouseenter="enter('2092789497893549384');" onmouseout="out('2092789497893549384');" style=""> 480                      Log.w(TAG, &quot;unable to save application icon for favorite: &quot; + id);                            </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481                  }                                                                                                 </span>
<span  style=""> 482                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 484          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 485              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486          }                                                                                                         </span>
<span class="2508143952868696771" onmouseenter="enter('2508143952868696771');" onmouseout="out('2508143952868696771');" style=""> 487          if (DEBUG) Log.d(TAG, &quot;icon currentIds.size()=&quot; + currentIds.size());                                     </span>
<span  style=""> 488                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 489          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 490          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 491          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492      }                                                                                                             </span>
<span  style=""> 493                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 494      /**                                                                                                           </span>
<span class="-1885491841744282751" onmouseenter="enter('-1885491841744282751');" onmouseout="out('-1885491841744282751');" style=""> 495       * Read an icon from the stream.                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 496       *                                                                                                            </span>
<span class="-5741627409545156207" onmouseenter="enter('-5741627409545156207');" onmouseout="out('-5741627409545156207');" style=""> 497       * &lt;P&gt;Keys arrive in any order, so shortcuts that use this icon may already exist.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 498       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 499       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 500       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 501       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 502       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 503       */                                                                                                           </span>
<span class="3418786705842277190" onmouseenter="enter('3418786705842277190');" onmouseout="out('3418786705842277190');" style=""> 504      private void restoreIcon(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                         </span>
<span class="-4078819072521132180" onmouseenter="enter('-4078819072521132180');" onmouseout="out('-4078819072521132180');" style=""> 505          Log.v(TAG, &quot;unpacking icon &quot; + key.id);                                                                   </span>

<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 506          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 507                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 508          try {                                                                                                     </span>
<span class="-1273277075539844188" onmouseenter="enter('-1273277075539844188');" onmouseout="out('-1273277075539844188');" style=""> 509              Resource res = unpackIcon(buffer, 0, dataSize);                                                       </span>
<span class="1340215949763938765" onmouseenter="enter('1340215949763938765');" onmouseout="out('1340215949763938765');" style=""> 510              if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + res.dpi);                                                         </span>
<span class="3021569960171327606" onmouseenter="enter('3021569960171327606');" onmouseout="out('3021569960171327606');" style=""> 511              if (DEBUG) Log.d(TAG, &quot;read &quot; +                                                                       </span>
<span class="-9086841055072808764" onmouseenter="enter('-9086841055072808764');" onmouseout="out('-9086841055072808764');" style=""> 512                      Base64.encodeToString(res.data, 0, res.data.length,                                           </span>
<span class="6738045639769732117" onmouseenter="enter('6738045639769732117');" onmouseout="out('6738045639769732117');" style=""> 513                              Base64.NO_WRAP));                                                                     </span>








<span class="-5594207698336701639" onmouseenter="enter('-5594207698336701639');" onmouseout="out('-5594207698336701639');" style=""> 514              Bitmap icon = BitmapFactory.decodeByteArray(res.data, 0, res.data.length);                            </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 515              if (icon == null) {                                                                                   </span>
<span class="5620149143178252425" onmouseenter="enter('5620149143178252425');" onmouseout="out('5620149143178252425');" style=""> 516                  Log.w(TAG, &quot;failed to unpack icon for &quot; + key.name);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517              }                                                                                                     </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 518          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style=""> 519              Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>













<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521      }                                                                                                             </span>
<span  style=""> 522                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 523      /**                                                                                                           </span>
<span class="4000908239394499955" onmouseenter="enter('4000908239394499955');" onmouseout="out('4000908239394499955');" style=""> 524       * Write all the static widget resources we need to render placeholders                                       </span>
<span class="8219339119392163008" onmouseenter="enter('8219339119392163008');" onmouseout="out('8219339119392163008');" style=""> 525       * for a package that is not installed.                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 526       *                                                                                                            </span>
<span class="-6980354742562972424" onmouseenter="enter('-6980354742562972424');" onmouseout="out('-6980354742562972424');" style=""> 527       * @param in notes from last backup                                                                           </span>
<span class="-2592525162213602237" onmouseenter="enter('-2592525162213602237');" onmouseout="out('-2592525162213602237');" style=""> 528       * @param data output stream for key/value pairs                                                              </span>
<span class="-1316611594430993054" onmouseenter="enter('-1316611594430993054');" onmouseout="out('-1316611594430993054');" style=""> 529       * @param out notes about this backup                                                                         </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 530       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-2042953791166134795" onmouseenter="enter('-2042953791166134795');" onmouseout="out('-2042953791166134795');" style=""> 531       * @throws IOException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 532       */                                                                                                           </span>
<span class="-982237492458374713" onmouseenter="enter('-982237492458374713');" onmouseout="out('-982237492458374713');" style=""> 533      private void backupWidgets(Journal in, BackupDataOutput data, Journal out,                                    </span>
<span class="7905692898072451907" onmouseenter="enter('7905692898072451907');" onmouseout="out('7905692898072451907');" style=""> 534              ArrayList&lt;Key&gt; keys) throws IOException {                                                             </span>
<span class="-3735977085921928978" onmouseenter="enter('-3735977085921928978');" onmouseout="out('-3735977085921928978');" style=""> 535          // persist static widget info that hasn&#x27;t been persisted yet                                              </span>
<span class="8304662471046588041" onmouseenter="enter('8304662471046588041');" onmouseout="out('8304662471046588041');" style=""> 536          final LauncherAppState appState = LauncherAppState.getInstanceNoCreate();                                 </span>
<span class="431482135354613109" onmouseenter="enter('431482135354613109');" onmouseout="out('431482135354613109');" style=""> 537          if (appState == null) {                                                                                   </span>
<span class="-5416503150531726273" onmouseenter="enter('-5416503150531726273');" onmouseout="out('-5416503150531726273');" style=""> 538              dataChanged(); // try again later                                                                     </span>
<span class="6858868851065541463" onmouseenter="enter('6858868851065541463');" onmouseout="out('6858868851065541463');" style=""> 539              if (DEBUG) Log.d(TAG, &quot;Launcher is not initialized, delaying widget backup&quot;);                         </span>


<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 540              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541          }                                                                                                         </span>
<span class="-4277667532897433461" onmouseenter="enter('-4277667532897433461');" onmouseout="out('-4277667532897433461');" style=""> 542          final ContentResolver cr = mContext.getContentResolver();                                                 </span>
<span class="-4103309964390886661" onmouseenter="enter('-4103309964390886661');" onmouseout="out('-4103309964390886661');" style=""> 543          final WidgetPreviewLoader previewLoader = new WidgetPreviewLoader(mContext);                              </span>
<span class="8376847898351774228" onmouseenter="enter('8376847898351774228');" onmouseout="out('8376847898351774228');" style=""> 544          final PagedViewCellLayout widgetSpacingLayout = new PagedViewCellLayout(mContext);                        </span>
<span class="149427024973172530" onmouseenter="enter('149427024973172530');" onmouseout="out('149427024973172530');" style=""> 545          final IconCache iconCache = appState.getIconCache();                                                      </span>
<span class="2734999386983856558" onmouseenter="enter('2734999386983856558');" onmouseout="out('2734999386983856558');" style=""> 546          final int dpi = mContext.getResources().getDisplayMetrics().densityDpi;                                   </span>
<span class="-7885450570200523605" onmouseenter="enter('-7885450570200523605');" onmouseout="out('-7885450570200523605');" style=""> 547          final DeviceProfile profile = appState.getDynamicGrid().getDeviceProfile();                               </span>
<span class="8742319267076301489" onmouseenter="enter('8742319267076301489');" onmouseout="out('8742319267076301489');" style=""> 548          if (DEBUG) Log.d(TAG, &quot;cellWidthPx: &quot; + profile.cellWidthPx);                                             </span>
<span  style=""> 549                                                                                                                    </span>
<span class="703886294577627752" onmouseenter="enter('703886294577627752');" onmouseout="out('703886294577627752');" style=""> 550          // read the old ID set                                                                                    </span>
<span class="-852429832136699702" onmouseenter="enter('-852429832136699702');" onmouseout="out('-852429832136699702');" style=""> 551          Set&lt;String&gt; savedIds = getSavedIdsByType(Key.WIDGET, in);                                                 </span>
<span class="-2616909315275324814" onmouseenter="enter('-2616909315275324814');" onmouseout="out('-2616909315275324814');" style=""> 552          if (DEBUG) Log.d(TAG, &quot;widgets savedIds.size()=&quot; + savedIds.size());                                      </span>
<span  style=""> 553                                                                                                                    </span>
<span class="1330643462961301428" onmouseenter="enter('1330643462961301428');" onmouseout="out('1330643462961301428');" style=""> 554          int startRows = out.rows;                                                                                 </span>
<span class="4175635263869504695" onmouseenter="enter('4175635263869504695');" onmouseout="out('4175635263869504695');" style=""> 555          if (DEBUG) Log.d(TAG, &quot;starting here: &quot; + startRows);                                                     </span>
<span class="2063981078009346021" onmouseenter="enter('2063981078009346021');" onmouseout="out('2063981078009346021');" style=""> 556          String where = Favorites.ITEM_TYPE + &quot;=&quot; + Favorites.ITEM_TYPE_APPWIDGET;                                 </span>


<span class="2809328808224566373" onmouseenter="enter('2809328808224566373');" onmouseout="out('2809328808224566373');" style=""> 557          Cursor cursor = cr.query(Favorites.CONTENT_URI, FAVORITE_PROJECTION,                                      </span>
<span class="-3237002527436681573" onmouseenter="enter('-3237002527436681573');" onmouseout="out('-3237002527436681573');" style=""> 558                  where, null, null);                                                                               </span>
<span class="-657827484246636579" onmouseenter="enter('-657827484246636579');" onmouseout="out('-657827484246636579');" style=""> 559          Set&lt;String&gt; currentIds = new HashSet&lt;String&gt;(cursor.getCount());                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 560          try {                                                                                                     </span>
<span class="251182066089511653" onmouseenter="enter('251182066089511653');" onmouseout="out('251182066089511653');" style=""> 561              cursor.moveToPosition(-1);                                                                            </span>
<span class="3070867184546199263" onmouseenter="enter('3070867184546199263');" onmouseout="out('3070867184546199263');" style=""> 562              while(cursor.moveToNext()) {                                                                          </span>
<span class="2691622147357981943" onmouseenter="enter('2691622147357981943');" onmouseout="out('2691622147357981943');" style=""> 563                  final long id = cursor.getLong(ID_INDEX);                                                         </span>
<span class="7886188131381234507" onmouseenter="enter('7886188131381234507');" onmouseout="out('7886188131381234507');" style=""> 564                  final String providerName = cursor.getString(APPWIDGET_PROVIDER_INDEX);                           </span>
<span class="5826549546804156711" onmouseenter="enter('5826549546804156711');" onmouseout="out('5826549546804156711');" style=""> 565                  final int spanX = cursor.getInt(SPANX_INDEX);                                                     </span>
<span class="7893340860469522324" onmouseenter="enter('7893340860469522324');" onmouseout="out('7893340860469522324');" style=""> 566                  final int spanY = cursor.getInt(SPANY_INDEX);                                                     </span>
<span class="-2774082373782774257" onmouseenter="enter('-2774082373782774257');" onmouseout="out('-2774082373782774257');" style=""> 567                  final ComponentName provider = ComponentName.unflattenFromString(providerName);                   </span>
<span class="-1092121527234574243" onmouseenter="enter('-1092121527234574243');" onmouseout="out('-1092121527234574243');" style=""> 568                  Key key = null;                                                                                   </span>
<span class="7855754991710181693" onmouseenter="enter('7855754991710181693');" onmouseout="out('7855754991710181693');" style=""> 569                  String backupKey = null;                                                                          </span>
<span class="-8436409377687209859" onmouseenter="enter('-8436409377687209859');" onmouseout="out('-8436409377687209859');" style=""> 570                  if (provider != null) {                                                                           </span>
<span class="-2421578008471920286" onmouseenter="enter('-2421578008471920286');" onmouseout="out('-2421578008471920286');" style=""> 571                      key = getKey(Key.WIDGET, providerName);                                                       </span>
<span class="-3460254017255065790" onmouseenter="enter('-3460254017255065790');" onmouseout="out('-3460254017255065790');" style=""> 572                      backupKey = keyToBackupKey(key);                                                              </span>
<span class="-910891177306256408" onmouseenter="enter('-910891177306256408');" onmouseout="out('-910891177306256408');" style=""> 573                      currentIds.add(backupKey);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 574                  } else {                                                                                          </span>
<span class="-116936041960038197" onmouseenter="enter('-116936041960038197');" onmouseout="out('-116936041960038197');" style=""> 575                      Log.w(TAG, &quot;empty intent on appwidget: &quot; + id);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 576                  }                                                                                                 </span>
<span class="2029397145013713116" onmouseenter="enter('2029397145013713116');" onmouseout="out('2029397145013713116');" style=""> 577                  if (savedIds.contains(backupKey)) {                                                               </span>
<span class="-3418693445820022673" onmouseenter="enter('-3418693445820022673');" onmouseout="out('-3418693445820022673');" style=""> 578                      if (DEBUG) Log.d(TAG, &quot;already saved widget &quot; + backupKey);                                   </span>

<span  style=""> 579                                                                                                                    </span>
<span class="6389721741690217315" onmouseenter="enter('6389721741690217315');" onmouseout="out('6389721741690217315');" style=""> 580                      // remember that we already backed this up previously                                         </span>
<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 581                      keys.add(key);                                                                                </span>
<span class="2992350628267452236" onmouseenter="enter('2992350628267452236');" onmouseout="out('2992350628267452236');" style=""> 582                  } else if (backupKey != null) {                                                                   </span>
<span class="-937044477863170646" onmouseenter="enter('-937044477863170646');" onmouseout="out('-937044477863170646');" style=""> 583                      if (DEBUG) Log.d(TAG, &quot;I can count this high: &quot; + out.rows);                                  </span>
<span class="-5873889847669281246" onmouseenter="enter('-5873889847669281246');" onmouseout="out('-5873889847669281246');" style=""> 584                      if ((out.rows - startRows) &lt; MAX_WIDGETS_PER_PASS) {                                          </span>
<span class="-675278366223697524" onmouseenter="enter('-675278366223697524');" onmouseout="out('-675278366223697524');" style=""> 585                          if (DEBUG) Log.d(TAG, &quot;saving widget &quot; + backupKey);                                      </span>

<span class="5731902488844945769" onmouseenter="enter('5731902488844945769');" onmouseout="out('5731902488844945769');" style=""> 586                          previewLoader.setPreviewSize(spanX * profile.cellWidthPx,                                 </span>
<span class="4335834404207041696" onmouseenter="enter('4335834404207041696');" onmouseout="out('4335834404207041696');" style=""> 587                                  spanY * profile.cellHeightPx, widgetSpacingLayout);                               </span>
<span class="6921082708123014497" onmouseenter="enter('6921082708123014497');" onmouseout="out('6921082708123014497');" style=""> 588                          byte[] blob = packWidget(dpi, previewLoader, iconCache, provider);                        </span>

<span class="-122413165808502039" onmouseenter="enter('-122413165808502039');" onmouseout="out('-122413165808502039');" style=""> 589                          keys.add(key);                                                                            </span>
<span class="7327577509715695888" onmouseenter="enter('7327577509715695888');" onmouseout="out('7327577509715695888');" style=""> 590                          writeRowToBackup(key, blob, out, data);                                                   </span>
<span  style=""> 591                                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 592                      } else {                                                                                      </span>
<span class="-3116095515592516710" onmouseenter="enter('-3116095515592516710');" onmouseout="out('-3116095515592516710');" style=""> 593                          if (DEBUG) Log.d(TAG, &quot;scheduling another run for widget &quot; + backupKey);                  </span>

<span class="2181035020366770324" onmouseenter="enter('2181035020366770324');" onmouseout="out('2181035020366770324');" style=""> 594                          // too many widgets for this pass, request another.                                       </span>
<span class="1825448307532390700" onmouseenter="enter('1825448307532390700');" onmouseout="out('1825448307532390700');" style=""> 595                          dataChanged();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598              }                                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 599          } finally {                                                                                               </span>
<span class="-598211251935134700" onmouseenter="enter('-598211251935134700');" onmouseout="out('-598211251935134700');" style=""> 600              cursor.close();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601          }                                                                                                         </span>
<span class="7930052468528100382" onmouseenter="enter('7930052468528100382');" onmouseout="out('7930052468528100382');" style=""> 602          if (DEBUG) Log.d(TAG, &quot;widget currentIds.size()=&quot; + currentIds.size());                                   </span>
<span  style=""> 603                                                                                                                    </span>
<span class="-1061434847899571028" onmouseenter="enter('-1061434847899571028');" onmouseout="out('-1061434847899571028');" style=""> 604          // these IDs must have been deleted                                                                       </span>
<span class="8777724105586575960" onmouseenter="enter('8777724105586575960');" onmouseout="out('8777724105586575960');" style=""> 605          savedIds.removeAll(currentIds);                                                                           </span>
<span class="2919744190648561080" onmouseenter="enter('2919744190648561080');" onmouseout="out('2919744190648561080');" style=""> 606          out.rows += removeDeletedKeysFromBackup(savedIds, data);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607      }                                                                                                             </span>
<span  style=""> 608                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 609      /**                                                                                                           </span>
<span class="7259844484812569891" onmouseenter="enter('7259844484812569891');" onmouseout="out('7259844484812569891');" style=""> 610       * Read a widget from the stream.                                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 611       *                                                                                                            </span>
<span class="8754375073710347704" onmouseenter="enter('8754375073710347704');" onmouseout="out('8754375073710347704');" style=""> 612       * &lt;P&gt;Keys arrive in any order, so widgets that use this data may already exist.                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 613       *                                                                                                            </span>
<span class="6195616948097416972" onmouseenter="enter('6195616948097416972');" onmouseout="out('6195616948097416972');" style=""> 614       * @param key identifier for the row                                                                          </span>
<span class="7925275705929408987" onmouseenter="enter('7925275705929408987');" onmouseout="out('7925275705929408987');" style=""> 615       * @param buffer the serialized proto from the stream, may be larger than dataSize                            </span>
<span class="-3985549915793044077" onmouseenter="enter('-3985549915793044077');" onmouseout="out('-3985549915793044077');" style=""> 616       * @param dataSize the size of the proto from the stream                                                      </span>
<span class="-8304843047451947937" onmouseenter="enter('-8304843047451947937');" onmouseout="out('-8304843047451947937');" style=""> 617       * @param keys keys to mark as clean in the notes for next backup                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 618       */                                                                                                           </span>
<span class="-2743597305724887598" onmouseenter="enter('-2743597305724887598');" onmouseout="out('-2743597305724887598');" style=""> 619      private void restoreWidget(Key key, byte[] buffer, int dataSize, ArrayList&lt;Key&gt; keys) {                       </span>
<span class="-6524290342693786597" onmouseenter="enter('-6524290342693786597');" onmouseout="out('-6524290342693786597');" style=""> 620          Log.v(TAG, &quot;unpacking widget &quot; + key.id);                                                                 </span>

<span class="7094927646276939900" onmouseenter="enter('7094927646276939900');" onmouseout="out('7094927646276939900');" style=""> 621          if (DEBUG) Log.d(TAG, &quot;read (&quot; + buffer.length + &quot;): &quot; +                                                  </span>
<span class="7064266993502257311" onmouseenter="enter('7064266993502257311');" onmouseout="out('7064266993502257311');" style=""> 622                  Base64.encodeToString(buffer, 0, dataSize, Base64.NO_WRAP));                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 623          try {                                                                                                     </span>
<span class="6880516999183343771" onmouseenter="enter('6880516999183343771');" onmouseout="out('6880516999183343771');" style=""> 624              Widget widget = unpackWidget(buffer, 0, dataSize);                                                    </span>
<span class="-5130360158104828961" onmouseenter="enter('-5130360158104828961');" onmouseout="out('-5130360158104828961');" style=""> 625              if (DEBUG) Log.d(TAG, &quot;unpacked &quot; + widget.provider);                                                 </span>
<span class="-6447540356587496937" onmouseenter="enter('-6447540356587496937');" onmouseout="out('-6447540356587496937');" style=""> 626              if (widget.icon.data != null)  {                                                                      </span>
<span class="707024101699637073" onmouseenter="enter('707024101699637073');" onmouseout="out('707024101699637073');" style=""> 627                  Bitmap icon = BitmapFactory                                                                       </span>
<span class="-8983689703726354871" onmouseenter="enter('-8983689703726354871');" onmouseout="out('-8983689703726354871');" style=""> 628                          .decodeByteArray(widget.icon.data, 0, widget.icon.data.length);                           </span>
<span class="1725352956749743202" onmouseenter="enter('1725352956749743202');" onmouseout="out('1725352956749743202');" style=""> 629                  if (icon == null) {                                                                               </span>
<span class="1668271119256318595" onmouseenter="enter('1668271119256318595');" onmouseout="out('1668271119256318595');" style=""> 630                      Log.w(TAG, &quot;failed to unpack widget icon for &quot; + key.name);                                   </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632              }                                                                                                     </span>







<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 633          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="8627839735620585991" onmouseenter="enter('8627839735620585991');" onmouseout="out('8627839735620585991');" style=""> 634              Log.w(TAG, &quot;failed to decode proto&quot;, e);                                                              </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636      }                                                                                                             </span>
<span  style=""> 637                                                                                                                    </span>
<span class="379390538100943671" onmouseenter="enter('379390538100943671');" onmouseout="out('379390538100943671');" style=""> 638      /** create a new key, with an integer ID.                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 639       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 640       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 641       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 642       */                                                                                                           </span>
<span class="-9160616288431843252" onmouseenter="enter('-9160616288431843252');" onmouseout="out('-9160616288431843252');" style=""> 643      private Key getKey(int type, long id) {                                                                       </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 644          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 645          key.type = type;                                                                                          </span>
<span class="-7382566895935787612" onmouseenter="enter('-7382566895935787612');" onmouseout="out('-7382566895935787612');" style=""> 646          key.id = id;                                                                                              </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 647          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 648          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649      }                                                                                                             </span>
<span  style=""> 650                                                                                                                    </span>
<span class="4998084013424347407" onmouseenter="enter('4998084013424347407');" onmouseout="out('4998084013424347407');" style=""> 651      /** create a new key for a named object.                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 652       *                                                                                                            </span>
<span class="5127410523533252" onmouseenter="enter('5127410523533252');" onmouseout="out('5127410523533252');" style=""> 653       * &lt;P&gt; Keys contain their own checksum instead of using                                                       </span>
<span class="-6171637920693460026" onmouseenter="enter('-6171637920693460026');" onmouseout="out('-6171637920693460026');" style=""> 654       * the heavy-weight CheckedMessage wrapper.                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 655       */                                                                                                           </span>
<span class="-575152325497006553" onmouseenter="enter('-575152325497006553');" onmouseout="out('-575152325497006553');" style=""> 656      private Key getKey(int type, String name) {                                                                   </span>
<span class="-4574924144097658670" onmouseenter="enter('-4574924144097658670');" onmouseout="out('-4574924144097658670');" style=""> 657          Key key = new Key();                                                                                      </span>
<span class="4878654331371356222" onmouseenter="enter('4878654331371356222');" onmouseout="out('4878654331371356222');" style=""> 658          key.type = type;                                                                                          </span>
<span class="-6394075391343723046" onmouseenter="enter('-6394075391343723046');" onmouseout="out('-6394075391343723046');" style=""> 659          key.name = name;                                                                                          </span>
<span class="-1815201536643838352" onmouseenter="enter('-1815201536643838352');" onmouseout="out('-1815201536643838352');" style=""> 660          key.checksum = checkKey(key);                                                                             </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 661          return key;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662      }                                                                                                             </span>
<span  style=""> 663                                                                                                                    </span>
<span class="5550694708737024742" onmouseenter="enter('5550694708737024742');" onmouseout="out('5550694708737024742');" style=""> 664      /** keys need to be strings, serialize and encode. */                                                         </span>
<span class="7073150882434878031" onmouseenter="enter('7073150882434878031');" onmouseout="out('7073150882434878031');" style=""> 665      private String keyToBackupKey(Key key) {                                                                      </span>
<span class="-3590053747654507256" onmouseenter="enter('-3590053747654507256');" onmouseout="out('-3590053747654507256');" style=""> 666          return Base64.encodeToString(Key.toByteArray(key), Base64.NO_WRAP);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667      }                                                                                                             </span>
<span  style=""> 668                                                                                                                    </span>
<span class="1793696935546339078" onmouseenter="enter('1793696935546339078');" onmouseout="out('1793696935546339078');" style=""> 669      /** keys need to be strings, decode and parse. */                                                             </span>
<span class="3565153267272331252" onmouseenter="enter('3565153267272331252');" onmouseout="out('3565153267272331252');" style=""> 670      private Key backupKeyToKey(String backupKey) throws KeyParsingException {                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 671          try {                                                                                                     </span>
<span class="-254797143650283908" onmouseenter="enter('-254797143650283908');" onmouseout="out('-254797143650283908');" style=""> 672              Key key = Key.parseFrom(Base64.decode(backupKey, Base64.DEFAULT));                                    </span>
<span class="7550434138609112511" onmouseenter="enter('7550434138609112511');" onmouseout="out('7550434138609112511');" style=""> 673              if (key.checksum != checkKey(key)) {                                                                  </span>
<span class="8380148917289055" onmouseenter="enter('8380148917289055');" onmouseout="out('8380148917289055');" style=""> 674                  key = null;                                                                                       </span>
<span class="7886037428699907314" onmouseenter="enter('7886037428699907314');" onmouseout="out('7886037428699907314');" style=""> 675                  throw new KeyParsingException(&quot;invalid key read from stream&quot; + backupKey);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676              }                                                                                                     </span>
<span class="5738733750165622395" onmouseenter="enter('5738733750165622395');" onmouseout="out('5738733750165622395');" style=""> 677              return key;                                                                                           </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 678          } catch (InvalidProtocolBufferNanoException e) {                                                          </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 679              throw new KeyParsingException(e);                                                                     </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 680          } catch (IllegalArgumentException e) {                                                                    </span>
<span class="-9214039832515909448" onmouseenter="enter('-9214039832515909448');" onmouseout="out('-9214039832515909448');" style=""> 681              throw new KeyParsingException(e);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 682          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 683      }                                                                                                             </span>
<span  style=""> 684                                                                                                                    </span>
<span class="-9026907230628270971" onmouseenter="enter('-9026907230628270971');" onmouseout="out('-9026907230628270971');" style=""> 685      private String getKeyName(Key key) {                                                                          </span>
<span class="-7992041348690575973" onmouseenter="enter('-7992041348690575973');" onmouseout="out('-7992041348690575973');" style=""> 686          if (TextUtils.isEmpty(key.name)) {                                                                        </span>
<span class="3948647275026092398" onmouseenter="enter('3948647275026092398');" onmouseout="out('3948647275026092398');" style=""> 687              return Long.toString(key.id);                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 688          } else {                                                                                                  </span>
<span class="-8847809052433174647" onmouseenter="enter('-8847809052433174647');" onmouseout="out('-8847809052433174647');" style=""> 689              return key.name;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690          }                                                                                                         </span>
<span  style=""> 691                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692      }                                                                                                             </span>
<span  style=""> 693                                                                                                                    </span>
<span class="-3302500785890956613" onmouseenter="enter('-3302500785890956613');" onmouseout="out('-3302500785890956613');" style=""> 694      private String geKeyType(Key key) {                                                                           </span>
<span class="-5383614242375734962" onmouseenter="enter('-5383614242375734962');" onmouseout="out('-5383614242375734962');" style=""> 695          switch (key.type) {                                                                                       </span>
<span class="-9001964496375062365" onmouseenter="enter('-9001964496375062365');" onmouseout="out('-9001964496375062365');" style=""> 696              case Key.FAVORITE:                                                                                    </span>
<span class="-6693583981393703832" onmouseenter="enter('-6693583981393703832');" onmouseout="out('-6693583981393703832');" style=""> 697                  return &quot;favorite&quot;;                                                                                </span>
<span class="-3857381523070337293" onmouseenter="enter('-3857381523070337293');" onmouseout="out('-3857381523070337293');" style=""> 698              case Key.SCREEN:                                                                                      </span>
<span class="-935980872443992001" onmouseenter="enter('-935980872443992001');" onmouseout="out('-935980872443992001');" style=""> 699                  return &quot;screen&quot;;                                                                                  </span>
<span class="5683672997449529139" onmouseenter="enter('5683672997449529139');" onmouseout="out('5683672997449529139');" style=""> 700              case Key.ICON:                                                                                        </span>
<span class="-6438997020167939033" onmouseenter="enter('-6438997020167939033');" onmouseout="out('-6438997020167939033');" style=""> 701                  return &quot;icon&quot;;                                                                                    </span>
<span class="-1493777842078845156" onmouseenter="enter('-1493777842078845156');" onmouseout="out('-1493777842078845156');" style=""> 702              case Key.WIDGET:                                                                                      </span>
<span class="875584635155758752" onmouseenter="enter('875584635155758752');" onmouseout="out('875584635155758752');" style=""> 703                  return &quot;widget&quot;;                                                                                  </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 704              default:                                                                                              </span>
<span class="-9117731612531303028" onmouseenter="enter('-9117731612531303028');" onmouseout="out('-9117731612531303028');" style=""> 705                  return &quot;anonymous&quot;;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 706          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 707      }                                                                                                             </span>
<span  style=""> 708                                                                                                                    </span>
<span class="-697615636239926635" onmouseenter="enter('-697615636239926635');" onmouseout="out('-697615636239926635');" style=""> 709      /** Compute the checksum over the important bits of a key. */                                                 </span>
<span class="-3977067687464977411" onmouseenter="enter('-3977067687464977411');" onmouseout="out('-3977067687464977411');" style=""> 710      private long checkKey(Key key) {                                                                              </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 711          CRC32 checksum = new CRC32();                                                                             </span>
<span class="1329267048107571841" onmouseenter="enter('1329267048107571841');" onmouseout="out('1329267048107571841');" style=""> 712          checksum.update(key.type);                                                                                </span>
<span class="-8263067584881706937" onmouseenter="enter('-8263067584881706937');" onmouseout="out('-8263067584881706937');" style=""> 713          checksum.update((int) (key.id &amp; 0xffff));                                                                 </span>
<span class="-7966560327215963567" onmouseenter="enter('-7966560327215963567');" onmouseout="out('-7966560327215963567');" style=""> 714          checksum.update((int) ((key.id &gt;&gt; 32) &amp; 0xffff));                                                         </span>
<span class="2738990482358118421" onmouseenter="enter('2738990482358118421');" onmouseout="out('2738990482358118421');" style=""> 715          if (!TextUtils.isEmpty(key.name)) {                                                                       </span>
<span class="-323764916247065701" onmouseenter="enter('-323764916247065701');" onmouseout="out('-323764916247065701');" style=""> 716              checksum.update(key.name.getBytes());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717          }                                                                                                         </span>
<span class="4267423404311456950" onmouseenter="enter('4267423404311456950');" onmouseout="out('4267423404311456950');" style=""> 718          return checksum.getValue();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719      }                                                                                                             </span>
<span  style=""> 720                                                                                                                    </span>
<span class="5199547031058141048" onmouseenter="enter('5199547031058141048');" onmouseout="out('5199547031058141048');" style=""> 721      /** Serialize a Favorite for persistence, including a checksum wrapper. */                                    </span>
<span class="-4378147688590970666" onmouseenter="enter('-4378147688590970666');" onmouseout="out('-4378147688590970666');" style=""> 722      private byte[] packFavorite(Cursor c) {                                                                       </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 723          Favorite favorite = new Favorite();                                                                       </span>
<span class="6546909143263762139" onmouseenter="enter('6546909143263762139');" onmouseout="out('6546909143263762139');" style=""> 724          favorite.id = c.getLong(ID_INDEX);                                                                        </span>
<span class="155680812588219573" onmouseenter="enter('155680812588219573');" onmouseout="out('155680812588219573');" style=""> 725          favorite.screen = c.getInt(SCREEN_INDEX);                                                                 </span>
<span class="-2404581482497806008" onmouseenter="enter('-2404581482497806008');" onmouseout="out('-2404581482497806008');" style=""> 726          favorite.container = c.getInt(CONTAINER_INDEX);                                                           </span>
<span class="-8753421279366239983" onmouseenter="enter('-8753421279366239983');" onmouseout="out('-8753421279366239983');" style=""> 727          favorite.cellX = c.getInt(CELLX_INDEX);                                                                   </span>
<span class="-8671006715140907914" onmouseenter="enter('-8671006715140907914');" onmouseout="out('-8671006715140907914');" style=""> 728          favorite.cellY = c.getInt(CELLY_INDEX);                                                                   </span>
<span class="2641861357776849986" onmouseenter="enter('2641861357776849986');" onmouseout="out('2641861357776849986');" style=""> 729          favorite.spanX = c.getInt(SPANX_INDEX);                                                                   </span>
<span class="799280694788108240" onmouseenter="enter('799280694788108240');" onmouseout="out('799280694788108240');" style=""> 730          favorite.spanY = c.getInt(SPANY_INDEX);                                                                   </span>
<span class="6680564455639478308" onmouseenter="enter('6680564455639478308');" onmouseout="out('6680564455639478308');" style=""> 731          favorite.iconType = c.getInt(ICON_TYPE_INDEX);                                                            </span>
<span class="5927441393710664872" onmouseenter="enter('5927441393710664872');" onmouseout="out('5927441393710664872');" style=""> 732          if (favorite.iconType == Favorites.ICON_TYPE_RESOURCE) {                                                  </span>
<span class="-5425489115379273098" onmouseenter="enter('-5425489115379273098');" onmouseout="out('-5425489115379273098');" style=""> 733              String iconPackage = c.getString(ICON_PACKAGE_INDEX);                                                 </span>
<span class="-7286984632325840723" onmouseenter="enter('-7286984632325840723');" onmouseout="out('-7286984632325840723');" style=""> 734              if (!TextUtils.isEmpty(iconPackage)) {                                                                </span>
<span class="-5434536166682830736" onmouseenter="enter('-5434536166682830736');" onmouseout="out('-5434536166682830736');" style=""> 735                  favorite.iconPackage = iconPackage;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736              }                                                                                                     </span>
<span class="-4061526307264951997" onmouseenter="enter('-4061526307264951997');" onmouseout="out('-4061526307264951997');" style=""> 737              String iconResource = c.getString(ICON_RESOURCE_INDEX);                                               </span>
<span class="-455787029808768652" onmouseenter="enter('-455787029808768652');" onmouseout="out('-455787029808768652');" style=""> 738              if (!TextUtils.isEmpty(iconResource)) {                                                               </span>
<span class="3903482942550366896" onmouseenter="enter('3903482942550366896');" onmouseout="out('3903482942550366896');" style=""> 739                  favorite.iconResource = iconResource;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741          }                                                                                                         </span>
<span class="-2445816796682150852" onmouseenter="enter('-2445816796682150852');" onmouseout="out('-2445816796682150852');" style=""> 742          if (favorite.iconType == Favorites.ICON_TYPE_BITMAP) {                                                    </span>
<span class="930897706900391430" onmouseenter="enter('930897706900391430');" onmouseout="out('930897706900391430');" style=""> 743              byte[] blob = c.getBlob(ICON_INDEX);                                                                  </span>
<span class="-9102906105013268040" onmouseenter="enter('-9102906105013268040');" onmouseout="out('-9102906105013268040');" style=""> 744              if (blob != null &amp;&amp; blob.length &gt; 0) {                                                                </span>
<span class="-8537406465751521512" onmouseenter="enter('-8537406465751521512');" onmouseout="out('-8537406465751521512');" style=""> 745                  favorite.icon = blob;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 746              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747          }                                                                                                         </span>
<span class="-5957445387704980073" onmouseenter="enter('-5957445387704980073');" onmouseout="out('-5957445387704980073');" style=""> 748          String title = c.getString(TITLE_INDEX);                                                                  </span>
<span class="-5841612334834081385" onmouseenter="enter('-5841612334834081385');" onmouseout="out('-5841612334834081385');" style=""> 749          if (!TextUtils.isEmpty(title)) {                                                                          </span>
<span class="1235682441271403257" onmouseenter="enter('1235682441271403257');" onmouseout="out('1235682441271403257');" style=""> 750              favorite.title = title;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 751          }                                                                                                         </span>
<span class="4847614394231974705" onmouseenter="enter('4847614394231974705');" onmouseout="out('4847614394231974705');" style=""> 752          String intent = c.getString(INTENT_INDEX);                                                                </span>
<span class="7524736680884469493" onmouseenter="enter('7524736680884469493');" onmouseout="out('7524736680884469493');" style=""> 753          if (!TextUtils.isEmpty(intent)) {                                                                         </span>
<span class="5898358777330144092" onmouseenter="enter('5898358777330144092');" onmouseout="out('5898358777330144092');" style=""> 754              favorite.intent = intent;                                                                             </span>









<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755          }                                                                                                         </span>
<span class="-1193450866737706164" onmouseenter="enter('-1193450866737706164');" onmouseout="out('-1193450866737706164');" style=""> 756          favorite.itemType = c.getInt(ITEM_TYPE_INDEX);                                                            </span>
<span class="-5955501743592943120" onmouseenter="enter('-5955501743592943120');" onmouseout="out('-5955501743592943120');" style=""> 757          if (favorite.itemType == Favorites.ITEM_TYPE_APPWIDGET) {                                                 </span>
<span class="1070435677100453692" onmouseenter="enter('1070435677100453692');" onmouseout="out('1070435677100453692');" style=""> 758              favorite.appWidgetId = c.getInt(APPWIDGET_ID_INDEX);                                                  </span>
<span class="6321383480977463082" onmouseenter="enter('6321383480977463082');" onmouseout="out('6321383480977463082');" style=""> 759              String appWidgetProvider = c.getString(APPWIDGET_PROVIDER_INDEX);                                     </span>
<span class="1518251768871047550" onmouseenter="enter('1518251768871047550');" onmouseout="out('1518251768871047550');" style=""> 760              if (!TextUtils.isEmpty(appWidgetProvider)) {                                                          </span>
<span class="1181310850636226497" onmouseenter="enter('1181310850636226497');" onmouseout="out('1181310850636226497');" style=""> 761                  favorite.appWidgetProvider = appWidgetProvider;                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763          }                                                                                                         </span>
<span  style=""> 764                                                                                                                    </span>
<span class="-8315891601108782355" onmouseenter="enter('-8315891601108782355');" onmouseout="out('-8315891601108782355');" style=""> 765          return writeCheckedBytes(favorite);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766      }                                                                                                             </span>
<span  style=""> 767                                                                                                                    </span>
<span class="-794158363767631309" onmouseenter="enter('-794158363767631309');" onmouseout="out('-794158363767631309');" style=""> 768      /** Deserialize a Favorite from persistence, after verifying checksum wrapper. */                             </span>
<span class="-5885969248246737782" onmouseenter="enter('-5885969248246737782');" onmouseout="out('-5885969248246737782');" style=""> 769      private Favorite unpackFavorite(byte[] buffer, int offset, int dataSize)                                      </span>

<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 770              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="9016108719901806186" onmouseenter="enter('9016108719901806186');" onmouseout="out('9016108719901806186');" style=""> 771          Favorite favorite = new Favorite();                                                                       </span>
<span class="1666030682203596411" onmouseenter="enter('1666030682203596411');" onmouseout="out('1666030682203596411');" style=""> 772          MessageNano.mergeFrom(favorite, readCheckedBytes(buffer, offset, dataSize));                              </span>
<span class="-5205499390054176096" onmouseenter="enter('-5205499390054176096');" onmouseout="out('-5205499390054176096');" style=""> 773          return favorite;                                                                                          </span>
















































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774      }                                                                                                             </span>
<span  style=""> 775                                                                                                                    </span>
<span class="5443202080756406538" onmouseenter="enter('5443202080756406538');" onmouseout="out('5443202080756406538');" style=""> 776      /** Serialize a Screen for persistence, including a checksum wrapper. */                                      </span>
<span class="-1055302898918768280" onmouseenter="enter('-1055302898918768280');" onmouseout="out('-1055302898918768280');" style=""> 777      private byte[] packScreen(Cursor c) {                                                                         </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 778          Screen screen = new Screen();                                                                             </span>
<span class="4461577265124076927" onmouseenter="enter('4461577265124076927');" onmouseout="out('4461577265124076927');" style=""> 779          screen.id = c.getLong(ID_INDEX);                                                                          </span>
<span class="7818368122083921289" onmouseenter="enter('7818368122083921289');" onmouseout="out('7818368122083921289');" style=""> 780          screen.rank = c.getInt(SCREEN_RANK_INDEX);                                                                </span>
<span  style=""> 781                                                                                                                    </span>
<span class="-8008243495242652634" onmouseenter="enter('-8008243495242652634');" onmouseout="out('-8008243495242652634');" style=""> 782          return writeCheckedBytes(screen);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783      }                                                                                                             </span>
<span  style=""> 784                                                                                                                    </span>
<span class="8129951816147253774" onmouseenter="enter('8129951816147253774');" onmouseout="out('8129951816147253774');" style=""> 785      /** Deserialize a Screen from persistence, after verifying checksum wrapper. */                               </span>
<span class="4829208427200429786" onmouseenter="enter('4829208427200429786');" onmouseout="out('4829208427200429786');" style=""> 786      private Screen unpackScreen(byte[] buffer, int offset, int dataSize)                                          </span>

<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 787              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2413588488067071648" onmouseenter="enter('-2413588488067071648');" onmouseout="out('-2413588488067071648');" style=""> 788          Screen screen = new Screen();                                                                             </span>
<span class="5997669843530195787" onmouseenter="enter('5997669843530195787');" onmouseout="out('5997669843530195787');" style=""> 789          MessageNano.mergeFrom(screen, readCheckedBytes(buffer, offset, dataSize));                                </span>
<span class="4414271469016845624" onmouseenter="enter('4414271469016845624');" onmouseout="out('4414271469016845624');" style=""> 790          return screen;                                                                                            </span>





<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791      }                                                                                                             </span>
<span  style=""> 792                                                                                                                    </span>
<span class="-7238358256566487739" onmouseenter="enter('-7238358256566487739');" onmouseout="out('-7238358256566487739');" style=""> 793      /** Serialize an icon Resource for persistence, including a checksum wrapper. */                              </span>
<span class="1129196888280545123" onmouseenter="enter('1129196888280545123');" onmouseout="out('1129196888280545123');" style=""> 794      private byte[] packIcon(int dpi, Bitmap icon) {                                                               </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 795          Resource res = new Resource();                                                                            </span>
<span class="-731296930068073335" onmouseenter="enter('-731296930068073335');" onmouseout="out('-731296930068073335');" style=""> 796          res.dpi = dpi;                                                                                            </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 797          ByteArrayOutputStream os = new ByteArrayOutputStream();                                                   </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 798          if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                         </span>
<span class="-5397655512794171892" onmouseenter="enter('-5397655512794171892');" onmouseout="out('-5397655512794171892');" style=""> 799              res.data = os.toByteArray();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800          }                                                                                                         </span>
<span class="-2324310893561295790" onmouseenter="enter('-2324310893561295790');" onmouseout="out('-2324310893561295790');" style=""> 801          return writeCheckedBytes(res);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802      }                                                                                                             </span>
<span  style=""> 803                                                                                                                    </span>
<span class="-8685556113116579868" onmouseenter="enter('-8685556113116579868');" onmouseout="out('-8685556113116579868');" style=""> 804      /** Deserialize an icon resource from persistence, after verifying checksum wrapper. */                       </span>
<span class="-8887428982837555818" onmouseenter="enter('-8887428982837555818');" onmouseout="out('-8887428982837555818');" style=""> 805      private Resource unpackIcon(byte[] buffer, int offset, int dataSize)                                          </span>

<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 806              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-4983201213983238354" onmouseenter="enter('-4983201213983238354');" onmouseout="out('-4983201213983238354');" style=""> 807          Resource res = new Resource();                                                                            </span>
<span class="760491121676290671" onmouseenter="enter('760491121676290671');" onmouseout="out('760491121676290671');" style=""> 808          MessageNano.mergeFrom(res, readCheckedBytes(buffer, offset, dataSize));                                   </span>

<span class="1866624461241282949" onmouseenter="enter('1866624461241282949');" onmouseout="out('1866624461241282949');" style=""> 809          return res;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810      }                                                                                                             </span>
<span  style=""> 811                                                                                                                    </span>
<span class="4846213907055604506" onmouseenter="enter('4846213907055604506');" onmouseout="out('4846213907055604506');" style=""> 812      /** Serialize a widget for persistence, including a checksum wrapper. */                                      </span>
<span class="-476988516990873332" onmouseenter="enter('-476988516990873332');" onmouseout="out('-476988516990873332');" style=""> 813      private byte[] packWidget(int dpi, WidgetPreviewLoader previewLoader, IconCache iconCache,                    </span>
<span class="-3091729919102588446" onmouseenter="enter('-3091729919102588446');" onmouseout="out('-3091729919102588446');" style=""> 814              ComponentName provider) {                                                                             </span>
<span class="-996644926209970954" onmouseenter="enter('-996644926209970954');" onmouseout="out('-996644926209970954');" style=""> 815          final AppWidgetProviderInfo info = findAppWidgetProviderInfo(provider);                                   </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 816          Widget widget = new Widget();                                                                             </span>
<span class="1976359965722845524" onmouseenter="enter('1976359965722845524');" onmouseout="out('1976359965722845524');" style=""> 817          widget.provider = provider.flattenToShortString();                                                        </span>
<span class="-3386934063429665075" onmouseenter="enter('-3386934063429665075');" onmouseout="out('-3386934063429665075');" style=""> 818          widget.label = info.label;                                                                                </span>
<span class="-8913061531679687303" onmouseenter="enter('-8913061531679687303');" onmouseout="out('-8913061531679687303');" style=""> 819          widget.configure = info.configure != null;                                                                </span>
<span class="4706935672839644878" onmouseenter="enter('4706935672839644878');" onmouseout="out('4706935672839644878');" style=""> 820          if (info.icon != 0) {                                                                                     </span>
<span class="1433214991778597853" onmouseenter="enter('1433214991778597853');" onmouseout="out('1433214991778597853');" style=""> 821              widget.icon = new Resource();                                                                         </span>
<span class="-3191454430641030741" onmouseenter="enter('-3191454430641030741');" onmouseout="out('-3191454430641030741');" style=""> 822              Drawable fullResIcon = iconCache.getFullResIcon(provider.getPackageName(), info.icon);                </span>
<span class="-8832957737105991919" onmouseenter="enter('-8832957737105991919');" onmouseout="out('-8832957737105991919');" style=""> 823              Bitmap icon = Utilities.createIconBitmap(fullResIcon, mContext);                                      </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 824              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-4363103731615988972" onmouseenter="enter('-4363103731615988972');" onmouseout="out('-4363103731615988972');" style=""> 825              if (icon.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                     </span>
<span class="801135710017916771" onmouseenter="enter('801135710017916771');" onmouseout="out('801135710017916771');" style=""> 826                  widget.icon.data = os.toByteArray();                                                              </span>
<span class="-6473100269398127214" onmouseenter="enter('-6473100269398127214');" onmouseout="out('-6473100269398127214');" style=""> 827                  widget.icon.dpi = dpi;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829          }                                                                                                         </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 830          if (info.previewImage != 0) {                                                                             </span>
<span class="-5402030614190439016" onmouseenter="enter('-5402030614190439016');" onmouseout="out('-5402030614190439016');" style=""> 831              widget.preview = new Resource();                                                                      </span>
<span class="6909701077582515964" onmouseenter="enter('6909701077582515964');" onmouseout="out('6909701077582515964');" style=""> 832              Bitmap preview = previewLoader.generateWidgetPreview(info, null);                                     </span>
<span class="-934053334881676091" onmouseenter="enter('-934053334881676091');" onmouseout="out('-934053334881676091');" style=""> 833              ByteArrayOutputStream os = new ByteArrayOutputStream();                                               </span>
<span class="-5662403484741346206" onmouseenter="enter('-5662403484741346206');" onmouseout="out('-5662403484741346206');" style=""> 834              if (preview.compress(IMAGE_FORMAT, IMAGE_COMPRESSION_QUALITY, os)) {                                  </span>
<span class="1759979062656769163" onmouseenter="enter('1759979062656769163');" onmouseout="out('1759979062656769163');" style=""> 835                  widget.preview.data = os.toByteArray();                                                           </span>
<span class="3274467514012864009" onmouseenter="enter('3274467514012864009');" onmouseout="out('3274467514012864009');" style=""> 836                  widget.preview.dpi = dpi;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838          }                                                                                                         </span>
<span class="-6092547598221684616" onmouseenter="enter('-6092547598221684616');" onmouseout="out('-6092547598221684616');" style=""> 839          return writeCheckedBytes(widget);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840      }                                                                                                             </span>
<span  style=""> 841                                                                                                                    </span>
<span class="2267681228426618803" onmouseenter="enter('2267681228426618803');" onmouseout="out('2267681228426618803');" style=""> 842      /** Deserialize a widget from persistence, after verifying checksum wrapper. */                               </span>
<span class="478875287574324925" onmouseenter="enter('478875287574324925');" onmouseout="out('478875287574324925');" style=""> 843      private Widget unpackWidget(byte[] buffer, int offset, int dataSize)                                          </span>
<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 844              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-4481483781695735002" onmouseenter="enter('-4481483781695735002');" onmouseout="out('-4481483781695735002');" style=""> 845          Widget widget = new Widget();                                                                             </span>
<span class="-594535766013271981" onmouseenter="enter('-594535766013271981');" onmouseout="out('-594535766013271981');" style=""> 846          MessageNano.mergeFrom(widget, readCheckedBytes(buffer, offset, dataSize));                                </span>

<span class="5828985012142481034" onmouseenter="enter('5828985012142481034');" onmouseout="out('5828985012142481034');" style=""> 847          return widget;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 848      }                                                                                                             </span>
<span  style=""> 849                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 850      /**                                                                                                           </span>
<span class="-6613277601084981416" onmouseenter="enter('-6613277601084981416');" onmouseout="out('-6613277601084981416');" style=""> 851       * Read the old journal from the input file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 852       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style=""> 853       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style=""> 854       * in that case, do a full backup.                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 855       *                                                                                                            </span>
<span class="1538443412855705462" onmouseenter="enter('1538443412855705462');" onmouseout="out('1538443412855705462');" style=""> 856       * @param oldState the read-0only file descriptor pointing to the old journal                                 </span>
<span class="8396039089471161322" onmouseenter="enter('8396039089471161322');" onmouseout="out('8396039089471161322');" style=""> 857       * @return a Journal protocol bugffer                                                                         </span>

<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 858       */                                                                                                           </span>
<span class="7024974817408628903" onmouseenter="enter('7024974817408628903');" onmouseout="out('7024974817408628903');" style=""> 859      private Journal readJournal(ParcelFileDescriptor oldState) {                                                  </span>
<span class="-6703123393907213820" onmouseenter="enter('-6703123393907213820');" onmouseout="out('-6703123393907213820');" style=""> 860          Journal journal = new Journal();                                                                          </span>
<span class="-1134372187636919794" onmouseenter="enter('-1134372187636919794');" onmouseout="out('-1134372187636919794');" style=""> 861          if (oldState == null) {                                                                                   </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 862              return journal;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863          }                                                                                                         </span>
<span class="686714967075865912" onmouseenter="enter('686714967075865912');" onmouseout="out('686714967075865912');" style=""> 864          FileInputStream inStream = new FileInputStream(oldState.getFileDescriptor());                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 865          try {                                                                                                     </span>
<span class="209452004938020976" onmouseenter="enter('209452004938020976');" onmouseout="out('209452004938020976');" style=""> 866              int remaining = inStream.available();                                                                 </span>
<span class="6131565461738203738" onmouseenter="enter('6131565461738203738');" onmouseout="out('6131565461738203738');" style=""> 867              if (DEBUG) Log.d(TAG, &quot;available &quot; + remaining);                                                      </span>
<span class="-267483951981107204" onmouseenter="enter('-267483951981107204');" onmouseout="out('-267483951981107204');" style=""> 868              if (remaining &lt; MAX_JOURNAL_SIZE) {                                                                   </span>
<span class="-3947342340233403995" onmouseenter="enter('-3947342340233403995');" onmouseout="out('-3947342340233403995');" style=""> 869                  byte[] buffer = new byte[remaining];                                                              </span>




<span class="-8171407669268700020" onmouseenter="enter('-8171407669268700020');" onmouseout="out('-8171407669268700020');" style=""> 870                  int bytesRead = 0;                                                                                </span>
<span class="4297703130763568857" onmouseenter="enter('4297703130763568857');" onmouseout="out('4297703130763568857');" style=""> 871                  while (remaining &gt; 0) {                                                                           </span>



<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 872                      try {                                                                                         </span>
<span class="-2823215339347274650" onmouseenter="enter('-2823215339347274650');" onmouseout="out('-2823215339347274650');" style=""> 873                          int result = inStream.read(buffer, bytesRead, remaining);                                 </span>





<span class="6033926673887659701" onmouseenter="enter('6033926673887659701');" onmouseout="out('6033926673887659701');" style=""> 874                          if (result &gt; 0) {                                                                         </span>
<span class="3314126743897022072" onmouseenter="enter('3314126743897022072');" onmouseout="out('3314126743897022072');" style=""> 875                              if (DEBUG) Log.d(TAG, &quot;read some bytes: &quot; + result);                                  </span>
<span class="-3086923976409317546" onmouseenter="enter('-3086923976409317546');" onmouseout="out('-3086923976409317546');" style=""> 876                              remaining -= result;                                                                  </span>

<span class="5336812448310260976" onmouseenter="enter('5336812448310260976');" onmouseout="out('5336812448310260976');" style=""> 877                              bytesRead += result;                                                                  </span>



<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 878                          } else {                                                                                  </span>
<span class="8751875442808071737" onmouseenter="enter('8751875442808071737');" onmouseout="out('8751875442808071737');" style=""> 879                              // stop reading ands see what there is to parse                                       </span>
<span class="5775781333784661132" onmouseenter="enter('5775781333784661132');" onmouseout="out('5775781333784661132');" style=""> 880                              Log.w(TAG, &quot;read error: &quot; + result);                                                  </span>
<span class="504541059767922271" onmouseenter="enter('504541059767922271');" onmouseout="out('504541059767922271');" style=""> 881                              remaining = 0;                                                                        </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882                          }                                                                                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 883                      } catch (IOException e) {                                                                     </span>
<span class="8747165501767895818" onmouseenter="enter('8747165501767895818');" onmouseout="out('8747165501767895818');" style=""> 884                          Log.w(TAG, &quot;failed to read the journal&quot;, e);                                              </span>
<span class="-6018195483630231781" onmouseenter="enter('-6018195483630231781');" onmouseout="out('-6018195483630231781');" style=""> 885                          buffer = null;                                                                            </span>
<span class="504541059767922271" onmouseenter="enter('504541059767922271');" onmouseout="out('504541059767922271');" style=""> 886                          remaining = 0;                                                                            </span>














<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 887                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888                  }                                                                                                 </span>
<span class="-8527524960628910701" onmouseenter="enter('-8527524960628910701');" onmouseout="out('-8527524960628910701');" style=""> 889                  if (DEBUG) Log.d(TAG, &quot;journal bytes read: &quot; + bytesRead);                                        </span>
<span  style=""> 890                                                                                                                    </span>
<span class="-7980038940658798272" onmouseenter="enter('-7980038940658798272');" onmouseout="out('-7980038940658798272');" style=""> 891                  if (buffer != null) {                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 892                      try {                                                                                         </span>
<span class="-7234665278662199303" onmouseenter="enter('-7234665278662199303');" onmouseout="out('-7234665278662199303');" style=""> 893                          MessageNano.mergeFrom(journal, readCheckedBytes(buffer, 0, bytesRead));                   </span>
<span class="7687357378618406092" onmouseenter="enter('7687357378618406092');" onmouseout="out('7687357378618406092');" style=""> 894                      } catch (InvalidProtocolBufferNanoException e) {                                              </span>
<span class="-7778790307007077779" onmouseenter="enter('-7778790307007077779');" onmouseout="out('-7778790307007077779');" style=""> 895                          Log.d(TAG, &quot;failed to read the journal&quot;, e);                                              </span>
<span class="-1399232145997302960" onmouseenter="enter('-1399232145997302960');" onmouseout="out('-1399232145997302960');" style=""> 896                          journal.clear();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897                      }                                                                                             </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 899              }                                                                                                     </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 900          } catch (IOException e) {                                                                                 </span>
<span class="-8689995825070518460" onmouseenter="enter('-8689995825070518460');" onmouseout="out('-8689995825070518460');" style=""> 901              Log.d(TAG, &quot;failed to close the journal&quot;, e);                                                         </span>

<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 902          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 903              try {                                                                                                 </span>
<span class="3877592030275772713" onmouseenter="enter('3877592030275772713');" onmouseout="out('3877592030275772713');" style=""> 904                  inStream.close();                                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 905              } catch (IOException e) {                                                                             </span>
<span class="-8689995825070518460" onmouseenter="enter('-8689995825070518460');" onmouseout="out('-8689995825070518460');" style=""> 906                  Log.d(TAG, &quot;failed to close the journal&quot;, e);                                                     </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 907              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 908          }                                                                                                         </span>
<span class="6123396314927757118" onmouseenter="enter('6123396314927757118');" onmouseout="out('6123396314927757118');" style=""> 909          return journal;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910      }                                                                                                             </span>
<span  style=""> 911                                                                                                                    </span>
<span class="1857887861945457945" onmouseenter="enter('1857887861945457945');" onmouseout="out('1857887861945457945');" style=""> 912      private void writeRowToBackup(Key key, byte[] blob, Journal out,                                              </span>
<span class="-8985276741775775894" onmouseenter="enter('-8985276741775775894');" onmouseout="out('-8985276741775775894');" style=""> 913              BackupDataOutput data) throws IOException {                                                           </span>
<span class="-8570409028541836443" onmouseenter="enter('-8570409028541836443');" onmouseout="out('-8570409028541836443');" style=""> 914          String backupKey = keyToBackupKey(key);                                                                   </span>
<span class="-4358078076138720471" onmouseenter="enter('-4358078076138720471');" onmouseout="out('-4358078076138720471');" style=""> 915          data.writeEntityHeader(backupKey, blob.length);                                                           </span>
<span class="-5263783625880644949" onmouseenter="enter('-5263783625880644949');" onmouseout="out('-5263783625880644949');" style=""> 916          data.writeEntityData(blob, blob.length);                                                                  </span>
<span class="7907644802080103671" onmouseenter="enter('7907644802080103671');" onmouseout="out('7907644802080103671');" style=""> 917          out.rows++;                                                                                               </span>
<span class="-565229434051730696" onmouseenter="enter('-565229434051730696');" onmouseout="out('-565229434051730696');" style=""> 918          out.bytes += blob.length;                                                                                 </span>
<span class="4102122871293332284" onmouseenter="enter('4102122871293332284');" onmouseout="out('4102122871293332284');" style=""> 919          Log.v(TAG, &quot;saving &quot; + geKeyType(key) + &quot; &quot; + backupKey + &quot;: &quot; +                                          </span>

<span class="188331799762465007" onmouseenter="enter('188331799762465007');" onmouseout="out('188331799762465007');" style=""> 920                  getKeyName(key) + &quot;/&quot; + blob.length);                                                             </span>
<span class="9073034288274959985" onmouseenter="enter('9073034288274959985');" onmouseout="out('9073034288274959985');" style=""> 921          if(DEBUG_PAYLOAD) {                                                                                       </span>
<span class="-7017497320803160772" onmouseenter="enter('-7017497320803160772');" onmouseout="out('-7017497320803160772');" style=""> 922              String encoded = Base64.encodeToString(blob, 0, blob.length, Base64.NO_WRAP);                         </span>
<span class="-998151031530761193" onmouseenter="enter('-998151031530761193');" onmouseout="out('-998151031530761193');" style=""> 923              final int chunkSize = 1024;                                                                           </span>
<span class="4942461364046774481" onmouseenter="enter('4942461364046774481');" onmouseout="out('4942461364046774481');" style=""> 924              for (int offset = 0; offset &lt; encoded.length(); offset += chunkSize) {                                </span>
<span class="7644631075752865640" onmouseenter="enter('7644631075752865640');" onmouseout="out('7644631075752865640');" style=""> 925                  int end = offset + chunkSize;                                                                     </span>
<span class="-7525499051306958146" onmouseenter="enter('-7525499051306958146');" onmouseout="out('-7525499051306958146');" style=""> 926                  end = Math.min(end, encoded.length());                                                            </span>
<span class="-8734171954713192043" onmouseenter="enter('-8734171954713192043');" onmouseout="out('-8734171954713192043');" style=""> 927                  Log.d(TAG, &quot;wrote &quot; + encoded.substring(offset, end));                                            </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 928              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 929          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 930      }                                                                                                             </span>
<span  style=""> 931                                                                                                                    </span>
<span class="2702098317253578682" onmouseenter="enter('2702098317253578682');" onmouseout="out('2702098317253578682');" style=""> 932      private Set&lt;String&gt; getSavedIdsByType(int type, Journal in) {                                                 </span>
<span class="-49943749293500978" onmouseenter="enter('-49943749293500978');" onmouseout="out('-49943749293500978');" style=""> 933          Set&lt;String&gt; savedIds = new HashSet&lt;String&gt;();                                                             </span>
<span class="-7898804644582645533" onmouseenter="enter('-7898804644582645533');" onmouseout="out('-7898804644582645533');" style=""> 934          for(int i = 0; i &lt; in.key.length; i++) {                                                                  </span>
<span class="8349919170880076083" onmouseenter="enter('8349919170880076083');" onmouseout="out('8349919170880076083');" style=""> 935              Key key = in.key[i];                                                                                  </span>
<span class="-5995133320761897029" onmouseenter="enter('-5995133320761897029');" onmouseout="out('-5995133320761897029');" style=""> 936              if (key.type == type) {                                                                               </span>
<span class="3576075164739381606" onmouseenter="enter('3576075164739381606');" onmouseout="out('3576075164739381606');" style=""> 937                  savedIds.add(keyToBackupKey(key));                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939          }                                                                                                         </span>
<span class="-5348725939705536872" onmouseenter="enter('-5348725939705536872');" onmouseout="out('-5348725939705536872');" style=""> 940          return savedIds;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 941      }                                                                                                             </span>
<span  style=""> 942                                                                                                                    </span>
<span class="-695874875282614773" onmouseenter="enter('-695874875282614773');" onmouseout="out('-695874875282614773');" style=""> 943      private int removeDeletedKeysFromBackup(Set&lt;String&gt; deletedIds, BackupDataOutput data)                        </span>
<span class="-4962403076035840193" onmouseenter="enter('-4962403076035840193');" onmouseout="out('-4962403076035840193');" style=""> 944              throws IOException {                                                                                  </span>
<span class="-4851536707927267136" onmouseenter="enter('-4851536707927267136');" onmouseout="out('-4851536707927267136');" style=""> 945          int rows = 0;                                                                                             </span>
<span class="-713409252568618308" onmouseenter="enter('-713409252568618308');" onmouseout="out('-713409252568618308');" style=""> 946          for(String deleted: deletedIds) {                                                                         </span>
<span class="4732917519475294710" onmouseenter="enter('4732917519475294710');" onmouseout="out('4732917519475294710');" style=""> 947              Log.v(TAG, &quot;dropping icon &quot; + deleted);                                                               </span>

<span class="-8432491627426753858" onmouseenter="enter('-8432491627426753858');" onmouseout="out('-8432491627426753858');" style=""> 948              data.writeEntityHeader(deleted, -1);                                                                  </span>
<span class="3376167913476125145" onmouseenter="enter('3376167913476125145');" onmouseout="out('3376167913476125145');" style=""> 949              rows++;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 950          }                                                                                                         </span>
<span class="7304487908762689425" onmouseenter="enter('7304487908762689425');" onmouseout="out('7304487908762689425');" style=""> 951          return rows;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952      }                                                                                                             </span>
<span  style=""> 953                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 954      /**                                                                                                           </span>
<span class="2165651701463278711" onmouseenter="enter('2165651701463278711');" onmouseout="out('2165651701463278711');" style=""> 955       * Write the new journal to the output file.                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 956       *                                                                                                            </span>
<span class="1541711071301017459" onmouseenter="enter('1541711071301017459');" onmouseout="out('1541711071301017459');" style=""> 957       * In the event of any error, just pretend we didn&#x27;t have a journal,                                          </span>
<span class="1992507044161945978" onmouseenter="enter('1992507044161945978');" onmouseout="out('1992507044161945978');" style=""> 958       * in that case, do a full backup.                                                                            </span>
<span  style=""> 959                                                                                                                    </span>
<span class="979334713203114040" onmouseenter="enter('979334713203114040');" onmouseout="out('979334713203114040');" style=""> 960       * @param newState the write-only file descriptor pointing to the new journal                                 </span>
<span class="-8610280266224908377" onmouseenter="enter('-8610280266224908377');" onmouseout="out('-8610280266224908377');" style=""> 961       * @param journal a Journal protocol buffer                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 962       */                                                                                                           </span>
<span class="-1011822785874715562" onmouseenter="enter('-1011822785874715562');" onmouseout="out('-1011822785874715562');" style=""> 963      private void writeJournal(ParcelFileDescriptor newState, Journal journal) {                                   </span>
<span class="-2641734530670632371" onmouseenter="enter('-2641734530670632371');" onmouseout="out('-2641734530670632371');" style=""> 964          FileOutputStream outStream = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 965          try {                                                                                                     </span>
<span class="4680534042779865558" onmouseenter="enter('4680534042779865558');" onmouseout="out('4680534042779865558');" style=""> 966              outStream = new FileOutputStream(newState.getFileDescriptor());                                       </span>
<span class="4957080333838569527" onmouseenter="enter('4957080333838569527');" onmouseout="out('4957080333838569527');" style=""> 967              outStream.write(writeCheckedBytes(journal));                                                          </span>


<span class="7404708464258450772" onmouseenter="enter('7404708464258450772');" onmouseout="out('7404708464258450772');" style=""> 968              outStream.close();                                                                                    </span>

<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 969          } catch (IOException e) {                                                                                 </span>
<span class="578587342631886863" onmouseenter="enter('578587342631886863');" onmouseout="out('578587342631886863');" style=""> 970              Log.d(TAG, &quot;failed to write backup journal&quot;, e);                                                      </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 971          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972      }                                                                                                             </span>
<span  style=""> 973                                                                                                                    </span>
<span class="-712250415408101746" onmouseenter="enter('-712250415408101746');" onmouseout="out('-712250415408101746');" style=""> 974      /** Wrap a proto in a CheckedMessage and compute the checksum. */                                             </span>
<span class="5885453609536900277" onmouseenter="enter('5885453609536900277');" onmouseout="out('5885453609536900277');" style=""> 975      private byte[] writeCheckedBytes(MessageNano proto) {                                                         </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style=""> 976          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="5719367770164004009" onmouseenter="enter('5719367770164004009');" onmouseout="out('5719367770164004009');" style=""> 977          wrapper.payload = MessageNano.toByteArray(proto);                                                         </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 978          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style=""> 979          checksum.update(wrapper.payload);                                                                         </span>
<span class="4200115518812283960" onmouseenter="enter('4200115518812283960');" onmouseout="out('4200115518812283960');" style=""> 980          wrapper.checksum = checksum.getValue();                                                                   </span>
<span class="-900609195643944458" onmouseenter="enter('-900609195643944458');" onmouseout="out('-900609195643944458');" style=""> 981          return MessageNano.toByteArray(wrapper);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982      }                                                                                                             </span>
<span  style=""> 983                                                                                                                    </span>
<span class="4177574595118323549" onmouseenter="enter('4177574595118323549');" onmouseout="out('4177574595118323549');" style=""> 984      /** Unwrap a proto message from a CheckedMessage, verifying the checksum. */                                  </span>
<span class="-3297587107245109372" onmouseenter="enter('-3297587107245109372');" onmouseout="out('-3297587107245109372');" style=""> 985      private byte[] readCheckedBytes(byte[] buffer, int offset, int dataSize)                                      </span>

<span class="5260939869556948924" onmouseenter="enter('5260939869556948924');" onmouseout="out('5260939869556948924');" style=""> 986              throws InvalidProtocolBufferNanoException {                                                           </span>
<span class="-2406537276662470848" onmouseenter="enter('-2406537276662470848');" onmouseout="out('-2406537276662470848');" style=""> 987          CheckedMessage wrapper = new CheckedMessage();                                                            </span>
<span class="-3959921631204962332" onmouseenter="enter('-3959921631204962332');" onmouseout="out('-3959921631204962332');" style=""> 988          MessageNano.mergeFrom(wrapper, buffer, offset, dataSize);                                                 </span>
<span class="5788577135532716910" onmouseenter="enter('5788577135532716910');" onmouseout="out('5788577135532716910');" style=""> 989          CRC32 checksum = new CRC32();                                                                             </span>
<span class="3568583546896645980" onmouseenter="enter('3568583546896645980');" onmouseout="out('3568583546896645980');" style=""> 990          checksum.update(wrapper.payload);                                                                         </span>
<span class="7330684746883692251" onmouseenter="enter('7330684746883692251');" onmouseout="out('7330684746883692251');" style=""> 991          if (wrapper.checksum != checksum.getValue()) {                                                            </span>
<span class="-7156151083194523963" onmouseenter="enter('-7156151083194523963');" onmouseout="out('-7156151083194523963');" style=""> 992              throw new InvalidProtocolBufferNanoException(&quot;checksum does not match&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993          }                                                                                                         </span>
<span class="2264882861408718410" onmouseenter="enter('2264882861408718410');" onmouseout="out('2264882861408718410');" style=""> 994          return wrapper.payload;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 995      }                                                                                                             </span>
<span  style=""> 996                                                                                                                    </span>
<span class="-2761863734571968838" onmouseenter="enter('-2761863734571968838');" onmouseout="out('-2761863734571968838');" style=""> 997      private AppWidgetProviderInfo findAppWidgetProviderInfo(ComponentName component) {                            </span>
<span class="1218686878730143216" onmouseenter="enter('1218686878730143216');" onmouseout="out('1218686878730143216');" style=""> 998          if (mWidgetMap == null) {                                                                                 </span>
<span class="-6575430528437366773" onmouseenter="enter('-6575430528437366773');" onmouseout="out('-6575430528437366773');" style=""> 999              List&lt;AppWidgetProviderInfo&gt; widgets =                                                                 </span>
<span class="5934337403052217706" onmouseenter="enter('5934337403052217706');" onmouseout="out('5934337403052217706');" style="">1000                      AppWidgetManager.getInstance(mContext).getInstalledProviders();                               </span>
<span class="4510240989377033576" onmouseenter="enter('4510240989377033576');" onmouseout="out('4510240989377033576');" style="">1001              mWidgetMap = new HashMap&lt;ComponentName, AppWidgetProviderInfo&gt;(widgets.size());                       </span>
<span class="-8778466029712113419" onmouseenter="enter('-8778466029712113419');" onmouseout="out('-8778466029712113419');" style="">1002              for (AppWidgetProviderInfo info : widgets) {                                                          </span>
<span class="-5428251369250527747" onmouseenter="enter('-5428251369250527747');" onmouseout="out('-5428251369250527747');" style="">1003                  mWidgetMap.put(info.provider, info);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1004              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1005          }                                                                                                         </span>
<span class="894059594828681331" onmouseenter="enter('894059594828681331');" onmouseout="out('894059594828681331');" style="">1006          return mWidgetMap.get(component);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1007      }                                                                                                             </span>
<span  style="">1008                                                                                                                    </span>










































<span class="9065001176904994716" onmouseenter="enter('9065001176904994716');" onmouseout="out('9065001176904994716');" style="">1009      private class KeyParsingException extends Throwable {                                                         </span>
<span class="6514561846306478812" onmouseenter="enter('6514561846306478812');" onmouseout="out('6514561846306478812');" style="">1010          private KeyParsingException(Throwable cause) {                                                            </span>
<span class="4424378900858060258" onmouseenter="enter('4424378900858060258');" onmouseout="out('4424378900858060258');" style="">1011              super(cause);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1012          }                                                                                                         </span>
<span  style="">1013                                                                                                                    </span>
<span class="8465822963319034792" onmouseenter="enter('8465822963319034792');" onmouseout="out('8465822963319034792');" style="">1014          public KeyParsingException(String reason) {                                                               </span>
<span class="7236477588857596489" onmouseenter="enter('7236477588857596489');" onmouseout="out('7236477588857596489');" style="">1015              super(reason);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1016          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1018  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            