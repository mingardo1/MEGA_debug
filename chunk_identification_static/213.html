<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>213</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    213
                    <a href="212.html">prev</a>
                    <a href="214.html">next</a>
                    <a href="213_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_85784acfd63b348aa9271a84368432c2699a9d67_common/src/main/java/org/broadleafcommerce/common/util/UpdateExecutor.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;85784acfd63b348aa9271a84368432c2699a9d67:common/src/main/java/org/broadleafcommerce/common/util/UpdateExecutor.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;85784acfd63b348aa9271a84368432c2699a9d67^1:common/src/main/java/org/broadleafcommerce/common/util/UpdateExecutor.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;85784acfd63b348aa9271a84368432c2699a9d67^2:common/src/main/java/org/broadleafcommerce/common/util/UpdateExecutor.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;ce5c9279711e306f5901899835666ffa510d85bd:common/src/main/java/org/broadleafcommerce/common/util/UpdateExecutor.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-5217922944432466167" onmouseenter="enter('-5217922944432466167');" onmouseout="out('-5217922944432466167');" style="">  18 package org.broadleafcommerce.common.util;                                                               </span>
<span  style="">  19                                                                                                          </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  20 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5417513218856323097" onmouseenter="enter('5417513218856323097');" onmouseout="out('5417513218856323097');" style="">  22 import org.broadleafcommerce.common.util.dao.HibernateMappingProvider;                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  23 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  24 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1229446249209339952" onmouseenter="enter('-1229446249209339952');" onmouseout="out('-1229446249209339952');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.hibernate.SQLQuery;                                                                           </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.hibernate.Session;                                                                            </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.hibernate.cache.spi.UpdateTimestampsCache;                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  28 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29                                                                                                          </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1229446249209339952" onmouseenter="enter('-1229446249209339952');" onmouseout="out('-1229446249209339952');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import org.hibernate.SQLQuery;                                                                           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  32 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  33 import org.hibernate.Session;                                                                            </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="">  34 import org.hibernate.cache.spi.UpdateTimestampsCache;                                                    </span>
<span class="4259012918999807968" onmouseenter="enter('4259012918999807968');" onmouseout="out('4259012918999807968');" style="">  35 import org.hibernate.engine.spi.CacheImplementor;                                                        </span>
<span class="-2593392306196899585" onmouseenter="enter('-2593392306196899585');" onmouseout="out('-2593392306196899585');" style="">  36 import org.hibernate.engine.spi.SharedSessionContractImplementor;                                        </span>
<span class="3166107731338102505" onmouseenter="enter('3166107731338102505');" onmouseout="out('3166107731338102505');" style="">  37 import org.hibernate.mapping.PersistentClass;                                                            </span>
<span class="-4934021744345242646" onmouseenter="enter('-4934021744345242646');" onmouseout="out('-4934021744345242646');" style="">  38 import org.hibernate.query.NativeQuery;                                                                  </span>
<span class="-2033017758590111124" onmouseenter="enter('-2033017758590111124');" onmouseout="out('-2033017758590111124');" style="">  39 import org.hibernate.type.LongType;                                                                      </span>
<span class="-8880811180875514232" onmouseenter="enter('-8880811180875514232');" onmouseout="out('-8880811180875514232');" style="">  40 import org.hibernate.type.Type;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  42 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  43 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  44 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  45 import java.util.List;                                                                                   </span>
<span  style="">  46                                                                                                          </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  47 import javax.persistence.EntityManager;                                                                  </span>
<span  style="">  48                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49 /**                                                                                                      </span>
<span class="6348818120460103423" onmouseenter="enter('6348818120460103423');" onmouseout="out('6348818120460103423');" style=""><abbr title="  50  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on Hibernate filtered">  50  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updateðŸ”µ</abbr></span>
<span class="7748252354772592691" onmouseenter="enter('7748252354772592691');" onmouseout="out('7748252354772592691');" style="">  51  * entities (such as sandboxable and multi-tenant entities).                                             </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  52  * &lt;/p&gt;                                                                                                  </span>
<span class="4110890793834281526" onmouseenter="enter('4110890793834281526');" onmouseout="out('4110890793834281526');" style=""><abbr title="  53  * This class takes an interesting approach to the use of update queries. To explain, a bit of background is required.">  53  * This class takes an interesting approach to the use of update queries. To explain, a bit of backgroundðŸ”µ</abbr></span>
<span class="7963459504837668998" onmouseenter="enter('7963459504837668998');" onmouseout="out('7963459504837668998');" style=""><abbr title="  54  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs an HQL UPDATE">  54  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it eðŸ”µ</abbr></span>
<span class="-1517498419667072682" onmouseenter="enter('-1517498419667072682');" onmouseout="out('-1517498419667072682');" style=""><abbr title="  55  * query. However, it will only create this temporary table when the target entity has Hibernate filters applied">  55  * query. However, it will only create this temporary table when the target entity has Hibernate filters ðŸ”µ</abbr></span>
<span class="6382167101876958537" onmouseenter="enter('6382167101876958537');" onmouseout="out('6382167101876958537');" style=""><abbr title="  56  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is used to">  56  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectðŸ”µ</abbr></span>
<span class="-616516256780040632" onmouseenter="enter('-616516256780040632');" onmouseout="out('-616516256780040632');" style=""><abbr title="  57  * populate the values. It is my understanding that this ends up creating some locks on the original table. Because of">  57  * populate the values. It is my understanding that this ends up creating some locks on the original tablðŸ”µ</abbr></span>
<span class="-4853679335910197456" onmouseenter="enter('-4853679335910197456');" onmouseout="out('-4853679335910197456');" style=""><abbr title="  58  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to avoid">  58  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to ðŸ”µ</abbr></span>
<span class="2497248259790428100" onmouseenter="enter('2497248259790428100');" onmouseout="out('2497248259790428100');" style=""><abbr title="  59  * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) and then">  59  * the temporary table creation. We did this by first selecting for ids (so that the filters were still hðŸ”µ</abbr></span>
<span class="-9211087791255088286" onmouseenter="enter('-9211087791255088286');" onmouseout="out('-9211087791255088286');" style=""><abbr title="  60  * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needs to be basic">  60  * using a simple, native sql statement to execute the update on entities matching those ids. The native ðŸ”µ</abbr></span>
<span class="8121505566485274215" onmouseenter="enter('8121505566485274215');" onmouseout="out('8121505566485274215');" style="">  61  * enough that itâ€™s portable across platforms.                                                           </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  62  * &lt;/p&gt;                                                                                                  </span>
<span class="2727226016037947351" onmouseenter="enter('2727226016037947351');" onmouseout="out('2727226016037947351');" style=""><abbr title="  63  * This class is responsible for building the native sql based on a template String. It does it in a way using a standard">  63  * This class is responsible for building the native sql based on a template String. It does it in a way ðŸ”µ</abbr></span>
<span class="6964425517053300902" onmouseenter="enter('6964425517053300902');" onmouseout="out('6964425517053300902');" style=""><abbr title="  64  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection exploit.">  64  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection eðŸ”µ</abbr></span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  65  * &lt;/p&gt;                                                                                                  </span>
<span class="-6470360024527340695" onmouseenter="enter('-6470360024527340695');" onmouseout="out('-6470360024527340695');" style=""><abbr title="  66  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoid maximum">  66  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoidðŸ”µ</abbr></span>
<span class="6126176286040066001" onmouseenter="enter('6126176286040066001');" onmouseout="out('6126176286040066001');" style="">  67  * IN clause lengths enforced by some database platforms.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68  *                                                                                                       </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  69  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  70  */                                                                                                      </span>
<span class="-8243442400747008976" onmouseenter="enter('-8243442400747008976');" onmouseout="out('-8243442400747008976');" style="">  71 public class UpdateExecutor {                                                                            </span>
<span  style="">  72                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  73     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title="  74      * Perform an update query using a String template and params. Note, this is only intended for special">  74      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title="  75      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session">  75      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style="">  76      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  77      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title="  78      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;">  78      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  79      *                                                                                                   </span>
<span class="4830177201097172495" onmouseenter="enter('4830177201097172495');" onmouseout="out('4830177201097172495');" style=""><abbr title="  80      * @deprecated Highly recommended not to use this method. This method results in global L2 cache region clearing. Use {@link #executeUpdateQuery(EntityManager, String, String, Object[], Type[], List)} instead.">  80      * @deprecated Highly recommended not to use this method. This method results in global L2 cache regiðŸ”µ</abbr></span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style="">  81      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title="  82      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.">  82      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title="  83      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null.">  83      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title="  84      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null.">  84      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style="">  85      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style="">  86      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  88     @Deprecated                                                                                          </span>
<span class="-2067936805527519027" onmouseenter="enter('-2067936805527519027');" onmouseout="out('-2067936805527519027');" style=""><abbr title="  89     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;Long&gt; ids) {">  89     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] typesðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style="">  90         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style="">  91         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style="">  92         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style="">  93             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style="">  94             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style="">  95             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style="">  96             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style="">  97                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style="">  98                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  99                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 102             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style=""> 103                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 104                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style=""> 106             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style=""> 107             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 108             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 109                 response += query.executeUpdate();                                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 110             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 111                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 114         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115     }                                                                                                    </span>
<span  style=""> 116                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 117     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title=" 118      * Perform an update query using a String template and params. Note, this is only intended for special"> 118      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title=" 119      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session"> 119      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style=""> 120      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style=""> 121      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title=" 122      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;"> 122      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 123      *                                                                                                   </span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style=""> 124      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title=" 125      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;."> 125      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="-2587457453102939237" onmouseenter="enter('-2587457453102939237');" onmouseout="out('-2587457453102939237');" style=""><abbr title=" 126      * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate to limit the scope of cache region invalidation. Otherwise, if left null, Hibernate will invalidate every cache region, which is generally not desirable. An empty String can be used to signify that no region should be invalidated."> 126      * @param tableSpace optionally provide the table being impacted by this query. This value allows HibðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title=" 127      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null."> 127      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title=" 128      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null."> 128      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style=""> 129      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style=""> 130      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 131      */                                                                                                  </span>
<span class="-7793035550676407651" onmouseenter="enter('-7793035550676407651');" onmouseout="out('-7793035550676407651');" style=""><abbr title=" 132     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, Type[] types, List&lt;Long&gt; ids) {"> 132     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] pðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style=""> 133         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style=""> 134         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style=""> 135         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style=""> 136             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style=""> 137             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="7928558069525012126" onmouseenter="enter('7928558069525012126');" onmouseout="out('7928558069525012126');" style=""> 138             //only check for null - an empty string is a valid value for tableSpace                      </span>
<span class="8336124458572820409" onmouseenter="enter('8336124458572820409');" onmouseout="out('8336124458572820409');" style=""> 139             if (tableSpace != null) {                                                                    </span>
<span class="-4360288991647885741" onmouseenter="enter('-4360288991647885741');" onmouseout="out('-4360288991647885741');" style=""> 140                 query.addSynchronizedQuerySpace(tableSpace);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141             }                                                                                            </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style=""> 142             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style=""> 143             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style=""> 144                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style=""> 145                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 146                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 149             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style=""> 150                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 151                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style=""> 153             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style=""> 154             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 155             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 156                 response += query.executeUpdate();                                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 157             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 158                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 161         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 164     /**                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 165      *                                                                                                   </span>
<span class="8044709826139574523" onmouseenter="enter('8044709826139574523');" onmouseout="out('8044709826139574523');" style=""> 166      * @param em                                                                                         </span>
<span class="-7339043177630483847" onmouseenter="enter('-7339043177630483847');" onmouseout="out('-7339043177630483847');" style=""> 167      * @param entityType                                                                                 </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 168      * @param ids                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 169      */                                                                                                  </span>
<span class="8096024415648720799" onmouseenter="enter('8096024415648720799');" onmouseout="out('8096024415648720799');" style=""><abbr title=" 170     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt; ids) {"> 170     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="-7004563177377484509" onmouseenter="enter('-7004563177377484509');" onmouseout="out('-7004563177377484509');" style=""> 171         SharedSessionContractImplementor session = em.unwrap(SharedSessionContractImplementor.class);    </span>
<span class="-8832788949494089748" onmouseenter="enter('-8832788949494089748');" onmouseout="out('-8832788949494089748');" style=""> 172         CacheImplementor hibernateCache = session.getFactory().getCache();                               </span>
<span class="-5559971439404861126" onmouseenter="enter('-5559971439404861126');" onmouseout="out('-5559971439404861126');" style=""> 173         for (Long id : ids) {                                                                            </span>
<span class="-1832990067626754509" onmouseenter="enter('-1832990067626754509');" onmouseout="out('-1832990067626754509');" style=""> 174             hibernateCache.evictEntity(entityType, id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span class="-1266521526110704198" onmouseenter="enter('-1266521526110704198');" onmouseout="out('-1266521526110704198');" style=""> 176         //update the timestamp cache for the table so that queries will be refreshed                     </span>
<span class="4670505101952069734" onmouseenter="enter('4670505101952069734');" onmouseout="out('4670505101952069734');" style=""> 177         PersistentClass metadata = HibernateMappingProvider.getMapping(entityType.getName());            </span>
<span class="3066636713443405195" onmouseenter="enter('3066636713443405195');" onmouseout="out('3066636713443405195');" style=""> 178         String tableName = metadata.getTable().getName();                                                </span>
<span class="-534381177811522590" onmouseenter="enter('-534381177811522590');" onmouseout="out('-534381177811522590');" style=""> 179         UpdateTimestampsCache timestampsCache = hibernateCache.getUpdateTimestampsCache();               </span>
<span class="-2053542446089897358" onmouseenter="enter('-2053542446089897358');" onmouseout="out('-2053542446089897358');" style=""> 180         if (timestampsCache != null) {                                                                   </span>
<span class="-8604359847773131604" onmouseenter="enter('-8604359847773131604');" onmouseout="out('-8604359847773131604');" style=""> 181             timestampsCache.invalidate(new Serializable[]{tableName}, session);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 185     /**                                                                                                  </span>
<span class="-6417247131204683732" onmouseenter="enter('-6417247131204683732');" onmouseout="out('-6417247131204683732');" style=""> 186      * Quickly build up the sql IN clause template                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 187      *                                                                                                   </span>
<span class="-8158964965362665967" onmouseenter="enter('-8158964965362665967');" onmouseout="out('-8158964965362665967');" style=""> 188      * @param length                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 189      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 190      */                                                                                                  </span>
<span class="2777162083188540753" onmouseenter="enter('2777162083188540753');" onmouseout="out('2777162083188540753');" style=""> 191     private static String buildInClauseTemplate(int length) {                                            </span>
<span class="669871659996373325" onmouseenter="enter('669871659996373325');" onmouseout="out('669871659996373325');" style=""> 192         String[] temp = new String[length];                                                              </span>
<span class="6562605117254584647" onmouseenter="enter('6562605117254584647');" onmouseout="out('6562605117254584647');" style=""> 193         Arrays.fill(temp, &quot;?&quot;);                                                                          </span>
<span class="3467995464783580245" onmouseenter="enter('3467995464783580245');" onmouseout="out('3467995464783580245');" style=""> 194         return StringUtils.join(temp, &quot;,&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197     /**                                                                                                  </span>
<span class="-5651954882364109426" onmouseenter="enter('-5651954882364109426');" onmouseout="out('-5651954882364109426');" style=""> 198      * This breaks up our IN clause into multiple runs of 800 or less in order                           </span>
<span class="-942799509235420846" onmouseenter="enter('-942799509235420846');" onmouseout="out('-942799509235420846');" style=""><abbr title=" 199      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there are more"> 199      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there arðŸ”µ</abbr></span>
<span class="-2405511677083481020" onmouseenter="enter('-2405511677083481020');" onmouseout="out('-2405511677083481020');" style=""> 200      * than a 1000 entries in an sql IN clause).                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 201      *                                                                                                   </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 202      * @param ids                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 203      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 204      */                                                                                                  </span>
<span class="3595856459484845769" onmouseenter="enter('3595856459484845769');" onmouseout="out('3595856459484845769');" style=""> 205     private static List&lt;Long[]&gt; buildRuns(List&lt;Long&gt; ids) {                                              </span>
<span class="-5094500309704959115" onmouseenter="enter('-5094500309704959115');" onmouseout="out('-5094500309704959115');" style=""> 206         List&lt;Long[]&gt; runs = new ArrayList&lt;Long[]&gt;();                                                     </span>
<span class="1185518036691116005" onmouseenter="enter('1185518036691116005');" onmouseout="out('1185518036691116005');" style=""> 207         Long[] all = ids.toArray(new Long[ids.size()]);                                                  </span>
<span class="-8768161490919996337" onmouseenter="enter('-8768161490919996337');" onmouseout="out('-8768161490919996337');" style=""> 208         int test = all.length;                                                                           </span>
<span class="6892465824848000999" onmouseenter="enter('6892465824848000999');" onmouseout="out('6892465824848000999');" style=""> 209         int pos = 0;                                                                                     </span>
<span class="-4875040428911372888" onmouseenter="enter('-4875040428911372888');" onmouseout="out('-4875040428911372888');" style=""> 210         boolean eof = false;                                                                             </span>
<span class="-5429533219939196813" onmouseenter="enter('-5429533219939196813');" onmouseout="out('-5429533219939196813');" style=""> 211         while (!eof) {                                                                                   </span>
<span class="-7907705858393883561" onmouseenter="enter('-7907705858393883561');" onmouseout="out('-7907705858393883561');" style=""> 212             int arraySize;                                                                               </span>
<span class="633660195054425543" onmouseenter="enter('633660195054425543');" onmouseout="out('633660195054425543');" style=""> 213             if (test &lt; 800) {                                                                            </span>
<span class="-350597343612356769" onmouseenter="enter('-350597343612356769');" onmouseout="out('-350597343612356769');" style=""> 214                 arraySize = test;                                                                        </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 215                 eof = true;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 216             } else {                                                                                     </span>
<span class="5448284432563530090" onmouseenter="enter('5448284432563530090');" onmouseout="out('5448284432563530090');" style=""> 217                 arraySize = 800;                                                                         </span>
<span class="-723449570657995380" onmouseenter="enter('-723449570657995380');" onmouseout="out('-723449570657995380');" style=""> 218                 test -= arraySize;                                                                       </span>
<span class="-6202869398423757296" onmouseenter="enter('-6202869398423757296');" onmouseout="out('-6202869398423757296');" style=""> 219                 if (test == 0) {                                                                         </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 220                     eof = true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222             }                                                                                            </span>
<span class="-1339368917359302064" onmouseenter="enter('-1339368917359302064');" onmouseout="out('-1339368917359302064');" style=""> 223             Long[] temp = new Long[arraySize];                                                           </span>
<span class="5176312062593444984" onmouseenter="enter('5176312062593444984');" onmouseout="out('5176312062593444984');" style=""> 224             System.arraycopy(all, pos, temp, 0, arraySize);                                              </span>
<span class="-1194166410448610477" onmouseenter="enter('-1194166410448610477');" onmouseout="out('-1194166410448610477');" style=""> 225             pos += arraySize;                                                                            </span>
<span class="7099332349522936709" onmouseenter="enter('7099332349522936709');" onmouseout="out('7099332349522936709');" style=""> 226             runs.add(temp);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227         }                                                                                                </span>
<span class="7771754948541320748" onmouseenter="enter('7771754948541320748');" onmouseout="out('7771754948541320748');" style=""> 228         return runs;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-5217922944432466167" onmouseenter="enter('-5217922944432466167');" onmouseout="out('-5217922944432466167');" style="">  18 package org.broadleafcommerce.common.util;                                                               </span>
<span  style="">  19                                                                                                          </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  20 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5417513218856323097" onmouseenter="enter('5417513218856323097');" onmouseout="out('5417513218856323097');" style="">  22 import org.broadleafcommerce.common.util.dao.HibernateMappingProvider;                                   </span>
<span  style="">  23                                                                                                          </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  24 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  25 import org.hibernate.Session;                                                                            </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="">  26 import org.hibernate.cache.spi.UpdateTimestampsCache;                                                    </span>
<span class="4259012918999807968" onmouseenter="enter('4259012918999807968');" onmouseout="out('4259012918999807968');" style="">  27 import org.hibernate.engine.spi.CacheImplementor;                                                        </span>
<span class="-2593392306196899585" onmouseenter="enter('-2593392306196899585');" onmouseout="out('-2593392306196899585');" style="">  28 import org.hibernate.engine.spi.SharedSessionContractImplementor;                                        </span>
<span class="3166107731338102505" onmouseenter="enter('3166107731338102505');" onmouseout="out('3166107731338102505');" style="">  29 import org.hibernate.mapping.PersistentClass;                                                            </span>
<span class="-4934021744345242646" onmouseenter="enter('-4934021744345242646');" onmouseout="out('-4934021744345242646');" style="">  30 import org.hibernate.query.NativeQuery;                                                                  </span>
<span class="-2033017758590111124" onmouseenter="enter('-2033017758590111124');" onmouseout="out('-2033017758590111124');" style="">  31 import org.hibernate.type.LongType;                                                                      </span>
<span class="-8880811180875514232" onmouseenter="enter('-8880811180875514232');" onmouseout="out('-8880811180875514232');" style="">  32 import org.hibernate.type.Type;                                                                          </span>
<span  style="">  33                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  34 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  35 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  36 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  37 import java.util.List;                                                                                   </span>
<span  style="">  38                                                                                                          </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  39 import javax.persistence.EntityManager;                                                                  </span>
<span  style="">  40                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41 /**                                                                                                      </span>
<span class="6348818120460103423" onmouseenter="enter('6348818120460103423');" onmouseout="out('6348818120460103423');" style=""><abbr title="  42  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on Hibernate filtered">  42  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updateðŸ”µ</abbr></span>
<span class="7748252354772592691" onmouseenter="enter('7748252354772592691');" onmouseout="out('7748252354772592691');" style="">  43  * entities (such as sandboxable and multi-tenant entities).                                             </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  44  * &lt;/p&gt;                                                                                                  </span>
<span class="4110890793834281526" onmouseenter="enter('4110890793834281526');" onmouseout="out('4110890793834281526');" style=""><abbr title="  45  * This class takes an interesting approach to the use of update queries. To explain, a bit of background is required.">  45  * This class takes an interesting approach to the use of update queries. To explain, a bit of backgroundðŸ”µ</abbr></span>
<span class="7963459504837668998" onmouseenter="enter('7963459504837668998');" onmouseout="out('7963459504837668998');" style=""><abbr title="  46  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs an HQL UPDATE">  46  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it eðŸ”µ</abbr></span>
<span class="-1517498419667072682" onmouseenter="enter('-1517498419667072682');" onmouseout="out('-1517498419667072682');" style=""><abbr title="  47  * query. However, it will only create this temporary table when the target entity has Hibernate filters applied">  47  * query. However, it will only create this temporary table when the target entity has Hibernate filters ðŸ”µ</abbr></span>
<span class="6382167101876958537" onmouseenter="enter('6382167101876958537');" onmouseout="out('6382167101876958537');" style=""><abbr title="  48  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is used to">  48  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectðŸ”µ</abbr></span>
<span class="-616516256780040632" onmouseenter="enter('-616516256780040632');" onmouseout="out('-616516256780040632');" style=""><abbr title="  49  * populate the values. It is my understanding that this ends up creating some locks on the original table. Because of">  49  * populate the values. It is my understanding that this ends up creating some locks on the original tablðŸ”µ</abbr></span>
<span class="-4853679335910197456" onmouseenter="enter('-4853679335910197456');" onmouseout="out('-4853679335910197456');" style=""><abbr title="  50  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to avoid">  50  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to ðŸ”µ</abbr></span>
<span class="2497248259790428100" onmouseenter="enter('2497248259790428100');" onmouseout="out('2497248259790428100');" style=""><abbr title="  51  * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) and then">  51  * the temporary table creation. We did this by first selecting for ids (so that the filters were still hðŸ”µ</abbr></span>
<span class="-9211087791255088286" onmouseenter="enter('-9211087791255088286');" onmouseout="out('-9211087791255088286');" style=""><abbr title="  52  * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needs to be basic">  52  * using a simple, native sql statement to execute the update on entities matching those ids. The native ðŸ”µ</abbr></span>
<span class="8121505566485274215" onmouseenter="enter('8121505566485274215');" onmouseout="out('8121505566485274215');" style="">  53  * enough that itâ€™s portable across platforms.                                                           </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  54  * &lt;/p&gt;                                                                                                  </span>
<span class="2727226016037947351" onmouseenter="enter('2727226016037947351');" onmouseout="out('2727226016037947351');" style=""><abbr title="  55  * This class is responsible for building the native sql based on a template String. It does it in a way using a standard">  55  * This class is responsible for building the native sql based on a template String. It does it in a way ðŸ”µ</abbr></span>
<span class="6964425517053300902" onmouseenter="enter('6964425517053300902');" onmouseout="out('6964425517053300902');" style=""><abbr title="  56  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection exploit.">  56  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection eðŸ”µ</abbr></span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  57  * &lt;/p&gt;                                                                                                  </span>
<span class="-6470360024527340695" onmouseenter="enter('-6470360024527340695');" onmouseout="out('-6470360024527340695');" style=""><abbr title="  58  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoid maximum">  58  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoidðŸ”µ</abbr></span>
<span class="6126176286040066001" onmouseenter="enter('6126176286040066001');" onmouseout="out('6126176286040066001');" style="">  59  * IN clause lengths enforced by some database platforms.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  60  *                                                                                                       </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  61  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  62  */                                                                                                      </span>
<span class="-8243442400747008976" onmouseenter="enter('-8243442400747008976');" onmouseout="out('-8243442400747008976');" style="">  63 public class UpdateExecutor {                                                                            </span>
<span  style="">  64                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title="  66      * Perform an update query using a String template and params. Note, this is only intended for special">  66      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title="  67      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session">  67      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style="">  68      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  69      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title="  70      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;">  70      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  71      *                                                                                                   </span>
<span class="4830177201097172495" onmouseenter="enter('4830177201097172495');" onmouseout="out('4830177201097172495');" style=""><abbr title="  72      * @deprecated Highly recommended not to use this method. This method results in global L2 cache region clearing. Use {@link #executeUpdateQuery(EntityManager, String, String, Object[], Type[], List)} instead.">  72      * @deprecated Highly recommended not to use this method. This method results in global L2 cache regiðŸ”µ</abbr></span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style="">  73      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title="  74      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.">  74      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title="  75      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null.">  75      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title="  76      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null.">  76      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style="">  77      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style="">  78      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  79      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  80     @Deprecated                                                                                          </span>
<span class="-2067936805527519027" onmouseenter="enter('-2067936805527519027');" onmouseout="out('-2067936805527519027');" style=""><abbr title="  81     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;Long&gt; ids) {">  81     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] typesðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style="">  82         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style="">  83         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style="">  84         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style="">  85             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style="">  86             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style="">  87             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style="">  88             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style="">  89                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style="">  90                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  91                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style="">  94             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style="">  95                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  96                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style="">  98             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style="">  99             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 100             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 101             response += query.executeUpdate();                                                           </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 102             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 103                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 106         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 109     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title=" 110      * Perform an update query using a String template and params. Note, this is only intended for special"> 110      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title=" 111      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session"> 111      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style=""> 112      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style=""> 113      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title=" 114      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;"> 114      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 115      *                                                                                                   </span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style=""> 116      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title=" 117      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;."> 117      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="-2587457453102939237" onmouseenter="enter('-2587457453102939237');" onmouseout="out('-2587457453102939237');" style=""><abbr title=" 118      * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate to limit the scope of cache region invalidation. Otherwise, if left null, Hibernate will invalidate every cache region, which is generally not desirable. An empty String can be used to signify that no region should be invalidated."> 118      * @param tableSpace optionally provide the table being impacted by this query. This value allows HibðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title=" 119      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null."> 119      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title=" 120      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null."> 120      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style=""> 121      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style=""> 122      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 123      */                                                                                                  </span>
<span class="-7793035550676407651" onmouseenter="enter('-7793035550676407651');" onmouseout="out('-7793035550676407651');" style=""><abbr title=" 124     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, Type[] types, List&lt;Long&gt; ids) {"> 124     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] pðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style=""> 125         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style=""> 126         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style=""> 127         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style=""> 128             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style=""> 129             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="7928558069525012126" onmouseenter="enter('7928558069525012126');" onmouseout="out('7928558069525012126');" style=""> 130             //only check for null - an empty string is a valid value for tableSpace                      </span>
<span class="8336124458572820409" onmouseenter="enter('8336124458572820409');" onmouseout="out('8336124458572820409');" style=""> 131             if (tableSpace != null) {                                                                    </span>
<span class="-4360288991647885741" onmouseenter="enter('-4360288991647885741');" onmouseout="out('-4360288991647885741');" style=""> 132                 query.addSynchronizedQuerySpace(tableSpace);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133             }                                                                                            </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style=""> 134             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style=""> 135             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style=""> 136                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style=""> 137                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 138                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 141             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style=""> 142                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 143                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style=""> 145             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style=""> 146             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 147             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 148             response += query.executeUpdate();                                                           </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 149             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 150                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 153         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 156     /**                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 157      *                                                                                                   </span>
<span class="8044709826139574523" onmouseenter="enter('8044709826139574523');" onmouseout="out('8044709826139574523');" style=""> 158      * @param em                                                                                         </span>
<span class="-7339043177630483847" onmouseenter="enter('-7339043177630483847');" onmouseout="out('-7339043177630483847');" style=""> 159      * @param entityType                                                                                 </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 160      * @param ids                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 161      */                                                                                                  </span>
<span class="8096024415648720799" onmouseenter="enter('8096024415648720799');" onmouseout="out('8096024415648720799');" style=""><abbr title=" 162     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt; ids) {"> 162     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="-7004563177377484509" onmouseenter="enter('-7004563177377484509');" onmouseout="out('-7004563177377484509');" style=""> 163         SharedSessionContractImplementor session = em.unwrap(SharedSessionContractImplementor.class);    </span>
<span class="-8832788949494089748" onmouseenter="enter('-8832788949494089748');" onmouseout="out('-8832788949494089748');" style=""> 164         CacheImplementor hibernateCache = session.getFactory().getCache();                               </span>
<span class="-5559971439404861126" onmouseenter="enter('-5559971439404861126');" onmouseout="out('-5559971439404861126');" style=""> 165         for (Long id : ids) {                                                                            </span>
<span class="-1832990067626754509" onmouseenter="enter('-1832990067626754509');" onmouseout="out('-1832990067626754509');" style=""> 166             hibernateCache.evictEntity(entityType, id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span class="-1266521526110704198" onmouseenter="enter('-1266521526110704198');" onmouseout="out('-1266521526110704198');" style=""> 168         //update the timestamp cache for the table so that queries will be refreshed                     </span>
<span class="4670505101952069734" onmouseenter="enter('4670505101952069734');" onmouseout="out('4670505101952069734');" style=""> 169         PersistentClass metadata = HibernateMappingProvider.getMapping(entityType.getName());            </span>
<span class="3066636713443405195" onmouseenter="enter('3066636713443405195');" onmouseout="out('3066636713443405195');" style=""> 170         String tableName = metadata.getTable().getName();                                                </span>
<span class="-534381177811522590" onmouseenter="enter('-534381177811522590');" onmouseout="out('-534381177811522590');" style=""> 171         UpdateTimestampsCache timestampsCache = hibernateCache.getUpdateTimestampsCache();               </span>
<span class="-2053542446089897358" onmouseenter="enter('-2053542446089897358');" onmouseout="out('-2053542446089897358');" style=""> 172         if (timestampsCache != null) {                                                                   </span>
<span class="-8604359847773131604" onmouseenter="enter('-8604359847773131604');" onmouseout="out('-8604359847773131604');" style=""> 173             timestampsCache.invalidate(new Serializable[]{tableName}, session);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175     }                                                                                                    </span>
<span  style=""> 176                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 177     /**                                                                                                  </span>
<span class="-6417247131204683732" onmouseenter="enter('-6417247131204683732');" onmouseout="out('-6417247131204683732');" style=""> 178      * Quickly build up the sql IN clause template                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 179      *                                                                                                   </span>
<span class="-8158964965362665967" onmouseenter="enter('-8158964965362665967');" onmouseout="out('-8158964965362665967');" style=""> 180      * @param length                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 181      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 182      */                                                                                                  </span>
<span class="2777162083188540753" onmouseenter="enter('2777162083188540753');" onmouseout="out('2777162083188540753');" style=""> 183     private static String buildInClauseTemplate(int length) {                                            </span>
<span class="669871659996373325" onmouseenter="enter('669871659996373325');" onmouseout="out('669871659996373325');" style=""> 184         String[] temp = new String[length];                                                              </span>
<span class="6562605117254584647" onmouseenter="enter('6562605117254584647');" onmouseout="out('6562605117254584647');" style=""> 185         Arrays.fill(temp, &quot;?&quot;);                                                                          </span>
<span class="3467995464783580245" onmouseenter="enter('3467995464783580245');" onmouseout="out('3467995464783580245');" style=""> 186         return StringUtils.join(temp, &quot;,&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189     /**                                                                                                  </span>
<span class="-5651954882364109426" onmouseenter="enter('-5651954882364109426');" onmouseout="out('-5651954882364109426');" style=""> 190      * This breaks up our IN clause into multiple runs of 800 or less in order                           </span>
<span class="-942799509235420846" onmouseenter="enter('-942799509235420846');" onmouseout="out('-942799509235420846');" style=""><abbr title=" 191      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there are more"> 191      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there arðŸ”µ</abbr></span>
<span class="-2405511677083481020" onmouseenter="enter('-2405511677083481020');" onmouseout="out('-2405511677083481020');" style=""> 192      * than a 1000 entries in an sql IN clause).                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 193      *                                                                                                   </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 194      * @param ids                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 195      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 196      */                                                                                                  </span>
<span class="3595856459484845769" onmouseenter="enter('3595856459484845769');" onmouseout="out('3595856459484845769');" style=""> 197     private static List&lt;Long[]&gt; buildRuns(List&lt;Long&gt; ids) {                                              </span>
<span class="-5094500309704959115" onmouseenter="enter('-5094500309704959115');" onmouseout="out('-5094500309704959115');" style=""> 198         List&lt;Long[]&gt; runs = new ArrayList&lt;Long[]&gt;();                                                     </span>
<span class="1185518036691116005" onmouseenter="enter('1185518036691116005');" onmouseout="out('1185518036691116005');" style=""> 199         Long[] all = ids.toArray(new Long[ids.size()]);                                                  </span>
<span class="-8768161490919996337" onmouseenter="enter('-8768161490919996337');" onmouseout="out('-8768161490919996337');" style=""> 200         int test = all.length;                                                                           </span>
<span class="6892465824848000999" onmouseenter="enter('6892465824848000999');" onmouseout="out('6892465824848000999');" style=""> 201         int pos = 0;                                                                                     </span>
<span class="-4875040428911372888" onmouseenter="enter('-4875040428911372888');" onmouseout="out('-4875040428911372888');" style=""> 202         boolean eof = false;                                                                             </span>
<span class="-5429533219939196813" onmouseenter="enter('-5429533219939196813');" onmouseout="out('-5429533219939196813');" style=""> 203         while (!eof) {                                                                                   </span>
<span class="-7907705858393883561" onmouseenter="enter('-7907705858393883561');" onmouseout="out('-7907705858393883561');" style=""> 204             int arraySize;                                                                               </span>
<span class="633660195054425543" onmouseenter="enter('633660195054425543');" onmouseout="out('633660195054425543');" style=""> 205             if (test &lt; 800) {                                                                            </span>
<span class="-350597343612356769" onmouseenter="enter('-350597343612356769');" onmouseout="out('-350597343612356769');" style=""> 206                 arraySize = test;                                                                        </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 207                 eof = true;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 208             } else {                                                                                     </span>
<span class="5448284432563530090" onmouseenter="enter('5448284432563530090');" onmouseout="out('5448284432563530090');" style=""> 209                 arraySize = 800;                                                                         </span>
<span class="-723449570657995380" onmouseenter="enter('-723449570657995380');" onmouseout="out('-723449570657995380');" style=""> 210                 test -= arraySize;                                                                       </span>
<span class="-6202869398423757296" onmouseenter="enter('-6202869398423757296');" onmouseout="out('-6202869398423757296');" style=""> 211                 if (test == 0) {                                                                         </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 212                     eof = true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214             }                                                                                            </span>
<span class="-1339368917359302064" onmouseenter="enter('-1339368917359302064');" onmouseout="out('-1339368917359302064');" style=""> 215             Long[] temp = new Long[arraySize];                                                           </span>
<span class="5176312062593444984" onmouseenter="enter('5176312062593444984');" onmouseout="out('5176312062593444984');" style=""> 216             System.arraycopy(all, pos, temp, 0, arraySize);                                              </span>
<span class="-1194166410448610477" onmouseenter="enter('-1194166410448610477');" onmouseout="out('-1194166410448610477');" style=""> 217             pos += arraySize;                                                                            </span>
<span class="7099332349522936709" onmouseenter="enter('7099332349522936709');" onmouseout="out('7099332349522936709');" style=""> 218             runs.add(temp);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219         }                                                                                                </span>
<span class="7771754948541320748" onmouseenter="enter('7771754948541320748');" onmouseout="out('7771754948541320748');" style=""> 220         return runs;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222 }                                                                                                        </span>






</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3  * BroadleafCommerce Common Libraries                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-5217922944432466167" onmouseenter="enter('-5217922944432466167');" onmouseout="out('-5217922944432466167');" style="">  18 package org.broadleafcommerce.common.util;                                                               </span>
<span  style="">  19                                                                                                          </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  20 import java.io.Serializable;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  21 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  22 import java.util.Arrays;                                                                                 </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  23 import java.util.List;                                                                                   </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  24 import javax.persistence.EntityManager;                                                                  </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  25 import org.apache.commons.lang.ArrayUtils;                                                               </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="5417513218856323097" onmouseenter="enter('5417513218856323097');" onmouseout="out('5417513218856323097');" style="">  27 import org.broadleafcommerce.common.util.dao.HibernateMappingProvider;                                   </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  28 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  29 import org.hibernate.Session;                                                                            </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="">  30 import org.hibernate.cache.spi.UpdateTimestampsCache;                                                    </span>
<span class="4259012918999807968" onmouseenter="enter('4259012918999807968');" onmouseout="out('4259012918999807968');" style="">  31 import org.hibernate.engine.spi.CacheImplementor;                                                        </span>
<span class="-2593392306196899585" onmouseenter="enter('-2593392306196899585');" onmouseout="out('-2593392306196899585');" style="">  32 import org.hibernate.engine.spi.SharedSessionContractImplementor;                                        </span>
<span class="3166107731338102505" onmouseenter="enter('3166107731338102505');" onmouseout="out('3166107731338102505');" style="">  33 import org.hibernate.mapping.PersistentClass;                                                            </span>
<span class="-4934021744345242646" onmouseenter="enter('-4934021744345242646');" onmouseout="out('-4934021744345242646');" style="">  34 import org.hibernate.query.NativeQuery;                                                                  </span>
<span class="-2033017758590111124" onmouseenter="enter('-2033017758590111124');" onmouseout="out('-2033017758590111124');" style="">  35 import org.hibernate.type.LongType;                                                                      </span>
<span class="-8880811180875514232" onmouseenter="enter('-8880811180875514232');" onmouseout="out('-8880811180875514232');" style="">  36 import org.hibernate.type.Type;                                                                          </span>
<span  style="">  37                                                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  39 /**                                                                                                      </span>
<span class="6348818120460103423" onmouseenter="enter('6348818120460103423');" onmouseout="out('6348818120460103423');" style=""><abbr title="  40  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on Hibernate filtered">  40  * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updateðŸ”µ</abbr></span>
<span class="7748252354772592691" onmouseenter="enter('7748252354772592691');" onmouseout="out('7748252354772592691');" style="">  41  * entities (such as sandboxable and multi-tenant entities).                                             </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  42  * &lt;/p&gt;                                                                                                  </span>
<span class="4110890793834281526" onmouseenter="enter('4110890793834281526');" onmouseout="out('4110890793834281526');" style=""><abbr title="  43  * This class takes an interesting approach to the use of update queries. To explain, a bit of background is required.">  43  * This class takes an interesting approach to the use of update queries. To explain, a bit of backgroundðŸ”µ</abbr></span>
<span class="7963459504837668998" onmouseenter="enter('7963459504837668998');" onmouseout="out('7963459504837668998');" style=""><abbr title="  44  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs an HQL UPDATE">  44  * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it eðŸ”µ</abbr></span>
<span class="-1517498419667072682" onmouseenter="enter('-1517498419667072682');" onmouseout="out('-1517498419667072682');" style=""><abbr title="  45  * query. However, it will only create this temporary table when the target entity has Hibernate filters applied">  45  * query. However, it will only create this temporary table when the target entity has Hibernate filters ðŸ”µ</abbr></span>
<span class="6382167101876958537" onmouseenter="enter('6382167101876958537');" onmouseout="out('6382167101876958537');" style=""><abbr title="  46  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is used to">  46  * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectðŸ”µ</abbr></span>
<span class="-616516256780040632" onmouseenter="enter('-616516256780040632');" onmouseout="out('-616516256780040632');" style=""><abbr title="  47  * populate the values. It is my understanding that this ends up creating some locks on the original table. Because of">  47  * populate the values. It is my understanding that this ends up creating some locks on the original tablðŸ”µ</abbr></span>
<span class="-4853679335910197456" onmouseenter="enter('-4853679335910197456');" onmouseout="out('-4853679335910197456');" style=""><abbr title="  48  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to avoid">  48  * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to ðŸ”µ</abbr></span>
<span class="2497248259790428100" onmouseenter="enter('2497248259790428100');" onmouseout="out('2497248259790428100');" style=""><abbr title="  49  * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) and then">  49  * the temporary table creation. We did this by first selecting for ids (so that the filters were still hðŸ”µ</abbr></span>
<span class="-9211087791255088286" onmouseenter="enter('-9211087791255088286');" onmouseout="out('-9211087791255088286');" style=""><abbr title="  50  * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needs to be basic">  50  * using a simple, native sql statement to execute the update on entities matching those ids. The native ðŸ”µ</abbr></span>
<span class="8121505566485274215" onmouseenter="enter('8121505566485274215');" onmouseout="out('8121505566485274215');" style="">  51  * enough that itâ€™s portable across platforms.                                                           </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  52  * &lt;/p&gt;                                                                                                  </span>
<span class="2727226016037947351" onmouseenter="enter('2727226016037947351');" onmouseout="out('2727226016037947351');" style=""><abbr title="  53  * This class is responsible for building the native sql based on a template String. It does it in a way using a standard">  53  * This class is responsible for building the native sql based on a template String. It does it in a way ðŸ”µ</abbr></span>
<span class="6964425517053300902" onmouseenter="enter('6964425517053300902');" onmouseout="out('6964425517053300902');" style=""><abbr title="  54  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection exploit.">  54  * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection eðŸ”µ</abbr></span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  55  * &lt;/p&gt;                                                                                                  </span>
<span class="-6470360024527340695" onmouseenter="enter('-6470360024527340695');" onmouseout="out('-6470360024527340695');" style=""><abbr title="  56  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoid maximum">  56  * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoidðŸ”µ</abbr></span>
<span class="6126176286040066001" onmouseenter="enter('6126176286040066001');" onmouseout="out('6126176286040066001');" style="">  57  * IN clause lengths enforced by some database platforms.                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  58  *                                                                                                       </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  59  * @author Jeff Fischer                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60  */                                                                                                      </span>
<span class="-8243442400747008976" onmouseenter="enter('-8243442400747008976');" onmouseout="out('-8243442400747008976');" style="">  61 public class UpdateExecutor {                                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title="  63      * Perform an update query using a String template and params. Note, this is only intended for special">  63      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title="  64      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session">  64      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style="">  65      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  66      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title="  67      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;">  67      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68      *                                                                                                   </span>
<span class="4830177201097172495" onmouseenter="enter('4830177201097172495');" onmouseout="out('4830177201097172495');" style=""><abbr title="  69      * @deprecated Highly recommended not to use this method. This method results in global L2 cache region clearing. Use {@link #executeUpdateQuery(EntityManager, String, String, Object[], Type[], List)} instead.">  69      * @deprecated Highly recommended not to use this method. This method results in global L2 cache regiðŸ”µ</abbr></span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style="">  70      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title="  71      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.">  71      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title="  72      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null.">  72      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title="  73      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null.">  73      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style="">  74      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style="">  75      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  76      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  77     @Deprecated                                                                                          </span>
<span class="-2067936805527519027" onmouseenter="enter('-2067936805527519027');" onmouseout="out('-2067936805527519027');" style=""><abbr title="  78     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;Long&gt; ids) {">  78     public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] typesðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style="">  79         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style="">  80         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style="">  81         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style="">  82             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style="">  83             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style="">  84             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style="">  85             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style="">  86                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style="">  87                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  88                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style="">  91             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style="">  92                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  93                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style="">  95             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style="">  96             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  97             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style="">  98                 response += query.executeUpdate();                                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">  99             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 100                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 103         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104     }                                                                                                    </span>
<span  style=""> 105                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 106     /**                                                                                                  </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""><abbr title=" 107      * Perform an update query using a String template and params. Note, this is only intended for special"> 107      * Perform an update query using a String template and params. Note, this is only intended for speciaðŸ”µ</abbr></span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""><abbr title=" 108      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session"> 108      * usage with update queries that have an IN clause at the end. This implementation uses Hibernate SeðŸ”µ</abbr></span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style=""> 109      * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.</span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style=""> 110      * &lt;/p&gt;                                                                                              </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title=" 111      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;"> 111      * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 112      *                                                                                                   </span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style=""> 113      * @param em The entity manager to use for the persistence operation                                 </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""><abbr title=" 114      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;."> 114      * @param template the overall update sql template. The IN clause parameter should be written using &#x27;ðŸ”µ</abbr></span>
<span class="-2587457453102939237" onmouseenter="enter('-2587457453102939237');" onmouseout="out('-2587457453102939237');" style=""><abbr title=" 115      * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate to limit the scope of cache region invalidation. Otherwise, if left null, Hibernate will invalidate every cache region, which is generally not desirable. An empty String can be used to signify that no region should be invalidated."> 115      * @param tableSpace optionally provide the table being impacted by this query. This value allows HibðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title=" 116      * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null."> 116      * @param params any other params that are present in the sql template, other than the IN clause. ShoðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title=" 117      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null."> 117      * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params.ðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style=""> 118      * @param ids the ids to include in the IN clause.                                                   </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style=""> 119      * @return the total number of records updated in the database                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 120      */                                                                                                  </span>
<span class="-7793035550676407651" onmouseenter="enter('-7793035550676407651');" onmouseout="out('-7793035550676407651');" style=""><abbr title=" 121     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, Type[] types, List&lt;Long&gt; ids) {"> 121     public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] pðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style=""> 122         int response = 0;                                                                                </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style=""> 123         List&lt;Long[]&gt; runs = buildRuns(ids);                                                              </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style=""> 124         for (Long[] run : runs) {                                                                        </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style=""> 125             String queryString = String.format(template, buildInClauseTemplate(run.length));             </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style=""> 126             NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                 </span>
<span class="7928558069525012126" onmouseenter="enter('7928558069525012126');" onmouseout="out('7928558069525012126');" style=""> 127             //only check for null - an empty string is a valid value for tableSpace                      </span>
<span class="8336124458572820409" onmouseenter="enter('8336124458572820409');" onmouseout="out('8336124458572820409');" style=""> 128             if (tableSpace != null) {                                                                    </span>
<span class="-4360288991647885741" onmouseenter="enter('-4360288991647885741');" onmouseout="out('-4360288991647885741');" style=""> 129                 query.addSynchronizedQuerySpace(tableSpace);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130             }                                                                                            </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style=""> 131             int counter = 1;                                                                             </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style=""> 132             if (!ArrayUtils.isEmpty(params)) {                                                           </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style=""> 133                 for (Object param : params) {                                                            </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style=""> 134                     query.setParameter(counter, param, types[counter - 1]);                              </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 135                     counter++;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137             }                                                                                            </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 138             for (Long id : run) {                                                                        </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style=""> 139                 query.setParameter(counter, id, LongType.INSTANCE);                                      </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 140                 counter++;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141             }                                                                                            </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style=""> 142             FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                           </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style=""> 143             em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 144             try {                                                                                        </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 145                 response += query.executeUpdate();                                                       </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 146             } finally {                                                                                  </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style=""> 147                 em.unwrap(Session.class).setFlushMode(mode);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149         }                                                                                                </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 150         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151     }                                                                                                    </span>
<span  style=""> 152                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 153     /**                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 154      *                                                                                                   </span>
<span class="8044709826139574523" onmouseenter="enter('8044709826139574523');" onmouseout="out('8044709826139574523');" style=""> 155      * @param em                                                                                         </span>
<span class="-7339043177630483847" onmouseenter="enter('-7339043177630483847');" onmouseout="out('-7339043177630483847');" style=""> 156      * @param entityType                                                                                 </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 157      * @param ids                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 158      */                                                                                                  </span>
<span class="8096024415648720799" onmouseenter="enter('8096024415648720799');" onmouseout="out('8096024415648720799');" style=""><abbr title=" 159     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt; ids) {"> 159     public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt;ðŸ”µ</abbr></span>
<span class="-7004563177377484509" onmouseenter="enter('-7004563177377484509');" onmouseout="out('-7004563177377484509');" style=""> 160         SharedSessionContractImplementor session = em.unwrap(SharedSessionContractImplementor.class);    </span>
<span class="-8832788949494089748" onmouseenter="enter('-8832788949494089748');" onmouseout="out('-8832788949494089748');" style=""> 161         CacheImplementor hibernateCache = session.getFactory().getCache();                               </span>
<span class="-5559971439404861126" onmouseenter="enter('-5559971439404861126');" onmouseout="out('-5559971439404861126');" style=""> 162         for (Long id : ids) {                                                                            </span>
<span class="-1832990067626754509" onmouseenter="enter('-1832990067626754509');" onmouseout="out('-1832990067626754509');" style=""> 163             hibernateCache.evictEntity(entityType, id);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span class="-1266521526110704198" onmouseenter="enter('-1266521526110704198');" onmouseout="out('-1266521526110704198');" style=""> 165         //update the timestamp cache for the table so that queries will be refreshed                     </span>
<span class="4670505101952069734" onmouseenter="enter('4670505101952069734');" onmouseout="out('4670505101952069734');" style=""> 166         PersistentClass metadata = HibernateMappingProvider.getMapping(entityType.getName());            </span>
<span class="3066636713443405195" onmouseenter="enter('3066636713443405195');" onmouseout="out('3066636713443405195');" style=""> 167         String tableName = metadata.getTable().getName();                                                </span>
<span class="-534381177811522590" onmouseenter="enter('-534381177811522590');" onmouseout="out('-534381177811522590');" style=""> 168         UpdateTimestampsCache timestampsCache = hibernateCache.getUpdateTimestampsCache();               </span>
<span class="-2053542446089897358" onmouseenter="enter('-2053542446089897358');" onmouseout="out('-2053542446089897358');" style=""> 169         if (timestampsCache != null) {                                                                   </span>
<span class="-8604359847773131604" onmouseenter="enter('-8604359847773131604');" onmouseout="out('-8604359847773131604');" style=""> 170             timestampsCache.invalidate(new Serializable[]{tableName}, session);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172     }                                                                                                    </span>
<span  style=""> 173                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 174     /**                                                                                                  </span>
<span class="-6417247131204683732" onmouseenter="enter('-6417247131204683732');" onmouseout="out('-6417247131204683732');" style=""> 175      * Quickly build up the sql IN clause template                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 176      *                                                                                                   </span>
<span class="-8158964965362665967" onmouseenter="enter('-8158964965362665967');" onmouseout="out('-8158964965362665967');" style=""> 177      * @param length                                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 178      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 179      */                                                                                                  </span>
<span class="2777162083188540753" onmouseenter="enter('2777162083188540753');" onmouseout="out('2777162083188540753');" style=""> 180     private static String buildInClauseTemplate(int length) {                                            </span>
<span class="669871659996373325" onmouseenter="enter('669871659996373325');" onmouseout="out('669871659996373325');" style=""> 181         String[] temp = new String[length];                                                              </span>
<span class="6562605117254584647" onmouseenter="enter('6562605117254584647');" onmouseout="out('6562605117254584647');" style=""> 182         Arrays.fill(temp, &quot;?&quot;);                                                                          </span>
<span class="3467995464783580245" onmouseenter="enter('3467995464783580245');" onmouseout="out('3467995464783580245');" style=""> 183         return StringUtils.join(temp, &quot;,&quot;);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184     }                                                                                                    </span>
<span  style=""> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 186     /**                                                                                                  </span>
<span class="-5651954882364109426" onmouseenter="enter('-5651954882364109426');" onmouseout="out('-5651954882364109426');" style=""> 187      * This breaks up our IN clause into multiple runs of 800 or less in order                           </span>
<span class="-942799509235420846" onmouseenter="enter('-942799509235420846');" onmouseout="out('-942799509235420846');" style=""><abbr title=" 188      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there are more"> 188      * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there arðŸ”µ</abbr></span>
<span class="-2405511677083481020" onmouseenter="enter('-2405511677083481020');" onmouseout="out('-2405511677083481020');" style=""> 189      * than a 1000 entries in an sql IN clause).                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 190      *                                                                                                   </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 191      * @param ids                                                                                        </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 192      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 193      */                                                                                                  </span>
<span class="3595856459484845769" onmouseenter="enter('3595856459484845769');" onmouseout="out('3595856459484845769');" style=""> 194     private static List&lt;Long[]&gt; buildRuns(List&lt;Long&gt; ids) {                                              </span>
<span class="-5094500309704959115" onmouseenter="enter('-5094500309704959115');" onmouseout="out('-5094500309704959115');" style=""> 195         List&lt;Long[]&gt; runs = new ArrayList&lt;Long[]&gt;();                                                     </span>
<span class="1185518036691116005" onmouseenter="enter('1185518036691116005');" onmouseout="out('1185518036691116005');" style=""> 196         Long[] all = ids.toArray(new Long[ids.size()]);                                                  </span>
<span class="-8768161490919996337" onmouseenter="enter('-8768161490919996337');" onmouseout="out('-8768161490919996337');" style=""> 197         int test = all.length;                                                                           </span>
<span class="6892465824848000999" onmouseenter="enter('6892465824848000999');" onmouseout="out('6892465824848000999');" style=""> 198         int pos = 0;                                                                                     </span>
<span class="-4875040428911372888" onmouseenter="enter('-4875040428911372888');" onmouseout="out('-4875040428911372888');" style=""> 199         boolean eof = false;                                                                             </span>
<span class="-5429533219939196813" onmouseenter="enter('-5429533219939196813');" onmouseout="out('-5429533219939196813');" style=""> 200         while (!eof) {                                                                                   </span>
<span class="-7907705858393883561" onmouseenter="enter('-7907705858393883561');" onmouseout="out('-7907705858393883561');" style=""> 201             int arraySize;                                                                               </span>
<span class="633660195054425543" onmouseenter="enter('633660195054425543');" onmouseout="out('633660195054425543');" style=""> 202             if (test &lt; 800) {                                                                            </span>
<span class="-350597343612356769" onmouseenter="enter('-350597343612356769');" onmouseout="out('-350597343612356769');" style=""> 203                 arraySize = test;                                                                        </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 204                 eof = true;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 205             } else {                                                                                     </span>
<span class="5448284432563530090" onmouseenter="enter('5448284432563530090');" onmouseout="out('5448284432563530090');" style=""> 206                 arraySize = 800;                                                                         </span>
<span class="-723449570657995380" onmouseenter="enter('-723449570657995380');" onmouseout="out('-723449570657995380');" style=""> 207                 test -= arraySize;                                                                       </span>
<span class="-6202869398423757296" onmouseenter="enter('-6202869398423757296');" onmouseout="out('-6202869398423757296');" style=""> 208                 if (test == 0) {                                                                         </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 209                     eof = true;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211             }                                                                                            </span>
<span class="-1339368917359302064" onmouseenter="enter('-1339368917359302064');" onmouseout="out('-1339368917359302064');" style=""> 212             Long[] temp = new Long[arraySize];                                                           </span>
<span class="5176312062593444984" onmouseenter="enter('5176312062593444984');" onmouseout="out('5176312062593444984');" style=""> 213             System.arraycopy(all, pos, temp, 0, arraySize);                                              </span>
<span class="-1194166410448610477" onmouseenter="enter('-1194166410448610477');" onmouseout="out('-1194166410448610477');" style=""> 214             pos += arraySize;                                                                            </span>
<span class="7099332349522936709" onmouseenter="enter('7099332349522936709');" onmouseout="out('7099332349522936709');" style=""> 215             runs.add(temp);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216         }                                                                                                </span>
<span class="7771754948541320748" onmouseenter="enter('7771754948541320748');" onmouseout="out('7771754948541320748');" style=""> 217         return runs;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219 }                                                                                                        </span>









</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3   * BroadleafCommerce Common Libraries                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-5217922944432466167" onmouseenter="enter('-5217922944432466167');" onmouseout="out('-5217922944432466167');" style="">  18  package org.broadleafcommerce.common.util;                                                                        </span>
<span  style="">  19                                                                                                                    </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  20  import org.apache.commons.lang.ArrayUtils;                                                                        </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="5417513218856323097" onmouseenter="enter('5417513218856323097');" onmouseout="out('5417513218856323097');" style="">  22  import org.broadleafcommerce.common.util.dao.HibernateMappingProvider;                                            </span>


<span class="-1229446249209339952" onmouseenter="enter('-1229446249209339952');" onmouseout="out('-1229446249209339952');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.hibernate.SQLQuery;                                                                                    </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  24  import org.hibernate.Session;                                                                                     </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="">  25  import org.hibernate.cache.spi.UpdateTimestampsCache;                                                             </span>
<span class="4259012918999807968" onmouseenter="enter('4259012918999807968');" onmouseout="out('4259012918999807968');" style="">  26  import org.hibernate.engine.spi.CacheImplementor;                                                                 </span>
<span class="-2593392306196899585" onmouseenter="enter('-2593392306196899585');" onmouseout="out('-2593392306196899585');" style="">  27  import org.hibernate.engine.spi.SharedSessionContractImplementor;                                                 </span>
<span class="3166107731338102505" onmouseenter="enter('3166107731338102505');" onmouseout="out('3166107731338102505');" style="">  28  import org.hibernate.mapping.PersistentClass;                                                                     </span>
<span class="-4934021744345242646" onmouseenter="enter('-4934021744345242646');" onmouseout="out('-4934021744345242646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.hibernate.query.NativeQuery;                                                                           </span>
<span class="-2033017758590111124" onmouseenter="enter('-2033017758590111124');" onmouseout="out('-2033017758590111124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import org.hibernate.type.LongType;                                                                               </span>
<span class="-8880811180875514232" onmouseenter="enter('-8880811180875514232');" onmouseout="out('-8880811180875514232');" style="">  31  import org.hibernate.type.Type;                                                                                   </span>
<span  style="">  32                                                                                                                    </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  33  import java.io.Serializable;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  34  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  35  import java.util.Arrays;                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  36  import java.util.List;                                                                                            </span>
<span  style="">  37                                                                                                                    </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  38  import javax.persistence.EntityManager;                                                                           </span>
<span  style="">  39                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  40  /**                                                                                                               </span>
<span class="6348818120460103423" onmouseenter="enter('6348818120460103423');" onmouseout="out('6348818120460103423');" style=""><abbr title="  41   * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on Hibernate filtered">  41   * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on HibeðŸ”µ</abbr></span>
<span class="7748252354772592691" onmouseenter="enter('7748252354772592691');" onmouseout="out('7748252354772592691');" style="">  42   * entities (such as sandboxable and multi-tenant entities).                                                      </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  43   * &lt;/p&gt;                                                                                                           </span>
<span class="4110890793834281526" onmouseenter="enter('4110890793834281526');" onmouseout="out('4110890793834281526');" style=""><abbr title="  44   * This class takes an interesting approach to the use of update queries. To explain, a bit of background is required.">  44   * This class takes an interesting approach to the use of update queries. To explain, a bit of background is requiðŸ”µ</abbr></span>
<span class="7963459504837668998" onmouseenter="enter('7963459504837668998');" onmouseout="out('7963459504837668998');" style=""><abbr title="  45   * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs an HQL UPDATE">  45   * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs anðŸ”µ</abbr></span>
<span class="-1517498419667072682" onmouseenter="enter('-1517498419667072682');" onmouseout="out('-1517498419667072682');" style="">  46   * query. However, it will only create this temporary table when the target entity has Hibernate filters applied  </span>
<span class="6382167101876958537" onmouseenter="enter('6382167101876958537');" onmouseout="out('6382167101876958537');" style=""><abbr title="  47   * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is used to">  47   * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is usedðŸ”µ</abbr></span>
<span class="-616516256780040632" onmouseenter="enter('-616516256780040632');" onmouseout="out('-616516256780040632');" style=""><abbr title="  48   * populate the values. It is my understanding that this ends up creating some locks on the original table. Because of">  48   * populate the values. It is my understanding that this ends up creating some locks on the original table. BecausðŸ”µ</abbr></span>
<span class="-4853679335910197456" onmouseenter="enter('-4853679335910197456');" onmouseout="out('-4853679335910197456');" style="">  49   * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to avoid    </span>
<span class="2497248259790428100" onmouseenter="enter('2497248259790428100');" onmouseout="out('2497248259790428100');" style=""><abbr title="  50   * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) and then">  50   * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) aðŸ”µ</abbr></span>
<span class="-9211087791255088286" onmouseenter="enter('-9211087791255088286');" onmouseout="out('-9211087791255088286');" style=""><abbr title="  51   * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needs to be basic">  51   * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needsðŸ”µ</abbr></span>
<span class="8121505566485274215" onmouseenter="enter('8121505566485274215');" onmouseout="out('8121505566485274215');" style="">  52   * enough that itâ€™s portable across platforms.                                                                    </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  53   * &lt;/p&gt;                                                                                                           </span>
<span class="2727226016037947351" onmouseenter="enter('2727226016037947351');" onmouseout="out('2727226016037947351');" style=""><abbr title="  54   * This class is responsible for building the native sql based on a template String. It does it in a way using a standard">  54   * This class is responsible for building the native sql based on a template String. It does it in a way using a sðŸ”µ</abbr></span>
<span class="6964425517053300902" onmouseenter="enter('6964425517053300902');" onmouseout="out('6964425517053300902');" style="">  55   * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection exploit.  </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  56   * &lt;/p&gt;                                                                                                           </span>
<span class="-6470360024527340695" onmouseenter="enter('-6470360024527340695');" onmouseout="out('-6470360024527340695');" style="">  57   * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoid maximum </span>
<span class="6126176286040066001" onmouseenter="enter('6126176286040066001');" onmouseout="out('6126176286040066001');" style="">  58   * IN clause lengths enforced by some database platforms.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  59   *                                                                                                                </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  60   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61   */                                                                                                               </span>
<span class="-8243442400747008976" onmouseenter="enter('-8243442400747008976');" onmouseout="out('-8243442400747008976');" style="">  62  public class UpdateExecutor {                                                                                     </span>
<span  style="">  63                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  64      /**                                                                                                           </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style="">  65       * Perform an update query using a String template and params. Note, this is only intended for special        </span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style="">  66       * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session    </span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style="">  67       * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.         </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  68       * &lt;/p&gt;                                                                                                       </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title="  69       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;">  69       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70       *                                                                                                            </span>
<span class="4830177201097172495" onmouseenter="enter('4830177201097172495');" onmouseout="out('4830177201097172495');" style=""><abbr title="  71       * @deprecated Highly recommended not to use this method. This method results in global L2 cache region clearing. Use {@link #executeUpdateQuery(EntityManager, String, String, Object[], Type[], List)} instead.">  71       * @deprecated Highly recommended not to use this method. This method results in global L2 cache region cleariðŸ”µ</abbr></span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style="">  72       * @param em The entity manager to use for the persistence operation                                          </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style="">  73       * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.</span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title="  74       * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null.">  74       * @param params any other params that are present in the sql template, other than the IN clause. Should be wrðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title="  75       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null.">  75       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should bðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style="">  76       * @param ids the ids to include in the IN clause.                                                            </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style="">  77       * @return the total number of records updated in the database                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  78       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  79      @Deprecated                                                                                                   </span>
<span class="-2067936805527519027" onmouseenter="enter('-2067936805527519027');" onmouseout="out('-2067936805527519027');" style=""><abbr title="  80      public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;Long&gt; ids) {">  80      public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;LoðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style="">  81          int response = 0;                                                                                         </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style="">  82          List&lt;Long[]&gt; runs = buildRuns(ids);                                                                       </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style="">  83          for (Long[] run : runs) {                                                                                 </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style="">  84              String queryString = String.format(template, buildInClauseTemplate(run.length));                      </span>
<span class="2667466989905057170" onmouseenter="enter('2667466989905057170');" onmouseout="out('2667466989905057170');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -            SQLQuery query = em.unwrap(Session.class).createSQLQuery(queryString);                                </span>
<span class="-28710712224986892" onmouseenter="enter('-28710712224986892');" onmouseout="out('-28710712224986892');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -            int counter = 0;                                                                                      </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +            NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                          </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +            int counter = 1;                                                                                      </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style="">  89              if (!ArrayUtils.isEmpty(params)) {                                                                    </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style="">  90                  for (Object param : params) {                                                                     </span>
<span class="4087918591244595483" onmouseenter="enter('4087918591244595483');" onmouseout="out('4087918591244595483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -                    query.setParameter(counter, param, types[counter]);                                           </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +                    query.setParameter(counter, param, types[counter - 1]);                                       </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  93                      counter++;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95              }                                                                                                     </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style="">  96              for (Long id : run) {                                                                                 </span>
<span class="-450681512314493849" onmouseenter="enter('-450681512314493849');" onmouseout="out('-450681512314493849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -                query.setLong(counter, id);                                                                       </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                query.setParameter(counter, id, LongType.INSTANCE);                                               </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  99                  counter++;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100              }                                                                                                     </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 101              response += query.executeUpdate();                                                                    </span>







<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 103          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span  style=""> 105                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 106      /**                                                                                                           </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""> 107       * Perform an update query using a String template and params. Note, this is only intended for special        </span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""> 108       * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session    </span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style=""> 109       * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.         </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style=""> 110       * &lt;/p&gt;                                                                                                       </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title=" 111       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;"> 111       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 112       *                                                                                                            </span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style=""> 113       * @param em The entity manager to use for the persistence operation                                          </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""> 114       * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.</span>
<span class="-2587457453102939237" onmouseenter="enter('-2587457453102939237');" onmouseout="out('-2587457453102939237');" style=""><abbr title=" 115       * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate to limit the scope of cache region invalidation. Otherwise, if left null, Hibernate will invalidate every cache region, which is generally not desirable. An empty String can be used to signify that no region should be invalidated."> 115       * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate toðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title=" 116       * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null."> 116       * @param params any other params that are present in the sql template, other than the IN clause. Should be wrðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title=" 117       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null."> 117       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should bðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style=""> 118       * @param ids the ids to include in the IN clause.                                                            </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style=""> 119       * @return the total number of records updated in the database                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 120       */                                                                                                           </span>
<span class="-7793035550676407651" onmouseenter="enter('-7793035550676407651');" onmouseout="out('-7793035550676407651');" style=""><abbr title=" 121      public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, Type[] types, List&lt;Long&gt; ids) {"> 121      public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, TyðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style=""> 122          int response = 0;                                                                                         </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style=""> 123          List&lt;Long[]&gt; runs = buildRuns(ids);                                                                       </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style=""> 124          for (Long[] run : runs) {                                                                                 </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style=""> 125              String queryString = String.format(template, buildInClauseTemplate(run.length));                      </span>
<span class="2667466989905057170" onmouseenter="enter('2667466989905057170');" onmouseout="out('2667466989905057170');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -            SQLQuery query = em.unwrap(Session.class).createSQLQuery(queryString);                                </span>
<span class="2324489982914930315" onmouseenter="enter('2324489982914930315');" onmouseout="out('2324489982914930315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            NativeQuery&lt;?&gt; query = em.unwrap(Session.class).createSQLQuery(queryString);                          </span>
<span class="7928558069525012126" onmouseenter="enter('7928558069525012126');" onmouseout="out('7928558069525012126');" style=""> 128              //only check for null - an empty string is a valid value for tableSpace                               </span>
<span class="8336124458572820409" onmouseenter="enter('8336124458572820409');" onmouseout="out('8336124458572820409');" style=""> 129              if (tableSpace != null) {                                                                             </span>
<span class="-4360288991647885741" onmouseenter="enter('-4360288991647885741');" onmouseout="out('-4360288991647885741');" style=""> 130                  query.addSynchronizedQuerySpace(tableSpace);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131              }                                                                                                     </span>
<span class="-28710712224986892" onmouseenter="enter('-28710712224986892');" onmouseout="out('-28710712224986892');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -            int counter = 0;                                                                                      </span>
<span class="804243584285746176" onmouseenter="enter('804243584285746176');" onmouseout="out('804243584285746176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +            int counter = 1;                                                                                      </span>
<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style=""> 134              if (!ArrayUtils.isEmpty(params)) {                                                                    </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style=""> 135                  for (Object param : params) {                                                                     </span>
<span class="4087918591244595483" onmouseenter="enter('4087918591244595483');" onmouseout="out('4087918591244595483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -                    query.setParameter(counter, param, types[counter]);                                           </span>
<span class="-2491868897432261913" onmouseenter="enter('-2491868897432261913');" onmouseout="out('-2491868897432261913');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +                    query.setParameter(counter, param, types[counter - 1]);                                       </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 138                      counter++;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140              }                                                                                                     </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 141              for (Long id : run) {                                                                                 </span>
<span class="-450681512314493849" onmouseenter="enter('-450681512314493849');" onmouseout="out('-450681512314493849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                query.setLong(counter, id);                                                                       </span>
<span class="-4233527285980861565" onmouseenter="enter('-4233527285980861565');" onmouseout="out('-4233527285980861565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                query.setParameter(counter, id, LongType.INSTANCE);                                               </span>
<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 144                  counter++;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145              }                                                                                                     </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style=""> 146              response += query.executeUpdate();                                                                    </span>







<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 148          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149      }                                                                                                             </span>
<span  style=""> 150                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 151      /**                                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 152       *                                                                                                            </span>
<span class="8044709826139574523" onmouseenter="enter('8044709826139574523');" onmouseout="out('8044709826139574523');" style=""> 153       * @param em                                                                                                  </span>
<span class="-7339043177630483847" onmouseenter="enter('-7339043177630483847');" onmouseout="out('-7339043177630483847');" style=""> 154       * @param entityType                                                                                          </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 155       * @param ids                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 156       */                                                                                                           </span>
<span class="8096024415648720799" onmouseenter="enter('8096024415648720799');" onmouseout="out('8096024415648720799');" style=""> 157      public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt; ids) {  </span>
<span class="-7004563177377484509" onmouseenter="enter('-7004563177377484509');" onmouseout="out('-7004563177377484509');" style=""> 158          SharedSessionContractImplementor session = em.unwrap(SharedSessionContractImplementor.class);             </span>
<span class="-8832788949494089748" onmouseenter="enter('-8832788949494089748');" onmouseout="out('-8832788949494089748');" style=""> 159          CacheImplementor hibernateCache = session.getFactory().getCache();                                        </span>
<span class="-5559971439404861126" onmouseenter="enter('-5559971439404861126');" onmouseout="out('-5559971439404861126');" style=""> 160          for (Long id : ids) {                                                                                     </span>
<span class="-1832990067626754509" onmouseenter="enter('-1832990067626754509');" onmouseout="out('-1832990067626754509');" style=""> 161              hibernateCache.evictEntity(entityType, id);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span class="-1266521526110704198" onmouseenter="enter('-1266521526110704198');" onmouseout="out('-1266521526110704198');" style=""> 163          //update the timestamp cache for the table so that queries will be refreshed                              </span>
<span class="4670505101952069734" onmouseenter="enter('4670505101952069734');" onmouseout="out('4670505101952069734');" style=""> 164          PersistentClass metadata = HibernateMappingProvider.getMapping(entityType.getName());                     </span>
<span class="3066636713443405195" onmouseenter="enter('3066636713443405195');" onmouseout="out('3066636713443405195');" style=""> 165          String tableName = metadata.getTable().getName();                                                         </span>
<span class="-534381177811522590" onmouseenter="enter('-534381177811522590');" onmouseout="out('-534381177811522590');" style=""> 166          UpdateTimestampsCache timestampsCache = hibernateCache.getUpdateTimestampsCache();                        </span>
<span class="-2053542446089897358" onmouseenter="enter('-2053542446089897358');" onmouseout="out('-2053542446089897358');" style=""> 167          if (timestampsCache != null) {                                                                            </span>
<span class="-8604359847773131604" onmouseenter="enter('-8604359847773131604');" onmouseout="out('-8604359847773131604');" style=""> 168              timestampsCache.invalidate(new Serializable[]{tableName}, session);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 172      /**                                                                                                           </span>
<span class="-6417247131204683732" onmouseenter="enter('-6417247131204683732');" onmouseout="out('-6417247131204683732');" style=""> 173       * Quickly build up the sql IN clause template                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 174       *                                                                                                            </span>
<span class="-8158964965362665967" onmouseenter="enter('-8158964965362665967');" onmouseout="out('-8158964965362665967');" style=""> 175       * @param length                                                                                              </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 176       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 177       */                                                                                                           </span>
<span class="2777162083188540753" onmouseenter="enter('2777162083188540753');" onmouseout="out('2777162083188540753');" style=""> 178      private static String buildInClauseTemplate(int length) {                                                     </span>
<span class="669871659996373325" onmouseenter="enter('669871659996373325');" onmouseout="out('669871659996373325');" style=""> 179          String[] temp = new String[length];                                                                       </span>
<span class="6562605117254584647" onmouseenter="enter('6562605117254584647');" onmouseout="out('6562605117254584647');" style=""> 180          Arrays.fill(temp, &quot;?&quot;);                                                                                   </span>
<span class="3467995464783580245" onmouseenter="enter('3467995464783580245');" onmouseout="out('3467995464783580245');" style=""> 181          return StringUtils.join(temp, &quot;,&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span  style=""> 183                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 184      /**                                                                                                           </span>
<span class="-5651954882364109426" onmouseenter="enter('-5651954882364109426');" onmouseout="out('-5651954882364109426');" style=""> 185       * This breaks up our IN clause into multiple runs of 800 or less in order                                    </span>
<span class="-942799509235420846" onmouseenter="enter('-942799509235420846');" onmouseout="out('-942799509235420846');" style=""> 186       * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there are more   </span>
<span class="-2405511677083481020" onmouseenter="enter('-2405511677083481020');" onmouseout="out('-2405511677083481020');" style=""> 187       * than a 1000 entries in an sql IN clause).                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 188       *                                                                                                            </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 189       * @param ids                                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 190       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191       */                                                                                                           </span>
<span class="3595856459484845769" onmouseenter="enter('3595856459484845769');" onmouseout="out('3595856459484845769');" style=""> 192      private static List&lt;Long[]&gt; buildRuns(List&lt;Long&gt; ids) {                                                       </span>
<span class="-5094500309704959115" onmouseenter="enter('-5094500309704959115');" onmouseout="out('-5094500309704959115');" style=""> 193          List&lt;Long[]&gt; runs = new ArrayList&lt;Long[]&gt;();                                                              </span>
<span class="1185518036691116005" onmouseenter="enter('1185518036691116005');" onmouseout="out('1185518036691116005');" style=""> 194          Long[] all = ids.toArray(new Long[ids.size()]);                                                           </span>
<span class="-8768161490919996337" onmouseenter="enter('-8768161490919996337');" onmouseout="out('-8768161490919996337');" style=""> 195          int test = all.length;                                                                                    </span>
<span class="6892465824848000999" onmouseenter="enter('6892465824848000999');" onmouseout="out('6892465824848000999');" style=""> 196          int pos = 0;                                                                                              </span>
<span class="-4875040428911372888" onmouseenter="enter('-4875040428911372888');" onmouseout="out('-4875040428911372888');" style=""> 197          boolean eof = false;                                                                                      </span>
<span class="-5429533219939196813" onmouseenter="enter('-5429533219939196813');" onmouseout="out('-5429533219939196813');" style=""> 198          while (!eof) {                                                                                            </span>
<span class="-7907705858393883561" onmouseenter="enter('-7907705858393883561');" onmouseout="out('-7907705858393883561');" style=""> 199              int arraySize;                                                                                        </span>
<span class="633660195054425543" onmouseenter="enter('633660195054425543');" onmouseout="out('633660195054425543');" style=""> 200              if (test &lt; 800) {                                                                                     </span>
<span class="-350597343612356769" onmouseenter="enter('-350597343612356769');" onmouseout="out('-350597343612356769');" style=""> 201                  arraySize = test;                                                                                 </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 202                  eof = true;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 203              } else {                                                                                              </span>
<span class="5448284432563530090" onmouseenter="enter('5448284432563530090');" onmouseout="out('5448284432563530090');" style=""> 204                  arraySize = 800;                                                                                  </span>
<span class="-723449570657995380" onmouseenter="enter('-723449570657995380');" onmouseout="out('-723449570657995380');" style=""> 205                  test -= arraySize;                                                                                </span>
<span class="-6202869398423757296" onmouseenter="enter('-6202869398423757296');" onmouseout="out('-6202869398423757296');" style=""> 206                  if (test == 0) {                                                                                  </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 207                      eof = true;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209              }                                                                                                     </span>
<span class="-1339368917359302064" onmouseenter="enter('-1339368917359302064');" onmouseout="out('-1339368917359302064');" style=""> 210              Long[] temp = new Long[arraySize];                                                                    </span>
<span class="5176312062593444984" onmouseenter="enter('5176312062593444984');" onmouseout="out('5176312062593444984');" style=""> 211              System.arraycopy(all, pos, temp, 0, arraySize);                                                       </span>
<span class="-1194166410448610477" onmouseenter="enter('-1194166410448610477');" onmouseout="out('-1194166410448610477');" style=""> 212              pos += arraySize;                                                                                     </span>
<span class="7099332349522936709" onmouseenter="enter('7099332349522936709');" onmouseout="out('7099332349522936709');" style=""> 213              runs.add(temp);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214          }                                                                                                         </span>
<span class="7771754948541320748" onmouseenter="enter('7771754948541320748');" onmouseout="out('7771754948541320748');" style=""> 215          return runs;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-4573490878212285276" onmouseenter="enter('-4573490878212285276');" onmouseout="out('-4573490878212285276');" style="">   3   * BroadleafCommerce Common Libraries                                                                             </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-5217922944432466167" onmouseenter="enter('-5217922944432466167');" onmouseout="out('-5217922944432466167');" style="">  18  package org.broadleafcommerce.common.util;                                                                        </span>
<span  style="">  19                                                                                                                    </span>
<span class="-7366736394295216840" onmouseenter="enter('-7366736394295216840');" onmouseout="out('-7366736394295216840');" style="">  20  import org.apache.commons.lang.ArrayUtils;                                                                        </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="5417513218856323097" onmouseenter="enter('5417513218856323097');" onmouseout="out('5417513218856323097');" style="">  22  import org.broadleafcommerce.common.util.dao.HibernateMappingProvider;                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +                                                                                                                  </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import org.hibernate.FlushMode;                                                                                   </span>
<span class="-1229446249209339952" onmouseenter="enter('-1229446249209339952');" onmouseout="out('-1229446249209339952');" style="">  25  import org.hibernate.SQLQuery;                                                                                    </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  26  import org.hibernate.Session;                                                                                     </span>
<span class="-5305207276947827879" onmouseenter="enter('-5305207276947827879');" onmouseout="out('-5305207276947827879');" style="">  27  import org.hibernate.cache.spi.UpdateTimestampsCache;                                                             </span>
<span class="4259012918999807968" onmouseenter="enter('4259012918999807968');" onmouseout="out('4259012918999807968');" style="">  28  import org.hibernate.engine.spi.CacheImplementor;                                                                 </span>
<span class="-2593392306196899585" onmouseenter="enter('-2593392306196899585');" onmouseout="out('-2593392306196899585');" style="">  29  import org.hibernate.engine.spi.SharedSessionContractImplementor;                                                 </span>
<span class="3166107731338102505" onmouseenter="enter('3166107731338102505');" onmouseout="out('3166107731338102505');" style="">  30  import org.hibernate.mapping.PersistentClass;                                                                     </span>


<span class="-8880811180875514232" onmouseenter="enter('-8880811180875514232');" onmouseout="out('-8880811180875514232');" style="">  31  import org.hibernate.type.Type;                                                                                   </span>
<span  style="">  32                                                                                                                    </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  33  import java.io.Serializable;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  34  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  35  import java.util.Arrays;                                                                                          </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  36  import java.util.List;                                                                                            </span>
<span  style="">  37                                                                                                                    </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  38  import javax.persistence.EntityManager;                                                                           </span>
<span  style="">  39                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  40  /**                                                                                                               </span>
<span class="6348818120460103423" onmouseenter="enter('6348818120460103423');" onmouseout="out('6348818120460103423');" style=""><abbr title="  41   * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on Hibernate filtered">  41   * The purpose for this class is to provide an alternate approach to an HQL UPDATE query for batch updates on HibeðŸ”µ</abbr></span>
<span class="7748252354772592691" onmouseenter="enter('7748252354772592691');" onmouseout="out('7748252354772592691');" style="">  42   * entities (such as sandboxable and multi-tenant entities).                                                      </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  43   * &lt;/p&gt;                                                                                                           </span>
<span class="4110890793834281526" onmouseenter="enter('4110890793834281526');" onmouseout="out('4110890793834281526');" style=""><abbr title="  44   * This class takes an interesting approach to the use of update queries. To explain, a bit of background is required.">  44   * This class takes an interesting approach to the use of update queries. To explain, a bit of background is requiðŸ”µ</abbr></span>
<span class="7963459504837668998" onmouseenter="enter('7963459504837668998');" onmouseout="out('7963459504837668998');" style=""><abbr title="  45   * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs an HQL UPDATE">  45   * First, Hibernate will create a temporary table and fill it will ids to use in a where clause when it executs anðŸ”µ</abbr></span>
<span class="-1517498419667072682" onmouseenter="enter('-1517498419667072682');" onmouseout="out('-1517498419667072682');" style="">  46   * query. However, it will only create this temporary table when the target entity has Hibernate filters applied  </span>
<span class="6382167101876958537" onmouseenter="enter('6382167101876958537');" onmouseout="out('6382167101876958537');" style=""><abbr title="  47   * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is used to">  47   * (i.e. sandboxable or multi-tenant entities). When creating this temporary table, a â€˜insert into selectâ€™ is usedðŸ”µ</abbr></span>
<span class="-616516256780040632" onmouseenter="enter('-616516256780040632');" onmouseout="out('-616516256780040632');" style=""><abbr title="  48   * populate the values. It is my understanding that this ends up creating some locks on the original table. Because of">  48   * populate the values. It is my understanding that this ends up creating some locks on the original table. BecausðŸ”µ</abbr></span>
<span class="-4853679335910197456" onmouseenter="enter('-4853679335910197456');" onmouseout="out('-4853679335910197456');" style="">  49   * these locks, we were seeing some instances of deadlocks during concurrent admin usage. The key was to avoid    </span>
<span class="2497248259790428100" onmouseenter="enter('2497248259790428100');" onmouseout="out('2497248259790428100');" style=""><abbr title="  50   * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) and then">  50   * the temporary table creation. We did this by first selecting for ids (so that the filters were still honored) aðŸ”µ</abbr></span>
<span class="-9211087791255088286" onmouseenter="enter('-9211087791255088286');" onmouseout="out('-9211087791255088286');" style=""><abbr title="  51   * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needs to be basic">  51   * using a simple, native sql statement to execute the update on entities matching those ids. The native sql needsðŸ”µ</abbr></span>
<span class="8121505566485274215" onmouseenter="enter('8121505566485274215');" onmouseout="out('8121505566485274215');" style="">  52   * enough that itâ€™s portable across platforms.                                                                    </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  53   * &lt;/p&gt;                                                                                                           </span>
<span class="2727226016037947351" onmouseenter="enter('2727226016037947351');" onmouseout="out('2727226016037947351');" style=""><abbr title="  54   * This class is responsible for building the native sql based on a template String. It does it in a way using a standard">  54   * This class is responsible for building the native sql based on a template String. It does it in a way using a sðŸ”µ</abbr></span>
<span class="6964425517053300902" onmouseenter="enter('6964425517053300902');" onmouseout="out('6964425517053300902');" style="">  55   * parameterized query (rather than string concatenation) to avoid the possibility of any sql injection exploit.  </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  56   * &lt;/p&gt;                                                                                                           </span>
<span class="-6470360024527340695" onmouseenter="enter('-6470360024527340695');" onmouseout="out('-6470360024527340695');" style="">  57   * This implementation has the added benefit of breaking up large IN clauses into smaller chunks to avoid maximum </span>
<span class="6126176286040066001" onmouseenter="enter('6126176286040066001');" onmouseout="out('6126176286040066001');" style="">  58   * IN clause lengths enforced by some database platforms.                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  59   *                                                                                                                </span>
<span class="-7311139588847938491" onmouseenter="enter('-7311139588847938491');" onmouseout="out('-7311139588847938491');" style="">  60   * @author Jeff Fischer                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61   */                                                                                                               </span>
<span class="-8243442400747008976" onmouseenter="enter('-8243442400747008976');" onmouseout="out('-8243442400747008976');" style="">  62  public class UpdateExecutor {                                                                                     </span>
<span  style="">  63                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  64      /**                                                                                                           </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style="">  65       * Perform an update query using a String template and params. Note, this is only intended for special        </span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style="">  66       * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session    </span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style="">  67       * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.         </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style="">  68       * &lt;/p&gt;                                                                                                       </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title="  69       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;">  69       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70       *                                                                                                            </span>
<span class="4830177201097172495" onmouseenter="enter('4830177201097172495');" onmouseout="out('4830177201097172495');" style=""><abbr title="  71       * @deprecated Highly recommended not to use this method. This method results in global L2 cache region clearing. Use {@link #executeUpdateQuery(EntityManager, String, String, Object[], Type[], List)} instead.">  71       * @deprecated Highly recommended not to use this method. This method results in global L2 cache region cleariðŸ”µ</abbr></span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style="">  72       * @param em The entity manager to use for the persistence operation                                          </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style="">  73       * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.</span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title="  74       * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null.">  74       * @param params any other params that are present in the sql template, other than the IN clause. Should be wrðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title="  75       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null.">  75       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should bðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style="">  76       * @param ids the ids to include in the IN clause.                                                            </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style="">  77       * @return the total number of records updated in the database                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  78       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  79      @Deprecated                                                                                                   </span>
<span class="-2067936805527519027" onmouseenter="enter('-2067936805527519027');" onmouseout="out('-2067936805527519027');" style=""><abbr title="  80      public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;Long&gt; ids) {">  80      public static int executeUpdateQuery(EntityManager em, String template, Object[] params, Type[] types, List&lt;LoðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style="">  81          int response = 0;                                                                                         </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style="">  82          List&lt;Long[]&gt; runs = buildRuns(ids);                                                                       </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style="">  83          for (Long[] run : runs) {                                                                                 </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style="">  84              String queryString = String.format(template, buildInClauseTemplate(run.length));                      </span>
<span class="2667466989905057170" onmouseenter="enter('2667466989905057170');" onmouseout="out('2667466989905057170');" style="">  85              SQLQuery query = em.unwrap(Session.class).createSQLQuery(queryString);                                </span>
<span class="-28710712224986892" onmouseenter="enter('-28710712224986892');" onmouseout="out('-28710712224986892');" style="">  86              int counter = 0;                                                                                      </span>


<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style="">  87              if (!ArrayUtils.isEmpty(params)) {                                                                    </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style="">  88                  for (Object param : params) {                                                                     </span>
<span class="4087918591244595483" onmouseenter="enter('4087918591244595483');" onmouseout="out('4087918591244595483');" style="">  89                      query.setParameter(counter, param, types[counter]);                                           </span>

<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  90                      counter++;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92              }                                                                                                     </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style="">  93              for (Long id : run) {                                                                                 </span>
<span class="-450681512314493849" onmouseenter="enter('-450681512314493849');" onmouseout="out('-450681512314493849');" style="">  94                  query.setLong(counter, id);                                                                       </span>

<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style="">  95                  counter++;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96              }                                                                                                     </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -            response += query.executeUpdate();                                                                    </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +            FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                                    </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +            em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +            try {                                                                                                 </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                response += query.executeUpdate();                                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +            } finally {                                                                                           </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +                em.unwrap(Session.class).setFlushMode(mode);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 106          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107      }                                                                                                             </span>
<span  style=""> 108                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 109      /**                                                                                                           </span>
<span class="-6165446170059487645" onmouseenter="enter('-6165446170059487645');" onmouseout="out('-6165446170059487645');" style=""> 110       * Perform an update query using a String template and params. Note, this is only intended for special        </span>
<span class="8849614819516779062" onmouseenter="enter('8849614819516779062');" onmouseout="out('8849614819516779062');" style=""> 111       * usage with update queries that have an IN clause at the end. This implementation uses Hibernate Session    </span>
<span class="-268299742348843007" onmouseenter="enter('-268299742348843007');" onmouseout="out('-268299742348843007');" style=""> 112       * directly to avoid a problem with assigning NULL values. The query should be written in native SQL.         </span>
<span class="-5136230954678527136" onmouseenter="enter('-5136230954678527136');" onmouseout="out('-5136230954678527136');" style=""> 113       * &lt;/p&gt;                                                                                                       </span>
<span class="1272884885884938672" onmouseenter="enter('1272884885884938672');" onmouseout="out('1272884885884938672');" style=""><abbr title=" 114       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (%s)&#x27;"> 114       * An example looks like: &#x27;UPDATE BLC_SNDBX_WRKFLW_ITEM SET SCHEDULED_DATE = ? WHERE WRKFLW_SNDBX_ITEM_ID IN (ðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 115       *                                                                                                            </span>
<span class="3510763516488231858" onmouseenter="enter('3510763516488231858');" onmouseout="out('3510763516488231858');" style=""> 116       * @param em The entity manager to use for the persistence operation                                          </span>
<span class="1966651126351765658" onmouseenter="enter('1966651126351765658');" onmouseout="out('1966651126351765658');" style=""> 117       * @param template the overall update sql template. The IN clause parameter should be written using &#x27;IN (%s)&#x27;.</span>
<span class="-2587457453102939237" onmouseenter="enter('-2587457453102939237');" onmouseout="out('-2587457453102939237');" style=""><abbr title=" 118       * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate to limit the scope of cache region invalidation. Otherwise, if left null, Hibernate will invalidate every cache region, which is generally not desirable. An empty String can be used to signify that no region should be invalidated."> 118       * @param tableSpace optionally provide the table being impacted by this query. This value allows Hibernate toðŸ”µ</abbr></span>
<span class="3665532594484198475" onmouseenter="enter('3665532594484198475');" onmouseout="out('3665532594484198475');" style=""><abbr title=" 119       * @param params any other params that are present in the sql template, other than the IN clause. Should be written using &#x27;?&#x27;. Should be in order. Can be null."> 119       * @param params any other params that are present in the sql template, other than the IN clause. Should be wrðŸ”µ</abbr></span>
<span class="2736989314187733151" onmouseenter="enter('2736989314187733151');" onmouseout="out('2736989314187733151');" style=""><abbr title=" 120       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should be in order and match the length of params. Can be null."> 120       * @param types the {@link org.hibernate.type.Type} instances that identify the types for the params. Should bðŸ”µ</abbr></span>
<span class="2581443432307180826" onmouseenter="enter('2581443432307180826');" onmouseout="out('2581443432307180826');" style=""> 121       * @param ids the ids to include in the IN clause.                                                            </span>
<span class="-828675666698257807" onmouseenter="enter('-828675666698257807');" onmouseout="out('-828675666698257807');" style=""> 122       * @return the total number of records updated in the database                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 123       */                                                                                                           </span>
<span class="-7793035550676407651" onmouseenter="enter('-7793035550676407651');" onmouseout="out('-7793035550676407651');" style=""><abbr title=" 124      public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, Type[] types, List&lt;Long&gt; ids) {"> 124      public static int executeUpdateQuery(EntityManager em, String template, String tableSpace, Object[] params, TyðŸ”µ</abbr></span>
<span class="2632345177134823716" onmouseenter="enter('2632345177134823716');" onmouseout="out('2632345177134823716');" style=""> 125          int response = 0;                                                                                         </span>
<span class="4594923320525133597" onmouseenter="enter('4594923320525133597');" onmouseout="out('4594923320525133597');" style=""> 126          List&lt;Long[]&gt; runs = buildRuns(ids);                                                                       </span>
<span class="4793672264086633821" onmouseenter="enter('4793672264086633821');" onmouseout="out('4793672264086633821');" style=""> 127          for (Long[] run : runs) {                                                                                 </span>
<span class="7293676562826499842" onmouseenter="enter('7293676562826499842');" onmouseout="out('7293676562826499842');" style=""> 128              String queryString = String.format(template, buildInClauseTemplate(run.length));                      </span>
<span class="2667466989905057170" onmouseenter="enter('2667466989905057170');" onmouseout="out('2667466989905057170');" style=""> 129              SQLQuery query = em.unwrap(Session.class).createSQLQuery(queryString);                                </span>

<span class="7928558069525012126" onmouseenter="enter('7928558069525012126');" onmouseout="out('7928558069525012126');" style=""> 130              //only check for null - an empty string is a valid value for tableSpace                               </span>
<span class="8336124458572820409" onmouseenter="enter('8336124458572820409');" onmouseout="out('8336124458572820409');" style=""> 131              if (tableSpace != null) {                                                                             </span>
<span class="-4360288991647885741" onmouseenter="enter('-4360288991647885741');" onmouseout="out('-4360288991647885741');" style=""> 132                  query.addSynchronizedQuerySpace(tableSpace);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133              }                                                                                                     </span>
<span class="-28710712224986892" onmouseenter="enter('-28710712224986892');" onmouseout="out('-28710712224986892');" style=""> 134              int counter = 0;                                                                                      </span>

<span class="5229009747190680504" onmouseenter="enter('5229009747190680504');" onmouseout="out('5229009747190680504');" style=""> 135              if (!ArrayUtils.isEmpty(params)) {                                                                    </span>
<span class="-6718473480690057696" onmouseenter="enter('-6718473480690057696');" onmouseout="out('-6718473480690057696');" style=""> 136                  for (Object param : params) {                                                                     </span>
<span class="4087918591244595483" onmouseenter="enter('4087918591244595483');" onmouseout="out('4087918591244595483');" style=""> 137                      query.setParameter(counter, param, types[counter]);                                           </span>

<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 138                      counter++;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140              }                                                                                                     </span>
<span class="4240236320672324764" onmouseenter="enter('4240236320672324764');" onmouseout="out('4240236320672324764');" style=""> 141              for (Long id : run) {                                                                                 </span>
<span class="-450681512314493849" onmouseenter="enter('-450681512314493849');" onmouseout="out('-450681512314493849');" style=""> 142                  query.setLong(counter, id);                                                                       </span>

<span class="230142626672672046" onmouseenter="enter('230142626672672046');" onmouseout="out('230142626672672046');" style=""> 143                  counter++;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144              }                                                                                                     </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -            response += query.executeUpdate();                                                                    </span>
<span class="4285522499241412024" onmouseenter="enter('4285522499241412024');" onmouseout="out('4285522499241412024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +            FlushMode mode = em.unwrap(Session.class).getHibernateFlushMode();                                    </span>
<span class="4015831325516071425" onmouseenter="enter('4015831325516071425');" onmouseout="out('4015831325516071425');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +            em.unwrap(Session.class).setFlushMode(FlushMode.MANUAL);                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +            try {                                                                                                 </span>
<span class="-130302457609703191" onmouseenter="enter('-130302457609703191');" onmouseout="out('-130302457609703191');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                response += query.executeUpdate();                                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +            } finally {                                                                                           </span>
<span class="9159294333199356046" onmouseenter="enter('9159294333199356046');" onmouseout="out('9159294333199356046');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                em.unwrap(Session.class).setFlushMode(mode);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153          }                                                                                                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 154          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155      }                                                                                                             </span>
<span  style=""> 156                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 157      /**                                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 158       *                                                                                                            </span>
<span class="8044709826139574523" onmouseenter="enter('8044709826139574523');" onmouseout="out('8044709826139574523');" style=""> 159       * @param em                                                                                                  </span>
<span class="-7339043177630483847" onmouseenter="enter('-7339043177630483847');" onmouseout="out('-7339043177630483847');" style=""> 160       * @param entityType                                                                                          </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 161       * @param ids                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 162       */                                                                                                           </span>
<span class="8096024415648720799" onmouseenter="enter('8096024415648720799');" onmouseout="out('8096024415648720799');" style=""> 163      public static void executeTargetedCacheInvalidation(EntityManager em, Class&lt;?&gt; entityType, List&lt;Long&gt; ids) {  </span>
<span class="-7004563177377484509" onmouseenter="enter('-7004563177377484509');" onmouseout="out('-7004563177377484509');" style=""> 164          SharedSessionContractImplementor session = em.unwrap(SharedSessionContractImplementor.class);             </span>
<span class="-8832788949494089748" onmouseenter="enter('-8832788949494089748');" onmouseout="out('-8832788949494089748');" style=""> 165          CacheImplementor hibernateCache = session.getFactory().getCache();                                        </span>
<span class="-5559971439404861126" onmouseenter="enter('-5559971439404861126');" onmouseout="out('-5559971439404861126');" style=""> 166          for (Long id : ids) {                                                                                     </span>
<span class="-1832990067626754509" onmouseenter="enter('-1832990067626754509');" onmouseout="out('-1832990067626754509');" style=""> 167              hibernateCache.evictEntity(entityType, id);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168          }                                                                                                         </span>
<span class="-1266521526110704198" onmouseenter="enter('-1266521526110704198');" onmouseout="out('-1266521526110704198');" style=""> 169          //update the timestamp cache for the table so that queries will be refreshed                              </span>
<span class="4670505101952069734" onmouseenter="enter('4670505101952069734');" onmouseout="out('4670505101952069734');" style=""> 170          PersistentClass metadata = HibernateMappingProvider.getMapping(entityType.getName());                     </span>
<span class="3066636713443405195" onmouseenter="enter('3066636713443405195');" onmouseout="out('3066636713443405195');" style=""> 171          String tableName = metadata.getTable().getName();                                                         </span>
<span class="-534381177811522590" onmouseenter="enter('-534381177811522590');" onmouseout="out('-534381177811522590');" style=""> 172          UpdateTimestampsCache timestampsCache = hibernateCache.getUpdateTimestampsCache();                        </span>
<span class="-2053542446089897358" onmouseenter="enter('-2053542446089897358');" onmouseout="out('-2053542446089897358');" style=""> 173          if (timestampsCache != null) {                                                                            </span>
<span class="-8604359847773131604" onmouseenter="enter('-8604359847773131604');" onmouseout="out('-8604359847773131604');" style=""> 174              timestampsCache.invalidate(new Serializable[]{tableName}, session);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176      }                                                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178      /**                                                                                                           </span>
<span class="-6417247131204683732" onmouseenter="enter('-6417247131204683732');" onmouseout="out('-6417247131204683732');" style=""> 179       * Quickly build up the sql IN clause template                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 180       *                                                                                                            </span>
<span class="-8158964965362665967" onmouseenter="enter('-8158964965362665967');" onmouseout="out('-8158964965362665967');" style=""> 181       * @param length                                                                                              </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 182       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 183       */                                                                                                           </span>
<span class="2777162083188540753" onmouseenter="enter('2777162083188540753');" onmouseout="out('2777162083188540753');" style=""> 184      private static String buildInClauseTemplate(int length) {                                                     </span>
<span class="669871659996373325" onmouseenter="enter('669871659996373325');" onmouseout="out('669871659996373325');" style=""> 185          String[] temp = new String[length];                                                                       </span>
<span class="6562605117254584647" onmouseenter="enter('6562605117254584647');" onmouseout="out('6562605117254584647');" style=""> 186          Arrays.fill(temp, &quot;?&quot;);                                                                                   </span>
<span class="3467995464783580245" onmouseenter="enter('3467995464783580245');" onmouseout="out('3467995464783580245');" style=""> 187          return StringUtils.join(temp, &quot;,&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188      }                                                                                                             </span>
<span  style=""> 189                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 190      /**                                                                                                           </span>
<span class="-5651954882364109426" onmouseenter="enter('-5651954882364109426');" onmouseout="out('-5651954882364109426');" style=""> 191       * This breaks up our IN clause into multiple runs of 800 or less in order                                    </span>
<span class="-942799509235420846" onmouseenter="enter('-942799509235420846');" onmouseout="out('-942799509235420846');" style=""> 192       * to guarantee compatibility across platforms (i.e. some db platforms will throw a error if there are more   </span>
<span class="-2405511677083481020" onmouseenter="enter('-2405511677083481020');" onmouseout="out('-2405511677083481020');" style=""> 193       * than a 1000 entries in an sql IN clause).                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 194       *                                                                                                            </span>
<span class="3352494988159471212" onmouseenter="enter('3352494988159471212');" onmouseout="out('3352494988159471212');" style=""> 195       * @param ids                                                                                                 </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 196       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 197       */                                                                                                           </span>
<span class="3595856459484845769" onmouseenter="enter('3595856459484845769');" onmouseout="out('3595856459484845769');" style=""> 198      private static List&lt;Long[]&gt; buildRuns(List&lt;Long&gt; ids) {                                                       </span>
<span class="-5094500309704959115" onmouseenter="enter('-5094500309704959115');" onmouseout="out('-5094500309704959115');" style=""> 199          List&lt;Long[]&gt; runs = new ArrayList&lt;Long[]&gt;();                                                              </span>
<span class="1185518036691116005" onmouseenter="enter('1185518036691116005');" onmouseout="out('1185518036691116005');" style=""> 200          Long[] all = ids.toArray(new Long[ids.size()]);                                                           </span>
<span class="-8768161490919996337" onmouseenter="enter('-8768161490919996337');" onmouseout="out('-8768161490919996337');" style=""> 201          int test = all.length;                                                                                    </span>
<span class="6892465824848000999" onmouseenter="enter('6892465824848000999');" onmouseout="out('6892465824848000999');" style=""> 202          int pos = 0;                                                                                              </span>
<span class="-4875040428911372888" onmouseenter="enter('-4875040428911372888');" onmouseout="out('-4875040428911372888');" style=""> 203          boolean eof = false;                                                                                      </span>
<span class="-5429533219939196813" onmouseenter="enter('-5429533219939196813');" onmouseout="out('-5429533219939196813');" style=""> 204          while (!eof) {                                                                                            </span>
<span class="-7907705858393883561" onmouseenter="enter('-7907705858393883561');" onmouseout="out('-7907705858393883561');" style=""> 205              int arraySize;                                                                                        </span>
<span class="633660195054425543" onmouseenter="enter('633660195054425543');" onmouseout="out('633660195054425543');" style=""> 206              if (test &lt; 800) {                                                                                     </span>
<span class="-350597343612356769" onmouseenter="enter('-350597343612356769');" onmouseout="out('-350597343612356769');" style=""> 207                  arraySize = test;                                                                                 </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 208                  eof = true;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 209              } else {                                                                                              </span>
<span class="5448284432563530090" onmouseenter="enter('5448284432563530090');" onmouseout="out('5448284432563530090');" style=""> 210                  arraySize = 800;                                                                                  </span>
<span class="-723449570657995380" onmouseenter="enter('-723449570657995380');" onmouseout="out('-723449570657995380');" style=""> 211                  test -= arraySize;                                                                                </span>
<span class="-6202869398423757296" onmouseenter="enter('-6202869398423757296');" onmouseout="out('-6202869398423757296');" style=""> 212                  if (test == 0) {                                                                                  </span>
<span class="-3626391356886992318" onmouseenter="enter('-3626391356886992318');" onmouseout="out('-3626391356886992318');" style=""> 213                      eof = true;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215              }                                                                                                     </span>
<span class="-1339368917359302064" onmouseenter="enter('-1339368917359302064');" onmouseout="out('-1339368917359302064');" style=""> 216              Long[] temp = new Long[arraySize];                                                                    </span>
<span class="5176312062593444984" onmouseenter="enter('5176312062593444984');" onmouseout="out('5176312062593444984');" style=""> 217              System.arraycopy(all, pos, temp, 0, arraySize);                                                       </span>
<span class="-1194166410448610477" onmouseenter="enter('-1194166410448610477');" onmouseout="out('-1194166410448610477');" style=""> 218              pos += arraySize;                                                                                     </span>
<span class="7099332349522936709" onmouseenter="enter('7099332349522936709');" onmouseout="out('7099332349522936709');" style=""> 219              runs.add(temp);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span class="7771754948541320748" onmouseenter="enter('7771754948541320748');" onmouseout="out('7771754948541320748');" style=""> 221          return runs;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            