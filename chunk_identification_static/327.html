<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>327</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    327
                    <a href="326.html">prev</a>
                    <a href="328.html">next</a>
                    <a href="327_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_2975e34145b38e44dc8a7def2617e3fe0d15321d_src/com/android/launcher3/WidgetPreviewLoader.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;2975e34145b38e44dc8a7def2617e3fe0d15321d:src/com/android/launcher3/WidgetPreviewLoader.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;2975e34145b38e44dc8a7def2617e3fe0d15321d^1:src/com/android/launcher3/WidgetPreviewLoader.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;2975e34145b38e44dc8a7def2617e3fe0d15321d^2:src/com/android/launcher3/WidgetPreviewLoader.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;268b8907d1f2fcf9775880c69899b3c6fbe85ea3:src/com/android/launcher3/WidgetPreviewLoader.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [bj], [s], [s]], subset: [[bsj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">   1 package com.android.launcher3;                                                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">   3 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">   4 import android.content.ComponentName;                                                                    </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">   5 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">   6 import android.content.Context;                                                                          </span>
<span class="4122587240602557356" onmouseenter="enter('4122587240602557356');" onmouseout="out('4122587240602557356');" style="">   7 import android.content.SharedPreferences;                                                                </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">   8 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7207138161133478555" onmouseenter="enter('7207138161133478555');" onmouseout="out('7207138161133478555');" style="">   9 import android.content.res.Resources;                                                                    </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  10 import android.database.Cursor;                                                                          </span>
<span class="-8322188515935618338" onmouseenter="enter('-8322188515935618338');" onmouseout="out('-8322188515935618338');" style="">  11 import android.database.sqlite.SQLiteCantOpenDatabaseException;                                          </span>
<span class="-4895155655276492102" onmouseenter="enter('-4895155655276492102');" onmouseout="out('-4895155655276492102');" style="">  12 import android.database.sqlite.SQLiteDatabase;                                                           </span>
<span class="250544669864164636" onmouseenter="enter('250544669864164636');" onmouseout="out('250544669864164636');" style="">  13 import android.database.sqlite.SQLiteDiskIOException;                                                    </span>
<span class="6401548559697116088" onmouseenter="enter('6401548559697116088');" onmouseout="out('6401548559697116088');" style="">  14 import android.database.sqlite.SQLiteOpenHelper;                                                         </span>
<span class="1099656306555592784" onmouseenter="enter('1099656306555592784');" onmouseout="out('1099656306555592784');" style="">  15 import android.database.sqlite.SQLiteReadOnlyDatabaseException;                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  16 import android.graphics.Bitmap;                                                                          </span>
<span class="-5221619029963095423" onmouseenter="enter('-5221619029963095423');" onmouseout="out('-5221619029963095423');" style="">  17 import android.graphics.Bitmap.Config;                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  18 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-8489723247854845487" onmouseenter="enter('-8489723247854845487');" onmouseout="out('-8489723247854845487');" style="">  19 import android.graphics.BitmapShader;                                                                    </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  20 import android.graphics.Canvas;                                                                          </span>
<span class="1046407090334580529" onmouseenter="enter('1046407090334580529');" onmouseout="out('1046407090334580529');" style="">  21 import android.graphics.ColorMatrix;                                                                     </span>
<span class="-2638342757206578386" onmouseenter="enter('-2638342757206578386');" onmouseout="out('-2638342757206578386');" style="">  22 import android.graphics.ColorMatrixColorFilter;                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  23 import android.graphics.Paint;                                                                           </span>
<span class="7353926919338897104" onmouseenter="enter('7353926919338897104');" onmouseout="out('7353926919338897104');" style="">  24 import android.graphics.PorterDuff;                                                                      </span>
<span class="2207333516549486115" onmouseenter="enter('2207333516549486115');" onmouseout="out('2207333516549486115');" style="">  25 import android.graphics.Rect;                                                                            </span>
<span class="-787513569742028665" onmouseenter="enter('-787513569742028665');" onmouseout="out('-787513569742028665');" style="">  26 import android.graphics.Shader;                                                                          </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  27 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  28 import android.graphics.drawable.Drawable;                                                               </span>
<span class="955674827050616793" onmouseenter="enter('955674827050616793');" onmouseout="out('955674827050616793');" style="">  29 import android.os.AsyncTask;                                                                             </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="">  30 import android.os.Build;                                                                                 </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  31 import android.util.Log;                                                                                 </span>
<span class="-2301578055393860706" onmouseenter="enter('-2301578055393860706');" onmouseout="out('-2301578055393860706');" style="">  32 import com.android.launcher3.compat.AppWidgetManagerCompat;                                              </span>
<span  style="">  33                                                                                                          </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  34 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  35 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  36 import java.io.IOException;                                                                              </span>
<span class="-9136849050553086203" onmouseenter="enter('-9136849050553086203');" onmouseout="out('-9136849050553086203');" style="">  37 import java.lang.ref.SoftReference;                                                                      </span>
<span class="-8692343821508153377" onmouseenter="enter('-8692343821508153377');" onmouseout="out('-8692343821508153377');" style="">  38 import java.lang.ref.WeakReference;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  39 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  40 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  41 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  42 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  43 import java.util.List;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  44 import java.util.concurrent.Callable;                                                                    </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  45 import java.util.concurrent.ExecutionException;                                                          </span>
<span  style="">  46                                                                                                          </span>
<span class="-4311378840888985036" onmouseenter="enter('-4311378840888985036');" onmouseout="out('-4311378840888985036');" style="">  47 public class WidgetPreviewLoader {                                                                       </span>
<span  style="">  48                                                                                                          </span>
<span class="-3230874476111875794" onmouseenter="enter('-3230874476111875794');" onmouseout="out('-3230874476111875794');" style="">  49     private static abstract class SoftReferenceThreadLocal&lt;T&gt; {                                          </span>
<span class="144884583078774733" onmouseenter="enter('144884583078774733');" onmouseout="out('144884583078774733');" style="">  50         private ThreadLocal&lt;SoftReference&lt;T&gt;&gt; mThreadLocal;                                              </span>
<span class="-4387433322567605136" onmouseenter="enter('-4387433322567605136');" onmouseout="out('-4387433322567605136');" style="">  51         public SoftReferenceThreadLocal() {                                                              </span>
<span class="4702884186935866826" onmouseenter="enter('4702884186935866826');" onmouseout="out('4702884186935866826');" style="">  52             mThreadLocal = new ThreadLocal&lt;SoftReference&lt;T&gt;&gt;();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  53         }                                                                                                </span>
<span  style="">  54                                                                                                          </span>
<span class="7611856356089156666" onmouseenter="enter('7611856356089156666');" onmouseout="out('7611856356089156666');" style="">  55         abstract T initialValue();                                                                       </span>
<span  style="">  56                                                                                                          </span>
<span class="-5049902553319226708" onmouseenter="enter('-5049902553319226708');" onmouseout="out('-5049902553319226708');" style="">  57         public void set(T t) {                                                                           </span>
<span class="4998900635420746153" onmouseenter="enter('4998900635420746153');" onmouseout="out('4998900635420746153');" style="">  58             mThreadLocal.set(new SoftReference&lt;T&gt;(t));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  59         }                                                                                                </span>
<span  style="">  60                                                                                                          </span>
<span class="-6159920038780308483" onmouseenter="enter('-6159920038780308483');" onmouseout="out('-6159920038780308483');" style="">  61         public T get() {                                                                                 </span>
<span class="-967899869235114258" onmouseenter="enter('-967899869235114258');" onmouseout="out('-967899869235114258');" style="">  62             SoftReference&lt;T&gt; reference = mThreadLocal.get();                                             </span>
<span class="-6948245133825727275" onmouseenter="enter('-6948245133825727275');" onmouseout="out('-6948245133825727275');" style="">  63             T obj;                                                                                       </span>
<span class="-5692723719917447196" onmouseenter="enter('-5692723719917447196');" onmouseout="out('-5692723719917447196');" style="">  64             if (reference == null) {                                                                     </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  65                 obj = initialValue();                                                                    </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  66                 mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                             </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  67                 return obj;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  68             } else {                                                                                     </span>
<span class="-2769798515494474030" onmouseenter="enter('-2769798515494474030');" onmouseout="out('-2769798515494474030');" style="">  69                 obj = reference.get();                                                                   </span>
<span class="9024370751945626489" onmouseenter="enter('9024370751945626489');" onmouseout="out('9024370751945626489');" style="">  70                 if (obj == null) {                                                                       </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  71                     obj = initialValue();                                                                </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  72                     mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73                 }                                                                                        </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  74                 return obj;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-5055153777344084118" onmouseenter="enter('-5055153777344084118');" onmouseout="out('-5055153777344084118');" style="">  79     private static class CanvasCache extends SoftReferenceThreadLocal&lt;Canvas&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80         @Override                                                                                        </span>
<span class="-4761875685905818114" onmouseenter="enter('-4761875685905818114');" onmouseout="out('-4761875685905818114');" style="">  81         protected Canvas initialValue() {                                                                </span>
<span class="-2278895108809265326" onmouseenter="enter('-2278895108809265326');" onmouseout="out('-2278895108809265326');" style="">  82             return new Canvas();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="-1261255052546611379" onmouseenter="enter('-1261255052546611379');" onmouseout="out('-1261255052546611379');" style="">  86     private static class PaintCache extends SoftReferenceThreadLocal&lt;Paint&gt; {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  87         @Override                                                                                        </span>
<span class="5455192562670218369" onmouseenter="enter('5455192562670218369');" onmouseout="out('5455192562670218369');" style="">  88         protected Paint initialValue() {                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  89             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="1990146601739059582" onmouseenter="enter('1990146601739059582');" onmouseout="out('1990146601739059582');" style="">  93     private static class BitmapCache extends SoftReferenceThreadLocal&lt;Bitmap&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94         @Override                                                                                        </span>
<span class="5445413510754308036" onmouseenter="enter('5445413510754308036');" onmouseout="out('5445413510754308036');" style="">  95         protected Bitmap initialValue() {                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  96             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="-4690039068512610596" onmouseenter="enter('-4690039068512610596');" onmouseout="out('-4690039068512610596');" style=""> 100     private static class RectCache extends SoftReferenceThreadLocal&lt;Rect&gt; {                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 101         @Override                                                                                        </span>
<span class="8484771223674222626" onmouseenter="enter('8484771223674222626');" onmouseout="out('8484771223674222626');" style=""> 102         protected Rect initialValue() {                                                                  </span>
<span class="3126951611359421696" onmouseenter="enter('3126951611359421696');" onmouseout="out('3126951611359421696');" style=""> 103             return new Rect();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1412995145802516532" onmouseenter="enter('-1412995145802516532');" onmouseout="out('-1412995145802516532');" style=""> 107     private static class BitmapFactoryOptionsCache extends                                               </span>
<span class="6571896484354186661" onmouseenter="enter('6571896484354186661');" onmouseout="out('6571896484354186661');" style=""> 108             SoftReferenceThreadLocal&lt;BitmapFactory.Options&gt; {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109         @Override                                                                                        </span>
<span class="-8328117947754333521" onmouseenter="enter('-8328117947754333521');" onmouseout="out('-8328117947754333521');" style=""> 110         protected BitmapFactory.Options initialValue() {                                                 </span>
<span class="-4117267854178586248" onmouseenter="enter('-4117267854178586248');" onmouseout="out('-4117267854178586248');" style=""> 111             return new BitmapFactory.Options();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="2416799479879720027" onmouseenter="enter('2416799479879720027');" onmouseout="out('2416799479879720027');" style=""> 115     private static final String TAG = &quot;WidgetPreviewLoader&quot;;                                             </span>
<span class="4075932221748513041" onmouseenter="enter('4075932221748513041');" onmouseout="out('4075932221748513041');" style=""> 116     private static final String ANDROID_INCREMENTAL_VERSION_NAME_KEY = &quot;android.incremental.version&quot;;    </span>
<span  style=""> 117                                                                                                          </span>
<span class="7524285546086861850" onmouseenter="enter('7524285546086861850');" onmouseout="out('7524285546086861850');" style=""> 118     private static final float WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE = 0.25f;                           </span>
<span class="1902323072201125531" onmouseenter="enter('1902323072201125531');" onmouseout="out('1902323072201125531');" style=""> 119     private static final HashSet&lt;String&gt; sInvalidPackages = new HashSet&lt;String&gt;();                       </span>
<span  style=""> 120                                                                                                          </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 121     // Used for drawing shortcut previews                                                                </span>
<span class="333450150533861200" onmouseenter="enter('333450150533861200');" onmouseout="out('333450150533861200');" style=""> 122     private final BitmapCache mCachedShortcutPreviewBitmap = new BitmapCache();                          </span>
<span class="6665675930715155383" onmouseenter="enter('6665675930715155383');" onmouseout="out('6665675930715155383');" style=""> 123     private final PaintCache mCachedShortcutPreviewPaint = new PaintCache();                             </span>
<span class="1096761732692819631" onmouseenter="enter('1096761732692819631');" onmouseout="out('1096761732692819631');" style=""> 124     private final CanvasCache mCachedShortcutPreviewCanvas = new CanvasCache();                          </span>
<span  style=""> 125                                                                                                          </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 126     // Used for drawing widget previews                                                                  </span>
<span class="-3956456794742254913" onmouseenter="enter('-3956456794742254913');" onmouseout="out('-3956456794742254913');" style=""> 127     private final CanvasCache mCachedAppWidgetPreviewCanvas = new CanvasCache();                         </span>
<span class="2994302144561928781" onmouseenter="enter('2994302144561928781');" onmouseout="out('2994302144561928781');" style=""> 128     private final RectCache mCachedAppWidgetPreviewSrcRect = new RectCache();                            </span>
<span class="-2432735040368044940" onmouseenter="enter('-2432735040368044940');" onmouseout="out('-2432735040368044940');" style=""> 129     private final RectCache mCachedAppWidgetPreviewDestRect = new RectCache();                           </span>
<span class="-1839110596677388209" onmouseenter="enter('-1839110596677388209');" onmouseout="out('-1839110596677388209');" style=""> 130     private final PaintCache mCachedAppWidgetPreviewPaint = new PaintCache();                            </span>
<span class="4215417609313429507" onmouseenter="enter('4215417609313429507');" onmouseout="out('4215417609313429507');" style=""> 131     private final PaintCache mDefaultAppWidgetPreviewPaint = new PaintCache();                           </span>
<span class="7799865446872866624" onmouseenter="enter('7799865446872866624');" onmouseout="out('7799865446872866624');" style=""><abbr title=" 132     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache();"> 132     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache()ðŸ”µ</abbr></span>
<span  style=""> 133                                                                                                          </span>
<span class="4097431862822690335" onmouseenter="enter('4097431862822690335');" onmouseout="out('4097431862822690335');" style=""><abbr title=" 134     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt;();"> 134     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakRefereðŸ”µ</abbr></span>
<span class="-7580346379503623190" onmouseenter="enter('-7580346379503623190');" onmouseout="out('-7580346379503623190');" style=""><abbr title=" 135     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;();"> 135     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;(ðŸ”µ</abbr></span>
<span  style=""> 136                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 137     private final Context mContext;                                                                      </span>
<span class="-7489384078469018359" onmouseenter="enter('-7489384078469018359');" onmouseout="out('-7489384078469018359');" style=""> 138     private final int mAppIconSize;                                                                      </span>
<span class="2729881913605020060" onmouseenter="enter('2729881913605020060');" onmouseout="out('2729881913605020060');" style=""> 139     private final IconCache mIconCache;                                                                  </span>
<span class="9150498506085829362" onmouseenter="enter('9150498506085829362');" onmouseout="out('9150498506085829362');" style=""> 140     private final AppWidgetManagerCompat mManager;                                                       </span>
<span  style=""> 141                                                                                                          </span>
<span class="-8162128579730225382" onmouseenter="enter('-8162128579730225382');" onmouseout="out('-8162128579730225382');" style=""> 142     private int mPreviewBitmapWidth;                                                                     </span>
<span class="4768970035560221699" onmouseenter="enter('4768970035560221699');" onmouseout="out('4768970035560221699');" style=""> 143     private int mPreviewBitmapHeight;                                                                    </span>
<span class="-2278862546333248339" onmouseenter="enter('-2278862546333248339');" onmouseout="out('-2278862546333248339');" style=""> 144     private String mSize;                                                                                </span>
<span class="-4195956876020483478" onmouseenter="enter('-4195956876020483478');" onmouseout="out('-4195956876020483478');" style=""> 145     private PagedViewCellLayout mWidgetSpacingLayout;                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="-7229982499992821578" onmouseenter="enter('-7229982499992821578');" onmouseout="out('-7229982499992821578');" style=""> 147     private String mCachedSelectQuery;                                                                   </span>
<span  style=""> 148                                                                                                          </span>
<span  style=""> 149                                                                                                          </span>
<span class="6719315262198447761" onmouseenter="enter('6719315262198447761');" onmouseout="out('6719315262198447761');" style=""> 150     private CacheDb mDb;                                                                                 </span>
<span  style=""> 151                                                                                                          </span>
<span class="140559351311799615" onmouseenter="enter('140559351311799615');" onmouseout="out('140559351311799615');" style=""> 152     private final MainThreadExecutor mMainThreadExecutor = new MainThreadExecutor();                     </span>
<span  style=""> 153                                                                                                          </span>
<span class="-5828204717811548952" onmouseenter="enter('-5828204717811548952');" onmouseout="out('-5828204717811548952');" style=""> 154     public WidgetPreviewLoader(Context context) {                                                        </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 155         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-6320967880672955396" onmouseenter="enter('-6320967880672955396');" onmouseout="out('-6320967880672955396');" style=""> 156         DeviceProfile grid = app.getDynamicGrid().getDeviceProfile();                                    </span>
<span  style=""> 157                                                                                                          </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 158         mContext = context;                                                                              </span>
<span class="3163588368111647063" onmouseenter="enter('3163588368111647063');" onmouseout="out('3163588368111647063');" style=""> 159         mAppIconSize = grid.iconSizePx;                                                                  </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 160         mIconCache = app.getIconCache();                                                                 </span>
<span class="3481132346717467494" onmouseenter="enter('3481132346717467494');" onmouseout="out('3481132346717467494');" style=""> 161         mManager = AppWidgetManagerCompat.getInstance(context);                                          </span>
<span  style=""> 162                                                                                                          </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 163         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span  style=""> 164                                                                                                          </span>
<span class="2019816042868645703" onmouseenter="enter('2019816042868645703');" onmouseout="out('2019816042868645703');" style=""> 165         SharedPreferences sp = context.getSharedPreferences(                                             </span>
<span class="-3012020800644432647" onmouseenter="enter('-3012020800644432647');" onmouseout="out('-3012020800644432647');" style=""> 166                 LauncherAppState.getSharedPreferencesKey(), Context.MODE_PRIVATE);                       </span>
<span class="7599352561706696094" onmouseenter="enter('7599352561706696094');" onmouseout="out('7599352561706696094');" style=""> 167         final String lastVersionName = sp.getString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, null);         </span>
<span class="-8837714544016106839" onmouseenter="enter('-8837714544016106839');" onmouseout="out('-8837714544016106839');" style=""> 168         final String versionName = android.os.Build.VERSION.INCREMENTAL;                                 </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 169 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6804745435332338014" onmouseenter="enter('-6804745435332338014');" onmouseout="out('-6804745435332338014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         final boolean isLollipop = Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP;                </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 171 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4086555010887297457" onmouseenter="enter('4086555010887297457');" onmouseout="out('4086555010887297457');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172             // clear all the previews whenever the system version changes, to ensure that previews       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 173 =======                                                                                                  </span>
<span class="5360402256484915856" onmouseenter="enter('5360402256484915856');" onmouseout="out('5360402256484915856');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174         final boolean isLollipopOrGreater = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP;       </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 175 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style=""> 176         if (!versionName.equals(lastVersionName)) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 177             try {                                                                                        </span>
<span class="-1043062607084730911" onmouseenter="enter('-1043062607084730911');" onmouseout="out('-1043062607084730911');" style=""> 178                 // clear all the previews whenever the system version changes, to ensure that            </span>
<span class="-3090272541711713949" onmouseenter="enter('-3090272541711713949');" onmouseout="out('-3090272541711713949');" style=""> 179                 // previews are up-to-date for any apps that might have been updated with the system     </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style=""> 180                 clearDb();                                                                               </span>
<span class="-1695662722736394565" onmouseenter="enter('-1695662722736394565');" onmouseout="out('-1695662722736394565');" style=""> 181             } catch (SQLiteReadOnlyDatabaseException e) {                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 182 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4319884442435447688" onmouseenter="enter('4319884442435447688');" onmouseout="out('4319884442435447688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183                 if (isLollipop) {                                                                        </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184                     // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only     </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                     // issue, then ignore this error and leave the old previews                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186                 } else {                                                                                 </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189             } catch (Exception e) {                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190                 throw e;                                                                                 </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 191 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194                                                                                                          </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195     public void recreateDb() {                                                                           </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         app.recreateWidgetPreviewDb();                                                                   </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 200 =======                                                                                                  </span>
<span class="-1402409748038375417" onmouseenter="enter('-1402409748038375417');" onmouseout="out('-1402409748038375417');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                 if (isLollipopOrGreater) {                                                               </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                     // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only     </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                     // issue, then ignore this error and leave the old previews                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                 } else {                                                                                 </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206                 }                                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 207 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 208             } finally {                                                                                  </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style=""> 209                 SharedPreferences.Editor editor = sp.edit();                                             </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style=""> 210                 editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                     </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style=""> 211                 editor.commit();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style=""> 216     public void recreateDb() {                                                                           </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 217         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style=""> 218         app.recreateWidgetPreviewDb();                                                                   </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 219         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220     }                                                                                                    </span>
<span  style=""> 221                                                                                                          </span>
<span class="1041361483340123386" onmouseenter="enter('1041361483340123386');" onmouseout="out('1041361483340123386');" style=""> 222     public void setPreviewSize(int previewWidth, int previewHeight,                                      </span>
<span class="-864889589589090056" onmouseenter="enter('-864889589589090056');" onmouseout="out('-864889589589090056');" style=""> 223             PagedViewCellLayout widgetSpacingLayout) {                                                   </span>
<span class="7215920596152382710" onmouseenter="enter('7215920596152382710');" onmouseout="out('7215920596152382710');" style=""> 224         mPreviewBitmapWidth = previewWidth;                                                              </span>
<span class="-1710948131163314144" onmouseenter="enter('-1710948131163314144');" onmouseout="out('-1710948131163314144');" style=""> 225         mPreviewBitmapHeight = previewHeight;                                                            </span>
<span class="-2589016613696609257" onmouseenter="enter('-2589016613696609257');" onmouseout="out('-2589016613696609257');" style=""> 226         mSize = previewWidth + &quot;x&quot; + previewHeight;                                                      </span>
<span class="-2003385001531882656" onmouseenter="enter('-2003385001531882656');" onmouseout="out('-2003385001531882656');" style=""> 227         mWidgetSpacingLayout = widgetSpacingLayout;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228     }                                                                                                    </span>
<span  style=""> 229                                                                                                          </span>
<span class="9100103105710524909" onmouseenter="enter('9100103105710524909');" onmouseout="out('9100103105710524909');" style=""> 230     public Bitmap getPreview(final Object o) {                                                           </span>
<span class="7210064752111263529" onmouseenter="enter('7210064752111263529');" onmouseout="out('7210064752111263529');" style=""> 231         final String name = getObjectName(o);                                                            </span>
<span class="-4502422735439147840" onmouseenter="enter('-4502422735439147840');" onmouseout="out('-4502422735439147840');" style=""> 232         final String packageName = getObjectPackage(o);                                                  </span>
<span class="6483702398021407461" onmouseenter="enter('6483702398021407461');" onmouseout="out('6483702398021407461');" style=""> 233         // check if the package is valid                                                                 </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 234         synchronized(sInvalidPackages) {                                                                 </span>
<span class="6205084711389939864" onmouseenter="enter('6205084711389939864');" onmouseout="out('6205084711389939864');" style=""> 235             boolean packageValid = !sInvalidPackages.contains(packageName);                              </span>
<span class="5936168059174575986" onmouseenter="enter('5936168059174575986');" onmouseout="out('5936168059174575986');" style=""> 236             if (!packageValid) {                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 237                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239         }                                                                                                </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 240         synchronized(mLoadedPreviews) {                                                                  </span>
<span class="-7479974433139738260" onmouseenter="enter('-7479974433139738260');" onmouseout="out('-7479974433139738260');" style=""> 241             // check if it exists in our existing cache                                                  </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 242             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="-5798374742760410220" onmouseenter="enter('-5798374742760410220');" onmouseout="out('-5798374742760410220');" style=""> 243                 WeakReference&lt;Bitmap&gt; bitmapReference = mLoadedPreviews.get(name);                       </span>
<span class="-5072696511706589798" onmouseenter="enter('-5072696511706589798');" onmouseout="out('-5072696511706589798');" style=""> 244                 Bitmap bitmap = bitmapReference.get();                                                   </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 245                 if (bitmap != null) {                                                                    </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style=""> 246                     return bitmap;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span  style=""> 250                                                                                                          </span>
<span class="-1660586751969869388" onmouseenter="enter('-1660586751969869388');" onmouseout="out('-1660586751969869388');" style=""> 251         Bitmap unusedBitmap = null;                                                                      </span>
<span class="7613513134986517501" onmouseenter="enter('7613513134986517501');" onmouseout="out('7613513134986517501');" style=""> 252         synchronized(mUnusedBitmaps) {                                                                   </span>
<span class="134332774856407035" onmouseenter="enter('134332774856407035');" onmouseout="out('134332774856407035');" style=""> 253             // not in cache; we need to load it from the db                                              </span>
<span class="1411220366891100168" onmouseenter="enter('1411220366891100168');" onmouseout="out('1411220366891100168');" style=""> 254             while (unusedBitmap == null &amp;&amp; mUnusedBitmaps.size() &gt; 0) {                                  </span>
<span class="3514361872991648197" onmouseenter="enter('3514361872991648197');" onmouseout="out('3514361872991648197');" style=""> 255                 Bitmap candidate = mUnusedBitmaps.remove(0).get();                                       </span>
<span class="-3857479151276842222" onmouseenter="enter('-3857479151276842222');" onmouseout="out('-3857479151276842222');" style=""> 256                 if (candidate != null &amp;&amp; candidate.isMutable() &amp;&amp;                                        </span>
<span class="-7425312185904228324" onmouseenter="enter('-7425312185904228324');" onmouseout="out('-7425312185904228324');" style=""> 257                         candidate.getWidth() == mPreviewBitmapWidth &amp;&amp;                                   </span>
<span class="-897867530819106482" onmouseenter="enter('-897867530819106482');" onmouseout="out('-897867530819106482');" style=""> 258                         candidate.getHeight() == mPreviewBitmapHeight) {                                 </span>
<span class="-7974711513755834014" onmouseenter="enter('-7974711513755834014');" onmouseout="out('-7974711513755834014');" style=""> 259                     unusedBitmap = candidate;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261             }                                                                                            </span>
<span class="-1806752935370283796" onmouseenter="enter('-1806752935370283796');" onmouseout="out('-1806752935370283796');" style=""> 262             if (unusedBitmap != null) {                                                                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 263                 final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                    </span>
<span class="-7568013336659090919" onmouseenter="enter('-7568013336659090919');" onmouseout="out('-7568013336659090919');" style=""> 264                 c.setBitmap(unusedBitmap);                                                               </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 265                 c.drawColor(0, PorterDuff.Mode.CLEAR);                                                   </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 266                 c.setBitmap(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span  style=""> 269                                                                                                          </span>
<span class="-7521323678416918441" onmouseenter="enter('-7521323678416918441');" onmouseout="out('-7521323678416918441');" style=""> 270         if (unusedBitmap == null) {                                                                      </span>
<span class="-3551833031540614706" onmouseenter="enter('-3551833031540614706');" onmouseout="out('-3551833031540614706');" style=""> 271             unusedBitmap = Bitmap.createBitmap(mPreviewBitmapWidth, mPreviewBitmapHeight,                </span>
<span class="273441602049516461" onmouseenter="enter('273441602049516461');" onmouseout="out('273441602049516461');" style=""> 272                     Bitmap.Config.ARGB_8888);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273         }                                                                                                </span>
<span class="-8985062989738227550" onmouseenter="enter('-8985062989738227550');" onmouseout="out('-8985062989738227550');" style=""> 274         Bitmap preview = readFromDb(name, unusedBitmap);                                                 </span>
<span  style=""> 275                                                                                                          </span>
<span class="-760731434728754948" onmouseenter="enter('-760731434728754948');" onmouseout="out('-760731434728754948');" style=""> 276         if (preview != null) {                                                                           </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 277             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 278                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279             }                                                                                            </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 280             return preview;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 281         } else {                                                                                         </span>
<span class="3460679213489770567" onmouseenter="enter('3460679213489770567');" onmouseout="out('3460679213489770567');" style=""> 282             // it&#x27;s not in the db... we need to generate it                                              </span>
<span class="7452120778445413168" onmouseenter="enter('7452120778445413168');" onmouseout="out('7452120778445413168');" style=""> 283             final Bitmap generatedPreview = generatePreview(o, unusedBitmap);                            </span>
<span class="-4291180510938406114" onmouseenter="enter('-4291180510938406114');" onmouseout="out('-4291180510938406114');" style=""> 284             preview = generatedPreview;                                                                  </span>
<span class="7396852523530524307" onmouseenter="enter('7396852523530524307');" onmouseout="out('7396852523530524307');" style=""> 285             if (preview != unusedBitmap) {                                                               </span>
<span class="-7211694849959051791" onmouseenter="enter('-7211694849959051791');" onmouseout="out('-7211694849959051791');" style=""> 286                 throw new RuntimeException(&quot;generatePreview is not recycling the bitmap &quot; + o);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287             }                                                                                            </span>
<span  style=""> 288                                                                                                          </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 289             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 290                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291             }                                                                                            </span>
<span  style=""> 292                                                                                                          </span>
<span class="-5733309973697321639" onmouseenter="enter('-5733309973697321639');" onmouseout="out('-5733309973697321639');" style=""> 293             // write to db on a thread pool... this can be done lazily and improves the performance      </span>
<span class="-8551030995294829944" onmouseenter="enter('-8551030995294829944');" onmouseout="out('-8551030995294829944');" style=""> 294             // of the first time widget previews are loaded                                              </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 295             new AsyncTask&lt;Void, Void, Void&gt;() {                                                          </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 296                 public Void doInBackground(Void ... args) {                                              </span>
<span class="5794871779597006615" onmouseenter="enter('5794871779597006615');" onmouseout="out('5794871779597006615');" style=""> 297                     writeToDb(o, generatedPreview);                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 298                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299                 }                                                                                        </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 300             }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                            </span>
<span  style=""> 301                                                                                                          </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 302             return preview;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304     }                                                                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="-2058417025959444842" onmouseenter="enter('-2058417025959444842');" onmouseout="out('-2058417025959444842');" style=""> 306     public void recycleBitmap(Object o, Bitmap bitmapToRecycle) {                                        </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 307         String name = getObjectName(o);                                                                  </span>
<span class="-4798838159901813780" onmouseenter="enter('-4798838159901813780');" onmouseout="out('-4798838159901813780');" style=""> 308         synchronized (mLoadedPreviews) {                                                                 </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 309             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="5945201469012860218" onmouseenter="enter('5945201469012860218');" onmouseout="out('5945201469012860218');" style=""> 310                 Bitmap b = mLoadedPreviews.get(name).get();                                              </span>
<span class="9172312796342865011" onmouseenter="enter('9172312796342865011');" onmouseout="out('9172312796342865011');" style=""> 311                 if (b == bitmapToRecycle) {                                                              </span>
<span class="-3845835638768486269" onmouseenter="enter('-3845835638768486269');" onmouseout="out('-3845835638768486269');" style=""> 312                     mLoadedPreviews.remove(name);                                                        </span>
<span class="1962405822662822843" onmouseenter="enter('1962405822662822843');" onmouseout="out('1962405822662822843');" style=""> 313                     if (bitmapToRecycle.isMutable()) {                                                   </span>
<span class="732538049861401327" onmouseenter="enter('732538049861401327');" onmouseout="out('732538049861401327');" style=""> 314                         synchronized (mUnusedBitmaps) {                                                  </span>
<span class="7654440137511857398" onmouseenter="enter('7654440137511857398');" onmouseout="out('7654440137511857398');" style=""> 315                             mUnusedBitmaps.add(new SoftReference&lt;Bitmap&gt;(b));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 318                 } else {                                                                                 </span>
<span class="-7483999424756026389" onmouseenter="enter('-7483999424756026389');" onmouseout="out('-7483999424756026389');" style=""> 319                     throw new RuntimeException(&quot;Bitmap passed in doesn&#x27;t match up&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323     }                                                                                                    </span>
<span  style=""> 324                                                                                                          </span>
<span class="-6828234266968088645" onmouseenter="enter('-6828234266968088645');" onmouseout="out('-6828234266968088645');" style=""> 325     static class CacheDb extends SQLiteOpenHelper {                                                      </span>
<span class="-2905037825538645689" onmouseenter="enter('-2905037825538645689');" onmouseout="out('-2905037825538645689');" style=""> 326         final static int DB_VERSION = 2;                                                                 </span>
<span class="-4997316780024779267" onmouseenter="enter('-4997316780024779267');" onmouseout="out('-4997316780024779267');" style=""> 327         final static String TABLE_NAME = &quot;shortcut_and_widget_previews&quot;;                                 </span>
<span class="-5742805130150616813" onmouseenter="enter('-5742805130150616813');" onmouseout="out('-5742805130150616813');" style=""> 328         final static String COLUMN_NAME = &quot;name&quot;;                                                        </span>
<span class="8854376481192602334" onmouseenter="enter('8854376481192602334');" onmouseout="out('8854376481192602334');" style=""> 329         final static String COLUMN_SIZE = &quot;size&quot;;                                                        </span>
<span class="6902810344350480074" onmouseenter="enter('6902810344350480074');" onmouseout="out('6902810344350480074');" style=""> 330         final static String COLUMN_PREVIEW_BITMAP = &quot;preview_bitmap&quot;;                                    </span>
<span class="-5996057254067063760" onmouseenter="enter('-5996057254067063760');" onmouseout="out('-5996057254067063760');" style=""> 331         Context mContext;                                                                                </span>
<span  style=""> 332                                                                                                          </span>
<span class="-1572964554793598477" onmouseenter="enter('-1572964554793598477');" onmouseout="out('-1572964554793598477');" style=""> 333         public CacheDb(Context context) {                                                                </span>
<span class="-495189310641001393" onmouseenter="enter('-495189310641001393');" onmouseout="out('-495189310641001393');" style=""> 334             super(context, new File(context.getCacheDir(),                                               </span>
<span class="-4377620877094923072" onmouseenter="enter('-4377620877094923072');" onmouseout="out('-4377620877094923072');" style=""> 335                     LauncherFiles.WIDGET_PREVIEWS_DB).getPath(), null, DB_VERSION);                      </span>
<span class="-5483301966583099443" onmouseenter="enter('-5483301966583099443');" onmouseout="out('-5483301966583099443');" style=""> 336             // Store the context for later use                                                           </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 337             mContext = context;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338         }                                                                                                </span>
<span  style=""> 339                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 340         @Override                                                                                        </span>
<span class="-3622240674415739784" onmouseenter="enter('-3622240674415739784');" onmouseout="out('-3622240674415739784');" style=""> 341         public void onCreate(SQLiteDatabase database) {                                                  </span>
<span class="-5851870806192660982" onmouseenter="enter('-5851870806192660982');" onmouseout="out('-5851870806192660982');" style=""> 342             database.execSQL(&quot;CREATE TABLE IF NOT EXISTS &quot; + TABLE_NAME + &quot; (&quot; +                         </span>
<span class="-4480150272515057846" onmouseenter="enter('-4480150272515057846');" onmouseout="out('-4480150272515057846');" style=""> 343                     COLUMN_NAME + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="9221020696116426890" onmouseenter="enter('9221020696116426890');" onmouseout="out('9221020696116426890');" style=""> 344                     COLUMN_SIZE + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="-4320278434100102649" onmouseenter="enter('-4320278434100102649');" onmouseout="out('-4320278434100102649');" style=""> 345                     COLUMN_PREVIEW_BITMAP + &quot; BLOB NOT NULL, &quot; +                                         </span>
<span class="2330812204177674799" onmouseenter="enter('2330812204177674799');" onmouseout="out('2330812204177674799');" style=""> 346                     &quot;PRIMARY KEY (&quot; + COLUMN_NAME + &quot;, &quot; + COLUMN_SIZE + &quot;) &quot; +                          </span>
<span class="4525293784515244604" onmouseenter="enter('4525293784515244604');" onmouseout="out('4525293784515244604');" style=""> 347                     &quot;);&quot;);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348         }                                                                                                </span>
<span  style=""> 349                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 350         @Override                                                                                        </span>
<span class="-4655538025867202729" onmouseenter="enter('-4655538025867202729');" onmouseout="out('-4655538025867202729');" style=""> 351         public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {                       </span>
<span class="4248187026734735411" onmouseenter="enter('4248187026734735411');" onmouseout="out('4248187026734735411');" style=""> 352             if (oldVersion != newVersion) {                                                              </span>
<span class="4606527396647857067" onmouseenter="enter('4606527396647857067');" onmouseout="out('4606527396647857067');" style=""> 353                 // Delete all the records; they&#x27;ll be repopulated as this is a cache                     </span>
<span class="3312906466801577184" onmouseenter="enter('3312906466801577184');" onmouseout="out('3312906466801577184');" style=""> 354                 db.execSQL(&quot;DELETE FROM &quot; + TABLE_NAME);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span  style=""> 358                                                                                                          </span>
<span class="4811926455019388037" onmouseenter="enter('4811926455019388037');" onmouseout="out('4811926455019388037');" style=""> 359     private static final String WIDGET_PREFIX = &quot;Widget:&quot;;                                               </span>
<span class="7268385195460645965" onmouseenter="enter('7268385195460645965');" onmouseout="out('7268385195460645965');" style=""> 360     private static final String SHORTCUT_PREFIX = &quot;Shortcut:&quot;;                                           </span>
<span  style=""> 361                                                                                                          </span>
<span class="2901805684811435457" onmouseenter="enter('2901805684811435457');" onmouseout="out('2901805684811435457');" style=""> 362     private static String getObjectName(Object o) {                                                      </span>
<span class="5690762498529732972" onmouseenter="enter('5690762498529732972');" onmouseout="out('5690762498529732972');" style=""> 363         // should cache the string builder                                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 364         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="2095302661605249065" onmouseenter="enter('2095302661605249065');" onmouseout="out('2095302661605249065');" style=""> 365         String output;                                                                                   </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 366         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-8383311757247800402" onmouseenter="enter('-8383311757247800402');" onmouseout="out('-8383311757247800402');" style=""> 367             sb.append(WIDGET_PREFIX);                                                                    </span>
<span class="594215244520332131" onmouseenter="enter('594215244520332131');" onmouseout="out('594215244520332131');" style=""> 368             sb.append(((AppWidgetProviderInfo) o).toString());                                           </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 369             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 370             sb.setLength(0);                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 371         } else {                                                                                         </span>
<span class="5925999772645605802" onmouseenter="enter('5925999772645605802');" onmouseout="out('5925999772645605802');" style=""> 372             sb.append(SHORTCUT_PREFIX);                                                                  </span>
<span  style=""> 373                                                                                                          </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 374             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="8259534413479453259" onmouseenter="enter('8259534413479453259');" onmouseout="out('8259534413479453259');" style=""> 375             sb.append(new ComponentName(info.activityInfo.packageName,                                   </span>
<span class="-4000685798969561860" onmouseenter="enter('-4000685798969561860');" onmouseout="out('-4000685798969561860');" style=""> 376                     info.activityInfo.name).flattenToString());                                          </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 377             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 378             sb.setLength(0);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379         }                                                                                                </span>
<span class="3622623857335300211" onmouseenter="enter('3622623857335300211');" onmouseout="out('3622623857335300211');" style=""> 380         return output;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381     }                                                                                                    </span>
<span  style=""> 382                                                                                                          </span>
<span class="4198392565151889664" onmouseenter="enter('4198392565151889664');" onmouseout="out('4198392565151889664');" style=""> 383     private String getObjectPackage(Object o) {                                                          </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 384         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-447589032913714129" onmouseenter="enter('-447589032913714129');" onmouseout="out('-447589032913714129');" style=""> 385             return ((AppWidgetProviderInfo) o).provider.getPackageName();                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 386         } else {                                                                                         </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 387             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="-2114723670528030181" onmouseenter="enter('-2114723670528030181');" onmouseout="out('-2114723670528030181');" style=""> 388             return info.activityInfo.packageName;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390     }                                                                                                    </span>
<span  style=""> 391                                                                                                          </span>
<span class="8368345736666686335" onmouseenter="enter('8368345736666686335');" onmouseout="out('8368345736666686335');" style=""> 392     private void writeToDb(Object o, Bitmap preview) {                                                   </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 393         String name = getObjectName(o);                                                                  </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 394         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 395         ContentValues values = new ContentValues();                                                      </span>
<span  style=""> 396                                                                                                          </span>
<span class="-3178925289150814226" onmouseenter="enter('-3178925289150814226');" onmouseout="out('-3178925289150814226');" style=""> 397         values.put(CacheDb.COLUMN_NAME, name);                                                           </span>
<span class="3456914836247516446" onmouseenter="enter('3456914836247516446');" onmouseout="out('3456914836247516446');" style=""> 398         ByteArrayOutputStream stream = new ByteArrayOutputStream();                                      </span>
<span class="5496434693797867526" onmouseenter="enter('5496434693797867526');" onmouseout="out('5496434693797867526');" style=""> 399         preview.compress(Bitmap.CompressFormat.PNG, 100, stream);                                        </span>
<span class="9194176376821213638" onmouseenter="enter('9194176376821213638');" onmouseout="out('9194176376821213638');" style=""> 400         values.put(CacheDb.COLUMN_PREVIEW_BITMAP, stream.toByteArray());                                 </span>
<span class="5882768875063958466" onmouseenter="enter('5882768875063958466');" onmouseout="out('5882768875063958466');" style=""> 401         values.put(CacheDb.COLUMN_SIZE, mSize);                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 402         try {                                                                                            </span>
<span class="3018412397769192796" onmouseenter="enter('3018412397769192796');" onmouseout="out('3018412397769192796');" style=""> 403             db.insert(CacheDb.TABLE_NAME, null, values);                                                 </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 404         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 405             recreateDb();                                                                                </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 406         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 407             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 408             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410     }                                                                                                    </span>
<span  style=""> 411                                                                                                          </span>
<span class="8392297522310828664" onmouseenter="enter('8392297522310828664');" onmouseout="out('8392297522310828664');" style=""> 412     private void clearDb() {                                                                             </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 413         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="904405929570850953" onmouseenter="enter('904405929570850953');" onmouseout="out('904405929570850953');" style=""> 414         // Delete everything                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 415         try {                                                                                            </span>
<span class="3968467922888620985" onmouseenter="enter('3968467922888620985');" onmouseout="out('3968467922888620985');" style=""> 416             db.delete(CacheDb.TABLE_NAME, null, null);                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 417         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 418         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 419             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 420             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422     }                                                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="-8805069561924159073" onmouseenter="enter('-8805069561924159073');" onmouseout="out('-8805069561924159073');" style=""> 424     public static void removePackageFromDb(final CacheDb cacheDb, final String packageName) {            </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 425         synchronized(sInvalidPackages) {                                                                 </span>
<span class="-5575213275928168943" onmouseenter="enter('-5575213275928168943');" onmouseout="out('-5575213275928168943');" style=""> 426             sInvalidPackages.add(packageName);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427         }                                                                                                </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 428         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 429             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 430                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 431                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 432                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7113429213384324763" onmouseenter="enter('7113429213384324763');" onmouseout="out('7113429213384324763');" style=""> 433                             CacheDb.COLUMN_NAME + &quot; LIKE ? OR &quot; +                                        </span>
<span class="8833124058792802926" onmouseenter="enter('8833124058792802926');" onmouseout="out('8833124058792802926');" style=""> 434                             CacheDb.COLUMN_NAME + &quot; LIKE ?&quot;, // SELECT query                             </span>
<span class="6575814019251974640" onmouseenter="enter('6575814019251974640');" onmouseout="out('6575814019251974640');" style=""> 435                             new String[] {                                                               </span>
<span class="-1005195456334514714" onmouseenter="enter('-1005195456334514714');" onmouseout="out('-1005195456334514714');" style=""> 436                                     WIDGET_PREFIX + packageName + &quot;/%&quot;,                                  </span>
<span class="7638587366414932409" onmouseenter="enter('7638587366414932409');" onmouseout="out('7638587366414932409');" style=""> 437                                     SHORTCUT_PREFIX + packageName + &quot;/%&quot;                                 </span>
<span class="6370673901196405011" onmouseenter="enter('6370673901196405011');" onmouseout="out('6370673901196405011');" style=""> 438                             } // args to SELECT query                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 439                     );                                                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 440                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 441                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 442                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 443                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444                 }                                                                                        </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 445                 synchronized(sInvalidPackages) {                                                         </span>
<span class="683140179110979858" onmouseenter="enter('683140179110979858');" onmouseout="out('683140179110979858');" style=""> 446                     sInvalidPackages.remove(packageName);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 448                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 450         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451     }                                                                                                    </span>
<span  style=""> 452                                                                                                          </span>
<span class="-429228780021119422" onmouseenter="enter('-429228780021119422');" onmouseout="out('-429228780021119422');" style=""> 453     private static void removeItemFromDb(final CacheDb cacheDb, final String objectName) {               </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 454         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 455             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 456                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 457                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 458                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7230732652281167865" onmouseenter="enter('7230732652281167865');" onmouseout="out('7230732652281167865');" style=""> 459                             CacheDb.COLUMN_NAME + &quot; = ? &quot;, // SELECT query                               </span>
<span class="-5686609646644956814" onmouseenter="enter('-5686609646644956814');" onmouseout="out('-5686609646644956814');" style=""> 460                             new String[] { objectName }); // args to SELECT query                        </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 461                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 462                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 463                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 464                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 466                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 468         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469     }                                                                                                    </span>
<span  style=""> 470                                                                                                          </span>
<span class="-5397085010036489521" onmouseenter="enter('-5397085010036489521');" onmouseout="out('-5397085010036489521');" style=""> 471     private Bitmap readFromDb(String name, Bitmap b) {                                                   </span>
<span class="-6915248341892392088" onmouseenter="enter('-6915248341892392088');" onmouseout="out('-6915248341892392088');" style=""> 472         if (mCachedSelectQuery == null) {                                                                </span>
<span class="8500727054799765575" onmouseenter="enter('8500727054799765575');" onmouseout="out('8500727054799765575');" style=""> 473             mCachedSelectQuery = CacheDb.COLUMN_NAME + &quot; = ? AND &quot; +                                     </span>
<span class="-5148548584287535582" onmouseenter="enter('-5148548584287535582');" onmouseout="out('-5148548584287535582');" style=""> 474                     CacheDb.COLUMN_SIZE + &quot; = ?&quot;;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475         }                                                                                                </span>
<span class="-3717850318373004709" onmouseenter="enter('-3717850318373004709');" onmouseout="out('-3717850318373004709');" style=""> 476         SQLiteDatabase db = mDb.getReadableDatabase();                                                   </span>
<span class="2593671339546598036" onmouseenter="enter('2593671339546598036');" onmouseout="out('2593671339546598036');" style=""> 477         Cursor result;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 478         try {                                                                                            </span>
<span class="44832651277024274" onmouseenter="enter('44832651277024274');" onmouseout="out('44832651277024274');" style=""> 479             result = db.query(CacheDb.TABLE_NAME,                                                        </span>
<span class="-8348630863841661561" onmouseenter="enter('-8348630863841661561');" onmouseout="out('-8348630863841661561');" style=""> 480                     new String[] { CacheDb.COLUMN_PREVIEW_BITMAP }, // cols to return                    </span>
<span class="9098744119488497529" onmouseenter="enter('9098744119488497529');" onmouseout="out('9098744119488497529');" style=""> 481                     mCachedSelectQuery, // select query                                                  </span>
<span class="7819507014643484139" onmouseenter="enter('7819507014643484139');" onmouseout="out('7819507014643484139');" style=""> 482                     new String[] { name, mSize }, // args to select query                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 483                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 484                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 485                     null,                                                                                </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 486                     null);                                                                               </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 487         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 488             recreateDb();                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 489             return null;                                                                                 </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 490         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 491             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 492             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493         }                                                                                                </span>
<span class="175106850439522001" onmouseenter="enter('175106850439522001');" onmouseout="out('175106850439522001');" style=""> 494         if (result.getCount() &gt; 0) {                                                                     </span>
<span class="-8233551716377839585" onmouseenter="enter('-8233551716377839585');" onmouseout="out('-8233551716377839585');" style=""> 495             result.moveToFirst();                                                                        </span>
<span class="-8295573450010349547" onmouseenter="enter('-8295573450010349547');" onmouseout="out('-8295573450010349547');" style=""> 496             byte[] blob = result.getBlob(0);                                                             </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 497             result.close();                                                                              </span>
<span class="5422706254339452362" onmouseenter="enter('5422706254339452362');" onmouseout="out('5422706254339452362');" style=""> 498             final BitmapFactory.Options opts = mCachedBitmapFactoryOptions.get();                        </span>
<span class="-4203120540780740867" onmouseenter="enter('-4203120540780740867');" onmouseout="out('-4203120540780740867');" style=""> 499             opts.inBitmap = b;                                                                           </span>
<span class="5746761561761774101" onmouseenter="enter('5746761561761774101');" onmouseout="out('5746761561761774101');" style=""> 500             opts.inSampleSize = 1;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 501             try {                                                                                        </span>
<span class="5467059833557948093" onmouseenter="enter('5467059833557948093');" onmouseout="out('5467059833557948093');" style=""> 502                 return BitmapFactory.decodeByteArray(blob, 0, blob.length, opts);                        </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 503             } catch (IllegalArgumentException e) {                                                       </span>
<span class="-8663451629875904419" onmouseenter="enter('-8663451629875904419');" onmouseout="out('-8663451629875904419');" style=""> 504                 removeItemFromDb(mDb, name);                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 505                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 507         } else {                                                                                         </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 508             result.close();                                                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 509             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511     }                                                                                                    </span>
<span  style=""> 512                                                                                                          </span>
<span class="-4571373922604646261" onmouseenter="enter('-4571373922604646261');" onmouseout="out('-4571373922604646261');" style=""> 513     private Bitmap generatePreview(Object info, Bitmap preview) {                                        </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 514         if (preview != null &amp;&amp;                                                                           </span>
<span class="-4427245060729789933" onmouseenter="enter('-4427245060729789933');" onmouseout="out('-4427245060729789933');" style=""> 515                 (preview.getWidth() != mPreviewBitmapWidth ||                                            </span>
<span class="-7111303570896946504" onmouseenter="enter('-7111303570896946504');" onmouseout="out('-7111303570896946504');" style=""> 516                 preview.getHeight() != mPreviewBitmapHeight)) {                                          </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 517             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518         }                                                                                                </span>
<span class="-3932360089392842216" onmouseenter="enter('-3932360089392842216');" onmouseout="out('-3932360089392842216');" style=""> 519         if (info instanceof AppWidgetProviderInfo) {                                                     </span>
<span class="-6841541424186777283" onmouseenter="enter('-6841541424186777283');" onmouseout="out('-6841541424186777283');" style=""> 520             return generateWidgetPreview((AppWidgetProviderInfo) info, preview);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 521         } else {                                                                                         </span>
<span class="5830651867016154139" onmouseenter="enter('5830651867016154139');" onmouseout="out('5830651867016154139');" style=""> 522             return generateShortcutPreview(                                                              </span>
<span class="5884922488800788426" onmouseenter="enter('5884922488800788426');" onmouseout="out('5884922488800788426');" style=""> 523                     (ResolveInfo) info, mPreviewBitmapWidth, mPreviewBitmapHeight, preview);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525     }                                                                                                    </span>
<span  style=""> 526                                                                                                          </span>
<span class="6578518467799953308" onmouseenter="enter('6578518467799953308');" onmouseout="out('6578518467799953308');" style=""> 527     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, Bitmap preview) {                    </span>
<span class="9147821438266271134" onmouseenter="enter('9147821438266271134');" onmouseout="out('9147821438266271134');" style=""> 528         int[] cellSpans = Launcher.getSpanForWidget(mContext, info);                                     </span>
<span class="-1431657331442958147" onmouseenter="enter('-1431657331442958147');" onmouseout="out('-1431657331442958147');" style=""> 529         int maxWidth = maxWidthForWidgetPreview(cellSpans[0]);                                           </span>
<span class="-6135167628743317243" onmouseenter="enter('-6135167628743317243');" onmouseout="out('-6135167628743317243');" style=""> 530         int maxHeight = maxHeightForWidgetPreview(cellSpans[1]);                                         </span>
<span class="-6510989053235413139" onmouseenter="enter('-6510989053235413139');" onmouseout="out('-6510989053235413139');" style=""> 531         return generateWidgetPreview(info, cellSpans[0], cellSpans[1],                                   </span>
<span class="5560351977065436698" onmouseenter="enter('5560351977065436698');" onmouseout="out('5560351977065436698');" style=""> 532                 maxWidth, maxHeight, preview, null);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533     }                                                                                                    </span>
<span  style=""> 534                                                                                                          </span>
<span class="-4962504510381054079" onmouseenter="enter('-4962504510381054079');" onmouseout="out('-4962504510381054079');" style=""> 535     public int maxWidthForWidgetPreview(int spanX) {                                                     </span>
<span class="5345170673015378699" onmouseenter="enter('5345170673015378699');" onmouseout="out('5345170673015378699');" style=""> 536         return Math.min(mPreviewBitmapWidth,                                                             </span>
<span class="-7096108314182907064" onmouseenter="enter('-7096108314182907064');" onmouseout="out('-7096108314182907064');" style=""> 537                 mWidgetSpacingLayout.estimateCellWidth(spanX));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538     }                                                                                                    </span>
<span  style=""> 539                                                                                                          </span>
<span class="-516047466055903408" onmouseenter="enter('-516047466055903408');" onmouseout="out('-516047466055903408');" style=""> 540     public int maxHeightForWidgetPreview(int spanY) {                                                    </span>
<span class="8958196798141008482" onmouseenter="enter('8958196798141008482');" onmouseout="out('8958196798141008482');" style=""> 541         return Math.min(mPreviewBitmapHeight,                                                            </span>
<span class="-8176698640675478774" onmouseenter="enter('-8176698640675478774');" onmouseout="out('-8176698640675478774');" style=""> 542                 mWidgetSpacingLayout.estimateCellHeight(spanY));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543     }                                                                                                    </span>
<span  style=""> 544                                                                                                          </span>
<span class="-6895334532662888649" onmouseenter="enter('-6895334532662888649');" onmouseout="out('-6895334532662888649');" style=""> 545     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, int cellHSpan, int cellVSpan,        </span>
<span class="-5508121118873891580" onmouseenter="enter('-5508121118873891580');" onmouseout="out('-5508121118873891580');" style=""> 546             int maxPreviewWidth, int maxPreviewHeight, Bitmap preview, int[] preScaledWidthOut) {        </span>
<span class="2529916654704436428" onmouseenter="enter('2529916654704436428');" onmouseout="out('2529916654704436428');" style=""> 547         // Load the preview image if possible                                                            </span>
<span class="931456242657570009" onmouseenter="enter('931456242657570009');" onmouseout="out('931456242657570009');" style=""> 548         if (maxPreviewWidth &lt; 0) maxPreviewWidth = Integer.MAX_VALUE;                                    </span>
<span class="-3276405287943718338" onmouseenter="enter('-3276405287943718338');" onmouseout="out('-3276405287943718338');" style=""> 549         if (maxPreviewHeight &lt; 0) maxPreviewHeight = Integer.MAX_VALUE;                                  </span>
<span  style=""> 550                                                                                                          </span>
<span class="-3049333615145638519" onmouseenter="enter('-3049333615145638519');" onmouseout="out('-3049333615145638519');" style=""> 551         Drawable drawable = null;                                                                        </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 552         if (info.previewImage != 0) {                                                                    </span>
<span class="-6995452363019574294" onmouseenter="enter('-6995452363019574294');" onmouseout="out('-6995452363019574294');" style=""> 553             drawable = mManager.loadPreview(info);                                                       </span>
<span class="281943916213481387" onmouseenter="enter('281943916213481387');" onmouseout="out('281943916213481387');" style=""> 554             if (drawable != null) {                                                                      </span>
<span class="559582177948747235" onmouseenter="enter('559582177948747235');" onmouseout="out('559582177948747235');" style=""> 555                 drawable = mutateOnMainThread(drawable);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 556             } else {                                                                                     </span>
<span class="7073909505336594696" onmouseenter="enter('7073909505336594696');" onmouseout="out('7073909505336594696');" style=""> 557                 Log.w(TAG, &quot;Can&#x27;t load widget preview drawable 0x&quot; +                                     </span>
<span class="-4346717227149782469" onmouseenter="enter('-4346717227149782469');" onmouseout="out('-4346717227149782469');" style=""> 558                         Integer.toHexString(info.previewImage) + &quot; for provider: &quot; + info.provider);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560         }                                                                                                </span>
<span  style=""> 561                                                                                                          </span>
<span class="5985266596175165266" onmouseenter="enter('5985266596175165266');" onmouseout="out('5985266596175165266');" style=""> 562         int previewWidth;                                                                                </span>
<span class="-7312246595783828327" onmouseenter="enter('-7312246595783828327');" onmouseout="out('-7312246595783828327');" style=""> 563         int previewHeight;                                                                               </span>
<span class="5524531081830166723" onmouseenter="enter('5524531081830166723');" onmouseout="out('5524531081830166723');" style=""> 564         Bitmap defaultPreview = null;                                                                    </span>
<span class="5121594519432393069" onmouseenter="enter('5121594519432393069');" onmouseout="out('5121594519432393069');" style=""> 565         boolean widgetPreviewExists = (drawable != null);                                                </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 566         if (widgetPreviewExists) {                                                                       </span>
<span class="7694696434619666028" onmouseenter="enter('7694696434619666028');" onmouseout="out('7694696434619666028');" style=""> 567             previewWidth = drawable.getIntrinsicWidth();                                                 </span>
<span class="-5860514303309291265" onmouseenter="enter('-5860514303309291265');" onmouseout="out('-5860514303309291265');" style=""> 568             previewHeight = drawable.getIntrinsicHeight();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 569         } else {                                                                                         </span>
<span class="7833733472444702454" onmouseenter="enter('7833733472444702454');" onmouseout="out('7833733472444702454');" style=""> 570             // Generate a preview image if we couldn&#x27;t load one                                          </span>
<span class="-8710794757779095209" onmouseenter="enter('-8710794757779095209');" onmouseout="out('-8710794757779095209');" style=""> 571             if (cellHSpan &lt; 1) cellHSpan = 1;                                                            </span>
<span class="-779725371469556670" onmouseenter="enter('-779725371469556670');" onmouseout="out('-779725371469556670');" style=""> 572             if (cellVSpan &lt; 1) cellVSpan = 1;                                                            </span>
<span  style=""> 573                                                                                                          </span>
<span class="3565276356973562387" onmouseenter="enter('3565276356973562387');" onmouseout="out('3565276356973562387');" style=""> 574             // This Drawable is not directly drawn, so there&#x27;s no need to mutate it.                     </span>
<span class="-5021189500908681979" onmouseenter="enter('-5021189500908681979');" onmouseout="out('-5021189500908681979');" style=""> 575             BitmapDrawable previewDrawable = (BitmapDrawable) mContext.getResources()                    </span>
<span class="3152690746910736269" onmouseenter="enter('3152690746910736269');" onmouseout="out('3152690746910736269');" style=""> 576                     .getDrawable(R.drawable.widget_tile);                                                </span>
<span class="-5932659289331905035" onmouseenter="enter('-5932659289331905035');" onmouseout="out('-5932659289331905035');" style=""> 577             final int previewDrawableWidth = previewDrawable                                             </span>
<span class="-5783669958167413803" onmouseenter="enter('-5783669958167413803');" onmouseout="out('-5783669958167413803');" style=""> 578                     .getIntrinsicWidth();                                                                </span>
<span class="4431322150991047787" onmouseenter="enter('4431322150991047787');" onmouseout="out('4431322150991047787');" style=""> 579             final int previewDrawableHeight = previewDrawable                                            </span>
<span class="4098769707366186014" onmouseenter="enter('4098769707366186014');" onmouseout="out('4098769707366186014');" style=""> 580                     .getIntrinsicHeight();                                                               </span>
<span class="8887455390458335872" onmouseenter="enter('8887455390458335872');" onmouseout="out('8887455390458335872');" style=""> 581             previewWidth = previewDrawableWidth * cellHSpan;                                             </span>
<span class="-8341882922226410648" onmouseenter="enter('-8341882922226410648');" onmouseout="out('-8341882922226410648');" style=""> 582             previewHeight = previewDrawableHeight * cellVSpan;                                           </span>
<span  style=""> 583                                                                                                          </span>
<span class="-737373095753296600" onmouseenter="enter('-737373095753296600');" onmouseout="out('-737373095753296600');" style=""> 584             defaultPreview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 585             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="848607727045658162" onmouseenter="enter('848607727045658162');" onmouseout="out('848607727045658162');" style=""> 586             c.setBitmap(defaultPreview);                                                                 </span>
<span class="4673250187052598192" onmouseenter="enter('4673250187052598192');" onmouseout="out('4673250187052598192');" style=""> 587             Paint p = mDefaultAppWidgetPreviewPaint.get();                                               </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 588             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 589                 p = new Paint();                                                                         </span>
<span class="9031053372645621365" onmouseenter="enter('9031053372645621365');" onmouseout="out('9031053372645621365');" style=""> 590                 p.setShader(new BitmapShader(previewDrawable.getBitmap(),                                </span>
<span class="1595910380715064067" onmouseenter="enter('1595910380715064067');" onmouseout="out('1595910380715064067');" style=""> 591                         Shader.TileMode.REPEAT, Shader.TileMode.REPEAT));                                </span>
<span class="-8603584172680459929" onmouseenter="enter('-8603584172680459929');" onmouseout="out('-8603584172680459929');" style=""> 592                 mDefaultAppWidgetPreviewPaint.set(p);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593             }                                                                                            </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 594             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="4633920667503149983" onmouseenter="enter('4633920667503149983');" onmouseout="out('4633920667503149983');" style=""> 595             dest.set(0, 0, previewWidth, previewHeight);                                                 </span>
<span class="-470581757098027879" onmouseenter="enter('-470581757098027879');" onmouseout="out('-470581757098027879');" style=""> 596             c.drawRect(dest, p);                                                                         </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 597             c.setBitmap(null);                                                                           </span>
<span  style=""> 598                                                                                                          </span>
<span class="4647625888602990242" onmouseenter="enter('4647625888602990242');" onmouseout="out('4647625888602990242');" style=""> 599             // Draw the icon in the top left corner                                                      </span>
<span class="3531213633716353102" onmouseenter="enter('3531213633716353102');" onmouseout="out('3531213633716353102');" style=""> 600             int minOffset = (int) (mAppIconSize * WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE);               </span>
<span class="-3256500215342314396" onmouseenter="enter('-3256500215342314396');" onmouseout="out('-3256500215342314396');" style=""> 601             int smallestSide = Math.min(previewWidth, previewHeight);                                    </span>
<span class="1098745458783687815" onmouseenter="enter('1098745458783687815');" onmouseout="out('1098745458783687815');" style=""> 602             float iconScale = Math.min((float) smallestSide                                              </span>
<span class="7317986328586297721" onmouseenter="enter('7317986328586297721');" onmouseout="out('7317986328586297721');" style=""> 603                     / (mAppIconSize + 2 * minOffset), 1f);                                               </span>
<span  style=""> 604                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 605             try {                                                                                        </span>
<span class="-837531234335200976" onmouseenter="enter('-837531234335200976');" onmouseout="out('-837531234335200976');" style=""> 606                 Drawable icon = mManager.loadIcon(info, mIconCache);                                     </span>
<span class="-4192144256919602329" onmouseenter="enter('-4192144256919602329');" onmouseout="out('-4192144256919602329');" style=""> 607                 if (icon != null) {                                                                      </span>
<span class="-1224594640800103937" onmouseenter="enter('-1224594640800103937');" onmouseout="out('-1224594640800103937');" style=""> 608                     int hoffset = (int) ((previewDrawableWidth - mAppIconSize * iconScale) / 2);         </span>
<span class="-389205104576287013" onmouseenter="enter('-389205104576287013');" onmouseout="out('-389205104576287013');" style=""> 609                     int yoffset = (int) ((previewDrawableHeight - mAppIconSize * iconScale) / 2);        </span>
<span class="-867380701080615138" onmouseenter="enter('-867380701080615138');" onmouseout="out('-867380701080615138');" style=""> 610                     icon = mutateOnMainThread(icon);                                                     </span>
<span class="1665310338408239466" onmouseenter="enter('1665310338408239466');" onmouseout="out('1665310338408239466');" style=""> 611                     renderDrawableToBitmap(icon, defaultPreview, hoffset,                                </span>
<span class="8191900375173585890" onmouseenter="enter('8191900375173585890');" onmouseout="out('8191900375173585890');" style=""> 612                             yoffset, (int) (mAppIconSize * iconScale),                                   </span>
<span class="-5886521530151300680" onmouseenter="enter('-5886521530151300680');" onmouseout="out('-5886521530151300680');" style=""> 613                             (int) (mAppIconSize * iconScale));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614                 }                                                                                        </span>
<span class="5183756364953253383" onmouseenter="enter('5183756364953253383');" onmouseout="out('5183756364953253383');" style=""> 615             } catch (Resources.NotFoundException e) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span  style=""> 618                                                                                                          </span>
<span class="6949857229431854068" onmouseenter="enter('6949857229431854068');" onmouseout="out('6949857229431854068');" style=""> 619         // Scale to fit width only - let the widget preview be clipped in the                            </span>
<span class="8360805034192073884" onmouseenter="enter('8360805034192073884');" onmouseout="out('8360805034192073884');" style=""> 620         // vertical dimension                                                                            </span>
<span class="-8224051742145745082" onmouseenter="enter('-8224051742145745082');" onmouseout="out('-8224051742145745082');" style=""> 621         float scale = 1f;                                                                                </span>
<span class="6149434037546525815" onmouseenter="enter('6149434037546525815');" onmouseout="out('6149434037546525815');" style=""> 622         if (preScaledWidthOut != null) {                                                                 </span>
<span class="2306433834272734783" onmouseenter="enter('2306433834272734783');" onmouseout="out('2306433834272734783');" style=""> 623             preScaledWidthOut[0] = previewWidth;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624         }                                                                                                </span>
<span class="-7638941371937567348" onmouseenter="enter('-7638941371937567348');" onmouseout="out('-7638941371937567348');" style=""> 625         if (previewWidth &gt; maxPreviewWidth) {                                                            </span>
<span class="-6167807034013491459" onmouseenter="enter('-6167807034013491459');" onmouseout="out('-6167807034013491459');" style=""> 626             scale = maxPreviewWidth / (float) previewWidth;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span class="-8893868344639903626" onmouseenter="enter('-8893868344639903626');" onmouseout="out('-8893868344639903626');" style=""> 628         if (scale != 1f) {                                                                               </span>
<span class="-6338970909485118519" onmouseenter="enter('-6338970909485118519');" onmouseout="out('-6338970909485118519');" style=""> 629             previewWidth = (int) (scale * previewWidth);                                                 </span>
<span class="2442469555843251122" onmouseenter="enter('2442469555843251122');" onmouseout="out('2442469555843251122');" style=""> 630             previewHeight = (int) (scale * previewHeight);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631         }                                                                                                </span>
<span  style=""> 632                                                                                                          </span>
<span class="-1124372066791938196" onmouseenter="enter('-1124372066791938196');" onmouseout="out('-1124372066791938196');" style=""> 633         // If a bitmap is passed in, we use it; otherwise, we create a bitmap of the right size          </span>
<span class="2486895102595751802" onmouseenter="enter('2486895102595751802');" onmouseout="out('2486895102595751802');" style=""> 634         if (preview == null) {                                                                           </span>
<span class="6637154682204057097" onmouseenter="enter('6637154682204057097');" onmouseout="out('6637154682204057097');" style=""> 635             preview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636         }                                                                                                </span>
<span  style=""> 637                                                                                                          </span>
<span class="-2080916171919384218" onmouseenter="enter('-2080916171919384218');" onmouseout="out('-2080916171919384218');" style=""> 638         // Draw the scaled preview into the final bitmap                                                 </span>
<span class="3369675460464663159" onmouseenter="enter('3369675460464663159');" onmouseout="out('3369675460464663159');" style=""> 639         int x = (preview.getWidth() - previewWidth) / 2;                                                 </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 640         if (widgetPreviewExists) {                                                                       </span>
<span class="-6966420244976420379" onmouseenter="enter('-6966420244976420379');" onmouseout="out('-6966420244976420379');" style=""> 641             renderDrawableToBitmap(drawable, preview, x, 0, previewWidth,                                </span>
<span class="-7548196549309427555" onmouseenter="enter('-7548196549309427555');" onmouseout="out('-7548196549309427555');" style=""> 642                     previewHeight);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 643         } else {                                                                                         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 644             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="5281190707868665361" onmouseenter="enter('5281190707868665361');" onmouseout="out('5281190707868665361');" style=""> 645             final Rect src = mCachedAppWidgetPreviewSrcRect.get();                                       </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 646             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 647             c.setBitmap(preview);                                                                        </span>
<span class="-8725434908843264237" onmouseenter="enter('-8725434908843264237');" onmouseout="out('-8725434908843264237');" style=""> 648             src.set(0, 0, defaultPreview.getWidth(), defaultPreview.getHeight());                        </span>
<span class="-7071368679565427433" onmouseenter="enter('-7071368679565427433');" onmouseout="out('-7071368679565427433');" style=""> 649             dest.set(x, 0, x + previewWidth, previewHeight);                                             </span>
<span  style=""> 650                                                                                                          </span>
<span class="5839465204107083552" onmouseenter="enter('5839465204107083552');" onmouseout="out('5839465204107083552');" style=""> 651             Paint p = mCachedAppWidgetPreviewPaint.get();                                                </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 652             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 653                 p = new Paint();                                                                         </span>
<span class="-3846510342158419561" onmouseenter="enter('-3846510342158419561');" onmouseout="out('-3846510342158419561');" style=""> 654                 p.setFilterBitmap(true);                                                                 </span>
<span class="8711891207106027486" onmouseenter="enter('8711891207106027486');" onmouseout="out('8711891207106027486');" style=""> 655                 mCachedAppWidgetPreviewPaint.set(p);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656             }                                                                                            </span>
<span class="-8322704971015823035" onmouseenter="enter('-8322704971015823035');" onmouseout="out('-8322704971015823035');" style=""> 657             c.drawBitmap(defaultPreview, src, dest, p);                                                  </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 658             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659         }                                                                                                </span>
<span class="-5318059876677185928" onmouseenter="enter('-5318059876677185928');" onmouseout="out('-5318059876677185928');" style=""> 660         return mManager.getBadgeBitmap(info, preview);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661     }                                                                                                    </span>
<span  style=""> 662                                                                                                          </span>
<span class="-2036338097340155865" onmouseenter="enter('-2036338097340155865');" onmouseout="out('-2036338097340155865');" style=""> 663     private Bitmap generateShortcutPreview(                                                              </span>
<span class="1557751875108084858" onmouseenter="enter('1557751875108084858');" onmouseout="out('1557751875108084858');" style=""> 664             ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview) {                             </span>
<span class="6669617465194046785" onmouseenter="enter('6669617465194046785');" onmouseout="out('6669617465194046785');" style=""> 665         Bitmap tempBitmap = mCachedShortcutPreviewBitmap.get();                                          </span>
<span class="8492580593566939346" onmouseenter="enter('8492580593566939346');" onmouseout="out('8492580593566939346');" style=""> 666         final Canvas c = mCachedShortcutPreviewCanvas.get();                                             </span>
<span class="3344452031699903410" onmouseenter="enter('3344452031699903410');" onmouseout="out('3344452031699903410');" style=""> 667         if (tempBitmap == null ||                                                                        </span>
<span class="-1798938713535043835" onmouseenter="enter('-1798938713535043835');" onmouseout="out('-1798938713535043835');" style=""> 668                 tempBitmap.getWidth() != maxWidth ||                                                     </span>
<span class="9083140300107171771" onmouseenter="enter('9083140300107171771');" onmouseout="out('9083140300107171771');" style=""> 669                 tempBitmap.getHeight() != maxHeight) {                                                   </span>
<span class="5079923942824258796" onmouseenter="enter('5079923942824258796');" onmouseout="out('5079923942824258796');" style=""> 670             tempBitmap = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                     </span>
<span class="3252713296815828481" onmouseenter="enter('3252713296815828481');" onmouseout="out('3252713296815828481');" style=""> 671             mCachedShortcutPreviewBitmap.set(tempBitmap);                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 672         } else {                                                                                         </span>
<span class="2908194814219559361" onmouseenter="enter('2908194814219559361');" onmouseout="out('2908194814219559361');" style=""> 673             c.setBitmap(tempBitmap);                                                                     </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 674             c.drawColor(0, PorterDuff.Mode.CLEAR);                                                       </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 675             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676         }                                                                                                </span>
<span class="-895750054343748789" onmouseenter="enter('-895750054343748789');" onmouseout="out('-895750054343748789');" style=""> 677         // Render the icon                                                                               </span>
<span class="-8632811780119956337" onmouseenter="enter('-8632811780119956337');" onmouseout="out('-8632811780119956337');" style=""> 678         Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info.activityInfo));                </span>
<span  style=""> 679                                                                                                          </span>
<span class="-7461308767564647078" onmouseenter="enter('-7461308767564647078');" onmouseout="out('-7461308767564647078');" style=""> 680         int paddingTop = mContext.                                                                       </span>
<span class="-5900363241936444267" onmouseenter="enter('-5900363241936444267');" onmouseout="out('-5900363241936444267');" style=""> 681                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);            </span>
<span class="5781485035466420663" onmouseenter="enter('5781485035466420663');" onmouseout="out('5781485035466420663');" style=""> 682         int paddingLeft = mContext.                                                                      </span>
<span class="2328331898560910495" onmouseenter="enter('2328331898560910495');" onmouseout="out('2328331898560910495');" style=""> 683                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);           </span>
<span class="5829344697485851220" onmouseenter="enter('5829344697485851220');" onmouseout="out('5829344697485851220');" style=""> 684         int paddingRight = mContext.                                                                     </span>
<span class="-8885288017836034916" onmouseenter="enter('-8885288017836034916');" onmouseout="out('-8885288017836034916');" style=""> 685                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);          </span>
<span  style=""> 686                                                                                                          </span>
<span class="9041541765806161530" onmouseenter="enter('9041541765806161530');" onmouseout="out('9041541765806161530');" style=""> 687         int scaledIconWidth = (maxWidth - paddingLeft - paddingRight);                                   </span>
<span  style=""> 688                                                                                                          </span>
<span class="3221827998305751243" onmouseenter="enter('3221827998305751243');" onmouseout="out('3221827998305751243');" style=""> 689         renderDrawableToBitmap(                                                                          </span>
<span class="5202977166144268859" onmouseenter="enter('5202977166144268859');" onmouseout="out('5202977166144268859');" style=""> 690                 icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidth);            </span>
<span  style=""> 691                                                                                                          </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 692         if (preview != null &amp;&amp;                                                                           </span>
<span class="-4616488258627842412" onmouseenter="enter('-4616488258627842412');" onmouseout="out('-4616488258627842412');" style=""> 693                 (preview.getWidth() != maxWidth || preview.getHeight() != maxHeight)) {                  </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 694             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="3365320965403910466" onmouseenter="enter('3365320965403910466');" onmouseout="out('3365320965403910466');" style=""> 695         } else if (preview == null) {                                                                    </span>
<span class="4551594767613519312" onmouseenter="enter('4551594767613519312');" onmouseout="out('4551594767613519312');" style=""> 696             preview = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697         }                                                                                                </span>
<span  style=""> 698                                                                                                          </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 699         c.setBitmap(preview);                                                                            </span>
<span class="8934981767024497500" onmouseenter="enter('8934981767024497500');" onmouseout="out('8934981767024497500');" style=""> 700         // Draw a desaturated/scaled version of the icon in the background as a watermark                </span>
<span class="-518774087151586601" onmouseenter="enter('-518774087151586601');" onmouseout="out('-518774087151586601');" style=""> 701         Paint p = mCachedShortcutPreviewPaint.get();                                                     </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 702         if (p == null) {                                                                                 </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 703             p = new Paint();                                                                             </span>
<span class="5185800516692981036" onmouseenter="enter('5185800516692981036');" onmouseout="out('5185800516692981036');" style=""> 704             ColorMatrix colorMatrix = new ColorMatrix();                                                 </span>
<span class="-4096104009908534310" onmouseenter="enter('-4096104009908534310');" onmouseout="out('-4096104009908534310');" style=""> 705             colorMatrix.setSaturation(0);                                                                </span>
<span class="-2105686232381577699" onmouseenter="enter('-2105686232381577699');" onmouseout="out('-2105686232381577699');" style=""> 706             p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));                                   </span>
<span class="-725456443631950326" onmouseenter="enter('-725456443631950326');" onmouseout="out('-725456443631950326');" style=""> 707             p.setAlpha((int) (255 * 0.06f));                                                             </span>
<span class="-4885683919835504124" onmouseenter="enter('-4885683919835504124');" onmouseout="out('-4885683919835504124');" style=""> 708             mCachedShortcutPreviewPaint.set(p);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709         }                                                                                                </span>
<span class="-4554115702547152566" onmouseenter="enter('-4554115702547152566');" onmouseout="out('-4554115702547152566');" style=""> 710         c.drawBitmap(tempBitmap, 0, 0, p);                                                               </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 711         c.setBitmap(null);                                                                               </span>
<span  style=""> 712                                                                                                          </span>
<span class="-5738465230776990197" onmouseenter="enter('-5738465230776990197');" onmouseout="out('-5738465230776990197');" style=""> 713         renderDrawableToBitmap(icon, preview, 0, 0, mAppIconSize, mAppIconSize);                         </span>
<span  style=""> 714                                                                                                          </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 715         return preview;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716     }                                                                                                    </span>
<span  style=""> 717                                                                                                          </span>
<span class="-2512069815104909632" onmouseenter="enter('-2512069815104909632');" onmouseout="out('-2512069815104909632');" style=""> 718     private static void renderDrawableToBitmap(                                                          </span>
<span class="-281586385806654310" onmouseenter="enter('-281586385806654310');" onmouseout="out('-281586385806654310');" style=""> 719             Drawable d, Bitmap bitmap, int x, int y, int w, int h) {                                     </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 720         if (bitmap != null) {                                                                            </span>
<span class="417388478829800263" onmouseenter="enter('417388478829800263');" onmouseout="out('417388478829800263');" style=""> 721             Canvas c = new Canvas(bitmap);                                                               </span>
<span class="2629107935702523978" onmouseenter="enter('2629107935702523978');" onmouseout="out('2629107935702523978');" style=""> 722             Rect oldBounds = d.copyBounds();                                                             </span>
<span class="-7883404386706876736" onmouseenter="enter('-7883404386706876736');" onmouseout="out('-7883404386706876736');" style=""> 723             d.setBounds(x, y, x + w, y + h);                                                             </span>
<span class="3763902819788011622" onmouseenter="enter('3763902819788011622');" onmouseout="out('3763902819788011622');" style=""> 724             d.draw(c);                                                                                   </span>
<span class="-5442987023720851592" onmouseenter="enter('-5442987023720851592');" onmouseout="out('-5442987023720851592');" style=""> 725             d.setBounds(oldBounds); // Restore the bounds                                                </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 726             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 728     }                                                                                                    </span>
<span  style=""> 729                                                                                                          </span>
<span class="-2265124982478046254" onmouseenter="enter('-2265124982478046254');" onmouseout="out('-2265124982478046254');" style=""> 730     private Drawable mutateOnMainThread(final Drawable drawable) {                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 731         try {                                                                                            </span>
<span class="3177563387853690691" onmouseenter="enter('3177563387853690691');" onmouseout="out('3177563387853690691');" style=""> 732             return mMainThreadExecutor.submit(new Callable&lt;Drawable&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 733                 @Override                                                                                </span>
<span class="4251206983441278885" onmouseenter="enter('4251206983441278885');" onmouseout="out('4251206983441278885');" style=""> 734                 public Drawable call() throws Exception {                                                </span>
<span class="721315677862243657" onmouseenter="enter('721315677862243657');" onmouseout="out('721315677862243657');" style=""> 735                     return drawable.mutate();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736                 }                                                                                        </span>
<span class="8868058436262798399" onmouseenter="enter('8868058436262798399');" onmouseout="out('8868058436262798399');" style=""> 737             }).get();                                                                                    </span>
<span class="-7528533024404460182" onmouseenter="enter('-7528533024404460182');" onmouseout="out('-7528533024404460182');" style=""> 738         } catch (InterruptedException e) {                                                               </span>
<span class="8315424094067049480" onmouseenter="enter('8315424094067049480');" onmouseout="out('8315424094067049480');" style=""> 739             Thread.currentThread().interrupt();                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 740             throw new RuntimeException(e);                                                               </span>
<span class="-3674505659955768067" onmouseenter="enter('-3674505659955768067');" onmouseout="out('-3674505659955768067');" style=""> 741         } catch (ExecutionException e) {                                                                 </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 742             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744     }                                                                                                    </span>
<span  style=""> 745                                                                                                          </span>
<span class="-1664432510733041020" onmouseenter="enter('-1664432510733041020');" onmouseout="out('-1664432510733041020');" style=""> 746     private static final int MAX_OPEN_FILES = 1024;                                                      </span>
<span class="9072161857204403261" onmouseenter="enter('9072161857204403261');" onmouseout="out('9072161857204403261');" style=""> 747     private static final int SAMPLE_RATE = 23;                                                           </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 748     /**                                                                                                  </span>
<span class="4777297713483982548" onmouseenter="enter('4777297713483982548');" onmouseout="out('4777297713483982548');" style=""> 749      * Dumps all files that are open in this process without allocating a file descriptor.               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 750      */                                                                                                  </span>
<span class="7630668132257036624" onmouseenter="enter('7630668132257036624');" onmouseout="out('7630668132257036624');" style=""> 751     private static void dumpOpenFiles() {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 752         try {                                                                                            </span>
<span class="7095374185665412657" onmouseenter="enter('7095374185665412657');" onmouseout="out('7095374185665412657');" style=""> 753             Log.i(TAG, &quot;DUMP OF OPEN FILES (sample rate: 1 every &quot; + SAMPLE_RATE + &quot;):&quot;);                </span>
<span class="-6063809008451063811" onmouseenter="enter('-6063809008451063811');" onmouseout="out('-6063809008451063811');" style=""> 754             final String TYPE_APK = &quot;apk&quot;;                                                               </span>
<span class="-6901274176875279046" onmouseenter="enter('-6901274176875279046');" onmouseout="out('-6901274176875279046');" style=""> 755             final String TYPE_JAR = &quot;jar&quot;;                                                               </span>
<span class="-4233944286779457769" onmouseenter="enter('-4233944286779457769');" onmouseout="out('-4233944286779457769');" style=""> 756             final String TYPE_PIPE = &quot;pipe&quot;;                                                             </span>
<span class="-7830089877175241432" onmouseenter="enter('-7830089877175241432');" onmouseout="out('-7830089877175241432');" style=""> 757             final String TYPE_SOCKET = &quot;socket&quot;;                                                         </span>
<span class="6234651693695236755" onmouseenter="enter('6234651693695236755');" onmouseout="out('6234651693695236755');" style=""> 758             final String TYPE_DB = &quot;db&quot;;                                                                 </span>
<span class="-6587583242995441423" onmouseenter="enter('-6587583242995441423');" onmouseout="out('-6587583242995441423');" style=""> 759             final String TYPE_ANON_INODE = &quot;anon_inode&quot;;                                                 </span>
<span class="-3500545166621689968" onmouseenter="enter('-3500545166621689968');" onmouseout="out('-3500545166621689968');" style=""> 760             final String TYPE_DEV = &quot;dev&quot;;                                                               </span>
<span class="2067143891119682248" onmouseenter="enter('2067143891119682248');" onmouseout="out('2067143891119682248');" style=""> 761             final String TYPE_NON_FS = &quot;non-fs&quot;;                                                         </span>
<span class="5330062242195911314" onmouseenter="enter('5330062242195911314');" onmouseout="out('5330062242195911314');" style=""> 762             final String TYPE_OTHER = &quot;other&quot;;                                                           </span>
<span class="4846737914738595164" onmouseenter="enter('4846737914738595164');" onmouseout="out('4846737914738595164');" style=""> 763             List&lt;String&gt; types = Arrays.asList(TYPE_APK, TYPE_JAR, TYPE_PIPE, TYPE_SOCKET, TYPE_DB,      </span>
<span class="-1126389211762394977" onmouseenter="enter('-1126389211762394977');" onmouseout="out('-1126389211762394977');" style=""> 764                     TYPE_ANON_INODE, TYPE_DEV, TYPE_NON_FS, TYPE_OTHER);                                 </span>
<span class="7087384337453352553" onmouseenter="enter('7087384337453352553');" onmouseout="out('7087384337453352553');" style=""> 765             int[] count = new int[types.size()];                                                         </span>
<span class="-400567270817057775" onmouseenter="enter('-400567270817057775');" onmouseout="out('-400567270817057775');" style=""> 766             int[] duplicates = new int[types.size()];                                                    </span>
<span class="-5112763339406897335" onmouseenter="enter('-5112763339406897335');" onmouseout="out('-5112763339406897335');" style=""> 767             HashSet&lt;String&gt; files = new HashSet&lt;String&gt;();                                               </span>
<span class="-926962837754337949" onmouseenter="enter('-926962837754337949');" onmouseout="out('-926962837754337949');" style=""> 768             int total = 0;                                                                               </span>
<span class="1028290052541393010" onmouseenter="enter('1028290052541393010');" onmouseout="out('1028290052541393010');" style=""> 769             for (int i = 0; i &lt; MAX_OPEN_FILES; i++) {                                                   </span>
<span class="3040328939873692127" onmouseenter="enter('3040328939873692127');" onmouseout="out('3040328939873692127');" style=""> 770                 // This is a gigantic hack but unfortunately the only way to resolve an fd               </span>
<span class="-4129207097038329090" onmouseenter="enter('-4129207097038329090');" onmouseout="out('-4129207097038329090');" style=""> 771                 // to a file name. Note that we have to loop over all possible fds because               </span>
<span class="6927440074701305186" onmouseenter="enter('6927440074701305186');" onmouseout="out('6927440074701305186');" style=""> 772                 // reading the directory would require allocating a new fd. The kernel is                </span>
<span class="-7335721905258259512" onmouseenter="enter('-7335721905258259512');" onmouseout="out('-7335721905258259512');" style=""> 773                 // currently implemented such that no fd is larger then the current rlimit,              </span>
<span class="5240836059895527485" onmouseenter="enter('5240836059895527485');" onmouseout="out('5240836059895527485');" style=""> 774                 // which is why it&#x27;s safe to loop over them in such a way.                               </span>
<span class="-4546857229319265624" onmouseenter="enter('-4546857229319265624');" onmouseout="out('-4546857229319265624');" style=""> 775                 String fd = &quot;/proc/self/fd/&quot; + i;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 776                 try {                                                                                    </span>
<span class="-5133016265508323671" onmouseenter="enter('-5133016265508323671');" onmouseout="out('-5133016265508323671');" style=""> 777                     // getCanonicalPath() uses readlink behind the scene which doesn&#x27;t require           </span>
<span class="-6226268635961992542" onmouseenter="enter('-6226268635961992542');" onmouseout="out('-6226268635961992542');" style=""> 778                     // a file descriptor.                                                                </span>
<span class="-6892856404262336354" onmouseenter="enter('-6892856404262336354');" onmouseout="out('-6892856404262336354');" style=""> 779                     String resolved = new File(fd).getCanonicalPath();                                   </span>
<span class="-6768751510751326128" onmouseenter="enter('-6768751510751326128');" onmouseout="out('-6768751510751326128');" style=""> 780                     int type = types.indexOf(TYPE_OTHER);                                                </span>
<span class="-848598904663730437" onmouseenter="enter('-848598904663730437');" onmouseout="out('-848598904663730437');" style=""> 781                     if (resolved.startsWith(&quot;/dev/&quot;)) {                                                  </span>
<span class="-4879693837873897752" onmouseenter="enter('-4879693837873897752');" onmouseout="out('-4879693837873897752');" style=""> 782                         type = types.indexOf(TYPE_DEV);                                                  </span>
<span class="-125641070977798446" onmouseenter="enter('-125641070977798446');" onmouseout="out('-125641070977798446');" style=""> 783                     } else if (resolved.endsWith(&quot;.apk&quot;)) {                                              </span>
<span class="8152606461038952319" onmouseenter="enter('8152606461038952319');" onmouseout="out('8152606461038952319');" style=""> 784                         type = types.indexOf(TYPE_APK);                                                  </span>
<span class="-8895861587282636352" onmouseenter="enter('-8895861587282636352');" onmouseout="out('-8895861587282636352');" style=""> 785                     } else if (resolved.endsWith(&quot;.jar&quot;)) {                                              </span>
<span class="6211428299849972552" onmouseenter="enter('6211428299849972552');" onmouseout="out('6211428299849972552');" style=""> 786                         type = types.indexOf(TYPE_JAR);                                                  </span>
<span class="-6474781270675272142" onmouseenter="enter('-6474781270675272142');" onmouseout="out('-6474781270675272142');" style=""> 787                     } else if (resolved.contains(&quot;/fd/pipe:&quot;)) {                                         </span>
<span class="4492281361349576419" onmouseenter="enter('4492281361349576419');" onmouseout="out('4492281361349576419');" style=""> 788                         type = types.indexOf(TYPE_PIPE);                                                 </span>
<span class="5570982548020413210" onmouseenter="enter('5570982548020413210');" onmouseout="out('5570982548020413210');" style=""> 789                     } else if (resolved.contains(&quot;/fd/socket:&quot;)) {                                       </span>
<span class="5340928477240826099" onmouseenter="enter('5340928477240826099');" onmouseout="out('5340928477240826099');" style=""> 790                         type = types.indexOf(TYPE_SOCKET);                                               </span>
<span class="-1889318263670279425" onmouseenter="enter('-1889318263670279425');" onmouseout="out('-1889318263670279425');" style=""> 791                     } else if (resolved.contains(&quot;/fd/anon_inode:&quot;)) {                                   </span>
<span class="7975978575615021567" onmouseenter="enter('7975978575615021567');" onmouseout="out('7975978575615021567');" style=""> 792                         type = types.indexOf(TYPE_ANON_INODE);                                           </span>
<span class="-206211141383156363" onmouseenter="enter('-206211141383156363');" onmouseout="out('-206211141383156363');" style=""> 793                     } else if (resolved.endsWith(&quot;.db&quot;) || resolved.contains(&quot;/databases/&quot;)) {           </span>
<span class="8848130876067097546" onmouseenter="enter('8848130876067097546');" onmouseout="out('8848130876067097546');" style=""> 794                         type = types.indexOf(TYPE_DB);                                                   </span>
<span class="-3013458219347023666" onmouseenter="enter('-3013458219347023666');" onmouseout="out('-3013458219347023666');" style=""> 795                     } else if (resolved.startsWith(&quot;/proc/&quot;) &amp;&amp; resolved.contains(&quot;/fd/&quot;)) {             </span>
<span class="-4021067240164904881" onmouseenter="enter('-4021067240164904881');" onmouseout="out('-4021067240164904881');" style=""> 796                         // Those are the files that don&#x27;t point anywhere on the file system.             </span>
<span class="1766191980587176647" onmouseenter="enter('1766191980587176647');" onmouseout="out('1766191980587176647');" style=""> 797                         // getCanonicalPath() wrongly interprets these as relative symlinks and          </span>
<span class="8319631295934473117" onmouseenter="enter('8319631295934473117');" onmouseout="out('8319631295934473117');" style=""> 798                         // resolves them within /proc/&lt;pid&gt;/fd/.                                         </span>
<span class="-6071677259167823524" onmouseenter="enter('-6071677259167823524');" onmouseout="out('-6071677259167823524');" style=""> 799                         type = types.indexOf(TYPE_NON_FS);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800                     }                                                                                    </span>
<span class="-1328162661144416286" onmouseenter="enter('-1328162661144416286');" onmouseout="out('-1328162661144416286');" style=""> 801                     count[type]++;                                                                       </span>
<span class="-6740236498121811269" onmouseenter="enter('-6740236498121811269');" onmouseout="out('-6740236498121811269');" style=""> 802                     total++;                                                                             </span>
<span class="-1847477132387490804" onmouseenter="enter('-1847477132387490804');" onmouseout="out('-1847477132387490804');" style=""> 803                     if (files.contains(resolved)) {                                                      </span>
<span class="3216339987616567221" onmouseenter="enter('3216339987616567221');" onmouseout="out('3216339987616567221');" style=""> 804                         duplicates[type]++;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805                     }                                                                                    </span>
<span class="-556311909615308250" onmouseenter="enter('-556311909615308250');" onmouseout="out('-556311909615308250');" style=""> 806                     files.add(resolved);                                                                 </span>
<span class="3281685662955304691" onmouseenter="enter('3281685662955304691');" onmouseout="out('3281685662955304691');" style=""> 807                     if (total % SAMPLE_RATE == 0) {                                                      </span>
<span class="-5929979194141152550" onmouseenter="enter('-5929979194141152550');" onmouseout="out('-5929979194141152550');" style=""> 808                         Log.i(TAG, &quot; fd &quot; + i + &quot;: &quot; + resolved                                          </span>
<span class="-3430556922668437990" onmouseenter="enter('-3430556922668437990');" onmouseout="out('-3430556922668437990');" style=""> 809                                 + &quot; (&quot; + types.get(type) + &quot;)&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810                     }                                                                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 811                 } catch (IOException e) {                                                                </span>
<span class="-4332337590956216445" onmouseenter="enter('-4332337590956216445');" onmouseout="out('-4332337590956216445');" style=""> 812                     // Ignoring exceptions for non-existing file descriptors.                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814             }                                                                                            </span>
<span class="1894743204629618523" onmouseenter="enter('1894743204629618523');" onmouseout="out('1894743204629618523');" style=""> 815             for (int i = 0; i &lt; types.size(); i++) {                                                     </span>
<span class="-3358630307652497285" onmouseenter="enter('-3358630307652497285');" onmouseout="out('-3358630307652497285');" style=""> 816                 Log.i(TAG, String.format(&quot;Open %10s files: %4d total, %4d duplicates&quot;,                   </span>
<span class="-7057161233480916817" onmouseenter="enter('-7057161233480916817');" onmouseout="out('-7057161233480916817');" style=""> 817                         types.get(i), count[i], duplicates[i]));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818             }                                                                                            </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 819         } catch (Throwable t) {                                                                          </span>
<span class="6465726010998958367" onmouseenter="enter('6465726010998958367');" onmouseout="out('6465726010998958367');" style=""> 820             // Catch everything. This is called from an exception handler that we shouldn&#x27;t upset.       </span>
<span class="-3798752040153960224" onmouseenter="enter('-3798752040153960224');" onmouseout="out('-3798752040153960224');" style=""> 821             Log.e(TAG, &quot;Unable to log open files.&quot;, t);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824 }                                                                                                        </span>





</pre></td>
                            <td><pre><span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">   1 package com.android.launcher3;                                                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">   3 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">   4 import android.content.ComponentName;                                                                    </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">   5 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">   6 import android.content.Context;                                                                          </span>
<span class="4122587240602557356" onmouseenter="enter('4122587240602557356');" onmouseout="out('4122587240602557356');" style="">   7 import android.content.SharedPreferences;                                                                </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">   8 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7207138161133478555" onmouseenter="enter('7207138161133478555');" onmouseout="out('7207138161133478555');" style="">   9 import android.content.res.Resources;                                                                    </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  10 import android.database.Cursor;                                                                          </span>
<span class="-8322188515935618338" onmouseenter="enter('-8322188515935618338');" onmouseout="out('-8322188515935618338');" style="">  11 import android.database.sqlite.SQLiteCantOpenDatabaseException;                                          </span>
<span class="-4895155655276492102" onmouseenter="enter('-4895155655276492102');" onmouseout="out('-4895155655276492102');" style="">  12 import android.database.sqlite.SQLiteDatabase;                                                           </span>
<span class="250544669864164636" onmouseenter="enter('250544669864164636');" onmouseout="out('250544669864164636');" style="">  13 import android.database.sqlite.SQLiteDiskIOException;                                                    </span>
<span class="6401548559697116088" onmouseenter="enter('6401548559697116088');" onmouseout="out('6401548559697116088');" style="">  14 import android.database.sqlite.SQLiteOpenHelper;                                                         </span>
<span class="1099656306555592784" onmouseenter="enter('1099656306555592784');" onmouseout="out('1099656306555592784');" style="">  15 import android.database.sqlite.SQLiteReadOnlyDatabaseException;                                          </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  16 import android.graphics.Bitmap;                                                                          </span>
<span class="-5221619029963095423" onmouseenter="enter('-5221619029963095423');" onmouseout="out('-5221619029963095423');" style="">  17 import android.graphics.Bitmap.Config;                                                                   </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  18 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-8489723247854845487" onmouseenter="enter('-8489723247854845487');" onmouseout="out('-8489723247854845487');" style="">  19 import android.graphics.BitmapShader;                                                                    </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  20 import android.graphics.Canvas;                                                                          </span>
<span class="1046407090334580529" onmouseenter="enter('1046407090334580529');" onmouseout="out('1046407090334580529');" style="">  21 import android.graphics.ColorMatrix;                                                                     </span>
<span class="-2638342757206578386" onmouseenter="enter('-2638342757206578386');" onmouseout="out('-2638342757206578386');" style="">  22 import android.graphics.ColorMatrixColorFilter;                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  23 import android.graphics.Paint;                                                                           </span>
<span class="7353926919338897104" onmouseenter="enter('7353926919338897104');" onmouseout="out('7353926919338897104');" style="">  24 import android.graphics.PorterDuff;                                                                      </span>
<span class="2207333516549486115" onmouseenter="enter('2207333516549486115');" onmouseout="out('2207333516549486115');" style="">  25 import android.graphics.Rect;                                                                            </span>
<span class="-787513569742028665" onmouseenter="enter('-787513569742028665');" onmouseout="out('-787513569742028665');" style="">  26 import android.graphics.Shader;                                                                          </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  27 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  28 import android.graphics.drawable.Drawable;                                                               </span>
<span class="955674827050616793" onmouseenter="enter('955674827050616793');" onmouseout="out('955674827050616793');" style="">  29 import android.os.AsyncTask;                                                                             </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="">  30 import android.os.Build;                                                                                 </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  31 import android.util.Log;                                                                                 </span>
<span class="-2301578055393860706" onmouseenter="enter('-2301578055393860706');" onmouseout="out('-2301578055393860706');" style="">  32 import com.android.launcher3.compat.AppWidgetManagerCompat;                                              </span>
<span  style="">  33                                                                                                          </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  34 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  35 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  36 import java.io.IOException;                                                                              </span>
<span class="-9136849050553086203" onmouseenter="enter('-9136849050553086203');" onmouseout="out('-9136849050553086203');" style="">  37 import java.lang.ref.SoftReference;                                                                      </span>
<span class="-8692343821508153377" onmouseenter="enter('-8692343821508153377');" onmouseout="out('-8692343821508153377');" style="">  38 import java.lang.ref.WeakReference;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  39 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  40 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  41 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  42 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  43 import java.util.List;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  44 import java.util.concurrent.Callable;                                                                    </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  45 import java.util.concurrent.ExecutionException;                                                          </span>
<span  style="">  46                                                                                                          </span>
<span class="-4311378840888985036" onmouseenter="enter('-4311378840888985036');" onmouseout="out('-4311378840888985036');" style="">  47 public class WidgetPreviewLoader {                                                                       </span>
<span  style="">  48                                                                                                          </span>
<span class="-3230874476111875794" onmouseenter="enter('-3230874476111875794');" onmouseout="out('-3230874476111875794');" style="">  49     private static abstract class SoftReferenceThreadLocal&lt;T&gt; {                                          </span>
<span class="144884583078774733" onmouseenter="enter('144884583078774733');" onmouseout="out('144884583078774733');" style="">  50         private ThreadLocal&lt;SoftReference&lt;T&gt;&gt; mThreadLocal;                                              </span>
<span class="-4387433322567605136" onmouseenter="enter('-4387433322567605136');" onmouseout="out('-4387433322567605136');" style="">  51         public SoftReferenceThreadLocal() {                                                              </span>
<span class="4702884186935866826" onmouseenter="enter('4702884186935866826');" onmouseout="out('4702884186935866826');" style="">  52             mThreadLocal = new ThreadLocal&lt;SoftReference&lt;T&gt;&gt;();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  53         }                                                                                                </span>
<span  style="">  54                                                                                                          </span>
<span class="7611856356089156666" onmouseenter="enter('7611856356089156666');" onmouseout="out('7611856356089156666');" style="">  55         abstract T initialValue();                                                                       </span>
<span  style="">  56                                                                                                          </span>
<span class="-5049902553319226708" onmouseenter="enter('-5049902553319226708');" onmouseout="out('-5049902553319226708');" style="">  57         public void set(T t) {                                                                           </span>
<span class="4998900635420746153" onmouseenter="enter('4998900635420746153');" onmouseout="out('4998900635420746153');" style="">  58             mThreadLocal.set(new SoftReference&lt;T&gt;(t));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  59         }                                                                                                </span>
<span  style="">  60                                                                                                          </span>
<span class="-6159920038780308483" onmouseenter="enter('-6159920038780308483');" onmouseout="out('-6159920038780308483');" style="">  61         public T get() {                                                                                 </span>
<span class="-967899869235114258" onmouseenter="enter('-967899869235114258');" onmouseout="out('-967899869235114258');" style="">  62             SoftReference&lt;T&gt; reference = mThreadLocal.get();                                             </span>
<span class="-6948245133825727275" onmouseenter="enter('-6948245133825727275');" onmouseout="out('-6948245133825727275');" style="">  63             T obj;                                                                                       </span>
<span class="-5692723719917447196" onmouseenter="enter('-5692723719917447196');" onmouseout="out('-5692723719917447196');" style="">  64             if (reference == null) {                                                                     </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  65                 obj = initialValue();                                                                    </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  66                 mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                             </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  67                 return obj;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  68             } else {                                                                                     </span>
<span class="-2769798515494474030" onmouseenter="enter('-2769798515494474030');" onmouseout="out('-2769798515494474030');" style="">  69                 obj = reference.get();                                                                   </span>
<span class="9024370751945626489" onmouseenter="enter('9024370751945626489');" onmouseout="out('9024370751945626489');" style="">  70                 if (obj == null) {                                                                       </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  71                     obj = initialValue();                                                                </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  72                     mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73                 }                                                                                        </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  74                 return obj;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-5055153777344084118" onmouseenter="enter('-5055153777344084118');" onmouseout="out('-5055153777344084118');" style="">  79     private static class CanvasCache extends SoftReferenceThreadLocal&lt;Canvas&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80         @Override                                                                                        </span>
<span class="-4761875685905818114" onmouseenter="enter('-4761875685905818114');" onmouseout="out('-4761875685905818114');" style="">  81         protected Canvas initialValue() {                                                                </span>
<span class="-2278895108809265326" onmouseenter="enter('-2278895108809265326');" onmouseout="out('-2278895108809265326');" style="">  82             return new Canvas();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="-1261255052546611379" onmouseenter="enter('-1261255052546611379');" onmouseout="out('-1261255052546611379');" style="">  86     private static class PaintCache extends SoftReferenceThreadLocal&lt;Paint&gt; {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  87         @Override                                                                                        </span>
<span class="5455192562670218369" onmouseenter="enter('5455192562670218369');" onmouseout="out('5455192562670218369');" style="">  88         protected Paint initialValue() {                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  89             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="1990146601739059582" onmouseenter="enter('1990146601739059582');" onmouseout="out('1990146601739059582');" style="">  93     private static class BitmapCache extends SoftReferenceThreadLocal&lt;Bitmap&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94         @Override                                                                                        </span>
<span class="5445413510754308036" onmouseenter="enter('5445413510754308036');" onmouseout="out('5445413510754308036');" style="">  95         protected Bitmap initialValue() {                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  96             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="-4690039068512610596" onmouseenter="enter('-4690039068512610596');" onmouseout="out('-4690039068512610596');" style=""> 100     private static class RectCache extends SoftReferenceThreadLocal&lt;Rect&gt; {                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 101         @Override                                                                                        </span>
<span class="8484771223674222626" onmouseenter="enter('8484771223674222626');" onmouseout="out('8484771223674222626');" style=""> 102         protected Rect initialValue() {                                                                  </span>
<span class="3126951611359421696" onmouseenter="enter('3126951611359421696');" onmouseout="out('3126951611359421696');" style=""> 103             return new Rect();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1412995145802516532" onmouseenter="enter('-1412995145802516532');" onmouseout="out('-1412995145802516532');" style=""> 107     private static class BitmapFactoryOptionsCache extends                                               </span>
<span class="6571896484354186661" onmouseenter="enter('6571896484354186661');" onmouseout="out('6571896484354186661');" style=""> 108             SoftReferenceThreadLocal&lt;BitmapFactory.Options&gt; {                                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109         @Override                                                                                        </span>
<span class="-8328117947754333521" onmouseenter="enter('-8328117947754333521');" onmouseout="out('-8328117947754333521');" style=""> 110         protected BitmapFactory.Options initialValue() {                                                 </span>
<span class="-4117267854178586248" onmouseenter="enter('-4117267854178586248');" onmouseout="out('-4117267854178586248');" style=""> 111             return new BitmapFactory.Options();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="2416799479879720027" onmouseenter="enter('2416799479879720027');" onmouseout="out('2416799479879720027');" style=""> 115     private static final String TAG = &quot;WidgetPreviewLoader&quot;;                                             </span>
<span class="4075932221748513041" onmouseenter="enter('4075932221748513041');" onmouseout="out('4075932221748513041');" style=""> 116     private static final String ANDROID_INCREMENTAL_VERSION_NAME_KEY = &quot;android.incremental.version&quot;;    </span>
<span  style=""> 117                                                                                                          </span>
<span class="7524285546086861850" onmouseenter="enter('7524285546086861850');" onmouseout="out('7524285546086861850');" style=""> 118     private static final float WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE = 0.25f;                           </span>
<span class="1902323072201125531" onmouseenter="enter('1902323072201125531');" onmouseout="out('1902323072201125531');" style=""> 119     private static final HashSet&lt;String&gt; sInvalidPackages = new HashSet&lt;String&gt;();                       </span>
<span  style=""> 120                                                                                                          </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 121     // Used for drawing shortcut previews                                                                </span>
<span class="333450150533861200" onmouseenter="enter('333450150533861200');" onmouseout="out('333450150533861200');" style=""> 122     private final BitmapCache mCachedShortcutPreviewBitmap = new BitmapCache();                          </span>
<span class="6665675930715155383" onmouseenter="enter('6665675930715155383');" onmouseout="out('6665675930715155383');" style=""> 123     private final PaintCache mCachedShortcutPreviewPaint = new PaintCache();                             </span>
<span class="1096761732692819631" onmouseenter="enter('1096761732692819631');" onmouseout="out('1096761732692819631');" style=""> 124     private final CanvasCache mCachedShortcutPreviewCanvas = new CanvasCache();                          </span>
<span  style=""> 125                                                                                                          </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 126     // Used for drawing widget previews                                                                  </span>
<span class="-3956456794742254913" onmouseenter="enter('-3956456794742254913');" onmouseout="out('-3956456794742254913');" style=""> 127     private final CanvasCache mCachedAppWidgetPreviewCanvas = new CanvasCache();                         </span>
<span class="2994302144561928781" onmouseenter="enter('2994302144561928781');" onmouseout="out('2994302144561928781');" style=""> 128     private final RectCache mCachedAppWidgetPreviewSrcRect = new RectCache();                            </span>
<span class="-2432735040368044940" onmouseenter="enter('-2432735040368044940');" onmouseout="out('-2432735040368044940');" style=""> 129     private final RectCache mCachedAppWidgetPreviewDestRect = new RectCache();                           </span>
<span class="-1839110596677388209" onmouseenter="enter('-1839110596677388209');" onmouseout="out('-1839110596677388209');" style=""> 130     private final PaintCache mCachedAppWidgetPreviewPaint = new PaintCache();                            </span>
<span class="4215417609313429507" onmouseenter="enter('4215417609313429507');" onmouseout="out('4215417609313429507');" style=""> 131     private final PaintCache mDefaultAppWidgetPreviewPaint = new PaintCache();                           </span>
<span class="7799865446872866624" onmouseenter="enter('7799865446872866624');" onmouseout="out('7799865446872866624');" style=""><abbr title=" 132     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache();"> 132     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache()ðŸ”µ</abbr></span>
<span  style=""> 133                                                                                                          </span>
<span class="4097431862822690335" onmouseenter="enter('4097431862822690335');" onmouseout="out('4097431862822690335');" style=""><abbr title=" 134     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt;();"> 134     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakRefereðŸ”µ</abbr></span>
<span class="-7580346379503623190" onmouseenter="enter('-7580346379503623190');" onmouseout="out('-7580346379503623190');" style=""><abbr title=" 135     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;();"> 135     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;(ðŸ”µ</abbr></span>
<span  style=""> 136                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 137     private final Context mContext;                                                                      </span>
<span class="-7489384078469018359" onmouseenter="enter('-7489384078469018359');" onmouseout="out('-7489384078469018359');" style=""> 138     private final int mAppIconSize;                                                                      </span>
<span class="2729881913605020060" onmouseenter="enter('2729881913605020060');" onmouseout="out('2729881913605020060');" style=""> 139     private final IconCache mIconCache;                                                                  </span>
<span class="9150498506085829362" onmouseenter="enter('9150498506085829362');" onmouseout="out('9150498506085829362');" style=""> 140     private final AppWidgetManagerCompat mManager;                                                       </span>
<span  style=""> 141                                                                                                          </span>
<span class="-8162128579730225382" onmouseenter="enter('-8162128579730225382');" onmouseout="out('-8162128579730225382');" style=""> 142     private int mPreviewBitmapWidth;                                                                     </span>
<span class="4768970035560221699" onmouseenter="enter('4768970035560221699');" onmouseout="out('4768970035560221699');" style=""> 143     private int mPreviewBitmapHeight;                                                                    </span>
<span class="-2278862546333248339" onmouseenter="enter('-2278862546333248339');" onmouseout="out('-2278862546333248339');" style=""> 144     private String mSize;                                                                                </span>
<span class="-4195956876020483478" onmouseenter="enter('-4195956876020483478');" onmouseout="out('-4195956876020483478');" style=""> 145     private PagedViewCellLayout mWidgetSpacingLayout;                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="-7229982499992821578" onmouseenter="enter('-7229982499992821578');" onmouseout="out('-7229982499992821578');" style=""> 147     private String mCachedSelectQuery;                                                                   </span>
<span  style=""> 148                                                                                                          </span>
<span  style=""> 149                                                                                                          </span>
<span class="6719315262198447761" onmouseenter="enter('6719315262198447761');" onmouseout="out('6719315262198447761');" style=""> 150     private CacheDb mDb;                                                                                 </span>
<span  style=""> 151                                                                                                          </span>
<span class="140559351311799615" onmouseenter="enter('140559351311799615');" onmouseout="out('140559351311799615');" style=""> 152     private final MainThreadExecutor mMainThreadExecutor = new MainThreadExecutor();                     </span>
<span  style=""> 153                                                                                                          </span>
<span class="-5828204717811548952" onmouseenter="enter('-5828204717811548952');" onmouseout="out('-5828204717811548952');" style=""> 154     public WidgetPreviewLoader(Context context) {                                                        </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 155         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-6320967880672955396" onmouseenter="enter('-6320967880672955396');" onmouseout="out('-6320967880672955396');" style=""> 156         DeviceProfile grid = app.getDynamicGrid().getDeviceProfile();                                    </span>
<span  style=""> 157                                                                                                          </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 158         mContext = context;                                                                              </span>
<span class="3163588368111647063" onmouseenter="enter('3163588368111647063');" onmouseout="out('3163588368111647063');" style=""> 159         mAppIconSize = grid.iconSizePx;                                                                  </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 160         mIconCache = app.getIconCache();                                                                 </span>
<span class="3481132346717467494" onmouseenter="enter('3481132346717467494');" onmouseout="out('3481132346717467494');" style=""> 161         mManager = AppWidgetManagerCompat.getInstance(context);                                          </span>
<span  style=""> 162                                                                                                          </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 163         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span  style=""> 164                                                                                                          </span>
<span class="2019816042868645703" onmouseenter="enter('2019816042868645703');" onmouseout="out('2019816042868645703');" style=""> 165         SharedPreferences sp = context.getSharedPreferences(                                             </span>
<span class="-3012020800644432647" onmouseenter="enter('-3012020800644432647');" onmouseout="out('-3012020800644432647');" style=""> 166                 LauncherAppState.getSharedPreferencesKey(), Context.MODE_PRIVATE);                       </span>
<span class="7599352561706696094" onmouseenter="enter('7599352561706696094');" onmouseout="out('7599352561706696094');" style=""> 167         final String lastVersionName = sp.getString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, null);         </span>
<span class="-8837714544016106839" onmouseenter="enter('-8837714544016106839');" onmouseout="out('-8837714544016106839');" style=""> 168         final String versionName = android.os.Build.VERSION.INCREMENTAL;                                 </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 169 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-6804745435332338014" onmouseenter="enter('-6804745435332338014');" onmouseout="out('-6804745435332338014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         final boolean isLollipop = Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP;                </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 171 ||||||| BASE                                                                                             </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         if (!versionName.equals(lastVersionName)) {                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 173 =======                                                                                                  </span>
<span class="5360402256484915856" onmouseenter="enter('5360402256484915856');" onmouseout="out('5360402256484915856');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174         final boolean isLollipopOrGreater = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP;       </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 175 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style=""> 176         if (!versionName.equals(lastVersionName)) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 177             try {                                                                                        </span>
<span class="-1043062607084730911" onmouseenter="enter('-1043062607084730911');" onmouseout="out('-1043062607084730911');" style=""> 178                 // clear all the previews whenever the system version changes, to ensure that            </span>
<span class="-3090272541711713949" onmouseenter="enter('-3090272541711713949');" onmouseout="out('-3090272541711713949');" style=""> 179                 // previews are up-to-date for any apps that might have been updated with the system     </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style=""> 180             clearDb();                                                                                   </span>
<span class="-1695662722736394565" onmouseenter="enter('-1695662722736394565');" onmouseout="out('-1695662722736394565');" style=""> 181             } catch (SQLiteReadOnlyDatabaseException e) {                                                </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 182 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4319884442435447688" onmouseenter="enter('4319884442435447688');" onmouseout="out('4319884442435447688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183                 if (isLollipop) {                                                                        </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 184                     // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only     </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 185                     // issue, then ignore this error and leave the old previews                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 186                 } else {                                                                                 </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 189             } catch (Exception e) {                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 190                 throw e;                                                                                 </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 191 ||||||| BASE                                                                                             </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192             editor.commit();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 194 =======                                                                                                  </span>
<span class="-1402409748038375417" onmouseenter="enter('-1402409748038375417');" onmouseout="out('-1402409748038375417');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195                 if (isLollipopOrGreater) {                                                               </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                     // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only     </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                     // issue, then ignore this error and leave the old previews                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                 } else {                                                                                 </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                 }                                                                                        </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 201 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 202             } finally {                                                                                  </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style=""> 203             SharedPreferences.Editor editor = sp.edit();                                                 </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style=""> 204             editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                         </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style=""> 205             editor.commit();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208     }                                                                                                    </span>
<span  style=""> 209                                                                                                          </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style=""> 210     public void recreateDb() {                                                                           </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 211         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style=""> 212         app.recreateWidgetPreviewDb();                                                                   </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 213         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="1041361483340123386" onmouseenter="enter('1041361483340123386');" onmouseout="out('1041361483340123386');" style=""> 216     public void setPreviewSize(int previewWidth, int previewHeight,                                      </span>
<span class="-864889589589090056" onmouseenter="enter('-864889589589090056');" onmouseout="out('-864889589589090056');" style=""> 217             PagedViewCellLayout widgetSpacingLayout) {                                                   </span>
<span class="7215920596152382710" onmouseenter="enter('7215920596152382710');" onmouseout="out('7215920596152382710');" style=""> 218         mPreviewBitmapWidth = previewWidth;                                                              </span>
<span class="-1710948131163314144" onmouseenter="enter('-1710948131163314144');" onmouseout="out('-1710948131163314144');" style=""> 219         mPreviewBitmapHeight = previewHeight;                                                            </span>
<span class="-2589016613696609257" onmouseenter="enter('-2589016613696609257');" onmouseout="out('-2589016613696609257');" style=""> 220         mSize = previewWidth + &quot;x&quot; + previewHeight;                                                      </span>
<span class="-2003385001531882656" onmouseenter="enter('-2003385001531882656');" onmouseout="out('-2003385001531882656');" style=""> 221         mWidgetSpacingLayout = widgetSpacingLayout;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="9100103105710524909" onmouseenter="enter('9100103105710524909');" onmouseout="out('9100103105710524909');" style=""> 224     public Bitmap getPreview(final Object o) {                                                           </span>
<span class="7210064752111263529" onmouseenter="enter('7210064752111263529');" onmouseout="out('7210064752111263529');" style=""> 225         final String name = getObjectName(o);                                                            </span>
<span class="-4502422735439147840" onmouseenter="enter('-4502422735439147840');" onmouseout="out('-4502422735439147840');" style=""> 226         final String packageName = getObjectPackage(o);                                                  </span>
<span class="6483702398021407461" onmouseenter="enter('6483702398021407461');" onmouseout="out('6483702398021407461');" style=""> 227         // check if the package is valid                                                                 </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 228         synchronized(sInvalidPackages) {                                                                 </span>
<span class="6205084711389939864" onmouseenter="enter('6205084711389939864');" onmouseout="out('6205084711389939864');" style=""> 229             boolean packageValid = !sInvalidPackages.contains(packageName);                              </span>
<span class="5936168059174575986" onmouseenter="enter('5936168059174575986');" onmouseout="out('5936168059174575986');" style=""> 230             if (!packageValid) {                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 231                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233         }                                                                                                </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 234         synchronized(mLoadedPreviews) {                                                                  </span>
<span class="-7479974433139738260" onmouseenter="enter('-7479974433139738260');" onmouseout="out('-7479974433139738260');" style=""> 235             // check if it exists in our existing cache                                                  </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 236             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="-5798374742760410220" onmouseenter="enter('-5798374742760410220');" onmouseout="out('-5798374742760410220');" style=""> 237                 WeakReference&lt;Bitmap&gt; bitmapReference = mLoadedPreviews.get(name);                       </span>
<span class="-5072696511706589798" onmouseenter="enter('-5072696511706589798');" onmouseout="out('-5072696511706589798');" style=""> 238                 Bitmap bitmap = bitmapReference.get();                                                   </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 239                 if (bitmap != null) {                                                                    </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style=""> 240                     return bitmap;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243         }                                                                                                </span>
<span  style=""> 244                                                                                                          </span>
<span class="-1660586751969869388" onmouseenter="enter('-1660586751969869388');" onmouseout="out('-1660586751969869388');" style=""> 245         Bitmap unusedBitmap = null;                                                                      </span>
<span class="7613513134986517501" onmouseenter="enter('7613513134986517501');" onmouseout="out('7613513134986517501');" style=""> 246         synchronized(mUnusedBitmaps) {                                                                   </span>
<span class="134332774856407035" onmouseenter="enter('134332774856407035');" onmouseout="out('134332774856407035');" style=""> 247             // not in cache; we need to load it from the db                                              </span>
<span class="1411220366891100168" onmouseenter="enter('1411220366891100168');" onmouseout="out('1411220366891100168');" style=""> 248             while (unusedBitmap == null &amp;&amp; mUnusedBitmaps.size() &gt; 0) {                                  </span>
<span class="3514361872991648197" onmouseenter="enter('3514361872991648197');" onmouseout="out('3514361872991648197');" style=""> 249                 Bitmap candidate = mUnusedBitmaps.remove(0).get();                                       </span>
<span class="-3857479151276842222" onmouseenter="enter('-3857479151276842222');" onmouseout="out('-3857479151276842222');" style=""> 250                 if (candidate != null &amp;&amp; candidate.isMutable() &amp;&amp;                                        </span>
<span class="-7425312185904228324" onmouseenter="enter('-7425312185904228324');" onmouseout="out('-7425312185904228324');" style=""> 251                         candidate.getWidth() == mPreviewBitmapWidth &amp;&amp;                                   </span>
<span class="-897867530819106482" onmouseenter="enter('-897867530819106482');" onmouseout="out('-897867530819106482');" style=""> 252                         candidate.getHeight() == mPreviewBitmapHeight) {                                 </span>
<span class="-7974711513755834014" onmouseenter="enter('-7974711513755834014');" onmouseout="out('-7974711513755834014');" style=""> 253                     unusedBitmap = candidate;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255             }                                                                                            </span>
<span class="-1806752935370283796" onmouseenter="enter('-1806752935370283796');" onmouseout="out('-1806752935370283796');" style=""> 256             if (unusedBitmap != null) {                                                                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 257                 final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                    </span>
<span class="-7568013336659090919" onmouseenter="enter('-7568013336659090919');" onmouseout="out('-7568013336659090919');" style=""> 258                 c.setBitmap(unusedBitmap);                                                               </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 259                 c.drawColor(0, PorterDuff.Mode.CLEAR);                                                   </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 260                 c.setBitmap(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262         }                                                                                                </span>
<span  style=""> 263                                                                                                          </span>
<span class="-7521323678416918441" onmouseenter="enter('-7521323678416918441');" onmouseout="out('-7521323678416918441');" style=""> 264         if (unusedBitmap == null) {                                                                      </span>
<span class="-3551833031540614706" onmouseenter="enter('-3551833031540614706');" onmouseout="out('-3551833031540614706');" style=""> 265             unusedBitmap = Bitmap.createBitmap(mPreviewBitmapWidth, mPreviewBitmapHeight,                </span>
<span class="273441602049516461" onmouseenter="enter('273441602049516461');" onmouseout="out('273441602049516461');" style=""> 266                     Bitmap.Config.ARGB_8888);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267         }                                                                                                </span>
<span class="-8985062989738227550" onmouseenter="enter('-8985062989738227550');" onmouseout="out('-8985062989738227550');" style=""> 268         Bitmap preview = readFromDb(name, unusedBitmap);                                                 </span>
<span  style=""> 269                                                                                                          </span>
<span class="-760731434728754948" onmouseenter="enter('-760731434728754948');" onmouseout="out('-760731434728754948');" style=""> 270         if (preview != null) {                                                                           </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 271             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 272                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273             }                                                                                            </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 274             return preview;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 275         } else {                                                                                         </span>
<span class="3460679213489770567" onmouseenter="enter('3460679213489770567');" onmouseout="out('3460679213489770567');" style=""> 276             // it&#x27;s not in the db... we need to generate it                                              </span>
<span class="7452120778445413168" onmouseenter="enter('7452120778445413168');" onmouseout="out('7452120778445413168');" style=""> 277             final Bitmap generatedPreview = generatePreview(o, unusedBitmap);                            </span>
<span class="-4291180510938406114" onmouseenter="enter('-4291180510938406114');" onmouseout="out('-4291180510938406114');" style=""> 278             preview = generatedPreview;                                                                  </span>
<span class="7396852523530524307" onmouseenter="enter('7396852523530524307');" onmouseout="out('7396852523530524307');" style=""> 279             if (preview != unusedBitmap) {                                                               </span>
<span class="-7211694849959051791" onmouseenter="enter('-7211694849959051791');" onmouseout="out('-7211694849959051791');" style=""> 280                 throw new RuntimeException(&quot;generatePreview is not recycling the bitmap &quot; + o);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281             }                                                                                            </span>
<span  style=""> 282                                                                                                          </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 283             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 284                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285             }                                                                                            </span>
<span  style=""> 286                                                                                                          </span>
<span class="-5733309973697321639" onmouseenter="enter('-5733309973697321639');" onmouseout="out('-5733309973697321639');" style=""> 287             // write to db on a thread pool... this can be done lazily and improves the performance      </span>
<span class="-8551030995294829944" onmouseenter="enter('-8551030995294829944');" onmouseout="out('-8551030995294829944');" style=""> 288             // of the first time widget previews are loaded                                              </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 289             new AsyncTask&lt;Void, Void, Void&gt;() {                                                          </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 290                 public Void doInBackground(Void ... args) {                                              </span>
<span class="5794871779597006615" onmouseenter="enter('5794871779597006615');" onmouseout="out('5794871779597006615');" style=""> 291                     writeToDb(o, generatedPreview);                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 292                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                 }                                                                                        </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 294             }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                            </span>
<span  style=""> 295                                                                                                          </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 296             return preview;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298     }                                                                                                    </span>
<span  style=""> 299                                                                                                          </span>
<span class="-2058417025959444842" onmouseenter="enter('-2058417025959444842');" onmouseout="out('-2058417025959444842');" style=""> 300     public void recycleBitmap(Object o, Bitmap bitmapToRecycle) {                                        </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 301         String name = getObjectName(o);                                                                  </span>
<span class="-4798838159901813780" onmouseenter="enter('-4798838159901813780');" onmouseout="out('-4798838159901813780');" style=""> 302         synchronized (mLoadedPreviews) {                                                                 </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 303             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="5945201469012860218" onmouseenter="enter('5945201469012860218');" onmouseout="out('5945201469012860218');" style=""> 304                 Bitmap b = mLoadedPreviews.get(name).get();                                              </span>
<span class="9172312796342865011" onmouseenter="enter('9172312796342865011');" onmouseout="out('9172312796342865011');" style=""> 305                 if (b == bitmapToRecycle) {                                                              </span>
<span class="-3845835638768486269" onmouseenter="enter('-3845835638768486269');" onmouseout="out('-3845835638768486269');" style=""> 306                     mLoadedPreviews.remove(name);                                                        </span>
<span class="1962405822662822843" onmouseenter="enter('1962405822662822843');" onmouseout="out('1962405822662822843');" style=""> 307                     if (bitmapToRecycle.isMutable()) {                                                   </span>
<span class="732538049861401327" onmouseenter="enter('732538049861401327');" onmouseout="out('732538049861401327');" style=""> 308                         synchronized (mUnusedBitmaps) {                                                  </span>
<span class="7654440137511857398" onmouseenter="enter('7654440137511857398');" onmouseout="out('7654440137511857398');" style=""> 309                             mUnusedBitmaps.add(new SoftReference&lt;Bitmap&gt;(b));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 312                 } else {                                                                                 </span>
<span class="-7483999424756026389" onmouseenter="enter('-7483999424756026389');" onmouseout="out('-7483999424756026389');" style=""> 313                     throw new RuntimeException(&quot;Bitmap passed in doesn&#x27;t match up&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317     }                                                                                                    </span>
<span  style=""> 318                                                                                                          </span>
<span class="-6828234266968088645" onmouseenter="enter('-6828234266968088645');" onmouseout="out('-6828234266968088645');" style=""> 319     static class CacheDb extends SQLiteOpenHelper {                                                      </span>
<span class="-2905037825538645689" onmouseenter="enter('-2905037825538645689');" onmouseout="out('-2905037825538645689');" style=""> 320         final static int DB_VERSION = 2;                                                                 </span>
<span class="-4997316780024779267" onmouseenter="enter('-4997316780024779267');" onmouseout="out('-4997316780024779267');" style=""> 321         final static String TABLE_NAME = &quot;shortcut_and_widget_previews&quot;;                                 </span>
<span class="-5742805130150616813" onmouseenter="enter('-5742805130150616813');" onmouseout="out('-5742805130150616813');" style=""> 322         final static String COLUMN_NAME = &quot;name&quot;;                                                        </span>
<span class="8854376481192602334" onmouseenter="enter('8854376481192602334');" onmouseout="out('8854376481192602334');" style=""> 323         final static String COLUMN_SIZE = &quot;size&quot;;                                                        </span>
<span class="6902810344350480074" onmouseenter="enter('6902810344350480074');" onmouseout="out('6902810344350480074');" style=""> 324         final static String COLUMN_PREVIEW_BITMAP = &quot;preview_bitmap&quot;;                                    </span>
<span class="-5996057254067063760" onmouseenter="enter('-5996057254067063760');" onmouseout="out('-5996057254067063760');" style=""> 325         Context mContext;                                                                                </span>
<span  style=""> 326                                                                                                          </span>
<span class="-1572964554793598477" onmouseenter="enter('-1572964554793598477');" onmouseout="out('-1572964554793598477');" style=""> 327         public CacheDb(Context context) {                                                                </span>
<span class="-495189310641001393" onmouseenter="enter('-495189310641001393');" onmouseout="out('-495189310641001393');" style=""> 328             super(context, new File(context.getCacheDir(),                                               </span>
<span class="-4377620877094923072" onmouseenter="enter('-4377620877094923072');" onmouseout="out('-4377620877094923072');" style=""> 329                     LauncherFiles.WIDGET_PREVIEWS_DB).getPath(), null, DB_VERSION);                      </span>
<span class="-5483301966583099443" onmouseenter="enter('-5483301966583099443');" onmouseout="out('-5483301966583099443');" style=""> 330             // Store the context for later use                                                           </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 331             mContext = context;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span  style=""> 333                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 334         @Override                                                                                        </span>
<span class="-3622240674415739784" onmouseenter="enter('-3622240674415739784');" onmouseout="out('-3622240674415739784');" style=""> 335         public void onCreate(SQLiteDatabase database) {                                                  </span>
<span class="-5851870806192660982" onmouseenter="enter('-5851870806192660982');" onmouseout="out('-5851870806192660982');" style=""> 336             database.execSQL(&quot;CREATE TABLE IF NOT EXISTS &quot; + TABLE_NAME + &quot; (&quot; +                         </span>
<span class="-4480150272515057846" onmouseenter="enter('-4480150272515057846');" onmouseout="out('-4480150272515057846');" style=""> 337                     COLUMN_NAME + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="9221020696116426890" onmouseenter="enter('9221020696116426890');" onmouseout="out('9221020696116426890');" style=""> 338                     COLUMN_SIZE + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="-4320278434100102649" onmouseenter="enter('-4320278434100102649');" onmouseout="out('-4320278434100102649');" style=""> 339                     COLUMN_PREVIEW_BITMAP + &quot; BLOB NOT NULL, &quot; +                                         </span>
<span class="2330812204177674799" onmouseenter="enter('2330812204177674799');" onmouseout="out('2330812204177674799');" style=""> 340                     &quot;PRIMARY KEY (&quot; + COLUMN_NAME + &quot;, &quot; + COLUMN_SIZE + &quot;) &quot; +                          </span>
<span class="4525293784515244604" onmouseenter="enter('4525293784515244604');" onmouseout="out('4525293784515244604');" style=""> 341                     &quot;);&quot;);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342         }                                                                                                </span>
<span  style=""> 343                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 344         @Override                                                                                        </span>
<span class="-4655538025867202729" onmouseenter="enter('-4655538025867202729');" onmouseout="out('-4655538025867202729');" style=""> 345         public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {                       </span>
<span class="4248187026734735411" onmouseenter="enter('4248187026734735411');" onmouseout="out('4248187026734735411');" style=""> 346             if (oldVersion != newVersion) {                                                              </span>
<span class="4606527396647857067" onmouseenter="enter('4606527396647857067');" onmouseout="out('4606527396647857067');" style=""> 347                 // Delete all the records; they&#x27;ll be repopulated as this is a cache                     </span>
<span class="3312906466801577184" onmouseenter="enter('3312906466801577184');" onmouseout="out('3312906466801577184');" style=""> 348                 db.execSQL(&quot;DELETE FROM &quot; + TABLE_NAME);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351     }                                                                                                    </span>
<span  style=""> 352                                                                                                          </span>
<span class="4811926455019388037" onmouseenter="enter('4811926455019388037');" onmouseout="out('4811926455019388037');" style=""> 353     private static final String WIDGET_PREFIX = &quot;Widget:&quot;;                                               </span>
<span class="7268385195460645965" onmouseenter="enter('7268385195460645965');" onmouseout="out('7268385195460645965');" style=""> 354     private static final String SHORTCUT_PREFIX = &quot;Shortcut:&quot;;                                           </span>
<span  style=""> 355                                                                                                          </span>
<span class="2901805684811435457" onmouseenter="enter('2901805684811435457');" onmouseout="out('2901805684811435457');" style=""> 356     private static String getObjectName(Object o) {                                                      </span>
<span class="5690762498529732972" onmouseenter="enter('5690762498529732972');" onmouseout="out('5690762498529732972');" style=""> 357         // should cache the string builder                                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 358         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="2095302661605249065" onmouseenter="enter('2095302661605249065');" onmouseout="out('2095302661605249065');" style=""> 359         String output;                                                                                   </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 360         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-8383311757247800402" onmouseenter="enter('-8383311757247800402');" onmouseout="out('-8383311757247800402');" style=""> 361             sb.append(WIDGET_PREFIX);                                                                    </span>
<span class="594215244520332131" onmouseenter="enter('594215244520332131');" onmouseout="out('594215244520332131');" style=""> 362             sb.append(((AppWidgetProviderInfo) o).toString());                                           </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 363             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 364             sb.setLength(0);                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 365         } else {                                                                                         </span>
<span class="5925999772645605802" onmouseenter="enter('5925999772645605802');" onmouseout="out('5925999772645605802');" style=""> 366             sb.append(SHORTCUT_PREFIX);                                                                  </span>
<span  style=""> 367                                                                                                          </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 368             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="8259534413479453259" onmouseenter="enter('8259534413479453259');" onmouseout="out('8259534413479453259');" style=""> 369             sb.append(new ComponentName(info.activityInfo.packageName,                                   </span>
<span class="-4000685798969561860" onmouseenter="enter('-4000685798969561860');" onmouseout="out('-4000685798969561860');" style=""> 370                     info.activityInfo.name).flattenToString());                                          </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 371             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 372             sb.setLength(0);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373         }                                                                                                </span>
<span class="3622623857335300211" onmouseenter="enter('3622623857335300211');" onmouseout="out('3622623857335300211');" style=""> 374         return output;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375     }                                                                                                    </span>
<span  style=""> 376                                                                                                          </span>
<span class="4198392565151889664" onmouseenter="enter('4198392565151889664');" onmouseout="out('4198392565151889664');" style=""> 377     private String getObjectPackage(Object o) {                                                          </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 378         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-447589032913714129" onmouseenter="enter('-447589032913714129');" onmouseout="out('-447589032913714129');" style=""> 379             return ((AppWidgetProviderInfo) o).provider.getPackageName();                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 380         } else {                                                                                         </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 381             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="-2114723670528030181" onmouseenter="enter('-2114723670528030181');" onmouseout="out('-2114723670528030181');" style=""> 382             return info.activityInfo.packageName;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="8368345736666686335" onmouseenter="enter('8368345736666686335');" onmouseout="out('8368345736666686335');" style=""> 386     private void writeToDb(Object o, Bitmap preview) {                                                   </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 387         String name = getObjectName(o);                                                                  </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 388         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 389         ContentValues values = new ContentValues();                                                      </span>
<span  style=""> 390                                                                                                          </span>
<span class="-3178925289150814226" onmouseenter="enter('-3178925289150814226');" onmouseout="out('-3178925289150814226');" style=""> 391         values.put(CacheDb.COLUMN_NAME, name);                                                           </span>
<span class="3456914836247516446" onmouseenter="enter('3456914836247516446');" onmouseout="out('3456914836247516446');" style=""> 392         ByteArrayOutputStream stream = new ByteArrayOutputStream();                                      </span>
<span class="5496434693797867526" onmouseenter="enter('5496434693797867526');" onmouseout="out('5496434693797867526');" style=""> 393         preview.compress(Bitmap.CompressFormat.PNG, 100, stream);                                        </span>
<span class="9194176376821213638" onmouseenter="enter('9194176376821213638');" onmouseout="out('9194176376821213638');" style=""> 394         values.put(CacheDb.COLUMN_PREVIEW_BITMAP, stream.toByteArray());                                 </span>
<span class="5882768875063958466" onmouseenter="enter('5882768875063958466');" onmouseout="out('5882768875063958466');" style=""> 395         values.put(CacheDb.COLUMN_SIZE, mSize);                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 396         try {                                                                                            </span>
<span class="3018412397769192796" onmouseenter="enter('3018412397769192796');" onmouseout="out('3018412397769192796');" style=""> 397             db.insert(CacheDb.TABLE_NAME, null, values);                                                 </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 398         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 399             recreateDb();                                                                                </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 400         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 401             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 402             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404     }                                                                                                    </span>
<span  style=""> 405                                                                                                          </span>
<span class="8392297522310828664" onmouseenter="enter('8392297522310828664');" onmouseout="out('8392297522310828664');" style=""> 406     private void clearDb() {                                                                             </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 407         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="904405929570850953" onmouseenter="enter('904405929570850953');" onmouseout="out('904405929570850953');" style=""> 408         // Delete everything                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 409         try {                                                                                            </span>
<span class="3968467922888620985" onmouseenter="enter('3968467922888620985');" onmouseout="out('3968467922888620985');" style=""> 410             db.delete(CacheDb.TABLE_NAME, null, null);                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 411         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 412         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 413             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 414             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416     }                                                                                                    </span>
<span  style=""> 417                                                                                                          </span>
<span class="-8805069561924159073" onmouseenter="enter('-8805069561924159073');" onmouseout="out('-8805069561924159073');" style=""> 418     public static void removePackageFromDb(final CacheDb cacheDb, final String packageName) {            </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 419         synchronized(sInvalidPackages) {                                                                 </span>
<span class="-5575213275928168943" onmouseenter="enter('-5575213275928168943');" onmouseout="out('-5575213275928168943');" style=""> 420             sInvalidPackages.add(packageName);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421         }                                                                                                </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 422         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 423             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 424                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 425                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 426                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7113429213384324763" onmouseenter="enter('7113429213384324763');" onmouseout="out('7113429213384324763');" style=""> 427                             CacheDb.COLUMN_NAME + &quot; LIKE ? OR &quot; +                                        </span>
<span class="8833124058792802926" onmouseenter="enter('8833124058792802926');" onmouseout="out('8833124058792802926');" style=""> 428                             CacheDb.COLUMN_NAME + &quot; LIKE ?&quot;, // SELECT query                             </span>
<span class="6575814019251974640" onmouseenter="enter('6575814019251974640');" onmouseout="out('6575814019251974640');" style=""> 429                             new String[] {                                                               </span>
<span class="-1005195456334514714" onmouseenter="enter('-1005195456334514714');" onmouseout="out('-1005195456334514714');" style=""> 430                                     WIDGET_PREFIX + packageName + &quot;/%&quot;,                                  </span>
<span class="7638587366414932409" onmouseenter="enter('7638587366414932409');" onmouseout="out('7638587366414932409');" style=""> 431                                     SHORTCUT_PREFIX + packageName + &quot;/%&quot;                                 </span>
<span class="6370673901196405011" onmouseenter="enter('6370673901196405011');" onmouseout="out('6370673901196405011');" style=""> 432                             } // args to SELECT query                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 433                     );                                                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 434                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 435                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 436                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 437                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438                 }                                                                                        </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 439                 synchronized(sInvalidPackages) {                                                         </span>
<span class="683140179110979858" onmouseenter="enter('683140179110979858');" onmouseout="out('683140179110979858');" style=""> 440                     sInvalidPackages.remove(packageName);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 442                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 444         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445     }                                                                                                    </span>
<span  style=""> 446                                                                                                          </span>
<span class="-429228780021119422" onmouseenter="enter('-429228780021119422');" onmouseout="out('-429228780021119422');" style=""> 447     private static void removeItemFromDb(final CacheDb cacheDb, final String objectName) {               </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 448         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 449             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 450                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 451                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 452                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7230732652281167865" onmouseenter="enter('7230732652281167865');" onmouseout="out('7230732652281167865');" style=""> 453                             CacheDb.COLUMN_NAME + &quot; = ? &quot;, // SELECT query                               </span>
<span class="-5686609646644956814" onmouseenter="enter('-5686609646644956814');" onmouseout="out('-5686609646644956814');" style=""> 454                             new String[] { objectName }); // args to SELECT query                        </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 455                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 456                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 457                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 458                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 460                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 462         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463     }                                                                                                    </span>
<span  style=""> 464                                                                                                          </span>
<span class="-5397085010036489521" onmouseenter="enter('-5397085010036489521');" onmouseout="out('-5397085010036489521');" style=""> 465     private Bitmap readFromDb(String name, Bitmap b) {                                                   </span>
<span class="-6915248341892392088" onmouseenter="enter('-6915248341892392088');" onmouseout="out('-6915248341892392088');" style=""> 466         if (mCachedSelectQuery == null) {                                                                </span>
<span class="8500727054799765575" onmouseenter="enter('8500727054799765575');" onmouseout="out('8500727054799765575');" style=""> 467             mCachedSelectQuery = CacheDb.COLUMN_NAME + &quot; = ? AND &quot; +                                     </span>
<span class="-5148548584287535582" onmouseenter="enter('-5148548584287535582');" onmouseout="out('-5148548584287535582');" style=""> 468                     CacheDb.COLUMN_SIZE + &quot; = ?&quot;;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469         }                                                                                                </span>
<span class="-3717850318373004709" onmouseenter="enter('-3717850318373004709');" onmouseout="out('-3717850318373004709');" style=""> 470         SQLiteDatabase db = mDb.getReadableDatabase();                                                   </span>
<span class="2593671339546598036" onmouseenter="enter('2593671339546598036');" onmouseout="out('2593671339546598036');" style=""> 471         Cursor result;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 472         try {                                                                                            </span>
<span class="44832651277024274" onmouseenter="enter('44832651277024274');" onmouseout="out('44832651277024274');" style=""> 473             result = db.query(CacheDb.TABLE_NAME,                                                        </span>
<span class="-8348630863841661561" onmouseenter="enter('-8348630863841661561');" onmouseout="out('-8348630863841661561');" style=""> 474                     new String[] { CacheDb.COLUMN_PREVIEW_BITMAP }, // cols to return                    </span>
<span class="9098744119488497529" onmouseenter="enter('9098744119488497529');" onmouseout="out('9098744119488497529');" style=""> 475                     mCachedSelectQuery, // select query                                                  </span>
<span class="7819507014643484139" onmouseenter="enter('7819507014643484139');" onmouseout="out('7819507014643484139');" style=""> 476                     new String[] { name, mSize }, // args to select query                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 477                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 478                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 479                     null,                                                                                </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 480                     null);                                                                               </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 481         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 482             recreateDb();                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 483             return null;                                                                                 </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 484         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 485             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 486             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487         }                                                                                                </span>
<span class="175106850439522001" onmouseenter="enter('175106850439522001');" onmouseout="out('175106850439522001');" style=""> 488         if (result.getCount() &gt; 0) {                                                                     </span>
<span class="-8233551716377839585" onmouseenter="enter('-8233551716377839585');" onmouseout="out('-8233551716377839585');" style=""> 489             result.moveToFirst();                                                                        </span>
<span class="-8295573450010349547" onmouseenter="enter('-8295573450010349547');" onmouseout="out('-8295573450010349547');" style=""> 490             byte[] blob = result.getBlob(0);                                                             </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 491             result.close();                                                                              </span>
<span class="5422706254339452362" onmouseenter="enter('5422706254339452362');" onmouseout="out('5422706254339452362');" style=""> 492             final BitmapFactory.Options opts = mCachedBitmapFactoryOptions.get();                        </span>
<span class="-4203120540780740867" onmouseenter="enter('-4203120540780740867');" onmouseout="out('-4203120540780740867');" style=""> 493             opts.inBitmap = b;                                                                           </span>
<span class="5746761561761774101" onmouseenter="enter('5746761561761774101');" onmouseout="out('5746761561761774101');" style=""> 494             opts.inSampleSize = 1;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 495             try {                                                                                        </span>
<span class="5467059833557948093" onmouseenter="enter('5467059833557948093');" onmouseout="out('5467059833557948093');" style=""> 496                 return BitmapFactory.decodeByteArray(blob, 0, blob.length, opts);                        </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 497             } catch (IllegalArgumentException e) {                                                       </span>
<span class="-8663451629875904419" onmouseenter="enter('-8663451629875904419');" onmouseout="out('-8663451629875904419');" style=""> 498                 removeItemFromDb(mDb, name);                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 499                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 501         } else {                                                                                         </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 502             result.close();                                                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 503             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505     }                                                                                                    </span>
<span  style=""> 506                                                                                                          </span>
<span class="-4571373922604646261" onmouseenter="enter('-4571373922604646261');" onmouseout="out('-4571373922604646261');" style=""> 507     private Bitmap generatePreview(Object info, Bitmap preview) {                                        </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 508         if (preview != null &amp;&amp;                                                                           </span>
<span class="-4427245060729789933" onmouseenter="enter('-4427245060729789933');" onmouseout="out('-4427245060729789933');" style=""> 509                 (preview.getWidth() != mPreviewBitmapWidth ||                                            </span>
<span class="-7111303570896946504" onmouseenter="enter('-7111303570896946504');" onmouseout="out('-7111303570896946504');" style=""> 510                 preview.getHeight() != mPreviewBitmapHeight)) {                                          </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 511             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512         }                                                                                                </span>
<span class="-3932360089392842216" onmouseenter="enter('-3932360089392842216');" onmouseout="out('-3932360089392842216');" style=""> 513         if (info instanceof AppWidgetProviderInfo) {                                                     </span>
<span class="-6841541424186777283" onmouseenter="enter('-6841541424186777283');" onmouseout="out('-6841541424186777283');" style=""> 514             return generateWidgetPreview((AppWidgetProviderInfo) info, preview);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 515         } else {                                                                                         </span>
<span class="5830651867016154139" onmouseenter="enter('5830651867016154139');" onmouseout="out('5830651867016154139');" style=""> 516             return generateShortcutPreview(                                                              </span>
<span class="5884922488800788426" onmouseenter="enter('5884922488800788426');" onmouseout="out('5884922488800788426');" style=""> 517                     (ResolveInfo) info, mPreviewBitmapWidth, mPreviewBitmapHeight, preview);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519     }                                                                                                    </span>
<span  style=""> 520                                                                                                          </span>
<span class="6578518467799953308" onmouseenter="enter('6578518467799953308');" onmouseout="out('6578518467799953308');" style=""> 521     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, Bitmap preview) {                    </span>
<span class="9147821438266271134" onmouseenter="enter('9147821438266271134');" onmouseout="out('9147821438266271134');" style=""> 522         int[] cellSpans = Launcher.getSpanForWidget(mContext, info);                                     </span>
<span class="-1431657331442958147" onmouseenter="enter('-1431657331442958147');" onmouseout="out('-1431657331442958147');" style=""> 523         int maxWidth = maxWidthForWidgetPreview(cellSpans[0]);                                           </span>
<span class="-6135167628743317243" onmouseenter="enter('-6135167628743317243');" onmouseout="out('-6135167628743317243');" style=""> 524         int maxHeight = maxHeightForWidgetPreview(cellSpans[1]);                                         </span>
<span class="-6510989053235413139" onmouseenter="enter('-6510989053235413139');" onmouseout="out('-6510989053235413139');" style=""> 525         return generateWidgetPreview(info, cellSpans[0], cellSpans[1],                                   </span>
<span class="5560351977065436698" onmouseenter="enter('5560351977065436698');" onmouseout="out('5560351977065436698');" style=""> 526                 maxWidth, maxHeight, preview, null);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527     }                                                                                                    </span>
<span  style=""> 528                                                                                                          </span>
<span class="-4962504510381054079" onmouseenter="enter('-4962504510381054079');" onmouseout="out('-4962504510381054079');" style=""> 529     public int maxWidthForWidgetPreview(int spanX) {                                                     </span>
<span class="5345170673015378699" onmouseenter="enter('5345170673015378699');" onmouseout="out('5345170673015378699');" style=""> 530         return Math.min(mPreviewBitmapWidth,                                                             </span>
<span class="-7096108314182907064" onmouseenter="enter('-7096108314182907064');" onmouseout="out('-7096108314182907064');" style=""> 531                 mWidgetSpacingLayout.estimateCellWidth(spanX));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532     }                                                                                                    </span>
<span  style=""> 533                                                                                                          </span>
<span class="-516047466055903408" onmouseenter="enter('-516047466055903408');" onmouseout="out('-516047466055903408');" style=""> 534     public int maxHeightForWidgetPreview(int spanY) {                                                    </span>
<span class="8958196798141008482" onmouseenter="enter('8958196798141008482');" onmouseout="out('8958196798141008482');" style=""> 535         return Math.min(mPreviewBitmapHeight,                                                            </span>
<span class="-8176698640675478774" onmouseenter="enter('-8176698640675478774');" onmouseout="out('-8176698640675478774');" style=""> 536                 mWidgetSpacingLayout.estimateCellHeight(spanY));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537     }                                                                                                    </span>
<span  style=""> 538                                                                                                          </span>
<span class="-6895334532662888649" onmouseenter="enter('-6895334532662888649');" onmouseout="out('-6895334532662888649');" style=""> 539     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, int cellHSpan, int cellVSpan,        </span>
<span class="-5508121118873891580" onmouseenter="enter('-5508121118873891580');" onmouseout="out('-5508121118873891580');" style=""> 540             int maxPreviewWidth, int maxPreviewHeight, Bitmap preview, int[] preScaledWidthOut) {        </span>
<span class="2529916654704436428" onmouseenter="enter('2529916654704436428');" onmouseout="out('2529916654704436428');" style=""> 541         // Load the preview image if possible                                                            </span>
<span class="931456242657570009" onmouseenter="enter('931456242657570009');" onmouseout="out('931456242657570009');" style=""> 542         if (maxPreviewWidth &lt; 0) maxPreviewWidth = Integer.MAX_VALUE;                                    </span>
<span class="-3276405287943718338" onmouseenter="enter('-3276405287943718338');" onmouseout="out('-3276405287943718338');" style=""> 543         if (maxPreviewHeight &lt; 0) maxPreviewHeight = Integer.MAX_VALUE;                                  </span>
<span  style=""> 544                                                                                                          </span>
<span class="-3049333615145638519" onmouseenter="enter('-3049333615145638519');" onmouseout="out('-3049333615145638519');" style=""> 545         Drawable drawable = null;                                                                        </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 546         if (info.previewImage != 0) {                                                                    </span>
<span class="-6995452363019574294" onmouseenter="enter('-6995452363019574294');" onmouseout="out('-6995452363019574294');" style=""> 547             drawable = mManager.loadPreview(info);                                                       </span>
<span class="281943916213481387" onmouseenter="enter('281943916213481387');" onmouseout="out('281943916213481387');" style=""> 548             if (drawable != null) {                                                                      </span>
<span class="559582177948747235" onmouseenter="enter('559582177948747235');" onmouseout="out('559582177948747235');" style=""> 549                 drawable = mutateOnMainThread(drawable);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 550             } else {                                                                                     </span>
<span class="7073909505336594696" onmouseenter="enter('7073909505336594696');" onmouseout="out('7073909505336594696');" style=""> 551                 Log.w(TAG, &quot;Can&#x27;t load widget preview drawable 0x&quot; +                                     </span>
<span class="-4346717227149782469" onmouseenter="enter('-4346717227149782469');" onmouseout="out('-4346717227149782469');" style=""> 552                         Integer.toHexString(info.previewImage) + &quot; for provider: &quot; + info.provider);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554         }                                                                                                </span>
<span  style=""> 555                                                                                                          </span>
<span class="5985266596175165266" onmouseenter="enter('5985266596175165266');" onmouseout="out('5985266596175165266');" style=""> 556         int previewWidth;                                                                                </span>
<span class="-7312246595783828327" onmouseenter="enter('-7312246595783828327');" onmouseout="out('-7312246595783828327');" style=""> 557         int previewHeight;                                                                               </span>
<span class="5524531081830166723" onmouseenter="enter('5524531081830166723');" onmouseout="out('5524531081830166723');" style=""> 558         Bitmap defaultPreview = null;                                                                    </span>
<span class="5121594519432393069" onmouseenter="enter('5121594519432393069');" onmouseout="out('5121594519432393069');" style=""> 559         boolean widgetPreviewExists = (drawable != null);                                                </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 560         if (widgetPreviewExists) {                                                                       </span>
<span class="7694696434619666028" onmouseenter="enter('7694696434619666028');" onmouseout="out('7694696434619666028');" style=""> 561             previewWidth = drawable.getIntrinsicWidth();                                                 </span>
<span class="-5860514303309291265" onmouseenter="enter('-5860514303309291265');" onmouseout="out('-5860514303309291265');" style=""> 562             previewHeight = drawable.getIntrinsicHeight();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 563         } else {                                                                                         </span>
<span class="7833733472444702454" onmouseenter="enter('7833733472444702454');" onmouseout="out('7833733472444702454');" style=""> 564             // Generate a preview image if we couldn&#x27;t load one                                          </span>
<span class="-8710794757779095209" onmouseenter="enter('-8710794757779095209');" onmouseout="out('-8710794757779095209');" style=""> 565             if (cellHSpan &lt; 1) cellHSpan = 1;                                                            </span>
<span class="-779725371469556670" onmouseenter="enter('-779725371469556670');" onmouseout="out('-779725371469556670');" style=""> 566             if (cellVSpan &lt; 1) cellVSpan = 1;                                                            </span>
<span  style=""> 567                                                                                                          </span>
<span class="3565276356973562387" onmouseenter="enter('3565276356973562387');" onmouseout="out('3565276356973562387');" style=""> 568             // This Drawable is not directly drawn, so there&#x27;s no need to mutate it.                     </span>
<span class="-5021189500908681979" onmouseenter="enter('-5021189500908681979');" onmouseout="out('-5021189500908681979');" style=""> 569             BitmapDrawable previewDrawable = (BitmapDrawable) mContext.getResources()                    </span>
<span class="3152690746910736269" onmouseenter="enter('3152690746910736269');" onmouseout="out('3152690746910736269');" style=""> 570                     .getDrawable(R.drawable.widget_tile);                                                </span>
<span class="-5932659289331905035" onmouseenter="enter('-5932659289331905035');" onmouseout="out('-5932659289331905035');" style=""> 571             final int previewDrawableWidth = previewDrawable                                             </span>
<span class="-5783669958167413803" onmouseenter="enter('-5783669958167413803');" onmouseout="out('-5783669958167413803');" style=""> 572                     .getIntrinsicWidth();                                                                </span>
<span class="4431322150991047787" onmouseenter="enter('4431322150991047787');" onmouseout="out('4431322150991047787');" style=""> 573             final int previewDrawableHeight = previewDrawable                                            </span>
<span class="4098769707366186014" onmouseenter="enter('4098769707366186014');" onmouseout="out('4098769707366186014');" style=""> 574                     .getIntrinsicHeight();                                                               </span>
<span class="8887455390458335872" onmouseenter="enter('8887455390458335872');" onmouseout="out('8887455390458335872');" style=""> 575             previewWidth = previewDrawableWidth * cellHSpan;                                             </span>
<span class="-8341882922226410648" onmouseenter="enter('-8341882922226410648');" onmouseout="out('-8341882922226410648');" style=""> 576             previewHeight = previewDrawableHeight * cellVSpan;                                           </span>
<span  style=""> 577                                                                                                          </span>
<span class="-737373095753296600" onmouseenter="enter('-737373095753296600');" onmouseout="out('-737373095753296600');" style=""> 578             defaultPreview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 579             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="848607727045658162" onmouseenter="enter('848607727045658162');" onmouseout="out('848607727045658162');" style=""> 580             c.setBitmap(defaultPreview);                                                                 </span>
<span class="4673250187052598192" onmouseenter="enter('4673250187052598192');" onmouseout="out('4673250187052598192');" style=""> 581             Paint p = mDefaultAppWidgetPreviewPaint.get();                                               </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 582             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 583                 p = new Paint();                                                                         </span>
<span class="9031053372645621365" onmouseenter="enter('9031053372645621365');" onmouseout="out('9031053372645621365');" style=""> 584                 p.setShader(new BitmapShader(previewDrawable.getBitmap(),                                </span>
<span class="1595910380715064067" onmouseenter="enter('1595910380715064067');" onmouseout="out('1595910380715064067');" style=""> 585                         Shader.TileMode.REPEAT, Shader.TileMode.REPEAT));                                </span>
<span class="-8603584172680459929" onmouseenter="enter('-8603584172680459929');" onmouseout="out('-8603584172680459929');" style=""> 586                 mDefaultAppWidgetPreviewPaint.set(p);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587             }                                                                                            </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 588             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="4633920667503149983" onmouseenter="enter('4633920667503149983');" onmouseout="out('4633920667503149983');" style=""> 589             dest.set(0, 0, previewWidth, previewHeight);                                                 </span>
<span class="-470581757098027879" onmouseenter="enter('-470581757098027879');" onmouseout="out('-470581757098027879');" style=""> 590             c.drawRect(dest, p);                                                                         </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 591             c.setBitmap(null);                                                                           </span>
<span  style=""> 592                                                                                                          </span>
<span class="4647625888602990242" onmouseenter="enter('4647625888602990242');" onmouseout="out('4647625888602990242');" style=""> 593             // Draw the icon in the top left corner                                                      </span>
<span class="3531213633716353102" onmouseenter="enter('3531213633716353102');" onmouseout="out('3531213633716353102');" style=""> 594             int minOffset = (int) (mAppIconSize * WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE);               </span>
<span class="-3256500215342314396" onmouseenter="enter('-3256500215342314396');" onmouseout="out('-3256500215342314396');" style=""> 595             int smallestSide = Math.min(previewWidth, previewHeight);                                    </span>
<span class="1098745458783687815" onmouseenter="enter('1098745458783687815');" onmouseout="out('1098745458783687815');" style=""> 596             float iconScale = Math.min((float) smallestSide                                              </span>
<span class="7317986328586297721" onmouseenter="enter('7317986328586297721');" onmouseout="out('7317986328586297721');" style=""> 597                     / (mAppIconSize + 2 * minOffset), 1f);                                               </span>
<span  style=""> 598                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 599             try {                                                                                        </span>
<span class="-837531234335200976" onmouseenter="enter('-837531234335200976');" onmouseout="out('-837531234335200976');" style=""> 600                 Drawable icon = mManager.loadIcon(info, mIconCache);                                     </span>
<span class="-4192144256919602329" onmouseenter="enter('-4192144256919602329');" onmouseout="out('-4192144256919602329');" style=""> 601                 if (icon != null) {                                                                      </span>
<span class="-1224594640800103937" onmouseenter="enter('-1224594640800103937');" onmouseout="out('-1224594640800103937');" style=""> 602                     int hoffset = (int) ((previewDrawableWidth - mAppIconSize * iconScale) / 2);         </span>
<span class="-389205104576287013" onmouseenter="enter('-389205104576287013');" onmouseout="out('-389205104576287013');" style=""> 603                     int yoffset = (int) ((previewDrawableHeight - mAppIconSize * iconScale) / 2);        </span>
<span class="-867380701080615138" onmouseenter="enter('-867380701080615138');" onmouseout="out('-867380701080615138');" style=""> 604                     icon = mutateOnMainThread(icon);                                                     </span>
<span class="1665310338408239466" onmouseenter="enter('1665310338408239466');" onmouseout="out('1665310338408239466');" style=""> 605                     renderDrawableToBitmap(icon, defaultPreview, hoffset,                                </span>
<span class="8191900375173585890" onmouseenter="enter('8191900375173585890');" onmouseout="out('8191900375173585890');" style=""> 606                             yoffset, (int) (mAppIconSize * iconScale),                                   </span>
<span class="-5886521530151300680" onmouseenter="enter('-5886521530151300680');" onmouseout="out('-5886521530151300680');" style=""> 607                             (int) (mAppIconSize * iconScale));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608                 }                                                                                        </span>
<span class="5183756364953253383" onmouseenter="enter('5183756364953253383');" onmouseout="out('5183756364953253383');" style=""> 609             } catch (Resources.NotFoundException e) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 611         }                                                                                                </span>
<span  style=""> 612                                                                                                          </span>
<span class="6949857229431854068" onmouseenter="enter('6949857229431854068');" onmouseout="out('6949857229431854068');" style=""> 613         // Scale to fit width only - let the widget preview be clipped in the                            </span>
<span class="8360805034192073884" onmouseenter="enter('8360805034192073884');" onmouseout="out('8360805034192073884');" style=""> 614         // vertical dimension                                                                            </span>
<span class="-8224051742145745082" onmouseenter="enter('-8224051742145745082');" onmouseout="out('-8224051742145745082');" style=""> 615         float scale = 1f;                                                                                </span>
<span class="6149434037546525815" onmouseenter="enter('6149434037546525815');" onmouseout="out('6149434037546525815');" style=""> 616         if (preScaledWidthOut != null) {                                                                 </span>
<span class="2306433834272734783" onmouseenter="enter('2306433834272734783');" onmouseout="out('2306433834272734783');" style=""> 617             preScaledWidthOut[0] = previewWidth;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618         }                                                                                                </span>
<span class="-7638941371937567348" onmouseenter="enter('-7638941371937567348');" onmouseout="out('-7638941371937567348');" style=""> 619         if (previewWidth &gt; maxPreviewWidth) {                                                            </span>
<span class="-6167807034013491459" onmouseenter="enter('-6167807034013491459');" onmouseout="out('-6167807034013491459');" style=""> 620             scale = maxPreviewWidth / (float) previewWidth;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621         }                                                                                                </span>
<span class="-8893868344639903626" onmouseenter="enter('-8893868344639903626');" onmouseout="out('-8893868344639903626');" style=""> 622         if (scale != 1f) {                                                                               </span>
<span class="-6338970909485118519" onmouseenter="enter('-6338970909485118519');" onmouseout="out('-6338970909485118519');" style=""> 623             previewWidth = (int) (scale * previewWidth);                                                 </span>
<span class="2442469555843251122" onmouseenter="enter('2442469555843251122');" onmouseout="out('2442469555843251122');" style=""> 624             previewHeight = (int) (scale * previewHeight);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625         }                                                                                                </span>
<span  style=""> 626                                                                                                          </span>
<span class="-1124372066791938196" onmouseenter="enter('-1124372066791938196');" onmouseout="out('-1124372066791938196');" style=""> 627         // If a bitmap is passed in, we use it; otherwise, we create a bitmap of the right size          </span>
<span class="2486895102595751802" onmouseenter="enter('2486895102595751802');" onmouseout="out('2486895102595751802');" style=""> 628         if (preview == null) {                                                                           </span>
<span class="6637154682204057097" onmouseenter="enter('6637154682204057097');" onmouseout="out('6637154682204057097');" style=""> 629             preview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630         }                                                                                                </span>
<span  style=""> 631                                                                                                          </span>
<span class="-2080916171919384218" onmouseenter="enter('-2080916171919384218');" onmouseout="out('-2080916171919384218');" style=""> 632         // Draw the scaled preview into the final bitmap                                                 </span>
<span class="3369675460464663159" onmouseenter="enter('3369675460464663159');" onmouseout="out('3369675460464663159');" style=""> 633         int x = (preview.getWidth() - previewWidth) / 2;                                                 </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 634         if (widgetPreviewExists) {                                                                       </span>
<span class="-6966420244976420379" onmouseenter="enter('-6966420244976420379');" onmouseout="out('-6966420244976420379');" style=""> 635             renderDrawableToBitmap(drawable, preview, x, 0, previewWidth,                                </span>
<span class="-7548196549309427555" onmouseenter="enter('-7548196549309427555');" onmouseout="out('-7548196549309427555');" style=""> 636                     previewHeight);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 637         } else {                                                                                         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 638             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="5281190707868665361" onmouseenter="enter('5281190707868665361');" onmouseout="out('5281190707868665361');" style=""> 639             final Rect src = mCachedAppWidgetPreviewSrcRect.get();                                       </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 640             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 641             c.setBitmap(preview);                                                                        </span>
<span class="-8725434908843264237" onmouseenter="enter('-8725434908843264237');" onmouseout="out('-8725434908843264237');" style=""> 642             src.set(0, 0, defaultPreview.getWidth(), defaultPreview.getHeight());                        </span>
<span class="-7071368679565427433" onmouseenter="enter('-7071368679565427433');" onmouseout="out('-7071368679565427433');" style=""> 643             dest.set(x, 0, x + previewWidth, previewHeight);                                             </span>
<span  style=""> 644                                                                                                          </span>
<span class="5839465204107083552" onmouseenter="enter('5839465204107083552');" onmouseout="out('5839465204107083552');" style=""> 645             Paint p = mCachedAppWidgetPreviewPaint.get();                                                </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 646             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 647                 p = new Paint();                                                                         </span>
<span class="-3846510342158419561" onmouseenter="enter('-3846510342158419561');" onmouseout="out('-3846510342158419561');" style=""> 648                 p.setFilterBitmap(true);                                                                 </span>
<span class="8711891207106027486" onmouseenter="enter('8711891207106027486');" onmouseout="out('8711891207106027486');" style=""> 649                 mCachedAppWidgetPreviewPaint.set(p);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650             }                                                                                            </span>
<span class="-8322704971015823035" onmouseenter="enter('-8322704971015823035');" onmouseout="out('-8322704971015823035');" style=""> 651             c.drawBitmap(defaultPreview, src, dest, p);                                                  </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 652             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653         }                                                                                                </span>
<span class="-5318059876677185928" onmouseenter="enter('-5318059876677185928');" onmouseout="out('-5318059876677185928');" style=""> 654         return mManager.getBadgeBitmap(info, preview);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 655     }                                                                                                    </span>
<span  style=""> 656                                                                                                          </span>
<span class="-2036338097340155865" onmouseenter="enter('-2036338097340155865');" onmouseout="out('-2036338097340155865');" style=""> 657     private Bitmap generateShortcutPreview(                                                              </span>
<span class="1557751875108084858" onmouseenter="enter('1557751875108084858');" onmouseout="out('1557751875108084858');" style=""> 658             ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview) {                             </span>
<span class="6669617465194046785" onmouseenter="enter('6669617465194046785');" onmouseout="out('6669617465194046785');" style=""> 659         Bitmap tempBitmap = mCachedShortcutPreviewBitmap.get();                                          </span>
<span class="8492580593566939346" onmouseenter="enter('8492580593566939346');" onmouseout="out('8492580593566939346');" style=""> 660         final Canvas c = mCachedShortcutPreviewCanvas.get();                                             </span>
<span class="3344452031699903410" onmouseenter="enter('3344452031699903410');" onmouseout="out('3344452031699903410');" style=""> 661         if (tempBitmap == null ||                                                                        </span>
<span class="-1798938713535043835" onmouseenter="enter('-1798938713535043835');" onmouseout="out('-1798938713535043835');" style=""> 662                 tempBitmap.getWidth() != maxWidth ||                                                     </span>
<span class="9083140300107171771" onmouseenter="enter('9083140300107171771');" onmouseout="out('9083140300107171771');" style=""> 663                 tempBitmap.getHeight() != maxHeight) {                                                   </span>
<span class="5079923942824258796" onmouseenter="enter('5079923942824258796');" onmouseout="out('5079923942824258796');" style=""> 664             tempBitmap = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                     </span>
<span class="3252713296815828481" onmouseenter="enter('3252713296815828481');" onmouseout="out('3252713296815828481');" style=""> 665             mCachedShortcutPreviewBitmap.set(tempBitmap);                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 666         } else {                                                                                         </span>
<span class="2908194814219559361" onmouseenter="enter('2908194814219559361');" onmouseout="out('2908194814219559361');" style=""> 667             c.setBitmap(tempBitmap);                                                                     </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 668             c.drawColor(0, PorterDuff.Mode.CLEAR);                                                       </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 669             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670         }                                                                                                </span>
<span class="-895750054343748789" onmouseenter="enter('-895750054343748789');" onmouseout="out('-895750054343748789');" style=""> 671         // Render the icon                                                                               </span>
<span class="-8632811780119956337" onmouseenter="enter('-8632811780119956337');" onmouseout="out('-8632811780119956337');" style=""> 672         Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info.activityInfo));                </span>
<span  style=""> 673                                                                                                          </span>
<span class="-7461308767564647078" onmouseenter="enter('-7461308767564647078');" onmouseout="out('-7461308767564647078');" style=""> 674         int paddingTop = mContext.                                                                       </span>
<span class="-5900363241936444267" onmouseenter="enter('-5900363241936444267');" onmouseout="out('-5900363241936444267');" style=""> 675                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);            </span>
<span class="5781485035466420663" onmouseenter="enter('5781485035466420663');" onmouseout="out('5781485035466420663');" style=""> 676         int paddingLeft = mContext.                                                                      </span>
<span class="2328331898560910495" onmouseenter="enter('2328331898560910495');" onmouseout="out('2328331898560910495');" style=""> 677                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);           </span>
<span class="5829344697485851220" onmouseenter="enter('5829344697485851220');" onmouseout="out('5829344697485851220');" style=""> 678         int paddingRight = mContext.                                                                     </span>
<span class="-8885288017836034916" onmouseenter="enter('-8885288017836034916');" onmouseout="out('-8885288017836034916');" style=""> 679                 getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);          </span>
<span  style=""> 680                                                                                                          </span>
<span class="9041541765806161530" onmouseenter="enter('9041541765806161530');" onmouseout="out('9041541765806161530');" style=""> 681         int scaledIconWidth = (maxWidth - paddingLeft - paddingRight);                                   </span>
<span  style=""> 682                                                                                                          </span>
<span class="3221827998305751243" onmouseenter="enter('3221827998305751243');" onmouseout="out('3221827998305751243');" style=""> 683         renderDrawableToBitmap(                                                                          </span>
<span class="5202977166144268859" onmouseenter="enter('5202977166144268859');" onmouseout="out('5202977166144268859');" style=""> 684                 icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidth);            </span>
<span  style=""> 685                                                                                                          </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 686         if (preview != null &amp;&amp;                                                                           </span>
<span class="-4616488258627842412" onmouseenter="enter('-4616488258627842412');" onmouseout="out('-4616488258627842412');" style=""> 687                 (preview.getWidth() != maxWidth || preview.getHeight() != maxHeight)) {                  </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 688             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="3365320965403910466" onmouseenter="enter('3365320965403910466');" onmouseout="out('3365320965403910466');" style=""> 689         } else if (preview == null) {                                                                    </span>
<span class="4551594767613519312" onmouseenter="enter('4551594767613519312');" onmouseout="out('4551594767613519312');" style=""> 690             preview = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691         }                                                                                                </span>
<span  style=""> 692                                                                                                          </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 693         c.setBitmap(preview);                                                                            </span>
<span class="8934981767024497500" onmouseenter="enter('8934981767024497500');" onmouseout="out('8934981767024497500');" style=""> 694         // Draw a desaturated/scaled version of the icon in the background as a watermark                </span>
<span class="-518774087151586601" onmouseenter="enter('-518774087151586601');" onmouseout="out('-518774087151586601');" style=""> 695         Paint p = mCachedShortcutPreviewPaint.get();                                                     </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 696         if (p == null) {                                                                                 </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 697             p = new Paint();                                                                             </span>
<span class="5185800516692981036" onmouseenter="enter('5185800516692981036');" onmouseout="out('5185800516692981036');" style=""> 698             ColorMatrix colorMatrix = new ColorMatrix();                                                 </span>
<span class="-4096104009908534310" onmouseenter="enter('-4096104009908534310');" onmouseout="out('-4096104009908534310');" style=""> 699             colorMatrix.setSaturation(0);                                                                </span>
<span class="-2105686232381577699" onmouseenter="enter('-2105686232381577699');" onmouseout="out('-2105686232381577699');" style=""> 700             p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));                                   </span>
<span class="-725456443631950326" onmouseenter="enter('-725456443631950326');" onmouseout="out('-725456443631950326');" style=""> 701             p.setAlpha((int) (255 * 0.06f));                                                             </span>
<span class="-4885683919835504124" onmouseenter="enter('-4885683919835504124');" onmouseout="out('-4885683919835504124');" style=""> 702             mCachedShortcutPreviewPaint.set(p);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703         }                                                                                                </span>
<span class="-4554115702547152566" onmouseenter="enter('-4554115702547152566');" onmouseout="out('-4554115702547152566');" style=""> 704         c.drawBitmap(tempBitmap, 0, 0, p);                                                               </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 705         c.setBitmap(null);                                                                               </span>
<span  style=""> 706                                                                                                          </span>
<span class="-5738465230776990197" onmouseenter="enter('-5738465230776990197');" onmouseout="out('-5738465230776990197');" style=""> 707         renderDrawableToBitmap(icon, preview, 0, 0, mAppIconSize, mAppIconSize);                         </span>
<span  style=""> 708                                                                                                          </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 709         return preview;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710     }                                                                                                    </span>
<span  style=""> 711                                                                                                          </span>
<span class="-2512069815104909632" onmouseenter="enter('-2512069815104909632');" onmouseout="out('-2512069815104909632');" style=""> 712     private static void renderDrawableToBitmap(                                                          </span>
<span class="-281586385806654310" onmouseenter="enter('-281586385806654310');" onmouseout="out('-281586385806654310');" style=""> 713             Drawable d, Bitmap bitmap, int x, int y, int w, int h) {                                     </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 714         if (bitmap != null) {                                                                            </span>
<span class="417388478829800263" onmouseenter="enter('417388478829800263');" onmouseout="out('417388478829800263');" style=""> 715             Canvas c = new Canvas(bitmap);                                                               </span>
<span class="2629107935702523978" onmouseenter="enter('2629107935702523978');" onmouseout="out('2629107935702523978');" style=""> 716             Rect oldBounds = d.copyBounds();                                                             </span>
<span class="-7883404386706876736" onmouseenter="enter('-7883404386706876736');" onmouseout="out('-7883404386706876736');" style=""> 717             d.setBounds(x, y, x + w, y + h);                                                             </span>
<span class="3763902819788011622" onmouseenter="enter('3763902819788011622');" onmouseout="out('3763902819788011622');" style=""> 718             d.draw(c);                                                                                   </span>
<span class="-5442987023720851592" onmouseenter="enter('-5442987023720851592');" onmouseout="out('-5442987023720851592');" style=""> 719             d.setBounds(oldBounds); // Restore the bounds                                                </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 720             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 722     }                                                                                                    </span>
<span  style=""> 723                                                                                                          </span>
<span class="-2265124982478046254" onmouseenter="enter('-2265124982478046254');" onmouseout="out('-2265124982478046254');" style=""> 724     private Drawable mutateOnMainThread(final Drawable drawable) {                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 725         try {                                                                                            </span>
<span class="3177563387853690691" onmouseenter="enter('3177563387853690691');" onmouseout="out('3177563387853690691');" style=""> 726             return mMainThreadExecutor.submit(new Callable&lt;Drawable&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 727                 @Override                                                                                </span>
<span class="4251206983441278885" onmouseenter="enter('4251206983441278885');" onmouseout="out('4251206983441278885');" style=""> 728                 public Drawable call() throws Exception {                                                </span>
<span class="721315677862243657" onmouseenter="enter('721315677862243657');" onmouseout="out('721315677862243657');" style=""> 729                     return drawable.mutate();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 730                 }                                                                                        </span>
<span class="8868058436262798399" onmouseenter="enter('8868058436262798399');" onmouseout="out('8868058436262798399');" style=""> 731             }).get();                                                                                    </span>
<span class="-7528533024404460182" onmouseenter="enter('-7528533024404460182');" onmouseout="out('-7528533024404460182');" style=""> 732         } catch (InterruptedException e) {                                                               </span>
<span class="8315424094067049480" onmouseenter="enter('8315424094067049480');" onmouseout="out('8315424094067049480');" style=""> 733             Thread.currentThread().interrupt();                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 734             throw new RuntimeException(e);                                                               </span>
<span class="-3674505659955768067" onmouseenter="enter('-3674505659955768067');" onmouseout="out('-3674505659955768067');" style=""> 735         } catch (ExecutionException e) {                                                                 </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 736             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738     }                                                                                                    </span>
<span  style=""> 739                                                                                                          </span>
<span class="-1664432510733041020" onmouseenter="enter('-1664432510733041020');" onmouseout="out('-1664432510733041020');" style=""> 740     private static final int MAX_OPEN_FILES = 1024;                                                      </span>
<span class="9072161857204403261" onmouseenter="enter('9072161857204403261');" onmouseout="out('9072161857204403261');" style=""> 741     private static final int SAMPLE_RATE = 23;                                                           </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 742     /**                                                                                                  </span>
<span class="4777297713483982548" onmouseenter="enter('4777297713483982548');" onmouseout="out('4777297713483982548');" style=""> 743      * Dumps all files that are open in this process without allocating a file descriptor.               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 744      */                                                                                                  </span>
<span class="7630668132257036624" onmouseenter="enter('7630668132257036624');" onmouseout="out('7630668132257036624');" style=""> 745     private static void dumpOpenFiles() {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 746         try {                                                                                            </span>
<span class="7095374185665412657" onmouseenter="enter('7095374185665412657');" onmouseout="out('7095374185665412657');" style=""> 747             Log.i(TAG, &quot;DUMP OF OPEN FILES (sample rate: 1 every &quot; + SAMPLE_RATE + &quot;):&quot;);                </span>
<span class="-6063809008451063811" onmouseenter="enter('-6063809008451063811');" onmouseout="out('-6063809008451063811');" style=""> 748             final String TYPE_APK = &quot;apk&quot;;                                                               </span>
<span class="-6901274176875279046" onmouseenter="enter('-6901274176875279046');" onmouseout="out('-6901274176875279046');" style=""> 749             final String TYPE_JAR = &quot;jar&quot;;                                                               </span>
<span class="-4233944286779457769" onmouseenter="enter('-4233944286779457769');" onmouseout="out('-4233944286779457769');" style=""> 750             final String TYPE_PIPE = &quot;pipe&quot;;                                                             </span>
<span class="-7830089877175241432" onmouseenter="enter('-7830089877175241432');" onmouseout="out('-7830089877175241432');" style=""> 751             final String TYPE_SOCKET = &quot;socket&quot;;                                                         </span>
<span class="6234651693695236755" onmouseenter="enter('6234651693695236755');" onmouseout="out('6234651693695236755');" style=""> 752             final String TYPE_DB = &quot;db&quot;;                                                                 </span>
<span class="-6587583242995441423" onmouseenter="enter('-6587583242995441423');" onmouseout="out('-6587583242995441423');" style=""> 753             final String TYPE_ANON_INODE = &quot;anon_inode&quot;;                                                 </span>
<span class="-3500545166621689968" onmouseenter="enter('-3500545166621689968');" onmouseout="out('-3500545166621689968');" style=""> 754             final String TYPE_DEV = &quot;dev&quot;;                                                               </span>
<span class="2067143891119682248" onmouseenter="enter('2067143891119682248');" onmouseout="out('2067143891119682248');" style=""> 755             final String TYPE_NON_FS = &quot;non-fs&quot;;                                                         </span>
<span class="5330062242195911314" onmouseenter="enter('5330062242195911314');" onmouseout="out('5330062242195911314');" style=""> 756             final String TYPE_OTHER = &quot;other&quot;;                                                           </span>
<span class="4846737914738595164" onmouseenter="enter('4846737914738595164');" onmouseout="out('4846737914738595164');" style=""> 757             List&lt;String&gt; types = Arrays.asList(TYPE_APK, TYPE_JAR, TYPE_PIPE, TYPE_SOCKET, TYPE_DB,      </span>
<span class="-1126389211762394977" onmouseenter="enter('-1126389211762394977');" onmouseout="out('-1126389211762394977');" style=""> 758                     TYPE_ANON_INODE, TYPE_DEV, TYPE_NON_FS, TYPE_OTHER);                                 </span>
<span class="7087384337453352553" onmouseenter="enter('7087384337453352553');" onmouseout="out('7087384337453352553');" style=""> 759             int[] count = new int[types.size()];                                                         </span>
<span class="-400567270817057775" onmouseenter="enter('-400567270817057775');" onmouseout="out('-400567270817057775');" style=""> 760             int[] duplicates = new int[types.size()];                                                    </span>
<span class="-5112763339406897335" onmouseenter="enter('-5112763339406897335');" onmouseout="out('-5112763339406897335');" style=""> 761             HashSet&lt;String&gt; files = new HashSet&lt;String&gt;();                                               </span>
<span class="-926962837754337949" onmouseenter="enter('-926962837754337949');" onmouseout="out('-926962837754337949');" style=""> 762             int total = 0;                                                                               </span>
<span class="1028290052541393010" onmouseenter="enter('1028290052541393010');" onmouseout="out('1028290052541393010');" style=""> 763             for (int i = 0; i &lt; MAX_OPEN_FILES; i++) {                                                   </span>
<span class="3040328939873692127" onmouseenter="enter('3040328939873692127');" onmouseout="out('3040328939873692127');" style=""> 764                 // This is a gigantic hack but unfortunately the only way to resolve an fd               </span>
<span class="-4129207097038329090" onmouseenter="enter('-4129207097038329090');" onmouseout="out('-4129207097038329090');" style=""> 765                 // to a file name. Note that we have to loop over all possible fds because               </span>
<span class="6927440074701305186" onmouseenter="enter('6927440074701305186');" onmouseout="out('6927440074701305186');" style=""> 766                 // reading the directory would require allocating a new fd. The kernel is                </span>
<span class="-7335721905258259512" onmouseenter="enter('-7335721905258259512');" onmouseout="out('-7335721905258259512');" style=""> 767                 // currently implemented such that no fd is larger then the current rlimit,              </span>
<span class="5240836059895527485" onmouseenter="enter('5240836059895527485');" onmouseout="out('5240836059895527485');" style=""> 768                 // which is why it&#x27;s safe to loop over them in such a way.                               </span>
<span class="-4546857229319265624" onmouseenter="enter('-4546857229319265624');" onmouseout="out('-4546857229319265624');" style=""> 769                 String fd = &quot;/proc/self/fd/&quot; + i;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 770                 try {                                                                                    </span>
<span class="-5133016265508323671" onmouseenter="enter('-5133016265508323671');" onmouseout="out('-5133016265508323671');" style=""> 771                     // getCanonicalPath() uses readlink behind the scene which doesn&#x27;t require           </span>
<span class="-6226268635961992542" onmouseenter="enter('-6226268635961992542');" onmouseout="out('-6226268635961992542');" style=""> 772                     // a file descriptor.                                                                </span>
<span class="-6892856404262336354" onmouseenter="enter('-6892856404262336354');" onmouseout="out('-6892856404262336354');" style=""> 773                     String resolved = new File(fd).getCanonicalPath();                                   </span>
<span class="-6768751510751326128" onmouseenter="enter('-6768751510751326128');" onmouseout="out('-6768751510751326128');" style=""> 774                     int type = types.indexOf(TYPE_OTHER);                                                </span>
<span class="-848598904663730437" onmouseenter="enter('-848598904663730437');" onmouseout="out('-848598904663730437');" style=""> 775                     if (resolved.startsWith(&quot;/dev/&quot;)) {                                                  </span>
<span class="-4879693837873897752" onmouseenter="enter('-4879693837873897752');" onmouseout="out('-4879693837873897752');" style=""> 776                         type = types.indexOf(TYPE_DEV);                                                  </span>
<span class="-125641070977798446" onmouseenter="enter('-125641070977798446');" onmouseout="out('-125641070977798446');" style=""> 777                     } else if (resolved.endsWith(&quot;.apk&quot;)) {                                              </span>
<span class="8152606461038952319" onmouseenter="enter('8152606461038952319');" onmouseout="out('8152606461038952319');" style=""> 778                         type = types.indexOf(TYPE_APK);                                                  </span>
<span class="-8895861587282636352" onmouseenter="enter('-8895861587282636352');" onmouseout="out('-8895861587282636352');" style=""> 779                     } else if (resolved.endsWith(&quot;.jar&quot;)) {                                              </span>
<span class="6211428299849972552" onmouseenter="enter('6211428299849972552');" onmouseout="out('6211428299849972552');" style=""> 780                         type = types.indexOf(TYPE_JAR);                                                  </span>
<span class="-6474781270675272142" onmouseenter="enter('-6474781270675272142');" onmouseout="out('-6474781270675272142');" style=""> 781                     } else if (resolved.contains(&quot;/fd/pipe:&quot;)) {                                         </span>
<span class="4492281361349576419" onmouseenter="enter('4492281361349576419');" onmouseout="out('4492281361349576419');" style=""> 782                         type = types.indexOf(TYPE_PIPE);                                                 </span>
<span class="5570982548020413210" onmouseenter="enter('5570982548020413210');" onmouseout="out('5570982548020413210');" style=""> 783                     } else if (resolved.contains(&quot;/fd/socket:&quot;)) {                                       </span>
<span class="5340928477240826099" onmouseenter="enter('5340928477240826099');" onmouseout="out('5340928477240826099');" style=""> 784                         type = types.indexOf(TYPE_SOCKET);                                               </span>
<span class="-1889318263670279425" onmouseenter="enter('-1889318263670279425');" onmouseout="out('-1889318263670279425');" style=""> 785                     } else if (resolved.contains(&quot;/fd/anon_inode:&quot;)) {                                   </span>
<span class="7975978575615021567" onmouseenter="enter('7975978575615021567');" onmouseout="out('7975978575615021567');" style=""> 786                         type = types.indexOf(TYPE_ANON_INODE);                                           </span>
<span class="-206211141383156363" onmouseenter="enter('-206211141383156363');" onmouseout="out('-206211141383156363');" style=""> 787                     } else if (resolved.endsWith(&quot;.db&quot;) || resolved.contains(&quot;/databases/&quot;)) {           </span>
<span class="8848130876067097546" onmouseenter="enter('8848130876067097546');" onmouseout="out('8848130876067097546');" style=""> 788                         type = types.indexOf(TYPE_DB);                                                   </span>
<span class="-3013458219347023666" onmouseenter="enter('-3013458219347023666');" onmouseout="out('-3013458219347023666');" style=""> 789                     } else if (resolved.startsWith(&quot;/proc/&quot;) &amp;&amp; resolved.contains(&quot;/fd/&quot;)) {             </span>
<span class="-4021067240164904881" onmouseenter="enter('-4021067240164904881');" onmouseout="out('-4021067240164904881');" style=""> 790                         // Those are the files that don&#x27;t point anywhere on the file system.             </span>
<span class="1766191980587176647" onmouseenter="enter('1766191980587176647');" onmouseout="out('1766191980587176647');" style=""> 791                         // getCanonicalPath() wrongly interprets these as relative symlinks and          </span>
<span class="8319631295934473117" onmouseenter="enter('8319631295934473117');" onmouseout="out('8319631295934473117');" style=""> 792                         // resolves them within /proc/&lt;pid&gt;/fd/.                                         </span>
<span class="-6071677259167823524" onmouseenter="enter('-6071677259167823524');" onmouseout="out('-6071677259167823524');" style=""> 793                         type = types.indexOf(TYPE_NON_FS);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794                     }                                                                                    </span>
<span class="-1328162661144416286" onmouseenter="enter('-1328162661144416286');" onmouseout="out('-1328162661144416286');" style=""> 795                     count[type]++;                                                                       </span>
<span class="-6740236498121811269" onmouseenter="enter('-6740236498121811269');" onmouseout="out('-6740236498121811269');" style=""> 796                     total++;                                                                             </span>
<span class="-1847477132387490804" onmouseenter="enter('-1847477132387490804');" onmouseout="out('-1847477132387490804');" style=""> 797                     if (files.contains(resolved)) {                                                      </span>
<span class="3216339987616567221" onmouseenter="enter('3216339987616567221');" onmouseout="out('3216339987616567221');" style=""> 798                         duplicates[type]++;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799                     }                                                                                    </span>
<span class="-556311909615308250" onmouseenter="enter('-556311909615308250');" onmouseout="out('-556311909615308250');" style=""> 800                     files.add(resolved);                                                                 </span>
<span class="3281685662955304691" onmouseenter="enter('3281685662955304691');" onmouseout="out('3281685662955304691');" style=""> 801                     if (total % SAMPLE_RATE == 0) {                                                      </span>
<span class="-5929979194141152550" onmouseenter="enter('-5929979194141152550');" onmouseout="out('-5929979194141152550');" style=""> 802                         Log.i(TAG, &quot; fd &quot; + i + &quot;: &quot; + resolved                                          </span>
<span class="-3430556922668437990" onmouseenter="enter('-3430556922668437990');" onmouseout="out('-3430556922668437990');" style=""> 803                                 + &quot; (&quot; + types.get(type) + &quot;)&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                     }                                                                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 805                 } catch (IOException e) {                                                                </span>
<span class="-4332337590956216445" onmouseenter="enter('-4332337590956216445');" onmouseout="out('-4332337590956216445');" style=""> 806                     // Ignoring exceptions for non-existing file descriptors.                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 808             }                                                                                            </span>
<span class="1894743204629618523" onmouseenter="enter('1894743204629618523');" onmouseout="out('1894743204629618523');" style=""> 809             for (int i = 0; i &lt; types.size(); i++) {                                                     </span>
<span class="-3358630307652497285" onmouseenter="enter('-3358630307652497285');" onmouseout="out('-3358630307652497285');" style=""> 810                 Log.i(TAG, String.format(&quot;Open %10s files: %4d total, %4d duplicates&quot;,                   </span>
<span class="-7057161233480916817" onmouseenter="enter('-7057161233480916817');" onmouseout="out('-7057161233480916817');" style=""> 811                         types.get(i), count[i], duplicates[i]));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812             }                                                                                            </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 813         } catch (Throwable t) {                                                                          </span>
<span class="6465726010998958367" onmouseenter="enter('6465726010998958367');" onmouseout="out('6465726010998958367');" style=""> 814             // Catch everything. This is called from an exception handler that we shouldn&#x27;t upset.       </span>
<span class="-3798752040153960224" onmouseenter="enter('-3798752040153960224');" onmouseout="out('-3798752040153960224');" style=""> 815             Log.e(TAG, &quot;Unable to log open files.&quot;, t);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 816         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818 }                                                                                                        </span>











</pre></td>
                            <td><pre><span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">   1 package com.android.launcher3;                                                                           </span>
<span  style="">   2                                                                                                          </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">   3 import android.appwidget.AppWidgetProviderInfo;                                                          </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">   4 import android.content.ComponentName;                                                                    </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">   5 import android.content.ContentValues;                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">   6 import android.content.Context;                                                                          </span>
<span class="4122587240602557356" onmouseenter="enter('4122587240602557356');" onmouseout="out('4122587240602557356');" style="">   7 import android.content.SharedPreferences;                                                                </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">   8 import android.content.pm.ResolveInfo;                                                                   </span>
<span class="7207138161133478555" onmouseenter="enter('7207138161133478555');" onmouseout="out('7207138161133478555');" style="">   9 import android.content.res.Resources;                                                                    </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  10 import android.database.Cursor;                                                                          </span>
<span class="-8322188515935618338" onmouseenter="enter('-8322188515935618338');" onmouseout="out('-8322188515935618338');" style="">  11 import android.database.sqlite.SQLiteCantOpenDatabaseException;                                          </span>
<span class="-4895155655276492102" onmouseenter="enter('-4895155655276492102');" onmouseout="out('-4895155655276492102');" style="">  12 import android.database.sqlite.SQLiteDatabase;                                                           </span>
<span class="250544669864164636" onmouseenter="enter('250544669864164636');" onmouseout="out('250544669864164636');" style="">  13 import android.database.sqlite.SQLiteDiskIOException;                                                    </span>
<span class="6401548559697116088" onmouseenter="enter('6401548559697116088');" onmouseout="out('6401548559697116088');" style="">  14 import android.database.sqlite.SQLiteOpenHelper;                                                         </span>
<span class="1099656306555592784" onmouseenter="enter('1099656306555592784');" onmouseout="out('1099656306555592784');" style="">  15 import android.database.sqlite.SQLiteReadOnlyDatabaseException;                                          </span>
<span class="-5221619029963095423" onmouseenter="enter('-5221619029963095423');" onmouseout="out('-5221619029963095423');" style="">  16 import android.graphics.Bitmap.Config;                                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  17 import android.graphics.Bitmap;                                                                          </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  18 import android.graphics.BitmapFactory;                                                                   </span>
<span class="-8489723247854845487" onmouseenter="enter('-8489723247854845487');" onmouseout="out('-8489723247854845487');" style="">  19 import android.graphics.BitmapShader;                                                                    </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  20 import android.graphics.Canvas;                                                                          </span>
<span class="1046407090334580529" onmouseenter="enter('1046407090334580529');" onmouseout="out('1046407090334580529');" style="">  21 import android.graphics.ColorMatrix;                                                                     </span>
<span class="-2638342757206578386" onmouseenter="enter('-2638342757206578386');" onmouseout="out('-2638342757206578386');" style="">  22 import android.graphics.ColorMatrixColorFilter;                                                          </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  23 import android.graphics.Paint;                                                                           </span>
<span class="7353926919338897104" onmouseenter="enter('7353926919338897104');" onmouseout="out('7353926919338897104');" style="">  24 import android.graphics.PorterDuff;                                                                      </span>
<span class="2207333516549486115" onmouseenter="enter('2207333516549486115');" onmouseout="out('2207333516549486115');" style="">  25 import android.graphics.Rect;                                                                            </span>
<span class="-787513569742028665" onmouseenter="enter('-787513569742028665');" onmouseout="out('-787513569742028665');" style="">  26 import android.graphics.Shader;                                                                          </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  27 import android.graphics.drawable.BitmapDrawable;                                                         </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  28 import android.graphics.drawable.Drawable;                                                               </span>
<span class="955674827050616793" onmouseenter="enter('955674827050616793');" onmouseout="out('955674827050616793');" style="">  29 import android.os.AsyncTask;                                                                             </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="">  30 import android.os.Build;                                                                                 </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  31 import android.util.Log;                                                                                 </span>
<span class="-2301578055393860706" onmouseenter="enter('-2301578055393860706');" onmouseout="out('-2301578055393860706');" style="">  32 import com.android.launcher3.compat.AppWidgetManagerCompat;                                              </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  33 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  34 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  35 import java.io.IOException;                                                                              </span>
<span class="-9136849050553086203" onmouseenter="enter('-9136849050553086203');" onmouseout="out('-9136849050553086203');" style="">  36 import java.lang.ref.SoftReference;                                                                      </span>
<span class="-8692343821508153377" onmouseenter="enter('-8692343821508153377');" onmouseout="out('-8692343821508153377');" style="">  37 import java.lang.ref.WeakReference;                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  38 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  39 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  40 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  41 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42 import java.util.List;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  43 import java.util.concurrent.Callable;                                                                    </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  44 import java.util.concurrent.ExecutionException;                                                          </span>
<span  style="">  45                                                                                                          </span>
<span  style="">  46                                                                                                          </span>
<span class="-4311378840888985036" onmouseenter="enter('-4311378840888985036');" onmouseout="out('-4311378840888985036');" style="">  47 public class WidgetPreviewLoader {                                                                       </span>
<span class="-3230874476111875794" onmouseenter="enter('-3230874476111875794');" onmouseout="out('-3230874476111875794');" style="">  48     private static abstract class SoftReferenceThreadLocal&lt;T&gt; {                                          </span>
<span class="144884583078774733" onmouseenter="enter('144884583078774733');" onmouseout="out('144884583078774733');" style="">  49         private ThreadLocal&lt;SoftReference&lt;T&gt;&gt; mThreadLocal;                                              </span>
<span  style="">  50                                                                                                          </span>
<span class="-4387433322567605136" onmouseenter="enter('-4387433322567605136');" onmouseout="out('-4387433322567605136');" style="">  51         public SoftReferenceThreadLocal() {                                                              </span>
<span class="4702884186935866826" onmouseenter="enter('4702884186935866826');" onmouseout="out('4702884186935866826');" style="">  52             mThreadLocal = new ThreadLocal&lt;SoftReference&lt;T&gt;&gt;();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  53         }                                                                                                </span>
<span  style="">  54                                                                                                          </span>
<span class="7611856356089156666" onmouseenter="enter('7611856356089156666');" onmouseout="out('7611856356089156666');" style="">  55         abstract T initialValue();                                                                       </span>
<span  style="">  56                                                                                                          </span>
<span class="-5049902553319226708" onmouseenter="enter('-5049902553319226708');" onmouseout="out('-5049902553319226708');" style="">  57         public void set(T t) {                                                                           </span>
<span class="4998900635420746153" onmouseenter="enter('4998900635420746153');" onmouseout="out('4998900635420746153');" style="">  58             mThreadLocal.set(new SoftReference&lt;T&gt;(t));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  59         }                                                                                                </span>
<span  style="">  60                                                                                                          </span>
<span class="-6159920038780308483" onmouseenter="enter('-6159920038780308483');" onmouseout="out('-6159920038780308483');" style="">  61         public T get() {                                                                                 </span>
<span class="-967899869235114258" onmouseenter="enter('-967899869235114258');" onmouseout="out('-967899869235114258');" style="">  62             SoftReference&lt;T&gt; reference = mThreadLocal.get();                                             </span>
<span class="-6948245133825727275" onmouseenter="enter('-6948245133825727275');" onmouseout="out('-6948245133825727275');" style="">  63             T obj;                                                                                       </span>
<span class="-5692723719917447196" onmouseenter="enter('-5692723719917447196');" onmouseout="out('-5692723719917447196');" style="">  64             if (reference == null) {                                                                     </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  65                 obj = initialValue();                                                                    </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  66                 mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                             </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  67                 return obj;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  68             } else {                                                                                     </span>
<span class="-2769798515494474030" onmouseenter="enter('-2769798515494474030');" onmouseout="out('-2769798515494474030');" style="">  69                 obj = reference.get();                                                                   </span>
<span class="9024370751945626489" onmouseenter="enter('9024370751945626489');" onmouseout="out('9024370751945626489');" style="">  70                 if (obj == null) {                                                                       </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  71                     obj = initialValue();                                                                </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  72                     mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73                 }                                                                                        </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  74                 return obj;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-5055153777344084118" onmouseenter="enter('-5055153777344084118');" onmouseout="out('-5055153777344084118');" style="">  79     private static class CanvasCache extends SoftReferenceThreadLocal&lt;Canvas&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80         @Override                                                                                        </span>
<span class="-4761875685905818114" onmouseenter="enter('-4761875685905818114');" onmouseout="out('-4761875685905818114');" style="">  81         protected Canvas initialValue() {                                                                </span>
<span class="-2278895108809265326" onmouseenter="enter('-2278895108809265326');" onmouseout="out('-2278895108809265326');" style="">  82             return new Canvas();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span  style="">  85                                                                                                          </span>
<span class="-1261255052546611379" onmouseenter="enter('-1261255052546611379');" onmouseout="out('-1261255052546611379');" style="">  86     private static class PaintCache extends SoftReferenceThreadLocal&lt;Paint&gt; {                            </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  87         @Override                                                                                        </span>
<span class="5455192562670218369" onmouseenter="enter('5455192562670218369');" onmouseout="out('5455192562670218369');" style="">  88         protected Paint initialValue() {                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  89             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span  style="">  92                                                                                                          </span>
<span class="1990146601739059582" onmouseenter="enter('1990146601739059582');" onmouseout="out('1990146601739059582');" style="">  93     private static class BitmapCache extends SoftReferenceThreadLocal&lt;Bitmap&gt; {                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94         @Override                                                                                        </span>
<span class="5445413510754308036" onmouseenter="enter('5445413510754308036');" onmouseout="out('5445413510754308036');" style="">  95         protected Bitmap initialValue() {                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  96             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span  style="">  99                                                                                                          </span>
<span class="-4690039068512610596" onmouseenter="enter('-4690039068512610596');" onmouseout="out('-4690039068512610596');" style=""> 100     private static class RectCache extends SoftReferenceThreadLocal&lt;Rect&gt; {                              </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 101         @Override                                                                                        </span>
<span class="8484771223674222626" onmouseenter="enter('8484771223674222626');" onmouseout="out('8484771223674222626');" style=""> 102         protected Rect initialValue() {                                                                  </span>
<span class="3126951611359421696" onmouseenter="enter('3126951611359421696');" onmouseout="out('3126951611359421696');" style=""> 103             return new Rect();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="5474300259820042675" onmouseenter="enter('5474300259820042675');" onmouseout="out('5474300259820042675');" style=""><abbr title=" 107     private static class BitmapFactoryOptionsCache extends SoftReferenceThreadLocal&lt;BitmapFactory.Options&gt; {"> 107     private static class BitmapFactoryOptionsCache extends SoftReferenceThreadLocal&lt;BitmapFactory.OptionsðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 108         @Override                                                                                        </span>
<span class="-8328117947754333521" onmouseenter="enter('-8328117947754333521');" onmouseout="out('-8328117947754333521');" style=""> 109         protected BitmapFactory.Options initialValue() {                                                 </span>
<span class="-4117267854178586248" onmouseenter="enter('-4117267854178586248');" onmouseout="out('-4117267854178586248');" style=""> 110             return new BitmapFactory.Options();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span  style=""> 113                                                                                                          </span>
<span class="2416799479879720027" onmouseenter="enter('2416799479879720027');" onmouseout="out('2416799479879720027');" style=""> 114     private static final String TAG = &quot;WidgetPreviewLoader&quot;;                                             </span>
<span  style=""> 115                                                                                                          </span>
<span class="4075932221748513041" onmouseenter="enter('4075932221748513041');" onmouseout="out('4075932221748513041');" style=""> 116     private static final String ANDROID_INCREMENTAL_VERSION_NAME_KEY = &quot;android.incremental.version&quot;;    </span>
<span  style=""> 117                                                                                                          </span>
<span class="7524285546086861850" onmouseenter="enter('7524285546086861850');" onmouseout="out('7524285546086861850');" style=""> 118     private static final float WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE = 0.25f;                           </span>
<span  style=""> 119                                                                                                          </span>
<span class="1902323072201125531" onmouseenter="enter('1902323072201125531');" onmouseout="out('1902323072201125531');" style=""> 120     private static final HashSet&lt;String&gt; sInvalidPackages = new HashSet&lt;String&gt;();                       </span>
<span  style=""> 121                                                                                                          </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 122     // Used for drawing shortcut previews                                                                </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 123     // Used for drawing shortcut previews                                                                </span>
<span class="333450150533861200" onmouseenter="enter('333450150533861200');" onmouseout="out('333450150533861200');" style=""> 124     private final BitmapCache mCachedShortcutPreviewBitmap = new BitmapCache();                          </span>
<span  style=""> 125                                                                                                          </span>
<span class="6665675930715155383" onmouseenter="enter('6665675930715155383');" onmouseout="out('6665675930715155383');" style=""> 126     private final PaintCache mCachedShortcutPreviewPaint = new PaintCache();                             </span>
<span  style=""> 127                                                                                                          </span>
<span class="1096761732692819631" onmouseenter="enter('1096761732692819631');" onmouseout="out('1096761732692819631');" style=""> 128     private final CanvasCache mCachedShortcutPreviewCanvas = new CanvasCache();                          </span>
<span  style=""> 129                                                                                                          </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 130     // Used for drawing widget previews                                                                  </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 131     // Used for drawing widget previews                                                                  </span>
<span class="-3956456794742254913" onmouseenter="enter('-3956456794742254913');" onmouseout="out('-3956456794742254913');" style=""> 132     private final CanvasCache mCachedAppWidgetPreviewCanvas = new CanvasCache();                         </span>
<span  style=""> 133                                                                                                          </span>
<span class="2994302144561928781" onmouseenter="enter('2994302144561928781');" onmouseout="out('2994302144561928781');" style=""> 134     private final RectCache mCachedAppWidgetPreviewSrcRect = new RectCache();                            </span>
<span  style=""> 135                                                                                                          </span>
<span class="-2432735040368044940" onmouseenter="enter('-2432735040368044940');" onmouseout="out('-2432735040368044940');" style=""> 136     private final RectCache mCachedAppWidgetPreviewDestRect = new RectCache();                           </span>
<span  style=""> 137                                                                                                          </span>
<span class="-1839110596677388209" onmouseenter="enter('-1839110596677388209');" onmouseout="out('-1839110596677388209');" style=""> 138     private final PaintCache mCachedAppWidgetPreviewPaint = new PaintCache();                            </span>
<span  style=""> 139                                                                                                          </span>
<span class="4215417609313429507" onmouseenter="enter('4215417609313429507');" onmouseout="out('4215417609313429507');" style=""> 140     private final PaintCache mDefaultAppWidgetPreviewPaint = new PaintCache();                           </span>
<span  style=""> 141                                                                                                          </span>
<span class="7799865446872866624" onmouseenter="enter('7799865446872866624');" onmouseout="out('7799865446872866624');" style=""><abbr title=" 142     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache();"> 142     private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache()ðŸ”µ</abbr></span>
<span  style=""> 143                                                                                                          </span>
<span class="4097431862822690335" onmouseenter="enter('4097431862822690335');" onmouseout="out('4097431862822690335');" style=""><abbr title=" 144     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt;();"> 144     private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakRefereðŸ”µ</abbr></span>
<span  style=""> 145                                                                                                          </span>
<span class="-7580346379503623190" onmouseenter="enter('-7580346379503623190');" onmouseout="out('-7580346379503623190');" style=""><abbr title=" 146     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;();"> 146     private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;(ðŸ”µ</abbr></span>
<span  style=""> 147                                                                                                          </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 148     private final Context mContext;                                                                      </span>
<span  style=""> 149                                                                                                          </span>
<span class="-7489384078469018359" onmouseenter="enter('-7489384078469018359');" onmouseout="out('-7489384078469018359');" style=""> 150     private final int mAppIconSize;                                                                      </span>
<span  style=""> 151                                                                                                          </span>
<span class="2729881913605020060" onmouseenter="enter('2729881913605020060');" onmouseout="out('2729881913605020060');" style=""> 152     private final IconCache mIconCache;                                                                  </span>
<span  style=""> 153                                                                                                          </span>
<span class="9150498506085829362" onmouseenter="enter('9150498506085829362');" onmouseout="out('9150498506085829362');" style=""> 154     private final AppWidgetManagerCompat mManager;                                                       </span>
<span  style=""> 155                                                                                                          </span>
<span class="-8162128579730225382" onmouseenter="enter('-8162128579730225382');" onmouseout="out('-8162128579730225382');" style=""> 156     private int mPreviewBitmapWidth;                                                                     </span>
<span  style=""> 157                                                                                                          </span>
<span class="4768970035560221699" onmouseenter="enter('4768970035560221699');" onmouseout="out('4768970035560221699');" style=""> 158     private int mPreviewBitmapHeight;                                                                    </span>
<span  style=""> 159                                                                                                          </span>
<span class="-2278862546333248339" onmouseenter="enter('-2278862546333248339');" onmouseout="out('-2278862546333248339');" style=""> 160     private String mSize;                                                                                </span>
<span  style=""> 161                                                                                                          </span>
<span class="-4195956876020483478" onmouseenter="enter('-4195956876020483478');" onmouseout="out('-4195956876020483478');" style=""> 162     private PagedViewCellLayout mWidgetSpacingLayout;                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="-7229982499992821578" onmouseenter="enter('-7229982499992821578');" onmouseout="out('-7229982499992821578');" style=""> 164     private String mCachedSelectQuery;                                                                   </span>
<span  style=""> 165                                                                                                          </span>
<span class="6719315262198447761" onmouseenter="enter('6719315262198447761');" onmouseout="out('6719315262198447761');" style=""> 166     private CacheDb mDb;                                                                                 </span>
<span  style=""> 167                                                                                                          </span>
<span class="140559351311799615" onmouseenter="enter('140559351311799615');" onmouseout="out('140559351311799615');" style=""> 168     private final MainThreadExecutor mMainThreadExecutor = new MainThreadExecutor();                     </span>
<span  style=""> 169                                                                                                          </span>
<span class="-5828204717811548952" onmouseenter="enter('-5828204717811548952');" onmouseout="out('-5828204717811548952');" style=""> 170     public WidgetPreviewLoader(Context context) {                                                        </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 171         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-6320967880672955396" onmouseenter="enter('-6320967880672955396');" onmouseout="out('-6320967880672955396');" style=""> 172         DeviceProfile grid = app.getDynamicGrid().getDeviceProfile();                                    </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 173         mContext = context;                                                                              </span>
<span class="3163588368111647063" onmouseenter="enter('3163588368111647063');" onmouseout="out('3163588368111647063');" style=""> 174         mAppIconSize = grid.iconSizePx;                                                                  </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 175         mIconCache = app.getIconCache();                                                                 </span>
<span class="3481132346717467494" onmouseenter="enter('3481132346717467494');" onmouseout="out('3481132346717467494');" style=""> 176         mManager = AppWidgetManagerCompat.getInstance(context);                                          </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 177         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span class="-6616379720320150342" onmouseenter="enter('-6616379720320150342');" onmouseout="out('-6616379720320150342');" style=""><abbr title=" 178         SharedPreferences sp = context.getSharedPreferences(LauncherAppState.getSharedPreferencesKey(), Context.MODE_PRIVATE);"> 178         SharedPreferences sp = context.getSharedPreferences(LauncherAppState.getSharedPreferencesKey(), CðŸ”µ</abbr></span>
<span class="7599352561706696094" onmouseenter="enter('7599352561706696094');" onmouseout="out('7599352561706696094');" style=""> 179         final String lastVersionName = sp.getString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, null);         </span>
<span class="-8837714544016106839" onmouseenter="enter('-8837714544016106839');" onmouseout="out('-8837714544016106839');" style=""> 180         final String versionName = android.os.Build.VERSION.INCREMENTAL;                                 </span>
<span class="4668421743697879908" onmouseenter="enter('4668421743697879908');" onmouseout="out('4668421743697879908');" style=""> 181         final boolean                                                                                    </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 182 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="8916693783989665516" onmouseenter="enter('8916693783989665516');" onmouseout="out('8916693783989665516');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 183 isLollipop                                                                                               </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 184 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 185 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 185 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 186 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187                                                                                                          </span>
<span class="8981810829660071158" onmouseenter="enter('8981810829660071158');" onmouseout="out('8981810829660071158');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188 isLollipopOrGreater                                                                                      </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 189 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-6154815209613798667" onmouseenter="enter('-6154815209613798667');" onmouseout="out('-6154815209613798667');" style=""> 190          = Build.VERSION.SDK_INT                                                                         </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 191 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-2808858271652645921" onmouseenter="enter('-2808858271652645921');" onmouseout="out('-2808858271652645921');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192 ==                                                                                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 193 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 194 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 194 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 195 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                                                                                                          </span>
<span class="-3660782480211699235" onmouseenter="enter('-3660782480211699235');" onmouseout="out('-3660782480211699235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197 &gt;=                                                                                                       </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 198 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="5599121260149819850" onmouseenter="enter('5599121260149819850');" onmouseout="out('5599121260149819850');" style=""> 199          Build.VERSION_CODES.LOLLIPOP;                                                                   </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style=""> 200         if (!versionName.equals(lastVersionName)) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 201             try {                                                                                        </span>
<span class="-1043062607084730911" onmouseenter="enter('-1043062607084730911');" onmouseout="out('-1043062607084730911');" style=""> 202                 // clear all the previews whenever the system version changes, to ensure that            </span>
<span class="-3090272541711713949" onmouseenter="enter('-3090272541711713949');" onmouseout="out('-3090272541711713949');" style=""> 203                 // previews are up-to-date for any apps that might have been updated with the system     </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style=""> 204                 clearDb();                                                                               </span>
<span class="-1695662722736394565" onmouseenter="enter('-1695662722736394565');" onmouseout="out('-1695662722736394565');" style=""> 205             } catch (SQLiteReadOnlyDatabaseException e) {                                                </span>
<span class="7717622633225589961" onmouseenter="enter('7717622633225589961');" onmouseout="out('7717622633225589961');" style=""> 206                 if (                                                                                     </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 207 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="8916693783989665516" onmouseenter="enter('8916693783989665516');" onmouseout="out('8916693783989665516');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208 isLollipop                                                                                               </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 209 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 210 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 210 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 211 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                                                                                                          </span>
<span class="8981810829660071158" onmouseenter="enter('8981810829660071158');" onmouseout="out('8981810829660071158');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213 isLollipopOrGreater                                                                                      </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 214 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1344992967432647558" onmouseenter="enter('-1344992967432647558');" onmouseout="out('-1344992967432647558');" style=""> 215                 ) {                                                                                      </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style=""> 216                     // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only     </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style=""> 217                     // issue, then ignore this error and leave the old previews                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 218                 } else {                                                                                 </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 219                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220                 }                                                                                        </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 221             } catch (java.lang.Exception e) {                                                            </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 222                 throw e;                                                                                 </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 223             } finally {                                                                                  </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style=""> 224                 SharedPreferences.Editor editor = sp.edit();                                             </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style=""> 225                 editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                     </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style=""> 226                 editor.commit();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span  style=""> 230                                                                                                          </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style=""> 231     public void recreateDb() {                                                                           </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 232         LauncherAppState app = LauncherAppState.getInstance();                                           </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style=""> 233         app.recreateWidgetPreviewDb();                                                                   </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 234         mDb = app.getWidgetPreviewCacheDb();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="1041361483340123386" onmouseenter="enter('1041361483340123386');" onmouseout="out('1041361483340123386');" style=""> 237     public void setPreviewSize(int previewWidth, int previewHeight,                                      </span>
<span class="-864889589589090056" onmouseenter="enter('-864889589589090056');" onmouseout="out('-864889589589090056');" style=""> 238             PagedViewCellLayout widgetSpacingLayout) {                                                   </span>
<span class="7215920596152382710" onmouseenter="enter('7215920596152382710');" onmouseout="out('7215920596152382710');" style=""> 239         mPreviewBitmapWidth = previewWidth;                                                              </span>
<span class="-1710948131163314144" onmouseenter="enter('-1710948131163314144');" onmouseout="out('-1710948131163314144');" style=""> 240         mPreviewBitmapHeight = previewHeight;                                                            </span>
<span class="-2589016613696609257" onmouseenter="enter('-2589016613696609257');" onmouseout="out('-2589016613696609257');" style=""> 241         mSize = previewWidth + &quot;x&quot; + previewHeight;                                                      </span>
<span class="-2003385001531882656" onmouseenter="enter('-2003385001531882656');" onmouseout="out('-2003385001531882656');" style=""> 242         mWidgetSpacingLayout = widgetSpacingLayout;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span  style=""> 244                                                                                                          </span>
<span class="9100103105710524909" onmouseenter="enter('9100103105710524909');" onmouseout="out('9100103105710524909');" style=""> 245     public Bitmap getPreview(final Object o) {                                                           </span>
<span class="7210064752111263529" onmouseenter="enter('7210064752111263529');" onmouseout="out('7210064752111263529');" style=""> 246         final String name = getObjectName(o);                                                            </span>
<span class="-4502422735439147840" onmouseenter="enter('-4502422735439147840');" onmouseout="out('-4502422735439147840');" style=""> 247         final String packageName = getObjectPackage(o);                                                  </span>
<span class="6483702398021407461" onmouseenter="enter('6483702398021407461');" onmouseout="out('6483702398021407461');" style=""> 248         // check if the package is valid                                                                 </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 249         synchronized(sInvalidPackages) {                                                                 </span>
<span class="6205084711389939864" onmouseenter="enter('6205084711389939864');" onmouseout="out('6205084711389939864');" style=""> 250             boolean packageValid = !sInvalidPackages.contains(packageName);                              </span>
<span class="5936168059174575986" onmouseenter="enter('5936168059174575986');" onmouseout="out('5936168059174575986');" style=""> 251             if (!packageValid) {                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 252                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254         }                                                                                                </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 255         synchronized(mLoadedPreviews) {                                                                  </span>
<span class="-7479974433139738260" onmouseenter="enter('-7479974433139738260');" onmouseout="out('-7479974433139738260');" style=""> 256             // check if it exists in our existing cache                                                  </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 257             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="-5798374742760410220" onmouseenter="enter('-5798374742760410220');" onmouseout="out('-5798374742760410220');" style=""> 258                 WeakReference&lt;Bitmap&gt; bitmapReference = mLoadedPreviews.get(name);                       </span>
<span class="-5072696511706589798" onmouseenter="enter('-5072696511706589798');" onmouseout="out('-5072696511706589798');" style=""> 259                 Bitmap bitmap = bitmapReference.get();                                                   </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 260                 if (bitmap != null) {                                                                    </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style=""> 261                     return bitmap;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span  style=""> 265                                                                                                          </span>
<span class="-1660586751969869388" onmouseenter="enter('-1660586751969869388');" onmouseout="out('-1660586751969869388');" style=""> 266         Bitmap unusedBitmap = null;                                                                      </span>
<span class="7613513134986517501" onmouseenter="enter('7613513134986517501');" onmouseout="out('7613513134986517501');" style=""> 267         synchronized(mUnusedBitmaps) {                                                                   </span>
<span class="134332774856407035" onmouseenter="enter('134332774856407035');" onmouseout="out('134332774856407035');" style=""> 268             // not in cache; we need to load it from the db                                              </span>
<span class="1411220366891100168" onmouseenter="enter('1411220366891100168');" onmouseout="out('1411220366891100168');" style=""> 269             while (unusedBitmap == null &amp;&amp; mUnusedBitmaps.size() &gt; 0) {                                  </span>
<span class="3514361872991648197" onmouseenter="enter('3514361872991648197');" onmouseout="out('3514361872991648197');" style=""> 270                 Bitmap candidate = mUnusedBitmaps.remove(0).get();                                       </span>
<span class="-3857479151276842222" onmouseenter="enter('-3857479151276842222');" onmouseout="out('-3857479151276842222');" style=""> 271                 if (candidate != null &amp;&amp; candidate.isMutable() &amp;&amp;                                        </span>
<span class="-7425312185904228324" onmouseenter="enter('-7425312185904228324');" onmouseout="out('-7425312185904228324');" style=""> 272                         candidate.getWidth() == mPreviewBitmapWidth &amp;&amp;                                   </span>
<span class="-897867530819106482" onmouseenter="enter('-897867530819106482');" onmouseout="out('-897867530819106482');" style=""> 273                         candidate.getHeight() == mPreviewBitmapHeight) {                                 </span>
<span class="-7974711513755834014" onmouseenter="enter('-7974711513755834014');" onmouseout="out('-7974711513755834014');" style=""> 274                     unusedBitmap = candidate;                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276             }                                                                                            </span>
<span class="-1806752935370283796" onmouseenter="enter('-1806752935370283796');" onmouseout="out('-1806752935370283796');" style=""> 277             if (unusedBitmap != null) {                                                                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 278                 final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                    </span>
<span class="-7568013336659090919" onmouseenter="enter('-7568013336659090919');" onmouseout="out('-7568013336659090919');" style=""> 279                 c.setBitmap(unusedBitmap);                                                               </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 280                 c.drawColor(0, PorterDuff.Mode.CLEAR);                                                   </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 281                 c.setBitmap(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283         }                                                                                                </span>
<span  style=""> 284                                                                                                          </span>
<span class="-7521323678416918441" onmouseenter="enter('-7521323678416918441');" onmouseout="out('-7521323678416918441');" style=""> 285         if (unusedBitmap == null) {                                                                      </span>
<span class="-3551833031540614706" onmouseenter="enter('-3551833031540614706');" onmouseout="out('-3551833031540614706');" style=""> 286             unusedBitmap = Bitmap.createBitmap(mPreviewBitmapWidth, mPreviewBitmapHeight,                </span>
<span class="273441602049516461" onmouseenter="enter('273441602049516461');" onmouseout="out('273441602049516461');" style=""> 287                     Bitmap.Config.ARGB_8888);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288         }                                                                                                </span>
<span class="-8985062989738227550" onmouseenter="enter('-8985062989738227550');" onmouseout="out('-8985062989738227550');" style=""> 289         Bitmap preview = readFromDb(name, unusedBitmap);                                                 </span>
<span  style=""> 290                                                                                                          </span>
<span class="-760731434728754948" onmouseenter="enter('-760731434728754948');" onmouseout="out('-760731434728754948');" style=""> 291         if (preview != null) {                                                                           </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 292             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 293                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294             }                                                                                            </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 295             return preview;                                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 296         } else {                                                                                         </span>
<span class="3460679213489770567" onmouseenter="enter('3460679213489770567');" onmouseout="out('3460679213489770567');" style=""> 297             // it&#x27;s not in the db... we need to generate it                                              </span>
<span class="7452120778445413168" onmouseenter="enter('7452120778445413168');" onmouseout="out('7452120778445413168');" style=""> 298             final Bitmap generatedPreview = generatePreview(o, unusedBitmap);                            </span>
<span class="-4291180510938406114" onmouseenter="enter('-4291180510938406114');" onmouseout="out('-4291180510938406114');" style=""> 299             preview = generatedPreview;                                                                  </span>
<span class="7396852523530524307" onmouseenter="enter('7396852523530524307');" onmouseout="out('7396852523530524307');" style=""> 300             if (preview != unusedBitmap) {                                                               </span>
<span class="-7211694849959051791" onmouseenter="enter('-7211694849959051791');" onmouseout="out('-7211694849959051791');" style=""> 301                 throw new RuntimeException(&quot;generatePreview is not recycling the bitmap &quot; + o);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302             }                                                                                            </span>
<span  style=""> 303                                                                                                          </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 304             synchronized(mLoadedPreviews) {                                                              </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 305                 mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306             }                                                                                            </span>
<span  style=""> 307                                                                                                          </span>
<span class="-5733309973697321639" onmouseenter="enter('-5733309973697321639');" onmouseout="out('-5733309973697321639');" style=""> 308             // write to db on a thread pool... this can be done lazily and improves the performance      </span>
<span class="-8551030995294829944" onmouseenter="enter('-8551030995294829944');" onmouseout="out('-8551030995294829944');" style=""> 309             // of the first time widget previews are loaded                                              </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 310             new AsyncTask&lt;Void, Void, Void&gt;() {                                                          </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 311                 public Void doInBackground(Void ... args) {                                              </span>
<span class="5794871779597006615" onmouseenter="enter('5794871779597006615');" onmouseout="out('5794871779597006615');" style=""> 312                     writeToDb(o, generatedPreview);                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 313                     return null;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314                 }                                                                                        </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 315             }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                            </span>
<span  style=""> 316                                                                                                          </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 317             return preview;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319     }                                                                                                    </span>
<span  style=""> 320                                                                                                          </span>
<span class="-2058417025959444842" onmouseenter="enter('-2058417025959444842');" onmouseout="out('-2058417025959444842');" style=""> 321     public void recycleBitmap(Object o, Bitmap bitmapToRecycle) {                                        </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 322         String name = getObjectName(o);                                                                  </span>
<span class="-4798838159901813780" onmouseenter="enter('-4798838159901813780');" onmouseout="out('-4798838159901813780');" style=""> 323         synchronized (mLoadedPreviews) {                                                                 </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 324             if (mLoadedPreviews.containsKey(name)) {                                                     </span>
<span class="5945201469012860218" onmouseenter="enter('5945201469012860218');" onmouseout="out('5945201469012860218');" style=""> 325                 Bitmap b = mLoadedPreviews.get(name).get();                                              </span>
<span class="9172312796342865011" onmouseenter="enter('9172312796342865011');" onmouseout="out('9172312796342865011');" style=""> 326                 if (b == bitmapToRecycle) {                                                              </span>
<span class="-3845835638768486269" onmouseenter="enter('-3845835638768486269');" onmouseout="out('-3845835638768486269');" style=""> 327                     mLoadedPreviews.remove(name);                                                        </span>
<span class="1962405822662822843" onmouseenter="enter('1962405822662822843');" onmouseout="out('1962405822662822843');" style=""> 328                     if (bitmapToRecycle.isMutable()) {                                                   </span>
<span class="732538049861401327" onmouseenter="enter('732538049861401327');" onmouseout="out('732538049861401327');" style=""> 329                         synchronized (mUnusedBitmaps) {                                                  </span>
<span class="7654440137511857398" onmouseenter="enter('7654440137511857398');" onmouseout="out('7654440137511857398');" style=""> 330                             mUnusedBitmaps.add(new SoftReference&lt;Bitmap&gt;(b));                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 333                 } else {                                                                                 </span>
<span class="-7483999424756026389" onmouseenter="enter('-7483999424756026389');" onmouseout="out('-7483999424756026389');" style=""> 334                     throw new RuntimeException(&quot;Bitmap passed in doesn&#x27;t match up&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338     }                                                                                                    </span>
<span  style=""> 339                                                                                                          </span>
<span class="-6828234266968088645" onmouseenter="enter('-6828234266968088645');" onmouseout="out('-6828234266968088645');" style=""> 340     static class CacheDb extends SQLiteOpenHelper {                                                      </span>
<span class="-2905037825538645689" onmouseenter="enter('-2905037825538645689');" onmouseout="out('-2905037825538645689');" style=""> 341         final static int DB_VERSION = 2;                                                                 </span>
<span  style=""> 342                                                                                                          </span>
<span class="-4997316780024779267" onmouseenter="enter('-4997316780024779267');" onmouseout="out('-4997316780024779267');" style=""> 343         final static String TABLE_NAME = &quot;shortcut_and_widget_previews&quot;;                                 </span>
<span  style=""> 344                                                                                                          </span>
<span class="-5742805130150616813" onmouseenter="enter('-5742805130150616813');" onmouseout="out('-5742805130150616813');" style=""> 345         final static String COLUMN_NAME = &quot;name&quot;;                                                        </span>
<span  style=""> 346                                                                                                          </span>
<span class="8854376481192602334" onmouseenter="enter('8854376481192602334');" onmouseout="out('8854376481192602334');" style=""> 347         final static String COLUMN_SIZE = &quot;size&quot;;                                                        </span>
<span  style=""> 348                                                                                                          </span>
<span class="6902810344350480074" onmouseenter="enter('6902810344350480074');" onmouseout="out('6902810344350480074');" style=""> 349         final static String COLUMN_PREVIEW_BITMAP = &quot;preview_bitmap&quot;;                                    </span>
<span  style=""> 350                                                                                                          </span>
<span class="-5996057254067063760" onmouseenter="enter('-5996057254067063760');" onmouseout="out('-5996057254067063760');" style=""> 351         Context mContext;                                                                                </span>
<span  style=""> 352                                                                                                          </span>
<span class="-1572964554793598477" onmouseenter="enter('-1572964554793598477');" onmouseout="out('-1572964554793598477');" style=""> 353         public CacheDb(Context context) {                                                                </span>
<span class="812359906470723283" onmouseenter="enter('812359906470723283');" onmouseout="out('812359906470723283');" style=""><abbr title=" 354             super(context, new File(context.getCacheDir(), LauncherFiles.WIDGET_PREVIEWS_DB).getPath(), null, DB_VERSION);"> 354             super(context, new File(context.getCacheDir(), LauncherFiles.WIDGET_PREVIEWS_DB).getPath(), nðŸ”µ</abbr></span>
<span class="-5483301966583099443" onmouseenter="enter('-5483301966583099443');" onmouseout="out('-5483301966583099443');" style=""> 355             // Store the context for later use                                                           </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 356             mContext = context;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 359         @Override                                                                                        </span>
<span class="-3622240674415739784" onmouseenter="enter('-3622240674415739784');" onmouseout="out('-3622240674415739784');" style=""> 360         public void onCreate(SQLiteDatabase database) {                                                  </span>
<span class="-5851870806192660982" onmouseenter="enter('-5851870806192660982');" onmouseout="out('-5851870806192660982');" style=""> 361             database.execSQL(&quot;CREATE TABLE IF NOT EXISTS &quot; + TABLE_NAME + &quot; (&quot; +                         </span>
<span class="-4480150272515057846" onmouseenter="enter('-4480150272515057846');" onmouseout="out('-4480150272515057846');" style=""> 362                     COLUMN_NAME + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="9221020696116426890" onmouseenter="enter('9221020696116426890');" onmouseout="out('9221020696116426890');" style=""> 363                     COLUMN_SIZE + &quot; TEXT NOT NULL, &quot; +                                                   </span>
<span class="-4320278434100102649" onmouseenter="enter('-4320278434100102649');" onmouseout="out('-4320278434100102649');" style=""> 364                     COLUMN_PREVIEW_BITMAP + &quot; BLOB NOT NULL, &quot; +                                         </span>
<span class="2330812204177674799" onmouseenter="enter('2330812204177674799');" onmouseout="out('2330812204177674799');" style=""> 365                     &quot;PRIMARY KEY (&quot; + COLUMN_NAME + &quot;, &quot; + COLUMN_SIZE + &quot;) &quot; +                          </span>
<span class="4525293784515244604" onmouseenter="enter('4525293784515244604');" onmouseout="out('4525293784515244604');" style=""> 366                     &quot;);&quot;);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367         }                                                                                                </span>
<span  style=""> 368                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 369         @Override                                                                                        </span>
<span class="-4655538025867202729" onmouseenter="enter('-4655538025867202729');" onmouseout="out('-4655538025867202729');" style=""> 370         public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {                       </span>
<span class="4248187026734735411" onmouseenter="enter('4248187026734735411');" onmouseout="out('4248187026734735411');" style=""> 371             if (oldVersion != newVersion) {                                                              </span>
<span class="4606527396647857067" onmouseenter="enter('4606527396647857067');" onmouseout="out('4606527396647857067');" style=""> 372                 // Delete all the records; they&#x27;ll be repopulated as this is a cache                     </span>
<span class="3312906466801577184" onmouseenter="enter('3312906466801577184');" onmouseout="out('3312906466801577184');" style=""> 373                 db.execSQL(&quot;DELETE FROM &quot; + TABLE_NAME);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376     }                                                                                                    </span>
<span  style=""> 377                                                                                                          </span>
<span class="4811926455019388037" onmouseenter="enter('4811926455019388037');" onmouseout="out('4811926455019388037');" style=""> 378     private static final String WIDGET_PREFIX = &quot;Widget:&quot;;                                               </span>
<span  style=""> 379                                                                                                          </span>
<span class="7268385195460645965" onmouseenter="enter('7268385195460645965');" onmouseout="out('7268385195460645965');" style=""> 380     private static final String SHORTCUT_PREFIX = &quot;Shortcut:&quot;;                                           </span>
<span  style=""> 381                                                                                                          </span>
<span class="2901805684811435457" onmouseenter="enter('2901805684811435457');" onmouseout="out('2901805684811435457');" style=""> 382     private static String getObjectName(Object o) {                                                      </span>
<span class="5690762498529732972" onmouseenter="enter('5690762498529732972');" onmouseout="out('5690762498529732972');" style=""> 383         // should cache the string builder                                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 384         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="2095302661605249065" onmouseenter="enter('2095302661605249065');" onmouseout="out('2095302661605249065');" style=""> 385         String output;                                                                                   </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 386         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-8383311757247800402" onmouseenter="enter('-8383311757247800402');" onmouseout="out('-8383311757247800402');" style=""> 387             sb.append(WIDGET_PREFIX);                                                                    </span>
<span class="594215244520332131" onmouseenter="enter('594215244520332131');" onmouseout="out('594215244520332131');" style=""> 388             sb.append(((AppWidgetProviderInfo) o).toString());                                           </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 389             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 390             sb.setLength(0);                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391         } else {                                                                                         </span>
<span class="5925999772645605802" onmouseenter="enter('5925999772645605802');" onmouseout="out('5925999772645605802');" style=""> 392             sb.append(SHORTCUT_PREFIX);                                                                  </span>
<span  style=""> 393                                                                                                          </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 394             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="8259534413479453259" onmouseenter="enter('8259534413479453259');" onmouseout="out('8259534413479453259');" style=""> 395             sb.append(new ComponentName(info.activityInfo.packageName,                                   </span>
<span class="-4000685798969561860" onmouseenter="enter('-4000685798969561860');" onmouseout="out('-4000685798969561860');" style=""> 396                     info.activityInfo.name).flattenToString());                                          </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 397             output = sb.toString();                                                                      </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 398             sb.setLength(0);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399         }                                                                                                </span>
<span class="3622623857335300211" onmouseenter="enter('3622623857335300211');" onmouseout="out('3622623857335300211');" style=""> 400         return output;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="4198392565151889664" onmouseenter="enter('4198392565151889664');" onmouseout="out('4198392565151889664');" style=""> 403     private String getObjectPackage(Object o) {                                                          </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 404         if (o instanceof AppWidgetProviderInfo) {                                                        </span>
<span class="-447589032913714129" onmouseenter="enter('-447589032913714129');" onmouseout="out('-447589032913714129');" style=""> 405             return ((AppWidgetProviderInfo) o).provider.getPackageName();                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 406         } else {                                                                                         </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 407             ResolveInfo info = (ResolveInfo) o;                                                          </span>
<span class="-2114723670528030181" onmouseenter="enter('-2114723670528030181');" onmouseout="out('-2114723670528030181');" style=""> 408             return info.activityInfo.packageName;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410     }                                                                                                    </span>
<span  style=""> 411                                                                                                          </span>
<span class="8368345736666686335" onmouseenter="enter('8368345736666686335');" onmouseout="out('8368345736666686335');" style=""> 412     private void writeToDb(Object o, Bitmap preview) {                                                   </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 413         String name = getObjectName(o);                                                                  </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 414         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 415         ContentValues values = new ContentValues();                                                      </span>
<span  style=""> 416                                                                                                          </span>
<span class="-3178925289150814226" onmouseenter="enter('-3178925289150814226');" onmouseout="out('-3178925289150814226');" style=""> 417         values.put(CacheDb.COLUMN_NAME, name);                                                           </span>
<span class="3456914836247516446" onmouseenter="enter('3456914836247516446');" onmouseout="out('3456914836247516446');" style=""> 418         ByteArrayOutputStream stream = new ByteArrayOutputStream();                                      </span>
<span class="5496434693797867526" onmouseenter="enter('5496434693797867526');" onmouseout="out('5496434693797867526');" style=""> 419         preview.compress(Bitmap.CompressFormat.PNG, 100, stream);                                        </span>
<span class="9194176376821213638" onmouseenter="enter('9194176376821213638');" onmouseout="out('9194176376821213638');" style=""> 420         values.put(CacheDb.COLUMN_PREVIEW_BITMAP, stream.toByteArray());                                 </span>
<span class="5882768875063958466" onmouseenter="enter('5882768875063958466');" onmouseout="out('5882768875063958466');" style=""> 421         values.put(CacheDb.COLUMN_SIZE, mSize);                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 422         try {                                                                                            </span>
<span class="3018412397769192796" onmouseenter="enter('3018412397769192796');" onmouseout="out('3018412397769192796');" style=""> 423             db.insert(CacheDb.TABLE_NAME, null, values);                                                 </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 424         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 425             recreateDb();                                                                                </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 426         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 427             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 428             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430     }                                                                                                    </span>
<span  style=""> 431                                                                                                          </span>
<span class="8392297522310828664" onmouseenter="enter('8392297522310828664');" onmouseout="out('8392297522310828664');" style=""> 432     private void clearDb() {                                                                             </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 433         SQLiteDatabase db = mDb.getWritableDatabase();                                                   </span>
<span class="904405929570850953" onmouseenter="enter('904405929570850953');" onmouseout="out('904405929570850953');" style=""> 434         // Delete everything                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 435         try {                                                                                            </span>
<span class="3968467922888620985" onmouseenter="enter('3968467922888620985');" onmouseout="out('3968467922888620985');" style=""> 436             db.delete(CacheDb.TABLE_NAME, null, null);                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 437         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 438         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 439             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 440             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442     }                                                                                                    </span>
<span  style=""> 443                                                                                                          </span>
<span class="-8805069561924159073" onmouseenter="enter('-8805069561924159073');" onmouseout="out('-8805069561924159073');" style=""> 444     public static void removePackageFromDb(final CacheDb cacheDb, final String packageName) {            </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 445         synchronized(sInvalidPackages) {                                                                 </span>
<span class="-5575213275928168943" onmouseenter="enter('-5575213275928168943');" onmouseout="out('-5575213275928168943');" style=""> 446             sInvalidPackages.add(packageName);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447         }                                                                                                </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 448         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 449             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 450                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 451                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 452                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7113429213384324763" onmouseenter="enter('7113429213384324763');" onmouseout="out('7113429213384324763');" style=""> 453                             CacheDb.COLUMN_NAME + &quot; LIKE ? OR &quot; +                                        </span>
<span class="8833124058792802926" onmouseenter="enter('8833124058792802926');" onmouseout="out('8833124058792802926');" style=""> 454                             CacheDb.COLUMN_NAME + &quot; LIKE ?&quot;, // SELECT query                             </span>
<span class="6575814019251974640" onmouseenter="enter('6575814019251974640');" onmouseout="out('6575814019251974640');" style=""> 455                             new String[] {                                                               </span>
<span class="-1005195456334514714" onmouseenter="enter('-1005195456334514714');" onmouseout="out('-1005195456334514714');" style=""> 456                                     WIDGET_PREFIX + packageName + &quot;/%&quot;,                                  </span>
<span class="7638587366414932409" onmouseenter="enter('7638587366414932409');" onmouseout="out('7638587366414932409');" style=""> 457                                     SHORTCUT_PREFIX + packageName + &quot;/%&quot;                                 </span>
<span class="6370673901196405011" onmouseenter="enter('6370673901196405011');" onmouseout="out('6370673901196405011');" style=""> 458                             } // args to SELECT query                                                    </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 459                     );                                                                                   </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 460                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 461                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 462                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 463                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464                 }                                                                                        </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 465                 synchronized(sInvalidPackages) {                                                         </span>
<span class="683140179110979858" onmouseenter="enter('683140179110979858');" onmouseout="out('683140179110979858');" style=""> 466                     sInvalidPackages.remove(packageName);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 468                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 470         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471     }                                                                                                    </span>
<span  style=""> 472                                                                                                          </span>
<span class="-429228780021119422" onmouseenter="enter('-429228780021119422');" onmouseout="out('-429228780021119422');" style=""> 473     private static void removeItemFromDb(final CacheDb cacheDb, final String objectName) {               </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 474         new AsyncTask&lt;Void, Void, Void&gt;() {                                                              </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 475             public Void doInBackground(Void ... args) {                                                  </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 476                 SQLiteDatabase db = cacheDb.getWritableDatabase();                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 477                 try {                                                                                    </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 478                     db.delete(CacheDb.TABLE_NAME,                                                        </span>
<span class="7230732652281167865" onmouseenter="enter('7230732652281167865');" onmouseout="out('7230732652281167865');" style=""> 479                             CacheDb.COLUMN_NAME + &quot; = ? &quot;, // SELECT query                               </span>
<span class="-5686609646644956814" onmouseenter="enter('-5686609646644956814');" onmouseout="out('-5686609646644956814');" style=""> 480                             new String[] { objectName }); // args to SELECT query                        </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 481                 } catch (SQLiteDiskIOException e) {                                                      </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 482                 } catch (SQLiteCantOpenDatabaseException e) {                                            </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 483                     dumpOpenFiles();                                                                     </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 484                     throw e;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485                 }                                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 486                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487             }                                                                                            </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 488         }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489     }                                                                                                    </span>
<span  style=""> 490                                                                                                          </span>
<span class="-5397085010036489521" onmouseenter="enter('-5397085010036489521');" onmouseout="out('-5397085010036489521');" style=""> 491     private Bitmap readFromDb(String name, Bitmap b) {                                                   </span>
<span class="-6915248341892392088" onmouseenter="enter('-6915248341892392088');" onmouseout="out('-6915248341892392088');" style=""> 492         if (mCachedSelectQuery == null) {                                                                </span>
<span class="8500727054799765575" onmouseenter="enter('8500727054799765575');" onmouseout="out('8500727054799765575');" style=""> 493             mCachedSelectQuery = CacheDb.COLUMN_NAME + &quot; = ? AND &quot; +                                     </span>
<span class="-5148548584287535582" onmouseenter="enter('-5148548584287535582');" onmouseout="out('-5148548584287535582');" style=""> 494                     CacheDb.COLUMN_SIZE + &quot; = ?&quot;;                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span class="-3717850318373004709" onmouseenter="enter('-3717850318373004709');" onmouseout="out('-3717850318373004709');" style=""> 496         SQLiteDatabase db = mDb.getReadableDatabase();                                                   </span>
<span class="2593671339546598036" onmouseenter="enter('2593671339546598036');" onmouseout="out('2593671339546598036');" style=""> 497         Cursor result;                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 498         try {                                                                                            </span>
<span class="44832651277024274" onmouseenter="enter('44832651277024274');" onmouseout="out('44832651277024274');" style=""> 499             result = db.query(CacheDb.TABLE_NAME,                                                        </span>
<span class="-8348630863841661561" onmouseenter="enter('-8348630863841661561');" onmouseout="out('-8348630863841661561');" style=""> 500                     new String[] { CacheDb.COLUMN_PREVIEW_BITMAP }, // cols to return                    </span>
<span class="9098744119488497529" onmouseenter="enter('9098744119488497529');" onmouseout="out('9098744119488497529');" style=""> 501                     mCachedSelectQuery, // select query                                                  </span>
<span class="7819507014643484139" onmouseenter="enter('7819507014643484139');" onmouseout="out('7819507014643484139');" style=""> 502                     new String[] { name, mSize }, // args to select query                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 503                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 504                     null,                                                                                </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 505                     null,                                                                                </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 506                     null);                                                                               </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 507         } catch (SQLiteDiskIOException e) {                                                              </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 508             recreateDb();                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 509             return null;                                                                                 </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 510         } catch (SQLiteCantOpenDatabaseException e) {                                                    </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 511             dumpOpenFiles();                                                                             </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 512             throw e;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513         }                                                                                                </span>
<span class="175106850439522001" onmouseenter="enter('175106850439522001');" onmouseout="out('175106850439522001');" style=""> 514         if (result.getCount() &gt; 0) {                                                                     </span>
<span class="-8233551716377839585" onmouseenter="enter('-8233551716377839585');" onmouseout="out('-8233551716377839585');" style=""> 515             result.moveToFirst();                                                                        </span>
<span class="-8295573450010349547" onmouseenter="enter('-8295573450010349547');" onmouseout="out('-8295573450010349547');" style=""> 516             byte[] blob = result.getBlob(0);                                                             </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 517             result.close();                                                                              </span>
<span class="5422706254339452362" onmouseenter="enter('5422706254339452362');" onmouseout="out('5422706254339452362');" style=""> 518             final BitmapFactory.Options opts = mCachedBitmapFactoryOptions.get();                        </span>
<span class="-4203120540780740867" onmouseenter="enter('-4203120540780740867');" onmouseout="out('-4203120540780740867');" style=""> 519             opts.inBitmap = b;                                                                           </span>
<span class="5746761561761774101" onmouseenter="enter('5746761561761774101');" onmouseout="out('5746761561761774101');" style=""> 520             opts.inSampleSize = 1;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 521             try {                                                                                        </span>
<span class="5467059833557948093" onmouseenter="enter('5467059833557948093');" onmouseout="out('5467059833557948093');" style=""> 522                 return BitmapFactory.decodeByteArray(blob, 0, blob.length, opts);                        </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 523             } catch (IllegalArgumentException e) {                                                       </span>
<span class="-8663451629875904419" onmouseenter="enter('-8663451629875904419');" onmouseout="out('-8663451629875904419');" style=""> 524                 removeItemFromDb(mDb, name);                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 525                 return null;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 527         } else {                                                                                         </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 528             result.close();                                                                              </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 529             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531     }                                                                                                    </span>
<span  style=""> 532                                                                                                          </span>
<span class="-4571373922604646261" onmouseenter="enter('-4571373922604646261');" onmouseout="out('-4571373922604646261');" style=""> 533     private Bitmap generatePreview(Object info, Bitmap preview) {                                        </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 534         if (preview != null &amp;&amp;                                                                           </span>
<span class="-4427245060729789933" onmouseenter="enter('-4427245060729789933');" onmouseout="out('-4427245060729789933');" style=""> 535                 (preview.getWidth() != mPreviewBitmapWidth ||                                            </span>
<span class="-7111303570896946504" onmouseenter="enter('-7111303570896946504');" onmouseout="out('-7111303570896946504');" style=""> 536                 preview.getHeight() != mPreviewBitmapHeight)) {                                          </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 537             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538         }                                                                                                </span>
<span class="-3932360089392842216" onmouseenter="enter('-3932360089392842216');" onmouseout="out('-3932360089392842216');" style=""> 539         if (info instanceof AppWidgetProviderInfo) {                                                     </span>
<span class="-6841541424186777283" onmouseenter="enter('-6841541424186777283');" onmouseout="out('-6841541424186777283');" style=""> 540             return generateWidgetPreview((AppWidgetProviderInfo) info, preview);                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 541         } else {                                                                                         </span>
<span class="5830651867016154139" onmouseenter="enter('5830651867016154139');" onmouseout="out('5830651867016154139');" style=""> 542             return generateShortcutPreview(                                                              </span>
<span class="5884922488800788426" onmouseenter="enter('5884922488800788426');" onmouseout="out('5884922488800788426');" style=""> 543                     (ResolveInfo) info, mPreviewBitmapWidth, mPreviewBitmapHeight, preview);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545     }                                                                                                    </span>
<span  style=""> 546                                                                                                          </span>
<span class="6578518467799953308" onmouseenter="enter('6578518467799953308');" onmouseout="out('6578518467799953308');" style=""> 547     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, Bitmap preview) {                    </span>
<span class="9147821438266271134" onmouseenter="enter('9147821438266271134');" onmouseout="out('9147821438266271134');" style=""> 548         int[] cellSpans = Launcher.getSpanForWidget(mContext, info);                                     </span>
<span class="-1431657331442958147" onmouseenter="enter('-1431657331442958147');" onmouseout="out('-1431657331442958147');" style=""> 549         int maxWidth = maxWidthForWidgetPreview(cellSpans[0]);                                           </span>
<span class="-6135167628743317243" onmouseenter="enter('-6135167628743317243');" onmouseout="out('-6135167628743317243');" style=""> 550         int maxHeight = maxHeightForWidgetPreview(cellSpans[1]);                                         </span>
<span class="-6510989053235413139" onmouseenter="enter('-6510989053235413139');" onmouseout="out('-6510989053235413139');" style=""> 551         return generateWidgetPreview(info, cellSpans[0], cellSpans[1],                                   </span>
<span class="5560351977065436698" onmouseenter="enter('5560351977065436698');" onmouseout="out('5560351977065436698');" style=""> 552                 maxWidth, maxHeight, preview, null);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553     }                                                                                                    </span>
<span  style=""> 554                                                                                                          </span>
<span class="-4962504510381054079" onmouseenter="enter('-4962504510381054079');" onmouseout="out('-4962504510381054079');" style=""> 555     public int maxWidthForWidgetPreview(int spanX) {                                                     </span>
<span class="5345170673015378699" onmouseenter="enter('5345170673015378699');" onmouseout="out('5345170673015378699');" style=""> 556         return Math.min(mPreviewBitmapWidth,                                                             </span>
<span class="-7096108314182907064" onmouseenter="enter('-7096108314182907064');" onmouseout="out('-7096108314182907064');" style=""> 557                 mWidgetSpacingLayout.estimateCellWidth(spanX));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558     }                                                                                                    </span>
<span  style=""> 559                                                                                                          </span>
<span class="-516047466055903408" onmouseenter="enter('-516047466055903408');" onmouseout="out('-516047466055903408');" style=""> 560     public int maxHeightForWidgetPreview(int spanY) {                                                    </span>
<span class="8958196798141008482" onmouseenter="enter('8958196798141008482');" onmouseout="out('8958196798141008482');" style=""> 561         return Math.min(mPreviewBitmapHeight,                                                            </span>
<span class="-8176698640675478774" onmouseenter="enter('-8176698640675478774');" onmouseout="out('-8176698640675478774');" style=""> 562                 mWidgetSpacingLayout.estimateCellHeight(spanY));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563     }                                                                                                    </span>
<span  style=""> 564                                                                                                          </span>
<span class="-6895334532662888649" onmouseenter="enter('-6895334532662888649');" onmouseout="out('-6895334532662888649');" style=""> 565     public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, int cellHSpan, int cellVSpan,        </span>
<span class="-5508121118873891580" onmouseenter="enter('-5508121118873891580');" onmouseout="out('-5508121118873891580');" style=""> 566             int maxPreviewWidth, int maxPreviewHeight, Bitmap preview, int[] preScaledWidthOut) {        </span>
<span class="2529916654704436428" onmouseenter="enter('2529916654704436428');" onmouseout="out('2529916654704436428');" style=""> 567         // Load the preview image if possible                                                            </span>
<span class="931456242657570009" onmouseenter="enter('931456242657570009');" onmouseout="out('931456242657570009');" style=""> 568         if (maxPreviewWidth &lt; 0) maxPreviewWidth = Integer.MAX_VALUE;                                    </span>
<span class="-3276405287943718338" onmouseenter="enter('-3276405287943718338');" onmouseout="out('-3276405287943718338');" style=""> 569         if (maxPreviewHeight &lt; 0) maxPreviewHeight = Integer.MAX_VALUE;                                  </span>
<span  style=""> 570                                                                                                          </span>
<span class="-3049333615145638519" onmouseenter="enter('-3049333615145638519');" onmouseout="out('-3049333615145638519');" style=""> 571         Drawable drawable = null;                                                                        </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 572         if (info.previewImage != 0) {                                                                    </span>
<span class="-6995452363019574294" onmouseenter="enter('-6995452363019574294');" onmouseout="out('-6995452363019574294');" style=""> 573             drawable = mManager.loadPreview(info);                                                       </span>
<span class="281943916213481387" onmouseenter="enter('281943916213481387');" onmouseout="out('281943916213481387');" style=""> 574             if (drawable != null) {                                                                      </span>
<span class="559582177948747235" onmouseenter="enter('559582177948747235');" onmouseout="out('559582177948747235');" style=""> 575                 drawable = mutateOnMainThread(drawable);                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 576             } else {                                                                                     </span>
<span class="7073909505336594696" onmouseenter="enter('7073909505336594696');" onmouseout="out('7073909505336594696');" style=""> 577                 Log.w(TAG, &quot;Can&#x27;t load widget preview drawable 0x&quot; +                                     </span>
<span class="-4346717227149782469" onmouseenter="enter('-4346717227149782469');" onmouseout="out('-4346717227149782469');" style=""> 578                         Integer.toHexString(info.previewImage) + &quot; for provider: &quot; + info.provider);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580         }                                                                                                </span>
<span  style=""> 581                                                                                                          </span>
<span class="5985266596175165266" onmouseenter="enter('5985266596175165266');" onmouseout="out('5985266596175165266');" style=""> 582         int previewWidth;                                                                                </span>
<span class="-7312246595783828327" onmouseenter="enter('-7312246595783828327');" onmouseout="out('-7312246595783828327');" style=""> 583         int previewHeight;                                                                               </span>
<span class="5524531081830166723" onmouseenter="enter('5524531081830166723');" onmouseout="out('5524531081830166723');" style=""> 584         Bitmap defaultPreview = null;                                                                    </span>
<span class="5121594519432393069" onmouseenter="enter('5121594519432393069');" onmouseout="out('5121594519432393069');" style=""> 585         boolean widgetPreviewExists = (drawable != null);                                                </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 586         if (widgetPreviewExists) {                                                                       </span>
<span class="7694696434619666028" onmouseenter="enter('7694696434619666028');" onmouseout="out('7694696434619666028');" style=""> 587             previewWidth = drawable.getIntrinsicWidth();                                                 </span>
<span class="-5860514303309291265" onmouseenter="enter('-5860514303309291265');" onmouseout="out('-5860514303309291265');" style=""> 588             previewHeight = drawable.getIntrinsicHeight();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 589         } else {                                                                                         </span>
<span class="7833733472444702454" onmouseenter="enter('7833733472444702454');" onmouseout="out('7833733472444702454');" style=""> 590             // Generate a preview image if we couldn&#x27;t load one                                          </span>
<span class="-8710794757779095209" onmouseenter="enter('-8710794757779095209');" onmouseout="out('-8710794757779095209');" style=""> 591             if (cellHSpan &lt; 1) cellHSpan = 1;                                                            </span>
<span class="-779725371469556670" onmouseenter="enter('-779725371469556670');" onmouseout="out('-779725371469556670');" style=""> 592             if (cellVSpan &lt; 1) cellVSpan = 1;                                                            </span>
<span  style=""> 593                                                                                                          </span>
<span class="3565276356973562387" onmouseenter="enter('3565276356973562387');" onmouseout="out('3565276356973562387');" style=""> 594             // This Drawable is not directly drawn, so there&#x27;s no need to mutate it.                     </span>
<span class="-5021189500908681979" onmouseenter="enter('-5021189500908681979');" onmouseout="out('-5021189500908681979');" style=""> 595             BitmapDrawable previewDrawable = (BitmapDrawable) mContext.getResources()                    </span>
<span class="3152690746910736269" onmouseenter="enter('3152690746910736269');" onmouseout="out('3152690746910736269');" style=""> 596                     .getDrawable(R.drawable.widget_tile);                                                </span>
<span class="-5932659289331905035" onmouseenter="enter('-5932659289331905035');" onmouseout="out('-5932659289331905035');" style=""> 597             final int previewDrawableWidth = previewDrawable                                             </span>
<span class="-5783669958167413803" onmouseenter="enter('-5783669958167413803');" onmouseout="out('-5783669958167413803');" style=""> 598                     .getIntrinsicWidth();                                                                </span>
<span class="4431322150991047787" onmouseenter="enter('4431322150991047787');" onmouseout="out('4431322150991047787');" style=""> 599             final int previewDrawableHeight = previewDrawable                                            </span>
<span class="4098769707366186014" onmouseenter="enter('4098769707366186014');" onmouseout="out('4098769707366186014');" style=""> 600                     .getIntrinsicHeight();                                                               </span>
<span class="8887455390458335872" onmouseenter="enter('8887455390458335872');" onmouseout="out('8887455390458335872');" style=""> 601             previewWidth = previewDrawableWidth * cellHSpan;                                             </span>
<span class="-8341882922226410648" onmouseenter="enter('-8341882922226410648');" onmouseout="out('-8341882922226410648');" style=""> 602             previewHeight = previewDrawableHeight * cellVSpan;                                           </span>
<span  style=""> 603                                                                                                          </span>
<span class="-737373095753296600" onmouseenter="enter('-737373095753296600');" onmouseout="out('-737373095753296600');" style=""> 604             defaultPreview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 605             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="848607727045658162" onmouseenter="enter('848607727045658162');" onmouseout="out('848607727045658162');" style=""> 606             c.setBitmap(defaultPreview);                                                                 </span>
<span class="4673250187052598192" onmouseenter="enter('4673250187052598192');" onmouseout="out('4673250187052598192');" style=""> 607             Paint p = mDefaultAppWidgetPreviewPaint.get();                                               </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 608             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 609                 p = new Paint();                                                                         </span>
<span class="9031053372645621365" onmouseenter="enter('9031053372645621365');" onmouseout="out('9031053372645621365');" style=""> 610                 p.setShader(new BitmapShader(previewDrawable.getBitmap(),                                </span>
<span class="1595910380715064067" onmouseenter="enter('1595910380715064067');" onmouseout="out('1595910380715064067');" style=""> 611                         Shader.TileMode.REPEAT, Shader.TileMode.REPEAT));                                </span>
<span class="-8603584172680459929" onmouseenter="enter('-8603584172680459929');" onmouseout="out('-8603584172680459929');" style=""> 612                 mDefaultAppWidgetPreviewPaint.set(p);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613             }                                                                                            </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 614             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="4633920667503149983" onmouseenter="enter('4633920667503149983');" onmouseout="out('4633920667503149983');" style=""> 615             dest.set(0, 0, previewWidth, previewHeight);                                                 </span>
<span class="-470581757098027879" onmouseenter="enter('-470581757098027879');" onmouseout="out('-470581757098027879');" style=""> 616             c.drawRect(dest, p);                                                                         </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 617             c.setBitmap(null);                                                                           </span>
<span  style=""> 618                                                                                                          </span>
<span class="4647625888602990242" onmouseenter="enter('4647625888602990242');" onmouseout="out('4647625888602990242');" style=""> 619             // Draw the icon in the top left corner                                                      </span>
<span class="3531213633716353102" onmouseenter="enter('3531213633716353102');" onmouseout="out('3531213633716353102');" style=""> 620             int minOffset = (int) (mAppIconSize * WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE);               </span>
<span class="-3256500215342314396" onmouseenter="enter('-3256500215342314396');" onmouseout="out('-3256500215342314396');" style=""> 621             int smallestSide = Math.min(previewWidth, previewHeight);                                    </span>
<span class="1098745458783687815" onmouseenter="enter('1098745458783687815');" onmouseout="out('1098745458783687815');" style=""> 622             float iconScale = Math.min((float) smallestSide                                              </span>
<span class="7317986328586297721" onmouseenter="enter('7317986328586297721');" onmouseout="out('7317986328586297721');" style=""> 623                     / (mAppIconSize + 2 * minOffset), 1f);                                               </span>
<span  style=""> 624                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 625             try {                                                                                        </span>
<span class="-837531234335200976" onmouseenter="enter('-837531234335200976');" onmouseout="out('-837531234335200976');" style=""> 626                 Drawable icon = mManager.loadIcon(info, mIconCache);                                     </span>
<span class="-4192144256919602329" onmouseenter="enter('-4192144256919602329');" onmouseout="out('-4192144256919602329');" style=""> 627                 if (icon != null) {                                                                      </span>
<span class="-1224594640800103937" onmouseenter="enter('-1224594640800103937');" onmouseout="out('-1224594640800103937');" style=""> 628                     int hoffset = (int) ((previewDrawableWidth - mAppIconSize * iconScale) / 2);         </span>
<span class="-389205104576287013" onmouseenter="enter('-389205104576287013');" onmouseout="out('-389205104576287013');" style=""> 629                     int yoffset = (int) ((previewDrawableHeight - mAppIconSize * iconScale) / 2);        </span>
<span class="-867380701080615138" onmouseenter="enter('-867380701080615138');" onmouseout="out('-867380701080615138');" style=""> 630                     icon = mutateOnMainThread(icon);                                                     </span>
<span class="1665310338408239466" onmouseenter="enter('1665310338408239466');" onmouseout="out('1665310338408239466');" style=""> 631                     renderDrawableToBitmap(icon, defaultPreview, hoffset,                                </span>
<span class="8191900375173585890" onmouseenter="enter('8191900375173585890');" onmouseout="out('8191900375173585890');" style=""> 632                             yoffset, (int) (mAppIconSize * iconScale),                                   </span>
<span class="-5886521530151300680" onmouseenter="enter('-5886521530151300680');" onmouseout="out('-5886521530151300680');" style=""> 633                             (int) (mAppIconSize * iconScale));                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634                 }                                                                                        </span>
<span class="5183756364953253383" onmouseenter="enter('5183756364953253383');" onmouseout="out('5183756364953253383');" style=""> 635             } catch (Resources.NotFoundException e) {                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637         }                                                                                                </span>
<span  style=""> 638                                                                                                          </span>
<span class="6949857229431854068" onmouseenter="enter('6949857229431854068');" onmouseout="out('6949857229431854068');" style=""> 639         // Scale to fit width only - let the widget preview be clipped in the                            </span>
<span class="8360805034192073884" onmouseenter="enter('8360805034192073884');" onmouseout="out('8360805034192073884');" style=""> 640         // vertical dimension                                                                            </span>
<span class="-8224051742145745082" onmouseenter="enter('-8224051742145745082');" onmouseout="out('-8224051742145745082');" style=""> 641         float scale = 1f;                                                                                </span>
<span class="6149434037546525815" onmouseenter="enter('6149434037546525815');" onmouseout="out('6149434037546525815');" style=""> 642         if (preScaledWidthOut != null) {                                                                 </span>
<span class="2306433834272734783" onmouseenter="enter('2306433834272734783');" onmouseout="out('2306433834272734783');" style=""> 643             preScaledWidthOut[0] = previewWidth;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="-7638941371937567348" onmouseenter="enter('-7638941371937567348');" onmouseout="out('-7638941371937567348');" style=""> 645         if (previewWidth &gt; maxPreviewWidth) {                                                            </span>
<span class="-6167807034013491459" onmouseenter="enter('-6167807034013491459');" onmouseout="out('-6167807034013491459');" style=""> 646             scale = maxPreviewWidth / (float) previewWidth;                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647         }                                                                                                </span>
<span class="-8893868344639903626" onmouseenter="enter('-8893868344639903626');" onmouseout="out('-8893868344639903626');" style=""> 648         if (scale != 1f) {                                                                               </span>
<span class="-6338970909485118519" onmouseenter="enter('-6338970909485118519');" onmouseout="out('-6338970909485118519');" style=""> 649             previewWidth = (int) (scale * previewWidth);                                                 </span>
<span class="2442469555843251122" onmouseenter="enter('2442469555843251122');" onmouseout="out('2442469555843251122');" style=""> 650             previewHeight = (int) (scale * previewHeight);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651         }                                                                                                </span>
<span  style=""> 652                                                                                                          </span>
<span class="-1124372066791938196" onmouseenter="enter('-1124372066791938196');" onmouseout="out('-1124372066791938196');" style=""> 653         // If a bitmap is passed in, we use it; otherwise, we create a bitmap of the right size          </span>
<span class="2486895102595751802" onmouseenter="enter('2486895102595751802');" onmouseout="out('2486895102595751802');" style=""> 654         if (preview == null) {                                                                           </span>
<span class="6637154682204057097" onmouseenter="enter('6637154682204057097');" onmouseout="out('6637154682204057097');" style=""> 655             preview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656         }                                                                                                </span>
<span  style=""> 657                                                                                                          </span>
<span class="-2080916171919384218" onmouseenter="enter('-2080916171919384218');" onmouseout="out('-2080916171919384218');" style=""> 658         // Draw the scaled preview into the final bitmap                                                 </span>
<span class="3369675460464663159" onmouseenter="enter('3369675460464663159');" onmouseout="out('3369675460464663159');" style=""> 659         int x = (preview.getWidth() - previewWidth) / 2;                                                 </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 660         if (widgetPreviewExists) {                                                                       </span>
<span class="-6966420244976420379" onmouseenter="enter('-6966420244976420379');" onmouseout="out('-6966420244976420379');" style=""> 661             renderDrawableToBitmap(drawable, preview, x, 0, previewWidth,                                </span>
<span class="-7548196549309427555" onmouseenter="enter('-7548196549309427555');" onmouseout="out('-7548196549309427555');" style=""> 662                     previewHeight);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 663         } else {                                                                                         </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 664             final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                        </span>
<span class="5281190707868665361" onmouseenter="enter('5281190707868665361');" onmouseout="out('5281190707868665361');" style=""> 665             final Rect src = mCachedAppWidgetPreviewSrcRect.get();                                       </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 666             final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                     </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 667             c.setBitmap(preview);                                                                        </span>
<span class="-8725434908843264237" onmouseenter="enter('-8725434908843264237');" onmouseout="out('-8725434908843264237');" style=""> 668             src.set(0, 0, defaultPreview.getWidth(), defaultPreview.getHeight());                        </span>
<span class="-7071368679565427433" onmouseenter="enter('-7071368679565427433');" onmouseout="out('-7071368679565427433');" style=""> 669             dest.set(x, 0, x + previewWidth, previewHeight);                                             </span>
<span  style=""> 670                                                                                                          </span>
<span class="5839465204107083552" onmouseenter="enter('5839465204107083552');" onmouseout="out('5839465204107083552');" style=""> 671             Paint p = mCachedAppWidgetPreviewPaint.get();                                                </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 672             if (p == null) {                                                                             </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 673                 p = new Paint();                                                                         </span>
<span class="-3846510342158419561" onmouseenter="enter('-3846510342158419561');" onmouseout="out('-3846510342158419561');" style=""> 674                 p.setFilterBitmap(true);                                                                 </span>
<span class="8711891207106027486" onmouseenter="enter('8711891207106027486');" onmouseout="out('8711891207106027486');" style=""> 675                 mCachedAppWidgetPreviewPaint.set(p);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 676             }                                                                                            </span>
<span class="-8322704971015823035" onmouseenter="enter('-8322704971015823035');" onmouseout="out('-8322704971015823035');" style=""> 677             c.drawBitmap(defaultPreview, src, dest, p);                                                  </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 678             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679         }                                                                                                </span>
<span class="-5318059876677185928" onmouseenter="enter('-5318059876677185928');" onmouseout="out('-5318059876677185928');" style=""> 680         return mManager.getBadgeBitmap(info, preview);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681     }                                                                                                    </span>
<span  style=""> 682                                                                                                          </span>
<span class="-9077094886304575329" onmouseenter="enter('-9077094886304575329');" onmouseout="out('-9077094886304575329');" style=""><abbr title=" 683     private Bitmap generateShortcutPreview(ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview) {"> 683     private Bitmap generateShortcutPreview(ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview)ðŸ”µ</abbr></span>
<span class="6669617465194046785" onmouseenter="enter('6669617465194046785');" onmouseout="out('6669617465194046785');" style=""> 684         Bitmap tempBitmap = mCachedShortcutPreviewBitmap.get();                                          </span>
<span class="8492580593566939346" onmouseenter="enter('8492580593566939346');" onmouseout="out('8492580593566939346');" style=""> 685         final Canvas c = mCachedShortcutPreviewCanvas.get();                                             </span>
<span class="732393899586587628" onmouseenter="enter('732393899586587628');" onmouseout="out('732393899586587628');" style=""><abbr title=" 686         if (((tempBitmap == null) || (tempBitmap.getWidth() != maxWidth)) || (tempBitmap.getHeight() != maxHeight)) {"> 686         if (((tempBitmap == null) || (tempBitmap.getWidth() != maxWidth)) || (tempBitmap.getHeight() != mðŸ”µ</abbr></span>
<span class="5079923942824258796" onmouseenter="enter('5079923942824258796');" onmouseout="out('5079923942824258796');" style=""> 687             tempBitmap = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                     </span>
<span class="3252713296815828481" onmouseenter="enter('3252713296815828481');" onmouseout="out('3252713296815828481');" style=""> 688             mCachedShortcutPreviewBitmap.set(tempBitmap);                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 689         } else {                                                                                         </span>
<span class="2908194814219559361" onmouseenter="enter('2908194814219559361');" onmouseout="out('2908194814219559361');" style=""> 690             c.setBitmap(tempBitmap);                                                                     </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 691             c.drawColor(0, PorterDuff.Mode.CLEAR);                                                       </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 692             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693         }                                                                                                </span>
<span class="-895750054343748789" onmouseenter="enter('-895750054343748789');" onmouseout="out('-895750054343748789');" style=""> 694         // Render the icon                                                                               </span>
<span class="-8632811780119956337" onmouseenter="enter('-8632811780119956337');" onmouseout="out('-8632811780119956337');" style=""> 695         Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info.activityInfo));                </span>
<span class="6487988943377340979" onmouseenter="enter('6487988943377340979');" onmouseout="out('6487988943377340979');" style=""><abbr title=" 696         int paddingTop = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);"> 696         int paddingTop = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_paddingðŸ”µ</abbr></span>
<span class="775275314375318503" onmouseenter="enter('775275314375318503');" onmouseout="out('775275314375318503');" style=""><abbr title=" 697         int paddingLeft = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);"> 697         int paddingLeft = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_paddinðŸ”µ</abbr></span>
<span class="-3000409307102255580" onmouseenter="enter('-3000409307102255580');" onmouseout="out('-3000409307102255580');" style=""><abbr title=" 698         int paddingRight = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);"> 698         int paddingRight = mContext.getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_paddiðŸ”µ</abbr></span>
<span class="6606454810904398675" onmouseenter="enter('6606454810904398675');" onmouseout="out('6606454810904398675');" style=""> 699         int scaledIconWidth = (maxWidth - paddingLeft) - paddingRight;                                   </span>
<span class="-529905929707407442" onmouseenter="enter('-529905929707407442');" onmouseout="out('-529905929707407442');" style=""><abbr title=" 700         renderDrawableToBitmap(icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidth);"> 700         renderDrawableToBitmap(icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidtðŸ”µ</abbr></span>
<span class="-4898429087052783149" onmouseenter="enter('-4898429087052783149');" onmouseout="out('-4898429087052783149');" style=""><abbr title=" 701         if ((preview != null) &amp;&amp; ((preview.getWidth() != maxWidth) || (preview.getHeight() != maxHeight))) {"> 701         if ((preview != null) &amp;&amp; ((preview.getWidth() != maxWidth) || (preview.getHeight() != maxHeight))ðŸ”µ</abbr></span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 702             throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                    </span>
<span class="3365320965403910466" onmouseenter="enter('3365320965403910466');" onmouseout="out('3365320965403910466');" style=""> 703         } else if (preview == null) {                                                                    </span>
<span class="4551594767613519312" onmouseenter="enter('4551594767613519312');" onmouseout="out('4551594767613519312');" style=""> 704             preview = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705         }                                                                                                </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 706         c.setBitmap(preview);                                                                            </span>
<span class="8934981767024497500" onmouseenter="enter('8934981767024497500');" onmouseout="out('8934981767024497500');" style=""> 707         // Draw a desaturated/scaled version of the icon in the background as a watermark                </span>
<span class="-518774087151586601" onmouseenter="enter('-518774087151586601');" onmouseout="out('-518774087151586601');" style=""> 708         Paint p = mCachedShortcutPreviewPaint.get();                                                     </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 709         if (p == null) {                                                                                 </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 710             p = new Paint();                                                                             </span>
<span class="5185800516692981036" onmouseenter="enter('5185800516692981036');" onmouseout="out('5185800516692981036');" style=""> 711             ColorMatrix colorMatrix = new ColorMatrix();                                                 </span>
<span class="-4096104009908534310" onmouseenter="enter('-4096104009908534310');" onmouseout="out('-4096104009908534310');" style=""> 712             colorMatrix.setSaturation(0);                                                                </span>
<span class="-2105686232381577699" onmouseenter="enter('-2105686232381577699');" onmouseout="out('-2105686232381577699');" style=""> 713             p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));                                   </span>
<span class="4952908024522357152" onmouseenter="enter('4952908024522357152');" onmouseout="out('4952908024522357152');" style=""> 714             p.setAlpha(((int) (255 * 0.06F)));                                                           </span>
<span class="-4885683919835504124" onmouseenter="enter('-4885683919835504124');" onmouseout="out('-4885683919835504124');" style=""> 715             mCachedShortcutPreviewPaint.set(p);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716         }                                                                                                </span>
<span class="-4554115702547152566" onmouseenter="enter('-4554115702547152566');" onmouseout="out('-4554115702547152566');" style=""> 717         c.drawBitmap(tempBitmap, 0, 0, p);                                                               </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 718         c.setBitmap(null);                                                                               </span>
<span class="-5738465230776990197" onmouseenter="enter('-5738465230776990197');" onmouseout="out('-5738465230776990197');" style=""> 719         renderDrawableToBitmap(icon, preview, 0, 0, mAppIconSize, mAppIconSize);                         </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 720         return preview;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 721     }                                                                                                    </span>
<span  style=""> 722                                                                                                          </span>
<span class="-2512069815104909632" onmouseenter="enter('-2512069815104909632');" onmouseout="out('-2512069815104909632');" style=""> 723     private static void renderDrawableToBitmap(                                                          </span>
<span class="-281586385806654310" onmouseenter="enter('-281586385806654310');" onmouseout="out('-281586385806654310');" style=""> 724             Drawable d, Bitmap bitmap, int x, int y, int w, int h) {                                     </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 725         if (bitmap != null) {                                                                            </span>
<span class="417388478829800263" onmouseenter="enter('417388478829800263');" onmouseout="out('417388478829800263');" style=""> 726             Canvas c = new Canvas(bitmap);                                                               </span>
<span class="2629107935702523978" onmouseenter="enter('2629107935702523978');" onmouseout="out('2629107935702523978');" style=""> 727             Rect oldBounds = d.copyBounds();                                                             </span>
<span class="-7883404386706876736" onmouseenter="enter('-7883404386706876736');" onmouseout="out('-7883404386706876736');" style=""> 728             d.setBounds(x, y, x + w, y + h);                                                             </span>
<span class="3763902819788011622" onmouseenter="enter('3763902819788011622');" onmouseout="out('3763902819788011622');" style=""> 729             d.draw(c);                                                                                   </span>
<span class="-5442987023720851592" onmouseenter="enter('-5442987023720851592');" onmouseout="out('-5442987023720851592');" style=""> 730             d.setBounds(oldBounds); // Restore the bounds                                                </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 731             c.setBitmap(null);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733     }                                                                                                    </span>
<span  style=""> 734                                                                                                          </span>
<span class="-2265124982478046254" onmouseenter="enter('-2265124982478046254');" onmouseout="out('-2265124982478046254');" style=""> 735     private Drawable mutateOnMainThread(final Drawable drawable) {                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 736         try {                                                                                            </span>
<span class="3177563387853690691" onmouseenter="enter('3177563387853690691');" onmouseout="out('3177563387853690691');" style=""> 737             return mMainThreadExecutor.submit(new Callable&lt;Drawable&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 738                 @Override                                                                                </span>
<span class="4251206983441278885" onmouseenter="enter('4251206983441278885');" onmouseout="out('4251206983441278885');" style=""> 739                 public Drawable call() throws Exception {                                                </span>
<span class="721315677862243657" onmouseenter="enter('721315677862243657');" onmouseout="out('721315677862243657');" style=""> 740                     return drawable.mutate();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741                 }                                                                                        </span>
<span class="8868058436262798399" onmouseenter="enter('8868058436262798399');" onmouseout="out('8868058436262798399');" style=""> 742             }).get();                                                                                    </span>
<span class="-7528533024404460182" onmouseenter="enter('-7528533024404460182');" onmouseout="out('-7528533024404460182');" style=""> 743         } catch (InterruptedException e) {                                                               </span>
<span class="8315424094067049480" onmouseenter="enter('8315424094067049480');" onmouseout="out('8315424094067049480');" style=""> 744             Thread.currentThread().interrupt();                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 745             throw new RuntimeException(e);                                                               </span>
<span class="-3674505659955768067" onmouseenter="enter('-3674505659955768067');" onmouseout="out('-3674505659955768067');" style=""> 746         } catch (ExecutionException e) {                                                                 </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 747             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 749     }                                                                                                    </span>
<span  style=""> 750                                                                                                          </span>
<span class="-1664432510733041020" onmouseenter="enter('-1664432510733041020');" onmouseout="out('-1664432510733041020');" style=""> 751     private static final int MAX_OPEN_FILES = 1024;                                                      </span>
<span  style=""> 752                                                                                                          </span>
<span class="9072161857204403261" onmouseenter="enter('9072161857204403261');" onmouseout="out('9072161857204403261');" style=""> 753     private static final int SAMPLE_RATE = 23;                                                           </span>
<span  style=""> 754                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 755     /**                                                                                                  </span>
<span class="4777297713483982548" onmouseenter="enter('4777297713483982548');" onmouseout="out('4777297713483982548');" style=""> 756      * Dumps all files that are open in this process without allocating a file descriptor.               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 757      */                                                                                                  </span>
<span class="7630668132257036624" onmouseenter="enter('7630668132257036624');" onmouseout="out('7630668132257036624');" style=""> 758     private static void dumpOpenFiles() {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 759         try {                                                                                            </span>
<span class="7095374185665412657" onmouseenter="enter('7095374185665412657');" onmouseout="out('7095374185665412657');" style=""> 760             Log.i(TAG, &quot;DUMP OF OPEN FILES (sample rate: 1 every &quot; + SAMPLE_RATE + &quot;):&quot;);                </span>
<span class="-6063809008451063811" onmouseenter="enter('-6063809008451063811');" onmouseout="out('-6063809008451063811');" style=""> 761             final String TYPE_APK = &quot;apk&quot;;                                                               </span>
<span class="-6901274176875279046" onmouseenter="enter('-6901274176875279046');" onmouseout="out('-6901274176875279046');" style=""> 762             final String TYPE_JAR = &quot;jar&quot;;                                                               </span>
<span class="-4233944286779457769" onmouseenter="enter('-4233944286779457769');" onmouseout="out('-4233944286779457769');" style=""> 763             final String TYPE_PIPE = &quot;pipe&quot;;                                                             </span>
<span class="-7830089877175241432" onmouseenter="enter('-7830089877175241432');" onmouseout="out('-7830089877175241432');" style=""> 764             final String TYPE_SOCKET = &quot;socket&quot;;                                                         </span>
<span class="6234651693695236755" onmouseenter="enter('6234651693695236755');" onmouseout="out('6234651693695236755');" style=""> 765             final String TYPE_DB = &quot;db&quot;;                                                                 </span>
<span class="-6587583242995441423" onmouseenter="enter('-6587583242995441423');" onmouseout="out('-6587583242995441423');" style=""> 766             final String TYPE_ANON_INODE = &quot;anon_inode&quot;;                                                 </span>
<span class="-3500545166621689968" onmouseenter="enter('-3500545166621689968');" onmouseout="out('-3500545166621689968');" style=""> 767             final String TYPE_DEV = &quot;dev&quot;;                                                               </span>
<span class="2067143891119682248" onmouseenter="enter('2067143891119682248');" onmouseout="out('2067143891119682248');" style=""> 768             final String TYPE_NON_FS = &quot;non-fs&quot;;                                                         </span>
<span class="5330062242195911314" onmouseenter="enter('5330062242195911314');" onmouseout="out('5330062242195911314');" style=""> 769             final String TYPE_OTHER = &quot;other&quot;;                                                           </span>
<span class="4846737914738595164" onmouseenter="enter('4846737914738595164');" onmouseout="out('4846737914738595164');" style=""> 770             List&lt;String&gt; types = Arrays.asList(TYPE_APK, TYPE_JAR, TYPE_PIPE, TYPE_SOCKET, TYPE_DB,      </span>
<span class="-1126389211762394977" onmouseenter="enter('-1126389211762394977');" onmouseout="out('-1126389211762394977');" style=""> 771                     TYPE_ANON_INODE, TYPE_DEV, TYPE_NON_FS, TYPE_OTHER);                                 </span>
<span class="7087384337453352553" onmouseenter="enter('7087384337453352553');" onmouseout="out('7087384337453352553');" style=""> 772             int[] count = new int[types.size()];                                                         </span>
<span class="-400567270817057775" onmouseenter="enter('-400567270817057775');" onmouseout="out('-400567270817057775');" style=""> 773             int[] duplicates = new int[types.size()];                                                    </span>
<span class="-5112763339406897335" onmouseenter="enter('-5112763339406897335');" onmouseout="out('-5112763339406897335');" style=""> 774             HashSet&lt;String&gt; files = new HashSet&lt;String&gt;();                                               </span>
<span class="-926962837754337949" onmouseenter="enter('-926962837754337949');" onmouseout="out('-926962837754337949');" style=""> 775             int total = 0;                                                                               </span>
<span class="1028290052541393010" onmouseenter="enter('1028290052541393010');" onmouseout="out('1028290052541393010');" style=""> 776             for (int i = 0; i &lt; MAX_OPEN_FILES; i++) {                                                   </span>
<span class="3040328939873692127" onmouseenter="enter('3040328939873692127');" onmouseout="out('3040328939873692127');" style=""> 777                 // This is a gigantic hack but unfortunately the only way to resolve an fd               </span>
<span class="-4129207097038329090" onmouseenter="enter('-4129207097038329090');" onmouseout="out('-4129207097038329090');" style=""> 778                 // to a file name. Note that we have to loop over all possible fds because               </span>
<span class="6927440074701305186" onmouseenter="enter('6927440074701305186');" onmouseout="out('6927440074701305186');" style=""> 779                 // reading the directory would require allocating a new fd. The kernel is                </span>
<span class="-7335721905258259512" onmouseenter="enter('-7335721905258259512');" onmouseout="out('-7335721905258259512');" style=""> 780                 // currently implemented such that no fd is larger then the current rlimit,              </span>
<span class="5240836059895527485" onmouseenter="enter('5240836059895527485');" onmouseout="out('5240836059895527485');" style=""> 781                 // which is why it&#x27;s safe to loop over them in such a way.                               </span>
<span class="-4546857229319265624" onmouseenter="enter('-4546857229319265624');" onmouseout="out('-4546857229319265624');" style=""> 782                 String fd = &quot;/proc/self/fd/&quot; + i;                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 783                 try {                                                                                    </span>
<span class="-5133016265508323671" onmouseenter="enter('-5133016265508323671');" onmouseout="out('-5133016265508323671');" style=""> 784                     // getCanonicalPath() uses readlink behind the scene which doesn&#x27;t require           </span>
<span class="-6226268635961992542" onmouseenter="enter('-6226268635961992542');" onmouseout="out('-6226268635961992542');" style=""> 785                     // a file descriptor.                                                                </span>
<span class="-6892856404262336354" onmouseenter="enter('-6892856404262336354');" onmouseout="out('-6892856404262336354');" style=""> 786                     String resolved = new File(fd).getCanonicalPath();                                   </span>
<span class="-6768751510751326128" onmouseenter="enter('-6768751510751326128');" onmouseout="out('-6768751510751326128');" style=""> 787                     int type = types.indexOf(TYPE_OTHER);                                                </span>
<span class="-848598904663730437" onmouseenter="enter('-848598904663730437');" onmouseout="out('-848598904663730437');" style=""> 788                     if (resolved.startsWith(&quot;/dev/&quot;)) {                                                  </span>
<span class="-4879693837873897752" onmouseenter="enter('-4879693837873897752');" onmouseout="out('-4879693837873897752');" style=""> 789                         type = types.indexOf(TYPE_DEV);                                                  </span>
<span class="-125641070977798446" onmouseenter="enter('-125641070977798446');" onmouseout="out('-125641070977798446');" style=""> 790                     } else if (resolved.endsWith(&quot;.apk&quot;)) {                                              </span>
<span class="8152606461038952319" onmouseenter="enter('8152606461038952319');" onmouseout="out('8152606461038952319');" style=""> 791                         type = types.indexOf(TYPE_APK);                                                  </span>
<span class="-8895861587282636352" onmouseenter="enter('-8895861587282636352');" onmouseout="out('-8895861587282636352');" style=""> 792                     } else if (resolved.endsWith(&quot;.jar&quot;)) {                                              </span>
<span class="6211428299849972552" onmouseenter="enter('6211428299849972552');" onmouseout="out('6211428299849972552');" style=""> 793                         type = types.indexOf(TYPE_JAR);                                                  </span>
<span class="-6474781270675272142" onmouseenter="enter('-6474781270675272142');" onmouseout="out('-6474781270675272142');" style=""> 794                     } else if (resolved.contains(&quot;/fd/pipe:&quot;)) {                                         </span>
<span class="4492281361349576419" onmouseenter="enter('4492281361349576419');" onmouseout="out('4492281361349576419');" style=""> 795                         type = types.indexOf(TYPE_PIPE);                                                 </span>
<span class="5570982548020413210" onmouseenter="enter('5570982548020413210');" onmouseout="out('5570982548020413210');" style=""> 796                     } else if (resolved.contains(&quot;/fd/socket:&quot;)) {                                       </span>
<span class="5340928477240826099" onmouseenter="enter('5340928477240826099');" onmouseout="out('5340928477240826099');" style=""> 797                         type = types.indexOf(TYPE_SOCKET);                                               </span>
<span class="-1889318263670279425" onmouseenter="enter('-1889318263670279425');" onmouseout="out('-1889318263670279425');" style=""> 798                     } else if (resolved.contains(&quot;/fd/anon_inode:&quot;)) {                                   </span>
<span class="7975978575615021567" onmouseenter="enter('7975978575615021567');" onmouseout="out('7975978575615021567');" style=""> 799                         type = types.indexOf(TYPE_ANON_INODE);                                           </span>
<span class="-206211141383156363" onmouseenter="enter('-206211141383156363');" onmouseout="out('-206211141383156363');" style=""> 800                     } else if (resolved.endsWith(&quot;.db&quot;) || resolved.contains(&quot;/databases/&quot;)) {           </span>
<span class="8848130876067097546" onmouseenter="enter('8848130876067097546');" onmouseout="out('8848130876067097546');" style=""> 801                         type = types.indexOf(TYPE_DB);                                                   </span>
<span class="-3013458219347023666" onmouseenter="enter('-3013458219347023666');" onmouseout="out('-3013458219347023666');" style=""> 802                     } else if (resolved.startsWith(&quot;/proc/&quot;) &amp;&amp; resolved.contains(&quot;/fd/&quot;)) {             </span>
<span class="-4021067240164904881" onmouseenter="enter('-4021067240164904881');" onmouseout="out('-4021067240164904881');" style=""> 803                         // Those are the files that don&#x27;t point anywhere on the file system.             </span>
<span class="1766191980587176647" onmouseenter="enter('1766191980587176647');" onmouseout="out('1766191980587176647');" style=""> 804                         // getCanonicalPath() wrongly interprets these as relative symlinks and          </span>
<span class="8319631295934473117" onmouseenter="enter('8319631295934473117');" onmouseout="out('8319631295934473117');" style=""> 805                         // resolves them within /proc/&lt;pid&gt;/fd/.                                         </span>
<span class="-6071677259167823524" onmouseenter="enter('-6071677259167823524');" onmouseout="out('-6071677259167823524');" style=""> 806                         type = types.indexOf(TYPE_NON_FS);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807                     }                                                                                    </span>
<span class="-1328162661144416286" onmouseenter="enter('-1328162661144416286');" onmouseout="out('-1328162661144416286');" style=""> 808                     count[type]++;                                                                       </span>
<span class="-6740236498121811269" onmouseenter="enter('-6740236498121811269');" onmouseout="out('-6740236498121811269');" style=""> 809                     total++;                                                                             </span>
<span class="-1847477132387490804" onmouseenter="enter('-1847477132387490804');" onmouseout="out('-1847477132387490804');" style=""> 810                     if (files.contains(resolved)) {                                                      </span>
<span class="3216339987616567221" onmouseenter="enter('3216339987616567221');" onmouseout="out('3216339987616567221');" style=""> 811                         duplicates[type]++;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812                     }                                                                                    </span>
<span class="-556311909615308250" onmouseenter="enter('-556311909615308250');" onmouseout="out('-556311909615308250');" style=""> 813                     files.add(resolved);                                                                 </span>
<span class="3281685662955304691" onmouseenter="enter('3281685662955304691');" onmouseout="out('3281685662955304691');" style=""> 814                     if (total % SAMPLE_RATE == 0) {                                                      </span>
<span class="-5929979194141152550" onmouseenter="enter('-5929979194141152550');" onmouseout="out('-5929979194141152550');" style=""> 815                         Log.i(TAG, &quot; fd &quot; + i + &quot;: &quot; + resolved                                          </span>
<span class="-3430556922668437990" onmouseenter="enter('-3430556922668437990');" onmouseout="out('-3430556922668437990');" style=""> 816                                 + &quot; (&quot; + types.get(type) + &quot;)&quot;);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817                     }                                                                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 818                 } catch (IOException e) {                                                                </span>
<span class="-4332337590956216445" onmouseenter="enter('-4332337590956216445');" onmouseout="out('-4332337590956216445');" style=""> 819                     // Ignoring exceptions for non-existing file descriptors.                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821             }                                                                                            </span>
<span class="1894743204629618523" onmouseenter="enter('1894743204629618523');" onmouseout="out('1894743204629618523');" style=""> 822             for (int i = 0; i &lt; types.size(); i++) {                                                     </span>
<span class="-3358630307652497285" onmouseenter="enter('-3358630307652497285');" onmouseout="out('-3358630307652497285');" style=""> 823                 Log.i(TAG, String.format(&quot;Open %10s files: %4d total, %4d duplicates&quot;,                   </span>
<span class="-7057161233480916817" onmouseenter="enter('-7057161233480916817');" onmouseout="out('-7057161233480916817');" style=""> 824                         types.get(i), count[i], duplicates[i]));                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825             }                                                                                            </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 826         } catch (Throwable t) {                                                                          </span>
<span class="6465726010998958367" onmouseenter="enter('6465726010998958367');" onmouseout="out('6465726010998958367');" style=""> 827             // Catch everything. This is called from an exception handler that we shouldn&#x27;t upset.       </span>
<span class="-3798752040153960224" onmouseenter="enter('-3798752040153960224');" onmouseout="out('-3798752040153960224');" style=""> 828             Log.e(TAG, &quot;Unable to log open files.&quot;, t);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 831 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">   1  package com.android.launcher3;                                                                                    </span>
<span  style="">   2                                                                                                                    </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">   3  import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">   4  import android.content.ComponentName;                                                                             </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">   5  import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">   6  import android.content.Context;                                                                                   </span>
<span class="4122587240602557356" onmouseenter="enter('4122587240602557356');" onmouseout="out('4122587240602557356');" style="">   7  import android.content.SharedPreferences;                                                                         </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">   8  import android.content.pm.ResolveInfo;                                                                            </span>
<span class="7207138161133478555" onmouseenter="enter('7207138161133478555');" onmouseout="out('7207138161133478555');" style="">   9  import android.content.res.Resources;                                                                             </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  10  import android.database.Cursor;                                                                                   </span>
<span class="-8322188515935618338" onmouseenter="enter('-8322188515935618338');" onmouseout="out('-8322188515935618338');" style="">  11  import android.database.sqlite.SQLiteCantOpenDatabaseException;                                                   </span>
<span class="-4895155655276492102" onmouseenter="enter('-4895155655276492102');" onmouseout="out('-4895155655276492102');" style="">  12  import android.database.sqlite.SQLiteDatabase;                                                                    </span>
<span class="250544669864164636" onmouseenter="enter('250544669864164636');" onmouseout="out('250544669864164636');" style="">  13  import android.database.sqlite.SQLiteDiskIOException;                                                             </span>
<span class="6401548559697116088" onmouseenter="enter('6401548559697116088');" onmouseout="out('6401548559697116088');" style="">  14  import android.database.sqlite.SQLiteOpenHelper;                                                                  </span>
<span class="1099656306555592784" onmouseenter="enter('1099656306555592784');" onmouseout="out('1099656306555592784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  15 +import android.database.sqlite.SQLiteReadOnlyDatabaseException;                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  16  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5221619029963095423" onmouseenter="enter('-5221619029963095423');" onmouseout="out('-5221619029963095423');" style="">  17  import android.graphics.Bitmap.Config;                                                                            </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  18  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-8489723247854845487" onmouseenter="enter('-8489723247854845487');" onmouseout="out('-8489723247854845487');" style="">  19  import android.graphics.BitmapShader;                                                                             </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  20  import android.graphics.Canvas;                                                                                   </span>
<span class="1046407090334580529" onmouseenter="enter('1046407090334580529');" onmouseout="out('1046407090334580529');" style="">  21  import android.graphics.ColorMatrix;                                                                              </span>
<span class="-2638342757206578386" onmouseenter="enter('-2638342757206578386');" onmouseout="out('-2638342757206578386');" style="">  22  import android.graphics.ColorMatrixColorFilter;                                                                   </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  23  import android.graphics.Paint;                                                                                    </span>
<span class="7353926919338897104" onmouseenter="enter('7353926919338897104');" onmouseout="out('7353926919338897104');" style="">  24  import android.graphics.PorterDuff;                                                                               </span>
<span class="2207333516549486115" onmouseenter="enter('2207333516549486115');" onmouseout="out('2207333516549486115');" style="">  25  import android.graphics.Rect;                                                                                     </span>
<span class="-787513569742028665" onmouseenter="enter('-787513569742028665');" onmouseout="out('-787513569742028665');" style="">  26  import android.graphics.Shader;                                                                                   </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  27  import android.graphics.drawable.BitmapDrawable;                                                                  </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  28  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="955674827050616793" onmouseenter="enter('955674827050616793');" onmouseout="out('955674827050616793');" style="">  29  import android.os.AsyncTask;                                                                                      </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import android.os.Build;                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  31  import android.util.Log;                                                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -                                                                                                                  </span>
<span class="-2301578055393860706" onmouseenter="enter('-2301578055393860706');" onmouseout="out('-2301578055393860706');" style="">  33  import com.android.launcher3.compat.AppWidgetManagerCompat;                                                       </span>
<span  style="">  34                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  35  import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  36  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  37  import java.io.IOException;                                                                                       </span>
<span class="-9136849050553086203" onmouseenter="enter('-9136849050553086203');" onmouseout="out('-9136849050553086203');" style="">  38  import java.lang.ref.SoftReference;                                                                               </span>
<span class="-8692343821508153377" onmouseenter="enter('-8692343821508153377');" onmouseout="out('-8692343821508153377');" style="">  39  import java.lang.ref.WeakReference;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  40  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  41  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  42  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  43  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  44  import java.util.List;                                                                                            </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  45  import java.util.concurrent.Callable;                                                                             </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  46  import java.util.concurrent.ExecutionException;                                                                   </span>
<span  style="">  47                                                                                                                    </span>
<span class="-4311378840888985036" onmouseenter="enter('-4311378840888985036');" onmouseout="out('-4311378840888985036');" style="">  48  public class WidgetPreviewLoader {                                                                                </span>
<span  style="">  49                                                                                                                    </span>
<span class="-3230874476111875794" onmouseenter="enter('-3230874476111875794');" onmouseout="out('-3230874476111875794');" style="">  50      private static abstract class SoftReferenceThreadLocal&lt;T&gt; {                                                   </span>
<span class="144884583078774733" onmouseenter="enter('144884583078774733');" onmouseout="out('144884583078774733');" style="">  51          private ThreadLocal&lt;SoftReference&lt;T&gt;&gt; mThreadLocal;                                                       </span>
<span class="-4387433322567605136" onmouseenter="enter('-4387433322567605136');" onmouseout="out('-4387433322567605136');" style="">  52          public SoftReferenceThreadLocal() {                                                                       </span>
<span class="4702884186935866826" onmouseenter="enter('4702884186935866826');" onmouseout="out('4702884186935866826');" style="">  53              mThreadLocal = new ThreadLocal&lt;SoftReference&lt;T&gt;&gt;();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  54          }                                                                                                         </span>
<span  style="">  55                                                                                                                    </span>
<span class="7611856356089156666" onmouseenter="enter('7611856356089156666');" onmouseout="out('7611856356089156666');" style="">  56          abstract T initialValue();                                                                                </span>
<span  style="">  57                                                                                                                    </span>
<span class="-5049902553319226708" onmouseenter="enter('-5049902553319226708');" onmouseout="out('-5049902553319226708');" style="">  58          public void set(T t) {                                                                                    </span>
<span class="4998900635420746153" onmouseenter="enter('4998900635420746153');" onmouseout="out('4998900635420746153');" style="">  59              mThreadLocal.set(new SoftReference&lt;T&gt;(t));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60          }                                                                                                         </span>
<span  style="">  61                                                                                                                    </span>
<span class="-6159920038780308483" onmouseenter="enter('-6159920038780308483');" onmouseout="out('-6159920038780308483');" style="">  62          public T get() {                                                                                          </span>
<span class="-967899869235114258" onmouseenter="enter('-967899869235114258');" onmouseout="out('-967899869235114258');" style="">  63              SoftReference&lt;T&gt; reference = mThreadLocal.get();                                                      </span>
<span class="-6948245133825727275" onmouseenter="enter('-6948245133825727275');" onmouseout="out('-6948245133825727275');" style="">  64              T obj;                                                                                                </span>
<span class="-5692723719917447196" onmouseenter="enter('-5692723719917447196');" onmouseout="out('-5692723719917447196');" style="">  65              if (reference == null) {                                                                              </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  66                  obj = initialValue();                                                                             </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  67                  mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                                      </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  68                  return obj;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  69              } else {                                                                                              </span>
<span class="-2769798515494474030" onmouseenter="enter('-2769798515494474030');" onmouseout="out('-2769798515494474030');" style="">  70                  obj = reference.get();                                                                            </span>
<span class="9024370751945626489" onmouseenter="enter('9024370751945626489');" onmouseout="out('9024370751945626489');" style="">  71                  if (obj == null) {                                                                                </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  72                      obj = initialValue();                                                                         </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  73                      mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74                  }                                                                                                 </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  75                  return obj;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78      }                                                                                                             </span>
<span  style="">  79                                                                                                                    </span>
<span class="-5055153777344084118" onmouseenter="enter('-5055153777344084118');" onmouseout="out('-5055153777344084118');" style="">  80      private static class CanvasCache extends SoftReferenceThreadLocal&lt;Canvas&gt; {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81          @Override                                                                                                 </span>
<span class="-4761875685905818114" onmouseenter="enter('-4761875685905818114');" onmouseout="out('-4761875685905818114');" style="">  82          protected Canvas initialValue() {                                                                         </span>
<span class="-2278895108809265326" onmouseenter="enter('-2278895108809265326');" onmouseout="out('-2278895108809265326');" style="">  83              return new Canvas();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="-1261255052546611379" onmouseenter="enter('-1261255052546611379');" onmouseout="out('-1261255052546611379');" style="">  87      private static class PaintCache extends SoftReferenceThreadLocal&lt;Paint&gt; {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  88          @Override                                                                                                 </span>
<span class="5455192562670218369" onmouseenter="enter('5455192562670218369');" onmouseout="out('5455192562670218369');" style="">  89          protected Paint initialValue() {                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  90              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92      }                                                                                                             </span>
<span  style="">  93                                                                                                                    </span>
<span class="1990146601739059582" onmouseenter="enter('1990146601739059582');" onmouseout="out('1990146601739059582');" style="">  94      private static class BitmapCache extends SoftReferenceThreadLocal&lt;Bitmap&gt; {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95          @Override                                                                                                 </span>
<span class="5445413510754308036" onmouseenter="enter('5445413510754308036');" onmouseout="out('5445413510754308036');" style="">  96          protected Bitmap initialValue() {                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  97              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-4690039068512610596" onmouseenter="enter('-4690039068512610596');" onmouseout="out('-4690039068512610596');" style=""> 101      private static class RectCache extends SoftReferenceThreadLocal&lt;Rect&gt; {                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102          @Override                                                                                                 </span>
<span class="8484771223674222626" onmouseenter="enter('8484771223674222626');" onmouseout="out('8484771223674222626');" style=""> 103          protected Rect initialValue() {                                                                           </span>
<span class="3126951611359421696" onmouseenter="enter('3126951611359421696');" onmouseout="out('3126951611359421696');" style=""> 104              return new Rect();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-1412995145802516532" onmouseenter="enter('-1412995145802516532');" onmouseout="out('-1412995145802516532');" style=""> 108      private static class BitmapFactoryOptionsCache extends                                                        </span>
<span class="6571896484354186661" onmouseenter="enter('6571896484354186661');" onmouseout="out('6571896484354186661');" style=""> 109              SoftReferenceThreadLocal&lt;BitmapFactory.Options&gt; {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110          @Override                                                                                                 </span>
<span class="-8328117947754333521" onmouseenter="enter('-8328117947754333521');" onmouseout="out('-8328117947754333521');" style=""> 111          protected BitmapFactory.Options initialValue() {                                                          </span>
<span class="-4117267854178586248" onmouseenter="enter('-4117267854178586248');" onmouseout="out('-4117267854178586248');" style=""> 112              return new BitmapFactory.Options();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114      }                                                                                                             </span>
<span  style=""> 115                                                                                                                    </span>
<span class="2416799479879720027" onmouseenter="enter('2416799479879720027');" onmouseout="out('2416799479879720027');" style=""> 116      private static final String TAG = &quot;WidgetPreviewLoader&quot;;                                                      </span>
<span class="4075932221748513041" onmouseenter="enter('4075932221748513041');" onmouseout="out('4075932221748513041');" style=""> 117      private static final String ANDROID_INCREMENTAL_VERSION_NAME_KEY = &quot;android.incremental.version&quot;;             </span>
<span  style=""> 118                                                                                                                    </span>
<span class="7524285546086861850" onmouseenter="enter('7524285546086861850');" onmouseout="out('7524285546086861850');" style=""> 119      private static final float WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE = 0.25f;                                    </span>
<span class="1902323072201125531" onmouseenter="enter('1902323072201125531');" onmouseout="out('1902323072201125531');" style=""> 120      private static final HashSet&lt;String&gt; sInvalidPackages = new HashSet&lt;String&gt;();                                </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 122      // Used for drawing shortcut previews                                                                         </span>
<span class="333450150533861200" onmouseenter="enter('333450150533861200');" onmouseout="out('333450150533861200');" style=""> 123      private final BitmapCache mCachedShortcutPreviewBitmap = new BitmapCache();                                   </span>
<span class="6665675930715155383" onmouseenter="enter('6665675930715155383');" onmouseout="out('6665675930715155383');" style=""> 124      private final PaintCache mCachedShortcutPreviewPaint = new PaintCache();                                      </span>
<span class="1096761732692819631" onmouseenter="enter('1096761732692819631');" onmouseout="out('1096761732692819631');" style=""> 125      private final CanvasCache mCachedShortcutPreviewCanvas = new CanvasCache();                                   </span>
<span  style=""> 126                                                                                                                    </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 127      // Used for drawing widget previews                                                                           </span>
<span class="-3956456794742254913" onmouseenter="enter('-3956456794742254913');" onmouseout="out('-3956456794742254913');" style=""> 128      private final CanvasCache mCachedAppWidgetPreviewCanvas = new CanvasCache();                                  </span>
<span class="2994302144561928781" onmouseenter="enter('2994302144561928781');" onmouseout="out('2994302144561928781');" style=""> 129      private final RectCache mCachedAppWidgetPreviewSrcRect = new RectCache();                                     </span>
<span class="-2432735040368044940" onmouseenter="enter('-2432735040368044940');" onmouseout="out('-2432735040368044940');" style=""> 130      private final RectCache mCachedAppWidgetPreviewDestRect = new RectCache();                                    </span>
<span class="-1839110596677388209" onmouseenter="enter('-1839110596677388209');" onmouseout="out('-1839110596677388209');" style=""> 131      private final PaintCache mCachedAppWidgetPreviewPaint = new PaintCache();                                     </span>
<span class="4215417609313429507" onmouseenter="enter('4215417609313429507');" onmouseout="out('4215417609313429507');" style=""> 132      private final PaintCache mDefaultAppWidgetPreviewPaint = new PaintCache();                                    </span>
<span class="7799865446872866624" onmouseenter="enter('7799865446872866624');" onmouseout="out('7799865446872866624');" style=""> 133      private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache();        </span>
<span  style=""> 134                                                                                                                    </span>
<span class="6069704076318384736" onmouseenter="enter('6069704076318384736');" onmouseout="out('6069704076318384736');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -    private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;&gt;();                       </span>
<span class="4704413017067310429" onmouseenter="enter('4704413017067310429');" onmouseout="out('4704413017067310429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -    private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;&gt;();                            </span>
<span class="4097431862822690335" onmouseenter="enter('4097431862822690335');" onmouseout="out('4097431862822690335');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 137 +    private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt;();"> 137 +    private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;String, WeakReference&lt;BitmaðŸ”µ</abbr></span>
<span class="-7580346379503623190" onmouseenter="enter('-7580346379503623190');" onmouseout="out('-7580346379503623190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +    private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt;();       </span>
<span  style=""> 139                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 140      private final Context mContext;                                                                               </span>
<span class="-7489384078469018359" onmouseenter="enter('-7489384078469018359');" onmouseout="out('-7489384078469018359');" style=""> 141      private final int mAppIconSize;                                                                               </span>
<span class="2729881913605020060" onmouseenter="enter('2729881913605020060');" onmouseout="out('2729881913605020060');" style=""> 142      private final IconCache mIconCache;                                                                           </span>
<span class="9150498506085829362" onmouseenter="enter('9150498506085829362');" onmouseout="out('9150498506085829362');" style=""> 143      private final AppWidgetManagerCompat mManager;                                                                </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-8162128579730225382" onmouseenter="enter('-8162128579730225382');" onmouseout="out('-8162128579730225382');" style=""> 145      private int mPreviewBitmapWidth;                                                                              </span>
<span class="4768970035560221699" onmouseenter="enter('4768970035560221699');" onmouseout="out('4768970035560221699');" style=""> 146      private int mPreviewBitmapHeight;                                                                             </span>
<span class="-2278862546333248339" onmouseenter="enter('-2278862546333248339');" onmouseout="out('-2278862546333248339');" style=""> 147      private String mSize;                                                                                         </span>
<span class="-4195956876020483478" onmouseenter="enter('-4195956876020483478');" onmouseout="out('-4195956876020483478');" style=""> 148      private PagedViewCellLayout mWidgetSpacingLayout;                                                             </span>
<span  style=""> 149                                                                                                                    </span>
<span class="-7229982499992821578" onmouseenter="enter('-7229982499992821578');" onmouseout="out('-7229982499992821578');" style=""> 150      private String mCachedSelectQuery;                                                                            </span>
<span  style=""> 151                                                                                                                    </span>
<span  style=""> 152                                                                                                                    </span>
<span class="6719315262198447761" onmouseenter="enter('6719315262198447761');" onmouseout="out('6719315262198447761');" style=""> 153      private CacheDb mDb;                                                                                          </span>
<span  style=""> 154                                                                                                                    </span>
<span class="140559351311799615" onmouseenter="enter('140559351311799615');" onmouseout="out('140559351311799615');" style=""> 155      private final MainThreadExecutor mMainThreadExecutor = new MainThreadExecutor();                              </span>
<span  style=""> 156                                                                                                                    </span>
<span class="-5828204717811548952" onmouseenter="enter('-5828204717811548952');" onmouseout="out('-5828204717811548952');" style=""> 157      public WidgetPreviewLoader(Context context) {                                                                 </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 158          LauncherAppState app = LauncherAppState.getInstance();                                                    </span>
<span class="-6320967880672955396" onmouseenter="enter('-6320967880672955396');" onmouseout="out('-6320967880672955396');" style=""> 159          DeviceProfile grid = app.getDynamicGrid().getDeviceProfile();                                             </span>
<span  style=""> 160                                                                                                                    </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 161          mContext = context;                                                                                       </span>
<span class="3163588368111647063" onmouseenter="enter('3163588368111647063');" onmouseout="out('3163588368111647063');" style=""> 162          mAppIconSize = grid.iconSizePx;                                                                           </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 163          mIconCache = app.getIconCache();                                                                          </span>
<span class="3481132346717467494" onmouseenter="enter('3481132346717467494');" onmouseout="out('3481132346717467494');" style=""> 164          mManager = AppWidgetManagerCompat.getInstance(context);                                                   </span>
<span  style=""> 165                                                                                                                    </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 166          mDb = app.getWidgetPreviewCacheDb();                                                                      </span>
<span  style=""> 167                                                                                                                    </span>
<span class="2019816042868645703" onmouseenter="enter('2019816042868645703');" onmouseout="out('2019816042868645703');" style=""> 168          SharedPreferences sp = context.getSharedPreferences(                                                      </span>
<span class="-3012020800644432647" onmouseenter="enter('-3012020800644432647');" onmouseout="out('-3012020800644432647');" style=""> 169                  LauncherAppState.getSharedPreferencesKey(), Context.MODE_PRIVATE);                                </span>
<span class="7599352561706696094" onmouseenter="enter('7599352561706696094');" onmouseout="out('7599352561706696094');" style=""> 170          final String lastVersionName = sp.getString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, null);                  </span>
<span class="-8837714544016106839" onmouseenter="enter('-8837714544016106839');" onmouseout="out('-8837714544016106839');" style=""> 171          final String versionName = android.os.Build.VERSION.INCREMENTAL;                                          </span>
<span class="-6804745435332338014" onmouseenter="enter('-6804745435332338014');" onmouseout="out('-6804745435332338014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +        final boolean isLollipop = Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP;                         </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style=""> 173          if (!versionName.equals(lastVersionName)) {                                                               </span>
<span class="4086555010887297457" onmouseenter="enter('4086555010887297457');" onmouseout="out('4086555010887297457');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -            // clear all the previews whenever the system version changes, to ensure that previews                </span>
<span class="-6776657436582370181" onmouseenter="enter('-6776657436582370181');" onmouseout="out('-6776657436582370181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -            // are up-to-date for any apps that might have been updated with the system                           </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -            clearDb();                                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -                                                                                                                  </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -            SharedPreferences.Editor editor = sp.edit();                                                          </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -            editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                                  </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -            editor.commit();                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +            try {                                                                                                 </span>
<span class="-1043062607084730911" onmouseenter="enter('-1043062607084730911');" onmouseout="out('-1043062607084730911');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +                // clear all the previews whenever the system version changes, to ensure that                     </span>
<span class="-3090272541711713949" onmouseenter="enter('-3090272541711713949');" onmouseout="out('-3090272541711713949');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +                // previews are up-to-date for any apps that might have been updated with the system              </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                clearDb();                                                                                        </span>
<span class="-1695662722736394565" onmouseenter="enter('-1695662722736394565');" onmouseout="out('-1695662722736394565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +            } catch (SQLiteReadOnlyDatabaseException e) {                                                         </span>
<span class="4319884442435447688" onmouseenter="enter('4319884442435447688');" onmouseout="out('4319884442435447688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                if (isLollipop) {                                                                                 </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                    // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only              </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                    // issue, then ignore this error and leave the old previews                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                } else {                                                                                          </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                    throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                }                                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +            } catch (Exception e) {                                                                               </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                throw e;                                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +            } finally {                                                                                           </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                SharedPreferences.Editor editor = sp.edit();                                                      </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +                editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                              </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +                editor.commit();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200      }                                                                                                             </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style=""> 202      public void recreateDb() {                                                                                    </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 203          LauncherAppState app = LauncherAppState.getInstance();                                                    </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style=""> 204          app.recreateWidgetPreviewDb();                                                                            </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 205          mDb = app.getWidgetPreviewCacheDb();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206      }                                                                                                             </span>
<span  style=""> 207                                                                                                                    </span>
<span class="1041361483340123386" onmouseenter="enter('1041361483340123386');" onmouseout="out('1041361483340123386');" style=""> 208      public void setPreviewSize(int previewWidth, int previewHeight,                                               </span>
<span class="-864889589589090056" onmouseenter="enter('-864889589589090056');" onmouseout="out('-864889589589090056');" style=""> 209              PagedViewCellLayout widgetSpacingLayout) {                                                            </span>
<span class="7215920596152382710" onmouseenter="enter('7215920596152382710');" onmouseout="out('7215920596152382710');" style=""> 210          mPreviewBitmapWidth = previewWidth;                                                                       </span>
<span class="-1710948131163314144" onmouseenter="enter('-1710948131163314144');" onmouseout="out('-1710948131163314144');" style=""> 211          mPreviewBitmapHeight = previewHeight;                                                                     </span>
<span class="-2589016613696609257" onmouseenter="enter('-2589016613696609257');" onmouseout="out('-2589016613696609257');" style=""> 212          mSize = previewWidth + &quot;x&quot; + previewHeight;                                                               </span>
<span class="-2003385001531882656" onmouseenter="enter('-2003385001531882656');" onmouseout="out('-2003385001531882656');" style=""> 213          mWidgetSpacingLayout = widgetSpacingLayout;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214      }                                                                                                             </span>
<span  style=""> 215                                                                                                                    </span>
<span class="9100103105710524909" onmouseenter="enter('9100103105710524909');" onmouseout="out('9100103105710524909');" style=""> 216      public Bitmap getPreview(final Object o) {                                                                    </span>
<span class="7210064752111263529" onmouseenter="enter('7210064752111263529');" onmouseout="out('7210064752111263529');" style=""> 217          final String name = getObjectName(o);                                                                     </span>
<span class="-4502422735439147840" onmouseenter="enter('-4502422735439147840');" onmouseout="out('-4502422735439147840');" style=""> 218          final String packageName = getObjectPackage(o);                                                           </span>
<span class="6483702398021407461" onmouseenter="enter('6483702398021407461');" onmouseout="out('6483702398021407461');" style=""> 219          // check if the package is valid                                                                          </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 220          synchronized(sInvalidPackages) {                                                                          </span>
<span class="6205084711389939864" onmouseenter="enter('6205084711389939864');" onmouseout="out('6205084711389939864');" style=""> 221              boolean packageValid = !sInvalidPackages.contains(packageName);                                       </span>
<span class="5936168059174575986" onmouseenter="enter('5936168059174575986');" onmouseout="out('5936168059174575986');" style=""> 222              if (!packageValid) {                                                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 223                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225          }                                                                                                         </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 226          synchronized(mLoadedPreviews) {                                                                           </span>
<span class="-7479974433139738260" onmouseenter="enter('-7479974433139738260');" onmouseout="out('-7479974433139738260');" style=""> 227              // check if it exists in our existing cache                                                           </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 228              if (mLoadedPreviews.containsKey(name)) {                                                              </span>
<span class="-5798374742760410220" onmouseenter="enter('-5798374742760410220');" onmouseout="out('-5798374742760410220');" style=""> 229                  WeakReference&lt;Bitmap&gt; bitmapReference = mLoadedPreviews.get(name);                                </span>
<span class="-5072696511706589798" onmouseenter="enter('-5072696511706589798');" onmouseout="out('-5072696511706589798');" style=""> 230                  Bitmap bitmap = bitmapReference.get();                                                            </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 231                  if (bitmap != null) {                                                                             </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style=""> 232                      return bitmap;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span  style=""> 236                                                                                                                    </span>
<span class="-1660586751969869388" onmouseenter="enter('-1660586751969869388');" onmouseout="out('-1660586751969869388');" style=""> 237          Bitmap unusedBitmap = null;                                                                               </span>
<span class="7613513134986517501" onmouseenter="enter('7613513134986517501');" onmouseout="out('7613513134986517501');" style=""> 238          synchronized(mUnusedBitmaps) {                                                                            </span>
<span class="134332774856407035" onmouseenter="enter('134332774856407035');" onmouseout="out('134332774856407035');" style=""> 239              // not in cache; we need to load it from the db                                                       </span>
<span class="1411220366891100168" onmouseenter="enter('1411220366891100168');" onmouseout="out('1411220366891100168');" style=""> 240              while (unusedBitmap == null &amp;&amp; mUnusedBitmaps.size() &gt; 0) {                                           </span>
<span class="3514361872991648197" onmouseenter="enter('3514361872991648197');" onmouseout="out('3514361872991648197');" style=""> 241                  Bitmap candidate = mUnusedBitmaps.remove(0).get();                                                </span>
<span class="-3857479151276842222" onmouseenter="enter('-3857479151276842222');" onmouseout="out('-3857479151276842222');" style=""> 242                  if (candidate != null &amp;&amp; candidate.isMutable() &amp;&amp;                                                 </span>
<span class="-7425312185904228324" onmouseenter="enter('-7425312185904228324');" onmouseout="out('-7425312185904228324');" style=""> 243                          candidate.getWidth() == mPreviewBitmapWidth &amp;&amp;                                            </span>
<span class="-897867530819106482" onmouseenter="enter('-897867530819106482');" onmouseout="out('-897867530819106482');" style=""> 244                          candidate.getHeight() == mPreviewBitmapHeight) {                                          </span>
<span class="-7974711513755834014" onmouseenter="enter('-7974711513755834014');" onmouseout="out('-7974711513755834014');" style=""> 245                      unusedBitmap = candidate;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247              }                                                                                                     </span>
<span class="-1806752935370283796" onmouseenter="enter('-1806752935370283796');" onmouseout="out('-1806752935370283796');" style=""> 248              if (unusedBitmap != null) {                                                                           </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 249                  final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                             </span>
<span class="-7568013336659090919" onmouseenter="enter('-7568013336659090919');" onmouseout="out('-7568013336659090919');" style=""> 250                  c.setBitmap(unusedBitmap);                                                                        </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 251                  c.drawColor(0, PorterDuff.Mode.CLEAR);                                                            </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 252                  c.setBitmap(null);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254          }                                                                                                         </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-7521323678416918441" onmouseenter="enter('-7521323678416918441');" onmouseout="out('-7521323678416918441');" style=""> 256          if (unusedBitmap == null) {                                                                               </span>
<span class="-3551833031540614706" onmouseenter="enter('-3551833031540614706');" onmouseout="out('-3551833031540614706');" style=""> 257              unusedBitmap = Bitmap.createBitmap(mPreviewBitmapWidth, mPreviewBitmapHeight,                         </span>
<span class="273441602049516461" onmouseenter="enter('273441602049516461');" onmouseout="out('273441602049516461');" style=""> 258                      Bitmap.Config.ARGB_8888);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259          }                                                                                                         </span>
<span class="-8985062989738227550" onmouseenter="enter('-8985062989738227550');" onmouseout="out('-8985062989738227550');" style=""> 260          Bitmap preview = readFromDb(name, unusedBitmap);                                                          </span>
<span  style=""> 261                                                                                                                    </span>
<span class="-760731434728754948" onmouseenter="enter('-760731434728754948');" onmouseout="out('-760731434728754948');" style=""> 262          if (preview != null) {                                                                                    </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 263              synchronized(mLoadedPreviews) {                                                                       </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 264                  mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265              }                                                                                                     </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 266              return preview;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 267          } else {                                                                                                  </span>
<span class="3460679213489770567" onmouseenter="enter('3460679213489770567');" onmouseout="out('3460679213489770567');" style=""> 268              // it&#x27;s not in the db... we need to generate it                                                       </span>
<span class="7452120778445413168" onmouseenter="enter('7452120778445413168');" onmouseout="out('7452120778445413168');" style=""> 269              final Bitmap generatedPreview = generatePreview(o, unusedBitmap);                                     </span>
<span class="-4291180510938406114" onmouseenter="enter('-4291180510938406114');" onmouseout="out('-4291180510938406114');" style=""> 270              preview = generatedPreview;                                                                           </span>
<span class="7396852523530524307" onmouseenter="enter('7396852523530524307');" onmouseout="out('7396852523530524307');" style=""> 271              if (preview != unusedBitmap) {                                                                        </span>
<span class="-7211694849959051791" onmouseenter="enter('-7211694849959051791');" onmouseout="out('-7211694849959051791');" style=""> 272                  throw new RuntimeException(&quot;generatePreview is not recycling the bitmap &quot; + o);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273              }                                                                                                     </span>
<span  style=""> 274                                                                                                                    </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 275              synchronized(mLoadedPreviews) {                                                                       </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 276                  mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277              }                                                                                                     </span>
<span  style=""> 278                                                                                                                    </span>
<span class="-5733309973697321639" onmouseenter="enter('-5733309973697321639');" onmouseout="out('-5733309973697321639');" style=""> 279              // write to db on a thread pool... this can be done lazily and improves the performance               </span>
<span class="-8551030995294829944" onmouseenter="enter('-8551030995294829944');" onmouseout="out('-8551030995294829944');" style=""> 280              // of the first time widget previews are loaded                                                       </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 281              new AsyncTask&lt;Void, Void, Void&gt;() {                                                                   </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 282                  public Void doInBackground(Void ... args) {                                                       </span>
<span class="5794871779597006615" onmouseenter="enter('5794871779597006615');" onmouseout="out('5794871779597006615');" style=""> 283                      writeToDb(o, generatedPreview);                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 284                      return null;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285                  }                                                                                                 </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 286              }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                     </span>
<span  style=""> 287                                                                                                                    </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 288              return preview;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290      }                                                                                                             </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-2058417025959444842" onmouseenter="enter('-2058417025959444842');" onmouseout="out('-2058417025959444842');" style=""> 292      public void recycleBitmap(Object o, Bitmap bitmapToRecycle) {                                                 </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 293          String name = getObjectName(o);                                                                           </span>
<span class="-4798838159901813780" onmouseenter="enter('-4798838159901813780');" onmouseout="out('-4798838159901813780');" style=""> 294          synchronized (mLoadedPreviews) {                                                                          </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 295              if (mLoadedPreviews.containsKey(name)) {                                                              </span>
<span class="5945201469012860218" onmouseenter="enter('5945201469012860218');" onmouseout="out('5945201469012860218');" style=""> 296                  Bitmap b = mLoadedPreviews.get(name).get();                                                       </span>
<span class="9172312796342865011" onmouseenter="enter('9172312796342865011');" onmouseout="out('9172312796342865011');" style=""> 297                  if (b == bitmapToRecycle) {                                                                       </span>
<span class="-3845835638768486269" onmouseenter="enter('-3845835638768486269');" onmouseout="out('-3845835638768486269');" style=""> 298                      mLoadedPreviews.remove(name);                                                                 </span>
<span class="1962405822662822843" onmouseenter="enter('1962405822662822843');" onmouseout="out('1962405822662822843');" style=""> 299                      if (bitmapToRecycle.isMutable()) {                                                            </span>
<span class="732538049861401327" onmouseenter="enter('732538049861401327');" onmouseout="out('732538049861401327');" style=""> 300                          synchronized (mUnusedBitmaps) {                                                           </span>
<span class="7654440137511857398" onmouseenter="enter('7654440137511857398');" onmouseout="out('7654440137511857398');" style=""> 301                              mUnusedBitmaps.add(new SoftReference&lt;Bitmap&gt;(b));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 304                  } else {                                                                                          </span>
<span class="-7483999424756026389" onmouseenter="enter('-7483999424756026389');" onmouseout="out('-7483999424756026389');" style=""> 305                      throw new RuntimeException(&quot;Bitmap passed in doesn&#x27;t match up&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309      }                                                                                                             </span>
<span  style=""> 310                                                                                                                    </span>
<span class="-6828234266968088645" onmouseenter="enter('-6828234266968088645');" onmouseout="out('-6828234266968088645');" style=""> 311      static class CacheDb extends SQLiteOpenHelper {                                                               </span>
<span class="-2905037825538645689" onmouseenter="enter('-2905037825538645689');" onmouseout="out('-2905037825538645689');" style=""> 312          final static int DB_VERSION = 2;                                                                          </span>
<span class="3671038644302744996" onmouseenter="enter('3671038644302744996');" onmouseout="out('3671038644302744996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -        final static String DB_NAME = &quot;widgetpreviews.db&quot;;                                                        </span>
<span class="-4997316780024779267" onmouseenter="enter('-4997316780024779267');" onmouseout="out('-4997316780024779267');" style=""> 314          final static String TABLE_NAME = &quot;shortcut_and_widget_previews&quot;;                                          </span>
<span class="-5742805130150616813" onmouseenter="enter('-5742805130150616813');" onmouseout="out('-5742805130150616813');" style=""> 315          final static String COLUMN_NAME = &quot;name&quot;;                                                                 </span>
<span class="8854376481192602334" onmouseenter="enter('8854376481192602334');" onmouseout="out('8854376481192602334');" style=""> 316          final static String COLUMN_SIZE = &quot;size&quot;;                                                                 </span>
<span class="6902810344350480074" onmouseenter="enter('6902810344350480074');" onmouseout="out('6902810344350480074');" style=""> 317          final static String COLUMN_PREVIEW_BITMAP = &quot;preview_bitmap&quot;;                                             </span>
<span class="-5996057254067063760" onmouseenter="enter('-5996057254067063760');" onmouseout="out('-5996057254067063760');" style=""> 318          Context mContext;                                                                                         </span>
<span  style=""> 319                                                                                                                    </span>
<span class="-1572964554793598477" onmouseenter="enter('-1572964554793598477');" onmouseout="out('-1572964554793598477');" style=""> 320          public CacheDb(Context context) {                                                                         </span>
<span class="1204687355095372073" onmouseenter="enter('1204687355095372073');" onmouseout="out('1204687355095372073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 321 -            super(context, new File(context.getCacheDir(), DB_NAME).getPath(), null, DB_VERSION);                 </span>
<span class="-495189310641001393" onmouseenter="enter('-495189310641001393');" onmouseout="out('-495189310641001393');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +            super(context, new File(context.getCacheDir(),                                                        </span>
<span class="-4377620877094923072" onmouseenter="enter('-4377620877094923072');" onmouseout="out('-4377620877094923072');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +                    LauncherFiles.WIDGET_PREVIEWS_DB).getPath(), null, DB_VERSION);                               </span>
<span class="-5483301966583099443" onmouseenter="enter('-5483301966583099443');" onmouseout="out('-5483301966583099443');" style=""> 324              // Store the context for later use                                                                    </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 325              mContext = context;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326          }                                                                                                         </span>
<span  style=""> 327                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 328          @Override                                                                                                 </span>
<span class="-3622240674415739784" onmouseenter="enter('-3622240674415739784');" onmouseout="out('-3622240674415739784');" style=""> 329          public void onCreate(SQLiteDatabase database) {                                                           </span>
<span class="-5851870806192660982" onmouseenter="enter('-5851870806192660982');" onmouseout="out('-5851870806192660982');" style=""> 330              database.execSQL(&quot;CREATE TABLE IF NOT EXISTS &quot; + TABLE_NAME + &quot; (&quot; +                                  </span>
<span class="-4480150272515057846" onmouseenter="enter('-4480150272515057846');" onmouseout="out('-4480150272515057846');" style=""> 331                      COLUMN_NAME + &quot; TEXT NOT NULL, &quot; +                                                            </span>
<span class="9221020696116426890" onmouseenter="enter('9221020696116426890');" onmouseout="out('9221020696116426890');" style=""> 332                      COLUMN_SIZE + &quot; TEXT NOT NULL, &quot; +                                                            </span>
<span class="-4320278434100102649" onmouseenter="enter('-4320278434100102649');" onmouseout="out('-4320278434100102649');" style=""> 333                      COLUMN_PREVIEW_BITMAP + &quot; BLOB NOT NULL, &quot; +                                                  </span>
<span class="2330812204177674799" onmouseenter="enter('2330812204177674799');" onmouseout="out('2330812204177674799');" style=""> 334                      &quot;PRIMARY KEY (&quot; + COLUMN_NAME + &quot;, &quot; + COLUMN_SIZE + &quot;) &quot; +                                   </span>
<span class="4525293784515244604" onmouseenter="enter('4525293784515244604');" onmouseout="out('4525293784515244604');" style=""> 335                      &quot;);&quot;);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336          }                                                                                                         </span>
<span  style=""> 337                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 338          @Override                                                                                                 </span>
<span class="-4655538025867202729" onmouseenter="enter('-4655538025867202729');" onmouseout="out('-4655538025867202729');" style=""> 339          public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {                                </span>
<span class="4248187026734735411" onmouseenter="enter('4248187026734735411');" onmouseout="out('4248187026734735411');" style=""> 340              if (oldVersion != newVersion) {                                                                       </span>
<span class="4606527396647857067" onmouseenter="enter('4606527396647857067');" onmouseout="out('4606527396647857067');" style=""> 341                  // Delete all the records; they&#x27;ll be repopulated as this is a cache                              </span>
<span class="3312906466801577184" onmouseenter="enter('3312906466801577184');" onmouseout="out('3312906466801577184');" style=""> 342                  db.execSQL(&quot;DELETE FROM &quot; + TABLE_NAME);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345      }                                                                                                             </span>
<span  style=""> 346                                                                                                                    </span>
<span class="4811926455019388037" onmouseenter="enter('4811926455019388037');" onmouseout="out('4811926455019388037');" style=""> 347      private static final String WIDGET_PREFIX = &quot;Widget:&quot;;                                                        </span>
<span class="7268385195460645965" onmouseenter="enter('7268385195460645965');" onmouseout="out('7268385195460645965');" style=""> 348      private static final String SHORTCUT_PREFIX = &quot;Shortcut:&quot;;                                                    </span>
<span  style=""> 349                                                                                                                    </span>
<span class="2901805684811435457" onmouseenter="enter('2901805684811435457');" onmouseout="out('2901805684811435457');" style=""> 350      private static String getObjectName(Object o) {                                                               </span>
<span class="5690762498529732972" onmouseenter="enter('5690762498529732972');" onmouseout="out('5690762498529732972');" style=""> 351          // should cache the string builder                                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 352          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="2095302661605249065" onmouseenter="enter('2095302661605249065');" onmouseout="out('2095302661605249065');" style=""> 353          String output;                                                                                            </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 354          if (o instanceof AppWidgetProviderInfo) {                                                                 </span>
<span class="-8383311757247800402" onmouseenter="enter('-8383311757247800402');" onmouseout="out('-8383311757247800402');" style=""> 355              sb.append(WIDGET_PREFIX);                                                                             </span>
<span class="594215244520332131" onmouseenter="enter('594215244520332131');" onmouseout="out('594215244520332131');" style=""> 356              sb.append(((AppWidgetProviderInfo) o).toString());                                                    </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 357              output = sb.toString();                                                                               </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 358              sb.setLength(0);                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 359          } else {                                                                                                  </span>
<span class="5925999772645605802" onmouseenter="enter('5925999772645605802');" onmouseout="out('5925999772645605802');" style=""> 360              sb.append(SHORTCUT_PREFIX);                                                                           </span>
<span  style=""> 361                                                                                                                    </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 362              ResolveInfo info = (ResolveInfo) o;                                                                   </span>
<span class="8259534413479453259" onmouseenter="enter('8259534413479453259');" onmouseout="out('8259534413479453259');" style=""> 363              sb.append(new ComponentName(info.activityInfo.packageName,                                            </span>
<span class="-4000685798969561860" onmouseenter="enter('-4000685798969561860');" onmouseout="out('-4000685798969561860');" style=""> 364                      info.activityInfo.name).flattenToString());                                                   </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 365              output = sb.toString();                                                                               </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 366              sb.setLength(0);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367          }                                                                                                         </span>
<span class="3622623857335300211" onmouseenter="enter('3622623857335300211');" onmouseout="out('3622623857335300211');" style=""> 368          return output;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369      }                                                                                                             </span>
<span  style=""> 370                                                                                                                    </span>
<span class="4198392565151889664" onmouseenter="enter('4198392565151889664');" onmouseout="out('4198392565151889664');" style=""> 371      private String getObjectPackage(Object o) {                                                                   </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 372          if (o instanceof AppWidgetProviderInfo) {                                                                 </span>
<span class="-447589032913714129" onmouseenter="enter('-447589032913714129');" onmouseout="out('-447589032913714129');" style=""> 373              return ((AppWidgetProviderInfo) o).provider.getPackageName();                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 374          } else {                                                                                                  </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 375              ResolveInfo info = (ResolveInfo) o;                                                                   </span>
<span class="-2114723670528030181" onmouseenter="enter('-2114723670528030181');" onmouseout="out('-2114723670528030181');" style=""> 376              return info.activityInfo.packageName;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378      }                                                                                                             </span>
<span  style=""> 379                                                                                                                    </span>
<span class="8368345736666686335" onmouseenter="enter('8368345736666686335');" onmouseout="out('8368345736666686335');" style=""> 380      private void writeToDb(Object o, Bitmap preview) {                                                            </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 381          String name = getObjectName(o);                                                                           </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 382          SQLiteDatabase db = mDb.getWritableDatabase();                                                            </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 383          ContentValues values = new ContentValues();                                                               </span>
<span  style=""> 384                                                                                                                    </span>
<span class="-3178925289150814226" onmouseenter="enter('-3178925289150814226');" onmouseout="out('-3178925289150814226');" style=""> 385          values.put(CacheDb.COLUMN_NAME, name);                                                                    </span>
<span class="3456914836247516446" onmouseenter="enter('3456914836247516446');" onmouseout="out('3456914836247516446');" style=""> 386          ByteArrayOutputStream stream = new ByteArrayOutputStream();                                               </span>
<span class="5496434693797867526" onmouseenter="enter('5496434693797867526');" onmouseout="out('5496434693797867526');" style=""> 387          preview.compress(Bitmap.CompressFormat.PNG, 100, stream);                                                 </span>
<span class="9194176376821213638" onmouseenter="enter('9194176376821213638');" onmouseout="out('9194176376821213638');" style=""> 388          values.put(CacheDb.COLUMN_PREVIEW_BITMAP, stream.toByteArray());                                          </span>
<span class="5882768875063958466" onmouseenter="enter('5882768875063958466');" onmouseout="out('5882768875063958466');" style=""> 389          values.put(CacheDb.COLUMN_SIZE, mSize);                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 390          try {                                                                                                     </span>
<span class="3018412397769192796" onmouseenter="enter('3018412397769192796');" onmouseout="out('3018412397769192796');" style=""> 391              db.insert(CacheDb.TABLE_NAME, null, values);                                                          </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 392          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 393              recreateDb();                                                                                         </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 394          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 395              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 396              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398      }                                                                                                             </span>
<span  style=""> 399                                                                                                                    </span>
<span class="8392297522310828664" onmouseenter="enter('8392297522310828664');" onmouseout="out('8392297522310828664');" style=""> 400      private void clearDb() {                                                                                      </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 401          SQLiteDatabase db = mDb.getWritableDatabase();                                                            </span>
<span class="904405929570850953" onmouseenter="enter('904405929570850953');" onmouseout="out('904405929570850953');" style=""> 402          // Delete everything                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 403          try {                                                                                                     </span>
<span class="3968467922888620985" onmouseenter="enter('3968467922888620985');" onmouseout="out('3968467922888620985');" style=""> 404              db.delete(CacheDb.TABLE_NAME, null, null);                                                            </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 405          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 406          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 407              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 408              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410      }                                                                                                             </span>
<span  style=""> 411                                                                                                                    </span>
<span class="-8805069561924159073" onmouseenter="enter('-8805069561924159073');" onmouseout="out('-8805069561924159073');" style=""> 412      public static void removePackageFromDb(final CacheDb cacheDb, final String packageName) {                     </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 413          synchronized(sInvalidPackages) {                                                                          </span>
<span class="-5575213275928168943" onmouseenter="enter('-5575213275928168943');" onmouseout="out('-5575213275928168943');" style=""> 414              sInvalidPackages.add(packageName);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415          }                                                                                                         </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 416          new AsyncTask&lt;Void, Void, Void&gt;() {                                                                       </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 417              public Void doInBackground(Void ... args) {                                                           </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 418                  SQLiteDatabase db = cacheDb.getWritableDatabase();                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 419                  try {                                                                                             </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 420                      db.delete(CacheDb.TABLE_NAME,                                                                 </span>
<span class="7113429213384324763" onmouseenter="enter('7113429213384324763');" onmouseout="out('7113429213384324763');" style=""> 421                              CacheDb.COLUMN_NAME + &quot; LIKE ? OR &quot; +                                                 </span>
<span class="8833124058792802926" onmouseenter="enter('8833124058792802926');" onmouseout="out('8833124058792802926');" style=""> 422                              CacheDb.COLUMN_NAME + &quot; LIKE ?&quot;, // SELECT query                                      </span>
<span class="6575814019251974640" onmouseenter="enter('6575814019251974640');" onmouseout="out('6575814019251974640');" style=""> 423                              new String[] {                                                                        </span>
<span class="-1005195456334514714" onmouseenter="enter('-1005195456334514714');" onmouseout="out('-1005195456334514714');" style=""> 424                                      WIDGET_PREFIX + packageName + &quot;/%&quot;,                                           </span>
<span class="7638587366414932409" onmouseenter="enter('7638587366414932409');" onmouseout="out('7638587366414932409');" style=""> 425                                      SHORTCUT_PREFIX + packageName + &quot;/%&quot;                                          </span>
<span class="6370673901196405011" onmouseenter="enter('6370673901196405011');" onmouseout="out('6370673901196405011');" style=""> 426                              } // args to SELECT query                                                             </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 427                      );                                                                                            </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 428                  } catch (SQLiteDiskIOException e) {                                                               </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 429                  } catch (SQLiteCantOpenDatabaseException e) {                                                     </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 430                      dumpOpenFiles();                                                                              </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 431                      throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432                  }                                                                                                 </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 433                  synchronized(sInvalidPackages) {                                                                  </span>
<span class="683140179110979858" onmouseenter="enter('683140179110979858');" onmouseout="out('683140179110979858');" style=""> 434                      sInvalidPackages.remove(packageName);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                  }                                                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 436                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437              }                                                                                                     </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 438          }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439      }                                                                                                             </span>
<span  style=""> 440                                                                                                                    </span>
<span class="-429228780021119422" onmouseenter="enter('-429228780021119422');" onmouseout="out('-429228780021119422');" style=""> 441      private static void removeItemFromDb(final CacheDb cacheDb, final String objectName) {                        </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 442          new AsyncTask&lt;Void, Void, Void&gt;() {                                                                       </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 443              public Void doInBackground(Void ... args) {                                                           </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 444                  SQLiteDatabase db = cacheDb.getWritableDatabase();                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 445                  try {                                                                                             </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 446                      db.delete(CacheDb.TABLE_NAME,                                                                 </span>
<span class="7230732652281167865" onmouseenter="enter('7230732652281167865');" onmouseout="out('7230732652281167865');" style=""> 447                              CacheDb.COLUMN_NAME + &quot; = ? &quot;, // SELECT query                                        </span>
<span class="-5686609646644956814" onmouseenter="enter('-5686609646644956814');" onmouseout="out('-5686609646644956814');" style=""> 448                              new String[] { objectName }); // args to SELECT query                                 </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 449                  } catch (SQLiteDiskIOException e) {                                                               </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 450                  } catch (SQLiteCantOpenDatabaseException e) {                                                     </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 451                      dumpOpenFiles();                                                                              </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 452                      throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453                  }                                                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 454                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455              }                                                                                                     </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 456          }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457      }                                                                                                             </span>
<span  style=""> 458                                                                                                                    </span>
<span class="-5397085010036489521" onmouseenter="enter('-5397085010036489521');" onmouseout="out('-5397085010036489521');" style=""> 459      private Bitmap readFromDb(String name, Bitmap b) {                                                            </span>
<span class="-6915248341892392088" onmouseenter="enter('-6915248341892392088');" onmouseout="out('-6915248341892392088');" style=""> 460          if (mCachedSelectQuery == null) {                                                                         </span>
<span class="8500727054799765575" onmouseenter="enter('8500727054799765575');" onmouseout="out('8500727054799765575');" style=""> 461              mCachedSelectQuery = CacheDb.COLUMN_NAME + &quot; = ? AND &quot; +                                              </span>
<span class="-5148548584287535582" onmouseenter="enter('-5148548584287535582');" onmouseout="out('-5148548584287535582');" style=""> 462                      CacheDb.COLUMN_SIZE + &quot; = ?&quot;;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463          }                                                                                                         </span>
<span class="-3717850318373004709" onmouseenter="enter('-3717850318373004709');" onmouseout="out('-3717850318373004709');" style=""> 464          SQLiteDatabase db = mDb.getReadableDatabase();                                                            </span>
<span class="2593671339546598036" onmouseenter="enter('2593671339546598036');" onmouseout="out('2593671339546598036');" style=""> 465          Cursor result;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 466          try {                                                                                                     </span>
<span class="44832651277024274" onmouseenter="enter('44832651277024274');" onmouseout="out('44832651277024274');" style=""> 467              result = db.query(CacheDb.TABLE_NAME,                                                                 </span>
<span class="-8348630863841661561" onmouseenter="enter('-8348630863841661561');" onmouseout="out('-8348630863841661561');" style=""> 468                      new String[] { CacheDb.COLUMN_PREVIEW_BITMAP }, // cols to return                             </span>
<span class="9098744119488497529" onmouseenter="enter('9098744119488497529');" onmouseout="out('9098744119488497529');" style=""> 469                      mCachedSelectQuery, // select query                                                           </span>
<span class="7819507014643484139" onmouseenter="enter('7819507014643484139');" onmouseout="out('7819507014643484139');" style=""> 470                      new String[] { name, mSize }, // args to select query                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 471                      null,                                                                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 472                      null,                                                                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 473                      null,                                                                                         </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 474                      null);                                                                                        </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 475          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 476              recreateDb();                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 477              return null;                                                                                          </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 478          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 479              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 480              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481          }                                                                                                         </span>
<span class="175106850439522001" onmouseenter="enter('175106850439522001');" onmouseout="out('175106850439522001');" style=""> 482          if (result.getCount() &gt; 0) {                                                                              </span>
<span class="-8233551716377839585" onmouseenter="enter('-8233551716377839585');" onmouseout="out('-8233551716377839585');" style=""> 483              result.moveToFirst();                                                                                 </span>
<span class="-8295573450010349547" onmouseenter="enter('-8295573450010349547');" onmouseout="out('-8295573450010349547');" style=""> 484              byte[] blob = result.getBlob(0);                                                                      </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 485              result.close();                                                                                       </span>
<span class="5422706254339452362" onmouseenter="enter('5422706254339452362');" onmouseout="out('5422706254339452362');" style=""> 486              final BitmapFactory.Options opts = mCachedBitmapFactoryOptions.get();                                 </span>
<span class="-4203120540780740867" onmouseenter="enter('-4203120540780740867');" onmouseout="out('-4203120540780740867');" style=""> 487              opts.inBitmap = b;                                                                                    </span>
<span class="5746761561761774101" onmouseenter="enter('5746761561761774101');" onmouseout="out('5746761561761774101');" style=""> 488              opts.inSampleSize = 1;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 489              try {                                                                                                 </span>
<span class="5467059833557948093" onmouseenter="enter('5467059833557948093');" onmouseout="out('5467059833557948093');" style=""> 490                  return BitmapFactory.decodeByteArray(blob, 0, blob.length, opts);                                 </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 491              } catch (IllegalArgumentException e) {                                                                </span>
<span class="-8663451629875904419" onmouseenter="enter('-8663451629875904419');" onmouseout="out('-8663451629875904419');" style=""> 492                  removeItemFromDb(mDb, name);                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 493                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 495          } else {                                                                                                  </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 496              result.close();                                                                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 497              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499      }                                                                                                             </span>
<span  style=""> 500                                                                                                                    </span>
<span class="-4571373922604646261" onmouseenter="enter('-4571373922604646261');" onmouseout="out('-4571373922604646261');" style=""> 501      private Bitmap generatePreview(Object info, Bitmap preview) {                                                 </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 502          if (preview != null &amp;&amp;                                                                                    </span>
<span class="-4427245060729789933" onmouseenter="enter('-4427245060729789933');" onmouseout="out('-4427245060729789933');" style=""> 503                  (preview.getWidth() != mPreviewBitmapWidth ||                                                     </span>
<span class="-7111303570896946504" onmouseenter="enter('-7111303570896946504');" onmouseout="out('-7111303570896946504');" style=""> 504                  preview.getHeight() != mPreviewBitmapHeight)) {                                                   </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 505              throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506          }                                                                                                         </span>
<span class="-3932360089392842216" onmouseenter="enter('-3932360089392842216');" onmouseout="out('-3932360089392842216');" style=""> 507          if (info instanceof AppWidgetProviderInfo) {                                                              </span>
<span class="-6841541424186777283" onmouseenter="enter('-6841541424186777283');" onmouseout="out('-6841541424186777283');" style=""> 508              return generateWidgetPreview((AppWidgetProviderInfo) info, preview);                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 509          } else {                                                                                                  </span>
<span class="5830651867016154139" onmouseenter="enter('5830651867016154139');" onmouseout="out('5830651867016154139');" style=""> 510              return generateShortcutPreview(                                                                       </span>
<span class="5884922488800788426" onmouseenter="enter('5884922488800788426');" onmouseout="out('5884922488800788426');" style=""> 511                      (ResolveInfo) info, mPreviewBitmapWidth, mPreviewBitmapHeight, preview);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513      }                                                                                                             </span>
<span  style=""> 514                                                                                                                    </span>
<span class="6578518467799953308" onmouseenter="enter('6578518467799953308');" onmouseout="out('6578518467799953308');" style=""> 515      public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, Bitmap preview) {                             </span>
<span class="9147821438266271134" onmouseenter="enter('9147821438266271134');" onmouseout="out('9147821438266271134');" style=""> 516          int[] cellSpans = Launcher.getSpanForWidget(mContext, info);                                              </span>
<span class="-1431657331442958147" onmouseenter="enter('-1431657331442958147');" onmouseout="out('-1431657331442958147');" style=""> 517          int maxWidth = maxWidthForWidgetPreview(cellSpans[0]);                                                    </span>
<span class="-6135167628743317243" onmouseenter="enter('-6135167628743317243');" onmouseout="out('-6135167628743317243');" style=""> 518          int maxHeight = maxHeightForWidgetPreview(cellSpans[1]);                                                  </span>
<span class="-6510989053235413139" onmouseenter="enter('-6510989053235413139');" onmouseout="out('-6510989053235413139');" style=""> 519          return generateWidgetPreview(info, cellSpans[0], cellSpans[1],                                            </span>
<span class="5560351977065436698" onmouseenter="enter('5560351977065436698');" onmouseout="out('5560351977065436698');" style=""> 520                  maxWidth, maxHeight, preview, null);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521      }                                                                                                             </span>
<span  style=""> 522                                                                                                                    </span>
<span class="-4962504510381054079" onmouseenter="enter('-4962504510381054079');" onmouseout="out('-4962504510381054079');" style=""> 523      public int maxWidthForWidgetPreview(int spanX) {                                                              </span>
<span class="5345170673015378699" onmouseenter="enter('5345170673015378699');" onmouseout="out('5345170673015378699');" style=""> 524          return Math.min(mPreviewBitmapWidth,                                                                      </span>
<span class="-7096108314182907064" onmouseenter="enter('-7096108314182907064');" onmouseout="out('-7096108314182907064');" style=""> 525                  mWidgetSpacingLayout.estimateCellWidth(spanX));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526      }                                                                                                             </span>
<span  style=""> 527                                                                                                                    </span>
<span class="-516047466055903408" onmouseenter="enter('-516047466055903408');" onmouseout="out('-516047466055903408');" style=""> 528      public int maxHeightForWidgetPreview(int spanY) {                                                             </span>
<span class="8958196798141008482" onmouseenter="enter('8958196798141008482');" onmouseout="out('8958196798141008482');" style=""> 529          return Math.min(mPreviewBitmapHeight,                                                                     </span>
<span class="-8176698640675478774" onmouseenter="enter('-8176698640675478774');" onmouseout="out('-8176698640675478774');" style=""> 530                  mWidgetSpacingLayout.estimateCellHeight(spanY));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531      }                                                                                                             </span>
<span  style=""> 532                                                                                                                    </span>
<span class="-6895334532662888649" onmouseenter="enter('-6895334532662888649');" onmouseout="out('-6895334532662888649');" style=""> 533      public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, int cellHSpan, int cellVSpan,                 </span>
<span class="-5508121118873891580" onmouseenter="enter('-5508121118873891580');" onmouseout="out('-5508121118873891580');" style=""> 534              int maxPreviewWidth, int maxPreviewHeight, Bitmap preview, int[] preScaledWidthOut) {                 </span>
<span class="2529916654704436428" onmouseenter="enter('2529916654704436428');" onmouseout="out('2529916654704436428');" style=""> 535          // Load the preview image if possible                                                                     </span>
<span class="931456242657570009" onmouseenter="enter('931456242657570009');" onmouseout="out('931456242657570009');" style=""> 536          if (maxPreviewWidth &lt; 0) maxPreviewWidth = Integer.MAX_VALUE;                                             </span>
<span class="-3276405287943718338" onmouseenter="enter('-3276405287943718338');" onmouseout="out('-3276405287943718338');" style=""> 537          if (maxPreviewHeight &lt; 0) maxPreviewHeight = Integer.MAX_VALUE;                                           </span>
<span  style=""> 538                                                                                                                    </span>
<span class="-3049333615145638519" onmouseenter="enter('-3049333615145638519');" onmouseout="out('-3049333615145638519');" style=""> 539          Drawable drawable = null;                                                                                 </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 540          if (info.previewImage != 0) {                                                                             </span>
<span class="-6995452363019574294" onmouseenter="enter('-6995452363019574294');" onmouseout="out('-6995452363019574294');" style=""> 541              drawable = mManager.loadPreview(info);                                                                </span>
<span class="281943916213481387" onmouseenter="enter('281943916213481387');" onmouseout="out('281943916213481387');" style=""> 542              if (drawable != null) {                                                                               </span>
<span class="559582177948747235" onmouseenter="enter('559582177948747235');" onmouseout="out('559582177948747235');" style=""> 543                  drawable = mutateOnMainThread(drawable);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 544              } else {                                                                                              </span>
<span class="7073909505336594696" onmouseenter="enter('7073909505336594696');" onmouseout="out('7073909505336594696');" style=""> 545                  Log.w(TAG, &quot;Can&#x27;t load widget preview drawable 0x&quot; +                                              </span>
<span class="-4346717227149782469" onmouseenter="enter('-4346717227149782469');" onmouseout="out('-4346717227149782469');" style=""> 546                          Integer.toHexString(info.previewImage) + &quot; for provider: &quot; + info.provider);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548          }                                                                                                         </span>
<span  style=""> 549                                                                                                                    </span>
<span class="5985266596175165266" onmouseenter="enter('5985266596175165266');" onmouseout="out('5985266596175165266');" style=""> 550          int previewWidth;                                                                                         </span>
<span class="-7312246595783828327" onmouseenter="enter('-7312246595783828327');" onmouseout="out('-7312246595783828327');" style=""> 551          int previewHeight;                                                                                        </span>
<span class="5524531081830166723" onmouseenter="enter('5524531081830166723');" onmouseout="out('5524531081830166723');" style=""> 552          Bitmap defaultPreview = null;                                                                             </span>
<span class="5121594519432393069" onmouseenter="enter('5121594519432393069');" onmouseout="out('5121594519432393069');" style=""> 553          boolean widgetPreviewExists = (drawable != null);                                                         </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 554          if (widgetPreviewExists) {                                                                                </span>
<span class="7694696434619666028" onmouseenter="enter('7694696434619666028');" onmouseout="out('7694696434619666028');" style=""> 555              previewWidth = drawable.getIntrinsicWidth();                                                          </span>
<span class="-5860514303309291265" onmouseenter="enter('-5860514303309291265');" onmouseout="out('-5860514303309291265');" style=""> 556              previewHeight = drawable.getIntrinsicHeight();                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 557          } else {                                                                                                  </span>
<span class="7833733472444702454" onmouseenter="enter('7833733472444702454');" onmouseout="out('7833733472444702454');" style=""> 558              // Generate a preview image if we couldn&#x27;t load one                                                   </span>
<span class="-8710794757779095209" onmouseenter="enter('-8710794757779095209');" onmouseout="out('-8710794757779095209');" style=""> 559              if (cellHSpan &lt; 1) cellHSpan = 1;                                                                     </span>
<span class="-779725371469556670" onmouseenter="enter('-779725371469556670');" onmouseout="out('-779725371469556670');" style=""> 560              if (cellVSpan &lt; 1) cellVSpan = 1;                                                                     </span>
<span  style=""> 561                                                                                                                    </span>
<span class="3565276356973562387" onmouseenter="enter('3565276356973562387');" onmouseout="out('3565276356973562387');" style=""> 562              // This Drawable is not directly drawn, so there&#x27;s no need to mutate it.                              </span>
<span class="-5021189500908681979" onmouseenter="enter('-5021189500908681979');" onmouseout="out('-5021189500908681979');" style=""> 563              BitmapDrawable previewDrawable = (BitmapDrawable) mContext.getResources()                             </span>
<span class="3152690746910736269" onmouseenter="enter('3152690746910736269');" onmouseout="out('3152690746910736269');" style=""> 564                      .getDrawable(R.drawable.widget_tile);                                                         </span>
<span class="-5932659289331905035" onmouseenter="enter('-5932659289331905035');" onmouseout="out('-5932659289331905035');" style=""> 565              final int previewDrawableWidth = previewDrawable                                                      </span>
<span class="-5783669958167413803" onmouseenter="enter('-5783669958167413803');" onmouseout="out('-5783669958167413803');" style=""> 566                      .getIntrinsicWidth();                                                                         </span>
<span class="4431322150991047787" onmouseenter="enter('4431322150991047787');" onmouseout="out('4431322150991047787');" style=""> 567              final int previewDrawableHeight = previewDrawable                                                     </span>
<span class="4098769707366186014" onmouseenter="enter('4098769707366186014');" onmouseout="out('4098769707366186014');" style=""> 568                      .getIntrinsicHeight();                                                                        </span>
<span class="8887455390458335872" onmouseenter="enter('8887455390458335872');" onmouseout="out('8887455390458335872');" style=""> 569              previewWidth = previewDrawableWidth * cellHSpan;                                                      </span>
<span class="-8341882922226410648" onmouseenter="enter('-8341882922226410648');" onmouseout="out('-8341882922226410648');" style=""> 570              previewHeight = previewDrawableHeight * cellVSpan;                                                    </span>
<span  style=""> 571                                                                                                                    </span>
<span class="-737373095753296600" onmouseenter="enter('-737373095753296600');" onmouseout="out('-737373095753296600');" style=""> 572              defaultPreview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 573              final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                                 </span>
<span class="848607727045658162" onmouseenter="enter('848607727045658162');" onmouseout="out('848607727045658162');" style=""> 574              c.setBitmap(defaultPreview);                                                                          </span>
<span class="4673250187052598192" onmouseenter="enter('4673250187052598192');" onmouseout="out('4673250187052598192');" style=""> 575              Paint p = mDefaultAppWidgetPreviewPaint.get();                                                        </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 576              if (p == null) {                                                                                      </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 577                  p = new Paint();                                                                                  </span>
<span class="9031053372645621365" onmouseenter="enter('9031053372645621365');" onmouseout="out('9031053372645621365');" style=""> 578                  p.setShader(new BitmapShader(previewDrawable.getBitmap(),                                         </span>
<span class="1595910380715064067" onmouseenter="enter('1595910380715064067');" onmouseout="out('1595910380715064067');" style=""> 579                          Shader.TileMode.REPEAT, Shader.TileMode.REPEAT));                                         </span>
<span class="-8603584172680459929" onmouseenter="enter('-8603584172680459929');" onmouseout="out('-8603584172680459929');" style=""> 580                  mDefaultAppWidgetPreviewPaint.set(p);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581              }                                                                                                     </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 582              final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                              </span>
<span class="4633920667503149983" onmouseenter="enter('4633920667503149983');" onmouseout="out('4633920667503149983');" style=""> 583              dest.set(0, 0, previewWidth, previewHeight);                                                          </span>
<span class="-470581757098027879" onmouseenter="enter('-470581757098027879');" onmouseout="out('-470581757098027879');" style=""> 584              c.drawRect(dest, p);                                                                                  </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 585              c.setBitmap(null);                                                                                    </span>
<span  style=""> 586                                                                                                                    </span>
<span class="4647625888602990242" onmouseenter="enter('4647625888602990242');" onmouseout="out('4647625888602990242');" style=""> 587              // Draw the icon in the top left corner                                                               </span>
<span class="3531213633716353102" onmouseenter="enter('3531213633716353102');" onmouseout="out('3531213633716353102');" style=""> 588              int minOffset = (int) (mAppIconSize * WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE);                        </span>
<span class="-3256500215342314396" onmouseenter="enter('-3256500215342314396');" onmouseout="out('-3256500215342314396');" style=""> 589              int smallestSide = Math.min(previewWidth, previewHeight);                                             </span>
<span class="1098745458783687815" onmouseenter="enter('1098745458783687815');" onmouseout="out('1098745458783687815');" style=""> 590              float iconScale = Math.min((float) smallestSide                                                       </span>
<span class="7317986328586297721" onmouseenter="enter('7317986328586297721');" onmouseout="out('7317986328586297721');" style=""> 591                      / (mAppIconSize + 2 * minOffset), 1f);                                                        </span>
<span  style=""> 592                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 593              try {                                                                                                 </span>
<span class="-837531234335200976" onmouseenter="enter('-837531234335200976');" onmouseout="out('-837531234335200976');" style=""> 594                  Drawable icon = mManager.loadIcon(info, mIconCache);                                              </span>
<span class="-4192144256919602329" onmouseenter="enter('-4192144256919602329');" onmouseout="out('-4192144256919602329');" style=""> 595                  if (icon != null) {                                                                               </span>
<span class="-1224594640800103937" onmouseenter="enter('-1224594640800103937');" onmouseout="out('-1224594640800103937');" style=""> 596                      int hoffset = (int) ((previewDrawableWidth - mAppIconSize * iconScale) / 2);                  </span>
<span class="-389205104576287013" onmouseenter="enter('-389205104576287013');" onmouseout="out('-389205104576287013');" style=""> 597                      int yoffset = (int) ((previewDrawableHeight - mAppIconSize * iconScale) / 2);                 </span>
<span class="-867380701080615138" onmouseenter="enter('-867380701080615138');" onmouseout="out('-867380701080615138');" style=""> 598                      icon = mutateOnMainThread(icon);                                                              </span>
<span class="1665310338408239466" onmouseenter="enter('1665310338408239466');" onmouseout="out('1665310338408239466');" style=""> 599                      renderDrawableToBitmap(icon, defaultPreview, hoffset,                                         </span>
<span class="8191900375173585890" onmouseenter="enter('8191900375173585890');" onmouseout="out('8191900375173585890');" style=""> 600                              yoffset, (int) (mAppIconSize * iconScale),                                            </span>
<span class="-5886521530151300680" onmouseenter="enter('-5886521530151300680');" onmouseout="out('-5886521530151300680');" style=""> 601                              (int) (mAppIconSize * iconScale));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602                  }                                                                                                 </span>
<span class="5183756364953253383" onmouseenter="enter('5183756364953253383');" onmouseout="out('5183756364953253383');" style=""> 603              } catch (Resources.NotFoundException e) {                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 604              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605          }                                                                                                         </span>
<span  style=""> 606                                                                                                                    </span>
<span class="6949857229431854068" onmouseenter="enter('6949857229431854068');" onmouseout="out('6949857229431854068');" style=""> 607          // Scale to fit width only - let the widget preview be clipped in the                                     </span>
<span class="8360805034192073884" onmouseenter="enter('8360805034192073884');" onmouseout="out('8360805034192073884');" style=""> 608          // vertical dimension                                                                                     </span>
<span class="-8224051742145745082" onmouseenter="enter('-8224051742145745082');" onmouseout="out('-8224051742145745082');" style=""> 609          float scale = 1f;                                                                                         </span>
<span class="6149434037546525815" onmouseenter="enter('6149434037546525815');" onmouseout="out('6149434037546525815');" style=""> 610          if (preScaledWidthOut != null) {                                                                          </span>
<span class="2306433834272734783" onmouseenter="enter('2306433834272734783');" onmouseout="out('2306433834272734783');" style=""> 611              preScaledWidthOut[0] = previewWidth;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612          }                                                                                                         </span>
<span class="-7638941371937567348" onmouseenter="enter('-7638941371937567348');" onmouseout="out('-7638941371937567348');" style=""> 613          if (previewWidth &gt; maxPreviewWidth) {                                                                     </span>
<span class="-6167807034013491459" onmouseenter="enter('-6167807034013491459');" onmouseout="out('-6167807034013491459');" style=""> 614              scale = maxPreviewWidth / (float) previewWidth;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 615          }                                                                                                         </span>
<span class="-8893868344639903626" onmouseenter="enter('-8893868344639903626');" onmouseout="out('-8893868344639903626');" style=""> 616          if (scale != 1f) {                                                                                        </span>
<span class="-6338970909485118519" onmouseenter="enter('-6338970909485118519');" onmouseout="out('-6338970909485118519');" style=""> 617              previewWidth = (int) (scale * previewWidth);                                                          </span>
<span class="2442469555843251122" onmouseenter="enter('2442469555843251122');" onmouseout="out('2442469555843251122');" style=""> 618              previewHeight = (int) (scale * previewHeight);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619          }                                                                                                         </span>
<span  style=""> 620                                                                                                                    </span>
<span class="-1124372066791938196" onmouseenter="enter('-1124372066791938196');" onmouseout="out('-1124372066791938196');" style=""> 621          // If a bitmap is passed in, we use it; otherwise, we create a bitmap of the right size                   </span>
<span class="2486895102595751802" onmouseenter="enter('2486895102595751802');" onmouseout="out('2486895102595751802');" style=""> 622          if (preview == null) {                                                                                    </span>
<span class="6637154682204057097" onmouseenter="enter('6637154682204057097');" onmouseout="out('6637154682204057097');" style=""> 623              preview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624          }                                                                                                         </span>
<span  style=""> 625                                                                                                                    </span>
<span class="-2080916171919384218" onmouseenter="enter('-2080916171919384218');" onmouseout="out('-2080916171919384218');" style=""> 626          // Draw the scaled preview into the final bitmap                                                          </span>
<span class="3369675460464663159" onmouseenter="enter('3369675460464663159');" onmouseout="out('3369675460464663159');" style=""> 627          int x = (preview.getWidth() - previewWidth) / 2;                                                          </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 628          if (widgetPreviewExists) {                                                                                </span>
<span class="-6966420244976420379" onmouseenter="enter('-6966420244976420379');" onmouseout="out('-6966420244976420379');" style=""> 629              renderDrawableToBitmap(drawable, preview, x, 0, previewWidth,                                         </span>
<span class="-7548196549309427555" onmouseenter="enter('-7548196549309427555');" onmouseout="out('-7548196549309427555');" style=""> 630                      previewHeight);                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 631          } else {                                                                                                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 632              final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                                 </span>
<span class="5281190707868665361" onmouseenter="enter('5281190707868665361');" onmouseout="out('5281190707868665361');" style=""> 633              final Rect src = mCachedAppWidgetPreviewSrcRect.get();                                                </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 634              final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                              </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 635              c.setBitmap(preview);                                                                                 </span>
<span class="-8725434908843264237" onmouseenter="enter('-8725434908843264237');" onmouseout="out('-8725434908843264237');" style=""> 636              src.set(0, 0, defaultPreview.getWidth(), defaultPreview.getHeight());                                 </span>
<span class="-7071368679565427433" onmouseenter="enter('-7071368679565427433');" onmouseout="out('-7071368679565427433');" style=""> 637              dest.set(x, 0, x + previewWidth, previewHeight);                                                      </span>
<span  style=""> 638                                                                                                                    </span>
<span class="5839465204107083552" onmouseenter="enter('5839465204107083552');" onmouseout="out('5839465204107083552');" style=""> 639              Paint p = mCachedAppWidgetPreviewPaint.get();                                                         </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 640              if (p == null) {                                                                                      </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 641                  p = new Paint();                                                                                  </span>
<span class="-3846510342158419561" onmouseenter="enter('-3846510342158419561');" onmouseout="out('-3846510342158419561');" style=""> 642                  p.setFilterBitmap(true);                                                                          </span>
<span class="8711891207106027486" onmouseenter="enter('8711891207106027486');" onmouseout="out('8711891207106027486');" style=""> 643                  mCachedAppWidgetPreviewPaint.set(p);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644              }                                                                                                     </span>
<span class="-8322704971015823035" onmouseenter="enter('-8322704971015823035');" onmouseout="out('-8322704971015823035');" style=""> 645              c.drawBitmap(defaultPreview, src, dest, p);                                                           </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 646              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 647          }                                                                                                         </span>
<span class="-5318059876677185928" onmouseenter="enter('-5318059876677185928');" onmouseout="out('-5318059876677185928');" style=""> 648          return mManager.getBadgeBitmap(info, preview);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649      }                                                                                                             </span>
<span  style=""> 650                                                                                                                    </span>
<span class="-2036338097340155865" onmouseenter="enter('-2036338097340155865');" onmouseout="out('-2036338097340155865');" style=""> 651      private Bitmap generateShortcutPreview(                                                                       </span>
<span class="1557751875108084858" onmouseenter="enter('1557751875108084858');" onmouseout="out('1557751875108084858');" style=""> 652              ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview) {                                      </span>
<span class="6669617465194046785" onmouseenter="enter('6669617465194046785');" onmouseout="out('6669617465194046785');" style=""> 653          Bitmap tempBitmap = mCachedShortcutPreviewBitmap.get();                                                   </span>
<span class="8492580593566939346" onmouseenter="enter('8492580593566939346');" onmouseout="out('8492580593566939346');" style=""> 654          final Canvas c = mCachedShortcutPreviewCanvas.get();                                                      </span>
<span class="3344452031699903410" onmouseenter="enter('3344452031699903410');" onmouseout="out('3344452031699903410');" style=""> 655          if (tempBitmap == null ||                                                                                 </span>
<span class="-1798938713535043835" onmouseenter="enter('-1798938713535043835');" onmouseout="out('-1798938713535043835');" style=""> 656                  tempBitmap.getWidth() != maxWidth ||                                                              </span>
<span class="9083140300107171771" onmouseenter="enter('9083140300107171771');" onmouseout="out('9083140300107171771');" style=""> 657                  tempBitmap.getHeight() != maxHeight) {                                                            </span>
<span class="5079923942824258796" onmouseenter="enter('5079923942824258796');" onmouseout="out('5079923942824258796');" style=""> 658              tempBitmap = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                              </span>
<span class="3252713296815828481" onmouseenter="enter('3252713296815828481');" onmouseout="out('3252713296815828481');" style=""> 659              mCachedShortcutPreviewBitmap.set(tempBitmap);                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 660          } else {                                                                                                  </span>
<span class="2908194814219559361" onmouseenter="enter('2908194814219559361');" onmouseout="out('2908194814219559361');" style=""> 661              c.setBitmap(tempBitmap);                                                                              </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 662              c.drawColor(0, PorterDuff.Mode.CLEAR);                                                                </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 663              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664          }                                                                                                         </span>
<span class="-895750054343748789" onmouseenter="enter('-895750054343748789');" onmouseout="out('-895750054343748789');" style=""> 665          // Render the icon                                                                                        </span>
<span class="-9200688182354003526" onmouseenter="enter('-9200688182354003526');" onmouseout="out('-9200688182354003526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -        Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info));                                      </span>
<span class="-8632811780119956337" onmouseenter="enter('-8632811780119956337');" onmouseout="out('-8632811780119956337');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 667 +        Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info.activityInfo));                         </span>
<span  style=""> 668                                                                                                                    </span>
<span class="-7461308767564647078" onmouseenter="enter('-7461308767564647078');" onmouseout="out('-7461308767564647078');" style=""> 669          int paddingTop = mContext.                                                                                </span>
<span class="-5900363241936444267" onmouseenter="enter('-5900363241936444267');" onmouseout="out('-5900363241936444267');" style=""> 670                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);                     </span>
<span class="5781485035466420663" onmouseenter="enter('5781485035466420663');" onmouseout="out('5781485035466420663');" style=""> 671          int paddingLeft = mContext.                                                                               </span>
<span class="2328331898560910495" onmouseenter="enter('2328331898560910495');" onmouseout="out('2328331898560910495');" style=""> 672                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);                    </span>
<span class="5829344697485851220" onmouseenter="enter('5829344697485851220');" onmouseout="out('5829344697485851220');" style=""> 673          int paddingRight = mContext.                                                                              </span>
<span class="-8885288017836034916" onmouseenter="enter('-8885288017836034916');" onmouseout="out('-8885288017836034916');" style=""> 674                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);                   </span>
<span  style=""> 675                                                                                                                    </span>
<span class="9041541765806161530" onmouseenter="enter('9041541765806161530');" onmouseout="out('9041541765806161530');" style=""> 676          int scaledIconWidth = (maxWidth - paddingLeft - paddingRight);                                            </span>
<span  style=""> 677                                                                                                                    </span>
<span class="3221827998305751243" onmouseenter="enter('3221827998305751243');" onmouseout="out('3221827998305751243');" style=""> 678          renderDrawableToBitmap(                                                                                   </span>
<span class="5202977166144268859" onmouseenter="enter('5202977166144268859');" onmouseout="out('5202977166144268859');" style=""> 679                  icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidth);                     </span>
<span  style=""> 680                                                                                                                    </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 681          if (preview != null &amp;&amp;                                                                                    </span>
<span class="-4616488258627842412" onmouseenter="enter('-4616488258627842412');" onmouseout="out('-4616488258627842412');" style=""> 682                  (preview.getWidth() != maxWidth || preview.getHeight() != maxHeight)) {                           </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 683              throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                             </span>
<span class="3365320965403910466" onmouseenter="enter('3365320965403910466');" onmouseout="out('3365320965403910466');" style=""> 684          } else if (preview == null) {                                                                             </span>
<span class="4551594767613519312" onmouseenter="enter('4551594767613519312');" onmouseout="out('4551594767613519312');" style=""> 685              preview = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686          }                                                                                                         </span>
<span  style=""> 687                                                                                                                    </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 688          c.setBitmap(preview);                                                                                     </span>
<span class="8934981767024497500" onmouseenter="enter('8934981767024497500');" onmouseout="out('8934981767024497500');" style=""> 689          // Draw a desaturated/scaled version of the icon in the background as a watermark                         </span>
<span class="-518774087151586601" onmouseenter="enter('-518774087151586601');" onmouseout="out('-518774087151586601');" style=""> 690          Paint p = mCachedShortcutPreviewPaint.get();                                                              </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 691          if (p == null) {                                                                                          </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 692              p = new Paint();                                                                                      </span>
<span class="5185800516692981036" onmouseenter="enter('5185800516692981036');" onmouseout="out('5185800516692981036');" style=""> 693              ColorMatrix colorMatrix = new ColorMatrix();                                                          </span>
<span class="-4096104009908534310" onmouseenter="enter('-4096104009908534310');" onmouseout="out('-4096104009908534310');" style=""> 694              colorMatrix.setSaturation(0);                                                                         </span>
<span class="-2105686232381577699" onmouseenter="enter('-2105686232381577699');" onmouseout="out('-2105686232381577699');" style=""> 695              p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));                                            </span>
<span class="-725456443631950326" onmouseenter="enter('-725456443631950326');" onmouseout="out('-725456443631950326');" style=""> 696              p.setAlpha((int) (255 * 0.06f));                                                                      </span>
<span class="-4885683919835504124" onmouseenter="enter('-4885683919835504124');" onmouseout="out('-4885683919835504124');" style=""> 697              mCachedShortcutPreviewPaint.set(p);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698          }                                                                                                         </span>
<span class="-4554115702547152566" onmouseenter="enter('-4554115702547152566');" onmouseout="out('-4554115702547152566');" style=""> 699          c.drawBitmap(tempBitmap, 0, 0, p);                                                                        </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 700          c.setBitmap(null);                                                                                        </span>
<span  style=""> 701                                                                                                                    </span>
<span class="-5738465230776990197" onmouseenter="enter('-5738465230776990197');" onmouseout="out('-5738465230776990197');" style=""> 702          renderDrawableToBitmap(icon, preview, 0, 0, mAppIconSize, mAppIconSize);                                  </span>
<span  style=""> 703                                                                                                                    </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 704          return preview;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705      }                                                                                                             </span>
<span  style=""> 706                                                                                                                    </span>
<span class="-2512069815104909632" onmouseenter="enter('-2512069815104909632');" onmouseout="out('-2512069815104909632');" style=""> 707      private static void renderDrawableToBitmap(                                                                   </span>
<span class="-281586385806654310" onmouseenter="enter('-281586385806654310');" onmouseout="out('-281586385806654310');" style=""> 708              Drawable d, Bitmap bitmap, int x, int y, int w, int h) {                                              </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 709          if (bitmap != null) {                                                                                     </span>
<span class="417388478829800263" onmouseenter="enter('417388478829800263');" onmouseout="out('417388478829800263');" style=""> 710              Canvas c = new Canvas(bitmap);                                                                        </span>
<span class="2629107935702523978" onmouseenter="enter('2629107935702523978');" onmouseout="out('2629107935702523978');" style=""> 711              Rect oldBounds = d.copyBounds();                                                                      </span>
<span class="-7883404386706876736" onmouseenter="enter('-7883404386706876736');" onmouseout="out('-7883404386706876736');" style=""> 712              d.setBounds(x, y, x + w, y + h);                                                                      </span>
<span class="3763902819788011622" onmouseenter="enter('3763902819788011622');" onmouseout="out('3763902819788011622');" style=""> 713              d.draw(c);                                                                                            </span>
<span class="-5442987023720851592" onmouseenter="enter('-5442987023720851592');" onmouseout="out('-5442987023720851592');" style=""> 714              d.setBounds(oldBounds); // Restore the bounds                                                         </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 715              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 716          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717      }                                                                                                             </span>
<span  style=""> 718                                                                                                                    </span>
<span class="-2265124982478046254" onmouseenter="enter('-2265124982478046254');" onmouseout="out('-2265124982478046254');" style=""> 719      private Drawable mutateOnMainThread(final Drawable drawable) {                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 720          try {                                                                                                     </span>
<span class="3177563387853690691" onmouseenter="enter('3177563387853690691');" onmouseout="out('3177563387853690691');" style=""> 721              return mMainThreadExecutor.submit(new Callable&lt;Drawable&gt;() {                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 722                  @Override                                                                                         </span>
<span class="4251206983441278885" onmouseenter="enter('4251206983441278885');" onmouseout="out('4251206983441278885');" style=""> 723                  public Drawable call() throws Exception {                                                         </span>
<span class="721315677862243657" onmouseenter="enter('721315677862243657');" onmouseout="out('721315677862243657');" style=""> 724                      return drawable.mutate();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725                  }                                                                                                 </span>
<span class="8868058436262798399" onmouseenter="enter('8868058436262798399');" onmouseout="out('8868058436262798399');" style=""> 726              }).get();                                                                                             </span>
<span class="-7528533024404460182" onmouseenter="enter('-7528533024404460182');" onmouseout="out('-7528533024404460182');" style=""> 727          } catch (InterruptedException e) {                                                                        </span>
<span class="8315424094067049480" onmouseenter="enter('8315424094067049480');" onmouseout="out('8315424094067049480');" style=""> 728              Thread.currentThread().interrupt();                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 729              throw new RuntimeException(e);                                                                        </span>
<span class="-3674505659955768067" onmouseenter="enter('-3674505659955768067');" onmouseout="out('-3674505659955768067');" style=""> 730          } catch (ExecutionException e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 731              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 733      }                                                                                                             </span>
<span  style=""> 734                                                                                                                    </span>
<span class="-1664432510733041020" onmouseenter="enter('-1664432510733041020');" onmouseout="out('-1664432510733041020');" style=""> 735      private static final int MAX_OPEN_FILES = 1024;                                                               </span>
<span class="9072161857204403261" onmouseenter="enter('9072161857204403261');" onmouseout="out('9072161857204403261');" style=""> 736      private static final int SAMPLE_RATE = 23;                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 737      /**                                                                                                           </span>
<span class="4777297713483982548" onmouseenter="enter('4777297713483982548');" onmouseout="out('4777297713483982548');" style=""> 738       * Dumps all files that are open in this process without allocating a file descriptor.                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 739       */                                                                                                           </span>
<span class="7630668132257036624" onmouseenter="enter('7630668132257036624');" onmouseout="out('7630668132257036624');" style=""> 740      private static void dumpOpenFiles() {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 741          try {                                                                                                     </span>
<span class="7095374185665412657" onmouseenter="enter('7095374185665412657');" onmouseout="out('7095374185665412657');" style=""> 742              Log.i(TAG, &quot;DUMP OF OPEN FILES (sample rate: 1 every &quot; + SAMPLE_RATE + &quot;):&quot;);                         </span>
<span class="-6063809008451063811" onmouseenter="enter('-6063809008451063811');" onmouseout="out('-6063809008451063811');" style=""> 743              final String TYPE_APK = &quot;apk&quot;;                                                                        </span>
<span class="-6901274176875279046" onmouseenter="enter('-6901274176875279046');" onmouseout="out('-6901274176875279046');" style=""> 744              final String TYPE_JAR = &quot;jar&quot;;                                                                        </span>
<span class="-4233944286779457769" onmouseenter="enter('-4233944286779457769');" onmouseout="out('-4233944286779457769');" style=""> 745              final String TYPE_PIPE = &quot;pipe&quot;;                                                                      </span>
<span class="-7830089877175241432" onmouseenter="enter('-7830089877175241432');" onmouseout="out('-7830089877175241432');" style=""> 746              final String TYPE_SOCKET = &quot;socket&quot;;                                                                  </span>
<span class="6234651693695236755" onmouseenter="enter('6234651693695236755');" onmouseout="out('6234651693695236755');" style=""> 747              final String TYPE_DB = &quot;db&quot;;                                                                          </span>
<span class="-6587583242995441423" onmouseenter="enter('-6587583242995441423');" onmouseout="out('-6587583242995441423');" style=""> 748              final String TYPE_ANON_INODE = &quot;anon_inode&quot;;                                                          </span>
<span class="-3500545166621689968" onmouseenter="enter('-3500545166621689968');" onmouseout="out('-3500545166621689968');" style=""> 749              final String TYPE_DEV = &quot;dev&quot;;                                                                        </span>
<span class="2067143891119682248" onmouseenter="enter('2067143891119682248');" onmouseout="out('2067143891119682248');" style=""> 750              final String TYPE_NON_FS = &quot;non-fs&quot;;                                                                  </span>
<span class="5330062242195911314" onmouseenter="enter('5330062242195911314');" onmouseout="out('5330062242195911314');" style=""> 751              final String TYPE_OTHER = &quot;other&quot;;                                                                    </span>
<span class="4846737914738595164" onmouseenter="enter('4846737914738595164');" onmouseout="out('4846737914738595164');" style=""> 752              List&lt;String&gt; types = Arrays.asList(TYPE_APK, TYPE_JAR, TYPE_PIPE, TYPE_SOCKET, TYPE_DB,               </span>
<span class="-1126389211762394977" onmouseenter="enter('-1126389211762394977');" onmouseout="out('-1126389211762394977');" style=""> 753                      TYPE_ANON_INODE, TYPE_DEV, TYPE_NON_FS, TYPE_OTHER);                                          </span>
<span class="7087384337453352553" onmouseenter="enter('7087384337453352553');" onmouseout="out('7087384337453352553');" style=""> 754              int[] count = new int[types.size()];                                                                  </span>
<span class="-400567270817057775" onmouseenter="enter('-400567270817057775');" onmouseout="out('-400567270817057775');" style=""> 755              int[] duplicates = new int[types.size()];                                                             </span>
<span class="-5112763339406897335" onmouseenter="enter('-5112763339406897335');" onmouseout="out('-5112763339406897335');" style=""> 756              HashSet&lt;String&gt; files = new HashSet&lt;String&gt;();                                                        </span>
<span class="-926962837754337949" onmouseenter="enter('-926962837754337949');" onmouseout="out('-926962837754337949');" style=""> 757              int total = 0;                                                                                        </span>
<span class="1028290052541393010" onmouseenter="enter('1028290052541393010');" onmouseout="out('1028290052541393010');" style=""> 758              for (int i = 0; i &lt; MAX_OPEN_FILES; i++) {                                                            </span>
<span class="3040328939873692127" onmouseenter="enter('3040328939873692127');" onmouseout="out('3040328939873692127');" style=""> 759                  // This is a gigantic hack but unfortunately the only way to resolve an fd                        </span>
<span class="-4129207097038329090" onmouseenter="enter('-4129207097038329090');" onmouseout="out('-4129207097038329090');" style=""> 760                  // to a file name. Note that we have to loop over all possible fds because                        </span>
<span class="6927440074701305186" onmouseenter="enter('6927440074701305186');" onmouseout="out('6927440074701305186');" style=""> 761                  // reading the directory would require allocating a new fd. The kernel is                         </span>
<span class="-7335721905258259512" onmouseenter="enter('-7335721905258259512');" onmouseout="out('-7335721905258259512');" style=""> 762                  // currently implemented such that no fd is larger then the current rlimit,                       </span>
<span class="5240836059895527485" onmouseenter="enter('5240836059895527485');" onmouseout="out('5240836059895527485');" style=""> 763                  // which is why it&#x27;s safe to loop over them in such a way.                                        </span>
<span class="-4546857229319265624" onmouseenter="enter('-4546857229319265624');" onmouseout="out('-4546857229319265624');" style=""> 764                  String fd = &quot;/proc/self/fd/&quot; + i;                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 765                  try {                                                                                             </span>
<span class="-5133016265508323671" onmouseenter="enter('-5133016265508323671');" onmouseout="out('-5133016265508323671');" style=""> 766                      // getCanonicalPath() uses readlink behind the scene which doesn&#x27;t require                    </span>
<span class="-6226268635961992542" onmouseenter="enter('-6226268635961992542');" onmouseout="out('-6226268635961992542');" style=""> 767                      // a file descriptor.                                                                         </span>
<span class="-6892856404262336354" onmouseenter="enter('-6892856404262336354');" onmouseout="out('-6892856404262336354');" style=""> 768                      String resolved = new File(fd).getCanonicalPath();                                            </span>
<span class="-6768751510751326128" onmouseenter="enter('-6768751510751326128');" onmouseout="out('-6768751510751326128');" style=""> 769                      int type = types.indexOf(TYPE_OTHER);                                                         </span>
<span class="-848598904663730437" onmouseenter="enter('-848598904663730437');" onmouseout="out('-848598904663730437');" style=""> 770                      if (resolved.startsWith(&quot;/dev/&quot;)) {                                                           </span>
<span class="-4879693837873897752" onmouseenter="enter('-4879693837873897752');" onmouseout="out('-4879693837873897752');" style=""> 771                          type = types.indexOf(TYPE_DEV);                                                           </span>
<span class="-125641070977798446" onmouseenter="enter('-125641070977798446');" onmouseout="out('-125641070977798446');" style=""> 772                      } else if (resolved.endsWith(&quot;.apk&quot;)) {                                                       </span>
<span class="8152606461038952319" onmouseenter="enter('8152606461038952319');" onmouseout="out('8152606461038952319');" style=""> 773                          type = types.indexOf(TYPE_APK);                                                           </span>
<span class="-8895861587282636352" onmouseenter="enter('-8895861587282636352');" onmouseout="out('-8895861587282636352');" style=""> 774                      } else if (resolved.endsWith(&quot;.jar&quot;)) {                                                       </span>
<span class="6211428299849972552" onmouseenter="enter('6211428299849972552');" onmouseout="out('6211428299849972552');" style=""> 775                          type = types.indexOf(TYPE_JAR);                                                           </span>
<span class="-6474781270675272142" onmouseenter="enter('-6474781270675272142');" onmouseout="out('-6474781270675272142');" style=""> 776                      } else if (resolved.contains(&quot;/fd/pipe:&quot;)) {                                                  </span>
<span class="4492281361349576419" onmouseenter="enter('4492281361349576419');" onmouseout="out('4492281361349576419');" style=""> 777                          type = types.indexOf(TYPE_PIPE);                                                          </span>
<span class="5570982548020413210" onmouseenter="enter('5570982548020413210');" onmouseout="out('5570982548020413210');" style=""> 778                      } else if (resolved.contains(&quot;/fd/socket:&quot;)) {                                                </span>
<span class="5340928477240826099" onmouseenter="enter('5340928477240826099');" onmouseout="out('5340928477240826099');" style=""> 779                          type = types.indexOf(TYPE_SOCKET);                                                        </span>
<span class="-1889318263670279425" onmouseenter="enter('-1889318263670279425');" onmouseout="out('-1889318263670279425');" style=""> 780                      } else if (resolved.contains(&quot;/fd/anon_inode:&quot;)) {                                            </span>
<span class="7975978575615021567" onmouseenter="enter('7975978575615021567');" onmouseout="out('7975978575615021567');" style=""> 781                          type = types.indexOf(TYPE_ANON_INODE);                                                    </span>
<span class="-206211141383156363" onmouseenter="enter('-206211141383156363');" onmouseout="out('-206211141383156363');" style=""> 782                      } else if (resolved.endsWith(&quot;.db&quot;) || resolved.contains(&quot;/databases/&quot;)) {                    </span>
<span class="8848130876067097546" onmouseenter="enter('8848130876067097546');" onmouseout="out('8848130876067097546');" style=""> 783                          type = types.indexOf(TYPE_DB);                                                            </span>
<span class="-3013458219347023666" onmouseenter="enter('-3013458219347023666');" onmouseout="out('-3013458219347023666');" style=""> 784                      } else if (resolved.startsWith(&quot;/proc/&quot;) &amp;&amp; resolved.contains(&quot;/fd/&quot;)) {                      </span>
<span class="-4021067240164904881" onmouseenter="enter('-4021067240164904881');" onmouseout="out('-4021067240164904881');" style=""> 785                          // Those are the files that don&#x27;t point anywhere on the file system.                      </span>
<span class="1766191980587176647" onmouseenter="enter('1766191980587176647');" onmouseout="out('1766191980587176647');" style=""> 786                          // getCanonicalPath() wrongly interprets these as relative symlinks and                   </span>
<span class="8319631295934473117" onmouseenter="enter('8319631295934473117');" onmouseout="out('8319631295934473117');" style=""> 787                          // resolves them within /proc/&lt;pid&gt;/fd/.                                                  </span>
<span class="-6071677259167823524" onmouseenter="enter('-6071677259167823524');" onmouseout="out('-6071677259167823524');" style=""> 788                          type = types.indexOf(TYPE_NON_FS);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789                      }                                                                                             </span>
<span class="-1328162661144416286" onmouseenter="enter('-1328162661144416286');" onmouseout="out('-1328162661144416286');" style=""> 790                      count[type]++;                                                                                </span>
<span class="-6740236498121811269" onmouseenter="enter('-6740236498121811269');" onmouseout="out('-6740236498121811269');" style=""> 791                      total++;                                                                                      </span>
<span class="-1847477132387490804" onmouseenter="enter('-1847477132387490804');" onmouseout="out('-1847477132387490804');" style=""> 792                      if (files.contains(resolved)) {                                                               </span>
<span class="3216339987616567221" onmouseenter="enter('3216339987616567221');" onmouseout="out('3216339987616567221');" style=""> 793                          duplicates[type]++;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794                      }                                                                                             </span>
<span class="-556311909615308250" onmouseenter="enter('-556311909615308250');" onmouseout="out('-556311909615308250');" style=""> 795                      files.add(resolved);                                                                          </span>
<span class="3281685662955304691" onmouseenter="enter('3281685662955304691');" onmouseout="out('3281685662955304691');" style=""> 796                      if (total % SAMPLE_RATE == 0) {                                                               </span>
<span class="-5929979194141152550" onmouseenter="enter('-5929979194141152550');" onmouseout="out('-5929979194141152550');" style=""> 797                          Log.i(TAG, &quot; fd &quot; + i + &quot;: &quot; + resolved                                                   </span>
<span class="-3430556922668437990" onmouseenter="enter('-3430556922668437990');" onmouseout="out('-3430556922668437990');" style=""> 798                                  + &quot; (&quot; + types.get(type) + &quot;)&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799                      }                                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 800                  } catch (IOException e) {                                                                         </span>
<span class="-4332337590956216445" onmouseenter="enter('-4332337590956216445');" onmouseout="out('-4332337590956216445');" style=""> 801                      // Ignoring exceptions for non-existing file descriptors.                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 803              }                                                                                                     </span>
<span class="1894743204629618523" onmouseenter="enter('1894743204629618523');" onmouseout="out('1894743204629618523');" style=""> 804              for (int i = 0; i &lt; types.size(); i++) {                                                              </span>
<span class="-3358630307652497285" onmouseenter="enter('-3358630307652497285');" onmouseout="out('-3358630307652497285');" style=""> 805                  Log.i(TAG, String.format(&quot;Open %10s files: %4d total, %4d duplicates&quot;,                            </span>
<span class="-7057161233480916817" onmouseenter="enter('-7057161233480916817');" onmouseout="out('-7057161233480916817');" style=""> 806                          types.get(i), count[i], duplicates[i]));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807              }                                                                                                     </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 808          } catch (Throwable t) {                                                                                   </span>
<span class="6465726010998958367" onmouseenter="enter('6465726010998958367');" onmouseout="out('6465726010998958367');" style=""> 809              // Catch everything. This is called from an exception handler that we shouldn&#x27;t upset.                </span>
<span class="-3798752040153960224" onmouseenter="enter('-3798752040153960224');" onmouseout="out('-3798752040153960224');" style=""> 810              Log.e(TAG, &quot;Unable to log open files.&quot;, t);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="5824586583419512860" onmouseenter="enter('5824586583419512860');" onmouseout="out('5824586583419512860');" style="">   1  package com.android.launcher3;                                                                                    </span>
<span  style="">   2                                                                                                                    </span>
<span class="2479136078387107715" onmouseenter="enter('2479136078387107715');" onmouseout="out('2479136078387107715');" style="">   3  import android.appwidget.AppWidgetProviderInfo;                                                                   </span>
<span class="6810188203727856944" onmouseenter="enter('6810188203727856944');" onmouseout="out('6810188203727856944');" style="">   4  import android.content.ComponentName;                                                                             </span>
<span class="3127723864207259776" onmouseenter="enter('3127723864207259776');" onmouseout="out('3127723864207259776');" style="">   5  import android.content.ContentValues;                                                                             </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">   6  import android.content.Context;                                                                                   </span>
<span class="4122587240602557356" onmouseenter="enter('4122587240602557356');" onmouseout="out('4122587240602557356');" style="">   7  import android.content.SharedPreferences;                                                                         </span>
<span class="8582326229770324815" onmouseenter="enter('8582326229770324815');" onmouseout="out('8582326229770324815');" style="">   8  import android.content.pm.ResolveInfo;                                                                            </span>
<span class="7207138161133478555" onmouseenter="enter('7207138161133478555');" onmouseout="out('7207138161133478555');" style="">   9  import android.content.res.Resources;                                                                             </span>
<span class="6294169624328016071" onmouseenter="enter('6294169624328016071');" onmouseout="out('6294169624328016071');" style="">  10  import android.database.Cursor;                                                                                   </span>
<span class="-8322188515935618338" onmouseenter="enter('-8322188515935618338');" onmouseout="out('-8322188515935618338');" style="">  11  import android.database.sqlite.SQLiteCantOpenDatabaseException;                                                   </span>
<span class="-4895155655276492102" onmouseenter="enter('-4895155655276492102');" onmouseout="out('-4895155655276492102');" style="">  12  import android.database.sqlite.SQLiteDatabase;                                                                    </span>
<span class="250544669864164636" onmouseenter="enter('250544669864164636');" onmouseout="out('250544669864164636');" style="">  13  import android.database.sqlite.SQLiteDiskIOException;                                                             </span>
<span class="6401548559697116088" onmouseenter="enter('6401548559697116088');" onmouseout="out('6401548559697116088');" style="">  14  import android.database.sqlite.SQLiteOpenHelper;                                                                  </span>
<span class="1099656306555592784" onmouseenter="enter('1099656306555592784');" onmouseout="out('1099656306555592784');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  15 +import android.database.sqlite.SQLiteReadOnlyDatabaseException;                                                   </span>
<span class="-6379310173182770238" onmouseenter="enter('-6379310173182770238');" onmouseout="out('-6379310173182770238');" style="">  16  import android.graphics.Bitmap;                                                                                   </span>
<span class="-5221619029963095423" onmouseenter="enter('-5221619029963095423');" onmouseout="out('-5221619029963095423');" style="">  17  import android.graphics.Bitmap.Config;                                                                            </span>
<span class="-3019416561807484959" onmouseenter="enter('-3019416561807484959');" onmouseout="out('-3019416561807484959');" style="">  18  import android.graphics.BitmapFactory;                                                                            </span>
<span class="-8489723247854845487" onmouseenter="enter('-8489723247854845487');" onmouseout="out('-8489723247854845487');" style="">  19  import android.graphics.BitmapShader;                                                                             </span>
<span class="-6358617885644310547" onmouseenter="enter('-6358617885644310547');" onmouseout="out('-6358617885644310547');" style="">  20  import android.graphics.Canvas;                                                                                   </span>
<span class="1046407090334580529" onmouseenter="enter('1046407090334580529');" onmouseout="out('1046407090334580529');" style="">  21  import android.graphics.ColorMatrix;                                                                              </span>
<span class="-2638342757206578386" onmouseenter="enter('-2638342757206578386');" onmouseout="out('-2638342757206578386');" style="">  22  import android.graphics.ColorMatrixColorFilter;                                                                   </span>
<span class="-1586527322890291073" onmouseenter="enter('-1586527322890291073');" onmouseout="out('-1586527322890291073');" style="">  23  import android.graphics.Paint;                                                                                    </span>
<span class="7353926919338897104" onmouseenter="enter('7353926919338897104');" onmouseout="out('7353926919338897104');" style="">  24  import android.graphics.PorterDuff;                                                                               </span>
<span class="2207333516549486115" onmouseenter="enter('2207333516549486115');" onmouseout="out('2207333516549486115');" style="">  25  import android.graphics.Rect;                                                                                     </span>
<span class="-787513569742028665" onmouseenter="enter('-787513569742028665');" onmouseout="out('-787513569742028665');" style="">  26  import android.graphics.Shader;                                                                                   </span>
<span class="3047127677032988177" onmouseenter="enter('3047127677032988177');" onmouseout="out('3047127677032988177');" style="">  27  import android.graphics.drawable.BitmapDrawable;                                                                  </span>
<span class="-1737226814075322931" onmouseenter="enter('-1737226814075322931');" onmouseout="out('-1737226814075322931');" style="">  28  import android.graphics.drawable.Drawable;                                                                        </span>
<span class="955674827050616793" onmouseenter="enter('955674827050616793');" onmouseout="out('955674827050616793');" style="">  29  import android.os.AsyncTask;                                                                                      </span>
<span class="-4549785658871057260" onmouseenter="enter('-4549785658871057260');" onmouseout="out('-4549785658871057260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import android.os.Build;                                                                                          </span>
<span class="7196841398407674858" onmouseenter="enter('7196841398407674858');" onmouseout="out('7196841398407674858');" style="">  31  import android.util.Log;                                                                                          </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -                                                                                                                  </span>
<span class="-2301578055393860706" onmouseenter="enter('-2301578055393860706');" onmouseout="out('-2301578055393860706');" style="">  33  import com.android.launcher3.compat.AppWidgetManagerCompat;                                                       </span>
<span  style="">  34                                                                                                                    </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">  35  import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  36  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  37  import java.io.IOException;                                                                                       </span>
<span class="-9136849050553086203" onmouseenter="enter('-9136849050553086203');" onmouseout="out('-9136849050553086203');" style="">  38  import java.lang.ref.SoftReference;                                                                               </span>
<span class="-8692343821508153377" onmouseenter="enter('-8692343821508153377');" onmouseout="out('-8692343821508153377');" style="">  39  import java.lang.ref.WeakReference;                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  40  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  41  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  42  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  43  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  44  import java.util.List;                                                                                            </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  45  import java.util.concurrent.Callable;                                                                             </span>
<span class="6613496282884511495" onmouseenter="enter('6613496282884511495');" onmouseout="out('6613496282884511495');" style="">  46  import java.util.concurrent.ExecutionException;                                                                   </span>
<span  style="">  47                                                                                                                    </span>
<span class="-4311378840888985036" onmouseenter="enter('-4311378840888985036');" onmouseout="out('-4311378840888985036');" style="">  48  public class WidgetPreviewLoader {                                                                                </span>
<span  style="">  49                                                                                                                    </span>
<span class="-3230874476111875794" onmouseenter="enter('-3230874476111875794');" onmouseout="out('-3230874476111875794');" style="">  50      private static abstract class SoftReferenceThreadLocal&lt;T&gt; {                                                   </span>
<span class="144884583078774733" onmouseenter="enter('144884583078774733');" onmouseout="out('144884583078774733');" style="">  51          private ThreadLocal&lt;SoftReference&lt;T&gt;&gt; mThreadLocal;                                                       </span>
<span class="-4387433322567605136" onmouseenter="enter('-4387433322567605136');" onmouseout="out('-4387433322567605136');" style="">  52          public SoftReferenceThreadLocal() {                                                                       </span>
<span class="4702884186935866826" onmouseenter="enter('4702884186935866826');" onmouseout="out('4702884186935866826');" style="">  53              mThreadLocal = new ThreadLocal&lt;SoftReference&lt;T&gt;&gt;();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  54          }                                                                                                         </span>
<span  style="">  55                                                                                                                    </span>
<span class="7611856356089156666" onmouseenter="enter('7611856356089156666');" onmouseout="out('7611856356089156666');" style="">  56          abstract T initialValue();                                                                                </span>
<span  style="">  57                                                                                                                    </span>
<span class="-5049902553319226708" onmouseenter="enter('-5049902553319226708');" onmouseout="out('-5049902553319226708');" style="">  58          public void set(T t) {                                                                                    </span>
<span class="4998900635420746153" onmouseenter="enter('4998900635420746153');" onmouseout="out('4998900635420746153');" style="">  59              mThreadLocal.set(new SoftReference&lt;T&gt;(t));                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60          }                                                                                                         </span>
<span  style="">  61                                                                                                                    </span>
<span class="-6159920038780308483" onmouseenter="enter('-6159920038780308483');" onmouseout="out('-6159920038780308483');" style="">  62          public T get() {                                                                                          </span>
<span class="-967899869235114258" onmouseenter="enter('-967899869235114258');" onmouseout="out('-967899869235114258');" style="">  63              SoftReference&lt;T&gt; reference = mThreadLocal.get();                                                      </span>
<span class="-6948245133825727275" onmouseenter="enter('-6948245133825727275');" onmouseout="out('-6948245133825727275');" style="">  64              T obj;                                                                                                </span>
<span class="-5692723719917447196" onmouseenter="enter('-5692723719917447196');" onmouseout="out('-5692723719917447196');" style="">  65              if (reference == null) {                                                                              </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  66                  obj = initialValue();                                                                             </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  67                  mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                                      </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  68                  return obj;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  69              } else {                                                                                              </span>
<span class="-2769798515494474030" onmouseenter="enter('-2769798515494474030');" onmouseout="out('-2769798515494474030');" style="">  70                  obj = reference.get();                                                                            </span>
<span class="9024370751945626489" onmouseenter="enter('9024370751945626489');" onmouseout="out('9024370751945626489');" style="">  71                  if (obj == null) {                                                                                </span>
<span class="7753397417564625015" onmouseenter="enter('7753397417564625015');" onmouseout="out('7753397417564625015');" style="">  72                      obj = initialValue();                                                                         </span>
<span class="-9194382528129110009" onmouseenter="enter('-9194382528129110009');" onmouseout="out('-9194382528129110009');" style="">  73                      mThreadLocal.set(new SoftReference&lt;T&gt;(obj));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74                  }                                                                                                 </span>
<span class="6899018813308939848" onmouseenter="enter('6899018813308939848');" onmouseout="out('6899018813308939848');" style="">  75                  return obj;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78      }                                                                                                             </span>
<span  style="">  79                                                                                                                    </span>
<span class="-5055153777344084118" onmouseenter="enter('-5055153777344084118');" onmouseout="out('-5055153777344084118');" style="">  80      private static class CanvasCache extends SoftReferenceThreadLocal&lt;Canvas&gt; {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81          @Override                                                                                                 </span>
<span class="-4761875685905818114" onmouseenter="enter('-4761875685905818114');" onmouseout="out('-4761875685905818114');" style="">  82          protected Canvas initialValue() {                                                                         </span>
<span class="-2278895108809265326" onmouseenter="enter('-2278895108809265326');" onmouseout="out('-2278895108809265326');" style="">  83              return new Canvas();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="-1261255052546611379" onmouseenter="enter('-1261255052546611379');" onmouseout="out('-1261255052546611379');" style="">  87      private static class PaintCache extends SoftReferenceThreadLocal&lt;Paint&gt; {                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  88          @Override                                                                                                 </span>
<span class="5455192562670218369" onmouseenter="enter('5455192562670218369');" onmouseout="out('5455192562670218369');" style="">  89          protected Paint initialValue() {                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  90              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92      }                                                                                                             </span>
<span  style="">  93                                                                                                                    </span>
<span class="1990146601739059582" onmouseenter="enter('1990146601739059582');" onmouseout="out('1990146601739059582');" style="">  94      private static class BitmapCache extends SoftReferenceThreadLocal&lt;Bitmap&gt; {                                   </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95          @Override                                                                                                 </span>
<span class="5445413510754308036" onmouseenter="enter('5445413510754308036');" onmouseout="out('5445413510754308036');" style="">  96          protected Bitmap initialValue() {                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">  97              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-4690039068512610596" onmouseenter="enter('-4690039068512610596');" onmouseout="out('-4690039068512610596');" style=""> 101      private static class RectCache extends SoftReferenceThreadLocal&lt;Rect&gt; {                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102          @Override                                                                                                 </span>
<span class="8484771223674222626" onmouseenter="enter('8484771223674222626');" onmouseout="out('8484771223674222626');" style=""> 103          protected Rect initialValue() {                                                                           </span>
<span class="3126951611359421696" onmouseenter="enter('3126951611359421696');" onmouseout="out('3126951611359421696');" style=""> 104              return new Rect();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-1412995145802516532" onmouseenter="enter('-1412995145802516532');" onmouseout="out('-1412995145802516532');" style=""> 108      private static class BitmapFactoryOptionsCache extends                                                        </span>
<span class="6571896484354186661" onmouseenter="enter('6571896484354186661');" onmouseout="out('6571896484354186661');" style=""> 109              SoftReferenceThreadLocal&lt;BitmapFactory.Options&gt; {                                                     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110          @Override                                                                                                 </span>
<span class="-8328117947754333521" onmouseenter="enter('-8328117947754333521');" onmouseout="out('-8328117947754333521');" style=""> 111          protected BitmapFactory.Options initialValue() {                                                          </span>
<span class="-4117267854178586248" onmouseenter="enter('-4117267854178586248');" onmouseout="out('-4117267854178586248');" style=""> 112              return new BitmapFactory.Options();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114      }                                                                                                             </span>
<span  style=""> 115                                                                                                                    </span>
<span class="2416799479879720027" onmouseenter="enter('2416799479879720027');" onmouseout="out('2416799479879720027');" style=""> 116      private static final String TAG = &quot;WidgetPreviewLoader&quot;;                                                      </span>
<span class="4075932221748513041" onmouseenter="enter('4075932221748513041');" onmouseout="out('4075932221748513041');" style=""> 117      private static final String ANDROID_INCREMENTAL_VERSION_NAME_KEY = &quot;android.incremental.version&quot;;             </span>
<span  style=""> 118                                                                                                                    </span>
<span class="7524285546086861850" onmouseenter="enter('7524285546086861850');" onmouseout="out('7524285546086861850');" style=""> 119      private static final float WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE = 0.25f;                                    </span>
<span class="1902323072201125531" onmouseenter="enter('1902323072201125531');" onmouseout="out('1902323072201125531');" style=""> 120      private static final HashSet&lt;String&gt; sInvalidPackages = new HashSet&lt;String&gt;();                                </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-1592852916986124351" onmouseenter="enter('-1592852916986124351');" onmouseout="out('-1592852916986124351');" style=""> 122      // Used for drawing shortcut previews                                                                         </span>
<span class="333450150533861200" onmouseenter="enter('333450150533861200');" onmouseout="out('333450150533861200');" style=""> 123      private final BitmapCache mCachedShortcutPreviewBitmap = new BitmapCache();                                   </span>
<span class="6665675930715155383" onmouseenter="enter('6665675930715155383');" onmouseout="out('6665675930715155383');" style=""> 124      private final PaintCache mCachedShortcutPreviewPaint = new PaintCache();                                      </span>
<span class="1096761732692819631" onmouseenter="enter('1096761732692819631');" onmouseout="out('1096761732692819631');" style=""> 125      private final CanvasCache mCachedShortcutPreviewCanvas = new CanvasCache();                                   </span>
<span  style=""> 126                                                                                                                    </span>
<span class="8470360627479616485" onmouseenter="enter('8470360627479616485');" onmouseout="out('8470360627479616485');" style=""> 127      // Used for drawing widget previews                                                                           </span>
<span class="-3956456794742254913" onmouseenter="enter('-3956456794742254913');" onmouseout="out('-3956456794742254913');" style=""> 128      private final CanvasCache mCachedAppWidgetPreviewCanvas = new CanvasCache();                                  </span>
<span class="2994302144561928781" onmouseenter="enter('2994302144561928781');" onmouseout="out('2994302144561928781');" style=""> 129      private final RectCache mCachedAppWidgetPreviewSrcRect = new RectCache();                                     </span>
<span class="-2432735040368044940" onmouseenter="enter('-2432735040368044940');" onmouseout="out('-2432735040368044940');" style=""> 130      private final RectCache mCachedAppWidgetPreviewDestRect = new RectCache();                                    </span>
<span class="-1839110596677388209" onmouseenter="enter('-1839110596677388209');" onmouseout="out('-1839110596677388209');" style=""> 131      private final PaintCache mCachedAppWidgetPreviewPaint = new PaintCache();                                     </span>
<span class="4215417609313429507" onmouseenter="enter('4215417609313429507');" onmouseout="out('4215417609313429507');" style=""> 132      private final PaintCache mDefaultAppWidgetPreviewPaint = new PaintCache();                                    </span>
<span class="7799865446872866624" onmouseenter="enter('7799865446872866624');" onmouseout="out('7799865446872866624');" style=""> 133      private final BitmapFactoryOptionsCache mCachedBitmapFactoryOptions = new BitmapFactoryOptionsCache();        </span>
<span  style=""> 134                                                                                                                    </span>
<span class="6069704076318384736" onmouseenter="enter('6069704076318384736');" onmouseout="out('6069704076318384736');" style=""> 135      private final HashMap&lt;String, WeakReference&lt;Bitmap&gt;&gt; mLoadedPreviews = new HashMap&lt;&gt;();                       </span>
<span class="4704413017067310429" onmouseenter="enter('4704413017067310429');" onmouseout="out('4704413017067310429');" style=""> 136      private final ArrayList&lt;SoftReference&lt;Bitmap&gt;&gt; mUnusedBitmaps = new ArrayList&lt;&gt;();                            </span>


<span  style=""> 137                                                                                                                    </span>
<span class="-2672328117217234149" onmouseenter="enter('-2672328117217234149');" onmouseout="out('-2672328117217234149');" style=""> 138      private final Context mContext;                                                                               </span>
<span class="-7489384078469018359" onmouseenter="enter('-7489384078469018359');" onmouseout="out('-7489384078469018359');" style=""> 139      private final int mAppIconSize;                                                                               </span>
<span class="2729881913605020060" onmouseenter="enter('2729881913605020060');" onmouseout="out('2729881913605020060');" style=""> 140      private final IconCache mIconCache;                                                                           </span>
<span class="9150498506085829362" onmouseenter="enter('9150498506085829362');" onmouseout="out('9150498506085829362');" style=""> 141      private final AppWidgetManagerCompat mManager;                                                                </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-8162128579730225382" onmouseenter="enter('-8162128579730225382');" onmouseout="out('-8162128579730225382');" style=""> 143      private int mPreviewBitmapWidth;                                                                              </span>
<span class="4768970035560221699" onmouseenter="enter('4768970035560221699');" onmouseout="out('4768970035560221699');" style=""> 144      private int mPreviewBitmapHeight;                                                                             </span>
<span class="-2278862546333248339" onmouseenter="enter('-2278862546333248339');" onmouseout="out('-2278862546333248339');" style=""> 145      private String mSize;                                                                                         </span>
<span class="-4195956876020483478" onmouseenter="enter('-4195956876020483478');" onmouseout="out('-4195956876020483478');" style=""> 146      private PagedViewCellLayout mWidgetSpacingLayout;                                                             </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-7229982499992821578" onmouseenter="enter('-7229982499992821578');" onmouseout="out('-7229982499992821578');" style=""> 148      private String mCachedSelectQuery;                                                                            </span>
<span  style=""> 149                                                                                                                    </span>
<span  style=""> 150                                                                                                                    </span>
<span class="6719315262198447761" onmouseenter="enter('6719315262198447761');" onmouseout="out('6719315262198447761');" style=""> 151      private CacheDb mDb;                                                                                          </span>
<span  style=""> 152                                                                                                                    </span>
<span class="140559351311799615" onmouseenter="enter('140559351311799615');" onmouseout="out('140559351311799615');" style=""> 153      private final MainThreadExecutor mMainThreadExecutor = new MainThreadExecutor();                              </span>
<span  style=""> 154                                                                                                                    </span>
<span class="-5828204717811548952" onmouseenter="enter('-5828204717811548952');" onmouseout="out('-5828204717811548952');" style=""> 155      public WidgetPreviewLoader(Context context) {                                                                 </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 156          LauncherAppState app = LauncherAppState.getInstance();                                                    </span>
<span class="-6320967880672955396" onmouseenter="enter('-6320967880672955396');" onmouseout="out('-6320967880672955396');" style=""> 157          DeviceProfile grid = app.getDynamicGrid().getDeviceProfile();                                             </span>
<span  style=""> 158                                                                                                                    </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 159          mContext = context;                                                                                       </span>
<span class="3163588368111647063" onmouseenter="enter('3163588368111647063');" onmouseout="out('3163588368111647063');" style=""> 160          mAppIconSize = grid.iconSizePx;                                                                           </span>
<span class="5599943198543537657" onmouseenter="enter('5599943198543537657');" onmouseout="out('5599943198543537657');" style=""> 161          mIconCache = app.getIconCache();                                                                          </span>
<span class="3481132346717467494" onmouseenter="enter('3481132346717467494');" onmouseout="out('3481132346717467494');" style=""> 162          mManager = AppWidgetManagerCompat.getInstance(context);                                                   </span>
<span  style=""> 163                                                                                                                    </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 164          mDb = app.getWidgetPreviewCacheDb();                                                                      </span>
<span  style=""> 165                                                                                                                    </span>
<span class="2019816042868645703" onmouseenter="enter('2019816042868645703');" onmouseout="out('2019816042868645703');" style=""> 166          SharedPreferences sp = context.getSharedPreferences(                                                      </span>
<span class="-3012020800644432647" onmouseenter="enter('-3012020800644432647');" onmouseout="out('-3012020800644432647');" style=""> 167                  LauncherAppState.getSharedPreferencesKey(), Context.MODE_PRIVATE);                                </span>
<span class="7599352561706696094" onmouseenter="enter('7599352561706696094');" onmouseout="out('7599352561706696094');" style=""> 168          final String lastVersionName = sp.getString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, null);                  </span>
<span class="-8837714544016106839" onmouseenter="enter('-8837714544016106839');" onmouseout="out('-8837714544016106839');" style=""> 169          final String versionName = android.os.Build.VERSION.INCREMENTAL;                                          </span>
<span class="5360402256484915856" onmouseenter="enter('5360402256484915856');" onmouseout="out('5360402256484915856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +        final boolean isLollipopOrGreater = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP;                </span>
<span class="783153757862539722" onmouseenter="enter('783153757862539722');" onmouseout="out('783153757862539722');" style=""> 171          if (!versionName.equals(lastVersionName)) {                                                               </span>
<span class="4086555010887297457" onmouseenter="enter('4086555010887297457');" onmouseout="out('4086555010887297457');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -            // clear all the previews whenever the system version changes, to ensure that previews                </span>
<span class="-6776657436582370181" onmouseenter="enter('-6776657436582370181');" onmouseout="out('-6776657436582370181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -            // are up-to-date for any apps that might have been updated with the system                           </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -            clearDb();                                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -                                                                                                                  </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -            SharedPreferences.Editor editor = sp.edit();                                                          </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -            editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                                  </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -            editor.commit();                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +            try {                                                                                                 </span>
<span class="-1043062607084730911" onmouseenter="enter('-1043062607084730911');" onmouseout="out('-1043062607084730911');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +                // clear all the previews whenever the system version changes, to ensure that                     </span>
<span class="-3090272541711713949" onmouseenter="enter('-3090272541711713949');" onmouseout="out('-3090272541711713949');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +                // previews are up-to-date for any apps that might have been updated with the system              </span>
<span class="-4102017179720208646" onmouseenter="enter('-4102017179720208646');" onmouseout="out('-4102017179720208646');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +                clearDb();                                                                                        </span>
<span class="-1695662722736394565" onmouseenter="enter('-1695662722736394565');" onmouseout="out('-1695662722736394565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +            } catch (SQLiteReadOnlyDatabaseException e) {                                                         </span>
<span class="-1402409748038375417" onmouseenter="enter('-1402409748038375417');" onmouseout="out('-1402409748038375417');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                if (isLollipopOrGreater) {                                                                        </span>
<span class="4563883382536909725" onmouseenter="enter('4563883382536909725');" onmouseout="out('4563883382536909725');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                    // Workaround for Bug. 18554839, if we fail to clear the db due to the read-only              </span>
<span class="-8655931993367482528" onmouseenter="enter('-8655931993367482528');" onmouseout="out('-8655931993367482528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                    // issue, then ignore this error and leave the old previews                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                } else {                                                                                          </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                    throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                }                                                                                                 </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +            } finally {                                                                                           </span>
<span class="2898240485600869061" onmouseenter="enter('2898240485600869061');" onmouseout="out('2898240485600869061');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                SharedPreferences.Editor editor = sp.edit();                                                      </span>
<span class="-4813937626585297253" onmouseenter="enter('-4813937626585297253');" onmouseout="out('-4813937626585297253');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                editor.putString(ANDROID_INCREMENTAL_VERSION_NAME_KEY, versionName);                              </span>
<span class="-1350952079334021013" onmouseenter="enter('-1350952079334021013');" onmouseout="out('-1350952079334021013');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                editor.commit();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +            }                                                                                                     </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-5192536186729189916" onmouseenter="enter('-5192536186729189916');" onmouseout="out('-5192536186729189916');" style=""> 198      public void recreateDb() {                                                                                    </span>
<span class="5758562287855425209" onmouseenter="enter('5758562287855425209');" onmouseout="out('5758562287855425209');" style=""> 199          LauncherAppState app = LauncherAppState.getInstance();                                                    </span>
<span class="-9124614627721688628" onmouseenter="enter('-9124614627721688628');" onmouseout="out('-9124614627721688628');" style=""> 200          app.recreateWidgetPreviewDb();                                                                            </span>
<span class="7386178516732423650" onmouseenter="enter('7386178516732423650');" onmouseout="out('7386178516732423650');" style=""> 201          mDb = app.getWidgetPreviewCacheDb();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202      }                                                                                                             </span>
<span  style=""> 203                                                                                                                    </span>
<span class="1041361483340123386" onmouseenter="enter('1041361483340123386');" onmouseout="out('1041361483340123386');" style=""> 204      public void setPreviewSize(int previewWidth, int previewHeight,                                               </span>
<span class="-864889589589090056" onmouseenter="enter('-864889589589090056');" onmouseout="out('-864889589589090056');" style=""> 205              PagedViewCellLayout widgetSpacingLayout) {                                                            </span>
<span class="7215920596152382710" onmouseenter="enter('7215920596152382710');" onmouseout="out('7215920596152382710');" style=""> 206          mPreviewBitmapWidth = previewWidth;                                                                       </span>
<span class="-1710948131163314144" onmouseenter="enter('-1710948131163314144');" onmouseout="out('-1710948131163314144');" style=""> 207          mPreviewBitmapHeight = previewHeight;                                                                     </span>
<span class="-2589016613696609257" onmouseenter="enter('-2589016613696609257');" onmouseout="out('-2589016613696609257');" style=""> 208          mSize = previewWidth + &quot;x&quot; + previewHeight;                                                               </span>
<span class="-2003385001531882656" onmouseenter="enter('-2003385001531882656');" onmouseout="out('-2003385001531882656');" style=""> 209          mWidgetSpacingLayout = widgetSpacingLayout;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="9100103105710524909" onmouseenter="enter('9100103105710524909');" onmouseout="out('9100103105710524909');" style=""> 212      public Bitmap getPreview(final Object o) {                                                                    </span>
<span class="7210064752111263529" onmouseenter="enter('7210064752111263529');" onmouseout="out('7210064752111263529');" style=""> 213          final String name = getObjectName(o);                                                                     </span>
<span class="-4502422735439147840" onmouseenter="enter('-4502422735439147840');" onmouseout="out('-4502422735439147840');" style=""> 214          final String packageName = getObjectPackage(o);                                                           </span>
<span class="6483702398021407461" onmouseenter="enter('6483702398021407461');" onmouseout="out('6483702398021407461');" style=""> 215          // check if the package is valid                                                                          </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 216          synchronized(sInvalidPackages) {                                                                          </span>
<span class="6205084711389939864" onmouseenter="enter('6205084711389939864');" onmouseout="out('6205084711389939864');" style=""> 217              boolean packageValid = !sInvalidPackages.contains(packageName);                                       </span>
<span class="5936168059174575986" onmouseenter="enter('5936168059174575986');" onmouseout="out('5936168059174575986');" style=""> 218              if (!packageValid) {                                                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 219                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221          }                                                                                                         </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 222          synchronized(mLoadedPreviews) {                                                                           </span>
<span class="-7479974433139738260" onmouseenter="enter('-7479974433139738260');" onmouseout="out('-7479974433139738260');" style=""> 223              // check if it exists in our existing cache                                                           </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 224              if (mLoadedPreviews.containsKey(name)) {                                                              </span>
<span class="-5798374742760410220" onmouseenter="enter('-5798374742760410220');" onmouseout="out('-5798374742760410220');" style=""> 225                  WeakReference&lt;Bitmap&gt; bitmapReference = mLoadedPreviews.get(name);                                </span>
<span class="-5072696511706589798" onmouseenter="enter('-5072696511706589798');" onmouseout="out('-5072696511706589798');" style=""> 226                  Bitmap bitmap = bitmapReference.get();                                                            </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 227                  if (bitmap != null) {                                                                             </span>
<span class="-2669835381987628663" onmouseenter="enter('-2669835381987628663');" onmouseout="out('-2669835381987628663');" style=""> 228                      return bitmap;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231          }                                                                                                         </span>
<span  style=""> 232                                                                                                                    </span>
<span class="-1660586751969869388" onmouseenter="enter('-1660586751969869388');" onmouseout="out('-1660586751969869388');" style=""> 233          Bitmap unusedBitmap = null;                                                                               </span>
<span class="7613513134986517501" onmouseenter="enter('7613513134986517501');" onmouseout="out('7613513134986517501');" style=""> 234          synchronized(mUnusedBitmaps) {                                                                            </span>
<span class="134332774856407035" onmouseenter="enter('134332774856407035');" onmouseout="out('134332774856407035');" style=""> 235              // not in cache; we need to load it from the db                                                       </span>
<span class="1411220366891100168" onmouseenter="enter('1411220366891100168');" onmouseout="out('1411220366891100168');" style=""> 236              while (unusedBitmap == null &amp;&amp; mUnusedBitmaps.size() &gt; 0) {                                           </span>
<span class="3514361872991648197" onmouseenter="enter('3514361872991648197');" onmouseout="out('3514361872991648197');" style=""> 237                  Bitmap candidate = mUnusedBitmaps.remove(0).get();                                                </span>
<span class="-3857479151276842222" onmouseenter="enter('-3857479151276842222');" onmouseout="out('-3857479151276842222');" style=""> 238                  if (candidate != null &amp;&amp; candidate.isMutable() &amp;&amp;                                                 </span>
<span class="-7425312185904228324" onmouseenter="enter('-7425312185904228324');" onmouseout="out('-7425312185904228324');" style=""> 239                          candidate.getWidth() == mPreviewBitmapWidth &amp;&amp;                                            </span>
<span class="-897867530819106482" onmouseenter="enter('-897867530819106482');" onmouseout="out('-897867530819106482');" style=""> 240                          candidate.getHeight() == mPreviewBitmapHeight) {                                          </span>
<span class="-7974711513755834014" onmouseenter="enter('-7974711513755834014');" onmouseout="out('-7974711513755834014');" style=""> 241                      unusedBitmap = candidate;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243              }                                                                                                     </span>
<span class="-1806752935370283796" onmouseenter="enter('-1806752935370283796');" onmouseout="out('-1806752935370283796');" style=""> 244              if (unusedBitmap != null) {                                                                           </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 245                  final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                             </span>
<span class="-7568013336659090919" onmouseenter="enter('-7568013336659090919');" onmouseout="out('-7568013336659090919');" style=""> 246                  c.setBitmap(unusedBitmap);                                                                        </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 247                  c.drawColor(0, PorterDuff.Mode.CLEAR);                                                            </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 248                  c.setBitmap(null);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250          }                                                                                                         </span>
<span  style=""> 251                                                                                                                    </span>
<span class="-7521323678416918441" onmouseenter="enter('-7521323678416918441');" onmouseout="out('-7521323678416918441');" style=""> 252          if (unusedBitmap == null) {                                                                               </span>
<span class="-3551833031540614706" onmouseenter="enter('-3551833031540614706');" onmouseout="out('-3551833031540614706');" style=""> 253              unusedBitmap = Bitmap.createBitmap(mPreviewBitmapWidth, mPreviewBitmapHeight,                         </span>
<span class="273441602049516461" onmouseenter="enter('273441602049516461');" onmouseout="out('273441602049516461');" style=""> 254                      Bitmap.Config.ARGB_8888);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255          }                                                                                                         </span>
<span class="-8985062989738227550" onmouseenter="enter('-8985062989738227550');" onmouseout="out('-8985062989738227550');" style=""> 256          Bitmap preview = readFromDb(name, unusedBitmap);                                                          </span>
<span  style=""> 257                                                                                                                    </span>
<span class="-760731434728754948" onmouseenter="enter('-760731434728754948');" onmouseout="out('-760731434728754948');" style=""> 258          if (preview != null) {                                                                                    </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 259              synchronized(mLoadedPreviews) {                                                                       </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 260                  mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261              }                                                                                                     </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 262              return preview;                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 263          } else {                                                                                                  </span>
<span class="3460679213489770567" onmouseenter="enter('3460679213489770567');" onmouseout="out('3460679213489770567');" style=""> 264              // it&#x27;s not in the db... we need to generate it                                                       </span>
<span class="7452120778445413168" onmouseenter="enter('7452120778445413168');" onmouseout="out('7452120778445413168');" style=""> 265              final Bitmap generatedPreview = generatePreview(o, unusedBitmap);                                     </span>
<span class="-4291180510938406114" onmouseenter="enter('-4291180510938406114');" onmouseout="out('-4291180510938406114');" style=""> 266              preview = generatedPreview;                                                                           </span>
<span class="7396852523530524307" onmouseenter="enter('7396852523530524307');" onmouseout="out('7396852523530524307');" style=""> 267              if (preview != unusedBitmap) {                                                                        </span>
<span class="-7211694849959051791" onmouseenter="enter('-7211694849959051791');" onmouseout="out('-7211694849959051791');" style=""> 268                  throw new RuntimeException(&quot;generatePreview is not recycling the bitmap &quot; + o);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269              }                                                                                                     </span>
<span  style=""> 270                                                                                                                    </span>
<span class="6050559672609167697" onmouseenter="enter('6050559672609167697');" onmouseout="out('6050559672609167697');" style=""> 271              synchronized(mLoadedPreviews) {                                                                       </span>
<span class="1580868825163869023" onmouseenter="enter('1580868825163869023');" onmouseout="out('1580868825163869023');" style=""> 272                  mLoadedPreviews.put(name, new WeakReference&lt;Bitmap&gt;(preview));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273              }                                                                                                     </span>
<span  style=""> 274                                                                                                                    </span>
<span class="-5733309973697321639" onmouseenter="enter('-5733309973697321639');" onmouseout="out('-5733309973697321639');" style=""> 275              // write to db on a thread pool... this can be done lazily and improves the performance               </span>
<span class="-8551030995294829944" onmouseenter="enter('-8551030995294829944');" onmouseout="out('-8551030995294829944');" style=""> 276              // of the first time widget previews are loaded                                                       </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 277              new AsyncTask&lt;Void, Void, Void&gt;() {                                                                   </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 278                  public Void doInBackground(Void ... args) {                                                       </span>
<span class="5794871779597006615" onmouseenter="enter('5794871779597006615');" onmouseout="out('5794871779597006615');" style=""> 279                      writeToDb(o, generatedPreview);                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 280                      return null;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281                  }                                                                                                 </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 282              }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                     </span>
<span  style=""> 283                                                                                                                    </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 284              return preview;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286      }                                                                                                             </span>
<span  style=""> 287                                                                                                                    </span>
<span class="-2058417025959444842" onmouseenter="enter('-2058417025959444842');" onmouseout="out('-2058417025959444842');" style=""> 288      public void recycleBitmap(Object o, Bitmap bitmapToRecycle) {                                                 </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 289          String name = getObjectName(o);                                                                           </span>
<span class="-4798838159901813780" onmouseenter="enter('-4798838159901813780');" onmouseout="out('-4798838159901813780');" style=""> 290          synchronized (mLoadedPreviews) {                                                                          </span>
<span class="-7229898350656685873" onmouseenter="enter('-7229898350656685873');" onmouseout="out('-7229898350656685873');" style=""> 291              if (mLoadedPreviews.containsKey(name)) {                                                              </span>
<span class="5945201469012860218" onmouseenter="enter('5945201469012860218');" onmouseout="out('5945201469012860218');" style=""> 292                  Bitmap b = mLoadedPreviews.get(name).get();                                                       </span>
<span class="9172312796342865011" onmouseenter="enter('9172312796342865011');" onmouseout="out('9172312796342865011');" style=""> 293                  if (b == bitmapToRecycle) {                                                                       </span>
<span class="-3845835638768486269" onmouseenter="enter('-3845835638768486269');" onmouseout="out('-3845835638768486269');" style=""> 294                      mLoadedPreviews.remove(name);                                                                 </span>
<span class="1962405822662822843" onmouseenter="enter('1962405822662822843');" onmouseout="out('1962405822662822843');" style=""> 295                      if (bitmapToRecycle.isMutable()) {                                                            </span>
<span class="732538049861401327" onmouseenter="enter('732538049861401327');" onmouseout="out('732538049861401327');" style=""> 296                          synchronized (mUnusedBitmaps) {                                                           </span>
<span class="7654440137511857398" onmouseenter="enter('7654440137511857398');" onmouseout="out('7654440137511857398');" style=""> 297                              mUnusedBitmaps.add(new SoftReference&lt;Bitmap&gt;(b));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299                      }                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 300                  } else {                                                                                          </span>
<span class="-7483999424756026389" onmouseenter="enter('-7483999424756026389');" onmouseout="out('-7483999424756026389');" style=""> 301                      throw new RuntimeException(&quot;Bitmap passed in doesn&#x27;t match up&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305      }                                                                                                             </span>
<span  style=""> 306                                                                                                                    </span>
<span class="-6828234266968088645" onmouseenter="enter('-6828234266968088645');" onmouseout="out('-6828234266968088645');" style=""> 307      static class CacheDb extends SQLiteOpenHelper {                                                               </span>
<span class="-2905037825538645689" onmouseenter="enter('-2905037825538645689');" onmouseout="out('-2905037825538645689');" style=""> 308          final static int DB_VERSION = 2;                                                                          </span>
<span class="3671038644302744996" onmouseenter="enter('3671038644302744996');" onmouseout="out('3671038644302744996');" style=""> 309          final static String DB_NAME = &quot;widgetpreviews.db&quot;;                                                        </span>
<span class="-4997316780024779267" onmouseenter="enter('-4997316780024779267');" onmouseout="out('-4997316780024779267');" style=""> 310          final static String TABLE_NAME = &quot;shortcut_and_widget_previews&quot;;                                          </span>
<span class="-5742805130150616813" onmouseenter="enter('-5742805130150616813');" onmouseout="out('-5742805130150616813');" style=""> 311          final static String COLUMN_NAME = &quot;name&quot;;                                                                 </span>
<span class="8854376481192602334" onmouseenter="enter('8854376481192602334');" onmouseout="out('8854376481192602334');" style=""> 312          final static String COLUMN_SIZE = &quot;size&quot;;                                                                 </span>
<span class="6902810344350480074" onmouseenter="enter('6902810344350480074');" onmouseout="out('6902810344350480074');" style=""> 313          final static String COLUMN_PREVIEW_BITMAP = &quot;preview_bitmap&quot;;                                             </span>
<span class="-5996057254067063760" onmouseenter="enter('-5996057254067063760');" onmouseout="out('-5996057254067063760');" style=""> 314          Context mContext;                                                                                         </span>
<span  style=""> 315                                                                                                                    </span>
<span class="-1572964554793598477" onmouseenter="enter('-1572964554793598477');" onmouseout="out('-1572964554793598477');" style=""> 316          public CacheDb(Context context) {                                                                         </span>
<span class="1204687355095372073" onmouseenter="enter('1204687355095372073');" onmouseout="out('1204687355095372073');" style=""> 317              super(context, new File(context.getCacheDir(), DB_NAME).getPath(), null, DB_VERSION);                 </span>


<span class="-5483301966583099443" onmouseenter="enter('-5483301966583099443');" onmouseout="out('-5483301966583099443');" style=""> 318              // Store the context for later use                                                                    </span>
<span class="7260904205784329196" onmouseenter="enter('7260904205784329196');" onmouseout="out('7260904205784329196');" style=""> 319              mContext = context;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320          }                                                                                                         </span>
<span  style=""> 321                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 322          @Override                                                                                                 </span>
<span class="-3622240674415739784" onmouseenter="enter('-3622240674415739784');" onmouseout="out('-3622240674415739784');" style=""> 323          public void onCreate(SQLiteDatabase database) {                                                           </span>
<span class="-5851870806192660982" onmouseenter="enter('-5851870806192660982');" onmouseout="out('-5851870806192660982');" style=""> 324              database.execSQL(&quot;CREATE TABLE IF NOT EXISTS &quot; + TABLE_NAME + &quot; (&quot; +                                  </span>
<span class="-4480150272515057846" onmouseenter="enter('-4480150272515057846');" onmouseout="out('-4480150272515057846');" style=""> 325                      COLUMN_NAME + &quot; TEXT NOT NULL, &quot; +                                                            </span>
<span class="9221020696116426890" onmouseenter="enter('9221020696116426890');" onmouseout="out('9221020696116426890');" style=""> 326                      COLUMN_SIZE + &quot; TEXT NOT NULL, &quot; +                                                            </span>
<span class="-4320278434100102649" onmouseenter="enter('-4320278434100102649');" onmouseout="out('-4320278434100102649');" style=""> 327                      COLUMN_PREVIEW_BITMAP + &quot; BLOB NOT NULL, &quot; +                                                  </span>
<span class="2330812204177674799" onmouseenter="enter('2330812204177674799');" onmouseout="out('2330812204177674799');" style=""> 328                      &quot;PRIMARY KEY (&quot; + COLUMN_NAME + &quot;, &quot; + COLUMN_SIZE + &quot;) &quot; +                                   </span>
<span class="4525293784515244604" onmouseenter="enter('4525293784515244604');" onmouseout="out('4525293784515244604');" style=""> 329                      &quot;);&quot;);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330          }                                                                                                         </span>
<span  style=""> 331                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 332          @Override                                                                                                 </span>
<span class="-4655538025867202729" onmouseenter="enter('-4655538025867202729');" onmouseout="out('-4655538025867202729');" style=""> 333          public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {                                </span>
<span class="4248187026734735411" onmouseenter="enter('4248187026734735411');" onmouseout="out('4248187026734735411');" style=""> 334              if (oldVersion != newVersion) {                                                                       </span>
<span class="4606527396647857067" onmouseenter="enter('4606527396647857067');" onmouseout="out('4606527396647857067');" style=""> 335                  // Delete all the records; they&#x27;ll be repopulated as this is a cache                              </span>
<span class="3312906466801577184" onmouseenter="enter('3312906466801577184');" onmouseout="out('3312906466801577184');" style=""> 336                  db.execSQL(&quot;DELETE FROM &quot; + TABLE_NAME);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339      }                                                                                                             </span>
<span  style=""> 340                                                                                                                    </span>
<span class="4811926455019388037" onmouseenter="enter('4811926455019388037');" onmouseout="out('4811926455019388037');" style=""> 341      private static final String WIDGET_PREFIX = &quot;Widget:&quot;;                                                        </span>
<span class="7268385195460645965" onmouseenter="enter('7268385195460645965');" onmouseout="out('7268385195460645965');" style=""> 342      private static final String SHORTCUT_PREFIX = &quot;Shortcut:&quot;;                                                    </span>
<span  style=""> 343                                                                                                                    </span>
<span class="2901805684811435457" onmouseenter="enter('2901805684811435457');" onmouseout="out('2901805684811435457');" style=""> 344      private static String getObjectName(Object o) {                                                               </span>
<span class="5690762498529732972" onmouseenter="enter('5690762498529732972');" onmouseout="out('5690762498529732972');" style=""> 345          // should cache the string builder                                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 346          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="2095302661605249065" onmouseenter="enter('2095302661605249065');" onmouseout="out('2095302661605249065');" style=""> 347          String output;                                                                                            </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 348          if (o instanceof AppWidgetProviderInfo) {                                                                 </span>
<span class="-8383311757247800402" onmouseenter="enter('-8383311757247800402');" onmouseout="out('-8383311757247800402');" style=""> 349              sb.append(WIDGET_PREFIX);                                                                             </span>
<span class="594215244520332131" onmouseenter="enter('594215244520332131');" onmouseout="out('594215244520332131');" style=""> 350              sb.append(((AppWidgetProviderInfo) o).toString());                                                    </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 351              output = sb.toString();                                                                               </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 352              sb.setLength(0);                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 353          } else {                                                                                                  </span>
<span class="5925999772645605802" onmouseenter="enter('5925999772645605802');" onmouseout="out('5925999772645605802');" style=""> 354              sb.append(SHORTCUT_PREFIX);                                                                           </span>
<span  style=""> 355                                                                                                                    </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 356              ResolveInfo info = (ResolveInfo) o;                                                                   </span>
<span class="8259534413479453259" onmouseenter="enter('8259534413479453259');" onmouseout="out('8259534413479453259');" style=""> 357              sb.append(new ComponentName(info.activityInfo.packageName,                                            </span>
<span class="-4000685798969561860" onmouseenter="enter('-4000685798969561860');" onmouseout="out('-4000685798969561860');" style=""> 358                      info.activityInfo.name).flattenToString());                                                   </span>
<span class="-6754944734648919930" onmouseenter="enter('-6754944734648919930');" onmouseout="out('-6754944734648919930');" style=""> 359              output = sb.toString();                                                                               </span>
<span class="-3352609815040613613" onmouseenter="enter('-3352609815040613613');" onmouseout="out('-3352609815040613613');" style=""> 360              sb.setLength(0);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361          }                                                                                                         </span>
<span class="3622623857335300211" onmouseenter="enter('3622623857335300211');" onmouseout="out('3622623857335300211');" style=""> 362          return output;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363      }                                                                                                             </span>
<span  style=""> 364                                                                                                                    </span>
<span class="4198392565151889664" onmouseenter="enter('4198392565151889664');" onmouseout="out('4198392565151889664');" style=""> 365      private String getObjectPackage(Object o) {                                                                   </span>
<span class="-2312755421156334805" onmouseenter="enter('-2312755421156334805');" onmouseout="out('-2312755421156334805');" style=""> 366          if (o instanceof AppWidgetProviderInfo) {                                                                 </span>
<span class="-447589032913714129" onmouseenter="enter('-447589032913714129');" onmouseout="out('-447589032913714129');" style=""> 367              return ((AppWidgetProviderInfo) o).provider.getPackageName();                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 368          } else {                                                                                                  </span>
<span class="-1931342603392129889" onmouseenter="enter('-1931342603392129889');" onmouseout="out('-1931342603392129889');" style=""> 369              ResolveInfo info = (ResolveInfo) o;                                                                   </span>
<span class="-2114723670528030181" onmouseenter="enter('-2114723670528030181');" onmouseout="out('-2114723670528030181');" style=""> 370              return info.activityInfo.packageName;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372      }                                                                                                             </span>
<span  style=""> 373                                                                                                                    </span>
<span class="8368345736666686335" onmouseenter="enter('8368345736666686335');" onmouseout="out('8368345736666686335');" style=""> 374      private void writeToDb(Object o, Bitmap preview) {                                                            </span>
<span class="2649950319373872481" onmouseenter="enter('2649950319373872481');" onmouseout="out('2649950319373872481');" style=""> 375          String name = getObjectName(o);                                                                           </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 376          SQLiteDatabase db = mDb.getWritableDatabase();                                                            </span>
<span class="-1148718858541057189" onmouseenter="enter('-1148718858541057189');" onmouseout="out('-1148718858541057189');" style=""> 377          ContentValues values = new ContentValues();                                                               </span>
<span  style=""> 378                                                                                                                    </span>
<span class="-3178925289150814226" onmouseenter="enter('-3178925289150814226');" onmouseout="out('-3178925289150814226');" style=""> 379          values.put(CacheDb.COLUMN_NAME, name);                                                                    </span>
<span class="3456914836247516446" onmouseenter="enter('3456914836247516446');" onmouseout="out('3456914836247516446');" style=""> 380          ByteArrayOutputStream stream = new ByteArrayOutputStream();                                               </span>
<span class="5496434693797867526" onmouseenter="enter('5496434693797867526');" onmouseout="out('5496434693797867526');" style=""> 381          preview.compress(Bitmap.CompressFormat.PNG, 100, stream);                                                 </span>
<span class="9194176376821213638" onmouseenter="enter('9194176376821213638');" onmouseout="out('9194176376821213638');" style=""> 382          values.put(CacheDb.COLUMN_PREVIEW_BITMAP, stream.toByteArray());                                          </span>
<span class="5882768875063958466" onmouseenter="enter('5882768875063958466');" onmouseout="out('5882768875063958466');" style=""> 383          values.put(CacheDb.COLUMN_SIZE, mSize);                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 384          try {                                                                                                     </span>
<span class="3018412397769192796" onmouseenter="enter('3018412397769192796');" onmouseout="out('3018412397769192796');" style=""> 385              db.insert(CacheDb.TABLE_NAME, null, values);                                                          </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 386          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 387              recreateDb();                                                                                         </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 388          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 389              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 390              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392      }                                                                                                             </span>
<span  style=""> 393                                                                                                                    </span>
<span class="8392297522310828664" onmouseenter="enter('8392297522310828664');" onmouseout="out('8392297522310828664');" style=""> 394      private void clearDb() {                                                                                      </span>
<span class="-1775873458923592874" onmouseenter="enter('-1775873458923592874');" onmouseout="out('-1775873458923592874');" style=""> 395          SQLiteDatabase db = mDb.getWritableDatabase();                                                            </span>
<span class="904405929570850953" onmouseenter="enter('904405929570850953');" onmouseout="out('904405929570850953');" style=""> 396          // Delete everything                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 397          try {                                                                                                     </span>
<span class="3968467922888620985" onmouseenter="enter('3968467922888620985');" onmouseout="out('3968467922888620985');" style=""> 398              db.delete(CacheDb.TABLE_NAME, null, null);                                                            </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 399          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 400          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 401              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 402              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404      }                                                                                                             </span>
<span  style=""> 405                                                                                                                    </span>
<span class="-8805069561924159073" onmouseenter="enter('-8805069561924159073');" onmouseout="out('-8805069561924159073');" style=""> 406      public static void removePackageFromDb(final CacheDb cacheDb, final String packageName) {                     </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 407          synchronized(sInvalidPackages) {                                                                          </span>
<span class="-5575213275928168943" onmouseenter="enter('-5575213275928168943');" onmouseout="out('-5575213275928168943');" style=""> 408              sInvalidPackages.add(packageName);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409          }                                                                                                         </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 410          new AsyncTask&lt;Void, Void, Void&gt;() {                                                                       </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 411              public Void doInBackground(Void ... args) {                                                           </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 412                  SQLiteDatabase db = cacheDb.getWritableDatabase();                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 413                  try {                                                                                             </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 414                      db.delete(CacheDb.TABLE_NAME,                                                                 </span>
<span class="7113429213384324763" onmouseenter="enter('7113429213384324763');" onmouseout="out('7113429213384324763');" style=""> 415                              CacheDb.COLUMN_NAME + &quot; LIKE ? OR &quot; +                                                 </span>
<span class="8833124058792802926" onmouseenter="enter('8833124058792802926');" onmouseout="out('8833124058792802926');" style=""> 416                              CacheDb.COLUMN_NAME + &quot; LIKE ?&quot;, // SELECT query                                      </span>
<span class="6575814019251974640" onmouseenter="enter('6575814019251974640');" onmouseout="out('6575814019251974640');" style=""> 417                              new String[] {                                                                        </span>
<span class="-1005195456334514714" onmouseenter="enter('-1005195456334514714');" onmouseout="out('-1005195456334514714');" style=""> 418                                      WIDGET_PREFIX + packageName + &quot;/%&quot;,                                           </span>
<span class="7638587366414932409" onmouseenter="enter('7638587366414932409');" onmouseout="out('7638587366414932409');" style=""> 419                                      SHORTCUT_PREFIX + packageName + &quot;/%&quot;                                          </span>
<span class="6370673901196405011" onmouseenter="enter('6370673901196405011');" onmouseout="out('6370673901196405011');" style=""> 420                              } // args to SELECT query                                                             </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 421                      );                                                                                            </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 422                  } catch (SQLiteDiskIOException e) {                                                               </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 423                  } catch (SQLiteCantOpenDatabaseException e) {                                                     </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 424                      dumpOpenFiles();                                                                              </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 425                      throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                  }                                                                                                 </span>
<span class="-7659613601689681622" onmouseenter="enter('-7659613601689681622');" onmouseout="out('-7659613601689681622');" style=""> 427                  synchronized(sInvalidPackages) {                                                                  </span>
<span class="683140179110979858" onmouseenter="enter('683140179110979858');" onmouseout="out('683140179110979858');" style=""> 428                      sInvalidPackages.remove(packageName);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429                  }                                                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 430                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431              }                                                                                                     </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 432          }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433      }                                                                                                             </span>
<span  style=""> 434                                                                                                                    </span>
<span class="-429228780021119422" onmouseenter="enter('-429228780021119422');" onmouseout="out('-429228780021119422');" style=""> 435      private static void removeItemFromDb(final CacheDb cacheDb, final String objectName) {                        </span>
<span class="583710967366765895" onmouseenter="enter('583710967366765895');" onmouseout="out('583710967366765895');" style=""> 436          new AsyncTask&lt;Void, Void, Void&gt;() {                                                                       </span>
<span class="-404787041683421022" onmouseenter="enter('-404787041683421022');" onmouseout="out('-404787041683421022');" style=""> 437              public Void doInBackground(Void ... args) {                                                           </span>
<span class="-6645596005978992837" onmouseenter="enter('-6645596005978992837');" onmouseout="out('-6645596005978992837');" style=""> 438                  SQLiteDatabase db = cacheDb.getWritableDatabase();                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 439                  try {                                                                                             </span>
<span class="-2824908619770179328" onmouseenter="enter('-2824908619770179328');" onmouseout="out('-2824908619770179328');" style=""> 440                      db.delete(CacheDb.TABLE_NAME,                                                                 </span>
<span class="7230732652281167865" onmouseenter="enter('7230732652281167865');" onmouseout="out('7230732652281167865');" style=""> 441                              CacheDb.COLUMN_NAME + &quot; = ? &quot;, // SELECT query                                        </span>
<span class="-5686609646644956814" onmouseenter="enter('-5686609646644956814');" onmouseout="out('-5686609646644956814');" style=""> 442                              new String[] { objectName }); // args to SELECT query                                 </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 443                  } catch (SQLiteDiskIOException e) {                                                               </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 444                  } catch (SQLiteCantOpenDatabaseException e) {                                                     </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 445                      dumpOpenFiles();                                                                              </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 446                      throw e;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447                  }                                                                                                 </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 448                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449              }                                                                                                     </span>
<span class="-2022971554563752627" onmouseenter="enter('-2022971554563752627');" onmouseout="out('-2022971554563752627');" style=""> 450          }.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, (Void) null);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451      }                                                                                                             </span>
<span  style=""> 452                                                                                                                    </span>
<span class="-5397085010036489521" onmouseenter="enter('-5397085010036489521');" onmouseout="out('-5397085010036489521');" style=""> 453      private Bitmap readFromDb(String name, Bitmap b) {                                                            </span>
<span class="-6915248341892392088" onmouseenter="enter('-6915248341892392088');" onmouseout="out('-6915248341892392088');" style=""> 454          if (mCachedSelectQuery == null) {                                                                         </span>
<span class="8500727054799765575" onmouseenter="enter('8500727054799765575');" onmouseout="out('8500727054799765575');" style=""> 455              mCachedSelectQuery = CacheDb.COLUMN_NAME + &quot; = ? AND &quot; +                                              </span>
<span class="-5148548584287535582" onmouseenter="enter('-5148548584287535582');" onmouseout="out('-5148548584287535582');" style=""> 456                      CacheDb.COLUMN_SIZE + &quot; = ?&quot;;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457          }                                                                                                         </span>
<span class="-3717850318373004709" onmouseenter="enter('-3717850318373004709');" onmouseout="out('-3717850318373004709');" style=""> 458          SQLiteDatabase db = mDb.getReadableDatabase();                                                            </span>
<span class="2593671339546598036" onmouseenter="enter('2593671339546598036');" onmouseout="out('2593671339546598036');" style=""> 459          Cursor result;                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 460          try {                                                                                                     </span>
<span class="44832651277024274" onmouseenter="enter('44832651277024274');" onmouseout="out('44832651277024274');" style=""> 461              result = db.query(CacheDb.TABLE_NAME,                                                                 </span>
<span class="-8348630863841661561" onmouseenter="enter('-8348630863841661561');" onmouseout="out('-8348630863841661561');" style=""> 462                      new String[] { CacheDb.COLUMN_PREVIEW_BITMAP }, // cols to return                             </span>
<span class="9098744119488497529" onmouseenter="enter('9098744119488497529');" onmouseout="out('9098744119488497529');" style=""> 463                      mCachedSelectQuery, // select query                                                           </span>
<span class="7819507014643484139" onmouseenter="enter('7819507014643484139');" onmouseout="out('7819507014643484139');" style=""> 464                      new String[] { name, mSize }, // args to select query                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 465                      null,                                                                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 466                      null,                                                                                         </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 467                      null,                                                                                         </span>
<span class="-5950258146809433717" onmouseenter="enter('-5950258146809433717');" onmouseout="out('-5950258146809433717');" style=""> 468                      null);                                                                                        </span>
<span class="3781673523025911589" onmouseenter="enter('3781673523025911589');" onmouseout="out('3781673523025911589');" style=""> 469          } catch (SQLiteDiskIOException e) {                                                                       </span>
<span class="-1816816114233693205" onmouseenter="enter('-1816816114233693205');" onmouseout="out('-1816816114233693205');" style=""> 470              recreateDb();                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 471              return null;                                                                                          </span>
<span class="7039538041264703887" onmouseenter="enter('7039538041264703887');" onmouseout="out('7039538041264703887');" style=""> 472          } catch (SQLiteCantOpenDatabaseException e) {                                                             </span>
<span class="-1637446138212379983" onmouseenter="enter('-1637446138212379983');" onmouseout="out('-1637446138212379983');" style=""> 473              dumpOpenFiles();                                                                                      </span>
<span class="-2532054300390783036" onmouseenter="enter('-2532054300390783036');" onmouseout="out('-2532054300390783036');" style=""> 474              throw e;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475          }                                                                                                         </span>
<span class="175106850439522001" onmouseenter="enter('175106850439522001');" onmouseout="out('175106850439522001');" style=""> 476          if (result.getCount() &gt; 0) {                                                                              </span>
<span class="-8233551716377839585" onmouseenter="enter('-8233551716377839585');" onmouseout="out('-8233551716377839585');" style=""> 477              result.moveToFirst();                                                                                 </span>
<span class="-8295573450010349547" onmouseenter="enter('-8295573450010349547');" onmouseout="out('-8295573450010349547');" style=""> 478              byte[] blob = result.getBlob(0);                                                                      </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 479              result.close();                                                                                       </span>
<span class="5422706254339452362" onmouseenter="enter('5422706254339452362');" onmouseout="out('5422706254339452362');" style=""> 480              final BitmapFactory.Options opts = mCachedBitmapFactoryOptions.get();                                 </span>
<span class="-4203120540780740867" onmouseenter="enter('-4203120540780740867');" onmouseout="out('-4203120540780740867');" style=""> 481              opts.inBitmap = b;                                                                                    </span>
<span class="5746761561761774101" onmouseenter="enter('5746761561761774101');" onmouseout="out('5746761561761774101');" style=""> 482              opts.inSampleSize = 1;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 483              try {                                                                                                 </span>
<span class="5467059833557948093" onmouseenter="enter('5467059833557948093');" onmouseout="out('5467059833557948093');" style=""> 484                  return BitmapFactory.decodeByteArray(blob, 0, blob.length, opts);                                 </span>
<span class="-1471183022667940231" onmouseenter="enter('-1471183022667940231');" onmouseout="out('-1471183022667940231');" style=""> 485              } catch (IllegalArgumentException e) {                                                                </span>
<span class="-8663451629875904419" onmouseenter="enter('-8663451629875904419');" onmouseout="out('-8663451629875904419');" style=""> 486                  removeItemFromDb(mDb, name);                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 487                  return null;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 489          } else {                                                                                                  </span>
<span class="2788159544293393734" onmouseenter="enter('2788159544293393734');" onmouseout="out('2788159544293393734');" style=""> 490              result.close();                                                                                       </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 491              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493      }                                                                                                             </span>
<span  style=""> 494                                                                                                                    </span>
<span class="-4571373922604646261" onmouseenter="enter('-4571373922604646261');" onmouseout="out('-4571373922604646261');" style=""> 495      private Bitmap generatePreview(Object info, Bitmap preview) {                                                 </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 496          if (preview != null &amp;&amp;                                                                                    </span>
<span class="-4427245060729789933" onmouseenter="enter('-4427245060729789933');" onmouseout="out('-4427245060729789933');" style=""> 497                  (preview.getWidth() != mPreviewBitmapWidth ||                                                     </span>
<span class="-7111303570896946504" onmouseenter="enter('-7111303570896946504');" onmouseout="out('-7111303570896946504');" style=""> 498                  preview.getHeight() != mPreviewBitmapHeight)) {                                                   </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 499              throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500          }                                                                                                         </span>
<span class="-3932360089392842216" onmouseenter="enter('-3932360089392842216');" onmouseout="out('-3932360089392842216');" style=""> 501          if (info instanceof AppWidgetProviderInfo) {                                                              </span>
<span class="-6841541424186777283" onmouseenter="enter('-6841541424186777283');" onmouseout="out('-6841541424186777283');" style=""> 502              return generateWidgetPreview((AppWidgetProviderInfo) info, preview);                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 503          } else {                                                                                                  </span>
<span class="5830651867016154139" onmouseenter="enter('5830651867016154139');" onmouseout="out('5830651867016154139');" style=""> 504              return generateShortcutPreview(                                                                       </span>
<span class="5884922488800788426" onmouseenter="enter('5884922488800788426');" onmouseout="out('5884922488800788426');" style=""> 505                      (ResolveInfo) info, mPreviewBitmapWidth, mPreviewBitmapHeight, preview);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 507      }                                                                                                             </span>
<span  style=""> 508                                                                                                                    </span>
<span class="6578518467799953308" onmouseenter="enter('6578518467799953308');" onmouseout="out('6578518467799953308');" style=""> 509      public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, Bitmap preview) {                             </span>
<span class="9147821438266271134" onmouseenter="enter('9147821438266271134');" onmouseout="out('9147821438266271134');" style=""> 510          int[] cellSpans = Launcher.getSpanForWidget(mContext, info);                                              </span>
<span class="-1431657331442958147" onmouseenter="enter('-1431657331442958147');" onmouseout="out('-1431657331442958147');" style=""> 511          int maxWidth = maxWidthForWidgetPreview(cellSpans[0]);                                                    </span>
<span class="-6135167628743317243" onmouseenter="enter('-6135167628743317243');" onmouseout="out('-6135167628743317243');" style=""> 512          int maxHeight = maxHeightForWidgetPreview(cellSpans[1]);                                                  </span>
<span class="-6510989053235413139" onmouseenter="enter('-6510989053235413139');" onmouseout="out('-6510989053235413139');" style=""> 513          return generateWidgetPreview(info, cellSpans[0], cellSpans[1],                                            </span>
<span class="5560351977065436698" onmouseenter="enter('5560351977065436698');" onmouseout="out('5560351977065436698');" style=""> 514                  maxWidth, maxHeight, preview, null);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515      }                                                                                                             </span>
<span  style=""> 516                                                                                                                    </span>
<span class="-4962504510381054079" onmouseenter="enter('-4962504510381054079');" onmouseout="out('-4962504510381054079');" style=""> 517      public int maxWidthForWidgetPreview(int spanX) {                                                              </span>
<span class="5345170673015378699" onmouseenter="enter('5345170673015378699');" onmouseout="out('5345170673015378699');" style=""> 518          return Math.min(mPreviewBitmapWidth,                                                                      </span>
<span class="-7096108314182907064" onmouseenter="enter('-7096108314182907064');" onmouseout="out('-7096108314182907064');" style=""> 519                  mWidgetSpacingLayout.estimateCellWidth(spanX));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span  style=""> 521                                                                                                                    </span>
<span class="-516047466055903408" onmouseenter="enter('-516047466055903408');" onmouseout="out('-516047466055903408');" style=""> 522      public int maxHeightForWidgetPreview(int spanY) {                                                             </span>
<span class="8958196798141008482" onmouseenter="enter('8958196798141008482');" onmouseout="out('8958196798141008482');" style=""> 523          return Math.min(mPreviewBitmapHeight,                                                                     </span>
<span class="-8176698640675478774" onmouseenter="enter('-8176698640675478774');" onmouseout="out('-8176698640675478774');" style=""> 524                  mWidgetSpacingLayout.estimateCellHeight(spanY));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525      }                                                                                                             </span>
<span  style=""> 526                                                                                                                    </span>
<span class="-6895334532662888649" onmouseenter="enter('-6895334532662888649');" onmouseout="out('-6895334532662888649');" style=""> 527      public Bitmap generateWidgetPreview(AppWidgetProviderInfo info, int cellHSpan, int cellVSpan,                 </span>
<span class="-5508121118873891580" onmouseenter="enter('-5508121118873891580');" onmouseout="out('-5508121118873891580');" style=""> 528              int maxPreviewWidth, int maxPreviewHeight, Bitmap preview, int[] preScaledWidthOut) {                 </span>
<span class="2529916654704436428" onmouseenter="enter('2529916654704436428');" onmouseout="out('2529916654704436428');" style=""> 529          // Load the preview image if possible                                                                     </span>
<span class="931456242657570009" onmouseenter="enter('931456242657570009');" onmouseout="out('931456242657570009');" style=""> 530          if (maxPreviewWidth &lt; 0) maxPreviewWidth = Integer.MAX_VALUE;                                             </span>
<span class="-3276405287943718338" onmouseenter="enter('-3276405287943718338');" onmouseout="out('-3276405287943718338');" style=""> 531          if (maxPreviewHeight &lt; 0) maxPreviewHeight = Integer.MAX_VALUE;                                           </span>
<span  style=""> 532                                                                                                                    </span>
<span class="-3049333615145638519" onmouseenter="enter('-3049333615145638519');" onmouseout="out('-3049333615145638519');" style=""> 533          Drawable drawable = null;                                                                                 </span>
<span class="-5443811616873851048" onmouseenter="enter('-5443811616873851048');" onmouseout="out('-5443811616873851048');" style=""> 534          if (info.previewImage != 0) {                                                                             </span>
<span class="-6995452363019574294" onmouseenter="enter('-6995452363019574294');" onmouseout="out('-6995452363019574294');" style=""> 535              drawable = mManager.loadPreview(info);                                                                </span>
<span class="281943916213481387" onmouseenter="enter('281943916213481387');" onmouseout="out('281943916213481387');" style=""> 536              if (drawable != null) {                                                                               </span>
<span class="559582177948747235" onmouseenter="enter('559582177948747235');" onmouseout="out('559582177948747235');" style=""> 537                  drawable = mutateOnMainThread(drawable);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 538              } else {                                                                                              </span>
<span class="7073909505336594696" onmouseenter="enter('7073909505336594696');" onmouseout="out('7073909505336594696');" style=""> 539                  Log.w(TAG, &quot;Can&#x27;t load widget preview drawable 0x&quot; +                                              </span>
<span class="-4346717227149782469" onmouseenter="enter('-4346717227149782469');" onmouseout="out('-4346717227149782469');" style=""> 540                          Integer.toHexString(info.previewImage) + &quot; for provider: &quot; + info.provider);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542          }                                                                                                         </span>
<span  style=""> 543                                                                                                                    </span>
<span class="5985266596175165266" onmouseenter="enter('5985266596175165266');" onmouseout="out('5985266596175165266');" style=""> 544          int previewWidth;                                                                                         </span>
<span class="-7312246595783828327" onmouseenter="enter('-7312246595783828327');" onmouseout="out('-7312246595783828327');" style=""> 545          int previewHeight;                                                                                        </span>
<span class="5524531081830166723" onmouseenter="enter('5524531081830166723');" onmouseout="out('5524531081830166723');" style=""> 546          Bitmap defaultPreview = null;                                                                             </span>
<span class="5121594519432393069" onmouseenter="enter('5121594519432393069');" onmouseout="out('5121594519432393069');" style=""> 547          boolean widgetPreviewExists = (drawable != null);                                                         </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 548          if (widgetPreviewExists) {                                                                                </span>
<span class="7694696434619666028" onmouseenter="enter('7694696434619666028');" onmouseout="out('7694696434619666028');" style=""> 549              previewWidth = drawable.getIntrinsicWidth();                                                          </span>
<span class="-5860514303309291265" onmouseenter="enter('-5860514303309291265');" onmouseout="out('-5860514303309291265');" style=""> 550              previewHeight = drawable.getIntrinsicHeight();                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 551          } else {                                                                                                  </span>
<span class="7833733472444702454" onmouseenter="enter('7833733472444702454');" onmouseout="out('7833733472444702454');" style=""> 552              // Generate a preview image if we couldn&#x27;t load one                                                   </span>
<span class="-8710794757779095209" onmouseenter="enter('-8710794757779095209');" onmouseout="out('-8710794757779095209');" style=""> 553              if (cellHSpan &lt; 1) cellHSpan = 1;                                                                     </span>
<span class="-779725371469556670" onmouseenter="enter('-779725371469556670');" onmouseout="out('-779725371469556670');" style=""> 554              if (cellVSpan &lt; 1) cellVSpan = 1;                                                                     </span>
<span  style=""> 555                                                                                                                    </span>
<span class="3565276356973562387" onmouseenter="enter('3565276356973562387');" onmouseout="out('3565276356973562387');" style=""> 556              // This Drawable is not directly drawn, so there&#x27;s no need to mutate it.                              </span>
<span class="-5021189500908681979" onmouseenter="enter('-5021189500908681979');" onmouseout="out('-5021189500908681979');" style=""> 557              BitmapDrawable previewDrawable = (BitmapDrawable) mContext.getResources()                             </span>
<span class="3152690746910736269" onmouseenter="enter('3152690746910736269');" onmouseout="out('3152690746910736269');" style=""> 558                      .getDrawable(R.drawable.widget_tile);                                                         </span>
<span class="-5932659289331905035" onmouseenter="enter('-5932659289331905035');" onmouseout="out('-5932659289331905035');" style=""> 559              final int previewDrawableWidth = previewDrawable                                                      </span>
<span class="-5783669958167413803" onmouseenter="enter('-5783669958167413803');" onmouseout="out('-5783669958167413803');" style=""> 560                      .getIntrinsicWidth();                                                                         </span>
<span class="4431322150991047787" onmouseenter="enter('4431322150991047787');" onmouseout="out('4431322150991047787');" style=""> 561              final int previewDrawableHeight = previewDrawable                                                     </span>
<span class="4098769707366186014" onmouseenter="enter('4098769707366186014');" onmouseout="out('4098769707366186014');" style=""> 562                      .getIntrinsicHeight();                                                                        </span>
<span class="8887455390458335872" onmouseenter="enter('8887455390458335872');" onmouseout="out('8887455390458335872');" style=""> 563              previewWidth = previewDrawableWidth * cellHSpan;                                                      </span>
<span class="-8341882922226410648" onmouseenter="enter('-8341882922226410648');" onmouseout="out('-8341882922226410648');" style=""> 564              previewHeight = previewDrawableHeight * cellVSpan;                                                    </span>
<span  style=""> 565                                                                                                                    </span>
<span class="-737373095753296600" onmouseenter="enter('-737373095753296600');" onmouseout="out('-737373095753296600');" style=""> 566              defaultPreview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 567              final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                                 </span>
<span class="848607727045658162" onmouseenter="enter('848607727045658162');" onmouseout="out('848607727045658162');" style=""> 568              c.setBitmap(defaultPreview);                                                                          </span>
<span class="4673250187052598192" onmouseenter="enter('4673250187052598192');" onmouseout="out('4673250187052598192');" style=""> 569              Paint p = mDefaultAppWidgetPreviewPaint.get();                                                        </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 570              if (p == null) {                                                                                      </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 571                  p = new Paint();                                                                                  </span>
<span class="9031053372645621365" onmouseenter="enter('9031053372645621365');" onmouseout="out('9031053372645621365');" style=""> 572                  p.setShader(new BitmapShader(previewDrawable.getBitmap(),                                         </span>
<span class="1595910380715064067" onmouseenter="enter('1595910380715064067');" onmouseout="out('1595910380715064067');" style=""> 573                          Shader.TileMode.REPEAT, Shader.TileMode.REPEAT));                                         </span>
<span class="-8603584172680459929" onmouseenter="enter('-8603584172680459929');" onmouseout="out('-8603584172680459929');" style=""> 574                  mDefaultAppWidgetPreviewPaint.set(p);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575              }                                                                                                     </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 576              final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                              </span>
<span class="4633920667503149983" onmouseenter="enter('4633920667503149983');" onmouseout="out('4633920667503149983');" style=""> 577              dest.set(0, 0, previewWidth, previewHeight);                                                          </span>
<span class="-470581757098027879" onmouseenter="enter('-470581757098027879');" onmouseout="out('-470581757098027879');" style=""> 578              c.drawRect(dest, p);                                                                                  </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 579              c.setBitmap(null);                                                                                    </span>
<span  style=""> 580                                                                                                                    </span>
<span class="4647625888602990242" onmouseenter="enter('4647625888602990242');" onmouseout="out('4647625888602990242');" style=""> 581              // Draw the icon in the top left corner                                                               </span>
<span class="3531213633716353102" onmouseenter="enter('3531213633716353102');" onmouseout="out('3531213633716353102');" style=""> 582              int minOffset = (int) (mAppIconSize * WIDGET_PREVIEW_ICON_PADDING_PERCENTAGE);                        </span>
<span class="-3256500215342314396" onmouseenter="enter('-3256500215342314396');" onmouseout="out('-3256500215342314396');" style=""> 583              int smallestSide = Math.min(previewWidth, previewHeight);                                             </span>
<span class="1098745458783687815" onmouseenter="enter('1098745458783687815');" onmouseout="out('1098745458783687815');" style=""> 584              float iconScale = Math.min((float) smallestSide                                                       </span>
<span class="7317986328586297721" onmouseenter="enter('7317986328586297721');" onmouseout="out('7317986328586297721');" style=""> 585                      / (mAppIconSize + 2 * minOffset), 1f);                                                        </span>
<span  style=""> 586                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 587              try {                                                                                                 </span>
<span class="-837531234335200976" onmouseenter="enter('-837531234335200976');" onmouseout="out('-837531234335200976');" style=""> 588                  Drawable icon = mManager.loadIcon(info, mIconCache);                                              </span>
<span class="-4192144256919602329" onmouseenter="enter('-4192144256919602329');" onmouseout="out('-4192144256919602329');" style=""> 589                  if (icon != null) {                                                                               </span>
<span class="-1224594640800103937" onmouseenter="enter('-1224594640800103937');" onmouseout="out('-1224594640800103937');" style=""> 590                      int hoffset = (int) ((previewDrawableWidth - mAppIconSize * iconScale) / 2);                  </span>
<span class="-389205104576287013" onmouseenter="enter('-389205104576287013');" onmouseout="out('-389205104576287013');" style=""> 591                      int yoffset = (int) ((previewDrawableHeight - mAppIconSize * iconScale) / 2);                 </span>
<span class="-867380701080615138" onmouseenter="enter('-867380701080615138');" onmouseout="out('-867380701080615138');" style=""> 592                      icon = mutateOnMainThread(icon);                                                              </span>
<span class="1665310338408239466" onmouseenter="enter('1665310338408239466');" onmouseout="out('1665310338408239466');" style=""> 593                      renderDrawableToBitmap(icon, defaultPreview, hoffset,                                         </span>
<span class="8191900375173585890" onmouseenter="enter('8191900375173585890');" onmouseout="out('8191900375173585890');" style=""> 594                              yoffset, (int) (mAppIconSize * iconScale),                                            </span>
<span class="-5886521530151300680" onmouseenter="enter('-5886521530151300680');" onmouseout="out('-5886521530151300680');" style=""> 595                              (int) (mAppIconSize * iconScale));                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596                  }                                                                                                 </span>
<span class="5183756364953253383" onmouseenter="enter('5183756364953253383');" onmouseout="out('5183756364953253383');" style=""> 597              } catch (Resources.NotFoundException e) {                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599          }                                                                                                         </span>
<span  style=""> 600                                                                                                                    </span>
<span class="6949857229431854068" onmouseenter="enter('6949857229431854068');" onmouseout="out('6949857229431854068');" style=""> 601          // Scale to fit width only - let the widget preview be clipped in the                                     </span>
<span class="8360805034192073884" onmouseenter="enter('8360805034192073884');" onmouseout="out('8360805034192073884');" style=""> 602          // vertical dimension                                                                                     </span>
<span class="-8224051742145745082" onmouseenter="enter('-8224051742145745082');" onmouseout="out('-8224051742145745082');" style=""> 603          float scale = 1f;                                                                                         </span>
<span class="6149434037546525815" onmouseenter="enter('6149434037546525815');" onmouseout="out('6149434037546525815');" style=""> 604          if (preScaledWidthOut != null) {                                                                          </span>
<span class="2306433834272734783" onmouseenter="enter('2306433834272734783');" onmouseout="out('2306433834272734783');" style=""> 605              preScaledWidthOut[0] = previewWidth;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 606          }                                                                                                         </span>
<span class="-7638941371937567348" onmouseenter="enter('-7638941371937567348');" onmouseout="out('-7638941371937567348');" style=""> 607          if (previewWidth &gt; maxPreviewWidth) {                                                                     </span>
<span class="-6167807034013491459" onmouseenter="enter('-6167807034013491459');" onmouseout="out('-6167807034013491459');" style=""> 608              scale = maxPreviewWidth / (float) previewWidth;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609          }                                                                                                         </span>
<span class="-8893868344639903626" onmouseenter="enter('-8893868344639903626');" onmouseout="out('-8893868344639903626');" style=""> 610          if (scale != 1f) {                                                                                        </span>
<span class="-6338970909485118519" onmouseenter="enter('-6338970909485118519');" onmouseout="out('-6338970909485118519');" style=""> 611              previewWidth = (int) (scale * previewWidth);                                                          </span>
<span class="2442469555843251122" onmouseenter="enter('2442469555843251122');" onmouseout="out('2442469555843251122');" style=""> 612              previewHeight = (int) (scale * previewHeight);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 613          }                                                                                                         </span>
<span  style=""> 614                                                                                                                    </span>
<span class="-1124372066791938196" onmouseenter="enter('-1124372066791938196');" onmouseout="out('-1124372066791938196');" style=""> 615          // If a bitmap is passed in, we use it; otherwise, we create a bitmap of the right size                   </span>
<span class="2486895102595751802" onmouseenter="enter('2486895102595751802');" onmouseout="out('2486895102595751802');" style=""> 616          if (preview == null) {                                                                                    </span>
<span class="6637154682204057097" onmouseenter="enter('6637154682204057097');" onmouseout="out('6637154682204057097');" style=""> 617              preview = Bitmap.createBitmap(previewWidth, previewHeight, Config.ARGB_8888);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618          }                                                                                                         </span>
<span  style=""> 619                                                                                                                    </span>
<span class="-2080916171919384218" onmouseenter="enter('-2080916171919384218');" onmouseout="out('-2080916171919384218');" style=""> 620          // Draw the scaled preview into the final bitmap                                                          </span>
<span class="3369675460464663159" onmouseenter="enter('3369675460464663159');" onmouseout="out('3369675460464663159');" style=""> 621          int x = (preview.getWidth() - previewWidth) / 2;                                                          </span>
<span class="3213554403747573447" onmouseenter="enter('3213554403747573447');" onmouseout="out('3213554403747573447');" style=""> 622          if (widgetPreviewExists) {                                                                                </span>
<span class="-6966420244976420379" onmouseenter="enter('-6966420244976420379');" onmouseout="out('-6966420244976420379');" style=""> 623              renderDrawableToBitmap(drawable, preview, x, 0, previewWidth,                                         </span>
<span class="-7548196549309427555" onmouseenter="enter('-7548196549309427555');" onmouseout="out('-7548196549309427555');" style=""> 624                      previewHeight);                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 625          } else {                                                                                                  </span>
<span class="5319483004482971487" onmouseenter="enter('5319483004482971487');" onmouseout="out('5319483004482971487');" style=""> 626              final Canvas c = mCachedAppWidgetPreviewCanvas.get();                                                 </span>
<span class="5281190707868665361" onmouseenter="enter('5281190707868665361');" onmouseout="out('5281190707868665361');" style=""> 627              final Rect src = mCachedAppWidgetPreviewSrcRect.get();                                                </span>
<span class="-4686629014731102760" onmouseenter="enter('-4686629014731102760');" onmouseout="out('-4686629014731102760');" style=""> 628              final Rect dest = mCachedAppWidgetPreviewDestRect.get();                                              </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 629              c.setBitmap(preview);                                                                                 </span>
<span class="-8725434908843264237" onmouseenter="enter('-8725434908843264237');" onmouseout="out('-8725434908843264237');" style=""> 630              src.set(0, 0, defaultPreview.getWidth(), defaultPreview.getHeight());                                 </span>
<span class="-7071368679565427433" onmouseenter="enter('-7071368679565427433');" onmouseout="out('-7071368679565427433');" style=""> 631              dest.set(x, 0, x + previewWidth, previewHeight);                                                      </span>
<span  style=""> 632                                                                                                                    </span>
<span class="5839465204107083552" onmouseenter="enter('5839465204107083552');" onmouseout="out('5839465204107083552');" style=""> 633              Paint p = mCachedAppWidgetPreviewPaint.get();                                                         </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 634              if (p == null) {                                                                                      </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 635                  p = new Paint();                                                                                  </span>
<span class="-3846510342158419561" onmouseenter="enter('-3846510342158419561');" onmouseout="out('-3846510342158419561');" style=""> 636                  p.setFilterBitmap(true);                                                                          </span>
<span class="8711891207106027486" onmouseenter="enter('8711891207106027486');" onmouseout="out('8711891207106027486');" style=""> 637                  mCachedAppWidgetPreviewPaint.set(p);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 638              }                                                                                                     </span>
<span class="-8322704971015823035" onmouseenter="enter('-8322704971015823035');" onmouseout="out('-8322704971015823035');" style=""> 639              c.drawBitmap(defaultPreview, src, dest, p);                                                           </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 640              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641          }                                                                                                         </span>
<span class="-5318059876677185928" onmouseenter="enter('-5318059876677185928');" onmouseout="out('-5318059876677185928');" style=""> 642          return mManager.getBadgeBitmap(info, preview);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643      }                                                                                                             </span>
<span  style=""> 644                                                                                                                    </span>
<span class="-2036338097340155865" onmouseenter="enter('-2036338097340155865');" onmouseout="out('-2036338097340155865');" style=""> 645      private Bitmap generateShortcutPreview(                                                                       </span>
<span class="1557751875108084858" onmouseenter="enter('1557751875108084858');" onmouseout="out('1557751875108084858');" style=""> 646              ResolveInfo info, int maxWidth, int maxHeight, Bitmap preview) {                                      </span>
<span class="6669617465194046785" onmouseenter="enter('6669617465194046785');" onmouseout="out('6669617465194046785');" style=""> 647          Bitmap tempBitmap = mCachedShortcutPreviewBitmap.get();                                                   </span>
<span class="8492580593566939346" onmouseenter="enter('8492580593566939346');" onmouseout="out('8492580593566939346');" style=""> 648          final Canvas c = mCachedShortcutPreviewCanvas.get();                                                      </span>
<span class="3344452031699903410" onmouseenter="enter('3344452031699903410');" onmouseout="out('3344452031699903410');" style=""> 649          if (tempBitmap == null ||                                                                                 </span>
<span class="-1798938713535043835" onmouseenter="enter('-1798938713535043835');" onmouseout="out('-1798938713535043835');" style=""> 650                  tempBitmap.getWidth() != maxWidth ||                                                              </span>
<span class="9083140300107171771" onmouseenter="enter('9083140300107171771');" onmouseout="out('9083140300107171771');" style=""> 651                  tempBitmap.getHeight() != maxHeight) {                                                            </span>
<span class="5079923942824258796" onmouseenter="enter('5079923942824258796');" onmouseout="out('5079923942824258796');" style=""> 652              tempBitmap = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                              </span>
<span class="3252713296815828481" onmouseenter="enter('3252713296815828481');" onmouseout="out('3252713296815828481');" style=""> 653              mCachedShortcutPreviewBitmap.set(tempBitmap);                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 654          } else {                                                                                                  </span>
<span class="2908194814219559361" onmouseenter="enter('2908194814219559361');" onmouseout="out('2908194814219559361');" style=""> 655              c.setBitmap(tempBitmap);                                                                              </span>
<span class="6438609178571659174" onmouseenter="enter('6438609178571659174');" onmouseout="out('6438609178571659174');" style=""> 656              c.drawColor(0, PorterDuff.Mode.CLEAR);                                                                </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 657              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 658          }                                                                                                         </span>
<span class="-895750054343748789" onmouseenter="enter('-895750054343748789');" onmouseout="out('-895750054343748789');" style=""> 659          // Render the icon                                                                                        </span>
<span class="-9200688182354003526" onmouseenter="enter('-9200688182354003526');" onmouseout="out('-9200688182354003526');" style=""> 660          Drawable icon = mutateOnMainThread(mIconCache.getFullResIcon(info));                                      </span>

<span  style=""> 661                                                                                                                    </span>
<span class="-7461308767564647078" onmouseenter="enter('-7461308767564647078');" onmouseout="out('-7461308767564647078');" style=""> 662          int paddingTop = mContext.                                                                                </span>
<span class="-5900363241936444267" onmouseenter="enter('-5900363241936444267');" onmouseout="out('-5900363241936444267');" style=""> 663                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_top);                     </span>
<span class="5781485035466420663" onmouseenter="enter('5781485035466420663');" onmouseout="out('5781485035466420663');" style=""> 664          int paddingLeft = mContext.                                                                               </span>
<span class="2328331898560910495" onmouseenter="enter('2328331898560910495');" onmouseout="out('2328331898560910495');" style=""> 665                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_left);                    </span>
<span class="5829344697485851220" onmouseenter="enter('5829344697485851220');" onmouseout="out('5829344697485851220');" style=""> 666          int paddingRight = mContext.                                                                              </span>
<span class="-8885288017836034916" onmouseenter="enter('-8885288017836034916');" onmouseout="out('-8885288017836034916');" style=""> 667                  getResources().getDimensionPixelOffset(R.dimen.shortcut_preview_padding_right);                   </span>
<span  style=""> 668                                                                                                                    </span>
<span class="9041541765806161530" onmouseenter="enter('9041541765806161530');" onmouseout="out('9041541765806161530');" style=""> 669          int scaledIconWidth = (maxWidth - paddingLeft - paddingRight);                                            </span>
<span  style=""> 670                                                                                                                    </span>
<span class="3221827998305751243" onmouseenter="enter('3221827998305751243');" onmouseout="out('3221827998305751243');" style=""> 671          renderDrawableToBitmap(                                                                                   </span>
<span class="5202977166144268859" onmouseenter="enter('5202977166144268859');" onmouseout="out('5202977166144268859');" style=""> 672                  icon, tempBitmap, paddingLeft, paddingTop, scaledIconWidth, scaledIconWidth);                     </span>
<span  style=""> 673                                                                                                                    </span>
<span class="-8033673645159245793" onmouseenter="enter('-8033673645159245793');" onmouseout="out('-8033673645159245793');" style=""> 674          if (preview != null &amp;&amp;                                                                                    </span>
<span class="-4616488258627842412" onmouseenter="enter('-4616488258627842412');" onmouseout="out('-4616488258627842412');" style=""> 675                  (preview.getWidth() != maxWidth || preview.getHeight() != maxHeight)) {                           </span>
<span class="-4236561966728397115" onmouseenter="enter('-4236561966728397115');" onmouseout="out('-4236561966728397115');" style=""> 676              throw new RuntimeException(&quot;Improperly sized bitmap passed as argument&quot;);                             </span>
<span class="3365320965403910466" onmouseenter="enter('3365320965403910466');" onmouseout="out('3365320965403910466');" style=""> 677          } else if (preview == null) {                                                                             </span>
<span class="4551594767613519312" onmouseenter="enter('4551594767613519312');" onmouseout="out('4551594767613519312');" style=""> 678              preview = Bitmap.createBitmap(maxWidth, maxHeight, Config.ARGB_8888);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679          }                                                                                                         </span>
<span  style=""> 680                                                                                                                    </span>
<span class="3062578711333266270" onmouseenter="enter('3062578711333266270');" onmouseout="out('3062578711333266270');" style=""> 681          c.setBitmap(preview);                                                                                     </span>
<span class="8934981767024497500" onmouseenter="enter('8934981767024497500');" onmouseout="out('8934981767024497500');" style=""> 682          // Draw a desaturated/scaled version of the icon in the background as a watermark                         </span>
<span class="-518774087151586601" onmouseenter="enter('-518774087151586601');" onmouseout="out('-518774087151586601');" style=""> 683          Paint p = mCachedShortcutPreviewPaint.get();                                                              </span>
<span class="404605393272202002" onmouseenter="enter('404605393272202002');" onmouseout="out('404605393272202002');" style=""> 684          if (p == null) {                                                                                          </span>
<span class="-1200768819662862951" onmouseenter="enter('-1200768819662862951');" onmouseout="out('-1200768819662862951');" style=""> 685              p = new Paint();                                                                                      </span>
<span class="5185800516692981036" onmouseenter="enter('5185800516692981036');" onmouseout="out('5185800516692981036');" style=""> 686              ColorMatrix colorMatrix = new ColorMatrix();                                                          </span>
<span class="-4096104009908534310" onmouseenter="enter('-4096104009908534310');" onmouseout="out('-4096104009908534310');" style=""> 687              colorMatrix.setSaturation(0);                                                                         </span>
<span class="-2105686232381577699" onmouseenter="enter('-2105686232381577699');" onmouseout="out('-2105686232381577699');" style=""> 688              p.setColorFilter(new ColorMatrixColorFilter(colorMatrix));                                            </span>
<span class="-725456443631950326" onmouseenter="enter('-725456443631950326');" onmouseout="out('-725456443631950326');" style=""> 689              p.setAlpha((int) (255 * 0.06f));                                                                      </span>
<span class="-4885683919835504124" onmouseenter="enter('-4885683919835504124');" onmouseout="out('-4885683919835504124');" style=""> 690              mCachedShortcutPreviewPaint.set(p);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 691          }                                                                                                         </span>
<span class="-4554115702547152566" onmouseenter="enter('-4554115702547152566');" onmouseout="out('-4554115702547152566');" style=""> 692          c.drawBitmap(tempBitmap, 0, 0, p);                                                                        </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 693          c.setBitmap(null);                                                                                        </span>
<span  style=""> 694                                                                                                                    </span>
<span class="-5738465230776990197" onmouseenter="enter('-5738465230776990197');" onmouseout="out('-5738465230776990197');" style=""> 695          renderDrawableToBitmap(icon, preview, 0, 0, mAppIconSize, mAppIconSize);                                  </span>
<span  style=""> 696                                                                                                                    </span>
<span class="4046650305246378241" onmouseenter="enter('4046650305246378241');" onmouseout="out('4046650305246378241');" style=""> 697          return preview;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 698      }                                                                                                             </span>
<span  style=""> 699                                                                                                                    </span>
<span class="-2512069815104909632" onmouseenter="enter('-2512069815104909632');" onmouseout="out('-2512069815104909632');" style=""> 700      private static void renderDrawableToBitmap(                                                                   </span>
<span class="-281586385806654310" onmouseenter="enter('-281586385806654310');" onmouseout="out('-281586385806654310');" style=""> 701              Drawable d, Bitmap bitmap, int x, int y, int w, int h) {                                              </span>
<span class="8226127527421310456" onmouseenter="enter('8226127527421310456');" onmouseout="out('8226127527421310456');" style=""> 702          if (bitmap != null) {                                                                                     </span>
<span class="417388478829800263" onmouseenter="enter('417388478829800263');" onmouseout="out('417388478829800263');" style=""> 703              Canvas c = new Canvas(bitmap);                                                                        </span>
<span class="2629107935702523978" onmouseenter="enter('2629107935702523978');" onmouseout="out('2629107935702523978');" style=""> 704              Rect oldBounds = d.copyBounds();                                                                      </span>
<span class="-7883404386706876736" onmouseenter="enter('-7883404386706876736');" onmouseout="out('-7883404386706876736');" style=""> 705              d.setBounds(x, y, x + w, y + h);                                                                      </span>
<span class="3763902819788011622" onmouseenter="enter('3763902819788011622');" onmouseout="out('3763902819788011622');" style=""> 706              d.draw(c);                                                                                            </span>
<span class="-5442987023720851592" onmouseenter="enter('-5442987023720851592');" onmouseout="out('-5442987023720851592');" style=""> 707              d.setBounds(oldBounds); // Restore the bounds                                                         </span>
<span class="5675729563233531278" onmouseenter="enter('5675729563233531278');" onmouseout="out('5675729563233531278');" style=""> 708              c.setBitmap(null);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 709          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710      }                                                                                                             </span>
<span  style=""> 711                                                                                                                    </span>
<span class="-2265124982478046254" onmouseenter="enter('-2265124982478046254');" onmouseout="out('-2265124982478046254');" style=""> 712      private Drawable mutateOnMainThread(final Drawable drawable) {                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 713          try {                                                                                                     </span>
<span class="3177563387853690691" onmouseenter="enter('3177563387853690691');" onmouseout="out('3177563387853690691');" style=""> 714              return mMainThreadExecutor.submit(new Callable&lt;Drawable&gt;() {                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 715                  @Override                                                                                         </span>
<span class="4251206983441278885" onmouseenter="enter('4251206983441278885');" onmouseout="out('4251206983441278885');" style=""> 716                  public Drawable call() throws Exception {                                                         </span>
<span class="721315677862243657" onmouseenter="enter('721315677862243657');" onmouseout="out('721315677862243657');" style=""> 717                      return drawable.mutate();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718                  }                                                                                                 </span>
<span class="8868058436262798399" onmouseenter="enter('8868058436262798399');" onmouseout="out('8868058436262798399');" style=""> 719              }).get();                                                                                             </span>
<span class="-7528533024404460182" onmouseenter="enter('-7528533024404460182');" onmouseout="out('-7528533024404460182');" style=""> 720          } catch (InterruptedException e) {                                                                        </span>
<span class="8315424094067049480" onmouseenter="enter('8315424094067049480');" onmouseout="out('8315424094067049480');" style=""> 721              Thread.currentThread().interrupt();                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 722              throw new RuntimeException(e);                                                                        </span>
<span class="-3674505659955768067" onmouseenter="enter('-3674505659955768067');" onmouseout="out('-3674505659955768067');" style=""> 723          } catch (ExecutionException e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 724              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 726      }                                                                                                             </span>
<span  style=""> 727                                                                                                                    </span>
<span class="-1664432510733041020" onmouseenter="enter('-1664432510733041020');" onmouseout="out('-1664432510733041020');" style=""> 728      private static final int MAX_OPEN_FILES = 1024;                                                               </span>
<span class="9072161857204403261" onmouseenter="enter('9072161857204403261');" onmouseout="out('9072161857204403261');" style=""> 729      private static final int SAMPLE_RATE = 23;                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 730      /**                                                                                                           </span>
<span class="4777297713483982548" onmouseenter="enter('4777297713483982548');" onmouseout="out('4777297713483982548');" style=""> 731       * Dumps all files that are open in this process without allocating a file descriptor.                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 732       */                                                                                                           </span>
<span class="7630668132257036624" onmouseenter="enter('7630668132257036624');" onmouseout="out('7630668132257036624');" style=""> 733      private static void dumpOpenFiles() {                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 734          try {                                                                                                     </span>
<span class="7095374185665412657" onmouseenter="enter('7095374185665412657');" onmouseout="out('7095374185665412657');" style=""> 735              Log.i(TAG, &quot;DUMP OF OPEN FILES (sample rate: 1 every &quot; + SAMPLE_RATE + &quot;):&quot;);                         </span>
<span class="-6063809008451063811" onmouseenter="enter('-6063809008451063811');" onmouseout="out('-6063809008451063811');" style=""> 736              final String TYPE_APK = &quot;apk&quot;;                                                                        </span>
<span class="-6901274176875279046" onmouseenter="enter('-6901274176875279046');" onmouseout="out('-6901274176875279046');" style=""> 737              final String TYPE_JAR = &quot;jar&quot;;                                                                        </span>
<span class="-4233944286779457769" onmouseenter="enter('-4233944286779457769');" onmouseout="out('-4233944286779457769');" style=""> 738              final String TYPE_PIPE = &quot;pipe&quot;;                                                                      </span>
<span class="-7830089877175241432" onmouseenter="enter('-7830089877175241432');" onmouseout="out('-7830089877175241432');" style=""> 739              final String TYPE_SOCKET = &quot;socket&quot;;                                                                  </span>
<span class="6234651693695236755" onmouseenter="enter('6234651693695236755');" onmouseout="out('6234651693695236755');" style=""> 740              final String TYPE_DB = &quot;db&quot;;                                                                          </span>
<span class="-6587583242995441423" onmouseenter="enter('-6587583242995441423');" onmouseout="out('-6587583242995441423');" style=""> 741              final String TYPE_ANON_INODE = &quot;anon_inode&quot;;                                                          </span>
<span class="-3500545166621689968" onmouseenter="enter('-3500545166621689968');" onmouseout="out('-3500545166621689968');" style=""> 742              final String TYPE_DEV = &quot;dev&quot;;                                                                        </span>
<span class="2067143891119682248" onmouseenter="enter('2067143891119682248');" onmouseout="out('2067143891119682248');" style=""> 743              final String TYPE_NON_FS = &quot;non-fs&quot;;                                                                  </span>
<span class="5330062242195911314" onmouseenter="enter('5330062242195911314');" onmouseout="out('5330062242195911314');" style=""> 744              final String TYPE_OTHER = &quot;other&quot;;                                                                    </span>
<span class="4846737914738595164" onmouseenter="enter('4846737914738595164');" onmouseout="out('4846737914738595164');" style=""> 745              List&lt;String&gt; types = Arrays.asList(TYPE_APK, TYPE_JAR, TYPE_PIPE, TYPE_SOCKET, TYPE_DB,               </span>
<span class="-1126389211762394977" onmouseenter="enter('-1126389211762394977');" onmouseout="out('-1126389211762394977');" style=""> 746                      TYPE_ANON_INODE, TYPE_DEV, TYPE_NON_FS, TYPE_OTHER);                                          </span>
<span class="7087384337453352553" onmouseenter="enter('7087384337453352553');" onmouseout="out('7087384337453352553');" style=""> 747              int[] count = new int[types.size()];                                                                  </span>
<span class="-400567270817057775" onmouseenter="enter('-400567270817057775');" onmouseout="out('-400567270817057775');" style=""> 748              int[] duplicates = new int[types.size()];                                                             </span>
<span class="-5112763339406897335" onmouseenter="enter('-5112763339406897335');" onmouseout="out('-5112763339406897335');" style=""> 749              HashSet&lt;String&gt; files = new HashSet&lt;String&gt;();                                                        </span>
<span class="-926962837754337949" onmouseenter="enter('-926962837754337949');" onmouseout="out('-926962837754337949');" style=""> 750              int total = 0;                                                                                        </span>
<span class="1028290052541393010" onmouseenter="enter('1028290052541393010');" onmouseout="out('1028290052541393010');" style=""> 751              for (int i = 0; i &lt; MAX_OPEN_FILES; i++) {                                                            </span>
<span class="3040328939873692127" onmouseenter="enter('3040328939873692127');" onmouseout="out('3040328939873692127');" style=""> 752                  // This is a gigantic hack but unfortunately the only way to resolve an fd                        </span>
<span class="-4129207097038329090" onmouseenter="enter('-4129207097038329090');" onmouseout="out('-4129207097038329090');" style=""> 753                  // to a file name. Note that we have to loop over all possible fds because                        </span>
<span class="6927440074701305186" onmouseenter="enter('6927440074701305186');" onmouseout="out('6927440074701305186');" style=""> 754                  // reading the directory would require allocating a new fd. The kernel is                         </span>
<span class="-7335721905258259512" onmouseenter="enter('-7335721905258259512');" onmouseout="out('-7335721905258259512');" style=""> 755                  // currently implemented such that no fd is larger then the current rlimit,                       </span>
<span class="5240836059895527485" onmouseenter="enter('5240836059895527485');" onmouseout="out('5240836059895527485');" style=""> 756                  // which is why it&#x27;s safe to loop over them in such a way.                                        </span>
<span class="-4546857229319265624" onmouseenter="enter('-4546857229319265624');" onmouseout="out('-4546857229319265624');" style=""> 757                  String fd = &quot;/proc/self/fd/&quot; + i;                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 758                  try {                                                                                             </span>
<span class="-5133016265508323671" onmouseenter="enter('-5133016265508323671');" onmouseout="out('-5133016265508323671');" style=""> 759                      // getCanonicalPath() uses readlink behind the scene which doesn&#x27;t require                    </span>
<span class="-6226268635961992542" onmouseenter="enter('-6226268635961992542');" onmouseout="out('-6226268635961992542');" style=""> 760                      // a file descriptor.                                                                         </span>
<span class="-6892856404262336354" onmouseenter="enter('-6892856404262336354');" onmouseout="out('-6892856404262336354');" style=""> 761                      String resolved = new File(fd).getCanonicalPath();                                            </span>
<span class="-6768751510751326128" onmouseenter="enter('-6768751510751326128');" onmouseout="out('-6768751510751326128');" style=""> 762                      int type = types.indexOf(TYPE_OTHER);                                                         </span>
<span class="-848598904663730437" onmouseenter="enter('-848598904663730437');" onmouseout="out('-848598904663730437');" style=""> 763                      if (resolved.startsWith(&quot;/dev/&quot;)) {                                                           </span>
<span class="-4879693837873897752" onmouseenter="enter('-4879693837873897752');" onmouseout="out('-4879693837873897752');" style=""> 764                          type = types.indexOf(TYPE_DEV);                                                           </span>
<span class="-125641070977798446" onmouseenter="enter('-125641070977798446');" onmouseout="out('-125641070977798446');" style=""> 765                      } else if (resolved.endsWith(&quot;.apk&quot;)) {                                                       </span>
<span class="8152606461038952319" onmouseenter="enter('8152606461038952319');" onmouseout="out('8152606461038952319');" style=""> 766                          type = types.indexOf(TYPE_APK);                                                           </span>
<span class="-8895861587282636352" onmouseenter="enter('-8895861587282636352');" onmouseout="out('-8895861587282636352');" style=""> 767                      } else if (resolved.endsWith(&quot;.jar&quot;)) {                                                       </span>
<span class="6211428299849972552" onmouseenter="enter('6211428299849972552');" onmouseout="out('6211428299849972552');" style=""> 768                          type = types.indexOf(TYPE_JAR);                                                           </span>
<span class="-6474781270675272142" onmouseenter="enter('-6474781270675272142');" onmouseout="out('-6474781270675272142');" style=""> 769                      } else if (resolved.contains(&quot;/fd/pipe:&quot;)) {                                                  </span>
<span class="4492281361349576419" onmouseenter="enter('4492281361349576419');" onmouseout="out('4492281361349576419');" style=""> 770                          type = types.indexOf(TYPE_PIPE);                                                          </span>
<span class="5570982548020413210" onmouseenter="enter('5570982548020413210');" onmouseout="out('5570982548020413210');" style=""> 771                      } else if (resolved.contains(&quot;/fd/socket:&quot;)) {                                                </span>
<span class="5340928477240826099" onmouseenter="enter('5340928477240826099');" onmouseout="out('5340928477240826099');" style=""> 772                          type = types.indexOf(TYPE_SOCKET);                                                        </span>
<span class="-1889318263670279425" onmouseenter="enter('-1889318263670279425');" onmouseout="out('-1889318263670279425');" style=""> 773                      } else if (resolved.contains(&quot;/fd/anon_inode:&quot;)) {                                            </span>
<span class="7975978575615021567" onmouseenter="enter('7975978575615021567');" onmouseout="out('7975978575615021567');" style=""> 774                          type = types.indexOf(TYPE_ANON_INODE);                                                    </span>
<span class="-206211141383156363" onmouseenter="enter('-206211141383156363');" onmouseout="out('-206211141383156363');" style=""> 775                      } else if (resolved.endsWith(&quot;.db&quot;) || resolved.contains(&quot;/databases/&quot;)) {                    </span>
<span class="8848130876067097546" onmouseenter="enter('8848130876067097546');" onmouseout="out('8848130876067097546');" style=""> 776                          type = types.indexOf(TYPE_DB);                                                            </span>
<span class="-3013458219347023666" onmouseenter="enter('-3013458219347023666');" onmouseout="out('-3013458219347023666');" style=""> 777                      } else if (resolved.startsWith(&quot;/proc/&quot;) &amp;&amp; resolved.contains(&quot;/fd/&quot;)) {                      </span>
<span class="-4021067240164904881" onmouseenter="enter('-4021067240164904881');" onmouseout="out('-4021067240164904881');" style=""> 778                          // Those are the files that don&#x27;t point anywhere on the file system.                      </span>
<span class="1766191980587176647" onmouseenter="enter('1766191980587176647');" onmouseout="out('1766191980587176647');" style=""> 779                          // getCanonicalPath() wrongly interprets these as relative symlinks and                   </span>
<span class="8319631295934473117" onmouseenter="enter('8319631295934473117');" onmouseout="out('8319631295934473117');" style=""> 780                          // resolves them within /proc/&lt;pid&gt;/fd/.                                                  </span>
<span class="-6071677259167823524" onmouseenter="enter('-6071677259167823524');" onmouseout="out('-6071677259167823524');" style=""> 781                          type = types.indexOf(TYPE_NON_FS);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 782                      }                                                                                             </span>
<span class="-1328162661144416286" onmouseenter="enter('-1328162661144416286');" onmouseout="out('-1328162661144416286');" style=""> 783                      count[type]++;                                                                                </span>
<span class="-6740236498121811269" onmouseenter="enter('-6740236498121811269');" onmouseout="out('-6740236498121811269');" style=""> 784                      total++;                                                                                      </span>
<span class="-1847477132387490804" onmouseenter="enter('-1847477132387490804');" onmouseout="out('-1847477132387490804');" style=""> 785                      if (files.contains(resolved)) {                                                               </span>
<span class="3216339987616567221" onmouseenter="enter('3216339987616567221');" onmouseout="out('3216339987616567221');" style=""> 786                          duplicates[type]++;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787                      }                                                                                             </span>
<span class="-556311909615308250" onmouseenter="enter('-556311909615308250');" onmouseout="out('-556311909615308250');" style=""> 788                      files.add(resolved);                                                                          </span>
<span class="3281685662955304691" onmouseenter="enter('3281685662955304691');" onmouseout="out('3281685662955304691');" style=""> 789                      if (total % SAMPLE_RATE == 0) {                                                               </span>
<span class="-5929979194141152550" onmouseenter="enter('-5929979194141152550');" onmouseout="out('-5929979194141152550');" style=""> 790                          Log.i(TAG, &quot; fd &quot; + i + &quot;: &quot; + resolved                                                   </span>
<span class="-3430556922668437990" onmouseenter="enter('-3430556922668437990');" onmouseout="out('-3430556922668437990');" style=""> 791                                  + &quot; (&quot; + types.get(type) + &quot;)&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 792                      }                                                                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 793                  } catch (IOException e) {                                                                         </span>
<span class="-4332337590956216445" onmouseenter="enter('-4332337590956216445');" onmouseout="out('-4332337590956216445');" style=""> 794                      // Ignoring exceptions for non-existing file descriptors.                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 795                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 796              }                                                                                                     </span>
<span class="1894743204629618523" onmouseenter="enter('1894743204629618523');" onmouseout="out('1894743204629618523');" style=""> 797              for (int i = 0; i &lt; types.size(); i++) {                                                              </span>
<span class="-3358630307652497285" onmouseenter="enter('-3358630307652497285');" onmouseout="out('-3358630307652497285');" style=""> 798                  Log.i(TAG, String.format(&quot;Open %10s files: %4d total, %4d duplicates&quot;,                            </span>
<span class="-7057161233480916817" onmouseenter="enter('-7057161233480916817');" onmouseout="out('-7057161233480916817');" style=""> 799                          types.get(i), count[i], duplicates[i]));                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800              }                                                                                                     </span>
<span class="-8603286158505252436" onmouseenter="enter('-8603286158505252436');" onmouseout="out('-8603286158505252436');" style=""> 801          } catch (Throwable t) {                                                                                   </span>
<span class="6465726010998958367" onmouseenter="enter('6465726010998958367');" onmouseout="out('6465726010998958367');" style=""> 802              // Catch everything. This is called from an exception handler that we shouldn&#x27;t upset.                </span>
<span class="-3798752040153960224" onmouseenter="enter('-3798752040153960224');" onmouseout="out('-3798752040153960224');" style=""> 803              Log.e(TAG, &quot;Unable to log open files.&quot;, t);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            