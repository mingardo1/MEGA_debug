<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>448</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    448
                    <a href="447.html">prev</a>
                    <a href="449.html">next</a>
                    <a href="448_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_cd618352eabd0c074c56f3cd6eba99a0825ae16c_launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cd618352eabd0c074c56f3cd6eba99a0825ae16c:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cd618352eabd0c074c56f3cd6eba99a0825ae16c^1:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;cd618352eabd0c074c56f3cd6eba99a0825ae16c^2:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;1fc0d53fde0767c2c203339b9a5dcfef1607de24:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [s]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">   9  * &lt;p&gt;                                                                                                   </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  11  * &lt;p&gt;                                                                                                   </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  20                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  24 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  25 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  26 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="">  27 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  29 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  30 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  31 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  32 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  33 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  34 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  35 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  36 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  37 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  38 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  39 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  40 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  41 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  45 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  46 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  47 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  48 import java.util.HashSet;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  49 import java.util.Set;                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  51 import java.util.Properties;                                                                             </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  52 import java.util.Iterator;                                                                               </span>
<span  style="">  53                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  55  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  57 public class ClusterClientFactory {                                                                      </span>
<span  style="">  58                                                                                                          </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  59     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  60                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  61     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  62                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  63     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  64                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  65     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  66                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  67     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  68                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  69     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  70                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  71     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  72         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  73         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  74             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  75         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  76             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  78         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  81     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  82         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  83         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span  style="">  84                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  85         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="">  86         config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                          </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  87         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span  style="">  88                                                                                                          </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  89         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  90         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title="  91         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());">  91         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  92         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  93         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  94         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  95         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  98     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title="  99         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();">  99         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.ðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 100         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 100         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguratðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 101         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span  style=""> 102                                                                                                          </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 103         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 104             try {                                                                                        </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style=""> 105                 boolean isHighAvailability;                                                              </span>
<span  style=""> 106                                                                                                          </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style=""> 107                 config.setString(HADOOP_CONF, yarnConfDir);                                              </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style=""> 108                 FileSystem.initialize(config);                                                           </span>
<span  style=""> 109                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 110                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 111                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 112                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 113                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 114                 ApplicationId applicationId;                                                             </span>
<span  style=""> 115                                                                                                          </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 116                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 117                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 118                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 118                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span  style=""> 119                                                                                                          </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 120                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span  style=""> 121                                                                                                          </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 122                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 123                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 124                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 125                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                 }                                                                                        </span>
<span  style=""> 127                                                                                                          </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 128                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span  style=""> 129                                                                                                          </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 130                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 131                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132                 }                                                                                        </span>
<span  style=""> 133                                                                                                          </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 134                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span  style=""> 135                                                                                                          </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style=""> 136                 if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {               </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 137                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                 }                                                                                        </span>
<span  style=""> 139                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 140                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style=""> 141                 config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                  </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 142                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span  style=""> 143                                                                                                          </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 144                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 144                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 145                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 146                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 147                 return clusterClient;                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 148             } catch (Exception e) {                                                                      </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 149                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 151         } else {                                                                                         </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 152             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span  style=""> 156                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 157     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 158         ApplicationId applicationId = null;                                                              </span>
<span  style=""> 159                                                                                                          </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 160         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 161         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 162         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 163         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 164         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span  style=""> 165                                                                                                          </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 166         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 167         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 168         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 169             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 170                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171             }                                                                                            </span>
<span  style=""> 172                                                                                                          </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 173             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 174                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175             }                                                                                            </span>
<span  style=""> 176                                                                                                          </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 177             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 178             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 178             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 179             if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {             </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 180                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 181                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 182                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183             }                                                                                            </span>
<span  style=""> 184                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span  style=""> 186                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 187 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 189 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190         if (StringUtils.isEmpty(applicationId.toString())) {                                             </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 199             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 199             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 214 =======                                                                                                  </span>
<span class="-2052203714416018519" onmouseenter="enter('-2052203714416018519');" onmouseout="out('-2052203714416018519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215         if (null == applicationId) {                                                                     </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 216 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 217             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 219         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220     }                                                                                                    </span>
<span  style=""> 221                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 222     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 223         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 224         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 225             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 225             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 226         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 227             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 228                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 229             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 230                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span  style=""> 234                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 235     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 236         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237     }                                                                                                    </span>
<span  style=""> 238                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239 }                                                                                                        </span></pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">   9  * &lt;p&gt;                                                                                                   </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  11  * &lt;p&gt;                                                                                                   </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  20                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  24 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  25 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  26 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="">  27 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  29 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  30 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  31 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  32 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  33 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  34 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  35 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  36 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  37 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  38 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  39 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  40 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  41 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  45 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  46 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  47 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  48 import java.util.HashSet;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  49 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  51 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  52 import java.util.Set;                                                                                    </span>
<span  style="">  53                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  55  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  57 public class ClusterClientFactory {                                                                      </span>
<span  style="">  58                                                                                                          </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  59     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  60                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  61     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  62                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  63     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  64                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  65     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  66                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  67     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  68                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  69     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  70                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  71     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  72         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  73         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  74             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  75         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  76             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  78         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  81     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  82         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  83         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span  style="">  84                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  85         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="">  86         config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                          </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  87         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span  style="">  88                                                                                                          </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  89         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  90         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title="  91         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());">  91         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  92         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  93         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  94         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  95         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  98     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title="  99         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();">  99         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.ðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 100         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 100         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguratðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 101         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span  style=""> 102                                                                                                          </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 103         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 104             try {                                                                                        </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style=""> 105                 boolean isHighAvailability;                                                              </span>
<span  style=""> 106                                                                                                          </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style=""> 107                 config.setString(HADOOP_CONF, yarnConfDir);                                              </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style=""> 108                 FileSystem.initialize(config);                                                           </span>
<span  style=""> 109                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 110                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 111                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 112                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 113                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 114                 ApplicationId applicationId;                                                             </span>
<span  style=""> 115                                                                                                          </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 116                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 117                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 118                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 118                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span  style=""> 119                                                                                                          </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 120                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span  style=""> 121                                                                                                          </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 122                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 123                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 124                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 125                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                 }                                                                                        </span>
<span  style=""> 127                                                                                                          </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 128                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span  style=""> 129                                                                                                          </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 130                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 131                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132                 }                                                                                        </span>
<span  style=""> 133                                                                                                          </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 134                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span  style=""> 135                                                                                                          </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style=""> 136                 if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {               </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 137                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138                 }                                                                                        </span>
<span  style=""> 139                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 140                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style=""> 141                 config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                  </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 142                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span  style=""> 143                                                                                                          </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 144                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 144                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 145                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 146                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 147                 return clusterClient;                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 148             } catch (Exception e) {                                                                      </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 149                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150             }                                                                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 151         }else{                                                                                           </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 152             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span  style=""> 156                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 157     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 158         ApplicationId applicationId = null;                                                              </span>
<span  style=""> 159                                                                                                          </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 160         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 161         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 162         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 163         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 164         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span  style=""> 165                                                                                                          </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 166         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 167         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 168         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 169             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 170                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171             }                                                                                            </span>
<span  style=""> 172                                                                                                          </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 173             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 174                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175             }                                                                                            </span>
<span  style=""> 176                                                                                                          </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 177             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 178             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 178             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 179             if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {             </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 180                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 181                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 182                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183             }                                                                                            </span>
<span  style=""> 184                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span  style=""> 186                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 187 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 189 ||||||| BASE                                                                                             </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190         if (StringUtils.isEmpty(applicationId.toString())) {                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span class="-2052203714416018519" onmouseenter="enter('-2052203714416018519');" onmouseout="out('-2052203714416018519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         if (null == applicationId) {                                                                     </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 193 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 194             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 196         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 199     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 200         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 201         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 202             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 202             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 203         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 204             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 205                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 206             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 207                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span  style=""> 211                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 212     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 213         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216 }                                                                                                        </span>





















</pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">   9  * &lt;p&gt;                                                                                                   </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  11  * &lt;p&gt;                                                                                                   </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  18 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  20 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  21 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  22 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  23 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  24 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  25 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  26 import java.util.HashSet;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  27 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  29 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  30 import java.util.Set;                                                                                    </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  31 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  32 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  33 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="">  34 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  35 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  36 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  37 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  38 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  39 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  40 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  41 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  42 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  43 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  44 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  45 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  46 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  47 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  48 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  49 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  50 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  51                                                                                                          </span>
<span  style="">  52                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  53 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  54  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  56 public class ClusterClientFactory {                                                                      </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  57     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  58                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  59     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  60                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  61     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  62                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  63     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  64                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  65     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  66                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  67     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  68                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  69     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  70         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  71         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  72             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  73         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  74             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  76         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span  style="">  78                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  79     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  80         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  81         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  82         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="2566798585666021691" onmouseenter="enter('2566798585666021691');" onmouseout="out('2566798585666021691');" style="">  83         config.toMap().forEach(( key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                         </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  84         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  85         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  86         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title="  87         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());">  87         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  88         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  89         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  90         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  91         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92     }                                                                                                    </span>
<span  style="">  93                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  94     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="8205855452126997644" onmouseenter="enter('8205855452126997644');" onmouseout="out('8205855452126997644');" style=""><abbr title="  95         String flinkConfDir = (StringUtils.isEmpty(launcherOptions.getFlinkconf())) ? &quot;&quot; : launcherOptions.getFlinkconf();">  95         String flinkConfDir = (StringUtils.isEmpty(launcherOptions.getFlinkconf())) ? &quot;&quot; : launcherOptionðŸ”µ</abbr></span>
<span class="1888923838990140221" onmouseenter="enter('1888923838990140221');" onmouseout="out('1888923838990140221');" style=""><abbr title="  96         Configuration config = (StringUtils.isEmpty(flinkConfDir)) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);">  96         Configuration config = (StringUtils.isEmpty(flinkConfDir)) ? new Configuration() : GlobalConfigurðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style="">  97         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style="">  98         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  99             try {                                                                                        </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style=""> 100                 boolean isHighAvailability;                                                              </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style=""> 101                 config.setString(HADOOP_CONF, yarnConfDir);                                              </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style=""> 102                 FileSystem.initialize(config);                                                           </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 103                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 104                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 105                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 106                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 107                 ApplicationId applicationId;                                                             </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 108                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 109                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 110                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 110                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 111                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 112                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 113                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 114                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 115                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                 }                                                                                        </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 117                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 118                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 119                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120                 }                                                                                        </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 121                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span class="738415864731919607" onmouseenter="enter('738415864731919607');" onmouseout="out('738415864731919607');" style=""> 122                 if (isHighAvailability &amp;&amp; (config.getString(HA_CLUSTER_ID, null) == null)) {             </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 123                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124                 }                                                                                        </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 125                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="2566798585666021691" onmouseenter="enter('2566798585666021691');" onmouseout="out('2566798585666021691');" style=""> 126                 config.toMap().forEach(( key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                 </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 127                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 128                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 128                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 129                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 130                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 131                 return clusterClient;                                                                    </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 132             } catch (java.lang.Exception e) {                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 133                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 135         } else {                                                                                         </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 136             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138     }                                                                                                    </span>
<span  style=""> 139                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 140     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 141         ApplicationId applicationId = null;                                                              </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 142         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 143         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 144         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 145         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 146         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 147         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 148         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 149         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 150             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 151                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152             }                                                                                            </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 153             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 154                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155             }                                                                                            </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 156             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 157             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 157             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5268332922863238533" onmouseenter="enter('5268332922863238533');" onmouseout="out('5268332922863238533');" style=""> 158             if ((thisMemory &gt; maxMemory) || ((thisMemory == maxMemory) &amp;&amp; (thisCores &gt; maxCores))) {     </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 159                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 160                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 161                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163         }                                                                                                </span>
<span class="7717622633225589961" onmouseenter="enter('7717622633225589961');" onmouseout="out('7717622633225589961');" style=""> 164         if (                                                                                             </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 165 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="898235747344983997" onmouseenter="enter('898235747344983997');" onmouseout="out('898235747344983997');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166 applicationId == null || StringUtils.isEmpty(applicationId.toString())                                   </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 167 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 168 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 168 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 169 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170                                                                                                          </span>
<span class="-2314268889501403909" onmouseenter="enter('-2314268889501403909');" onmouseout="out('-2314268889501403909');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 null == applicationId                                                                                    </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 172 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1344992967432647558" onmouseenter="enter('-1344992967432647558');" onmouseout="out('-1344992967432647558');" style=""> 173         ) {                                                                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 174             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 176         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177     }                                                                                                    </span>
<span  style=""> 178                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 179     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 180         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 181         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 182             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 182             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 183         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 184             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 185                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 186             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 187                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190     }                                                                                                    </span>
<span  style=""> 191                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 192     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 193         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195 }                                                                                                        </span>










































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1  /**                                                                                                               </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 + * &lt;p&gt;                                                                                                            </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  11   * http://www.apache.org/licenses/LICENSE-2.0                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 + * &lt;p&gt;                                                                                                            </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  14   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  15   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  16   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  17   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  18   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  19   */                                                                                                               </span>
<span  style="">  20                                                                                                                    </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  21  package com.dtstack.flink.sql.launcher;                                                                           </span>
<span  style="">  22                                                                                                                    </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  23  import com.dtstack.flink.sql.enums.ClusterMode;                                                                   </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  24  import com.dtstack.flink.sql.option.Options;                                                                      </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  25  import com.dtstack.flink.sql.util.PluginUtil;                                                                     </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import com.esotericsoftware.minlog.Log;                                                                           </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  27  import org.apache.commons.io.Charsets;                                                                            </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  28  import org.apache.commons.lang.StringUtils;                                                                       </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  29  import org.apache.flink.client.program.ClusterClient;                                                             </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import org.apache.flink.client.program.MiniClusterClient;                                                         </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import org.apache.flink.client.program.rest.RestClusterClient;                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  32  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  33  import org.apache.flink.configuration.GlobalConfiguration;                                                        </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  34  import org.apache.flink.configuration.JobManagerOptions;                                                          </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  35  import org.apache.flink.core.fs.FileSystem;                                                                       </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  36  import org.apache.flink.runtime.akka.AkkaUtils;                                                                   </span>
<span class="-2713113410259205994" onmouseenter="enter('-2713113410259205994');" onmouseout="out('-2713113410259205994');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.apache.flink.runtime.minicluster.MiniCluster;                                                          </span>
<span class="1583265242678797853" onmouseenter="enter('1583265242678797853');" onmouseout="out('1583265242678797853');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;                                             </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  39  import org.apache.flink.runtime.util.LeaderConnectionInfo;                                                        </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  40  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                                       </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  41  import org.apache.flink.yarn.YarnClusterDescriptor;                                                               </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  42  import org.apache.hadoop.yarn.api.records.ApplicationId;                                                          </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  43  import org.apache.hadoop.yarn.api.records.ApplicationReport;                                                      </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  44  import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                                   </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  45  import org.apache.hadoop.yarn.client.api.YarnClient;                                                              </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  46  import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                             </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  47  import org.apache.hadoop.yarn.util.StringHelper;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  50                                                                                                                    </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  51  import java.net.InetSocketAddress;                                                                                </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  52  import java.net.URLDecoder;                                                                                       </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  53  import java.util.EnumSet;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  54  import java.util.HashSet;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -import java.util.Iterator;                                                                                        </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +import java.util.Set;                                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  57  import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  58  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -import java.util.Set;                                                                                             </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import java.util.Iterator;                                                                                        </span>
<span  style="">  61                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62  /**                                                                                                               </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  63   * @author sishu.yss                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  64   */                                                                                                               </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  65  public class ClusterClientFactory {                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                                                                                                                  </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +    private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +                                                                                                                  </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +                                                                                                                  </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +    private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +                                                                                                                  </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +    private static final String NODE = &quot;NONE&quot;;                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +                                                                                                                  </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +    private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +                                                                                                                  </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                               </span>
<span  style="">  78                                                                                                                    </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  79      public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {                   </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  80          String mode = launcherOptions.getMode();                                                                  </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  81          if (mode.equals(ClusterMode.standalone.name())) {                                                         </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  82              return createStandaloneClient(launcherOptions);                                                       </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  83          } else if (mode.equals(ClusterMode.yarn.name())) {                                                        </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  84              return createYarnSessionClient(launcherOptions);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85          }                                                                                                         </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  86          throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87      }                                                                                                             </span>
<span  style="">  88                                                                                                                    </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  89      public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {                </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  90          String flinkConfDir = launcherOptions.getFlinkconf();                                                     </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  91          Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                               </span>
<span class="-4067763610081958627" onmouseenter="enter('-4067763610081958627');" onmouseout="out('-4067763610081958627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();                  </span>
<span class="1773871932017020795" onmouseenter="enter('1773871932017020795');" onmouseout="out('1773871932017020795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -        configBuilder.setConfiguration(config);                                                                   </span>
<span class="1652632586658336024" onmouseenter="enter('1652632586658336024');" onmouseout="out('1652632586658336024');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -        MiniCluster miniCluster = new MiniCluster(configBuilder.build());                                         </span>
<span class="6700237672426991131" onmouseenter="enter('6700237672426991131');" onmouseout="out('6700237672426991131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -        MiniClusterClient clusterClient = new MiniClusterClient(config, miniCluster);                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +                                                                                                                  </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +        LOG.info(&quot;------------config params-------------------------&quot;);                                           </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                                   </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +        LOG.info(&quot;-------------------------------------------&quot;);                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                                                                                                                  </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +        RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);                       </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style=""> 102          LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                           </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""> 103          InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());       </span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style=""> 104          config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                          </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style=""> 105          config.setInteger(JobManagerOptions.PORT, address.getPort());                                             </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 106          clusterClient.setDetached(true);                                                                          </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 107          return clusterClient;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108      }                                                                                                             </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style=""> 110      public static ClusterClient createYarnSessionClient(Options launcherOptions) {                                </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title=" 111          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();"> 111          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkcðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 112          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 112          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadCðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 113          String yarnConfDir = launcherOptions.getYarnconf();                                                       </span>
<span  style=""> 114                                                                                                                    </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 115          if (StringUtils.isNotBlank(yarnConfDir)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 116              try {                                                                                                 </span>
<span class="819462190439601526" onmouseenter="enter('819462190439601526');" onmouseout="out('819462190439601526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -                config.setString(&quot;fs.hdfs.hadoopconf&quot;, yarnConfDir);                                              </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                boolean isHighAvailability;                                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                                                                                                                  </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +                config.setString(HADOOP_CONF, yarnConfDir);                                                       </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style=""> 121                  FileSystem.initialize(config);                                                                    </span>
<span  style=""> 122                                                                                                                    </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 123                  YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                             </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 124                  YarnClient yarnClient = YarnClient.createYarnClient();                                            </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 125                  yarnClient.init(yarnConf);                                                                        </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 126                  yarnClient.start();                                                                               </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -                ApplicationId applicationId = null;                                                               </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                ApplicationId applicationId;                                                                      </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 130                  String yarnSessionConf = launcherOptions.getYarnSessionConf();                                    </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 131                  yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());                  </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 132                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 132                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.clasðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +                                                                                                                  </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 134                  Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                                </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 136                  if (null != yid) {                                                                                </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 137                      applicationId = toApplicationId(yid.toString());                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 138                  } else {                                                                                          </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 139                      applicationId = getYarnClusterApplicationId(yarnClient);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                  }                                                                                                 </span>
<span  style=""> 141                                                                                                                    </span>
<span class="-6552011762599352522" onmouseenter="enter('-6552011762599352522');" onmouseout="out('-6552011762599352522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                Log.info(&quot;applicationId={}&quot;, applicationId.toString());                                           </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                                 </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 145                  if (StringUtils.isEmpty(applicationId.toString())) {                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 146                      throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                  }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                                                                                                                  </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {                        </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                    config.setString(HA_CLUSTER_ID, applicationId.toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                                                                                                                  </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                LOG.info(&quot;------------config params-------------------------&quot;);                                   </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                           </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                LOG.info(&quot;-------------------------------------------&quot;);                                          </span>
<span  style=""> 158                                                                                                                    </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 159                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 159                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 160                  ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                          </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 161                  clusterClient.setDetached(true);                                                                  </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 162                  return clusterClient;                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 163              } catch (Exception e) {                                                                               </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 164                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165              }                                                                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -        }else{                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +        } else {                                                                                                  </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 168              throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span  style=""> 172                                                                                                                    </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 173      private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {            </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 174          ApplicationId applicationId = null;                                                                       </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 176          Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                                        </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 177          set.add(&quot;Apache Flink&quot;);                                                                                  </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 178          EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);                       </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 179          enumSet.add(YarnApplicationState.RUNNING);                                                                </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 180          List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                            </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 182          int maxMemory = -1;                                                                                       </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 183          int maxCores = -1;                                                                                        </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 184          for (ApplicationReport report : reportList) {                                                             </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 185              if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 186                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187              }                                                                                                     </span>
<span  style=""> 188                                                                                                                    </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 189              if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 190                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191              }                                                                                                     </span>
<span  style=""> 192                                                                                                                    </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 193              int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();         </span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""> 194              int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();    </span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 195              if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {                      </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 196                  maxMemory = thisMemory;                                                                           </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 197                  maxCores = thisCores;                                                                             </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 198                  applicationId = report.getApplicationId();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199              }                                                                                                     </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201          }                                                                                                         </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -        if (StringUtils.isEmpty(applicationId.toString())) {                                                      </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +        if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                             </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 205              throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206          }                                                                                                         </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 207          return applicationId;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208      }                                                                                                             </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 210      private static ApplicationId toApplicationId(String appIdStr) {                                               </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 211          Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                           </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 212          if (!&quot;application&quot;.equals(it.next())) {                                                                   </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 213              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 213              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicatðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 214          } else {                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 215              try {                                                                                                 </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 216                  return toApplicationId(it);                                                                       </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 217              } catch (NumberFormatException e) {                                                                   </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 218                  throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221      }                                                                                                             </span>
<span  style=""> 222                                                                                                                    </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 223      private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {              </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 224          return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225      }                                                                                                             </span>
<span  style=""> 226                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1  /**                                                                                                               </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>

<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10   * http://www.apache.org/licenses/LICENSE-2.0                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>

<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19  package com.dtstack.flink.sql.launcher;                                                                           </span>
<span  style="">  20                                                                                                                    </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21  import com.dtstack.flink.sql.enums.ClusterMode;                                                                   </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22  import com.dtstack.flink.sql.option.Options;                                                                      </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23  import com.dtstack.flink.sql.util.PluginUtil;                                                                     </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="">  24  import com.esotericsoftware.minlog.Log;                                                                           </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  25  import org.apache.commons.io.Charsets;                                                                            </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  26  import org.apache.commons.lang.StringUtils;                                                                       </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  27  import org.apache.flink.client.program.ClusterClient;                                                             </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="">  28  import org.apache.flink.client.program.MiniClusterClient;                                                         </span>

<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  30  import org.apache.flink.configuration.GlobalConfiguration;                                                        </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  31  import org.apache.flink.configuration.JobManagerOptions;                                                          </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  32  import org.apache.flink.core.fs.FileSystem;                                                                       </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  33  import org.apache.flink.runtime.akka.AkkaUtils;                                                                   </span>
<span class="-2713113410259205994" onmouseenter="enter('-2713113410259205994');" onmouseout="out('-2713113410259205994');" style="">  34  import org.apache.flink.runtime.minicluster.MiniCluster;                                                          </span>
<span class="1583265242678797853" onmouseenter="enter('1583265242678797853');" onmouseout="out('1583265242678797853');" style="">  35  import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;                                             </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  36  import org.apache.flink.runtime.util.LeaderConnectionInfo;                                                        </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  37  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                                       </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  38  import org.apache.flink.yarn.YarnClusterDescriptor;                                                               </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  39  import org.apache.hadoop.yarn.api.records.ApplicationId;                                                          </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  40  import org.apache.hadoop.yarn.api.records.ApplicationReport;                                                      </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  41  import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                                   </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  42  import org.apache.hadoop.yarn.client.api.YarnClient;                                                              </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  43  import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                             </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  44  import org.apache.hadoop.yarn.util.StringHelper;                                                                  </span>


<span  style="">  45                                                                                                                    </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  46  import java.net.InetSocketAddress;                                                                                </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  47  import java.net.URLDecoder;                                                                                       </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  48  import java.util.EnumSet;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  49  import java.util.HashSet;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  50  import java.util.Iterator;                                                                                        </span>

<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  51  import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  52  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  53  import java.util.Set;                                                                                             </span>

<span  style="">  54                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55  /**                                                                                                               </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  56   * @author sishu.yss                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57   */                                                                                                               </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  58  public class ClusterClientFactory {                                                                               </span>












<span  style="">  59                                                                                                                    </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  60      public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {                   </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  61          String mode = launcherOptions.getMode();                                                                  </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  62          if (mode.equals(ClusterMode.standalone.name())) {                                                         </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  63              return createStandaloneClient(launcherOptions);                                                       </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  64          } else if (mode.equals(ClusterMode.yarn.name())) {                                                        </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  65              return createYarnSessionClient(launcherOptions);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66          }                                                                                                         </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  67          throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68      }                                                                                                             </span>
<span  style="">  69                                                                                                                    </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  70      public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {                </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  71          String flinkConfDir = launcherOptions.getFlinkconf();                                                     </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  72          Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                               </span>
<span class="-4067763610081958627" onmouseenter="enter('-4067763610081958627');" onmouseout="out('-4067763610081958627');" style="">  73          MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();                  </span>
<span class="1773871932017020795" onmouseenter="enter('1773871932017020795');" onmouseout="out('1773871932017020795');" style="">  74          configBuilder.setConfiguration(config);                                                                   </span>
<span class="1652632586658336024" onmouseenter="enter('1652632586658336024');" onmouseout="out('1652632586658336024');" style="">  75          MiniCluster miniCluster = new MiniCluster(configBuilder.build());                                         </span>
<span class="6700237672426991131" onmouseenter="enter('6700237672426991131');" onmouseout="out('6700237672426991131');" style="">  76          MiniClusterClient clusterClient = new MiniClusterClient(config, miniCluster);                             </span>






<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  77          LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                           </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style="">  78          InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());       </span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  79          config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                          </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  80          config.setInteger(JobManagerOptions.PORT, address.getPort());                                             </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  81          clusterClient.setDetached(true);                                                                          </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  82          return clusterClient;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83      }                                                                                                             </span>
<span  style="">  84                                                                                                                    </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  85      public static ClusterClient createYarnSessionClient(Options launcherOptions) {                                </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title="  86          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();">  86          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkcðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title="  87          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);">  87          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadCðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style="">  88          String yarnConfDir = launcherOptions.getYarnconf();                                                       </span>
<span  style="">  89                                                                                                                    </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style="">  90          if (StringUtils.isNotBlank(yarnConfDir)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  91              try {                                                                                                 </span>
<span class="819462190439601526" onmouseenter="enter('819462190439601526');" onmouseout="out('819462190439601526');" style="">  92                  config.setString(&quot;fs.hdfs.hadoopconf&quot;, yarnConfDir);                                              </span>



<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="">  93                  FileSystem.initialize(config);                                                                    </span>
<span  style="">  94                                                                                                                    </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style="">  95                  YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                             </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style="">  96                  YarnClient yarnClient = YarnClient.createYarnClient();                                            </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style="">  97                  yarnClient.init(yarnConf);                                                                        </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style="">  98                  yarnClient.start();                                                                               </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style="">  99                  ApplicationId applicationId = null;                                                               </span>

<span  style=""> 100                                                                                                                    </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 101                  String yarnSessionConf = launcherOptions.getYarnSessionConf();                                    </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 102                  yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());                  </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 103                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 103                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.clasðŸ”µ</abbr></span>

<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 104                  Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                                </span>
<span  style=""> 105                                                                                                                    </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 106                  if (null != yid) {                                                                                </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 107                      applicationId = toApplicationId(yid.toString());                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 108                  } else {                                                                                          </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 109                      applicationId = getYarnClusterApplicationId(yarnClient);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110                  }                                                                                                 </span>
<span  style=""> 111                                                                                                                    </span>
<span class="-6552011762599352522" onmouseenter="enter('-6552011762599352522');" onmouseout="out('-6552011762599352522');" style=""> 112                  Log.info(&quot;applicationId={}&quot;, applicationId.toString());                                           </span>

<span  style=""> 113                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 114                  if (StringUtils.isEmpty(applicationId.toString())) {                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 115                      throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                  }                                                                                                 </span>










<span  style=""> 117                                                                                                                    </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 118                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 118                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 119                  ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                          </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 120                  clusterClient.setDetached(true);                                                                  </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 121                  return clusterClient;                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 122              } catch (Exception e) {                                                                               </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 123                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124              }                                                                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 125          }else{                                                                                                    </span>

<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 126              throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128      }                                                                                                             </span>
<span  style=""> 129                                                                                                                    </span>
<span  style=""> 130                                                                                                                    </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 131      private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {            </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 132          ApplicationId applicationId = null;                                                                       </span>
<span  style=""> 133                                                                                                                    </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 134          Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                                        </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 135          set.add(&quot;Apache Flink&quot;);                                                                                  </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 136          EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);                       </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 137          enumSet.add(YarnApplicationState.RUNNING);                                                                </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 138          List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                            </span>
<span  style=""> 139                                                                                                                    </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 140          int maxMemory = -1;                                                                                       </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 141          int maxCores = -1;                                                                                        </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 142          for (ApplicationReport report : reportList) {                                                             </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 143              if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 144                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145              }                                                                                                     </span>
<span  style=""> 146                                                                                                                    </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 147              if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 148                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149              }                                                                                                     </span>
<span  style=""> 150                                                                                                                    </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 151              int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();         </span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""> 152              int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();    </span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 153              if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {                      </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 154                  maxMemory = thisMemory;                                                                           </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 155                  maxCores = thisCores;                                                                             </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 156                  applicationId = report.getApplicationId();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157              }                                                                                                     </span>
<span  style=""> 158                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159          }                                                                                                         </span>
<span  style=""> 160                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -        if (StringUtils.isEmpty(applicationId.toString())) {                                                      </span>
<span class="-2052203714416018519" onmouseenter="enter('-2052203714416018519');" onmouseout="out('-2052203714416018519');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +        if (null == applicationId) {                                                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 163              throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164          }                                                                                                         </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 165          return applicationId;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166      }                                                                                                             </span>
<span  style=""> 167                                                                                                                    </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 168      private static ApplicationId toApplicationId(String appIdStr) {                                               </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 169          Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                           </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 170          if (!&quot;application&quot;.equals(it.next())) {                                                                   </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 171              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 171              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicatðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 172          } else {                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 173              try {                                                                                                 </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 174                  return toApplicationId(it);                                                                       </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 175              } catch (NumberFormatException e) {                                                                   </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 176                  throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179      }                                                                                                             </span>
<span  style=""> 180                                                                                                                    </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 181      private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {              </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 182          return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183      }                                                                                                             </span>
<span  style=""> 184                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            