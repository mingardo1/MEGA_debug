<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>176</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    176
                    <a href="175.html">prev</a>
                    <a href="177.html">next</a>
                    <a href="176_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_b2742e6260e4e7d992c82e42c7d3b352419d17bb_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/order/service/OrderServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/order/service/OrderServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/order/service/OrderServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/order/service/OrderServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;0e1bf7b54bdd251cdbd1077c4e8dc9aae3c8dc95:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/order/service/OrderServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bs], [j]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2522844188166543739" onmouseenter="enter('2522844188166543739');" onmouseout="out('2522844188166543739');" style="">  18 package org.broadleafcommerce.core.order.service;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  21 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  22 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  24 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="7974202605197813097" onmouseenter="enter('7974202605197813097');" onmouseout="out('7974202605197813097');" style="">  25 import org.broadleafcommerce.common.payment.PaymentType;                                                 </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  26 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="7029131086618023959" onmouseenter="enter('7029131086618023959');" onmouseout="out('7029131086618023959');" style="">  27 import org.broadleafcommerce.common.util.TableCreator;                                                   </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  28 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="4803307284880744779" onmouseenter="enter('4803307284880744779');" onmouseout="out('4803307284880744779');" style="">  29 import org.broadleafcommerce.common.util.TypedPredicate;                                                 </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  30 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  31 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  32 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  33 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  34 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="1521662235446319191" onmouseenter="enter('1521662235446319191');" onmouseout="out('1521662235446319191');" style="">  35 import org.broadleafcommerce.core.offer.domain.OfferCode;                                                </span>
<span class="263797997925672445" onmouseenter="enter('263797997925672445');" onmouseout="out('263797997925672445');" style="">  36 import org.broadleafcommerce.core.offer.service.OfferService;                                            </span>
<span class="8148915287428556311" onmouseenter="enter('8148915287428556311');" onmouseout="out('8148915287428556311');" style="">  37 import org.broadleafcommerce.core.offer.service.OfferServiceExtensionManager;                            </span>
<span class="-2264825748950997481" onmouseenter="enter('-2264825748950997481');" onmouseout="out('-2264825748950997481');" style="">  38 import org.broadleafcommerce.core.offer.service.exception.OfferAlreadyAddedException;                    </span>
<span class="6280580908510581954" onmouseenter="enter('6280580908510581954');" onmouseout="out('6280580908510581954');" style="">  39 import org.broadleafcommerce.core.offer.service.exception.OfferException;                                </span>
<span class="7718612833831637853" onmouseenter="enter('7718612833831637853');" onmouseout="out('7718612833831637853');" style="">  40 import org.broadleafcommerce.core.offer.service.exception.OfferExpiredException;                         </span>
<span class="2542407303560298775" onmouseenter="enter('2542407303560298775');" onmouseout="out('2542407303560298775');" style="">  41 import org.broadleafcommerce.core.offer.service.exception.OfferMaxUseExceededException;                  </span>
<span class="7365998840944773425" onmouseenter="enter('7365998840944773425');" onmouseout="out('7365998840944773425');" style="">  42 import org.broadleafcommerce.core.order.dao.OrderDao;                                                    </span>
<span class="-8431629490392379230" onmouseenter="enter('-8431629490392379230');" onmouseout="out('-8431629490392379230');" style="">  43 import org.broadleafcommerce.core.order.domain.BundleOrderItem;                                          </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  44 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="4607558792631823600" onmouseenter="enter('4607558792631823600');" onmouseout="out('4607558792631823600');" style="">  45 import org.broadleafcommerce.core.order.domain.GiftWrapOrderItem;                                        </span>
<span class="3195477135256206744" onmouseenter="enter('3195477135256206744');" onmouseout="out('3195477135256206744');" style="">  46 import org.broadleafcommerce.core.order.domain.NullOrderFactory;                                         </span>
<span class="6568352354414313904" onmouseenter="enter('6568352354414313904');" onmouseout="out('6568352354414313904');" style="">  47 import org.broadleafcommerce.core.order.domain.NullOrderImpl;                                            </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  48 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  49 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  50 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="-4972689095474256973" onmouseenter="enter('-4972689095474256973');" onmouseout="out('-4972689095474256973');" style="">  51 import org.broadleafcommerce.core.order.service.call.ActivityMessageDTO;                                 </span>
<span class="-7160318188857079464" onmouseenter="enter('-7160318188857079464');" onmouseout="out('-7160318188857079464');" style="">  52 import org.broadleafcommerce.core.order.service.call.GiftWrapOrderItemRequest;                           </span>
<span class="-1901438765224473349" onmouseenter="enter('-1901438765224473349');" onmouseout="out('-1901438765224473349');" style="">  53 import org.broadleafcommerce.core.order.service.call.OrderItemRequestDTO;                                </span>
<span class="-3854268344786449631" onmouseenter="enter('-3854268344786449631');" onmouseout="out('-3854268344786449631');" style="">  54 import org.broadleafcommerce.core.order.service.exception.AddToCartException;                            </span>
<span class="-8548142165698551205" onmouseenter="enter('-8548142165698551205');" onmouseout="out('-8548142165698551205');" style="">  55 import org.broadleafcommerce.core.order.service.exception.IllegalCartOperationException;                 </span>
<span class="-3598721789967501677" onmouseenter="enter('-3598721789967501677');" onmouseout="out('-3598721789967501677');" style="">  56 import org.broadleafcommerce.core.order.service.exception.ItemNotFoundException;                         </span>
<span class="4692349346970735648" onmouseenter="enter('4692349346970735648');" onmouseout="out('4692349346970735648');" style="">  57 import org.broadleafcommerce.core.order.service.exception.RemoveFromCartException;                       </span>
<span class="9042395061305363095" onmouseenter="enter('9042395061305363095');" onmouseout="out('9042395061305363095');" style="">  58 import org.broadleafcommerce.core.order.service.exception.UpdateCartException;                           </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  59 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-3953683189888176126" onmouseenter="enter('-3953683189888176126');" onmouseout="out('-3953683189888176126');" style="">  60 import org.broadleafcommerce.core.order.service.workflow.CartOperationRequest;                           </span>
<span class="3604210211865098056" onmouseenter="enter('3604210211865098056');" onmouseout="out('3604210211865098056');" style="">  61 import org.broadleafcommerce.core.payment.dao.OrderPaymentDao;                                           </span>
<span class="725806334255742314" onmouseenter="enter('725806334255742314');" onmouseout="out('725806334255742314');" style="">  62 import org.broadleafcommerce.core.payment.domain.OrderPayment;                                           </span>
<span class="-5451903065912654495" onmouseenter="enter('-5451903065912654495');" onmouseout="out('-5451903065912654495');" style="">  63 import org.broadleafcommerce.core.payment.domain.secure.Referenced;                                      </span>
<span class="5702480564955886723" onmouseenter="enter('5702480564955886723');" onmouseout="out('5702480564955886723');" style="">  64 import org.broadleafcommerce.core.payment.service.SecureOrderPaymentService;                             </span>
<span class="-8638524682328332386" onmouseenter="enter('-8638524682328332386');" onmouseout="out('-8638524682328332386');" style="">  65 import org.broadleafcommerce.core.pricing.service.PricingService;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  66 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  67 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  68 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  69 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  70 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  71 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="2095059086545149108" onmouseenter="enter('2095059086545149108');" onmouseout="out('2095059086545149108');" style="">  72 import org.broadleafcommerce.profile.core.service.CustomerService;                                       </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  73 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  74 import org.hibernate.Session;                                                                            </span>
<span class="-6296437060367579882" onmouseenter="enter('-6296437060367579882');" onmouseout="out('-6296437060367579882');" style="">  75 import org.hibernate.exception.LockAcquisitionException;                                                 </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  76 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="1177291030959407810" onmouseenter="enter('1177291030959407810');" onmouseout="out('1177291030959407810');" style="">  77 import org.springframework.jmx.export.annotation.ManagedAttribute;                                       </span>
<span class="-2411378172167085657" onmouseenter="enter('-2411378172167085657');" onmouseout="out('-2411378172167085657');" style="">  78 import org.springframework.jmx.export.annotation.ManagedResource;                                        </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  79 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  80 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  81 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  82 import org.springframework.transaction.TransactionStatus;                                                </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  83 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span  style="">  84                                                                                                          </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  85 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  86 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  87 import java.util.Collections;                                                                            </span>
<span class="4561244361960433187" onmouseenter="enter('4561244361960433187');" onmouseout="out('4561244361960433187');" style="">  88 import java.util.Comparator;                                                                             </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  89 import java.util.Date;                                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  90 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  91 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  92 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  93 import java.util.Set;                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  95 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  96 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  97 import javax.persistence.PersistenceContext;                                                             </span>
<span  style="">  98                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  99 /**                                                                                                      </span>
<span class="2815697706567038739" onmouseenter="enter('2815697706567038739');" onmouseout="out('2815697706567038739');" style=""> 100  * @author apazzolini                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 101  */                                                                                                      </span>
<span class="7613295130782185909" onmouseenter="enter('7613295130782185909');" onmouseout="out('7613295130782185909');" style=""> 102 @Service(&quot;blOrderService&quot;)                                                                               </span>
<span class="5819673836649587467" onmouseenter="enter('5819673836649587467');" onmouseout="out('5819673836649587467');" style=""><abbr title=" 103 @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLimit=15)"> 103 @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, curreðŸ”µ</abbr></span>
<span class="-2072417237584838241" onmouseenter="enter('-2072417237584838241');" onmouseout="out('-2072417237584838241');" style=""> 104 public class OrderServiceImpl implements OrderService {                                                  </span>
<span class="-6147601375299019476" onmouseenter="enter('-6147601375299019476');" onmouseout="out('-6147601375299019476');" style=""> 105     private static final Log LOG = LogFactory.getLog(OrderServiceImpl.class);                            </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1034856612351701575" onmouseenter="enter('-1034856612351701575');" onmouseout="out('-1034856612351701575');" style=""> 107     /* DAOs */                                                                                           </span>
<span class="4300412198824813091" onmouseenter="enter('4300412198824813091');" onmouseout="out('4300412198824813091');" style=""> 108     @Resource(name = &quot;blOrderPaymentDao&quot;)                                                                </span>
<span class="-6743991484426169368" onmouseenter="enter('-6743991484426169368');" onmouseout="out('-6743991484426169368');" style=""> 109     protected OrderPaymentDao paymentDao;                                                                </span>
<span  style=""> 110                                                                                                          </span>
<span class="-8616512229212864636" onmouseenter="enter('-8616512229212864636');" onmouseout="out('-8616512229212864636');" style=""> 111     @Resource(name = &quot;blOrderDao&quot;)                                                                       </span>
<span class="3205943113513590409" onmouseenter="enter('3205943113513590409');" onmouseout="out('3205943113513590409');" style=""> 112     protected OrderDao orderDao;                                                                         </span>
<span  style=""> 113                                                                                                          </span>
<span class="5779429748772127951" onmouseenter="enter('5779429748772127951');" onmouseout="out('5779429748772127951');" style=""> 114     @Resource(name = &quot;blOfferDao&quot;)                                                                       </span>
<span class="8858788780557179486" onmouseenter="enter('8858788780557179486');" onmouseout="out('8858788780557179486');" style=""> 115     protected OfferDao offerDao;                                                                         </span>
<span  style=""> 116                                                                                                          </span>
<span class="4027092641360680465" onmouseenter="enter('4027092641360680465');" onmouseout="out('4027092641360680465');" style=""> 117     /* Factories */                                                                                      </span>
<span class="-5967051191091567596" onmouseenter="enter('-5967051191091567596');" onmouseout="out('-5967051191091567596');" style=""> 118     @Resource(name = &quot;blNullOrderFactory&quot;)                                                               </span>
<span class="4068278867975252256" onmouseenter="enter('4068278867975252256');" onmouseout="out('4068278867975252256');" style=""> 119     protected NullOrderFactory nullOrderFactory;                                                         </span>
<span  style=""> 120                                                                                                          </span>
<span class="1042938529233933214" onmouseenter="enter('1042938529233933214');" onmouseout="out('1042938529233933214');" style=""> 121     /* Services */                                                                                       </span>
<span class="6969754559269026560" onmouseenter="enter('6969754559269026560');" onmouseout="out('6969754559269026560');" style=""> 122     @Resource(name = &quot;blCustomerService&quot;)                                                                </span>
<span class="5369585293672379772" onmouseenter="enter('5369585293672379772');" onmouseout="out('5369585293672379772');" style=""> 123     protected CustomerService customerService;                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="1740335809005650078" onmouseenter="enter('1740335809005650078');" onmouseout="out('1740335809005650078');" style=""> 125     @Resource(name = &quot;blPricingService&quot;)                                                                 </span>
<span class="-3953942945177082651" onmouseenter="enter('-3953942945177082651');" onmouseout="out('-3953942945177082651');" style=""> 126     protected PricingService pricingService;                                                             </span>
<span  style=""> 127                                                                                                          </span>
<span class="-8762117636097767442" onmouseenter="enter('-8762117636097767442');" onmouseout="out('-8762117636097767442');" style=""> 128     @Resource(name = &quot;blOrderItemService&quot;)                                                               </span>
<span class="-7939877477893967584" onmouseenter="enter('-7939877477893967584');" onmouseout="out('-7939877477893967584');" style=""> 129     protected OrderItemService orderItemService;                                                         </span>
<span  style=""> 130                                                                                                          </span>
<span class="2996711079688344376" onmouseenter="enter('2996711079688344376');" onmouseout="out('2996711079688344376');" style=""> 131     @Resource(name = &quot;blFulfillmentGroupService&quot;)                                                        </span>
<span class="-4012624862608675616" onmouseenter="enter('-4012624862608675616');" onmouseout="out('-4012624862608675616');" style=""> 132     protected FulfillmentGroupService fulfillmentGroupService;                                           </span>
<span  style=""> 133                                                                                                          </span>
<span class="401190535541877398" onmouseenter="enter('401190535541877398');" onmouseout="out('401190535541877398');" style=""> 134     @Resource(name = &quot;blOfferService&quot;)                                                                   </span>
<span class="5260453850719866461" onmouseenter="enter('5260453850719866461');" onmouseout="out('5260453850719866461');" style=""> 135     protected OfferService offerService;                                                                 </span>
<span  style=""> 136                                                                                                          </span>
<span class="-5728623657958779082" onmouseenter="enter('-5728623657958779082');" onmouseout="out('-5728623657958779082');" style=""> 137     @Resource(name = &quot;blSecureOrderPaymentService&quot;)                                                      </span>
<span class="-6581230590179767656" onmouseenter="enter('-6581230590179767656');" onmouseout="out('-6581230590179767656');" style=""> 138     protected SecureOrderPaymentService securePaymentInfoService;                                        </span>
<span  style=""> 139                                                                                                          </span>
<span class="3052322175513128984" onmouseenter="enter('3052322175513128984');" onmouseout="out('3052322175513128984');" style=""> 140     @Resource(name = &quot;blMergeCartService&quot;)                                                               </span>
<span class="8208298738953975930" onmouseenter="enter('8208298738953975930');" onmouseout="out('8208298738953975930');" style=""> 141     protected MergeCartService mergeCartService;                                                         </span>
<span  style=""> 142                                                                                                          </span>
<span class="-5141785283307634971" onmouseenter="enter('-5141785283307634971');" onmouseout="out('-5141785283307634971');" style=""> 143     @Resource(name = &quot;blOrderServiceExtensionManager&quot;)                                                   </span>
<span class="7609575163897375728" onmouseenter="enter('7609575163897375728');" onmouseout="out('7609575163897375728');" style=""> 144     protected OrderServiceExtensionManager extensionManager;                                             </span>
<span  style=""> 145                                                                                                          </span>
<span class="-2568041442687394420" onmouseenter="enter('-2568041442687394420');" onmouseout="out('-2568041442687394420');" style=""> 146     /* Workflows */                                                                                      </span>
<span class="2793266955607927868" onmouseenter="enter('2793266955607927868');" onmouseout="out('2793266955607927868');" style=""> 147     @Resource(name = &quot;blAddItemWorkflow&quot;)                                                                </span>
<span class="-7970748165831650126" onmouseenter="enter('-7970748165831650126');" onmouseout="out('-7970748165831650126');" style=""> 148     protected Processor addItemWorkflow;                                                                 </span>
<span  style=""> 149                                                                                                          </span>
<span class="6527917864594618071" onmouseenter="enter('6527917864594618071');" onmouseout="out('6527917864594618071');" style=""> 150     @Resource(name = &quot;blUpdateProductOptionsForItemWorkflow&quot;)                                            </span>
<span class="-3432528377574027794" onmouseenter="enter('-3432528377574027794');" onmouseout="out('-3432528377574027794');" style=""> 151     private Processor updateProductOptionsForItemWorkflow;                                               </span>
<span  style=""> 152                                                                                                          </span>
<span class="-8676131598314218463" onmouseenter="enter('-8676131598314218463');" onmouseout="out('-8676131598314218463');" style=""> 153     @Resource(name = &quot;blUpdateItemWorkflow&quot;)                                                             </span>
<span class="-4038034170241387616" onmouseenter="enter('-4038034170241387616');" onmouseout="out('-4038034170241387616');" style=""> 154     protected Processor updateItemWorkflow;                                                              </span>
<span  style=""> 155                                                                                                          </span>
<span class="2809816546718326729" onmouseenter="enter('2809816546718326729');" onmouseout="out('2809816546718326729');" style=""> 156     @Resource(name = &quot;blRemoveItemWorkflow&quot;)                                                             </span>
<span class="8820366819754000449" onmouseenter="enter('8820366819754000449');" onmouseout="out('8820366819754000449');" style=""> 157     protected Processor removeItemWorkflow;                                                              </span>
<span  style=""> 158                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 159     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 160     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 161                                                                                                          </span>
<span class="4647563353113875163" onmouseenter="enter('4647563353113875163');" onmouseout="out('4647563353113875163');" style=""> 162     @Value(&quot;${pricing.retry.count.for.lock.failure}&quot;)                                                    </span>
<span class="3768032238220096351" onmouseenter="enter('3768032238220096351');" onmouseout="out('3768032238220096351');" style=""> 163     protected int pricingRetryCountForLockFailure = 3;                                                   </span>
<span  style=""> 164                                                                                                          </span>
<span class="-5649780437206020465" onmouseenter="enter('-5649780437206020465');" onmouseout="out('-5649780437206020465');" style=""> 165     @Value(&quot;${pricing.retry.wait.interval.for.lock.failure}&quot;)                                            </span>
<span class="6143681610186845623" onmouseenter="enter('6143681610186845623');" onmouseout="out('6143681610186845623');" style=""> 166     protected long pricingRetryWaitIntervalForLockFailure = 500L;                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 168     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 169      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="-4084123837140279098" onmouseenter="enter('-4084123837140279098');" onmouseout="out('-4084123837140279098');" style=""><abbr title=" 170      * add-to-cart workflow. This should generally be able to be left false. This is a performance measure and"> 170      * add-to-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="531367490526902986" onmouseenter="enter('531367490526902986');" onmouseout="out('531367490526902986');" style=""> 171      * add-to-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 172      */                                                                                                  </span>
<span class="-6971248696513840261" onmouseenter="enter('-6971248696513840261');" onmouseout="out('-6971248696513840261');" style=""> 173     @Value(&quot;${auto.flush.on.query.during.add.to.cart:false}&quot;)                                            </span>
<span class="-9081510558149889178" onmouseenter="enter('-9081510558149889178');" onmouseout="out('-9081510558149889178');" style=""> 174     protected boolean autoFlushAddToCart = false;                                                        </span>
<span  style=""> 175                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 176     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 177      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5682863995593575399" onmouseenter="enter('5682863995593575399');" onmouseout="out('5682863995593575399');" style=""><abbr title=" 178      * update-cart workflow. This should generally be able to be left false. This is a performance measure and"> 178      * update-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="4015846476888264417" onmouseenter="enter('4015846476888264417');" onmouseout="out('4015846476888264417');" style=""> 179      * update-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 180      */                                                                                                  </span>
<span class="4955973510412192391" onmouseenter="enter('4955973510412192391');" onmouseout="out('4955973510412192391');" style=""> 181     @Value(&quot;${auto.flush.on.query.during.update.cart:false}&quot;)                                            </span>
<span class="-6560708755317111135" onmouseenter="enter('-6560708755317111135');" onmouseout="out('-6560708755317111135');" style=""> 182     protected boolean autoFlushUpdateCart = false;                                                       </span>
<span  style=""> 183                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 184     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 185      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5427441896991106725" onmouseenter="enter('5427441896991106725');" onmouseout="out('5427441896991106725');" style=""><abbr title=" 186      * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure and"> 186      * remove-from-cart workflow. This should generally be able to be left false. This is a performance mðŸ”µ</abbr></span>
<span class="-4648779041241212172" onmouseenter="enter('-4648779041241212172');" onmouseout="out('-4648779041241212172');" style=""> 187      * remove-from-cart operations will be more efficient when this is false.                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 188      */                                                                                                  </span>
<span class="-8172893732176017719" onmouseenter="enter('-8172893732176017719');" onmouseout="out('-8172893732176017719');" style=""> 189     @Value(&quot;${auto.flush.on.query.during.remove.from.cart:false}&quot;)                                       </span>
<span class="-3285670849425830103" onmouseenter="enter('-3285670849425830103');" onmouseout="out('-3285670849425830103');" style=""> 190     protected boolean autoFlushRemoveFromCart = false;                                                   </span>
<span  style=""> 191                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 192     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 193      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="3621392970638403989" onmouseenter="enter('3621392970638403989');" onmouseout="out('3621392970638403989');" style=""><abbr title=" 194      * order save pricing flow. This should generally be able to be left false. This is a performance measure and"> 194      * order save pricing flow. This should generally be able to be left false. This is a performance meaðŸ”µ</abbr></span>
<span class="-6789052884213414091" onmouseenter="enter('-6789052884213414091');" onmouseout="out('-6789052884213414091');" style=""> 195      * save operations will be more efficient when this is false.                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 196      */                                                                                                  </span>
<span class="-188440796641371951" onmouseenter="enter('-188440796641371951');" onmouseout="out('-188440796641371951');" style=""> 197     @Value(&quot;${auto.flush.on.query.during.cart.pricing.save:false}&quot;)                                      </span>
<span class="-7447722827185958723" onmouseenter="enter('-7447722827185958723');" onmouseout="out('-7447722827185958723');" style=""> 198     protected boolean autoFlushSaveCart = false;                                                         </span>
<span  style=""> 199                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style=""> 200     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 201     protected EntityManager em;                                                                          </span>
<span  style=""> 202                                                                                                          </span>
<span class="-6638939562421962482" onmouseenter="enter('-6638939562421962482');" onmouseout="out('-6638939562421962482');" style=""> 203     /* Fields */                                                                                         </span>
<span class="-3415856814483301136" onmouseenter="enter('-3415856814483301136');" onmouseout="out('-3415856814483301136');" style=""> 204     protected boolean moveNamedOrderItems = true;                                                        </span>
<span class="-112332225907304480" onmouseenter="enter('-112332225907304480');" onmouseout="out('-112332225907304480');" style=""> 205     protected boolean deleteEmptyNamedOrders = true;                                                     </span>
<span  style=""> 206                                                                                                          </span>
<span class="8203140173062168288" onmouseenter="enter('8203140173062168288');" onmouseout="out('8203140173062168288');" style=""> 207     protected Boolean automaticallyMergeLikeItems;                                                       </span>
<span  style=""> 208                                                                                                          </span>
<span class="2799370370843719797" onmouseenter="enter('2799370370843719797');" onmouseout="out('2799370370843719797');" style=""> 209     @Resource(name = &quot;blOrderMultishipOptionService&quot;)                                                    </span>
<span class="768036680350789739" onmouseenter="enter('768036680350789739');" onmouseout="out('768036680350789739');" style=""> 210     protected OrderMultishipOptionService orderMultishipOptionService;                                   </span>
<span  style=""> 211                                                                                                          </span>
<span class="1476595721846482438" onmouseenter="enter('1476595721846482438');" onmouseout="out('1476595721846482438');" style=""> 212     @Resource(name = &quot;blOfferServiceExtensionManager&quot;)                                                   </span>
<span class="1464017235088339416" onmouseenter="enter('1464017235088339416');" onmouseout="out('1464017235088339416');" style=""> 213     protected OfferServiceExtensionManager offerServiceExtensionManager;                                 </span>
<span  style=""> 214                                                                                                          </span>
<span  style=""> 215                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 217     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style=""> 218     public Order createNewCartForCustomer(Customer customer) {                                           </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 219 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-3250206482798517655" onmouseenter="enter('-3250206482798517655');" onmouseout="out('-3250206482798517655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220         customer = customerService.saveCustomer(customer);                                               </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221         return orderDao.createNewCartForCustomer(customer);                                              </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 222 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224     public Order createNewCartForCustomer(Customer customer) {                                           </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225         return orderDao.createNewCartForCustomer(customer);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230     public Order createNamedOrderForCustomer(String name, Customer customer) {                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 231 =======                                                                                                  </span>
<span class="-8527029649040543351" onmouseenter="enter('-8527029649040543351');" onmouseout="out('-8527029649040543351');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232         final Object lock = Objects.isNull(customer.getId()) ? customer : customer.getId();              </span>
<span class="-4616623925289667129" onmouseenter="enter('-4616623925289667129');" onmouseout="out('-4616623925289667129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233         synchronized (lock) {                                                                            </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234             return orderDao.createNewCartForCustomer(customer);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         }                                                                                                </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 236 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237     }                                                                                                    </span>
<span  style=""> 238                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 239     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 240     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style=""> 241     public Order createNamedOrderForCustomer(String name, Customer customer) {                           </span>
<span class="-2409876513820161352" onmouseenter="enter('-2409876513820161352');" onmouseout="out('-2409876513820161352');" style=""> 242         Order namedOrder = orderDao.create();                                                            </span>
<span class="-4702827597577679131" onmouseenter="enter('-4702827597577679131');" onmouseout="out('-4702827597577679131');" style=""> 243         namedOrder.setCustomer(customer);                                                                </span>
<span class="-5090709722664798426" onmouseenter="enter('-5090709722664798426');" onmouseout="out('-5090709722664798426');" style=""> 244         namedOrder.setName(name);                                                                        </span>
<span class="-1603494808269519128" onmouseenter="enter('-1603494808269519128');" onmouseout="out('-1603494808269519128');" style=""> 245         namedOrder.setStatus(OrderStatus.NAMED);                                                         </span>
<span  style=""> 246                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 247         if (extensionManager != null) {                                                                  </span>
<span class="8990503012292673298" onmouseenter="enter('8990503012292673298');" onmouseout="out('8990503012292673298');" style=""> 248             extensionManager.getProxy().attachAdditionalDataToNewNamedCart(customer, namedOrder);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249         }                                                                                                </span>
<span  style=""> 250                                                                                                          </span>
<span class="6872588596382822440" onmouseenter="enter('6872588596382822440');" onmouseout="out('6872588596382822440');" style=""> 251         if (BroadleafRequestContext.getBroadleafRequestContext() != null) {                              </span>
<span class="8302259492819337972" onmouseenter="enter('8302259492819337972');" onmouseout="out('8302259492819337972');" style=""> 252             namedOrder.setLocale(BroadleafRequestContext.getBroadleafRequestContext().getLocale());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253         }                                                                                                </span>
<span  style=""> 254                                                                                                          </span>
<span class="-4755266802229314023" onmouseenter="enter('-4755266802229314023');" onmouseout="out('-4755266802229314023');" style=""> 255         return persist(namedOrder); // No need to price here                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256     }                                                                                                    </span>
<span  style=""> 257                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 258     @Override                                                                                            </span>
<span class="-5228222697072727023" onmouseenter="enter('-5228222697072727023');" onmouseout="out('-5228222697072727023');" style=""> 259     public Order findNamedOrderForCustomer(String name, Customer customer) {                             </span>
<span class="3593606300255125692" onmouseenter="enter('3593606300255125692');" onmouseout="out('3593606300255125692');" style=""> 260         return orderDao.readNamedOrderForCustomer(customer, name);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261     }                                                                                                    </span>
<span  style=""> 262                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 263     @Override                                                                                            </span>
<span class="-3536100433526278820" onmouseenter="enter('-3536100433526278820');" onmouseout="out('-3536100433526278820');" style=""> 264     public Order findOrderById(Long orderId) {                                                           </span>
<span class="1161210593743093685" onmouseenter="enter('1161210593743093685');" onmouseout="out('1161210593743093685');" style=""> 265         return orderDao.readOrderById(orderId);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span  style=""> 267                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 268     @Override                                                                                            </span>
<span class="3514330874800299886" onmouseenter="enter('3514330874800299886');" onmouseout="out('3514330874800299886');" style=""> 269     public List&lt;Order&gt; findOrdersByIds(List&lt;Long&gt; orderIds) {                                            </span>
<span class="-3891915877440809040" onmouseenter="enter('-3891915877440809040');" onmouseout="out('-3891915877440809040');" style=""> 270         return orderDao.readOrdersByIds(orderIds);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271     }                                                                                                    </span>
<span  style=""> 272                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 273     @Override                                                                                            </span>
<span class="4729011646907808921" onmouseenter="enter('4729011646907808921');" onmouseout="out('4729011646907808921');" style=""> 274     public Order findOrderById(Long orderId, boolean refresh) {                                          </span>
<span class="-1498807655754375115" onmouseenter="enter('-1498807655754375115');" onmouseout="out('-1498807655754375115');" style=""> 275         return orderDao.readOrderById(orderId, refresh);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276     }                                                                                                    </span>
<span  style=""> 277                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 278     @Override                                                                                            </span>
<span class="6472182469411690717" onmouseenter="enter('6472182469411690717');" onmouseout="out('6472182469411690717');" style=""> 279     public Order getNullOrder() {                                                                        </span>
<span class="-9215158658227454796" onmouseenter="enter('-9215158658227454796');" onmouseout="out('-9215158658227454796');" style=""> 280         return nullOrderFactory.getNullOrder();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 283     @Override                                                                                            </span>
<span class="-868163728006062843" onmouseenter="enter('-868163728006062843');" onmouseout="out('-868163728006062843');" style=""> 284     public Order findCartForCustomer(Customer customer) {                                                </span>
<span class="8766840141038390904" onmouseenter="enter('8766840141038390904');" onmouseout="out('8766840141038390904');" style=""> 285         return orderDao.readCartForCustomer(customer);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 288     @Override                                                                                            </span>
<span class="-7652784715167872669" onmouseenter="enter('-7652784715167872669');" onmouseout="out('-7652784715167872669');" style=""> 289     public List&lt;Order&gt; findOrdersForCustomer(Customer customer) {                                        </span>
<span class="-1451410109320389957" onmouseenter="enter('-1451410109320389957');" onmouseout="out('-1451410109320389957');" style=""> 290         return orderDao.readOrdersForCustomer(customer.getId());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span  style=""> 292                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 293     @Override                                                                                            </span>
<span class="-1874817631753699552" onmouseenter="enter('-1874817631753699552');" onmouseout="out('-1874817631753699552');" style=""> 294     public List&lt;Order&gt; findOrdersForCustomer(Customer customer, OrderStatus status) {                    </span>
<span class="8303115895394445841" onmouseenter="enter('8303115895394445841');" onmouseout="out('8303115895394445841');" style=""> 295         return orderDao.readOrdersForCustomer(customer, status);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 298     @Override                                                                                            </span>
<span class="-5868034956931005765" onmouseenter="enter('-5868034956931005765');" onmouseout="out('-5868034956931005765');" style=""> 299     public Order findOrderByOrderNumber(String orderNumber) {                                            </span>
<span class="4126063111294586184" onmouseenter="enter('4126063111294586184');" onmouseout="out('4126063111294586184');" style=""> 300         return orderDao.readOrderByOrderNumber(orderNumber);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span  style=""> 302                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 303     @Override                                                                                            </span>
<span class="4191009625455802778" onmouseenter="enter('4191009625455802778');" onmouseout="out('4191009625455802778');" style=""> 304     public List&lt;Order&gt; findOrdersByDateRange(Date startDate, Date endDate) {                             </span>
<span class="4159366983783237003" onmouseenter="enter('4159366983783237003');" onmouseout="out('4159366983783237003');" style=""> 305         return orderDao.readOrdersByDateRange(startDate, endDate);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="-5094637214545511446" onmouseenter="enter('-5094637214545511446');" onmouseout="out('-5094637214545511446');" style=""> 309     public List&lt;Order&gt; findOrdersByDaysCount(Integer daysCount, Integer batchSize) {                     </span>
<span class="-5623433853176777156" onmouseenter="enter('-5623433853176777156');" onmouseout="out('-5623433853176777156');" style=""> 310         return orderDao.readOrdersOlderThanDaysCount(daysCount, batchSize);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 313     @Override                                                                                            </span>
<span class="7584459338142486264" onmouseenter="enter('7584459338142486264');" onmouseout="out('7584459338142486264');" style=""><abbr title=" 314     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endDate) {"> 314     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endðŸ”µ</abbr></span>
<span class="-7476578265182813965" onmouseenter="enter('-7476578265182813965');" onmouseout="out('-7476578265182813965');" style=""> 315         return orderDao.readOrdersForCustomersInDateRange(customerIds, startDate, endDate);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 318     @Override                                                                                            </span>
<span class="2742799531036946157" onmouseenter="enter('2742799531036946157');" onmouseout="out('2742799531036946157');" style=""> 319     public List&lt;OrderPayment&gt; findPaymentsForOrder(Order order) {                                        </span>
<span class="-8492719680919611182" onmouseenter="enter('-8492719680919611182');" onmouseout="out('-8492719680919611182');" style=""> 320         return paymentDao.readPaymentsForOrder(order);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321     }                                                                                                    </span>
<span  style=""> 322                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 323     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 324     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-3332960922797777344" onmouseenter="enter('-3332960922797777344');" onmouseout="out('-3332960922797777344');" style=""><abbr title=" 325     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfo) {"> 325     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfoðŸ”µ</abbr></span>
<span class="5531588484946379356" onmouseenter="enter('5531588484946379356');" onmouseout="out('5531588484946379356');" style=""> 326         payment.setOrder(order);                                                                         </span>
<span class="-5902578581570361338" onmouseenter="enter('-5902578581570361338');" onmouseout="out('-5902578581570361338');" style=""> 327         order.getPayments().add(payment);                                                                </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 328         order = persist(order);                                                                          </span>
<span class="3102030919604467575" onmouseenter="enter('3102030919604467575');" onmouseout="out('3102030919604467575');" style=""> 329         int paymentIndex = order.getPayments().size() - 1;                                               </span>
<span  style=""> 330                                                                                                          </span>
<span class="-1059731582497422542" onmouseenter="enter('-1059731582497422542');" onmouseout="out('-1059731582497422542');" style=""> 331         if (securePaymentInfo != null) {                                                                 </span>
<span class="-3146705087638884484" onmouseenter="enter('-3146705087638884484');" onmouseout="out('-3146705087638884484');" style=""> 332             securePaymentInfoService.save(securePaymentInfo);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333         }                                                                                                </span>
<span  style=""> 334                                                                                                          </span>
<span class="-7441301587762344543" onmouseenter="enter('-7441301587762344543');" onmouseout="out('-7441301587762344543');" style=""> 335         return order.getPayments().get(paymentIndex);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336     }                                                                                                    </span>
<span  style=""> 337                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 338     @Override                                                                                            </span>
<span class="-6260636294738378695" onmouseenter="enter('-6260636294738378695');" onmouseout="out('-6260636294738378695');" style=""> 339     public Order save(Order order, boolean priceOrder, boolean repriceItems) throws PricingException {   </span>
<span class="-861950305740674202" onmouseenter="enter('-861950305740674202');" onmouseout="out('-861950305740674202');" style=""> 340         if (repriceItems) {                                                                              </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 341             order.updatePrices();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342         }                                                                                                </span>
<span class="7466161317523035871" onmouseenter="enter('7466161317523035871');" onmouseout="out('7466161317523035871');" style=""> 343         return save(order, priceOrder);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 344     }                                                                                                    </span>
<span  style=""> 345                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 346     @Override                                                                                            </span>
<span class="3492049941937307387" onmouseenter="enter('3492049941937307387');" onmouseout="out('3492049941937307387');" style=""> 347     public Order save(Order order, Boolean priceOrder) throws PricingException {                         </span>
<span class="-7596987583027747839" onmouseenter="enter('-7596987583027747839');" onmouseout="out('-7596987583027747839');" style=""> 348         //persist the order first                                                                        </span>
<span class="-389595421943223582" onmouseenter="enter('-389595421943223582');" onmouseout="out('-389595421943223582');" style=""> 349         TransactionStatus status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                       </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 350                     TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 351         try {                                                                                            </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 352             order = persist(order);                                                                      </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 353             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 354         } catch (RuntimeException ex) {                                                                  </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 355             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 356             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="3415408115507489273" onmouseenter="enter('3415408115507489273');" onmouseout="out('3415408115507489273');" style=""> 359         //make any pricing changes - possibly retrying with the persisted state if there&#x27;s a lock failure</span>
<span class="3259489568218221951" onmouseenter="enter('3259489568218221951');" onmouseout="out('3259489568218221951');" style=""> 360         if (priceOrder) {                                                                                </span>
<span class="1922471648485581677" onmouseenter="enter('1922471648485581677');" onmouseout="out('1922471648485581677');" style=""> 361             int retryCount = 0;                                                                          </span>
<span class="-3964676588024243488" onmouseenter="enter('-3964676588024243488');" onmouseout="out('-3964676588024243488');" style=""> 362             boolean isValid = false;                                                                     </span>
<span class="-6184322868026722475" onmouseenter="enter('-6184322868026722475');" onmouseout="out('-6184322868026722475');" style=""> 363             while (!isValid) {                                                                           </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 364                 Session session = em.unwrap(Session.class);                                              </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 365                 FlushMode current = session.getHibernateFlushMode();                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 366                 try {                                                                                    </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 367                     if (!autoFlushSaveCart) {                                                            </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 368                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 368                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 369                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 369                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 370                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 371                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372                     }                                                                                    </span>
<span class="8892823389652271355" onmouseenter="enter('8892823389652271355');" onmouseout="out('8892823389652271355');" style=""> 373                     order = pricingService.executePricing(order);                                        </span>
<span class="9041443712359372060" onmouseenter="enter('9041443712359372060');" onmouseout="out('9041443712359372060');" style=""> 374                     isValid = true;                                                                      </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 375                 } catch (Exception ex) {                                                                 </span>
<span class="-2271119485062807010" onmouseenter="enter('-2271119485062807010');" onmouseout="out('-2271119485062807010');" style=""> 376                     boolean isValidCause = false;                                                        </span>
<span class="-500838144782668299" onmouseenter="enter('-500838144782668299');" onmouseout="out('-500838144782668299');" style=""> 377                     Throwable cause = ex;                                                                </span>
<span class="1460063134918401876" onmouseenter="enter('1460063134918401876');" onmouseout="out('1460063134918401876');" style=""> 378                     while (!isValidCause) {                                                              </span>
<span class="4260495870590788788" onmouseenter="enter('4260495870590788788');" onmouseout="out('4260495870590788788');" style=""> 379                         if (cause.getClass().equals(LockAcquisitionException.class)) {                   </span>
<span class="-2629587088788625810" onmouseenter="enter('-2629587088788625810');" onmouseout="out('-2629587088788625810');" style=""> 380                             isValidCause = true;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                         }                                                                                </span>
<span class="8625050852301041214" onmouseenter="enter('8625050852301041214');" onmouseout="out('8625050852301041214');" style=""> 382                         cause = cause.getCause();                                                        </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style=""> 383                         if (cause == null) {                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 384                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386                     }                                                                                    </span>
<span class="617128514241385440" onmouseenter="enter('617128514241385440');" onmouseout="out('617128514241385440');" style=""> 387                     if (isValidCause) {                                                                  </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 388                         if (LOG.isInfoEnabled()) {                                                       </span>
<span class="-1515480896436827747" onmouseenter="enter('-1515480896436827747');" onmouseout="out('-1515480896436827747');" style=""><abbr title=" 389                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price again.&quot;);"> 389                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price agðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                         }                                                                                </span>
<span class="-5133746822051192612" onmouseenter="enter('-5133746822051192612');" onmouseout="out('-5133746822051192612');" style=""> 391                         isValid = false;                                                                 </span>
<span class="4577651777641283233" onmouseenter="enter('4577651777641283233');" onmouseout="out('4577651777641283233');" style=""> 392                         if (retryCount &gt;= pricingRetryCountForLockFailure) {                             </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 393                             if (LOG.isInfoEnabled()) {                                                   </span>
<span class="8668513794109504150" onmouseenter="enter('8668513794109504150');" onmouseout="out('8668513794109504150');" style=""><abbr title=" 394                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; + retryCount + &quot;). Throwing exception.&quot;);"> 394                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceedeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                             }                                                                            </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 396                             if (ex instanceof PricingException) {                                        </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 397                                 throw (PricingException) ex;                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 398                             } else {                                                                     </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 399                                 throw new PricingException(ex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 401                         } else {                                                                         </span>
<span class="-1359453246670658998" onmouseenter="enter('-1359453246670658998');" onmouseout="out('-1359453246670658998');" style=""> 402                             order = findOrderById(order.getId());                                        </span>
<span class="1564014130404929121" onmouseenter="enter('1564014130404929121');" onmouseout="out('1564014130404929121');" style=""> 403                             retryCount++;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 405                         try {                                                                            </span>
<span class="-1188508433081841324" onmouseenter="enter('-1188508433081841324');" onmouseout="out('-1188508433081841324');" style=""> 406                             Thread.sleep(pricingRetryWaitIntervalForLockFailure);                        </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style=""> 407                         } catch (Throwable e) {                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 408                             //do nothing                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409                         }                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 410                     } else {                                                                             </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 411                         if (ex instanceof PricingException) {                                            </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 412                             throw (PricingException) ex;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 413                         } else {                                                                         </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 414                             throw new PricingException(ex);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416                     }                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 417                 } finally {                                                                              </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 418                     if (!autoFlushSaveCart) {                                                            </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 419                         session.setHibernateFlushMode(current);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422             }                                                                                            </span>
<span  style=""> 423                                                                                                          </span>
<span class="-3104014921676861204" onmouseenter="enter('-3104014921676861204');" onmouseout="out('-3104014921676861204');" style=""> 424             //make the final save of the priced order                                                    </span>
<span class="-5185576183489418340" onmouseenter="enter('-5185576183489418340');" onmouseout="out('-5185576183489418340');" style=""> 425             status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                     </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 426                                 TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);         </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 427             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 428             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 429             try {                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 430                 if (!autoFlushSaveCart) {                                                                </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 431                     //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 431                     //Performance measure. Hibernate will sometimes perform an autoflush when performing ðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 432                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 432                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 433                     //incorrect results because something has not been flushed to the database yet.      </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 434                     session.setHibernateFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                 }                                                                                        </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 436                 order = persist(order);                                                                  </span>
<span  style=""> 437                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 438                 if (extensionManager != null) {                                                          </span>
<span class="3957126338116198589" onmouseenter="enter('3957126338116198589');" onmouseout="out('3957126338116198589');" style=""> 439                     extensionManager.getProxy().attachAdditionalDataToOrder(order, priceOrder);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440                 }                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 441                 if (!autoFlushSaveCart) {                                                                </span>
<span class="-582956567966567765" onmouseenter="enter('-582956567966567765');" onmouseout="out('-582956567966567765');" style=""> 442                     session.setFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 443                 }                                                                                        </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 444                 TransactionUtils.finalizeTransaction(status, transactionManager, false);                 </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 445             } catch (RuntimeException ex) {                                                              </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 446                 TransactionUtils.finalizeTransaction(status, transactionManager, true);                  </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 447                 throw ex;                                                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 448             } finally {                                                                                  </span>
<span class="8320148466827839591" onmouseenter="enter('8320148466827839591');" onmouseout="out('8320148466827839591');" style=""> 449                 if (!autoFlushSaveCart &amp;&amp; !session.getFlushMode().equals(current)) {                     </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 450                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453         }                                                                                                </span>
<span  style=""> 454                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 455         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 456     }                                                                                                    </span>
<span  style=""> 457                                                                                                          </span>
<span class="3548225205011979861" onmouseenter="enter('3548225205011979861');" onmouseout="out('3548225205011979861');" style=""> 458     // This method exists to provide OrderService methods the ability to save an order                   </span>
<span class="-3137042620959847201" onmouseenter="enter('-3137042620959847201');" onmouseout="out('-3137042620959847201');" style=""> 459     // without having to worry about a PricingException being thrown.                                    </span>
<span class="-8294379095766791864" onmouseenter="enter('-8294379095766791864');" onmouseout="out('-8294379095766791864');" style=""> 460     protected Order persist(Order order) {                                                               </span>
<span class="8818772614490614908" onmouseenter="enter('8818772614490614908');" onmouseout="out('8818772614490614908');" style=""> 461         return orderDao.save(order);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462     }                                                                                                    </span>
<span  style=""> 463                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 464     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 465     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="1194611983531410278" onmouseenter="enter('1194611983531410278');" onmouseout="out('1194611983531410278');" style=""> 466     public void cancelOrder(Order order) {                                                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 467         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468     }                                                                                                    </span>
<span  style=""> 469                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 470     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 471     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="3151062967360623973" onmouseenter="enter('3151062967360623973');" onmouseout="out('3151062967360623973');" style=""> 472     public void deleteOrder(Order order) {                                                               </span>
<span class="362561214599706117" onmouseenter="enter('362561214599706117');" onmouseout="out('362561214599706117');" style=""> 473         orderMultishipOptionService.deleteAllOrderMultishipOptions(order);                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 474         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475     }                                                                                                    </span>
<span  style=""> 476                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 477     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 478     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6908985997151819220" onmouseenter="enter('-6908985997151819220');" onmouseout="out('-6908985997151819220');" style=""><abbr title=" 479     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferException {"> 479     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceptiðŸ”µ</abbr></span>
<span class="-6957816096303048614" onmouseenter="enter('-6957816096303048614');" onmouseout="out('-6957816096303048614');" style=""> 480         ArrayList&lt;OfferCode&gt; offerCodes = new ArrayList&lt;OfferCode&gt;();                                    </span>
<span class="-3489605780287301859" onmouseenter="enter('-3489605780287301859');" onmouseout="out('-3489605780287301859');" style=""> 481         offerCodes.add(offerCode);                                                                       </span>
<span class="5360942362216082169" onmouseenter="enter('5360942362216082169');" onmouseout="out('5360942362216082169');" style=""> 482         return addOfferCodes(order, offerCodes, priceOrder);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483     }                                                                                                    </span>
<span  style=""> 484                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 485     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 486     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6002760974922308486" onmouseenter="enter('-6002760974922308486');" onmouseout="out('-6002760974922308486');" style=""><abbr title=" 487     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingException, OfferException {"> 487     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricinðŸ”µ</abbr></span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 488         preValidateCartOperation(order);                                                                 </span>
<span class="-6297044254079066685" onmouseenter="enter('-6297044254079066685');" onmouseout="out('-6297044254079066685');" style=""> 489         Set&lt;Offer&gt; addedOffers = offerService.getUniqueOffersFromOrder(order);                           </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 490         if (extensionManager != null) {                                                                  </span>
<span class="4843221393928633011" onmouseenter="enter('4843221393928633011');" onmouseout="out('4843221393928633011');" style=""> 491             extensionManager.getProxy().addOfferCodes(order, offerCodes, priceOrder);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492         }                                                                                                </span>
<span class="-5013116012900958115" onmouseenter="enter('-5013116012900958115');" onmouseout="out('-5013116012900958115');" style=""> 493         if (offerCodes != null &amp;&amp; !offerCodes.isEmpty()) {                                               </span>
<span class="8649045155270180220" onmouseenter="enter('8649045155270180220');" onmouseout="out('8649045155270180220');" style=""> 494             for (OfferCode offerCode : offerCodes) {                                                     </span>
<span  style=""> 495                                                                                                          </span>
<span class="-7298696073195110538" onmouseenter="enter('-7298696073195110538');" onmouseout="out('-7298696073195110538');" style=""><abbr title=" 496                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) {"> 496                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOðŸ”µ</abbr></span>
<span class="6234350320401768221" onmouseenter="enter('6234350320401768221');" onmouseout="out('6234350320401768221');" style=""> 497                     throw new OfferAlreadyAddedException(&quot;The offer has already been added.&quot;);           </span>
<span class="-3830868071340909057" onmouseenter="enter('-3830868071340909057');" onmouseout="out('-3830868071340909057');" style=""> 498                 } else if (!offerService.verifyMaxCustomerUsageThreshold(order, offerCode)) {            </span>
<span class="4333070718197812940" onmouseenter="enter('4333070718197812940');" onmouseout="out('4333070718197812940');" style=""><abbr title=" 499                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maximum allowed number of times.&quot;);"> 499                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more thðŸ”µ</abbr></span>
<span class="-5924935946468451057" onmouseenter="enter('-5924935946468451057');" onmouseout="out('-5924935946468451057');" style=""> 500                 } else if (!offerCode.isActive() || !offerCode.getOffer().isActive()) {                  </span>
<span class="-5410451342198456207" onmouseenter="enter('-5410451342198456207');" onmouseout="out('-5410451342198456207');" style=""> 501                     throw new OfferExpiredException(&quot;The offer has expired.&quot;);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502                 }                                                                                        </span>
<span  style=""> 503                                                                                                          </span>
<span class="-8263838424494001377" onmouseenter="enter('-8263838424494001377');" onmouseout="out('-8263838424494001377');" style=""> 504                 order.getAddedOfferCodes().add(offerCode);                                               </span>
<span  style=""> 505                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506             }                                                                                            </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 507             order = save(order, priceOrder);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508         }                                                                                                </span>
<span  style=""> 509                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 510         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511     }                                                                                                    </span>
<span  style=""> 512                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 513     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 514     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-8165165962317769711" onmouseenter="enter('-8165165962317769711');" onmouseout="out('-8165165962317769711');" style=""><abbr title=" 515     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException {"> 515     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceðŸ”µ</abbr></span>
<span class="7292636042273352545" onmouseenter="enter('7292636042273352545');" onmouseout="out('7292636042273352545');" style=""> 516         order.getAddedOfferCodes().remove(offerCode);                                                    </span>
<span class="-7106254142148835248" onmouseenter="enter('-7106254142148835248');" onmouseout="out('-7106254142148835248');" style=""> 517         offerServiceExtensionManager.removeOfferCodeFromOrder(offerCode, order);                         </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 518         order = save(order, priceOrder);                                                                 </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 519         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520     }                                                                                                    </span>
<span  style=""> 521                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 522     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 523     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1709915701203298020" onmouseenter="enter('-1709915701203298020');" onmouseout="out('-1709915701203298020');" style=""> 524     public Order removeAllOfferCodes(Order order, boolean priceOrder) throws PricingException {          </span>
<span class="-6954607053476807171" onmouseenter="enter('-6954607053476807171');" onmouseout="out('-6954607053476807171');" style=""> 525          order.getAddedOfferCodes().clear();                                                             </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 526          order = save(order, priceOrder);                                                                </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 527          return order;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span  style=""> 529                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 530     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 531     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 531     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="6605929857558449758" onmouseenter="enter('6605929857558449758');" onmouseout="out('6605929857558449758');" style=""> 532     public void setDeleteEmptyNamedOrders(boolean deleteEmptyNamedOrders) {                              </span>
<span class="-5922450764665272748" onmouseenter="enter('-5922450764665272748');" onmouseout="out('-5922450764665272748');" style=""> 533         this.deleteEmptyNamedOrders = deleteEmptyNamedOrders;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534     }                                                                                                    </span>
<span  style=""> 535                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 536     @Override                                                                                            </span>
<span class="8809427274039428572" onmouseenter="enter('8809427274039428572');" onmouseout="out('8809427274039428572');" style=""> 537     public OrderItem findLastMatchingItem(Order order, Long skuId, Long productId) {                     </span>
<span class="3897119298100986011" onmouseenter="enter('3897119298100986011');" onmouseout="out('3897119298100986011');" style=""> 538         if (order.getOrderItems() != null) {                                                             </span>
<span class="3057467599356722650" onmouseenter="enter('3057467599356722650');" onmouseout="out('3057467599356722650');" style=""> 539             for (int i=(order.getOrderItems().size()-1); i &gt;= 0; i--) {                                  </span>
<span class="-8753960614479292481" onmouseenter="enter('-8753960614479292481');" onmouseout="out('-8753960614479292481');" style=""> 540                 OrderItem currentItem = (order.getOrderItems().get(i));                                  </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style=""> 541                 if (currentItem instanceof DiscreteOrderItem) {                                          </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style=""> 542                     DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                    </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 543                     if (skuId != null) {                                                                 </span>
<span class="-8668132489177117394" onmouseenter="enter('-8668132489177117394');" onmouseout="out('-8668132489177117394');" style=""><abbr title=" 544                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId())) {"> 544                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId()))ðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 545                             return discreteItem;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546                         }                                                                                </span>
<span class="2262602886329333955" onmouseenter="enter('2262602886329333955');" onmouseout="out('2262602886329333955');" style=""><abbr title=" 547                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteItem.getProduct().getId())) {"> 547                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equalsðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 548                         return discreteItem;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                     }                                                                                    </span>
<span  style=""> 550                                                                                                          </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style=""> 551                 } else if (currentItem instanceof BundleOrderItem) {                                     </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style=""> 552                     BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                          </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 553                     if (skuId != null) {                                                                 </span>
<span class="-2960070722540544872" onmouseenter="enter('-2960070722540544872');" onmouseout="out('-2960070722540544872');" style=""> 554                         if (bundleItem.getSku() != null &amp;&amp; skuId.equals(bundleItem.getSku().getId())) {  </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 555                             return bundleItem;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556                         }                                                                                </span>
<span class="2116719638664851076" onmouseenter="enter('2116719638664851076');" onmouseout="out('2116719638664851076');" style=""><abbr title=" 557                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItem.getProduct().getId())) {"> 557                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bðŸ”µ</abbr></span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 558                         return bundleItem;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 563         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564     }                                                                                                    </span>
<span  style=""> 565                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 566     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 567     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6433964895207235713" onmouseenter="enter('-6433964895207235713');" onmouseout="out('-6433964895207235713');" style=""> 568     public Order confirmOrder(Order order) {                                                             </span>
<span class="9181791888739176058" onmouseenter="enter('9181791888739176058');" onmouseout="out('9181791888739176058');" style=""> 569         return orderDao.submitOrder(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570     }                                                                                                    </span>
<span  style=""> 571                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 572     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 573     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1196063989926378996" onmouseenter="enter('-1196063989926378996');" onmouseout="out('-1196063989926378996');" style=""><abbr title=" 574     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 574     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartExcðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 575         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 576         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 577             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578         }                                                                                                </span>
<span class="6349420761965903996" onmouseenter="enter('6349420761965903996');" onmouseout="out('6349420761965903996');" style=""> 579         List&lt;OrderItem&gt; items = new ArrayList&lt;OrderItem&gt;(namedOrder.getOrderItems());                    </span>
<span  style=""> 580                                                                                                          </span>
<span class="6607428262094447152" onmouseenter="enter('6607428262094447152');" onmouseout="out('6607428262094447152');" style=""> 581         // Remove any order items that are children                                                      </span>
<span class="7631703850134052237" onmouseenter="enter('7631703850134052237');" onmouseout="out('7631703850134052237');" style=""> 582         CollectionUtils.filter(items,  new TypedPredicate&lt;OrderItem&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 583             @Override                                                                                    </span>
<span class="4901231018495450056" onmouseenter="enter('4901231018495450056');" onmouseout="out('4901231018495450056');" style=""> 584             public boolean eval(OrderItem orderItem) {                                                   </span>
<span class="-2481948952058789921" onmouseenter="enter('-2481948952058789921');" onmouseout="out('-2481948952058789921');" style=""> 585                 return orderItem.getParentOrderItem() == null;                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 587         });                                                                                              </span>
<span class="-4844745637831365496" onmouseenter="enter('-4844745637831365496');" onmouseout="out('-4844745637831365496');" style=""> 588         for (OrderItem item : items) {                                                                   </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 589             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 589             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItemðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 590             cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                        </span>
<span  style=""> 591                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 592             if (moveNamedOrderItems) {                                                                   </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 593                 removeItem(namedOrder.getId(), item.getId(), false);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span  style=""> 596                                                                                                          </span>
<span class="-6527299291227137901" onmouseenter="enter('-6527299291227137901');" onmouseout="out('-6527299291227137901');" style=""> 597         if (deleteEmptyNamedOrders) {                                                                    </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 598             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599         }                                                                                                </span>
<span  style=""> 600                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 601         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602     }                                                                                                    </span>
<span  style=""> 603                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 604     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 605     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="486294103490899905" onmouseenter="enter('486294103490899905');" onmouseout="out('486294103490899905');" style=""><abbr title=" 606     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 606     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemovðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 607         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 608         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 609             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610         }                                                                                                </span>
<span  style=""> 611                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 612         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 612         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 613         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 614                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 615         if (moveNamedOrderItems) {                                                                       </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 616             removeItem(namedOrder.getId(), item.getId(), false);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617         }                                                                                                </span>
<span  style=""> 618                                                                                                          </span>
<span class="-3555431676535314681" onmouseenter="enter('-3555431676535314681');" onmouseout="out('-3555431676535314681');" style=""> 619         if (namedOrder.getOrderItems().size() == 0 &amp;&amp; deleteEmptyNamedOrders) {                          </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 620             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 621         }                                                                                                </span>
<span  style=""> 622                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 623         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 624     }                                                                                                    </span>
<span  style=""> 625                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 626     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 627     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="6073762115033780324" onmouseenter="enter('6073762115033780324');" onmouseout="out('6073762115033780324');" style=""><abbr title=" 628     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws RemoveFromCartException, AddToCartException, UpdateCartException {"> 628     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrderðŸ”µ</abbr></span>
<span class="-6164187211557222893" onmouseenter="enter('-6164187211557222893');" onmouseout="out('-6164187211557222893');" style=""> 629         // Validate that the quantity requested makes sense                                              </span>
<span class="632487064450637769" onmouseenter="enter('632487064450637769');" onmouseout="out('632487064450637769');" style=""> 630         if (quantity &lt; 1 || quantity &gt; item.getQuantity()) {                                             </span>
<span class="9015263082333587317" onmouseenter="enter('9015263082333587317');" onmouseout="out('9015263082333587317');" style=""> 631             throw new IllegalArgumentException(&quot;Cannot move 0 or less quantity&quot;);                        </span>
<span class="5237951611682684444" onmouseenter="enter('5237951611682684444');" onmouseout="out('5237951611682684444');" style=""> 632         } else if (quantity == item.getQuantity()) {                                                     </span>
<span class="-6422299663726892430" onmouseenter="enter('-6422299663726892430');" onmouseout="out('-6422299663726892430');" style=""> 633             return addItemFromNamedOrder(namedOrder, item, priceOrder);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634         }                                                                                                </span>
<span  style=""> 635                                                                                                          </span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 636         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 637         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 638             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639         }                                                                                                </span>
<span  style=""> 640                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 641         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 641         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="8127078771873751614" onmouseenter="enter('8127078771873751614');" onmouseout="out('8127078771873751614');" style=""> 642         orderItemRequest.setQuantity(quantity);                                                          </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 643         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 644                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 645         if (moveNamedOrderItems) {                                                                       </span>
<span class="-1872324351499578531" onmouseenter="enter('-1872324351499578531');" onmouseout="out('-1872324351499578531');" style=""> 646             // Update the old item to its new quantity only if we&#x27;re moving items                        </span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 647             OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                         </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 648             orderItemRequestDTO.setOrderItemId(item.getId());                                            </span>
<span class="2294188755442690225" onmouseenter="enter('2294188755442690225');" onmouseout="out('2294188755442690225');" style=""> 649             orderItemRequestDTO.setQuantity(item.getQuantity() - quantity);                              </span>
<span class="4972493477102298628" onmouseenter="enter('4972493477102298628');" onmouseout="out('4972493477102298628');" style=""> 650             updateItemQuantity(namedOrder.getId(), orderItemRequestDTO, false);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651         }                                                                                                </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 652         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 653     }                                                                                                    </span>
<span  style=""> 654                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 655     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 656     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1212731706886603863" onmouseenter="enter('-1212731706886603863');" onmouseout="out('-1212731706886603863');" style=""><abbr title=" 657     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder) throws PricingException {"> 657     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean prðŸ”µ</abbr></span>
<span class="6582622510368580131" onmouseenter="enter('6582622510368580131');" onmouseout="out('6582622510368580131');" style=""> 658         GiftWrapOrderItem item = orderItemService.createGiftWrapOrderItem(itemRequest);                  </span>
<span class="-474933544378469288" onmouseenter="enter('-474933544378469288');" onmouseout="out('-474933544378469288');" style=""> 659         item.setOrder(order);                                                                            </span>
<span class="-5871784861123565961" onmouseenter="enter('-5871784861123565961');" onmouseout="out('-5871784861123565961');" style=""> 660         item = (GiftWrapOrderItem) orderItemService.saveOrderItem(item);                                 </span>
<span  style=""> 661                                                                                                          </span>
<span class="6197964192831249775" onmouseenter="enter('6197964192831249775');" onmouseout="out('6197964192831249775');" style=""> 662         order.getOrderItems().add(item);                                                                 </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 663         order = save(order, priceOrder);                                                                 </span>
<span  style=""> 664                                                                                                          </span>
<span class="-3331987500944083076" onmouseenter="enter('-3331987500944083076');" onmouseout="out('-3331987500944083076');" style=""> 665         return item;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666     }                                                                                                    </span>
<span  style=""> 667                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 668     @Override                                                                                            </span>
<span class="684519713081169381" onmouseenter="enter('684519713081169381');" onmouseout="out('684519713081169381');" style=""> 669     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {AddToCartException.class})             </span>
<span class="4069854779845915812" onmouseenter="enter('4069854779845915812');" onmouseout="out('4069854779845915812');" style=""><abbr title=" 670     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 670     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throwðŸ”µ</abbr></span>
<span class="-1143974214922837949" onmouseenter="enter('-1143974214922837949');" onmouseout="out('-1143974214922837949');" style=""> 671         // Don&#x27;t allow overrides from this method.                                                       </span>
<span class="8194194096343660389" onmouseenter="enter('8194194096343660389');" onmouseout="out('8194194096343660389');" style=""> 672         orderItemRequestDTO.setOverrideRetailPrice(null);                                                </span>
<span class="-5206909193534990943" onmouseenter="enter('-5206909193534990943');" onmouseout="out('-5206909193534990943');" style=""> 673         orderItemRequestDTO.setOverrideSalePrice(null);                                                  </span>
<span class="-7735674882921518291" onmouseenter="enter('-7735674882921518291');" onmouseout="out('-7735674882921518291');" style=""> 674         return addItemWithPriceOverrides(orderId, orderItemRequestDTO, priceOrder);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 675     }                                                                                                    </span>
<span  style=""> 676                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 677     @Override                                                                                            </span>
<span class="-670805249178869687" onmouseenter="enter('-670805249178869687');" onmouseout="out('-670805249178869687');" style=""> 678     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { AddToCartException.class })           </span>
<span class="2295594549845892145" onmouseenter="enter('2295594549845892145');" onmouseout="out('2295594549845892145');" style=""><abbr title=" 679     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 679     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleanðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 680         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 681         preValidateCartOperation(order);                                                                 </span>
<span class="2914653273227801204" onmouseenter="enter('2914653273227801204');" onmouseout="out('2914653273227801204');" style=""> 682         if (getAutomaticallyMergeLikeItems()) {                                                          </span>
<span class="-1260995424369374686" onmouseenter="enter('-1260995424369374686');" onmouseout="out('-1260995424369374686');" style=""> 683             OrderItem item = findMatchingItem(order, orderItemRequestDTO);                               </span>
<span class="-4741837152748801640" onmouseenter="enter('-4741837152748801640');" onmouseout="out('-4741837152748801640');" style=""> 684             if (item != null &amp;&amp; item.getParentOrderItem() == null) {                                     </span>
<span class="8907881414365549792" onmouseenter="enter('8907881414365549792');" onmouseout="out('8907881414365549792');" style=""> 685                 orderItemRequestDTO.setQuantity(item.getQuantity() + orderItemRequestDTO.getQuantity()); </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 686                 orderItemRequestDTO.setOrderItemId(item.getId());                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 687                 try {                                                                                    </span>
<span class="-1392380570648359537" onmouseenter="enter('-1392380570648359537');" onmouseout="out('-1392380570648359537');" style=""> 688                     return updateItemQuantity(orderId, orderItemRequestDTO, priceOrder);                 </span>
<span class="2264439919030346254" onmouseenter="enter('2264439919030346254');" onmouseout="out('2264439919030346254');" style=""> 689                 } catch (RemoveFromCartException e) {                                                    </span>
<span class="3695461348108676960" onmouseenter="enter('3695461348108676960');" onmouseout="out('3695461348108676960');" style=""><abbr title=" 690                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cart&quot;, e);"> 690                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adðŸ”µ</abbr></span>
<span class="-268181248887409465" onmouseenter="enter('-268181248887409465');" onmouseout="out('-268181248887409465');" style=""> 691                 } catch (UpdateCartException e) {                                                        </span>
<span class="9009836242172298460" onmouseenter="enter('9009836242172298460');" onmouseout="out('9009836242172298460');" style=""> 692                     throw new AddToCartException(&quot;Could not update quantity for matched item&quot;, e);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 694             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 695         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 696         try {                                                                                            </span>
<span class="5353648265182308095" onmouseenter="enter('5353648265182308095');" onmouseout="out('5353648265182308095');" style=""><abbr title=" 697             // We only want to price on the last addition for performance reasons and only if the user asked for it."> 697             // We only want to price on the last addition for performance reasons and only if the user asðŸ”µ</abbr></span>
<span class="4429210190612929719" onmouseenter="enter('4429210190612929719');" onmouseout="out('4429210190612929719');" style=""> 698             int numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO)) : -1;  </span>
<span class="94226225238380310" onmouseenter="enter('94226225238380310');" onmouseout="out('94226225238380310');" style=""> 699             int currentAddition = 1;                                                                     </span>
<span  style=""> 700                                                                                                          </span>
<span class="3086923041990690310" onmouseenter="enter('3086923041990690310');" onmouseout="out('3086923041990690310');" style=""><abbr title=" 701             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, currentAddition == numAdditionRequests);"> 701             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span  style=""> 702                                                                                                          </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 703             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 704             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 705             if (!autoFlushAddToCart) {                                                                   </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 706                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 706                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 707                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 707                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 708                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 709                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 711             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 712             try {                                                                                        </span>
<span class="1764939006998328340" onmouseenter="enter('1764939006998328340');" onmouseout="out('1764939006998328340');" style=""><abbr title=" 713                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequest);"> 713                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequeðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 714             } finally {                                                                                  </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 715                 if (!autoFlushAddToCart) {                                                               </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 716                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 717                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718             }                                                                                            </span>
<span  style=""> 719                                                                                                          </span>
<span class="-507750410624174489" onmouseenter="enter('-507750410624174489');" onmouseout="out('-507750410624174489');" style=""> 720             List&lt;ActivityMessageDTO&gt; orderMessages = new ArrayList&lt;ActivityMessageDTO&gt;();                </span>
<span class="-9090729846937660303" onmouseenter="enter('-9090729846937660303');" onmouseout="out('-9090729846937660303');" style=""> 721             orderMessages.addAll(((ActivityMessages) context).getActivityMessages());                    </span>
<span  style=""> 722                                                                                                          </span>
<span class="7756277132938928975" onmouseenter="enter('7756277132938928975');" onmouseout="out('7756277132938928975');" style=""> 723             // Update the orderItemRequest incase it changed during the initial add to cart workflow     </span>
<span class="-7203895251723249067" onmouseenter="enter('-7203895251723249067');" onmouseout="out('-7203895251723249067');" style=""> 724             orderItemRequestDTO = context.getSeedData().getItemRequest();                                </span>
<span class="4534199544912449864" onmouseenter="enter('4534199544912449864');" onmouseout="out('4534199544912449864');" style=""> 725             numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO) - 1) : -1;  </span>
<span class="4780820064776482606" onmouseenter="enter('4780820064776482606');" onmouseout="out('4780820064776482606');" style=""><abbr title=" 726             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessages);"> 726             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessagðŸ”µ</abbr></span>
<span  style=""> 727                                                                                                          </span>
<span class="-2935463552695848258" onmouseenter="enter('-2935463552695848258');" onmouseout="out('-2935463552695848258');" style=""> 728             context.getSeedData().getOrder().setOrderMessages(orderMessages);                            </span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 729             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 730         } catch (WorkflowException e) {                                                                  </span>
<span class="-1335771490090575105" onmouseenter="enter('-1335771490090575105');" onmouseout="out('-1335771490090575105');" style=""> 731             throw new AddToCartException(&quot;Could not add to cart&quot;, getCartOperationExceptionRootCause(e));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732         }                                                                                                </span>
<span  style=""> 733                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734     }                                                                                                    </span>
<span  style=""> 735                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 736     @Override                                                                                            </span>
<span class="-3516024114449400059" onmouseenter="enter('-3516024114449400059');" onmouseout="out('-3516024114449400059');" style=""> 737     public int getTotalChildOrderItems(OrderItemRequestDTO orderItemRequestDTO) {                        </span>
<span class="-4883106140571490694" onmouseenter="enter('-4883106140571490694');" onmouseout="out('-4883106140571490694');" style=""> 738         int count = 1;                                                                                   </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 739         for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {              </span>
<span class="-8452259100874171936" onmouseenter="enter('-8452259100874171936');" onmouseout="out('-8452259100874171936');" style=""> 740             count += getTotalChildOrderItems(childRequest);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 741         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 742         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 743     }                                                                                                    </span>
<span  style=""> 744                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 745     @Override                                                                                            </span>
<span class="6996885202551649754" onmouseenter="enter('6996885202551649754');" onmouseout="out('6996885202551649754');" style=""><abbr title=" 746     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAddition, ProcessContext&lt;CartOperationRequest&gt; context, List&lt;ActivityMessageDTO&gt; orderMessages) throws WorkflowException {"> 746     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int curreðŸ”µ</abbr></span>
<span class="8934449600530371968" onmouseenter="enter('8934449600530371968');" onmouseout="out('8934449600530371968');" style=""> 747         if (CollectionUtils.isNotEmpty(orderItemRequestDTO.getChildOrderItems())) {                      </span>
<span class="2491660913208132768" onmouseenter="enter('2491660913208132768');" onmouseout="out('2491660913208132768');" style=""> 748             Long parentOrderItemId = context.getSeedData().getOrderItem().getId();                       </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 749             for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {          </span>
<span class="3535307469424733623" onmouseenter="enter('3535307469424733623');" onmouseout="out('3535307469424733623');" style=""> 750                 childRequest.setParentOrderItemId(parentOrderItemId);                                    </span>
<span class="-1408015228336766113" onmouseenter="enter('-1408015228336766113');" onmouseout="out('-1408015228336766113');" style=""> 751                 currentAddition++;                                                                       </span>
<span  style=""> 752                                                                                                          </span>
<span class="-8953231422270651058" onmouseenter="enter('-8953231422270651058');" onmouseout="out('-8953231422270651058');" style=""> 753                 if (childRequest.getQuantity() &gt; 0) {                                                    </span>
<span class="1978205204114939470" onmouseenter="enter('1978205204114939470');" onmouseout="out('1978205204114939470');" style=""><abbr title=" 754                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrder(), childRequest, currentAddition == numAdditionRequests);"> 754                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedDatðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 755                     Session session = em.unwrap(Session.class);                                          </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 756                     FlushMode current = session.getHibernateFlushMode();                                 </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 757                     if (!autoFlushAddToCart) {                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 758                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 758                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 759                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 759                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 760                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 761                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762                     }                                                                                    </span>
<span class="174091692271706246" onmouseenter="enter('174091692271706246');" onmouseout="out('174091692271706246');" style=""> 763                     ProcessContext&lt;CartOperationRequest&gt; childContext;                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 764                     try {                                                                                </span>
<span class="3858921168069452982" onmouseenter="enter('3858921168069452982');" onmouseout="out('3858921168069452982');" style=""><abbr title=" 765                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCartOpRequest);"> 765                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivitieðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 766                     } finally {                                                                          </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 767                         if (!autoFlushAddToCart) {                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 768                             session.setHibernateFlushMode(current);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 770                     }                                                                                    </span>
<span class="4342049387377288099" onmouseenter="enter('4342049387377288099');" onmouseout="out('4342049387377288099');" style=""> 771                     orderMessages.addAll(((ActivityMessages) childContext).getActivityMessages());       </span>
<span  style=""> 772                                                                                                          </span>
<span class="5649628204352445838" onmouseenter="enter('5649628204352445838');" onmouseout="out('5649628204352445838');" style=""><abbr title=" 773                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages);"> 773                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777     }                                                                                                    </span>
<span  style=""> 778                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 779     @Override                                                                                            </span>
<span class="-7880503742615035959" onmouseenter="enter('-7880503742615035959');" onmouseout="out('-7880503742615035959');" style=""><abbr title=" 780     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrderItem) {"> 780     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO depðŸ”µ</abbr></span>
<span class="7029662020876668277" onmouseenter="enter('7029662020876668277');" onmouseout="out('7029662020876668277');" style=""> 781         parentOrderItemRequest.getChildOrderItems().add(dependentOrderItem);                             </span>
<span class="-5858860779658693712" onmouseenter="enter('-5858860779658693712');" onmouseout="out('-5858860779658693712');" style=""><abbr title=" 782         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;() {"> 782         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 783             @Override                                                                                    </span>
<span class="-2632323703231374544" onmouseenter="enter('-2632323703231374544');" onmouseout="out('-2632323703231374544');" style=""> 784             public int compare(OrderItemRequestDTO o1, OrderItemRequestDTO o2) {                         </span>
<span class="-7086966684703257080" onmouseenter="enter('-7086966684703257080');" onmouseout="out('-7086966684703257080');" style=""><abbr title=" 785                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 785                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="2876551709679172033" onmouseenter="enter('2876551709679172033');" onmouseout="out('2876551709679172033');" style=""><abbr title=" 786                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 786                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="-3284317440061231656" onmouseenter="enter('-3284317440061231656');" onmouseout="out('-3284317440061231656');" style=""> 787                 return o1DisplayOrder.compareTo(o2DisplayOrder);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 788             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 789         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 790     }                                                                                                    </span>
<span  style=""> 791                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 792     @Override                                                                                            </span>
<span class="-2531899947398484803" onmouseenter="enter('-2531899947398484803');" onmouseout="out('-2531899947398484803');" style=""><abbr title=" 793     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartException.class})"> 793     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCaðŸ”µ</abbr></span>
<span class="5266336311751039225" onmouseenter="enter('5266336311751039225');" onmouseout="out('5266336311751039225');" style=""><abbr title=" 794     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException, RemoveFromCartException {"> 794     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 795         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 796         preValidateCartOperation(order);                                                                 </span>
<span class="8786950828376343914" onmouseenter="enter('8786950828376343914');" onmouseout="out('8786950828376343914');" style=""> 797         preValidateUpdateQuantityOperation(findOrderById(orderId), orderItemRequestDTO);                 </span>
<span class="-2982195349177348585" onmouseenter="enter('-2982195349177348585');" onmouseout="out('-2982195349177348585');" style=""> 798         if (orderItemRequestDTO.getQuantity() == 0) {                                                    </span>
<span class="5934987267424355703" onmouseenter="enter('5934987267424355703');" onmouseout="out('5934987267424355703');" style=""> 799             return removeItem(orderId, orderItemRequestDTO.getOrderItemId(), priceOrder);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 800         }                                                                                                </span>
<span  style=""> 801                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 802         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 803             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 803             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 804             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 805             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 806             if (!autoFlushUpdateCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 807                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 807                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 808                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 808                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 809                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 810                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 812             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 813             try {                                                                                        </span>
<span class="4428072604906913766" onmouseenter="enter('4428072604906913766');" onmouseout="out('4428072604906913766');" style=""><abbr title=" 814                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpRequest);"> 814                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpReðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 815             } finally {                                                                                  </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 816                 if (!autoFlushUpdateCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 817                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819             }                                                                                            </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 820             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 820             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 821             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 822         } catch (WorkflowException e) {                                                                  </span>
<span class="-2443073899933101644" onmouseenter="enter('-2443073899933101644');" onmouseout="out('-2443073899933101644');" style=""><abbr title=" 823             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e));"> 823             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825     }                                                                                                    </span>
<span  style=""> 826                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 827     @Override                                                                                            </span>
<span class="3069128547561385261" onmouseenter="enter('3069128547561385261');" onmouseout="out('3069128547561385261');" style=""> 828     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {RemoveFromCartException.class})        </span>
<span class="-981474137904562454" onmouseenter="enter('-981474137904562454');" onmouseout="out('-981474137904562454');" style=""><abbr title=" 829     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartException {"> 829     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartExceðŸ”µ</abbr></span>
<span class="2236102352074340212" onmouseenter="enter('2236102352074340212');" onmouseout="out('2236102352074340212');" style=""> 830         preValidateCartOperation(findOrderById(orderId));                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 831         try {                                                                                            </span>
<span class="-4288344051642570030" onmouseenter="enter('-4288344051642570030');" onmouseout="out('-4288344051642570030');" style=""> 832             OrderItem oi = orderItemService.readOrderItemById(orderItemId);                              </span>
<span class="-5187230272054076771" onmouseenter="enter('-5187230272054076771');" onmouseout="out('-5187230272054076771');" style=""> 833             if (oi == null) {                                                                            </span>
<span class="3942058861960606340" onmouseenter="enter('3942058861960606340');" onmouseout="out('3942058861960606340');" style=""> 834                 throw new WorkflowException(new ItemNotFoundException());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835             }                                                                                            </span>
<span class="3816340933425228129" onmouseenter="enter('3816340933425228129');" onmouseout="out('3816340933425228129');" style=""> 836             List&lt;Long&gt; childrenToRemove = new ArrayList&lt;Long&gt;();                                         </span>
<span class="-1993098536099392813" onmouseenter="enter('-1993098536099392813');" onmouseout="out('-1993098536099392813');" style=""> 837             if (oi instanceof BundleOrderItem) {                                                         </span>
<span class="7271984761308517823" onmouseenter="enter('7271984761308517823');" onmouseout="out('7271984761308517823');" style=""> 838                 List&lt;DiscreteOrderItem&gt; bundledItems = ((BundleOrderItem) oi).getDiscreteOrderItems();   </span>
<span class="7517044148543156187" onmouseenter="enter('7517044148543156187');" onmouseout="out('7517044148543156187');" style=""> 839                 for (DiscreteOrderItem doi : bundledItems) {                                             </span>
<span class="7367293631145453975" onmouseenter="enter('7367293631145453975');" onmouseout="out('7367293631145453975');" style=""> 840                     findAllChildrenToRemove(childrenToRemove, doi);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 841                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 842             } else {                                                                                     </span>
<span class="872231159337938033" onmouseenter="enter('872231159337938033');" onmouseout="out('872231159337938033');" style=""> 843                 findAllChildrenToRemove(childrenToRemove, oi);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844             }                                                                                            </span>
<span class="-8102792542621025713" onmouseenter="enter('-8102792542621025713');" onmouseout="out('-8102792542621025713');" style=""> 845             for (Long childToRemove : childrenToRemove) {                                                </span>
<span class="8117841110711526180" onmouseenter="enter('8117841110711526180');" onmouseout="out('8117841110711526180');" style=""> 846                 removeItemInternal(orderId, childToRemove, false);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847             }                                                                                            </span>
<span  style=""> 848                                                                                                          </span>
<span class="-2688850311015489500" onmouseenter="enter('-2688850311015489500');" onmouseout="out('-2688850311015489500');" style=""> 849             return removeItemInternal(orderId, orderItemId, priceOrder);                                 </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 850         } catch (WorkflowException e) {                                                                  </span>
<span class="2503031575434857017" onmouseenter="enter('2503031575434857017');" onmouseout="out('2503031575434857017');" style=""><abbr title=" 851             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e));"> 851             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 852         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853     }                                                                                                    </span>
<span  style=""> 854                                                                                                          </span>
<span class="-7053318232843416816" onmouseenter="enter('-7053318232843416816');" onmouseout="out('-7053318232843416816');" style=""> 855     protected void findAllChildrenToRemove(List&lt;Long&gt; childrenToRemove, OrderItem orderItem){            </span>
<span class="-8605703698739650954" onmouseenter="enter('-8605703698739650954');" onmouseout="out('-8605703698739650954');" style=""> 856         if (CollectionUtils.isNotEmpty(orderItem.getChildOrderItems())) {                                </span>
<span class="-4353610703709163867" onmouseenter="enter('-4353610703709163867');" onmouseout="out('-4353610703709163867');" style=""> 857             for (OrderItem childOrderItem : orderItem.getChildOrderItems()) {                            </span>
<span class="-6344861684690798964" onmouseenter="enter('-6344861684690798964');" onmouseout="out('-6344861684690798964');" style=""> 858                 findAllChildrenToRemove(childrenToRemove, childOrderItem);                               </span>
<span class="-4081734193801812324" onmouseenter="enter('-4081734193801812324');" onmouseout="out('-4081734193801812324');" style=""> 859                 childrenToRemove.add(childOrderItem.getId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 862     }                                                                                                    </span>
<span  style=""> 863                                                                                                          </span>
<span class="-9213800711467029414" onmouseenter="enter('-9213800711467029414');" onmouseout="out('-9213800711467029414');" style=""><abbr title=" 864     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowException {"> 864     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkfloðŸ”µ</abbr></span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 865         OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                             </span>
<span class="279907255180715291" onmouseenter="enter('279907255180715291');" onmouseout="out('279907255180715291');" style=""> 866         orderItemRequestDTO.setOrderItemId(orderItemId);                                                 </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 867         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 867         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemReðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 868         Session session = em.unwrap(Session.class);                                                      </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 869         FlushMode current = session.getHibernateFlushMode();                                             </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 870         if (!autoFlushRemoveFromCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 871             //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 871             //Performance measure. Hibernate will sometimes perform an autoflush when performing query opðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 872             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 872             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 873             //incorrect results because something has not been flushed to the database yet.              </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 874             session.setHibernateFlushMode(FlushMode.MANUAL);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875         }                                                                                                </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 876         ProcessContext&lt;CartOperationRequest&gt; context;                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 877         try {                                                                                            </span>
<span class="1281982438499352462" onmouseenter="enter('1281982438499352462');" onmouseout="out('1281982438499352462');" style=""><abbr title=" 878             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequest);"> 878             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequesðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 879         } finally {                                                                                      </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 880             if (!autoFlushRemoveFromCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 881                 session.setHibernateFlushMode(current);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883         }                                                                                                </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 884         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 884         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActiviðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 885         return context.getSeedData().getOrder();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 886     }                                                                                                    </span>
<span  style=""> 887                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 888     @Override                                                                                            </span>
<span class="4101768281683729634" onmouseenter="enter('4101768281683729634');" onmouseout="out('4101768281683729634');" style=""> 889     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { RemoveFromCartException.class })      </span>
<span class="-3452873837479924235" onmouseenter="enter('-3452873837479924235');" onmouseout="out('-3452873837479924235');" style=""> 890     public Order removeInactiveItems(Long orderId, boolean priceOrder) throws RemoveFromCartException {  </span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 891         Order order = findOrderById(orderId);                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 892         try {                                                                                            </span>
<span  style=""> 893                                                                                                          </span>
<span class="-3956255490326849696" onmouseenter="enter('-3956255490326849696');" onmouseout="out('-3956255490326849696');" style=""> 894             for (OrderItem currentItem : new ArrayList&lt;OrderItem&gt;(order.getOrderItems())) {              </span>
<span class="-219225588148279740" onmouseenter="enter('-219225588148279740');" onmouseout="out('-219225588148279740');" style=""> 895                 if (!currentItem.isSkuActive()) {                                                        </span>
<span class="-2073025095864158325" onmouseenter="enter('-2073025095864158325');" onmouseout="out('-2073025095864158325');" style=""> 896                     removeItem(orderId, currentItem.getId(), priceOrder);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898             }                                                                                            </span>
<span  style=""> 899                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 900         } catch (Exception e) {                                                                          </span>
<span class="9087614266041334113" onmouseenter="enter('9087614266041334113');" onmouseout="out('9087614266041334113');" style=""> 901             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, e.getCause());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 902         }                                                                                                </span>
<span class="6784501458837890045" onmouseenter="enter('6784501458837890045');" onmouseout="out('6784501458837890045');" style=""> 903         return findOrderById(orderId);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 904     }                                                                                                    </span>
<span  style=""> 905                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 906     @Override                                                                                            </span>
<span class="-2286265725818600106" onmouseenter="enter('-2286265725818600106');" onmouseout="out('-2286265725818600106');" style=""> 907     public boolean getAutomaticallyMergeLikeItems() {                                                    </span>
<span  style=""> 908                                                                                                          </span>
<span class="-8256644627815125391" onmouseenter="enter('-8256644627815125391');" onmouseout="out('-8256644627815125391');" style=""> 909         if (automaticallyMergeLikeItems != null) {                                                       </span>
<span class="2771319092236636517" onmouseenter="enter('2771319092236636517');" onmouseout="out('2771319092236636517');" style=""> 910             return automaticallyMergeLikeItems;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911         }                                                                                                </span>
<span  style=""> 912                                                                                                          </span>
<span class="-661470022029899741" onmouseenter="enter('-661470022029899741');" onmouseout="out('-661470022029899741');" style=""> 913         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;automatically.merge.like.items&quot;, true);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 914     }                                                                                                    </span>
<span  style=""> 915                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 916     @Override                                                                                            </span>
<span class="8909461220693294113" onmouseenter="enter('8909461220693294113');" onmouseout="out('8909461220693294113');" style=""> 917     public void setAutomaticallyMergeLikeItems(boolean automaticallyMergeLikeItems) {                    </span>
<span class="5376880332914447533" onmouseenter="enter('5376880332914447533');" onmouseout="out('5376880332914447533');" style=""> 918         this.automaticallyMergeLikeItems = automaticallyMergeLikeItems;                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 919     }                                                                                                    </span>
<span  style=""> 920                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 921     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 922     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 922     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="3855774874983732975" onmouseenter="enter('3855774874983732975');" onmouseout="out('3855774874983732975');" style=""> 923     public boolean isMoveNamedOrderItems() {                                                             </span>
<span class="-6652636869592443054" onmouseenter="enter('-6652636869592443054');" onmouseout="out('-6652636869592443054');" style=""> 924         return moveNamedOrderItems;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925     }                                                                                                    </span>
<span  style=""> 926                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 927     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 928     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 928     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="-1545993285048257021" onmouseenter="enter('-1545993285048257021');" onmouseout="out('-1545993285048257021');" style=""> 929     public void setMoveNamedOrderItems(boolean moveNamedOrderItems) {                                    </span>
<span class="-5896321919466635220" onmouseenter="enter('-5896321919466635220');" onmouseout="out('-5896321919466635220');" style=""> 930         this.moveNamedOrderItems = moveNamedOrderItems;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 933     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 934     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 934     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="-1003289588467041676" onmouseenter="enter('-1003289588467041676');" onmouseout="out('-1003289588467041676');" style=""> 935     public boolean isDeleteEmptyNamedOrders() {                                                          </span>
<span class="-7878461261897242645" onmouseenter="enter('-7878461261897242645');" onmouseout="out('-7878461261897242645');" style=""> 936         return deleteEmptyNamedOrders;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 937     }                                                                                                    </span>
<span  style=""> 938                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 939     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 940     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-137537618393378808" onmouseenter="enter('-137537618393378808');" onmouseout="out('-137537618393378808');" style=""> 941     public void removeAllPaymentsFromOrder(Order order) {                                                </span>
<span class="3869583275658522189" onmouseenter="enter('3869583275658522189');" onmouseout="out('3869583275658522189');" style=""> 942         removePaymentsFromOrder(order, null);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 943     }                                                                                                    </span>
<span  style=""> 944                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 945     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 946     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1085850343810485193" onmouseenter="enter('-1085850343810485193');" onmouseout="out('-1085850343810485193');" style=""> 947     public void removePaymentsFromOrder(Order order, PaymentType paymentInfoType) {                      </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 948         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 949         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-6057897724905909333" onmouseenter="enter('-6057897724905909333');" onmouseout="out('-6057897724905909333');" style=""> 950             if (paymentInfoType == null || paymentInfoType.equals(paymentInfo.getType())) {              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 951                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 953         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 954         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 955         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 956             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 957                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 957                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 958             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 959                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 960                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 962             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 963             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 964             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 965         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 966     }                                                                                                    </span>
<span  style=""> 967                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 968     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 969     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-609061517129084855" onmouseenter="enter('-609061517129084855');" onmouseout="out('-609061517129084855');" style=""> 970     public void removeCreditCardPaymentsFromOrder(Order order) {                                         </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 971         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 972         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-8966393542166440080" onmouseenter="enter('-8966393542166440080');" onmouseout="out('-8966393542166440080');" style=""> 973             if (paymentInfo.getType().isCreditCardType()) {                                              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 974                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 976         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 977         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 978         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 979             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 980                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 980                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 981             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 982                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 983                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 985             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 986             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 987             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 988         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 989     }                                                                                                    </span>
<span  style=""> 990                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 991     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 992     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="5110157232144308056" onmouseenter="enter('5110157232144308056');" onmouseout="out('5110157232144308056');" style=""> 993     public void removePaymentFromOrder(Order order, OrderPayment payment){                               </span>
<span class="-7148196279117480431" onmouseenter="enter('-7148196279117480431');" onmouseout="out('-7148196279117480431');" style=""> 994         OrderPayment paymentToRemove = null;                                                             </span>
<span class="-5892743526096946795" onmouseenter="enter('-5892743526096946795');" onmouseout="out('-5892743526096946795');" style=""> 995         for (OrderPayment info : order.getPayments()){                                                   </span>
<span class="-230615801168440856" onmouseenter="enter('-230615801168440856');" onmouseout="out('-230615801168440856');" style=""> 996             if (info.equals(payment)){                                                                   </span>
<span class="2491921736483213892" onmouseenter="enter('2491921736483213892');" onmouseout="out('2491921736483213892');" style=""> 997                 paymentToRemove = info;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 998             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 999         }                                                                                                </span>
<span class="-1581714824919605857" onmouseenter="enter('-1581714824919605857');" onmouseout="out('-1581714824919605857');" style="">1000         if (paymentToRemove != null){                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1001             try {                                                                                        </span>
<span class="1303373247725909249" onmouseenter="enter('1303373247725909249');" onmouseout="out('1303373247725909249');" style=""><abbr title="1002                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), payment.getType());">1002                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumbeðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1003             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style="">1004                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style="">1005                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1006             }                                                                                            </span>
<span class="5021028513790341802" onmouseenter="enter('5021028513790341802');" onmouseout="out('5021028513790341802');" style="">1007             order.getPayments().remove(paymentToRemove);                                                 </span>
<span class="-7249333565068001633" onmouseenter="enter('-7249333565068001633');" onmouseout="out('-7249333565068001633');" style="">1008             payment = paymentDao.readPaymentById(paymentToRemove.getId());                               </span>
<span class="-5369248081625730935" onmouseenter="enter('-5369248081625730935');" onmouseout="out('-5369248081625730935');" style="">1009             paymentDao.delete(payment);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1010         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1011     }                                                                                                    </span>
<span  style="">1012                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1013     /**                                                                                                  </span>
<span class="6936875034092858122" onmouseenter="enter('6936875034092858122');" onmouseout="out('6936875034092858122');" style="">1014      * This method will return the exception that is immediately below the deepest                       </span>
<span class="8325554843978875883" onmouseenter="enter('8325554843978875883');" onmouseout="out('8325554843978875883');" style="">1015      * WorkflowException in the current stack trace.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1016      *                                                                                                   </span>
<span class="914602110034133584" onmouseenter="enter('914602110034133584');" onmouseout="out('914602110034133584');" style="">1017      * @param e the workflow exception that contains the requested root cause                            </span>
<span class="-825884884099351167" onmouseenter="enter('-825884884099351167');" onmouseout="out('-825884884099351167');" style="">1018      * @return the root cause of the workflow exception                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1019      */                                                                                                  </span>
<span class="-6688244297454300494" onmouseenter="enter('-6688244297454300494');" onmouseout="out('-6688244297454300494');" style="">1020     protected Throwable getCartOperationExceptionRootCause(WorkflowException e) {                        </span>
<span class="-6915919722100840508" onmouseenter="enter('-6915919722100840508');" onmouseout="out('-6915919722100840508');" style="">1021         Throwable cause = e.getCause();                                                                  </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style="">1022         if (cause == null) {                                                                             </span>
<span class="2254950224932520865" onmouseenter="enter('2254950224932520865');" onmouseout="out('2254950224932520865');" style="">1023             return e;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1024         }                                                                                                </span>
<span  style="">1025                                                                                                          </span>
<span class="2363873739200211359" onmouseenter="enter('2363873739200211359');" onmouseout="out('2363873739200211359');" style="">1026         Throwable currentCause = cause;                                                                  </span>
<span class="-3242506506853415284" onmouseenter="enter('-3242506506853415284');" onmouseout="out('-3242506506853415284');" style="">1027         while (currentCause.getCause() != null) {                                                        </span>
<span class="6579708771118863579" onmouseenter="enter('6579708771118863579');" onmouseout="out('6579708771118863579');" style="">1028             currentCause = currentCause.getCause();                                                      </span>
<span class="8991829102747430232" onmouseenter="enter('8991829102747430232');" onmouseout="out('8991829102747430232');" style="">1029             if (currentCause instanceof WorkflowException) {                                             </span>
<span class="-8175986703099391257" onmouseenter="enter('-8175986703099391257');" onmouseout="out('-8175986703099391257');" style="">1030                 cause = currentCause.getCause();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032         }                                                                                                </span>
<span  style="">1033                                                                                                          </span>
<span class="-8291476910521993484" onmouseenter="enter('-8291476910521993484');" onmouseout="out('-8291476910521993484');" style="">1034         return cause;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035     }                                                                                                    </span>
<span  style="">1036                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1037     /**                                                                                                  </span>
<span class="-4869107995961353955" onmouseenter="enter('-4869107995961353955');" onmouseout="out('-4869107995961353955');" style="">1038      * Returns true if the two items attributes exactly match.                                           </span>
<span class="-7080712594711412450" onmouseenter="enter('-7080712594711412450');" onmouseout="out('-7080712594711412450');" style="">1039      * @param item1Attributes                                                                            </span>
<span class="-6439056940940666101" onmouseenter="enter('-6439056940940666101');" onmouseout="out('-6439056940940666101');" style="">1040      * @param item2                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">1041      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1042      */                                                                                                  </span>
<span class="6199969656370324246" onmouseenter="enter('6199969656370324246');" onmouseout="out('6199969656370324246');" style=""><abbr title="1043     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2) {">1043     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestðŸ”µ</abbr></span>
<span class="-4121399301000725365" onmouseenter="enter('-4121399301000725365');" onmouseout="out('-4121399301000725365');" style="">1044         int item1AttributeSize = item1Attributes == null ? 0 : item1Attributes.size();                   </span>
<span class="-4841456796483769583" onmouseenter="enter('-4841456796483769583');" onmouseout="out('-4841456796483769583');" style=""><abbr title="1045         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size();">1045         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size()ðŸ”µ</abbr></span>
<span  style="">1046                                                                                                          </span>
<span class="-6976046912644474969" onmouseenter="enter('-6976046912644474969');" onmouseout="out('-6976046912644474969');" style="">1047         if (item1AttributeSize != item2AttributeSize) {                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1048             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1049         }                                                                                                </span>
<span  style="">1050                                                                                                          </span>
<span class="8660828604942896283" onmouseenter="enter('8660828604942896283');" onmouseout="out('8660828604942896283');" style="">1051         for (String key : item2.getItemAttributes().keySet()) {                                          </span>
<span class="-7527106708479866057" onmouseenter="enter('-7527106708479866057');" onmouseout="out('-7527106708479866057');" style=""><abbr title="1052             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).getValue();">1052             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).geðŸ”µ</abbr></span>
<span class="-8945816914747285664" onmouseenter="enter('-8945816914747285664');" onmouseout="out('-8945816914747285664');" style="">1053             String itemTwoValue = item2.getItemAttributes().get(key);                                    </span>
<span class="2348135482578686472" onmouseenter="enter('2348135482578686472');" onmouseout="out('2348135482578686472');" style="">1054             if (!itemTwoValue.equals(itemOneValue)) {                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1055                 return false;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1056             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1057         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1058         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1059     }                                                                                                    </span>
<span  style="">1060                                                                                                          </span>
<span class="-4141718569550096543" onmouseenter="enter('-4141718569550096543');" onmouseout="out('-4141718569550096543');" style=""><abbr title="1061     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1Attributes,">1061     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; iteðŸ”µ</abbr></span>
<span class="-3703517832068399666" onmouseenter="enter('-3703517832068399666');" onmouseout="out('-3703517832068399666');" style="">1062             OrderItemRequestDTO item2) {                                                                 </span>
<span class="-4525614051490920688" onmouseenter="enter('-4525614051490920688');" onmouseout="out('-4525614051490920688');" style="">1063         // Must match on SKU and options                                                                 </span>
<span class="4681926242181597732" onmouseenter="enter('4681926242181597732');" onmouseout="out('4681926242181597732');" style="">1064         if (item1Sku != null &amp;&amp; item2.getSkuId() != null) {                                              </span>
<span class="4828879456607690268" onmouseenter="enter('4828879456607690268');" onmouseout="out('4828879456607690268');" style="">1065             if (item1Sku.getId().equals(item2.getSkuId())) {                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1066                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1068         } else {                                                                                         </span>
<span class="-3562715489663556008" onmouseenter="enter('-3562715489663556008');" onmouseout="out('-3562715489663556008');" style="">1069             if (item1Product != null &amp;&amp; item2.getProductId() != null) {                                  </span>
<span class="-6090611743723364470" onmouseenter="enter('-6090611743723364470');" onmouseout="out('-6090611743723364470');" style="">1070                 if (item1Product.getId().equals(item2.getProductId())) {                                 </span>
<span class="-3558352998309083894" onmouseenter="enter('-3558352998309083894');" onmouseout="out('-3558352998309083894');" style="">1071                     return compareAttributes(item1Attributes, item2);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1072                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1073             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1074         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1075         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1076     }                                                                                                    </span>
<span  style="">1077                                                                                                          </span>
<span class="-7114483559120409995" onmouseenter="enter('-7114483559120409995');" onmouseout="out('-7114483559120409995');" style="">1078     protected OrderItem findMatchingItem(Order order, OrderItemRequestDTO itemToFind) {                  </span>
<span class="-5687874155783563532" onmouseenter="enter('-5687874155783563532');" onmouseout="out('-5687874155783563532');" style="">1079         if (order == null) {                                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1080             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1081         }                                                                                                </span>
<span class="4435196443097834597" onmouseenter="enter('4435196443097834597');" onmouseout="out('4435196443097834597');" style="">1082         for (OrderItem currentItem : order.getOrderItems()) {                                            </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style="">1083             if (currentItem instanceof DiscreteOrderItem) {                                              </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style="">1084                 DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                        </span>
<span class="-4911141910965303230" onmouseenter="enter('-4911141910965303230');" onmouseout="out('-4911141910965303230');" style=""><abbr title="1085                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttributes(),">1085                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItðŸ”µ</abbr></span>
<span class="-1179319244482714398" onmouseenter="enter('-1179319244482714398');" onmouseout="out('-1179319244482714398');" style="">1086                         itemToFind)) {                                                                   </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style="">1087                     return discreteItem;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1088                 }                                                                                        </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style="">1089             } else if (currentItem instanceof BundleOrderItem) {                                         </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style="">1090                 BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                              </span>
<span class="-7934111527767872247" onmouseenter="enter('-7934111527767872247');" onmouseout="out('-7934111527767872247');" style="">1091                 if (itemMatches(bundleItem.getSku(), bundleItem.getProduct(), null, itemToFind)) {       </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style="">1092                     return bundleItem;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1093                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1094             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1095         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1096         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1097     }                                                                                                    </span>
<span  style="">1098                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1099     @Override                                                                                            </span>
<span class="-5844561583982380564" onmouseenter="enter('-5844561583982380564');" onmouseout="out('-5844561583982380564');" style="">1100     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { UpdateCartException.class })          </span>
<span class="586625526125468318" onmouseenter="enter('586625526125468318');" onmouseout="out('586625526125468318');" style=""><abbr title="1101     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException {">1101     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1102         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title="1103             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);">1103             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-8587304739270495732" onmouseenter="enter('-8587304739270495732');" onmouseout="out('-8587304739270495732');" style=""><abbr title="1104             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptionsForItemWorkflow.doActivities(cartOpRequest);">1104             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updatePðŸ”µ</abbr></span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title="1105             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());">1105             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style="">1106             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1107         } catch (WorkflowException e) {                                                                  </span>
<span class="1106241423190966760" onmouseenter="enter('1106241423190966760');" onmouseout="out('1106241423190966760');" style=""><abbr title="1108             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCause(e));">1108             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCauseðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1109         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1110     }                                                                                                    </span>
<span  style="">1111                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1112     @Override                                                                                            </span>
<span class="1062217594650773028" onmouseenter="enter('1062217594650773028');" onmouseout="out('1062217594650773028');" style="">1113     public Order reloadOrder(Order order) {                                                              </span>
<span class="-4055446979990348221" onmouseenter="enter('-4055446979990348221');" onmouseout="out('-4055446979990348221');" style="">1114         if (order == null || order instanceof NullOrderImpl || order.getId() == null) {                  </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style="">1115             return order;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1116         }                                                                                                </span>
<span  style="">1117                                                                                                          </span>
<span class="4601321525892022542" onmouseenter="enter('4601321525892022542');" onmouseout="out('4601321525892022542');" style="">1118         return orderDao.readOrderById(order.getId(), true);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1119     }                                                                                                    </span>
<span  style="">1120                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1121     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="">1122     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-7012224974908680421" onmouseenter="enter('-7012224974908680421');" onmouseout="out('-7012224974908680421');" style="">1123     public boolean acquireLock(Order order) {                                                            </span>
<span class="1335946416444527614" onmouseenter="enter('1335946416444527614');" onmouseout="out('1335946416444527614');" style="">1124         return orderDao.acquireLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1125     }                                                                                                    </span>
<span  style="">1126                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1127     @Override                                                                                            </span>
<span class="3603110228114188705" onmouseenter="enter('3603110228114188705');" onmouseout="out('3603110228114188705');" style="">1128     public boolean releaseLock(Order order) {                                                            </span>
<span class="1014135102090455120" onmouseenter="enter('1014135102090455120');" onmouseout="out('1014135102090455120');" style="">1129         return orderDao.releaseLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1130     }                                                                                                    </span>
<span  style="">1131                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1132     @Override                                                                                            </span>
<span class="-3640157100751954071" onmouseenter="enter('-3640157100751954071');" onmouseout="out('-3640157100751954071');" style="">1133     public void printOrder(Order order, Log log) {                                                       </span>
<span class="-3796071981400661878" onmouseenter="enter('-3796071981400661878');" onmouseout="out('-3796071981400661878');" style="">1134         if (!log.isDebugEnabled()) {                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1135             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1136         }                                                                                                </span>
<span  style="">1137                                                                                                          </span>
<span class="3667140805233255262" onmouseenter="enter('3667140805233255262');" onmouseout="out('3667140805233255262');" style="">1138         TableCreator tc = new TableCreator(new TableCreator.Col[] {                                      </span>
<span class="7681839206706458847" onmouseenter="enter('7681839206706458847');" onmouseout="out('7681839206706458847');" style="">1139             new TableCreator.Col(&quot;Order Item&quot;, 30),                                                      </span>
<span class="2598617298230317857" onmouseenter="enter('2598617298230317857');" onmouseout="out('2598617298230317857');" style="">1140             new TableCreator.Col(&quot;Qty&quot;),                                                                 </span>
<span class="-7694790865023700533" onmouseenter="enter('-7694790865023700533');" onmouseout="out('-7694790865023700533');" style="">1141             new TableCreator.Col(&quot;Unit Price&quot;),                                                          </span>
<span class="-4029215824508924196" onmouseenter="enter('-4029215824508924196');" onmouseout="out('-4029215824508924196');" style="">1142             new TableCreator.Col(&quot;Avg Adj&quot;),                                                             </span>
<span class="2280319324156256259" onmouseenter="enter('2280319324156256259');" onmouseout="out('2280319324156256259');" style="">1143             new TableCreator.Col(&quot;Total Adj&quot;),                                                           </span>
<span class="803984851040328531" onmouseenter="enter('803984851040328531');" onmouseout="out('803984851040328531');" style="">1144             new TableCreator.Col(&quot;Total Price&quot;)                                                          </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1145         });                                                                                              </span>
<span  style="">1146                                                                                                          </span>
<span class="8447029191885982498" onmouseenter="enter('8447029191885982498');" onmouseout="out('8447029191885982498');" style="">1147         for (OrderItem oi : order.getOrderItems()) {                                                     </span>
<span class="7794599779896353168" onmouseenter="enter('7794599779896353168');" onmouseout="out('7794599779896353168');" style="">1148             tc.addRow(new String[] {                                                                     </span>
<span class="-6517557825202851987" onmouseenter="enter('-6517557825202851987');" onmouseout="out('-6517557825202851987');" style="">1149                 oi.getName(),                                                                            </span>
<span class="-5588620079629414973" onmouseenter="enter('-5588620079629414973');" onmouseout="out('-5588620079629414973');" style="">1150                 String.valueOf(oi.getQuantity()),                                                        </span>
<span class="8023041970437622541" onmouseenter="enter('8023041970437622541');" onmouseout="out('8023041970437622541');" style="">1151                 String.valueOf(oi.getPriceBeforeAdjustments(true)),                                      </span>
<span class="4981794139639039914" onmouseenter="enter('4981794139639039914');" onmouseout="out('4981794139639039914');" style="">1152                 String.valueOf(oi.getAverageAdjustmentValue()),                                          </span>
<span class="-7621609530264461687" onmouseenter="enter('-7621609530264461687');" onmouseout="out('-7621609530264461687');" style="">1153                 String.valueOf(oi.getTotalAdjustmentValue()),                                            </span>
<span class="610268575597889106" onmouseenter="enter('610268575597889106');" onmouseout="out('610268575597889106');" style="">1154                 String.valueOf(oi.getTotalPrice())                                                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1155             });                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1156         }                                                                                                </span>
<span  style="">1157                                                                                                          </span>
<span class="-3387660244080770577" onmouseenter="enter('-3387660244080770577');" onmouseout="out('-3387660244080770577');" style="">1158         tc.addSeparator()                                                                                </span>
<span class="-4962129920853993876" onmouseenter="enter('-4962129920853993876');" onmouseout="out('-4962129920853993876');" style="">1159             .withGlobalRowHeaderWidth(15)                                                                </span>
<span class="8977950677164210482" onmouseenter="enter('8977950677164210482');" onmouseout="out('8977950677164210482');" style="">1160             .addRow(&quot;Subtotal&quot;, order.getSubTotal())                                                     </span>
<span class="9039771477815737150" onmouseenter="enter('9039771477815737150');" onmouseout="out('9039771477815737150');" style="">1161             .addRow(&quot;Order Adj.&quot;, order.getOrderAdjustmentsValue())                                      </span>
<span class="-3982350454387940822" onmouseenter="enter('-3982350454387940822');" onmouseout="out('-3982350454387940822');" style="">1162             .addRow(&quot;Tax&quot;, order.getTotalTax())                                                          </span>
<span class="-1569816593472627301" onmouseenter="enter('-1569816593472627301');" onmouseout="out('-1569816593472627301');" style="">1163             .addRow(&quot;Shipping&quot;, order.getTotalShipping())                                                </span>
<span class="-2587440008499047447" onmouseenter="enter('-2587440008499047447');" onmouseout="out('-2587440008499047447');" style="">1164             .addRow(&quot;Total&quot;, order.getTotal())                                                           </span>
<span class="-7531230309631143371" onmouseenter="enter('-7531230309631143371');" onmouseout="out('-7531230309631143371');" style="">1165             .addSeparator();                                                                             </span>
<span  style="">1166                                                                                                          </span>
<span class="5532863706287091360" onmouseenter="enter('5532863706287091360');" onmouseout="out('5532863706287091360');" style="">1167         log.debug(tc.toString());                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1168     }                                                                                                    </span>
<span  style="">1169                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1170     @Override                                                                                            </span>
<span class="-6821589912139190758" onmouseenter="enter('-6821589912139190758');" onmouseout="out('-6821589912139190758');" style="">1171     public void preValidateCartOperation(Order cart) {                                                   </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1172         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-2298593102036867448" onmouseenter="enter('-2298593102036867448');" onmouseout="out('-2298593102036867448');" style="">1173         extensionManager.getProxy().preValidateCartOperation(cart, erh);                                 </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1174         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1175             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1176         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1177             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1178         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1179     }                                                                                                    </span>
<span  style="">1180                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1181     @Override                                                                                            </span>
<span class="6673450650333126736" onmouseenter="enter('6673450650333126736');" onmouseout="out('6673450650333126736');" style="">1182     public void preValidateUpdateQuantityOperation(Order cart, OrderItemRequestDTO dto) {                </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1183         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-1253981422185917754" onmouseenter="enter('-1253981422185917754');" onmouseout="out('-1253981422185917754');" style="">1184         extensionManager.getProxy().preValidateUpdateQuantityOperation(cart, dto, erh);                  </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1185         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1186             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1187         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1188             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1189         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1190     }                                                                                                    </span>
<span  style="">1191                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1192     @Override                                                                                            </span>
<span class="7073850063066733207" onmouseenter="enter('7073850063066733207');" onmouseout="out('7073850063066733207');" style="">1193     public void refresh(Order order) {                                                                   </span>
<span class="4383314386154345120" onmouseenter="enter('4383314386154345120');" onmouseout="out('4383314386154345120');" style="">1194         orderDao.refresh(order);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1195     }                                                                                                    </span>
<span  style="">1196                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1197     @Override                                                                                            </span>
<span class="1062745462356892667" onmouseenter="enter('1062745462356892667');" onmouseout="out('1062745462356892667');" style="">1198     public Order findCartForCustomerWithEnhancements(Customer customer) {                                </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1199         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="8097724414319335156" onmouseenter="enter('8097724414319335156');" onmouseout="out('8097724414319335156');" style=""><abbr title="1200         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, erh);">1200         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1201         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1202             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1203         }                                                                                                </span>
<span class="-7896162153865126169" onmouseenter="enter('-7896162153865126169');" onmouseout="out('-7896162153865126169');" style="">1204         return findCartForCustomer(customer);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1205     }                                                                                                    </span>
<span  style="">1206                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1207     @Override                                                                                            </span>
<span class="3369501079555878000" onmouseenter="enter('3369501079555878000');" onmouseout="out('3369501079555878000');" style="">1208     public Order findCartForCustomerWithEnhancements(Customer customer, Order candidateOrder) {          </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1209         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="935633576463333972" onmouseenter="enter('935633576463333972');" onmouseout="out('935633576463333972');" style=""><abbr title="1210         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, candidateOrder, erh);">1210         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1211         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1212             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213         }                                                                                                </span>
<span class="5654562705123023026" onmouseenter="enter('5654562705123023026');" onmouseout="out('5654562705123023026');" style="">1214         return candidateOrder;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215     }                                                                                                    </span>
<span  style="">1216                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1217     @Override                                                                                            </span>
<span class="7870513728701775364" onmouseenter="enter('7870513728701775364');" onmouseout="out('7870513728701775364');" style="">1218     public List&lt;Order&gt; findOrdersByEmail(String email) {                                                 </span>
<span class="-6244770976468678027" onmouseenter="enter('-6244770976468678027');" onmouseout="out('-6244770976468678027');" style="">1219         return orderDao.readOrdersByEmail(email);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220     }                                                                                                    </span>
<span  style="">1221                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1222     @Override                                                                                            </span>
<span class="1732562485956607688" onmouseenter="enter('1732562485956607688');" onmouseout="out('1732562485956607688');" style="">1223     public List&lt;Order&gt; readBatchOrders(int start, int pageSize, List&lt;OrderStatus&gt; orderStatusList) {     </span>
<span class="-4564878267596583277" onmouseenter="enter('-4564878267596583277');" onmouseout="out('-4564878267596583277');" style="">1224         return orderDao.readBatchOrders(start, pageSize, orderStatusList);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1225     }                                                                                                    </span>
<span  style="">1226                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1227     @Override                                                                                            </span>
<span class="-7199170496986096208" onmouseenter="enter('-7199170496986096208');" onmouseout="out('-7199170496986096208');" style="">1228 	public Long readNumberOfOrders() {                                                                      </span>
<span class="4444270982432861777" onmouseenter="enter('4444270982432861777');" onmouseout="out('4444270982432861777');" style="">1229     		return orderDao.readNumberOfOrders();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1230     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1231 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2522844188166543739" onmouseenter="enter('2522844188166543739');" onmouseout="out('2522844188166543739');" style="">  18 package org.broadleafcommerce.core.order.service;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  21 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  22 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  24 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="7974202605197813097" onmouseenter="enter('7974202605197813097');" onmouseout="out('7974202605197813097');" style="">  25 import org.broadleafcommerce.common.payment.PaymentType;                                                 </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  26 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="7029131086618023959" onmouseenter="enter('7029131086618023959');" onmouseout="out('7029131086618023959');" style="">  27 import org.broadleafcommerce.common.util.TableCreator;                                                   </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  28 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="4803307284880744779" onmouseenter="enter('4803307284880744779');" onmouseout="out('4803307284880744779');" style="">  29 import org.broadleafcommerce.common.util.TypedPredicate;                                                 </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  30 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  31 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  32 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  33 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  34 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="1521662235446319191" onmouseenter="enter('1521662235446319191');" onmouseout="out('1521662235446319191');" style="">  35 import org.broadleafcommerce.core.offer.domain.OfferCode;                                                </span>
<span class="263797997925672445" onmouseenter="enter('263797997925672445');" onmouseout="out('263797997925672445');" style="">  36 import org.broadleafcommerce.core.offer.service.OfferService;                                            </span>
<span class="8148915287428556311" onmouseenter="enter('8148915287428556311');" onmouseout="out('8148915287428556311');" style="">  37 import org.broadleafcommerce.core.offer.service.OfferServiceExtensionManager;                            </span>
<span class="-2264825748950997481" onmouseenter="enter('-2264825748950997481');" onmouseout="out('-2264825748950997481');" style="">  38 import org.broadleafcommerce.core.offer.service.exception.OfferAlreadyAddedException;                    </span>
<span class="6280580908510581954" onmouseenter="enter('6280580908510581954');" onmouseout="out('6280580908510581954');" style="">  39 import org.broadleafcommerce.core.offer.service.exception.OfferException;                                </span>
<span class="7718612833831637853" onmouseenter="enter('7718612833831637853');" onmouseout="out('7718612833831637853');" style="">  40 import org.broadleafcommerce.core.offer.service.exception.OfferExpiredException;                         </span>
<span class="2542407303560298775" onmouseenter="enter('2542407303560298775');" onmouseout="out('2542407303560298775');" style="">  41 import org.broadleafcommerce.core.offer.service.exception.OfferMaxUseExceededException;                  </span>
<span class="7365998840944773425" onmouseenter="enter('7365998840944773425');" onmouseout="out('7365998840944773425');" style="">  42 import org.broadleafcommerce.core.order.dao.OrderDao;                                                    </span>
<span class="-8431629490392379230" onmouseenter="enter('-8431629490392379230');" onmouseout="out('-8431629490392379230');" style="">  43 import org.broadleafcommerce.core.order.domain.BundleOrderItem;                                          </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  44 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="4607558792631823600" onmouseenter="enter('4607558792631823600');" onmouseout="out('4607558792631823600');" style="">  45 import org.broadleafcommerce.core.order.domain.GiftWrapOrderItem;                                        </span>
<span class="3195477135256206744" onmouseenter="enter('3195477135256206744');" onmouseout="out('3195477135256206744');" style="">  46 import org.broadleafcommerce.core.order.domain.NullOrderFactory;                                         </span>
<span class="6568352354414313904" onmouseenter="enter('6568352354414313904');" onmouseout="out('6568352354414313904');" style="">  47 import org.broadleafcommerce.core.order.domain.NullOrderImpl;                                            </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  48 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  49 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  50 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="-4972689095474256973" onmouseenter="enter('-4972689095474256973');" onmouseout="out('-4972689095474256973');" style="">  51 import org.broadleafcommerce.core.order.service.call.ActivityMessageDTO;                                 </span>
<span class="-7160318188857079464" onmouseenter="enter('-7160318188857079464');" onmouseout="out('-7160318188857079464');" style="">  52 import org.broadleafcommerce.core.order.service.call.GiftWrapOrderItemRequest;                           </span>
<span class="-1901438765224473349" onmouseenter="enter('-1901438765224473349');" onmouseout="out('-1901438765224473349');" style="">  53 import org.broadleafcommerce.core.order.service.call.OrderItemRequestDTO;                                </span>
<span class="-3854268344786449631" onmouseenter="enter('-3854268344786449631');" onmouseout="out('-3854268344786449631');" style="">  54 import org.broadleafcommerce.core.order.service.exception.AddToCartException;                            </span>
<span class="-8548142165698551205" onmouseenter="enter('-8548142165698551205');" onmouseout="out('-8548142165698551205');" style="">  55 import org.broadleafcommerce.core.order.service.exception.IllegalCartOperationException;                 </span>
<span class="-3598721789967501677" onmouseenter="enter('-3598721789967501677');" onmouseout="out('-3598721789967501677');" style="">  56 import org.broadleafcommerce.core.order.service.exception.ItemNotFoundException;                         </span>
<span class="4692349346970735648" onmouseenter="enter('4692349346970735648');" onmouseout="out('4692349346970735648');" style="">  57 import org.broadleafcommerce.core.order.service.exception.RemoveFromCartException;                       </span>
<span class="9042395061305363095" onmouseenter="enter('9042395061305363095');" onmouseout="out('9042395061305363095');" style="">  58 import org.broadleafcommerce.core.order.service.exception.UpdateCartException;                           </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  59 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-3953683189888176126" onmouseenter="enter('-3953683189888176126');" onmouseout="out('-3953683189888176126');" style="">  60 import org.broadleafcommerce.core.order.service.workflow.CartOperationRequest;                           </span>
<span class="3604210211865098056" onmouseenter="enter('3604210211865098056');" onmouseout="out('3604210211865098056');" style="">  61 import org.broadleafcommerce.core.payment.dao.OrderPaymentDao;                                           </span>
<span class="725806334255742314" onmouseenter="enter('725806334255742314');" onmouseout="out('725806334255742314');" style="">  62 import org.broadleafcommerce.core.payment.domain.OrderPayment;                                           </span>
<span class="-5451903065912654495" onmouseenter="enter('-5451903065912654495');" onmouseout="out('-5451903065912654495');" style="">  63 import org.broadleafcommerce.core.payment.domain.secure.Referenced;                                      </span>
<span class="5702480564955886723" onmouseenter="enter('5702480564955886723');" onmouseout="out('5702480564955886723');" style="">  64 import org.broadleafcommerce.core.payment.service.SecureOrderPaymentService;                             </span>
<span class="-8638524682328332386" onmouseenter="enter('-8638524682328332386');" onmouseout="out('-8638524682328332386');" style="">  65 import org.broadleafcommerce.core.pricing.service.PricingService;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  66 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  67 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  68 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  69 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  70 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  71 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="2095059086545149108" onmouseenter="enter('2095059086545149108');" onmouseout="out('2095059086545149108');" style="">  72 import org.broadleafcommerce.profile.core.service.CustomerService;                                       </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  73 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  74 import org.hibernate.Session;                                                                            </span>
<span class="-6296437060367579882" onmouseenter="enter('-6296437060367579882');" onmouseout="out('-6296437060367579882');" style="">  75 import org.hibernate.exception.LockAcquisitionException;                                                 </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  76 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="1177291030959407810" onmouseenter="enter('1177291030959407810');" onmouseout="out('1177291030959407810');" style="">  77 import org.springframework.jmx.export.annotation.ManagedAttribute;                                       </span>
<span class="-2411378172167085657" onmouseenter="enter('-2411378172167085657');" onmouseout="out('-2411378172167085657');" style="">  78 import org.springframework.jmx.export.annotation.ManagedResource;                                        </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  79 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  80 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  81 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  82 import org.springframework.transaction.TransactionStatus;                                                </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  83 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span  style="">  84                                                                                                          </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  85 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  86 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  87 import java.util.Collections;                                                                            </span>
<span class="4561244361960433187" onmouseenter="enter('4561244361960433187');" onmouseout="out('4561244361960433187');" style="">  88 import java.util.Comparator;                                                                             </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  89 import java.util.Date;                                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  90 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  91 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  92 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  93 import java.util.Set;                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  95 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  96 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  97 import javax.persistence.PersistenceContext;                                                             </span>
<span  style="">  98                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  99 /**                                                                                                      </span>
<span class="2815697706567038739" onmouseenter="enter('2815697706567038739');" onmouseout="out('2815697706567038739');" style=""> 100  * @author apazzolini                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 101  */                                                                                                      </span>
<span class="7613295130782185909" onmouseenter="enter('7613295130782185909');" onmouseout="out('7613295130782185909');" style=""> 102 @Service(&quot;blOrderService&quot;)                                                                               </span>
<span class="5819673836649587467" onmouseenter="enter('5819673836649587467');" onmouseout="out('5819673836649587467');" style=""><abbr title=" 103 @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLimit=15)"> 103 @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, curreðŸ”µ</abbr></span>
<span class="-2072417237584838241" onmouseenter="enter('-2072417237584838241');" onmouseout="out('-2072417237584838241');" style=""> 104 public class OrderServiceImpl implements OrderService {                                                  </span>
<span class="-6147601375299019476" onmouseenter="enter('-6147601375299019476');" onmouseout="out('-6147601375299019476');" style=""> 105     private static final Log LOG = LogFactory.getLog(OrderServiceImpl.class);                            </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1034856612351701575" onmouseenter="enter('-1034856612351701575');" onmouseout="out('-1034856612351701575');" style=""> 107     /* DAOs */                                                                                           </span>
<span class="4300412198824813091" onmouseenter="enter('4300412198824813091');" onmouseout="out('4300412198824813091');" style=""> 108     @Resource(name = &quot;blOrderPaymentDao&quot;)                                                                </span>
<span class="-6743991484426169368" onmouseenter="enter('-6743991484426169368');" onmouseout="out('-6743991484426169368');" style=""> 109     protected OrderPaymentDao paymentDao;                                                                </span>
<span  style=""> 110                                                                                                          </span>
<span class="-8616512229212864636" onmouseenter="enter('-8616512229212864636');" onmouseout="out('-8616512229212864636');" style=""> 111     @Resource(name = &quot;blOrderDao&quot;)                                                                       </span>
<span class="3205943113513590409" onmouseenter="enter('3205943113513590409');" onmouseout="out('3205943113513590409');" style=""> 112     protected OrderDao orderDao;                                                                         </span>
<span  style=""> 113                                                                                                          </span>
<span class="5779429748772127951" onmouseenter="enter('5779429748772127951');" onmouseout="out('5779429748772127951');" style=""> 114     @Resource(name = &quot;blOfferDao&quot;)                                                                       </span>
<span class="8858788780557179486" onmouseenter="enter('8858788780557179486');" onmouseout="out('8858788780557179486');" style=""> 115     protected OfferDao offerDao;                                                                         </span>
<span  style=""> 116                                                                                                          </span>
<span class="4027092641360680465" onmouseenter="enter('4027092641360680465');" onmouseout="out('4027092641360680465');" style=""> 117     /* Factories */                                                                                      </span>
<span class="-5967051191091567596" onmouseenter="enter('-5967051191091567596');" onmouseout="out('-5967051191091567596');" style=""> 118     @Resource(name = &quot;blNullOrderFactory&quot;)                                                               </span>
<span class="4068278867975252256" onmouseenter="enter('4068278867975252256');" onmouseout="out('4068278867975252256');" style=""> 119     protected NullOrderFactory nullOrderFactory;                                                         </span>
<span  style=""> 120                                                                                                          </span>
<span class="1042938529233933214" onmouseenter="enter('1042938529233933214');" onmouseout="out('1042938529233933214');" style=""> 121     /* Services */                                                                                       </span>
<span class="6969754559269026560" onmouseenter="enter('6969754559269026560');" onmouseout="out('6969754559269026560');" style=""> 122     @Resource(name = &quot;blCustomerService&quot;)                                                                </span>
<span class="5369585293672379772" onmouseenter="enter('5369585293672379772');" onmouseout="out('5369585293672379772');" style=""> 123     protected CustomerService customerService;                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="1740335809005650078" onmouseenter="enter('1740335809005650078');" onmouseout="out('1740335809005650078');" style=""> 125     @Resource(name = &quot;blPricingService&quot;)                                                                 </span>
<span class="-3953942945177082651" onmouseenter="enter('-3953942945177082651');" onmouseout="out('-3953942945177082651');" style=""> 126     protected PricingService pricingService;                                                             </span>
<span  style=""> 127                                                                                                          </span>
<span class="-8762117636097767442" onmouseenter="enter('-8762117636097767442');" onmouseout="out('-8762117636097767442');" style=""> 128     @Resource(name = &quot;blOrderItemService&quot;)                                                               </span>
<span class="-7939877477893967584" onmouseenter="enter('-7939877477893967584');" onmouseout="out('-7939877477893967584');" style=""> 129     protected OrderItemService orderItemService;                                                         </span>
<span  style=""> 130                                                                                                          </span>
<span class="2996711079688344376" onmouseenter="enter('2996711079688344376');" onmouseout="out('2996711079688344376');" style=""> 131     @Resource(name = &quot;blFulfillmentGroupService&quot;)                                                        </span>
<span class="-4012624862608675616" onmouseenter="enter('-4012624862608675616');" onmouseout="out('-4012624862608675616');" style=""> 132     protected FulfillmentGroupService fulfillmentGroupService;                                           </span>
<span  style=""> 133                                                                                                          </span>
<span class="401190535541877398" onmouseenter="enter('401190535541877398');" onmouseout="out('401190535541877398');" style=""> 134     @Resource(name = &quot;blOfferService&quot;)                                                                   </span>
<span class="5260453850719866461" onmouseenter="enter('5260453850719866461');" onmouseout="out('5260453850719866461');" style=""> 135     protected OfferService offerService;                                                                 </span>
<span  style=""> 136                                                                                                          </span>
<span class="-5728623657958779082" onmouseenter="enter('-5728623657958779082');" onmouseout="out('-5728623657958779082');" style=""> 137     @Resource(name = &quot;blSecureOrderPaymentService&quot;)                                                      </span>
<span class="-6581230590179767656" onmouseenter="enter('-6581230590179767656');" onmouseout="out('-6581230590179767656');" style=""> 138     protected SecureOrderPaymentService securePaymentInfoService;                                        </span>
<span  style=""> 139                                                                                                          </span>
<span class="3052322175513128984" onmouseenter="enter('3052322175513128984');" onmouseout="out('3052322175513128984');" style=""> 140     @Resource(name = &quot;blMergeCartService&quot;)                                                               </span>
<span class="8208298738953975930" onmouseenter="enter('8208298738953975930');" onmouseout="out('8208298738953975930');" style=""> 141     protected MergeCartService mergeCartService;                                                         </span>
<span  style=""> 142                                                                                                          </span>
<span class="-5141785283307634971" onmouseenter="enter('-5141785283307634971');" onmouseout="out('-5141785283307634971');" style=""> 143     @Resource(name = &quot;blOrderServiceExtensionManager&quot;)                                                   </span>
<span class="7609575163897375728" onmouseenter="enter('7609575163897375728');" onmouseout="out('7609575163897375728');" style=""> 144     protected OrderServiceExtensionManager extensionManager;                                             </span>
<span  style=""> 145                                                                                                          </span>
<span class="-2568041442687394420" onmouseenter="enter('-2568041442687394420');" onmouseout="out('-2568041442687394420');" style=""> 146     /* Workflows */                                                                                      </span>
<span class="2793266955607927868" onmouseenter="enter('2793266955607927868');" onmouseout="out('2793266955607927868');" style=""> 147     @Resource(name = &quot;blAddItemWorkflow&quot;)                                                                </span>
<span class="-7970748165831650126" onmouseenter="enter('-7970748165831650126');" onmouseout="out('-7970748165831650126');" style=""> 148     protected Processor addItemWorkflow;                                                                 </span>
<span  style=""> 149                                                                                                          </span>
<span class="6527917864594618071" onmouseenter="enter('6527917864594618071');" onmouseout="out('6527917864594618071');" style=""> 150     @Resource(name = &quot;blUpdateProductOptionsForItemWorkflow&quot;)                                            </span>
<span class="-3432528377574027794" onmouseenter="enter('-3432528377574027794');" onmouseout="out('-3432528377574027794');" style=""> 151     private Processor updateProductOptionsForItemWorkflow;                                               </span>
<span  style=""> 152                                                                                                          </span>
<span class="-8676131598314218463" onmouseenter="enter('-8676131598314218463');" onmouseout="out('-8676131598314218463');" style=""> 153     @Resource(name = &quot;blUpdateItemWorkflow&quot;)                                                             </span>
<span class="-4038034170241387616" onmouseenter="enter('-4038034170241387616');" onmouseout="out('-4038034170241387616');" style=""> 154     protected Processor updateItemWorkflow;                                                              </span>
<span  style=""> 155                                                                                                          </span>
<span class="2809816546718326729" onmouseenter="enter('2809816546718326729');" onmouseout="out('2809816546718326729');" style=""> 156     @Resource(name = &quot;blRemoveItemWorkflow&quot;)                                                             </span>
<span class="8820366819754000449" onmouseenter="enter('8820366819754000449');" onmouseout="out('8820366819754000449');" style=""> 157     protected Processor removeItemWorkflow;                                                              </span>
<span  style=""> 158                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 159     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 160     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 161                                                                                                          </span>
<span class="4647563353113875163" onmouseenter="enter('4647563353113875163');" onmouseout="out('4647563353113875163');" style=""> 162     @Value(&quot;${pricing.retry.count.for.lock.failure}&quot;)                                                    </span>
<span class="3768032238220096351" onmouseenter="enter('3768032238220096351');" onmouseout="out('3768032238220096351');" style=""> 163     protected int pricingRetryCountForLockFailure = 3;                                                   </span>
<span  style=""> 164                                                                                                          </span>
<span class="-5649780437206020465" onmouseenter="enter('-5649780437206020465');" onmouseout="out('-5649780437206020465');" style=""> 165     @Value(&quot;${pricing.retry.wait.interval.for.lock.failure}&quot;)                                            </span>
<span class="6143681610186845623" onmouseenter="enter('6143681610186845623');" onmouseout="out('6143681610186845623');" style=""> 166     protected long pricingRetryWaitIntervalForLockFailure = 500L;                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 168     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 169      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="-4084123837140279098" onmouseenter="enter('-4084123837140279098');" onmouseout="out('-4084123837140279098');" style=""><abbr title=" 170      * add-to-cart workflow. This should generally be able to be left false. This is a performance measure and"> 170      * add-to-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="531367490526902986" onmouseenter="enter('531367490526902986');" onmouseout="out('531367490526902986');" style=""> 171      * add-to-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 172      */                                                                                                  </span>
<span class="-6971248696513840261" onmouseenter="enter('-6971248696513840261');" onmouseout="out('-6971248696513840261');" style=""> 173     @Value(&quot;${auto.flush.on.query.during.add.to.cart:false}&quot;)                                            </span>
<span class="-9081510558149889178" onmouseenter="enter('-9081510558149889178');" onmouseout="out('-9081510558149889178');" style=""> 174     protected boolean autoFlushAddToCart = false;                                                        </span>
<span  style=""> 175                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 176     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 177      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5682863995593575399" onmouseenter="enter('5682863995593575399');" onmouseout="out('5682863995593575399');" style=""><abbr title=" 178      * update-cart workflow. This should generally be able to be left false. This is a performance measure and"> 178      * update-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="4015846476888264417" onmouseenter="enter('4015846476888264417');" onmouseout="out('4015846476888264417');" style=""> 179      * update-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 180      */                                                                                                  </span>
<span class="4955973510412192391" onmouseenter="enter('4955973510412192391');" onmouseout="out('4955973510412192391');" style=""> 181     @Value(&quot;${auto.flush.on.query.during.update.cart:false}&quot;)                                            </span>
<span class="-6560708755317111135" onmouseenter="enter('-6560708755317111135');" onmouseout="out('-6560708755317111135');" style=""> 182     protected boolean autoFlushUpdateCart = false;                                                       </span>
<span  style=""> 183                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 184     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 185      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5427441896991106725" onmouseenter="enter('5427441896991106725');" onmouseout="out('5427441896991106725');" style=""><abbr title=" 186      * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure and"> 186      * remove-from-cart workflow. This should generally be able to be left false. This is a performance mðŸ”µ</abbr></span>
<span class="-4648779041241212172" onmouseenter="enter('-4648779041241212172');" onmouseout="out('-4648779041241212172');" style=""> 187      * remove-from-cart operations will be more efficient when this is false.                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 188      */                                                                                                  </span>
<span class="-8172893732176017719" onmouseenter="enter('-8172893732176017719');" onmouseout="out('-8172893732176017719');" style=""> 189     @Value(&quot;${auto.flush.on.query.during.remove.from.cart:false}&quot;)                                       </span>
<span class="-3285670849425830103" onmouseenter="enter('-3285670849425830103');" onmouseout="out('-3285670849425830103');" style=""> 190     protected boolean autoFlushRemoveFromCart = false;                                                   </span>
<span  style=""> 191                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 192     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 193      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="3621392970638403989" onmouseenter="enter('3621392970638403989');" onmouseout="out('3621392970638403989');" style=""><abbr title=" 194      * order save pricing flow. This should generally be able to be left false. This is a performance measure and"> 194      * order save pricing flow. This should generally be able to be left false. This is a performance meaðŸ”µ</abbr></span>
<span class="-6789052884213414091" onmouseenter="enter('-6789052884213414091');" onmouseout="out('-6789052884213414091');" style=""> 195      * save operations will be more efficient when this is false.                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 196      */                                                                                                  </span>
<span class="-188440796641371951" onmouseenter="enter('-188440796641371951');" onmouseout="out('-188440796641371951');" style=""> 197     @Value(&quot;${auto.flush.on.query.during.cart.pricing.save:false}&quot;)                                      </span>
<span class="-7447722827185958723" onmouseenter="enter('-7447722827185958723');" onmouseout="out('-7447722827185958723');" style=""> 198     protected boolean autoFlushSaveCart = false;                                                         </span>
<span  style=""> 199                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style=""> 200     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 201     protected EntityManager em;                                                                          </span>
<span  style=""> 202                                                                                                          </span>
<span class="-6638939562421962482" onmouseenter="enter('-6638939562421962482');" onmouseout="out('-6638939562421962482');" style=""> 203     /* Fields */                                                                                         </span>
<span class="-3415856814483301136" onmouseenter="enter('-3415856814483301136');" onmouseout="out('-3415856814483301136');" style=""> 204     protected boolean moveNamedOrderItems = true;                                                        </span>
<span class="-112332225907304480" onmouseenter="enter('-112332225907304480');" onmouseout="out('-112332225907304480');" style=""> 205     protected boolean deleteEmptyNamedOrders = true;                                                     </span>
<span  style=""> 206                                                                                                          </span>
<span class="8203140173062168288" onmouseenter="enter('8203140173062168288');" onmouseout="out('8203140173062168288');" style=""> 207     protected Boolean automaticallyMergeLikeItems;                                                       </span>
<span  style=""> 208                                                                                                          </span>
<span class="2799370370843719797" onmouseenter="enter('2799370370843719797');" onmouseout="out('2799370370843719797');" style=""> 209     @Resource(name = &quot;blOrderMultishipOptionService&quot;)                                                    </span>
<span class="768036680350789739" onmouseenter="enter('768036680350789739');" onmouseout="out('768036680350789739');" style=""> 210     protected OrderMultishipOptionService orderMultishipOptionService;                                   </span>
<span  style=""> 211                                                                                                          </span>
<span class="1476595721846482438" onmouseenter="enter('1476595721846482438');" onmouseout="out('1476595721846482438');" style=""> 212     @Resource(name = &quot;blOfferServiceExtensionManager&quot;)                                                   </span>
<span class="1464017235088339416" onmouseenter="enter('1464017235088339416');" onmouseout="out('1464017235088339416');" style=""> 213     protected OfferServiceExtensionManager offerServiceExtensionManager;                                 </span>
<span  style=""> 214                                                                                                          </span>
<span  style=""> 215                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 217     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style=""> 218     public Order createNewCartForCustomer(Customer customer) {                                           </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 219 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-3250206482798517655" onmouseenter="enter('-3250206482798517655');" onmouseout="out('-3250206482798517655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220         customer = customerService.saveCustomer(customer);                                               </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 221 ||||||| BASE                                                                                             </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222         return orderDao.createNewCartForCustomer(customer);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 224 =======                                                                                                  </span>
<span class="-8527029649040543351" onmouseenter="enter('-8527029649040543351');" onmouseout="out('-8527029649040543351');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         final Object lock = Objects.isNull(customer.getId()) ? customer : customer.getId();              </span>
<span class="-4616623925289667129" onmouseenter="enter('-4616623925289667129');" onmouseout="out('-4616623925289667129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226         synchronized (lock) {                                                                            </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 227 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style=""> 228         return orderDao.createNewCartForCustomer(customer);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 232     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 233     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style=""> 234     public Order createNamedOrderForCustomer(String name, Customer customer) {                           </span>
<span class="-2409876513820161352" onmouseenter="enter('-2409876513820161352');" onmouseout="out('-2409876513820161352');" style=""> 235         Order namedOrder = orderDao.create();                                                            </span>
<span class="-4702827597577679131" onmouseenter="enter('-4702827597577679131');" onmouseout="out('-4702827597577679131');" style=""> 236         namedOrder.setCustomer(customer);                                                                </span>
<span class="-5090709722664798426" onmouseenter="enter('-5090709722664798426');" onmouseout="out('-5090709722664798426');" style=""> 237         namedOrder.setName(name);                                                                        </span>
<span class="-1603494808269519128" onmouseenter="enter('-1603494808269519128');" onmouseout="out('-1603494808269519128');" style=""> 238         namedOrder.setStatus(OrderStatus.NAMED);                                                         </span>
<span  style=""> 239                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 240         if (extensionManager != null) {                                                                  </span>
<span class="8990503012292673298" onmouseenter="enter('8990503012292673298');" onmouseout="out('8990503012292673298');" style=""> 241             extensionManager.getProxy().attachAdditionalDataToNewNamedCart(customer, namedOrder);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242         }                                                                                                </span>
<span  style=""> 243                                                                                                          </span>
<span class="6872588596382822440" onmouseenter="enter('6872588596382822440');" onmouseout="out('6872588596382822440');" style=""> 244         if (BroadleafRequestContext.getBroadleafRequestContext() != null) {                              </span>
<span class="8302259492819337972" onmouseenter="enter('8302259492819337972');" onmouseout="out('8302259492819337972');" style=""> 245             namedOrder.setLocale(BroadleafRequestContext.getBroadleafRequestContext().getLocale());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span  style=""> 247                                                                                                          </span>
<span class="-4755266802229314023" onmouseenter="enter('-4755266802229314023');" onmouseout="out('-4755266802229314023');" style=""> 248         return persist(namedOrder); // No need to price here                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249     }                                                                                                    </span>
<span  style=""> 250                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 251     @Override                                                                                            </span>
<span class="-5228222697072727023" onmouseenter="enter('-5228222697072727023');" onmouseout="out('-5228222697072727023');" style=""> 252     public Order findNamedOrderForCustomer(String name, Customer customer) {                             </span>
<span class="3593606300255125692" onmouseenter="enter('3593606300255125692');" onmouseout="out('3593606300255125692');" style=""> 253         return orderDao.readNamedOrderForCustomer(customer, name);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254     }                                                                                                    </span>
<span  style=""> 255                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 256     @Override                                                                                            </span>
<span class="-3536100433526278820" onmouseenter="enter('-3536100433526278820');" onmouseout="out('-3536100433526278820');" style=""> 257     public Order findOrderById(Long orderId) {                                                           </span>
<span class="1161210593743093685" onmouseenter="enter('1161210593743093685');" onmouseout="out('1161210593743093685');" style=""> 258         return orderDao.readOrderById(orderId);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259     }                                                                                                    </span>
<span  style=""> 260                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 261     @Override                                                                                            </span>
<span class="3514330874800299886" onmouseenter="enter('3514330874800299886');" onmouseout="out('3514330874800299886');" style=""> 262     public List&lt;Order&gt; findOrdersByIds(List&lt;Long&gt; orderIds) {                                            </span>
<span class="-3891915877440809040" onmouseenter="enter('-3891915877440809040');" onmouseout="out('-3891915877440809040');" style=""> 263         return orderDao.readOrdersByIds(orderIds);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264     }                                                                                                    </span>
<span  style=""> 265                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 266     @Override                                                                                            </span>
<span class="4729011646907808921" onmouseenter="enter('4729011646907808921');" onmouseout="out('4729011646907808921');" style=""> 267     public Order findOrderById(Long orderId, boolean refresh) {                                          </span>
<span class="-1498807655754375115" onmouseenter="enter('-1498807655754375115');" onmouseout="out('-1498807655754375115');" style=""> 268         return orderDao.readOrderById(orderId, refresh);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269     }                                                                                                    </span>
<span  style=""> 270                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 271     @Override                                                                                            </span>
<span class="6472182469411690717" onmouseenter="enter('6472182469411690717');" onmouseout="out('6472182469411690717');" style=""> 272     public Order getNullOrder() {                                                                        </span>
<span class="-9215158658227454796" onmouseenter="enter('-9215158658227454796');" onmouseout="out('-9215158658227454796');" style=""> 273         return nullOrderFactory.getNullOrder();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274     }                                                                                                    </span>
<span  style=""> 275                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 276     @Override                                                                                            </span>
<span class="-868163728006062843" onmouseenter="enter('-868163728006062843');" onmouseout="out('-868163728006062843');" style=""> 277     public Order findCartForCustomer(Customer customer) {                                                </span>
<span class="8766840141038390904" onmouseenter="enter('8766840141038390904');" onmouseout="out('8766840141038390904');" style=""> 278         return orderDao.readCartForCustomer(customer);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279     }                                                                                                    </span>
<span  style=""> 280                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 281     @Override                                                                                            </span>
<span class="-7652784715167872669" onmouseenter="enter('-7652784715167872669');" onmouseout="out('-7652784715167872669');" style=""> 282     public List&lt;Order&gt; findOrdersForCustomer(Customer customer) {                                        </span>
<span class="-1451410109320389957" onmouseenter="enter('-1451410109320389957');" onmouseout="out('-1451410109320389957');" style=""> 283         return orderDao.readOrdersForCustomer(customer.getId());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284     }                                                                                                    </span>
<span  style=""> 285                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 286     @Override                                                                                            </span>
<span class="-1874817631753699552" onmouseenter="enter('-1874817631753699552');" onmouseout="out('-1874817631753699552');" style=""> 287     public List&lt;Order&gt; findOrdersForCustomer(Customer customer, OrderStatus status) {                    </span>
<span class="8303115895394445841" onmouseenter="enter('8303115895394445841');" onmouseout="out('8303115895394445841');" style=""> 288         return orderDao.readOrdersForCustomer(customer, status);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span  style=""> 290                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 291     @Override                                                                                            </span>
<span class="-5868034956931005765" onmouseenter="enter('-5868034956931005765');" onmouseout="out('-5868034956931005765');" style=""> 292     public Order findOrderByOrderNumber(String orderNumber) {                                            </span>
<span class="4126063111294586184" onmouseenter="enter('4126063111294586184');" onmouseout="out('4126063111294586184');" style=""> 293         return orderDao.readOrderByOrderNumber(orderNumber);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294     }                                                                                                    </span>
<span  style=""> 295                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 296     @Override                                                                                            </span>
<span class="4191009625455802778" onmouseenter="enter('4191009625455802778');" onmouseout="out('4191009625455802778');" style=""> 297     public List&lt;Order&gt; findOrdersByDateRange(Date startDate, Date endDate) {                             </span>
<span class="4159366983783237003" onmouseenter="enter('4159366983783237003');" onmouseout="out('4159366983783237003');" style=""> 298         return orderDao.readOrdersByDateRange(startDate, endDate);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299     }                                                                                                    </span>
<span  style=""> 300                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 301     @Override                                                                                            </span>
<span class="-5094637214545511446" onmouseenter="enter('-5094637214545511446');" onmouseout="out('-5094637214545511446');" style=""> 302     public List&lt;Order&gt; findOrdersByDaysCount(Integer daysCount, Integer batchSize) {                     </span>
<span class="-5623433853176777156" onmouseenter="enter('-5623433853176777156');" onmouseout="out('-5623433853176777156');" style=""> 303         return orderDao.readOrdersOlderThanDaysCount(daysCount, batchSize);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304     }                                                                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 306     @Override                                                                                            </span>
<span class="7584459338142486264" onmouseenter="enter('7584459338142486264');" onmouseout="out('7584459338142486264');" style=""><abbr title=" 307     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endDate) {"> 307     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endðŸ”µ</abbr></span>
<span class="-7476578265182813965" onmouseenter="enter('-7476578265182813965');" onmouseout="out('-7476578265182813965');" style=""> 308         return orderDao.readOrdersForCustomersInDateRange(customerIds, startDate, endDate);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309     }                                                                                                    </span>
<span  style=""> 310                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 311     @Override                                                                                            </span>
<span class="2742799531036946157" onmouseenter="enter('2742799531036946157');" onmouseout="out('2742799531036946157');" style=""> 312     public List&lt;OrderPayment&gt; findPaymentsForOrder(Order order) {                                        </span>
<span class="-8492719680919611182" onmouseenter="enter('-8492719680919611182');" onmouseout="out('-8492719680919611182');" style=""> 313         return paymentDao.readPaymentsForOrder(order);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314     }                                                                                                    </span>
<span  style=""> 315                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 316     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 317     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-3332960922797777344" onmouseenter="enter('-3332960922797777344');" onmouseout="out('-3332960922797777344');" style=""><abbr title=" 318     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfo) {"> 318     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfoðŸ”µ</abbr></span>
<span class="5531588484946379356" onmouseenter="enter('5531588484946379356');" onmouseout="out('5531588484946379356');" style=""> 319         payment.setOrder(order);                                                                         </span>
<span class="-5902578581570361338" onmouseenter="enter('-5902578581570361338');" onmouseout="out('-5902578581570361338');" style=""> 320         order.getPayments().add(payment);                                                                </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 321         order = persist(order);                                                                          </span>
<span class="3102030919604467575" onmouseenter="enter('3102030919604467575');" onmouseout="out('3102030919604467575');" style=""> 322         int paymentIndex = order.getPayments().size() - 1;                                               </span>
<span  style=""> 323                                                                                                          </span>
<span class="-1059731582497422542" onmouseenter="enter('-1059731582497422542');" onmouseout="out('-1059731582497422542');" style=""> 324         if (securePaymentInfo != null) {                                                                 </span>
<span class="-3146705087638884484" onmouseenter="enter('-3146705087638884484');" onmouseout="out('-3146705087638884484');" style=""> 325             securePaymentInfoService.save(securePaymentInfo);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326         }                                                                                                </span>
<span  style=""> 327                                                                                                          </span>
<span class="-7441301587762344543" onmouseenter="enter('-7441301587762344543');" onmouseout="out('-7441301587762344543');" style=""> 328         return order.getPayments().get(paymentIndex);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329     }                                                                                                    </span>
<span  style=""> 330                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 331     @Override                                                                                            </span>
<span class="-6260636294738378695" onmouseenter="enter('-6260636294738378695');" onmouseout="out('-6260636294738378695');" style=""> 332     public Order save(Order order, boolean priceOrder, boolean repriceItems) throws PricingException {   </span>
<span class="-861950305740674202" onmouseenter="enter('-861950305740674202');" onmouseout="out('-861950305740674202');" style=""> 333         if (repriceItems) {                                                                              </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 334             order.updatePrices();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335         }                                                                                                </span>
<span class="7466161317523035871" onmouseenter="enter('7466161317523035871');" onmouseout="out('7466161317523035871');" style=""> 336         return save(order, priceOrder);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337     }                                                                                                    </span>
<span  style=""> 338                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 339     @Override                                                                                            </span>
<span class="3492049941937307387" onmouseenter="enter('3492049941937307387');" onmouseout="out('3492049941937307387');" style=""> 340     public Order save(Order order, Boolean priceOrder) throws PricingException {                         </span>
<span class="-7596987583027747839" onmouseenter="enter('-7596987583027747839');" onmouseout="out('-7596987583027747839');" style=""> 341         //persist the order first                                                                        </span>
<span class="-389595421943223582" onmouseenter="enter('-389595421943223582');" onmouseout="out('-389595421943223582');" style=""> 342         TransactionStatus status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                       </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 343                     TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 344         try {                                                                                            </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 345             order = persist(order);                                                                      </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 346             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 347         } catch (RuntimeException ex) {                                                                  </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 348             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 349             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350         }                                                                                                </span>
<span  style=""> 351                                                                                                          </span>
<span class="3415408115507489273" onmouseenter="enter('3415408115507489273');" onmouseout="out('3415408115507489273');" style=""> 352         //make any pricing changes - possibly retrying with the persisted state if there&#x27;s a lock failure</span>
<span class="3259489568218221951" onmouseenter="enter('3259489568218221951');" onmouseout="out('3259489568218221951');" style=""> 353         if (priceOrder) {                                                                                </span>
<span class="1922471648485581677" onmouseenter="enter('1922471648485581677');" onmouseout="out('1922471648485581677');" style=""> 354             int retryCount = 0;                                                                          </span>
<span class="-3964676588024243488" onmouseenter="enter('-3964676588024243488');" onmouseout="out('-3964676588024243488');" style=""> 355             boolean isValid = false;                                                                     </span>
<span class="-6184322868026722475" onmouseenter="enter('-6184322868026722475');" onmouseout="out('-6184322868026722475');" style=""> 356             while (!isValid) {                                                                           </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 357                 Session session = em.unwrap(Session.class);                                              </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 358                 FlushMode current = session.getHibernateFlushMode();                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 359                 try {                                                                                    </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 360                     if (!autoFlushSaveCart) {                                                            </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 361                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 361                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 362                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 362                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 363                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 364                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365                     }                                                                                    </span>
<span class="8892823389652271355" onmouseenter="enter('8892823389652271355');" onmouseout="out('8892823389652271355');" style=""> 366                     order = pricingService.executePricing(order);                                        </span>
<span class="9041443712359372060" onmouseenter="enter('9041443712359372060');" onmouseout="out('9041443712359372060');" style=""> 367                     isValid = true;                                                                      </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 368                 } catch (Exception ex) {                                                                 </span>
<span class="-2271119485062807010" onmouseenter="enter('-2271119485062807010');" onmouseout="out('-2271119485062807010');" style=""> 369                     boolean isValidCause = false;                                                        </span>
<span class="-500838144782668299" onmouseenter="enter('-500838144782668299');" onmouseout="out('-500838144782668299');" style=""> 370                     Throwable cause = ex;                                                                </span>
<span class="1460063134918401876" onmouseenter="enter('1460063134918401876');" onmouseout="out('1460063134918401876');" style=""> 371                     while (!isValidCause) {                                                              </span>
<span class="4260495870590788788" onmouseenter="enter('4260495870590788788');" onmouseout="out('4260495870590788788');" style=""> 372                         if (cause.getClass().equals(LockAcquisitionException.class)) {                   </span>
<span class="-2629587088788625810" onmouseenter="enter('-2629587088788625810');" onmouseout="out('-2629587088788625810');" style=""> 373                             isValidCause = true;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374                         }                                                                                </span>
<span class="8625050852301041214" onmouseenter="enter('8625050852301041214');" onmouseout="out('8625050852301041214');" style=""> 375                         cause = cause.getCause();                                                        </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style=""> 376                         if (cause == null) {                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 377                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379                     }                                                                                    </span>
<span class="617128514241385440" onmouseenter="enter('617128514241385440');" onmouseout="out('617128514241385440');" style=""> 380                     if (isValidCause) {                                                                  </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 381                         if (LOG.isInfoEnabled()) {                                                       </span>
<span class="-1515480896436827747" onmouseenter="enter('-1515480896436827747');" onmouseout="out('-1515480896436827747');" style=""><abbr title=" 382                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price again.&quot;);"> 382                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price agðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383                         }                                                                                </span>
<span class="-5133746822051192612" onmouseenter="enter('-5133746822051192612');" onmouseout="out('-5133746822051192612');" style=""> 384                         isValid = false;                                                                 </span>
<span class="4577651777641283233" onmouseenter="enter('4577651777641283233');" onmouseout="out('4577651777641283233');" style=""> 385                         if (retryCount &gt;= pricingRetryCountForLockFailure) {                             </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 386                             if (LOG.isInfoEnabled()) {                                                   </span>
<span class="8668513794109504150" onmouseenter="enter('8668513794109504150');" onmouseout="out('8668513794109504150');" style=""><abbr title=" 387                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; + retryCount + &quot;). Throwing exception.&quot;);"> 387                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceedeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388                             }                                                                            </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 389                             if (ex instanceof PricingException) {                                        </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 390                                 throw (PricingException) ex;                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391                             } else {                                                                     </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 392                                 throw new PricingException(ex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 394                         } else {                                                                         </span>
<span class="-1359453246670658998" onmouseenter="enter('-1359453246670658998');" onmouseout="out('-1359453246670658998');" style=""> 395                             order = findOrderById(order.getId());                                        </span>
<span class="1564014130404929121" onmouseenter="enter('1564014130404929121');" onmouseout="out('1564014130404929121');" style=""> 396                             retryCount++;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 398                         try {                                                                            </span>
<span class="-1188508433081841324" onmouseenter="enter('-1188508433081841324');" onmouseout="out('-1188508433081841324');" style=""> 399                             Thread.sleep(pricingRetryWaitIntervalForLockFailure);                        </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style=""> 400                         } catch (Throwable e) {                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 401                             //do nothing                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402                         }                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 403                     } else {                                                                             </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 404                         if (ex instanceof PricingException) {                                            </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 405                             throw (PricingException) ex;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 406                         } else {                                                                         </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 407                             throw new PricingException(ex);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409                     }                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 410                 } finally {                                                                              </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 411                     if (!autoFlushSaveCart) {                                                            </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 412                         session.setHibernateFlushMode(current);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415             }                                                                                            </span>
<span  style=""> 416                                                                                                          </span>
<span class="-3104014921676861204" onmouseenter="enter('-3104014921676861204');" onmouseout="out('-3104014921676861204');" style=""> 417             //make the final save of the priced order                                                    </span>
<span class="-5185576183489418340" onmouseenter="enter('-5185576183489418340');" onmouseout="out('-5185576183489418340');" style=""> 418             status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                     </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 419                                 TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);         </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 420             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 421             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 422             try {                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 423                 if (!autoFlushSaveCart) {                                                                </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 424                     //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 424                     //Performance measure. Hibernate will sometimes perform an autoflush when performing ðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 425                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 425                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 426                     //incorrect results because something has not been flushed to the database yet.      </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 427                     session.setHibernateFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428                 }                                                                                        </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 429                 order = persist(order);                                                                  </span>
<span  style=""> 430                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 431                 if (extensionManager != null) {                                                          </span>
<span class="3957126338116198589" onmouseenter="enter('3957126338116198589');" onmouseout="out('3957126338116198589');" style=""> 432                     extensionManager.getProxy().attachAdditionalDataToOrder(order, priceOrder);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 433                 }                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 434                 if (!autoFlushSaveCart) {                                                                </span>
<span class="-582956567966567765" onmouseenter="enter('-582956567966567765');" onmouseout="out('-582956567966567765');" style=""> 435                     session.setFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436                 }                                                                                        </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 437                 TransactionUtils.finalizeTransaction(status, transactionManager, false);                 </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 438             } catch (RuntimeException ex) {                                                              </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 439                 TransactionUtils.finalizeTransaction(status, transactionManager, true);                  </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 440                 throw ex;                                                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 441             } finally {                                                                                  </span>
<span class="8320148466827839591" onmouseenter="enter('8320148466827839591');" onmouseout="out('8320148466827839591');" style=""> 442                 if (!autoFlushSaveCart &amp;&amp; !session.getFlushMode().equals(current)) {                     </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 443                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446         }                                                                                                </span>
<span  style=""> 447                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 448         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449     }                                                                                                    </span>
<span  style=""> 450                                                                                                          </span>
<span class="3548225205011979861" onmouseenter="enter('3548225205011979861');" onmouseout="out('3548225205011979861');" style=""> 451     // This method exists to provide OrderService methods the ability to save an order                   </span>
<span class="-3137042620959847201" onmouseenter="enter('-3137042620959847201');" onmouseout="out('-3137042620959847201');" style=""> 452     // without having to worry about a PricingException being thrown.                                    </span>
<span class="-8294379095766791864" onmouseenter="enter('-8294379095766791864');" onmouseout="out('-8294379095766791864');" style=""> 453     protected Order persist(Order order) {                                                               </span>
<span class="8818772614490614908" onmouseenter="enter('8818772614490614908');" onmouseout="out('8818772614490614908');" style=""> 454         return orderDao.save(order);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455     }                                                                                                    </span>
<span  style=""> 456                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 457     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 458     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="1194611983531410278" onmouseenter="enter('1194611983531410278');" onmouseout="out('1194611983531410278');" style=""> 459     public void cancelOrder(Order order) {                                                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 460         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461     }                                                                                                    </span>
<span  style=""> 462                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 463     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 464     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="3151062967360623973" onmouseenter="enter('3151062967360623973');" onmouseout="out('3151062967360623973');" style=""> 465     public void deleteOrder(Order order) {                                                               </span>
<span class="362561214599706117" onmouseenter="enter('362561214599706117');" onmouseout="out('362561214599706117');" style=""> 466         orderMultishipOptionService.deleteAllOrderMultishipOptions(order);                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 467         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468     }                                                                                                    </span>
<span  style=""> 469                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 470     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 471     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6908985997151819220" onmouseenter="enter('-6908985997151819220');" onmouseout="out('-6908985997151819220');" style=""><abbr title=" 472     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferException {"> 472     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceptiðŸ”µ</abbr></span>
<span class="-6957816096303048614" onmouseenter="enter('-6957816096303048614');" onmouseout="out('-6957816096303048614');" style=""> 473         ArrayList&lt;OfferCode&gt; offerCodes = new ArrayList&lt;OfferCode&gt;();                                    </span>
<span class="-3489605780287301859" onmouseenter="enter('-3489605780287301859');" onmouseout="out('-3489605780287301859');" style=""> 474         offerCodes.add(offerCode);                                                                       </span>
<span class="5360942362216082169" onmouseenter="enter('5360942362216082169');" onmouseout="out('5360942362216082169');" style=""> 475         return addOfferCodes(order, offerCodes, priceOrder);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476     }                                                                                                    </span>
<span  style=""> 477                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 478     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 479     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6002760974922308486" onmouseenter="enter('-6002760974922308486');" onmouseout="out('-6002760974922308486');" style=""><abbr title=" 480     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingException, OfferException {"> 480     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricinðŸ”µ</abbr></span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 481         preValidateCartOperation(order);                                                                 </span>
<span class="-6297044254079066685" onmouseenter="enter('-6297044254079066685');" onmouseout="out('-6297044254079066685');" style=""> 482         Set&lt;Offer&gt; addedOffers = offerService.getUniqueOffersFromOrder(order);                           </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 483         if (extensionManager != null) {                                                                  </span>
<span class="4843221393928633011" onmouseenter="enter('4843221393928633011');" onmouseout="out('4843221393928633011');" style=""> 484             extensionManager.getProxy().addOfferCodes(order, offerCodes, priceOrder);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span class="-5013116012900958115" onmouseenter="enter('-5013116012900958115');" onmouseout="out('-5013116012900958115');" style=""> 486         if (offerCodes != null &amp;&amp; !offerCodes.isEmpty()) {                                               </span>
<span class="8649045155270180220" onmouseenter="enter('8649045155270180220');" onmouseout="out('8649045155270180220');" style=""> 487             for (OfferCode offerCode : offerCodes) {                                                     </span>
<span  style=""> 488                                                                                                          </span>
<span class="-7298696073195110538" onmouseenter="enter('-7298696073195110538');" onmouseout="out('-7298696073195110538');" style=""><abbr title=" 489                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) {"> 489                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOðŸ”µ</abbr></span>
<span class="6234350320401768221" onmouseenter="enter('6234350320401768221');" onmouseout="out('6234350320401768221');" style=""> 490                     throw new OfferAlreadyAddedException(&quot;The offer has already been added.&quot;);           </span>
<span class="-3830868071340909057" onmouseenter="enter('-3830868071340909057');" onmouseout="out('-3830868071340909057');" style=""> 491                 } else if (!offerService.verifyMaxCustomerUsageThreshold(order, offerCode)) {            </span>
<span class="4333070718197812940" onmouseenter="enter('4333070718197812940');" onmouseout="out('4333070718197812940');" style=""><abbr title=" 492                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maximum allowed number of times.&quot;);"> 492                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more thðŸ”µ</abbr></span>
<span class="-5924935946468451057" onmouseenter="enter('-5924935946468451057');" onmouseout="out('-5924935946468451057');" style=""> 493                 } else if (!offerCode.isActive() || !offerCode.getOffer().isActive()) {                  </span>
<span class="-5410451342198456207" onmouseenter="enter('-5410451342198456207');" onmouseout="out('-5410451342198456207');" style=""> 494                     throw new OfferExpiredException(&quot;The offer has expired.&quot;);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495                 }                                                                                        </span>
<span  style=""> 496                                                                                                          </span>
<span class="-8263838424494001377" onmouseenter="enter('-8263838424494001377');" onmouseout="out('-8263838424494001377');" style=""> 497                 order.getAddedOfferCodes().add(offerCode);                                               </span>
<span  style=""> 498                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499             }                                                                                            </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 500             order = save(order, priceOrder);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501         }                                                                                                </span>
<span  style=""> 502                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 503         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504     }                                                                                                    </span>
<span  style=""> 505                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 506     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 507     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-8165165962317769711" onmouseenter="enter('-8165165962317769711');" onmouseout="out('-8165165962317769711');" style=""><abbr title=" 508     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException {"> 508     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceðŸ”µ</abbr></span>
<span class="7292636042273352545" onmouseenter="enter('7292636042273352545');" onmouseout="out('7292636042273352545');" style=""> 509         order.getAddedOfferCodes().remove(offerCode);                                                    </span>
<span class="-7106254142148835248" onmouseenter="enter('-7106254142148835248');" onmouseout="out('-7106254142148835248');" style=""> 510         offerServiceExtensionManager.removeOfferCodeFromOrder(offerCode, order);                         </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 511         order = save(order, priceOrder);                                                                 </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 512         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513     }                                                                                                    </span>
<span  style=""> 514                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 515     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 516     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1709915701203298020" onmouseenter="enter('-1709915701203298020');" onmouseout="out('-1709915701203298020');" style=""> 517     public Order removeAllOfferCodes(Order order, boolean priceOrder) throws PricingException {          </span>
<span class="-6954607053476807171" onmouseenter="enter('-6954607053476807171');" onmouseout="out('-6954607053476807171');" style=""> 518          order.getAddedOfferCodes().clear();                                                             </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 519          order = save(order, priceOrder);                                                                </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 520          return order;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521     }                                                                                                    </span>
<span  style=""> 522                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 523     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 524     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 524     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="6605929857558449758" onmouseenter="enter('6605929857558449758');" onmouseout="out('6605929857558449758');" style=""> 525     public void setDeleteEmptyNamedOrders(boolean deleteEmptyNamedOrders) {                              </span>
<span class="-5922450764665272748" onmouseenter="enter('-5922450764665272748');" onmouseout="out('-5922450764665272748');" style=""> 526         this.deleteEmptyNamedOrders = deleteEmptyNamedOrders;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527     }                                                                                                    </span>
<span  style=""> 528                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 529     @Override                                                                                            </span>
<span class="8809427274039428572" onmouseenter="enter('8809427274039428572');" onmouseout="out('8809427274039428572');" style=""> 530     public OrderItem findLastMatchingItem(Order order, Long skuId, Long productId) {                     </span>
<span class="3897119298100986011" onmouseenter="enter('3897119298100986011');" onmouseout="out('3897119298100986011');" style=""> 531         if (order.getOrderItems() != null) {                                                             </span>
<span class="3057467599356722650" onmouseenter="enter('3057467599356722650');" onmouseout="out('3057467599356722650');" style=""> 532             for (int i=(order.getOrderItems().size()-1); i &gt;= 0; i--) {                                  </span>
<span class="-8753960614479292481" onmouseenter="enter('-8753960614479292481');" onmouseout="out('-8753960614479292481');" style=""> 533                 OrderItem currentItem = (order.getOrderItems().get(i));                                  </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style=""> 534                 if (currentItem instanceof DiscreteOrderItem) {                                          </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style=""> 535                     DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                    </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 536                     if (skuId != null) {                                                                 </span>
<span class="-8668132489177117394" onmouseenter="enter('-8668132489177117394');" onmouseout="out('-8668132489177117394');" style=""><abbr title=" 537                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId())) {"> 537                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId()))ðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 538                             return discreteItem;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539                         }                                                                                </span>
<span class="2262602886329333955" onmouseenter="enter('2262602886329333955');" onmouseout="out('2262602886329333955');" style=""><abbr title=" 540                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteItem.getProduct().getId())) {"> 540                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equalsðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 541                         return discreteItem;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                     }                                                                                    </span>
<span  style=""> 543                                                                                                          </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style=""> 544                 } else if (currentItem instanceof BundleOrderItem) {                                     </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style=""> 545                     BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                          </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 546                     if (skuId != null) {                                                                 </span>
<span class="-2960070722540544872" onmouseenter="enter('-2960070722540544872');" onmouseout="out('-2960070722540544872');" style=""> 547                         if (bundleItem.getSku() != null &amp;&amp; skuId.equals(bundleItem.getSku().getId())) {  </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 548                             return bundleItem;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549                         }                                                                                </span>
<span class="2116719638664851076" onmouseenter="enter('2116719638664851076');" onmouseout="out('2116719638664851076');" style=""><abbr title=" 550                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItem.getProduct().getId())) {"> 550                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bðŸ”µ</abbr></span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 551                         return bundleItem;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 556         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557     }                                                                                                    </span>
<span  style=""> 558                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 559     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 560     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6433964895207235713" onmouseenter="enter('-6433964895207235713');" onmouseout="out('-6433964895207235713');" style=""> 561     public Order confirmOrder(Order order) {                                                             </span>
<span class="9181791888739176058" onmouseenter="enter('9181791888739176058');" onmouseout="out('9181791888739176058');" style=""> 562         return orderDao.submitOrder(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563     }                                                                                                    </span>
<span  style=""> 564                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 565     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 566     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1196063989926378996" onmouseenter="enter('-1196063989926378996');" onmouseout="out('-1196063989926378996');" style=""><abbr title=" 567     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 567     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartExcðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 568         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 569         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 570             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571         }                                                                                                </span>
<span class="6349420761965903996" onmouseenter="enter('6349420761965903996');" onmouseout="out('6349420761965903996');" style=""> 572         List&lt;OrderItem&gt; items = new ArrayList&lt;OrderItem&gt;(namedOrder.getOrderItems());                    </span>
<span  style=""> 573                                                                                                          </span>
<span class="6607428262094447152" onmouseenter="enter('6607428262094447152');" onmouseout="out('6607428262094447152');" style=""> 574         // Remove any order items that are children                                                      </span>
<span class="7631703850134052237" onmouseenter="enter('7631703850134052237');" onmouseout="out('7631703850134052237');" style=""> 575         CollectionUtils.filter(items,  new TypedPredicate&lt;OrderItem&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 576             @Override                                                                                    </span>
<span class="4901231018495450056" onmouseenter="enter('4901231018495450056');" onmouseout="out('4901231018495450056');" style=""> 577             public boolean eval(OrderItem orderItem) {                                                   </span>
<span class="-2481948952058789921" onmouseenter="enter('-2481948952058789921');" onmouseout="out('-2481948952058789921');" style=""> 578                 return orderItem.getParentOrderItem() == null;                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 579             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 580         });                                                                                              </span>
<span class="-4844745637831365496" onmouseenter="enter('-4844745637831365496');" onmouseout="out('-4844745637831365496');" style=""> 581         for (OrderItem item : items) {                                                                   </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 582             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 582             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItemðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 583             cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                        </span>
<span  style=""> 584                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 585             if (moveNamedOrderItems) {                                                                   </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 586                 removeItem(namedOrder.getId(), item.getId(), false);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 587             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588         }                                                                                                </span>
<span  style=""> 589                                                                                                          </span>
<span class="-6527299291227137901" onmouseenter="enter('-6527299291227137901');" onmouseout="out('-6527299291227137901');" style=""> 590         if (deleteEmptyNamedOrders) {                                                                    </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 591             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592         }                                                                                                </span>
<span  style=""> 593                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 594         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595     }                                                                                                    </span>
<span  style=""> 596                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 597     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 598     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="486294103490899905" onmouseenter="enter('486294103490899905');" onmouseout="out('486294103490899905');" style=""><abbr title=" 599     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 599     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemovðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 600         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 601         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 602             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603         }                                                                                                </span>
<span  style=""> 604                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 605         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 605         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 606         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 607                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 608         if (moveNamedOrderItems) {                                                                       </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 609             removeItem(namedOrder.getId(), item.getId(), false);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610         }                                                                                                </span>
<span  style=""> 611                                                                                                          </span>
<span class="-3555431676535314681" onmouseenter="enter('-3555431676535314681');" onmouseout="out('-3555431676535314681');" style=""> 612         if (namedOrder.getOrderItems().size() == 0 &amp;&amp; deleteEmptyNamedOrders) {                          </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 613             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 614         }                                                                                                </span>
<span  style=""> 615                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 616         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 617     }                                                                                                    </span>
<span  style=""> 618                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 619     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 620     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="6073762115033780324" onmouseenter="enter('6073762115033780324');" onmouseout="out('6073762115033780324');" style=""><abbr title=" 621     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws RemoveFromCartException, AddToCartException, UpdateCartException {"> 621     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrderðŸ”µ</abbr></span>
<span class="-6164187211557222893" onmouseenter="enter('-6164187211557222893');" onmouseout="out('-6164187211557222893');" style=""> 622         // Validate that the quantity requested makes sense                                              </span>
<span class="632487064450637769" onmouseenter="enter('632487064450637769');" onmouseout="out('632487064450637769');" style=""> 623         if (quantity &lt; 1 || quantity &gt; item.getQuantity()) {                                             </span>
<span class="9015263082333587317" onmouseenter="enter('9015263082333587317');" onmouseout="out('9015263082333587317');" style=""> 624             throw new IllegalArgumentException(&quot;Cannot move 0 or less quantity&quot;);                        </span>
<span class="5237951611682684444" onmouseenter="enter('5237951611682684444');" onmouseout="out('5237951611682684444');" style=""> 625         } else if (quantity == item.getQuantity()) {                                                     </span>
<span class="-6422299663726892430" onmouseenter="enter('-6422299663726892430');" onmouseout="out('-6422299663726892430');" style=""> 626             return addItemFromNamedOrder(namedOrder, item, priceOrder);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627         }                                                                                                </span>
<span  style=""> 628                                                                                                          </span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 629         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 630         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 631             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632         }                                                                                                </span>
<span  style=""> 633                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 634         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 634         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="8127078771873751614" onmouseenter="enter('8127078771873751614');" onmouseout="out('8127078771873751614');" style=""> 635         orderItemRequest.setQuantity(quantity);                                                          </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 636         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 637                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 638         if (moveNamedOrderItems) {                                                                       </span>
<span class="-1872324351499578531" onmouseenter="enter('-1872324351499578531');" onmouseout="out('-1872324351499578531');" style=""> 639             // Update the old item to its new quantity only if we&#x27;re moving items                        </span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 640             OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                         </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 641             orderItemRequestDTO.setOrderItemId(item.getId());                                            </span>
<span class="2294188755442690225" onmouseenter="enter('2294188755442690225');" onmouseout="out('2294188755442690225');" style=""> 642             orderItemRequestDTO.setQuantity(item.getQuantity() - quantity);                              </span>
<span class="4972493477102298628" onmouseenter="enter('4972493477102298628');" onmouseout="out('4972493477102298628');" style=""> 643             updateItemQuantity(namedOrder.getId(), orderItemRequestDTO, false);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644         }                                                                                                </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 645         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646     }                                                                                                    </span>
<span  style=""> 647                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 648     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 649     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1212731706886603863" onmouseenter="enter('-1212731706886603863');" onmouseout="out('-1212731706886603863');" style=""><abbr title=" 650     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder) throws PricingException {"> 650     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean prðŸ”µ</abbr></span>
<span class="6582622510368580131" onmouseenter="enter('6582622510368580131');" onmouseout="out('6582622510368580131');" style=""> 651         GiftWrapOrderItem item = orderItemService.createGiftWrapOrderItem(itemRequest);                  </span>
<span class="-474933544378469288" onmouseenter="enter('-474933544378469288');" onmouseout="out('-474933544378469288');" style=""> 652         item.setOrder(order);                                                                            </span>
<span class="-5871784861123565961" onmouseenter="enter('-5871784861123565961');" onmouseout="out('-5871784861123565961');" style=""> 653         item = (GiftWrapOrderItem) orderItemService.saveOrderItem(item);                                 </span>
<span  style=""> 654                                                                                                          </span>
<span class="6197964192831249775" onmouseenter="enter('6197964192831249775');" onmouseout="out('6197964192831249775');" style=""> 655         order.getOrderItems().add(item);                                                                 </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 656         order = save(order, priceOrder);                                                                 </span>
<span  style=""> 657                                                                                                          </span>
<span class="-3331987500944083076" onmouseenter="enter('-3331987500944083076');" onmouseout="out('-3331987500944083076');" style=""> 658         return item;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 659     }                                                                                                    </span>
<span  style=""> 660                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 661     @Override                                                                                            </span>
<span class="684519713081169381" onmouseenter="enter('684519713081169381');" onmouseout="out('684519713081169381');" style=""> 662     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {AddToCartException.class})             </span>
<span class="4069854779845915812" onmouseenter="enter('4069854779845915812');" onmouseout="out('4069854779845915812');" style=""><abbr title=" 663     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 663     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throwðŸ”µ</abbr></span>
<span class="-1143974214922837949" onmouseenter="enter('-1143974214922837949');" onmouseout="out('-1143974214922837949');" style=""> 664         // Don&#x27;t allow overrides from this method.                                                       </span>
<span class="8194194096343660389" onmouseenter="enter('8194194096343660389');" onmouseout="out('8194194096343660389');" style=""> 665         orderItemRequestDTO.setOverrideRetailPrice(null);                                                </span>
<span class="-5206909193534990943" onmouseenter="enter('-5206909193534990943');" onmouseout="out('-5206909193534990943');" style=""> 666         orderItemRequestDTO.setOverrideSalePrice(null);                                                  </span>
<span class="-7735674882921518291" onmouseenter="enter('-7735674882921518291');" onmouseout="out('-7735674882921518291');" style=""> 667         return addItemWithPriceOverrides(orderId, orderItemRequestDTO, priceOrder);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 668     }                                                                                                    </span>
<span  style=""> 669                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 670     @Override                                                                                            </span>
<span class="-670805249178869687" onmouseenter="enter('-670805249178869687');" onmouseout="out('-670805249178869687');" style=""> 671     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { AddToCartException.class })           </span>
<span class="2295594549845892145" onmouseenter="enter('2295594549845892145');" onmouseout="out('2295594549845892145');" style=""><abbr title=" 672     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 672     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleanðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 673         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 674         preValidateCartOperation(order);                                                                 </span>
<span class="2914653273227801204" onmouseenter="enter('2914653273227801204');" onmouseout="out('2914653273227801204');" style=""> 675         if (getAutomaticallyMergeLikeItems()) {                                                          </span>
<span class="-1260995424369374686" onmouseenter="enter('-1260995424369374686');" onmouseout="out('-1260995424369374686');" style=""> 676             OrderItem item = findMatchingItem(order, orderItemRequestDTO);                               </span>
<span class="-4741837152748801640" onmouseenter="enter('-4741837152748801640');" onmouseout="out('-4741837152748801640');" style=""> 677             if (item != null &amp;&amp; item.getParentOrderItem() == null) {                                     </span>
<span class="8907881414365549792" onmouseenter="enter('8907881414365549792');" onmouseout="out('8907881414365549792');" style=""> 678                 orderItemRequestDTO.setQuantity(item.getQuantity() + orderItemRequestDTO.getQuantity()); </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 679                 orderItemRequestDTO.setOrderItemId(item.getId());                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 680                 try {                                                                                    </span>
<span class="-1392380570648359537" onmouseenter="enter('-1392380570648359537');" onmouseout="out('-1392380570648359537');" style=""> 681                     return updateItemQuantity(orderId, orderItemRequestDTO, priceOrder);                 </span>
<span class="2264439919030346254" onmouseenter="enter('2264439919030346254');" onmouseout="out('2264439919030346254');" style=""> 682                 } catch (RemoveFromCartException e) {                                                    </span>
<span class="3695461348108676960" onmouseenter="enter('3695461348108676960');" onmouseout="out('3695461348108676960');" style=""><abbr title=" 683                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cart&quot;, e);"> 683                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adðŸ”µ</abbr></span>
<span class="-268181248887409465" onmouseenter="enter('-268181248887409465');" onmouseout="out('-268181248887409465');" style=""> 684                 } catch (UpdateCartException e) {                                                        </span>
<span class="9009836242172298460" onmouseenter="enter('9009836242172298460');" onmouseout="out('9009836242172298460');" style=""> 685                     throw new AddToCartException(&quot;Could not update quantity for matched item&quot;, e);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 688         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 689         try {                                                                                            </span>
<span class="5353648265182308095" onmouseenter="enter('5353648265182308095');" onmouseout="out('5353648265182308095');" style=""><abbr title=" 690             // We only want to price on the last addition for performance reasons and only if the user asked for it."> 690             // We only want to price on the last addition for performance reasons and only if the user asðŸ”µ</abbr></span>
<span class="4429210190612929719" onmouseenter="enter('4429210190612929719');" onmouseout="out('4429210190612929719');" style=""> 691             int numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO)) : -1;  </span>
<span class="94226225238380310" onmouseenter="enter('94226225238380310');" onmouseout="out('94226225238380310');" style=""> 692             int currentAddition = 1;                                                                     </span>
<span  style=""> 693                                                                                                          </span>
<span class="3086923041990690310" onmouseenter="enter('3086923041990690310');" onmouseout="out('3086923041990690310');" style=""><abbr title=" 694             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, currentAddition == numAdditionRequests);"> 694             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span  style=""> 695                                                                                                          </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 696             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 697             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 698             if (!autoFlushAddToCart) {                                                                   </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 699                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 699                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 700                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 700                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 701                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 702                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 704             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 705             try {                                                                                        </span>
<span class="1764939006998328340" onmouseenter="enter('1764939006998328340');" onmouseout="out('1764939006998328340');" style=""><abbr title=" 706                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequest);"> 706                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequeðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 707             } finally {                                                                                  </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 708                 if (!autoFlushAddToCart) {                                                               </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 709                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 710                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711             }                                                                                            </span>
<span  style=""> 712                                                                                                          </span>
<span class="-507750410624174489" onmouseenter="enter('-507750410624174489');" onmouseout="out('-507750410624174489');" style=""> 713             List&lt;ActivityMessageDTO&gt; orderMessages = new ArrayList&lt;ActivityMessageDTO&gt;();                </span>
<span class="-9090729846937660303" onmouseenter="enter('-9090729846937660303');" onmouseout="out('-9090729846937660303');" style=""> 714             orderMessages.addAll(((ActivityMessages) context).getActivityMessages());                    </span>
<span  style=""> 715                                                                                                          </span>
<span class="7756277132938928975" onmouseenter="enter('7756277132938928975');" onmouseout="out('7756277132938928975');" style=""> 716             // Update the orderItemRequest incase it changed during the initial add to cart workflow     </span>
<span class="-7203895251723249067" onmouseenter="enter('-7203895251723249067');" onmouseout="out('-7203895251723249067');" style=""> 717             orderItemRequestDTO = context.getSeedData().getItemRequest();                                </span>
<span class="4534199544912449864" onmouseenter="enter('4534199544912449864');" onmouseout="out('4534199544912449864');" style=""> 718             numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO) - 1) : -1;  </span>
<span class="4780820064776482606" onmouseenter="enter('4780820064776482606');" onmouseout="out('4780820064776482606');" style=""><abbr title=" 719             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessages);"> 719             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessagðŸ”µ</abbr></span>
<span  style=""> 720                                                                                                          </span>
<span class="-2935463552695848258" onmouseenter="enter('-2935463552695848258');" onmouseout="out('-2935463552695848258');" style=""> 721             context.getSeedData().getOrder().setOrderMessages(orderMessages);                            </span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 722             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 723         } catch (WorkflowException e) {                                                                  </span>
<span class="-1335771490090575105" onmouseenter="enter('-1335771490090575105');" onmouseout="out('-1335771490090575105');" style=""> 724             throw new AddToCartException(&quot;Could not add to cart&quot;, getCartOperationExceptionRootCause(e));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725         }                                                                                                </span>
<span  style=""> 726                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727     }                                                                                                    </span>
<span  style=""> 728                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 729     @Override                                                                                            </span>
<span class="-3516024114449400059" onmouseenter="enter('-3516024114449400059');" onmouseout="out('-3516024114449400059');" style=""> 730     public int getTotalChildOrderItems(OrderItemRequestDTO orderItemRequestDTO) {                        </span>
<span class="-4883106140571490694" onmouseenter="enter('-4883106140571490694');" onmouseout="out('-4883106140571490694');" style=""> 731         int count = 1;                                                                                   </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 732         for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {              </span>
<span class="-8452259100874171936" onmouseenter="enter('-8452259100874171936');" onmouseout="out('-8452259100874171936');" style=""> 733             count += getTotalChildOrderItems(childRequest);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 734         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 735         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736     }                                                                                                    </span>
<span  style=""> 737                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 738     @Override                                                                                            </span>
<span class="6996885202551649754" onmouseenter="enter('6996885202551649754');" onmouseout="out('6996885202551649754');" style=""><abbr title=" 739     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAddition, ProcessContext&lt;CartOperationRequest&gt; context, List&lt;ActivityMessageDTO&gt; orderMessages) throws WorkflowException {"> 739     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int curreðŸ”µ</abbr></span>
<span class="8934449600530371968" onmouseenter="enter('8934449600530371968');" onmouseout="out('8934449600530371968');" style=""> 740         if (CollectionUtils.isNotEmpty(orderItemRequestDTO.getChildOrderItems())) {                      </span>
<span class="2491660913208132768" onmouseenter="enter('2491660913208132768');" onmouseout="out('2491660913208132768');" style=""> 741             Long parentOrderItemId = context.getSeedData().getOrderItem().getId();                       </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 742             for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {          </span>
<span class="3535307469424733623" onmouseenter="enter('3535307469424733623');" onmouseout="out('3535307469424733623');" style=""> 743                 childRequest.setParentOrderItemId(parentOrderItemId);                                    </span>
<span class="-1408015228336766113" onmouseenter="enter('-1408015228336766113');" onmouseout="out('-1408015228336766113');" style=""> 744                 currentAddition++;                                                                       </span>
<span  style=""> 745                                                                                                          </span>
<span class="-8953231422270651058" onmouseenter="enter('-8953231422270651058');" onmouseout="out('-8953231422270651058');" style=""> 746                 if (childRequest.getQuantity() &gt; 0) {                                                    </span>
<span class="1978205204114939470" onmouseenter="enter('1978205204114939470');" onmouseout="out('1978205204114939470');" style=""><abbr title=" 747                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrder(), childRequest, currentAddition == numAdditionRequests);"> 747                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedDatðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 748                     Session session = em.unwrap(Session.class);                                          </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 749                     FlushMode current = session.getHibernateFlushMode();                                 </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 750                     if (!autoFlushAddToCart) {                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 751                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 751                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 752                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 752                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 753                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 754                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755                     }                                                                                    </span>
<span class="174091692271706246" onmouseenter="enter('174091692271706246');" onmouseout="out('174091692271706246');" style=""> 756                     ProcessContext&lt;CartOperationRequest&gt; childContext;                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 757                     try {                                                                                </span>
<span class="3858921168069452982" onmouseenter="enter('3858921168069452982');" onmouseout="out('3858921168069452982');" style=""><abbr title=" 758                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCartOpRequest);"> 758                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivitieðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 759                     } finally {                                                                          </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 760                         if (!autoFlushAddToCart) {                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 761                             session.setHibernateFlushMode(current);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763                     }                                                                                    </span>
<span class="4342049387377288099" onmouseenter="enter('4342049387377288099');" onmouseout="out('4342049387377288099');" style=""> 764                     orderMessages.addAll(((ActivityMessages) childContext).getActivityMessages());       </span>
<span  style=""> 765                                                                                                          </span>
<span class="5649628204352445838" onmouseenter="enter('5649628204352445838');" onmouseout="out('5649628204352445838');" style=""><abbr title=" 766                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages);"> 766                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 768             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 770     }                                                                                                    </span>
<span  style=""> 771                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 772     @Override                                                                                            </span>
<span class="-7880503742615035959" onmouseenter="enter('-7880503742615035959');" onmouseout="out('-7880503742615035959');" style=""><abbr title=" 773     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrderItem) {"> 773     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO depðŸ”µ</abbr></span>
<span class="7029662020876668277" onmouseenter="enter('7029662020876668277');" onmouseout="out('7029662020876668277');" style=""> 774         parentOrderItemRequest.getChildOrderItems().add(dependentOrderItem);                             </span>
<span class="-5858860779658693712" onmouseenter="enter('-5858860779658693712');" onmouseout="out('-5858860779658693712');" style=""><abbr title=" 775         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;() {"> 775         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 776             @Override                                                                                    </span>
<span class="-2632323703231374544" onmouseenter="enter('-2632323703231374544');" onmouseout="out('-2632323703231374544');" style=""> 777             public int compare(OrderItemRequestDTO o1, OrderItemRequestDTO o2) {                         </span>
<span class="-7086966684703257080" onmouseenter="enter('-7086966684703257080');" onmouseout="out('-7086966684703257080');" style=""><abbr title=" 778                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 778                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="2876551709679172033" onmouseenter="enter('2876551709679172033');" onmouseout="out('2876551709679172033');" style=""><abbr title=" 779                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 779                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="-3284317440061231656" onmouseenter="enter('-3284317440061231656');" onmouseout="out('-3284317440061231656');" style=""> 780                 return o1DisplayOrder.compareTo(o2DisplayOrder);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 781             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 782         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783     }                                                                                                    </span>
<span  style=""> 784                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 785     @Override                                                                                            </span>
<span class="-2531899947398484803" onmouseenter="enter('-2531899947398484803');" onmouseout="out('-2531899947398484803');" style=""><abbr title=" 786     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartException.class})"> 786     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCaðŸ”µ</abbr></span>
<span class="5266336311751039225" onmouseenter="enter('5266336311751039225');" onmouseout="out('5266336311751039225');" style=""><abbr title=" 787     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException, RemoveFromCartException {"> 787     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 788         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 789         preValidateCartOperation(order);                                                                 </span>
<span class="8786950828376343914" onmouseenter="enter('8786950828376343914');" onmouseout="out('8786950828376343914');" style=""> 790         preValidateUpdateQuantityOperation(findOrderById(orderId), orderItemRequestDTO);                 </span>
<span class="-2982195349177348585" onmouseenter="enter('-2982195349177348585');" onmouseout="out('-2982195349177348585');" style=""> 791         if (orderItemRequestDTO.getQuantity() == 0) {                                                    </span>
<span class="5934987267424355703" onmouseenter="enter('5934987267424355703');" onmouseout="out('5934987267424355703');" style=""> 792             return removeItem(orderId, orderItemRequestDTO.getOrderItemId(), priceOrder);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 793         }                                                                                                </span>
<span  style=""> 794                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 795         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 796             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 796             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 797             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 798             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 799             if (!autoFlushUpdateCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 800                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 800                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 801                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 801                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 802                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 803                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 805             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 806             try {                                                                                        </span>
<span class="4428072604906913766" onmouseenter="enter('4428072604906913766');" onmouseout="out('4428072604906913766');" style=""><abbr title=" 807                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpRequest);"> 807                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpReðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 808             } finally {                                                                                  </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 809                 if (!autoFlushUpdateCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 810                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812             }                                                                                            </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 813             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 813             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 814             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 815         } catch (WorkflowException e) {                                                                  </span>
<span class="-2443073899933101644" onmouseenter="enter('-2443073899933101644');" onmouseout="out('-2443073899933101644');" style=""><abbr title=" 816             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e));"> 816             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818     }                                                                                                    </span>
<span  style=""> 819                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 820     @Override                                                                                            </span>
<span class="3069128547561385261" onmouseenter="enter('3069128547561385261');" onmouseout="out('3069128547561385261');" style=""> 821     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {RemoveFromCartException.class})        </span>
<span class="-981474137904562454" onmouseenter="enter('-981474137904562454');" onmouseout="out('-981474137904562454');" style=""><abbr title=" 822     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartException {"> 822     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartExceðŸ”µ</abbr></span>
<span class="2236102352074340212" onmouseenter="enter('2236102352074340212');" onmouseout="out('2236102352074340212');" style=""> 823         preValidateCartOperation(findOrderById(orderId));                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 824         try {                                                                                            </span>
<span class="-4288344051642570030" onmouseenter="enter('-4288344051642570030');" onmouseout="out('-4288344051642570030');" style=""> 825             OrderItem oi = orderItemService.readOrderItemById(orderItemId);                              </span>
<span class="-5187230272054076771" onmouseenter="enter('-5187230272054076771');" onmouseout="out('-5187230272054076771');" style=""> 826             if (oi == null) {                                                                            </span>
<span class="3942058861960606340" onmouseenter="enter('3942058861960606340');" onmouseout="out('3942058861960606340');" style=""> 827                 throw new WorkflowException(new ItemNotFoundException());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828             }                                                                                            </span>
<span class="3816340933425228129" onmouseenter="enter('3816340933425228129');" onmouseout="out('3816340933425228129');" style=""> 829             List&lt;Long&gt; childrenToRemove = new ArrayList&lt;Long&gt;();                                         </span>
<span class="-1993098536099392813" onmouseenter="enter('-1993098536099392813');" onmouseout="out('-1993098536099392813');" style=""> 830             if (oi instanceof BundleOrderItem) {                                                         </span>
<span class="7271984761308517823" onmouseenter="enter('7271984761308517823');" onmouseout="out('7271984761308517823');" style=""> 831                 List&lt;DiscreteOrderItem&gt; bundledItems = ((BundleOrderItem) oi).getDiscreteOrderItems();   </span>
<span class="7517044148543156187" onmouseenter="enter('7517044148543156187');" onmouseout="out('7517044148543156187');" style=""> 832                 for (DiscreteOrderItem doi : bundledItems) {                                             </span>
<span class="7367293631145453975" onmouseenter="enter('7367293631145453975');" onmouseout="out('7367293631145453975');" style=""> 833                     findAllChildrenToRemove(childrenToRemove, doi);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 835             } else {                                                                                     </span>
<span class="872231159337938033" onmouseenter="enter('872231159337938033');" onmouseout="out('872231159337938033');" style=""> 836                 findAllChildrenToRemove(childrenToRemove, oi);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 837             }                                                                                            </span>
<span class="-8102792542621025713" onmouseenter="enter('-8102792542621025713');" onmouseout="out('-8102792542621025713');" style=""> 838             for (Long childToRemove : childrenToRemove) {                                                </span>
<span class="8117841110711526180" onmouseenter="enter('8117841110711526180');" onmouseout="out('8117841110711526180');" style=""> 839                 removeItemInternal(orderId, childToRemove, false);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840             }                                                                                            </span>
<span  style=""> 841                                                                                                          </span>
<span class="-2688850311015489500" onmouseenter="enter('-2688850311015489500');" onmouseout="out('-2688850311015489500');" style=""> 842             return removeItemInternal(orderId, orderItemId, priceOrder);                                 </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 843         } catch (WorkflowException e) {                                                                  </span>
<span class="2503031575434857017" onmouseenter="enter('2503031575434857017');" onmouseout="out('2503031575434857017');" style=""><abbr title=" 844             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e));"> 844             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846     }                                                                                                    </span>
<span  style=""> 847                                                                                                          </span>
<span class="-7053318232843416816" onmouseenter="enter('-7053318232843416816');" onmouseout="out('-7053318232843416816');" style=""> 848     protected void findAllChildrenToRemove(List&lt;Long&gt; childrenToRemove, OrderItem orderItem){            </span>
<span class="-8605703698739650954" onmouseenter="enter('-8605703698739650954');" onmouseout="out('-8605703698739650954');" style=""> 849         if (CollectionUtils.isNotEmpty(orderItem.getChildOrderItems())) {                                </span>
<span class="-4353610703709163867" onmouseenter="enter('-4353610703709163867');" onmouseout="out('-4353610703709163867');" style=""> 850             for (OrderItem childOrderItem : orderItem.getChildOrderItems()) {                            </span>
<span class="-6344861684690798964" onmouseenter="enter('-6344861684690798964');" onmouseout="out('-6344861684690798964');" style=""> 851                 findAllChildrenToRemove(childrenToRemove, childOrderItem);                               </span>
<span class="-4081734193801812324" onmouseenter="enter('-4081734193801812324');" onmouseout="out('-4081734193801812324');" style=""> 852                 childrenToRemove.add(childOrderItem.getId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 853             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855     }                                                                                                    </span>
<span  style=""> 856                                                                                                          </span>
<span class="-9213800711467029414" onmouseenter="enter('-9213800711467029414');" onmouseout="out('-9213800711467029414');" style=""><abbr title=" 857     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowException {"> 857     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkfloðŸ”µ</abbr></span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 858         OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                             </span>
<span class="279907255180715291" onmouseenter="enter('279907255180715291');" onmouseout="out('279907255180715291');" style=""> 859         orderItemRequestDTO.setOrderItemId(orderItemId);                                                 </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 860         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 860         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemReðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 861         Session session = em.unwrap(Session.class);                                                      </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 862         FlushMode current = session.getHibernateFlushMode();                                             </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 863         if (!autoFlushRemoveFromCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 864             //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 864             //Performance measure. Hibernate will sometimes perform an autoflush when performing query opðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 865             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 865             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 866             //incorrect results because something has not been flushed to the database yet.              </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 867             session.setHibernateFlushMode(FlushMode.MANUAL);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868         }                                                                                                </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 869         ProcessContext&lt;CartOperationRequest&gt; context;                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 870         try {                                                                                            </span>
<span class="1281982438499352462" onmouseenter="enter('1281982438499352462');" onmouseout="out('1281982438499352462');" style=""><abbr title=" 871             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequest);"> 871             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequesðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 872         } finally {                                                                                      </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 873             if (!autoFlushRemoveFromCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 874                 session.setHibernateFlushMode(current);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 875             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 876         }                                                                                                </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 877         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 877         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActiviðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 878         return context.getSeedData().getOrder();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879     }                                                                                                    </span>
<span  style=""> 880                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 881     @Override                                                                                            </span>
<span class="4101768281683729634" onmouseenter="enter('4101768281683729634');" onmouseout="out('4101768281683729634');" style=""> 882     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { RemoveFromCartException.class })      </span>
<span class="-3452873837479924235" onmouseenter="enter('-3452873837479924235');" onmouseout="out('-3452873837479924235');" style=""> 883     public Order removeInactiveItems(Long orderId, boolean priceOrder) throws RemoveFromCartException {  </span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 884         Order order = findOrderById(orderId);                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 885         try {                                                                                            </span>
<span  style=""> 886                                                                                                          </span>
<span class="-3956255490326849696" onmouseenter="enter('-3956255490326849696');" onmouseout="out('-3956255490326849696');" style=""> 887             for (OrderItem currentItem : new ArrayList&lt;OrderItem&gt;(order.getOrderItems())) {              </span>
<span class="-219225588148279740" onmouseenter="enter('-219225588148279740');" onmouseout="out('-219225588148279740');" style=""> 888                 if (!currentItem.isSkuActive()) {                                                        </span>
<span class="-2073025095864158325" onmouseenter="enter('-2073025095864158325');" onmouseout="out('-2073025095864158325');" style=""> 889                     removeItem(orderId, currentItem.getId(), priceOrder);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 891             }                                                                                            </span>
<span  style=""> 892                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 893         } catch (Exception e) {                                                                          </span>
<span class="9087614266041334113" onmouseenter="enter('9087614266041334113');" onmouseout="out('9087614266041334113');" style=""> 894             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, e.getCause());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 895         }                                                                                                </span>
<span class="6784501458837890045" onmouseenter="enter('6784501458837890045');" onmouseout="out('6784501458837890045');" style=""> 896         return findOrderById(orderId);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897     }                                                                                                    </span>
<span  style=""> 898                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 899     @Override                                                                                            </span>
<span class="-2286265725818600106" onmouseenter="enter('-2286265725818600106');" onmouseout="out('-2286265725818600106');" style=""> 900     public boolean getAutomaticallyMergeLikeItems() {                                                    </span>
<span  style=""> 901                                                                                                          </span>
<span class="-8256644627815125391" onmouseenter="enter('-8256644627815125391');" onmouseout="out('-8256644627815125391');" style=""> 902         if (automaticallyMergeLikeItems != null) {                                                       </span>
<span class="2771319092236636517" onmouseenter="enter('2771319092236636517');" onmouseout="out('2771319092236636517');" style=""> 903             return automaticallyMergeLikeItems;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 904         }                                                                                                </span>
<span  style=""> 905                                                                                                          </span>
<span class="-661470022029899741" onmouseenter="enter('-661470022029899741');" onmouseout="out('-661470022029899741');" style=""> 906         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;automatically.merge.like.items&quot;, true);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 907     }                                                                                                    </span>
<span  style=""> 908                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 909     @Override                                                                                            </span>
<span class="8909461220693294113" onmouseenter="enter('8909461220693294113');" onmouseout="out('8909461220693294113');" style=""> 910     public void setAutomaticallyMergeLikeItems(boolean automaticallyMergeLikeItems) {                    </span>
<span class="5376880332914447533" onmouseenter="enter('5376880332914447533');" onmouseout="out('5376880332914447533');" style=""> 911         this.automaticallyMergeLikeItems = automaticallyMergeLikeItems;                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912     }                                                                                                    </span>
<span  style=""> 913                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 914     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 915     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 915     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="3855774874983732975" onmouseenter="enter('3855774874983732975');" onmouseout="out('3855774874983732975');" style=""> 916     public boolean isMoveNamedOrderItems() {                                                             </span>
<span class="-6652636869592443054" onmouseenter="enter('-6652636869592443054');" onmouseout="out('-6652636869592443054');" style=""> 917         return moveNamedOrderItems;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 918     }                                                                                                    </span>
<span  style=""> 919                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 920     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 921     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 921     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="-1545993285048257021" onmouseenter="enter('-1545993285048257021');" onmouseout="out('-1545993285048257021');" style=""> 922     public void setMoveNamedOrderItems(boolean moveNamedOrderItems) {                                    </span>
<span class="-5896321919466635220" onmouseenter="enter('-5896321919466635220');" onmouseout="out('-5896321919466635220');" style=""> 923         this.moveNamedOrderItems = moveNamedOrderItems;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 924     }                                                                                                    </span>
<span  style=""> 925                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 926     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 927     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 927     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="-1003289588467041676" onmouseenter="enter('-1003289588467041676');" onmouseout="out('-1003289588467041676');" style=""> 928     public boolean isDeleteEmptyNamedOrders() {                                                          </span>
<span class="-7878461261897242645" onmouseenter="enter('-7878461261897242645');" onmouseout="out('-7878461261897242645');" style=""> 929         return deleteEmptyNamedOrders;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 930     }                                                                                                    </span>
<span  style=""> 931                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 932     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 933     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-137537618393378808" onmouseenter="enter('-137537618393378808');" onmouseout="out('-137537618393378808');" style=""> 934     public void removeAllPaymentsFromOrder(Order order) {                                                </span>
<span class="3869583275658522189" onmouseenter="enter('3869583275658522189');" onmouseout="out('3869583275658522189');" style=""> 935         removePaymentsFromOrder(order, null);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 936     }                                                                                                    </span>
<span  style=""> 937                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 938     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 939     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1085850343810485193" onmouseenter="enter('-1085850343810485193');" onmouseout="out('-1085850343810485193');" style=""> 940     public void removePaymentsFromOrder(Order order, PaymentType paymentInfoType) {                      </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 941         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 942         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-6057897724905909333" onmouseenter="enter('-6057897724905909333');" onmouseout="out('-6057897724905909333');" style=""> 943             if (paymentInfoType == null || paymentInfoType.equals(paymentInfo.getType())) {              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 944                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 945             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 946         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 947         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 948         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 949             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 950                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 950                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 951             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 952                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 953                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 954             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 955             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 956             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 957             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 958         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 959     }                                                                                                    </span>
<span  style=""> 960                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 961     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 962     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-609061517129084855" onmouseenter="enter('-609061517129084855');" onmouseout="out('-609061517129084855');" style=""> 963     public void removeCreditCardPaymentsFromOrder(Order order) {                                         </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 964         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 965         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-8966393542166440080" onmouseenter="enter('-8966393542166440080');" onmouseout="out('-8966393542166440080');" style=""> 966             if (paymentInfo.getType().isCreditCardType()) {                                              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 967                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 968             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 969         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 970         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 971         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 972             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 973                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 973                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 974             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 975                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 976                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 978             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 979             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 980             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 981         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982     }                                                                                                    </span>
<span  style=""> 983                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 984     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 985     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="5110157232144308056" onmouseenter="enter('5110157232144308056');" onmouseout="out('5110157232144308056');" style=""> 986     public void removePaymentFromOrder(Order order, OrderPayment payment){                               </span>
<span class="-7148196279117480431" onmouseenter="enter('-7148196279117480431');" onmouseout="out('-7148196279117480431');" style=""> 987         OrderPayment paymentToRemove = null;                                                             </span>
<span class="-5892743526096946795" onmouseenter="enter('-5892743526096946795');" onmouseout="out('-5892743526096946795');" style=""> 988         for (OrderPayment info : order.getPayments()){                                                   </span>
<span class="-230615801168440856" onmouseenter="enter('-230615801168440856');" onmouseout="out('-230615801168440856');" style=""> 989             if (info.equals(payment)){                                                                   </span>
<span class="2491921736483213892" onmouseenter="enter('2491921736483213892');" onmouseout="out('2491921736483213892');" style=""> 990                 paymentToRemove = info;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 991             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 992         }                                                                                                </span>
<span class="-1581714824919605857" onmouseenter="enter('-1581714824919605857');" onmouseout="out('-1581714824919605857');" style=""> 993         if (paymentToRemove != null){                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 994             try {                                                                                        </span>
<span class="1303373247725909249" onmouseenter="enter('1303373247725909249');" onmouseout="out('1303373247725909249');" style=""><abbr title=" 995                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), payment.getType());"> 995                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumbeðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 996             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 997                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 998                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 999             }                                                                                            </span>
<span class="5021028513790341802" onmouseenter="enter('5021028513790341802');" onmouseout="out('5021028513790341802');" style="">1000             order.getPayments().remove(paymentToRemove);                                                 </span>
<span class="-7249333565068001633" onmouseenter="enter('-7249333565068001633');" onmouseout="out('-7249333565068001633');" style="">1001             payment = paymentDao.readPaymentById(paymentToRemove.getId());                               </span>
<span class="-5369248081625730935" onmouseenter="enter('-5369248081625730935');" onmouseout="out('-5369248081625730935');" style="">1002             paymentDao.delete(payment);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1003         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1004     }                                                                                                    </span>
<span  style="">1005                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1006     /**                                                                                                  </span>
<span class="6936875034092858122" onmouseenter="enter('6936875034092858122');" onmouseout="out('6936875034092858122');" style="">1007      * This method will return the exception that is immediately below the deepest                       </span>
<span class="8325554843978875883" onmouseenter="enter('8325554843978875883');" onmouseout="out('8325554843978875883');" style="">1008      * WorkflowException in the current stack trace.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1009      *                                                                                                   </span>
<span class="914602110034133584" onmouseenter="enter('914602110034133584');" onmouseout="out('914602110034133584');" style="">1010      * @param e the workflow exception that contains the requested root cause                            </span>
<span class="-825884884099351167" onmouseenter="enter('-825884884099351167');" onmouseout="out('-825884884099351167');" style="">1011      * @return the root cause of the workflow exception                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1012      */                                                                                                  </span>
<span class="-6688244297454300494" onmouseenter="enter('-6688244297454300494');" onmouseout="out('-6688244297454300494');" style="">1013     protected Throwable getCartOperationExceptionRootCause(WorkflowException e) {                        </span>
<span class="-6915919722100840508" onmouseenter="enter('-6915919722100840508');" onmouseout="out('-6915919722100840508');" style="">1014         Throwable cause = e.getCause();                                                                  </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style="">1015         if (cause == null) {                                                                             </span>
<span class="2254950224932520865" onmouseenter="enter('2254950224932520865');" onmouseout="out('2254950224932520865');" style="">1016             return e;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017         }                                                                                                </span>
<span  style="">1018                                                                                                          </span>
<span class="2363873739200211359" onmouseenter="enter('2363873739200211359');" onmouseout="out('2363873739200211359');" style="">1019         Throwable currentCause = cause;                                                                  </span>
<span class="-3242506506853415284" onmouseenter="enter('-3242506506853415284');" onmouseout="out('-3242506506853415284');" style="">1020         while (currentCause.getCause() != null) {                                                        </span>
<span class="6579708771118863579" onmouseenter="enter('6579708771118863579');" onmouseout="out('6579708771118863579');" style="">1021             currentCause = currentCause.getCause();                                                      </span>
<span class="8991829102747430232" onmouseenter="enter('8991829102747430232');" onmouseout="out('8991829102747430232');" style="">1022             if (currentCause instanceof WorkflowException) {                                             </span>
<span class="-8175986703099391257" onmouseenter="enter('-8175986703099391257');" onmouseout="out('-8175986703099391257');" style="">1023                 cause = currentCause.getCause();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1024             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1025         }                                                                                                </span>
<span  style="">1026                                                                                                          </span>
<span class="-8291476910521993484" onmouseenter="enter('-8291476910521993484');" onmouseout="out('-8291476910521993484');" style="">1027         return cause;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1028     }                                                                                                    </span>
<span  style="">1029                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1030     /**                                                                                                  </span>
<span class="-4869107995961353955" onmouseenter="enter('-4869107995961353955');" onmouseout="out('-4869107995961353955');" style="">1031      * Returns true if the two items attributes exactly match.                                           </span>
<span class="-7080712594711412450" onmouseenter="enter('-7080712594711412450');" onmouseout="out('-7080712594711412450');" style="">1032      * @param item1Attributes                                                                            </span>
<span class="-6439056940940666101" onmouseenter="enter('-6439056940940666101');" onmouseout="out('-6439056940940666101');" style="">1033      * @param item2                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">1034      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1035      */                                                                                                  </span>
<span class="6199969656370324246" onmouseenter="enter('6199969656370324246');" onmouseout="out('6199969656370324246');" style=""><abbr title="1036     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2) {">1036     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestðŸ”µ</abbr></span>
<span class="-4121399301000725365" onmouseenter="enter('-4121399301000725365');" onmouseout="out('-4121399301000725365');" style="">1037         int item1AttributeSize = item1Attributes == null ? 0 : item1Attributes.size();                   </span>
<span class="-4841456796483769583" onmouseenter="enter('-4841456796483769583');" onmouseout="out('-4841456796483769583');" style=""><abbr title="1038         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size();">1038         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size()ðŸ”µ</abbr></span>
<span  style="">1039                                                                                                          </span>
<span class="-6976046912644474969" onmouseenter="enter('-6976046912644474969');" onmouseout="out('-6976046912644474969');" style="">1040         if (item1AttributeSize != item2AttributeSize) {                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1041             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1042         }                                                                                                </span>
<span  style="">1043                                                                                                          </span>
<span class="8660828604942896283" onmouseenter="enter('8660828604942896283');" onmouseout="out('8660828604942896283');" style="">1044         for (String key : item2.getItemAttributes().keySet()) {                                          </span>
<span class="-7527106708479866057" onmouseenter="enter('-7527106708479866057');" onmouseout="out('-7527106708479866057');" style=""><abbr title="1045             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).getValue();">1045             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).geðŸ”µ</abbr></span>
<span class="-8945816914747285664" onmouseenter="enter('-8945816914747285664');" onmouseout="out('-8945816914747285664');" style="">1046             String itemTwoValue = item2.getItemAttributes().get(key);                                    </span>
<span class="2348135482578686472" onmouseenter="enter('2348135482578686472');" onmouseout="out('2348135482578686472');" style="">1047             if (!itemTwoValue.equals(itemOneValue)) {                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1048                 return false;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1049             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1050         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1051         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1052     }                                                                                                    </span>
<span  style="">1053                                                                                                          </span>
<span class="-4141718569550096543" onmouseenter="enter('-4141718569550096543');" onmouseout="out('-4141718569550096543');" style=""><abbr title="1054     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1Attributes,">1054     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; iteðŸ”µ</abbr></span>
<span class="-3703517832068399666" onmouseenter="enter('-3703517832068399666');" onmouseout="out('-3703517832068399666');" style="">1055             OrderItemRequestDTO item2) {                                                                 </span>
<span class="-4525614051490920688" onmouseenter="enter('-4525614051490920688');" onmouseout="out('-4525614051490920688');" style="">1056         // Must match on SKU and options                                                                 </span>
<span class="4681926242181597732" onmouseenter="enter('4681926242181597732');" onmouseout="out('4681926242181597732');" style="">1057         if (item1Sku != null &amp;&amp; item2.getSkuId() != null) {                                              </span>
<span class="4828879456607690268" onmouseenter="enter('4828879456607690268');" onmouseout="out('4828879456607690268');" style="">1058             if (item1Sku.getId().equals(item2.getSkuId())) {                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1059                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1060             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1061         } else {                                                                                         </span>
<span class="-3562715489663556008" onmouseenter="enter('-3562715489663556008');" onmouseout="out('-3562715489663556008');" style="">1062             if (item1Product != null &amp;&amp; item2.getProductId() != null) {                                  </span>
<span class="-6090611743723364470" onmouseenter="enter('-6090611743723364470');" onmouseout="out('-6090611743723364470');" style="">1063                 if (item1Product.getId().equals(item2.getProductId())) {                                 </span>
<span class="-3558352998309083894" onmouseenter="enter('-3558352998309083894');" onmouseout="out('-3558352998309083894');" style="">1064                     return compareAttributes(item1Attributes, item2);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1065                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1066             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1068         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1069     }                                                                                                    </span>
<span  style="">1070                                                                                                          </span>
<span class="-7114483559120409995" onmouseenter="enter('-7114483559120409995');" onmouseout="out('-7114483559120409995');" style="">1071     protected OrderItem findMatchingItem(Order order, OrderItemRequestDTO itemToFind) {                  </span>
<span class="-5687874155783563532" onmouseenter="enter('-5687874155783563532');" onmouseout="out('-5687874155783563532');" style="">1072         if (order == null) {                                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1073             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1074         }                                                                                                </span>
<span class="4435196443097834597" onmouseenter="enter('4435196443097834597');" onmouseout="out('4435196443097834597');" style="">1075         for (OrderItem currentItem : order.getOrderItems()) {                                            </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style="">1076             if (currentItem instanceof DiscreteOrderItem) {                                              </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style="">1077                 DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                        </span>
<span class="-4911141910965303230" onmouseenter="enter('-4911141910965303230');" onmouseout="out('-4911141910965303230');" style=""><abbr title="1078                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttributes(),">1078                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItðŸ”µ</abbr></span>
<span class="-1179319244482714398" onmouseenter="enter('-1179319244482714398');" onmouseout="out('-1179319244482714398');" style="">1079                         itemToFind)) {                                                                   </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style="">1080                     return discreteItem;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1081                 }                                                                                        </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style="">1082             } else if (currentItem instanceof BundleOrderItem) {                                         </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style="">1083                 BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                              </span>
<span class="-7934111527767872247" onmouseenter="enter('-7934111527767872247');" onmouseout="out('-7934111527767872247');" style="">1084                 if (itemMatches(bundleItem.getSku(), bundleItem.getProduct(), null, itemToFind)) {       </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style="">1085                     return bundleItem;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1086                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1087             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1088         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1089         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1090     }                                                                                                    </span>
<span  style="">1091                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1092     @Override                                                                                            </span>
<span class="-5844561583982380564" onmouseenter="enter('-5844561583982380564');" onmouseout="out('-5844561583982380564');" style="">1093     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { UpdateCartException.class })          </span>
<span class="586625526125468318" onmouseenter="enter('586625526125468318');" onmouseout="out('586625526125468318');" style=""><abbr title="1094     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException {">1094     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1095         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title="1096             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);">1096             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-8587304739270495732" onmouseenter="enter('-8587304739270495732');" onmouseout="out('-8587304739270495732');" style=""><abbr title="1097             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptionsForItemWorkflow.doActivities(cartOpRequest);">1097             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updatePðŸ”µ</abbr></span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title="1098             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());">1098             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style="">1099             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1100         } catch (WorkflowException e) {                                                                  </span>
<span class="1106241423190966760" onmouseenter="enter('1106241423190966760');" onmouseout="out('1106241423190966760');" style=""><abbr title="1101             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCause(e));">1101             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCauseðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1103     }                                                                                                    </span>
<span  style="">1104                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1105     @Override                                                                                            </span>
<span class="1062217594650773028" onmouseenter="enter('1062217594650773028');" onmouseout="out('1062217594650773028');" style="">1106     public Order reloadOrder(Order order) {                                                              </span>
<span class="-4055446979990348221" onmouseenter="enter('-4055446979990348221');" onmouseout="out('-4055446979990348221');" style="">1107         if (order == null || order instanceof NullOrderImpl || order.getId() == null) {                  </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style="">1108             return order;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1109         }                                                                                                </span>
<span  style="">1110                                                                                                          </span>
<span class="4601321525892022542" onmouseenter="enter('4601321525892022542');" onmouseout="out('4601321525892022542');" style="">1111         return orderDao.readOrderById(order.getId(), true);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1112     }                                                                                                    </span>
<span  style="">1113                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1114     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="">1115     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-7012224974908680421" onmouseenter="enter('-7012224974908680421');" onmouseout="out('-7012224974908680421');" style="">1116     public boolean acquireLock(Order order) {                                                            </span>
<span class="1335946416444527614" onmouseenter="enter('1335946416444527614');" onmouseout="out('1335946416444527614');" style="">1117         return orderDao.acquireLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1118     }                                                                                                    </span>
<span  style="">1119                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1120     @Override                                                                                            </span>
<span class="3603110228114188705" onmouseenter="enter('3603110228114188705');" onmouseout="out('3603110228114188705');" style="">1121     public boolean releaseLock(Order order) {                                                            </span>
<span class="1014135102090455120" onmouseenter="enter('1014135102090455120');" onmouseout="out('1014135102090455120');" style="">1122         return orderDao.releaseLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1123     }                                                                                                    </span>
<span  style="">1124                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1125     @Override                                                                                            </span>
<span class="-3640157100751954071" onmouseenter="enter('-3640157100751954071');" onmouseout="out('-3640157100751954071');" style="">1126     public void printOrder(Order order, Log log) {                                                       </span>
<span class="-3796071981400661878" onmouseenter="enter('-3796071981400661878');" onmouseout="out('-3796071981400661878');" style="">1127         if (!log.isDebugEnabled()) {                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1128             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1129         }                                                                                                </span>
<span  style="">1130                                                                                                          </span>
<span class="3667140805233255262" onmouseenter="enter('3667140805233255262');" onmouseout="out('3667140805233255262');" style="">1131         TableCreator tc = new TableCreator(new TableCreator.Col[] {                                      </span>
<span class="7681839206706458847" onmouseenter="enter('7681839206706458847');" onmouseout="out('7681839206706458847');" style="">1132             new TableCreator.Col(&quot;Order Item&quot;, 30),                                                      </span>
<span class="2598617298230317857" onmouseenter="enter('2598617298230317857');" onmouseout="out('2598617298230317857');" style="">1133             new TableCreator.Col(&quot;Qty&quot;),                                                                 </span>
<span class="-7694790865023700533" onmouseenter="enter('-7694790865023700533');" onmouseout="out('-7694790865023700533');" style="">1134             new TableCreator.Col(&quot;Unit Price&quot;),                                                          </span>
<span class="-4029215824508924196" onmouseenter="enter('-4029215824508924196');" onmouseout="out('-4029215824508924196');" style="">1135             new TableCreator.Col(&quot;Avg Adj&quot;),                                                             </span>
<span class="2280319324156256259" onmouseenter="enter('2280319324156256259');" onmouseout="out('2280319324156256259');" style="">1136             new TableCreator.Col(&quot;Total Adj&quot;),                                                           </span>
<span class="803984851040328531" onmouseenter="enter('803984851040328531');" onmouseout="out('803984851040328531');" style="">1137             new TableCreator.Col(&quot;Total Price&quot;)                                                          </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1138         });                                                                                              </span>
<span  style="">1139                                                                                                          </span>
<span class="8447029191885982498" onmouseenter="enter('8447029191885982498');" onmouseout="out('8447029191885982498');" style="">1140         for (OrderItem oi : order.getOrderItems()) {                                                     </span>
<span class="7794599779896353168" onmouseenter="enter('7794599779896353168');" onmouseout="out('7794599779896353168');" style="">1141             tc.addRow(new String[] {                                                                     </span>
<span class="-6517557825202851987" onmouseenter="enter('-6517557825202851987');" onmouseout="out('-6517557825202851987');" style="">1142                 oi.getName(),                                                                            </span>
<span class="-5588620079629414973" onmouseenter="enter('-5588620079629414973');" onmouseout="out('-5588620079629414973');" style="">1143                 String.valueOf(oi.getQuantity()),                                                        </span>
<span class="8023041970437622541" onmouseenter="enter('8023041970437622541');" onmouseout="out('8023041970437622541');" style="">1144                 String.valueOf(oi.getPriceBeforeAdjustments(true)),                                      </span>
<span class="4981794139639039914" onmouseenter="enter('4981794139639039914');" onmouseout="out('4981794139639039914');" style="">1145                 String.valueOf(oi.getAverageAdjustmentValue()),                                          </span>
<span class="-7621609530264461687" onmouseenter="enter('-7621609530264461687');" onmouseout="out('-7621609530264461687');" style="">1146                 String.valueOf(oi.getTotalAdjustmentValue()),                                            </span>
<span class="610268575597889106" onmouseenter="enter('610268575597889106');" onmouseout="out('610268575597889106');" style="">1147                 String.valueOf(oi.getTotalPrice())                                                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1148             });                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1149         }                                                                                                </span>
<span  style="">1150                                                                                                          </span>
<span class="-3387660244080770577" onmouseenter="enter('-3387660244080770577');" onmouseout="out('-3387660244080770577');" style="">1151         tc.addSeparator()                                                                                </span>
<span class="-4962129920853993876" onmouseenter="enter('-4962129920853993876');" onmouseout="out('-4962129920853993876');" style="">1152             .withGlobalRowHeaderWidth(15)                                                                </span>
<span class="8977950677164210482" onmouseenter="enter('8977950677164210482');" onmouseout="out('8977950677164210482');" style="">1153             .addRow(&quot;Subtotal&quot;, order.getSubTotal())                                                     </span>
<span class="9039771477815737150" onmouseenter="enter('9039771477815737150');" onmouseout="out('9039771477815737150');" style="">1154             .addRow(&quot;Order Adj.&quot;, order.getOrderAdjustmentsValue())                                      </span>
<span class="-3982350454387940822" onmouseenter="enter('-3982350454387940822');" onmouseout="out('-3982350454387940822');" style="">1155             .addRow(&quot;Tax&quot;, order.getTotalTax())                                                          </span>
<span class="-1569816593472627301" onmouseenter="enter('-1569816593472627301');" onmouseout="out('-1569816593472627301');" style="">1156             .addRow(&quot;Shipping&quot;, order.getTotalShipping())                                                </span>
<span class="-2587440008499047447" onmouseenter="enter('-2587440008499047447');" onmouseout="out('-2587440008499047447');" style="">1157             .addRow(&quot;Total&quot;, order.getTotal())                                                           </span>
<span class="-7531230309631143371" onmouseenter="enter('-7531230309631143371');" onmouseout="out('-7531230309631143371');" style="">1158             .addSeparator();                                                                             </span>
<span  style="">1159                                                                                                          </span>
<span class="5532863706287091360" onmouseenter="enter('5532863706287091360');" onmouseout="out('5532863706287091360');" style="">1160         log.debug(tc.toString());                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1161     }                                                                                                    </span>
<span  style="">1162                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1163     @Override                                                                                            </span>
<span class="-6821589912139190758" onmouseenter="enter('-6821589912139190758');" onmouseout="out('-6821589912139190758');" style="">1164     public void preValidateCartOperation(Order cart) {                                                   </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1165         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-2298593102036867448" onmouseenter="enter('-2298593102036867448');" onmouseout="out('-2298593102036867448');" style="">1166         extensionManager.getProxy().preValidateCartOperation(cart, erh);                                 </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1167         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1168             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1169         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1170             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1171         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1172     }                                                                                                    </span>
<span  style="">1173                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1174     @Override                                                                                            </span>
<span class="6673450650333126736" onmouseenter="enter('6673450650333126736');" onmouseout="out('6673450650333126736');" style="">1175     public void preValidateUpdateQuantityOperation(Order cart, OrderItemRequestDTO dto) {                </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1176         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-1253981422185917754" onmouseenter="enter('-1253981422185917754');" onmouseout="out('-1253981422185917754');" style="">1177         extensionManager.getProxy().preValidateUpdateQuantityOperation(cart, dto, erh);                  </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1178         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1179             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1180         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1181             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1182         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1183     }                                                                                                    </span>
<span  style="">1184                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1185     @Override                                                                                            </span>
<span class="7073850063066733207" onmouseenter="enter('7073850063066733207');" onmouseout="out('7073850063066733207');" style="">1186     public void refresh(Order order) {                                                                   </span>
<span class="4383314386154345120" onmouseenter="enter('4383314386154345120');" onmouseout="out('4383314386154345120');" style="">1187         orderDao.refresh(order);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1188     }                                                                                                    </span>
<span  style="">1189                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1190     @Override                                                                                            </span>
<span class="1062745462356892667" onmouseenter="enter('1062745462356892667');" onmouseout="out('1062745462356892667');" style="">1191     public Order findCartForCustomerWithEnhancements(Customer customer) {                                </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1192         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="8097724414319335156" onmouseenter="enter('8097724414319335156');" onmouseout="out('8097724414319335156');" style=""><abbr title="1193         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, erh);">1193         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1194         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1195             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1196         }                                                                                                </span>
<span class="-7896162153865126169" onmouseenter="enter('-7896162153865126169');" onmouseout="out('-7896162153865126169');" style="">1197         return findCartForCustomer(customer);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198     }                                                                                                    </span>
<span  style="">1199                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1200     @Override                                                                                            </span>
<span class="3369501079555878000" onmouseenter="enter('3369501079555878000');" onmouseout="out('3369501079555878000');" style="">1201     public Order findCartForCustomerWithEnhancements(Customer customer, Order candidateOrder) {          </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1202         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="935633576463333972" onmouseenter="enter('935633576463333972');" onmouseout="out('935633576463333972');" style=""><abbr title="1203         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, candidateOrder, erh);">1203         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1204         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1205             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206         }                                                                                                </span>
<span class="5654562705123023026" onmouseenter="enter('5654562705123023026');" onmouseout="out('5654562705123023026');" style="">1207         return candidateOrder;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1208     }                                                                                                    </span>
<span  style="">1209                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1210     @Override                                                                                            </span>
<span class="7870513728701775364" onmouseenter="enter('7870513728701775364');" onmouseout="out('7870513728701775364');" style="">1211     public List&lt;Order&gt; findOrdersByEmail(String email) {                                                 </span>
<span class="-6244770976468678027" onmouseenter="enter('-6244770976468678027');" onmouseout="out('-6244770976468678027');" style="">1212         return orderDao.readOrdersByEmail(email);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1213     }                                                                                                    </span>
<span  style="">1214                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1215     @Override                                                                                            </span>
<span class="1732562485956607688" onmouseenter="enter('1732562485956607688');" onmouseout="out('1732562485956607688');" style="">1216     public List&lt;Order&gt; readBatchOrders(int start, int pageSize, List&lt;OrderStatus&gt; orderStatusList) {     </span>
<span class="-4564878267596583277" onmouseenter="enter('-4564878267596583277');" onmouseout="out('-4564878267596583277');" style="">1217         return orderDao.readBatchOrders(start, pageSize, orderStatusList);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1218     }                                                                                                    </span>
<span  style="">1219                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1220     @Override                                                                                            </span>
<span class="-7199170496986096208" onmouseenter="enter('-7199170496986096208');" onmouseout="out('-7199170496986096208');" style="">1221 	public Long readNumberOfOrders() {                                                                      </span>
<span class="4444270982432861777" onmouseenter="enter('4444270982432861777');" onmouseout="out('4444270982432861777');" style="">1222     		return orderDao.readNumberOfOrders();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1223     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1224 }                                                                                                        </span>





</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2522844188166543739" onmouseenter="enter('2522844188166543739');" onmouseout="out('2522844188166543739');" style="">  18 package org.broadleafcommerce.core.order.service;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  20 import java.math.BigDecimal;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  21 import java.util.ArrayList;                                                                              </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  22 import java.util.Collections;                                                                            </span>
<span class="4561244361960433187" onmouseenter="enter('4561244361960433187');" onmouseout="out('4561244361960433187');" style="">  23 import java.util.Comparator;                                                                             </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  24 import java.util.Date;                                                                                   </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  25 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  26 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  27 import java.util.Objects;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  28 import java.util.Set;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  29 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  30 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  31 import javax.persistence.PersistenceContext;                                                             </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  32 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  33 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  34 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  35 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  36 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="7974202605197813097" onmouseenter="enter('7974202605197813097');" onmouseout="out('7974202605197813097');" style="">  37 import org.broadleafcommerce.common.payment.PaymentType;                                                 </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  38 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="7029131086618023959" onmouseenter="enter('7029131086618023959');" onmouseout="out('7029131086618023959');" style="">  39 import org.broadleafcommerce.common.util.TableCreator;                                                   </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  40 import org.broadleafcommerce.common.util.TransactionUtils;                                               </span>
<span class="4803307284880744779" onmouseenter="enter('4803307284880744779');" onmouseout="out('4803307284880744779');" style="">  41 import org.broadleafcommerce.common.util.TypedPredicate;                                                 </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  42 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  43 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  44 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  45 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  46 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="1521662235446319191" onmouseenter="enter('1521662235446319191');" onmouseout="out('1521662235446319191');" style="">  47 import org.broadleafcommerce.core.offer.domain.OfferCode;                                                </span>
<span class="263797997925672445" onmouseenter="enter('263797997925672445');" onmouseout="out('263797997925672445');" style="">  48 import org.broadleafcommerce.core.offer.service.OfferService;                                            </span>
<span class="8148915287428556311" onmouseenter="enter('8148915287428556311');" onmouseout="out('8148915287428556311');" style="">  49 import org.broadleafcommerce.core.offer.service.OfferServiceExtensionManager;                            </span>
<span class="-2264825748950997481" onmouseenter="enter('-2264825748950997481');" onmouseout="out('-2264825748950997481');" style="">  50 import org.broadleafcommerce.core.offer.service.exception.OfferAlreadyAddedException;                    </span>
<span class="6280580908510581954" onmouseenter="enter('6280580908510581954');" onmouseout="out('6280580908510581954');" style="">  51 import org.broadleafcommerce.core.offer.service.exception.OfferException;                                </span>
<span class="7718612833831637853" onmouseenter="enter('7718612833831637853');" onmouseout="out('7718612833831637853');" style="">  52 import org.broadleafcommerce.core.offer.service.exception.OfferExpiredException;                         </span>
<span class="2542407303560298775" onmouseenter="enter('2542407303560298775');" onmouseout="out('2542407303560298775');" style="">  53 import org.broadleafcommerce.core.offer.service.exception.OfferMaxUseExceededException;                  </span>
<span class="7365998840944773425" onmouseenter="enter('7365998840944773425');" onmouseout="out('7365998840944773425');" style="">  54 import org.broadleafcommerce.core.order.dao.OrderDao;                                                    </span>
<span class="-8431629490392379230" onmouseenter="enter('-8431629490392379230');" onmouseout="out('-8431629490392379230');" style="">  55 import org.broadleafcommerce.core.order.domain.BundleOrderItem;                                          </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  56 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="4607558792631823600" onmouseenter="enter('4607558792631823600');" onmouseout="out('4607558792631823600');" style="">  57 import org.broadleafcommerce.core.order.domain.GiftWrapOrderItem;                                        </span>
<span class="3195477135256206744" onmouseenter="enter('3195477135256206744');" onmouseout="out('3195477135256206744');" style="">  58 import org.broadleafcommerce.core.order.domain.NullOrderFactory;                                         </span>
<span class="6568352354414313904" onmouseenter="enter('6568352354414313904');" onmouseout="out('6568352354414313904');" style="">  59 import org.broadleafcommerce.core.order.domain.NullOrderImpl;                                            </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  60 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  61 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  62 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="-4972689095474256973" onmouseenter="enter('-4972689095474256973');" onmouseout="out('-4972689095474256973');" style="">  63 import org.broadleafcommerce.core.order.service.call.ActivityMessageDTO;                                 </span>
<span class="-7160318188857079464" onmouseenter="enter('-7160318188857079464');" onmouseout="out('-7160318188857079464');" style="">  64 import org.broadleafcommerce.core.order.service.call.GiftWrapOrderItemRequest;                           </span>
<span class="-1901438765224473349" onmouseenter="enter('-1901438765224473349');" onmouseout="out('-1901438765224473349');" style="">  65 import org.broadleafcommerce.core.order.service.call.OrderItemRequestDTO;                                </span>
<span class="-3854268344786449631" onmouseenter="enter('-3854268344786449631');" onmouseout="out('-3854268344786449631');" style="">  66 import org.broadleafcommerce.core.order.service.exception.AddToCartException;                            </span>
<span class="-8548142165698551205" onmouseenter="enter('-8548142165698551205');" onmouseout="out('-8548142165698551205');" style="">  67 import org.broadleafcommerce.core.order.service.exception.IllegalCartOperationException;                 </span>
<span class="-3598721789967501677" onmouseenter="enter('-3598721789967501677');" onmouseout="out('-3598721789967501677');" style="">  68 import org.broadleafcommerce.core.order.service.exception.ItemNotFoundException;                         </span>
<span class="4692349346970735648" onmouseenter="enter('4692349346970735648');" onmouseout="out('4692349346970735648');" style="">  69 import org.broadleafcommerce.core.order.service.exception.RemoveFromCartException;                       </span>
<span class="9042395061305363095" onmouseenter="enter('9042395061305363095');" onmouseout="out('9042395061305363095');" style="">  70 import org.broadleafcommerce.core.order.service.exception.UpdateCartException;                           </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  71 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-3953683189888176126" onmouseenter="enter('-3953683189888176126');" onmouseout="out('-3953683189888176126');" style="">  72 import org.broadleafcommerce.core.order.service.workflow.CartOperationRequest;                           </span>
<span class="3604210211865098056" onmouseenter="enter('3604210211865098056');" onmouseout="out('3604210211865098056');" style="">  73 import org.broadleafcommerce.core.payment.dao.OrderPaymentDao;                                           </span>
<span class="725806334255742314" onmouseenter="enter('725806334255742314');" onmouseout="out('725806334255742314');" style="">  74 import org.broadleafcommerce.core.payment.domain.OrderPayment;                                           </span>
<span class="-5451903065912654495" onmouseenter="enter('-5451903065912654495');" onmouseout="out('-5451903065912654495');" style="">  75 import org.broadleafcommerce.core.payment.domain.secure.Referenced;                                      </span>
<span class="5702480564955886723" onmouseenter="enter('5702480564955886723');" onmouseout="out('5702480564955886723');" style="">  76 import org.broadleafcommerce.core.payment.service.SecureOrderPaymentService;                             </span>
<span class="-8638524682328332386" onmouseenter="enter('-8638524682328332386');" onmouseout="out('-8638524682328332386');" style="">  77 import org.broadleafcommerce.core.pricing.service.PricingService;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  78 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  79 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  80 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  81 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  82 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  83 import org.broadleafcommerce.profile.core.domain.Customer;                                               </span>
<span class="2095059086545149108" onmouseenter="enter('2095059086545149108');" onmouseout="out('2095059086545149108');" style="">  84 import org.broadleafcommerce.profile.core.service.CustomerService;                                       </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  85 import org.hibernate.FlushMode;                                                                          </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  86 import org.hibernate.Session;                                                                            </span>
<span class="-6296437060367579882" onmouseenter="enter('-6296437060367579882');" onmouseout="out('-6296437060367579882');" style="">  87 import org.hibernate.exception.LockAcquisitionException;                                                 </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  88 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="1177291030959407810" onmouseenter="enter('1177291030959407810');" onmouseout="out('1177291030959407810');" style="">  89 import org.springframework.jmx.export.annotation.ManagedAttribute;                                       </span>
<span class="-2411378172167085657" onmouseenter="enter('-2411378172167085657');" onmouseout="out('-2411378172167085657');" style="">  90 import org.springframework.jmx.export.annotation.ManagedResource;                                        </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  91 import org.springframework.stereotype.Service;                                                           </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  92 import org.springframework.transaction.PlatformTransactionManager;                                       </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  93 import org.springframework.transaction.TransactionDefinition;                                            </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  94 import org.springframework.transaction.TransactionStatus;                                                </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  95 import org.springframework.transaction.annotation.Transactional;                                         </span>
<span  style="">  96                                                                                                          </span>
<span  style="">  97                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  98 /**                                                                                                      </span>
<span class="2815697706567038739" onmouseenter="enter('2815697706567038739');" onmouseout="out('2815697706567038739');" style="">  99  * @author apazzolini                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 100  */                                                                                                      </span>
<span class="7613295130782185909" onmouseenter="enter('7613295130782185909');" onmouseout="out('7613295130782185909');" style=""> 101 @Service(&quot;blOrderService&quot;)                                                                               </span>
<span class="-9030814862361352557" onmouseenter="enter('-9030814862361352557');" onmouseout="out('-9030814862361352557');" style=""><abbr title=" 102 @ManagedResource(objectName = &quot;org.broadleafcommerce:name=OrderService&quot;, description = &quot;Order Service&quot;, currencyTimeLimit = 15)"> 102 @ManagedResource(objectName = &quot;org.broadleafcommerce:name=OrderService&quot;, description = &quot;Order Service&quot;, cðŸ”µ</abbr></span>
<span class="-2072417237584838241" onmouseenter="enter('-2072417237584838241');" onmouseout="out('-2072417237584838241');" style=""> 103 public class OrderServiceImpl implements OrderService {                                                  </span>
<span class="-6147601375299019476" onmouseenter="enter('-6147601375299019476');" onmouseout="out('-6147601375299019476');" style=""> 104     private static final Log LOG = LogFactory.getLog(OrderServiceImpl.class);                            </span>
<span  style=""> 105                                                                                                          </span>
<span class="-1034856612351701575" onmouseenter="enter('-1034856612351701575');" onmouseout="out('-1034856612351701575');" style=""> 106     /* DAOs */                                                                                           </span>
<span class="4300412198824813091" onmouseenter="enter('4300412198824813091');" onmouseout="out('4300412198824813091');" style=""> 107     @Resource(name = &quot;blOrderPaymentDao&quot;)                                                                </span>
<span class="-6743991484426169368" onmouseenter="enter('-6743991484426169368');" onmouseout="out('-6743991484426169368');" style=""> 108     protected OrderPaymentDao paymentDao;                                                                </span>
<span  style=""> 109                                                                                                          </span>
<span class="-8616512229212864636" onmouseenter="enter('-8616512229212864636');" onmouseout="out('-8616512229212864636');" style=""> 110     @Resource(name = &quot;blOrderDao&quot;)                                                                       </span>
<span class="3205943113513590409" onmouseenter="enter('3205943113513590409');" onmouseout="out('3205943113513590409');" style=""> 111     protected OrderDao orderDao;                                                                         </span>
<span  style=""> 112                                                                                                          </span>
<span class="5779429748772127951" onmouseenter="enter('5779429748772127951');" onmouseout="out('5779429748772127951');" style=""> 113     @Resource(name = &quot;blOfferDao&quot;)                                                                       </span>
<span class="8858788780557179486" onmouseenter="enter('8858788780557179486');" onmouseout="out('8858788780557179486');" style=""> 114     protected OfferDao offerDao;                                                                         </span>
<span  style=""> 115                                                                                                          </span>
<span class="4027092641360680465" onmouseenter="enter('4027092641360680465');" onmouseout="out('4027092641360680465');" style=""> 116     /* Factories */                                                                                      </span>
<span class="-5967051191091567596" onmouseenter="enter('-5967051191091567596');" onmouseout="out('-5967051191091567596');" style=""> 117     @Resource(name = &quot;blNullOrderFactory&quot;)                                                               </span>
<span class="4068278867975252256" onmouseenter="enter('4068278867975252256');" onmouseout="out('4068278867975252256');" style=""> 118     protected NullOrderFactory nullOrderFactory;                                                         </span>
<span  style=""> 119                                                                                                          </span>
<span class="1042938529233933214" onmouseenter="enter('1042938529233933214');" onmouseout="out('1042938529233933214');" style=""> 120     /* Services */                                                                                       </span>
<span class="6969754559269026560" onmouseenter="enter('6969754559269026560');" onmouseout="out('6969754559269026560');" style=""> 121     @Resource(name = &quot;blCustomerService&quot;)                                                                </span>
<span class="5369585293672379772" onmouseenter="enter('5369585293672379772');" onmouseout="out('5369585293672379772');" style=""> 122     protected CustomerService customerService;                                                           </span>
<span  style=""> 123                                                                                                          </span>
<span class="1740335809005650078" onmouseenter="enter('1740335809005650078');" onmouseout="out('1740335809005650078');" style=""> 124     @Resource(name = &quot;blPricingService&quot;)                                                                 </span>
<span class="-3953942945177082651" onmouseenter="enter('-3953942945177082651');" onmouseout="out('-3953942945177082651');" style=""> 125     protected PricingService pricingService;                                                             </span>
<span  style=""> 126                                                                                                          </span>
<span class="-8762117636097767442" onmouseenter="enter('-8762117636097767442');" onmouseout="out('-8762117636097767442');" style=""> 127     @Resource(name = &quot;blOrderItemService&quot;)                                                               </span>
<span class="-7939877477893967584" onmouseenter="enter('-7939877477893967584');" onmouseout="out('-7939877477893967584');" style=""> 128     protected OrderItemService orderItemService;                                                         </span>
<span  style=""> 129                                                                                                          </span>
<span class="2996711079688344376" onmouseenter="enter('2996711079688344376');" onmouseout="out('2996711079688344376');" style=""> 130     @Resource(name = &quot;blFulfillmentGroupService&quot;)                                                        </span>
<span class="-4012624862608675616" onmouseenter="enter('-4012624862608675616');" onmouseout="out('-4012624862608675616');" style=""> 131     protected FulfillmentGroupService fulfillmentGroupService;                                           </span>
<span  style=""> 132                                                                                                          </span>
<span class="401190535541877398" onmouseenter="enter('401190535541877398');" onmouseout="out('401190535541877398');" style=""> 133     @Resource(name = &quot;blOfferService&quot;)                                                                   </span>
<span class="5260453850719866461" onmouseenter="enter('5260453850719866461');" onmouseout="out('5260453850719866461');" style=""> 134     protected OfferService offerService;                                                                 </span>
<span  style=""> 135                                                                                                          </span>
<span class="-5728623657958779082" onmouseenter="enter('-5728623657958779082');" onmouseout="out('-5728623657958779082');" style=""> 136     @Resource(name = &quot;blSecureOrderPaymentService&quot;)                                                      </span>
<span class="-6581230590179767656" onmouseenter="enter('-6581230590179767656');" onmouseout="out('-6581230590179767656');" style=""> 137     protected SecureOrderPaymentService securePaymentInfoService;                                        </span>
<span  style=""> 138                                                                                                          </span>
<span class="3052322175513128984" onmouseenter="enter('3052322175513128984');" onmouseout="out('3052322175513128984');" style=""> 139     @Resource(name = &quot;blMergeCartService&quot;)                                                               </span>
<span class="8208298738953975930" onmouseenter="enter('8208298738953975930');" onmouseout="out('8208298738953975930');" style=""> 140     protected MergeCartService mergeCartService;                                                         </span>
<span  style=""> 141                                                                                                          </span>
<span class="-5141785283307634971" onmouseenter="enter('-5141785283307634971');" onmouseout="out('-5141785283307634971');" style=""> 142     @Resource(name = &quot;blOrderServiceExtensionManager&quot;)                                                   </span>
<span class="7609575163897375728" onmouseenter="enter('7609575163897375728');" onmouseout="out('7609575163897375728');" style=""> 143     protected OrderServiceExtensionManager extensionManager;                                             </span>
<span  style=""> 144                                                                                                          </span>
<span class="-2568041442687394420" onmouseenter="enter('-2568041442687394420');" onmouseout="out('-2568041442687394420');" style=""> 145     /* Workflows */                                                                                      </span>
<span class="2793266955607927868" onmouseenter="enter('2793266955607927868');" onmouseout="out('2793266955607927868');" style=""> 146     @Resource(name = &quot;blAddItemWorkflow&quot;)                                                                </span>
<span class="-7970748165831650126" onmouseenter="enter('-7970748165831650126');" onmouseout="out('-7970748165831650126');" style=""> 147     protected Processor addItemWorkflow;                                                                 </span>
<span  style=""> 148                                                                                                          </span>
<span class="6527917864594618071" onmouseenter="enter('6527917864594618071');" onmouseout="out('6527917864594618071');" style=""> 149     @Resource(name = &quot;blUpdateProductOptionsForItemWorkflow&quot;)                                            </span>
<span class="-3432528377574027794" onmouseenter="enter('-3432528377574027794');" onmouseout="out('-3432528377574027794');" style=""> 150     private Processor updateProductOptionsForItemWorkflow;                                               </span>
<span  style=""> 151                                                                                                          </span>
<span class="-8676131598314218463" onmouseenter="enter('-8676131598314218463');" onmouseout="out('-8676131598314218463');" style=""> 152     @Resource(name = &quot;blUpdateItemWorkflow&quot;)                                                             </span>
<span class="-4038034170241387616" onmouseenter="enter('-4038034170241387616');" onmouseout="out('-4038034170241387616');" style=""> 153     protected Processor updateItemWorkflow;                                                              </span>
<span  style=""> 154                                                                                                          </span>
<span class="2809816546718326729" onmouseenter="enter('2809816546718326729');" onmouseout="out('2809816546718326729');" style=""> 155     @Resource(name = &quot;blRemoveItemWorkflow&quot;)                                                             </span>
<span class="8820366819754000449" onmouseenter="enter('8820366819754000449');" onmouseout="out('8820366819754000449');" style=""> 156     protected Processor removeItemWorkflow;                                                              </span>
<span  style=""> 157                                                                                                          </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 158     @Resource(name = &quot;blTransactionManager&quot;)                                                             </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 159     protected PlatformTransactionManager transactionManager;                                             </span>
<span  style=""> 160                                                                                                          </span>
<span class="4647563353113875163" onmouseenter="enter('4647563353113875163');" onmouseout="out('4647563353113875163');" style=""> 161     @Value(&quot;${pricing.retry.count.for.lock.failure}&quot;)                                                    </span>
<span class="3768032238220096351" onmouseenter="enter('3768032238220096351');" onmouseout="out('3768032238220096351');" style=""> 162     protected int pricingRetryCountForLockFailure = 3;                                                   </span>
<span  style=""> 163                                                                                                          </span>
<span class="-5649780437206020465" onmouseenter="enter('-5649780437206020465');" onmouseout="out('-5649780437206020465');" style=""> 164     @Value(&quot;${pricing.retry.wait.interval.for.lock.failure}&quot;)                                            </span>
<span class="6143681610186845623" onmouseenter="enter('6143681610186845623');" onmouseout="out('6143681610186845623');" style=""> 165     protected long pricingRetryWaitIntervalForLockFailure = 500L;                                        </span>
<span  style=""> 166                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 167     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 168      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="-4084123837140279098" onmouseenter="enter('-4084123837140279098');" onmouseout="out('-4084123837140279098');" style=""><abbr title=" 169      * add-to-cart workflow. This should generally be able to be left false. This is a performance measure and"> 169      * add-to-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="531367490526902986" onmouseenter="enter('531367490526902986');" onmouseout="out('531367490526902986');" style=""> 170      * add-to-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 171      */                                                                                                  </span>
<span class="-6971248696513840261" onmouseenter="enter('-6971248696513840261');" onmouseout="out('-6971248696513840261');" style=""> 172     @Value(&quot;${auto.flush.on.query.during.add.to.cart:false}&quot;)                                            </span>
<span class="-9081510558149889178" onmouseenter="enter('-9081510558149889178');" onmouseout="out('-9081510558149889178');" style=""> 173     protected boolean autoFlushAddToCart = false;                                                        </span>
<span  style=""> 174                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 175     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 176      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5682863995593575399" onmouseenter="enter('5682863995593575399');" onmouseout="out('5682863995593575399');" style=""><abbr title=" 177      * update-cart workflow. This should generally be able to be left false. This is a performance measure and"> 177      * update-cart workflow. This should generally be able to be left false. This is a performance measurðŸ”µ</abbr></span>
<span class="4015846476888264417" onmouseenter="enter('4015846476888264417');" onmouseout="out('4015846476888264417');" style=""> 178      * update-cart operations will be more efficient when this is false.                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 179      */                                                                                                  </span>
<span class="4955973510412192391" onmouseenter="enter('4955973510412192391');" onmouseout="out('4955973510412192391');" style=""> 180     @Value(&quot;${auto.flush.on.query.during.update.cart:false}&quot;)                                            </span>
<span class="-6560708755317111135" onmouseenter="enter('-6560708755317111135');" onmouseout="out('-6560708755317111135');" style=""> 181     protected boolean autoFlushUpdateCart = false;                                                       </span>
<span  style=""> 182                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 183     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 184      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="5427441896991106725" onmouseenter="enter('5427441896991106725');" onmouseout="out('5427441896991106725');" style=""><abbr title=" 185      * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure and"> 185      * remove-from-cart workflow. This should generally be able to be left false. This is a performance mðŸ”µ</abbr></span>
<span class="-4648779041241212172" onmouseenter="enter('-4648779041241212172');" onmouseout="out('-4648779041241212172');" style=""> 186      * remove-from-cart operations will be more efficient when this is false.                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 187      */                                                                                                  </span>
<span class="-8172893732176017719" onmouseenter="enter('-8172893732176017719');" onmouseout="out('-8172893732176017719');" style=""> 188     @Value(&quot;${auto.flush.on.query.during.remove.from.cart:false}&quot;)                                       </span>
<span class="-3285670849425830103" onmouseenter="enter('-3285670849425830103');" onmouseout="out('-3285670849425830103');" style=""> 189     protected boolean autoFlushRemoveFromCart = false;                                                   </span>
<span  style=""> 190                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 191     /**                                                                                                  </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 192      * Advanced setting. Should Hibernate auto flush before queries during an                            </span>
<span class="3621392970638403989" onmouseenter="enter('3621392970638403989');" onmouseout="out('3621392970638403989');" style=""><abbr title=" 193      * order save pricing flow. This should generally be able to be left false. This is a performance measure and"> 193      * order save pricing flow. This should generally be able to be left false. This is a performance meaðŸ”µ</abbr></span>
<span class="-6789052884213414091" onmouseenter="enter('-6789052884213414091');" onmouseout="out('-6789052884213414091');" style=""> 194      * save operations will be more efficient when this is false.                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195      */                                                                                                  </span>
<span class="-188440796641371951" onmouseenter="enter('-188440796641371951');" onmouseout="out('-188440796641371951');" style=""> 196     @Value(&quot;${auto.flush.on.query.during.cart.pricing.save:false}&quot;)                                      </span>
<span class="-7447722827185958723" onmouseenter="enter('-7447722827185958723');" onmouseout="out('-7447722827185958723');" style=""> 197     protected boolean autoFlushSaveCart = false;                                                         </span>
<span  style=""> 198                                                                                                          </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style=""> 199     @PersistenceContext(unitName=&quot;blPU&quot;)                                                                 </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 200     protected EntityManager em;                                                                          </span>
<span  style=""> 201                                                                                                          </span>
<span class="-6638939562421962482" onmouseenter="enter('-6638939562421962482');" onmouseout="out('-6638939562421962482');" style=""> 202     /* Fields */                                                                                         </span>
<span class="-3415856814483301136" onmouseenter="enter('-3415856814483301136');" onmouseout="out('-3415856814483301136');" style=""> 203     protected boolean moveNamedOrderItems = true;                                                        </span>
<span  style=""> 204                                                                                                          </span>
<span class="-112332225907304480" onmouseenter="enter('-112332225907304480');" onmouseout="out('-112332225907304480');" style=""> 205     protected boolean deleteEmptyNamedOrders = true;                                                     </span>
<span  style=""> 206                                                                                                          </span>
<span class="8203140173062168288" onmouseenter="enter('8203140173062168288');" onmouseout="out('8203140173062168288');" style=""> 207     protected Boolean automaticallyMergeLikeItems;                                                       </span>
<span  style=""> 208                                                                                                          </span>
<span class="2799370370843719797" onmouseenter="enter('2799370370843719797');" onmouseout="out('2799370370843719797');" style=""> 209     @Resource(name = &quot;blOrderMultishipOptionService&quot;)                                                    </span>
<span class="768036680350789739" onmouseenter="enter('768036680350789739');" onmouseout="out('768036680350789739');" style=""> 210     protected OrderMultishipOptionService orderMultishipOptionService;                                   </span>
<span  style=""> 211                                                                                                          </span>
<span class="1476595721846482438" onmouseenter="enter('1476595721846482438');" onmouseout="out('1476595721846482438');" style=""> 212     @Resource(name = &quot;blOfferServiceExtensionManager&quot;)                                                   </span>
<span class="1464017235088339416" onmouseenter="enter('1464017235088339416');" onmouseout="out('1464017235088339416');" style=""> 213     protected OfferServiceExtensionManager offerServiceExtensionManager;                                 </span>
<span  style=""> 214                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 216     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style=""> 217     public Order createNewCartForCustomer(Customer customer) {                                           </span>
<span  style=""> 218                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 219 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-3250206482798517655" onmouseenter="enter('-3250206482798517655');" onmouseout="out('-3250206482798517655');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 220         customer = customerService.saveCustomer(customer);                                               </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 221         return orderDao.createNewCartForCustomer(customer);                                              </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 222 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 223 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 223 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 224 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225                                                                                                          </span>
<span class="-8527029649040543351" onmouseenter="enter('-8527029649040543351');" onmouseout="out('-8527029649040543351');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226         final Object lock = Objects.isNull(customer.getId()) ? customer : customer.getId();              </span>
<span class="-4616623925289667129" onmouseenter="enter('-4616623925289667129');" onmouseout="out('-4616623925289667129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227         synchronized (lock) {                                                                            </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228             return orderDao.createNewCartForCustomer(customer);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229         }                                                                                                </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 230 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 231                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232     }                                                                                                    </span>
<span  style=""> 233                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 234     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 235     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style=""> 236     public Order createNamedOrderForCustomer(String name, Customer customer) {                           </span>
<span class="-2409876513820161352" onmouseenter="enter('-2409876513820161352');" onmouseout="out('-2409876513820161352');" style=""> 237         Order namedOrder = orderDao.create();                                                            </span>
<span class="-4702827597577679131" onmouseenter="enter('-4702827597577679131');" onmouseout="out('-4702827597577679131');" style=""> 238         namedOrder.setCustomer(customer);                                                                </span>
<span class="-5090709722664798426" onmouseenter="enter('-5090709722664798426');" onmouseout="out('-5090709722664798426');" style=""> 239         namedOrder.setName(name);                                                                        </span>
<span class="-1603494808269519128" onmouseenter="enter('-1603494808269519128');" onmouseout="out('-1603494808269519128');" style=""> 240         namedOrder.setStatus(OrderStatus.NAMED);                                                         </span>
<span  style=""> 241                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 242         if (extensionManager != null) {                                                                  </span>
<span class="8990503012292673298" onmouseenter="enter('8990503012292673298');" onmouseout="out('8990503012292673298');" style=""> 243             extensionManager.getProxy().attachAdditionalDataToNewNamedCart(customer, namedOrder);        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244         }                                                                                                </span>
<span  style=""> 245                                                                                                          </span>
<span class="6872588596382822440" onmouseenter="enter('6872588596382822440');" onmouseout="out('6872588596382822440');" style=""> 246         if (BroadleafRequestContext.getBroadleafRequestContext() != null) {                              </span>
<span class="8302259492819337972" onmouseenter="enter('8302259492819337972');" onmouseout="out('8302259492819337972');" style=""> 247             namedOrder.setLocale(BroadleafRequestContext.getBroadleafRequestContext().getLocale());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span  style=""> 249                                                                                                          </span>
<span class="-4755266802229314023" onmouseenter="enter('-4755266802229314023');" onmouseout="out('-4755266802229314023');" style=""> 250         return persist(namedOrder); // No need to price here                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251     }                                                                                                    </span>
<span  style=""> 252                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 253     @Override                                                                                            </span>
<span class="-5228222697072727023" onmouseenter="enter('-5228222697072727023');" onmouseout="out('-5228222697072727023');" style=""> 254     public Order findNamedOrderForCustomer(String name, Customer customer) {                             </span>
<span class="3593606300255125692" onmouseenter="enter('3593606300255125692');" onmouseout="out('3593606300255125692');" style=""> 255         return orderDao.readNamedOrderForCustomer(customer, name);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256     }                                                                                                    </span>
<span  style=""> 257                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 258     @Override                                                                                            </span>
<span class="-3536100433526278820" onmouseenter="enter('-3536100433526278820');" onmouseout="out('-3536100433526278820');" style=""> 259     public Order findOrderById(Long orderId) {                                                           </span>
<span class="1161210593743093685" onmouseenter="enter('1161210593743093685');" onmouseout="out('1161210593743093685');" style=""> 260         return orderDao.readOrderById(orderId);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261     }                                                                                                    </span>
<span  style=""> 262                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 263     @Override                                                                                            </span>
<span class="3514330874800299886" onmouseenter="enter('3514330874800299886');" onmouseout="out('3514330874800299886');" style=""> 264     public List&lt;Order&gt; findOrdersByIds(List&lt;Long&gt; orderIds) {                                            </span>
<span class="-3891915877440809040" onmouseenter="enter('-3891915877440809040');" onmouseout="out('-3891915877440809040');" style=""> 265         return orderDao.readOrdersByIds(orderIds);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span  style=""> 267                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 268     @Override                                                                                            </span>
<span class="4729011646907808921" onmouseenter="enter('4729011646907808921');" onmouseout="out('4729011646907808921');" style=""> 269     public Order findOrderById(Long orderId, boolean refresh) {                                          </span>
<span class="-1498807655754375115" onmouseenter="enter('-1498807655754375115');" onmouseout="out('-1498807655754375115');" style=""> 270         return orderDao.readOrderById(orderId, refresh);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271     }                                                                                                    </span>
<span  style=""> 272                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 273     @Override                                                                                            </span>
<span class="6472182469411690717" onmouseenter="enter('6472182469411690717');" onmouseout="out('6472182469411690717');" style=""> 274     public Order getNullOrder() {                                                                        </span>
<span class="-9215158658227454796" onmouseenter="enter('-9215158658227454796');" onmouseout="out('-9215158658227454796');" style=""> 275         return nullOrderFactory.getNullOrder();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276     }                                                                                                    </span>
<span  style=""> 277                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 278     @Override                                                                                            </span>
<span class="-868163728006062843" onmouseenter="enter('-868163728006062843');" onmouseout="out('-868163728006062843');" style=""> 279     public Order findCartForCustomer(Customer customer) {                                                </span>
<span class="8766840141038390904" onmouseenter="enter('8766840141038390904');" onmouseout="out('8766840141038390904');" style=""> 280         return orderDao.readCartForCustomer(customer);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 283     @Override                                                                                            </span>
<span class="-7652784715167872669" onmouseenter="enter('-7652784715167872669');" onmouseout="out('-7652784715167872669');" style=""> 284     public List&lt;Order&gt; findOrdersForCustomer(Customer customer) {                                        </span>
<span class="-1451410109320389957" onmouseenter="enter('-1451410109320389957');" onmouseout="out('-1451410109320389957');" style=""> 285         return orderDao.readOrdersForCustomer(customer.getId());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 288     @Override                                                                                            </span>
<span class="-1874817631753699552" onmouseenter="enter('-1874817631753699552');" onmouseout="out('-1874817631753699552');" style=""> 289     public List&lt;Order&gt; findOrdersForCustomer(Customer customer, OrderStatus status) {                    </span>
<span class="8303115895394445841" onmouseenter="enter('8303115895394445841');" onmouseout="out('8303115895394445841');" style=""> 290         return orderDao.readOrdersForCustomer(customer, status);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span  style=""> 292                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 293     @Override                                                                                            </span>
<span class="-5868034956931005765" onmouseenter="enter('-5868034956931005765');" onmouseout="out('-5868034956931005765');" style=""> 294     public Order findOrderByOrderNumber(String orderNumber) {                                            </span>
<span class="4126063111294586184" onmouseenter="enter('4126063111294586184');" onmouseout="out('4126063111294586184');" style=""> 295         return orderDao.readOrderByOrderNumber(orderNumber);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 298     @Override                                                                                            </span>
<span class="4191009625455802778" onmouseenter="enter('4191009625455802778');" onmouseout="out('4191009625455802778');" style=""> 299     public List&lt;Order&gt; findOrdersByDateRange(Date startDate, Date endDate) {                             </span>
<span class="4159366983783237003" onmouseenter="enter('4159366983783237003');" onmouseout="out('4159366983783237003');" style=""> 300         return orderDao.readOrdersByDateRange(startDate, endDate);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span  style=""> 302                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 303     @Override                                                                                            </span>
<span class="-5094637214545511446" onmouseenter="enter('-5094637214545511446');" onmouseout="out('-5094637214545511446');" style=""> 304     public List&lt;Order&gt; findOrdersByDaysCount(Integer daysCount, Integer batchSize) {                     </span>
<span class="-5623433853176777156" onmouseenter="enter('-5623433853176777156');" onmouseout="out('-5623433853176777156');" style=""> 305         return orderDao.readOrdersOlderThanDaysCount(daysCount, batchSize);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="7584459338142486264" onmouseenter="enter('7584459338142486264');" onmouseout="out('7584459338142486264');" style=""><abbr title=" 309     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endDate) {"> 309     public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endðŸ”µ</abbr></span>
<span class="-7476578265182813965" onmouseenter="enter('-7476578265182813965');" onmouseout="out('-7476578265182813965');" style=""> 310         return orderDao.readOrdersForCustomersInDateRange(customerIds, startDate, endDate);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 313     @Override                                                                                            </span>
<span class="2742799531036946157" onmouseenter="enter('2742799531036946157');" onmouseout="out('2742799531036946157');" style=""> 314     public List&lt;OrderPayment&gt; findPaymentsForOrder(Order order) {                                        </span>
<span class="-8492719680919611182" onmouseenter="enter('-8492719680919611182');" onmouseout="out('-8492719680919611182');" style=""> 315         return paymentDao.readPaymentsForOrder(order);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 318     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 319     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-3332960922797777344" onmouseenter="enter('-3332960922797777344');" onmouseout="out('-3332960922797777344');" style=""><abbr title=" 320     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfo) {"> 320     public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfoðŸ”µ</abbr></span>
<span class="5531588484946379356" onmouseenter="enter('5531588484946379356');" onmouseout="out('5531588484946379356');" style=""> 321         payment.setOrder(order);                                                                         </span>
<span class="-5902578581570361338" onmouseenter="enter('-5902578581570361338');" onmouseout="out('-5902578581570361338');" style=""> 322         order.getPayments().add(payment);                                                                </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 323         order = persist(order);                                                                          </span>
<span class="3102030919604467575" onmouseenter="enter('3102030919604467575');" onmouseout="out('3102030919604467575');" style=""> 324         int paymentIndex = order.getPayments().size() - 1;                                               </span>
<span  style=""> 325                                                                                                          </span>
<span class="-1059731582497422542" onmouseenter="enter('-1059731582497422542');" onmouseout="out('-1059731582497422542');" style=""> 326         if (securePaymentInfo != null) {                                                                 </span>
<span class="-3146705087638884484" onmouseenter="enter('-3146705087638884484');" onmouseout="out('-3146705087638884484');" style=""> 327             securePaymentInfoService.save(securePaymentInfo);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328         }                                                                                                </span>
<span  style=""> 329                                                                                                          </span>
<span class="-7441301587762344543" onmouseenter="enter('-7441301587762344543');" onmouseout="out('-7441301587762344543');" style=""> 330         return order.getPayments().get(paymentIndex);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331     }                                                                                                    </span>
<span  style=""> 332                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 333     @Override                                                                                            </span>
<span class="-6260636294738378695" onmouseenter="enter('-6260636294738378695');" onmouseout="out('-6260636294738378695');" style=""> 334     public Order save(Order order, boolean priceOrder, boolean repriceItems) throws PricingException {   </span>
<span class="-861950305740674202" onmouseenter="enter('-861950305740674202');" onmouseout="out('-861950305740674202');" style=""> 335         if (repriceItems) {                                                                              </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 336             order.updatePrices();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="7466161317523035871" onmouseenter="enter('7466161317523035871');" onmouseout="out('7466161317523035871');" style=""> 338         return save(order, priceOrder);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 341     @Override                                                                                            </span>
<span class="3492049941937307387" onmouseenter="enter('3492049941937307387');" onmouseout="out('3492049941937307387');" style=""> 342     public Order save(Order order, Boolean priceOrder) throws PricingException {                         </span>
<span class="-7596987583027747839" onmouseenter="enter('-7596987583027747839');" onmouseout="out('-7596987583027747839');" style=""> 343         //persist the order first                                                                        </span>
<span class="-389595421943223582" onmouseenter="enter('-389595421943223582');" onmouseout="out('-389595421943223582');" style=""> 344         TransactionStatus status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                       </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 345                     TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 346         try {                                                                                            </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 347             order = persist(order);                                                                      </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 348             TransactionUtils.finalizeTransaction(status, transactionManager, false);                     </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 349         } catch (RuntimeException ex) {                                                                  </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 350             TransactionUtils.finalizeTransaction(status, transactionManager, true);                      </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 351             throw ex;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352         }                                                                                                </span>
<span  style=""> 353                                                                                                          </span>
<span class="3415408115507489273" onmouseenter="enter('3415408115507489273');" onmouseout="out('3415408115507489273');" style=""> 354         //make any pricing changes - possibly retrying with the persisted state if there&#x27;s a lock failure</span>
<span class="3259489568218221951" onmouseenter="enter('3259489568218221951');" onmouseout="out('3259489568218221951');" style=""> 355         if (priceOrder) {                                                                                </span>
<span class="1922471648485581677" onmouseenter="enter('1922471648485581677');" onmouseout="out('1922471648485581677');" style=""> 356             int retryCount = 0;                                                                          </span>
<span class="-3964676588024243488" onmouseenter="enter('-3964676588024243488');" onmouseout="out('-3964676588024243488');" style=""> 357             boolean isValid = false;                                                                     </span>
<span class="-6184322868026722475" onmouseenter="enter('-6184322868026722475');" onmouseout="out('-6184322868026722475');" style=""> 358             while (!isValid) {                                                                           </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 359                 Session session = em.unwrap(Session.class);                                              </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 360                 FlushMode current = session.getHibernateFlushMode();                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 361                 try {                                                                                    </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 362                     if (!autoFlushSaveCart) {                                                            </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 363                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 363                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 364                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 364                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 365                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 366                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367                     }                                                                                    </span>
<span class="8892823389652271355" onmouseenter="enter('8892823389652271355');" onmouseout="out('8892823389652271355');" style=""> 368                     order = pricingService.executePricing(order);                                        </span>
<span class="9041443712359372060" onmouseenter="enter('9041443712359372060');" onmouseout="out('9041443712359372060');" style=""> 369                     isValid = true;                                                                      </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 370                 } catch (Exception ex) {                                                                 </span>
<span class="-2271119485062807010" onmouseenter="enter('-2271119485062807010');" onmouseout="out('-2271119485062807010');" style=""> 371                     boolean isValidCause = false;                                                        </span>
<span class="-500838144782668299" onmouseenter="enter('-500838144782668299');" onmouseout="out('-500838144782668299');" style=""> 372                     Throwable cause = ex;                                                                </span>
<span class="1460063134918401876" onmouseenter="enter('1460063134918401876');" onmouseout="out('1460063134918401876');" style=""> 373                     while (!isValidCause) {                                                              </span>
<span class="4260495870590788788" onmouseenter="enter('4260495870590788788');" onmouseout="out('4260495870590788788');" style=""> 374                         if (cause.getClass().equals(LockAcquisitionException.class)) {                   </span>
<span class="-2629587088788625810" onmouseenter="enter('-2629587088788625810');" onmouseout="out('-2629587088788625810');" style=""> 375                             isValidCause = true;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376                         }                                                                                </span>
<span class="8625050852301041214" onmouseenter="enter('8625050852301041214');" onmouseout="out('8625050852301041214');" style=""> 377                         cause = cause.getCause();                                                        </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style=""> 378                         if (cause == null) {                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 379                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                     }                                                                                    </span>
<span class="617128514241385440" onmouseenter="enter('617128514241385440');" onmouseout="out('617128514241385440');" style=""> 382                     if (isValidCause) {                                                                  </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 383                         if (LOG.isInfoEnabled()) {                                                       </span>
<span class="-1515480896436827747" onmouseenter="enter('-1515480896436827747');" onmouseout="out('-1515480896436827747');" style=""><abbr title=" 384                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price again.&quot;);"> 384                             LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price agðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385                         }                                                                                </span>
<span class="-5133746822051192612" onmouseenter="enter('-5133746822051192612');" onmouseout="out('-5133746822051192612');" style=""> 386                         isValid = false;                                                                 </span>
<span class="4577651777641283233" onmouseenter="enter('4577651777641283233');" onmouseout="out('4577651777641283233');" style=""> 387                         if (retryCount &gt;= pricingRetryCountForLockFailure) {                             </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 388                             if (LOG.isInfoEnabled()) {                                                   </span>
<span class="8668513794109504150" onmouseenter="enter('8668513794109504150');" onmouseout="out('8668513794109504150');" style=""><abbr title=" 389                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; + retryCount + &quot;). Throwing exception.&quot;);"> 389                                 LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceedeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                             }                                                                            </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 391                             if (ex instanceof PricingException) {                                        </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 392                                 throw (PricingException) ex;                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 393                             } else {                                                                     </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 394                                 throw new PricingException(ex);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                             }                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 396                         } else {                                                                         </span>
<span class="-1359453246670658998" onmouseenter="enter('-1359453246670658998');" onmouseout="out('-1359453246670658998');" style=""> 397                             order = findOrderById(order.getId());                                        </span>
<span class="1564014130404929121" onmouseenter="enter('1564014130404929121');" onmouseout="out('1564014130404929121');" style=""> 398                             retryCount++;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399                         }                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 400                         try {                                                                            </span>
<span class="-1188508433081841324" onmouseenter="enter('-1188508433081841324');" onmouseout="out('-1188508433081841324');" style=""> 401                             Thread.sleep(pricingRetryWaitIntervalForLockFailure);                        </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style=""> 402                         } catch (Throwable e) {                                                          </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 403                             //do nothing                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 404                         }                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 405                     } else {                                                                             </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 406                         if (ex instanceof PricingException) {                                            </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 407                             throw (PricingException) ex;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 408                         } else {                                                                         </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 409                             throw new PricingException(ex);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411                     }                                                                                    </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 412                 } finally {                                                                              </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 413                     if (!autoFlushSaveCart) {                                                            </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 414                         session.setHibernateFlushMode(current);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417             }                                                                                            </span>
<span  style=""> 418                                                                                                          </span>
<span class="-3104014921676861204" onmouseenter="enter('-3104014921676861204');" onmouseout="out('-3104014921676861204');" style=""> 419             //make the final save of the priced order                                                    </span>
<span class="-5185576183489418340" onmouseenter="enter('-5185576183489418340');" onmouseout="out('-5185576183489418340');" style=""> 420             status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                     </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 421                                 TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);         </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 422             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 423             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 424             try {                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 425                 if (!autoFlushSaveCart) {                                                                </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 426                     //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 426                     //Performance measure. Hibernate will sometimes perform an autoflush when performing ðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 427                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 427                     //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 428                     //incorrect results because something has not been flushed to the database yet.      </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 429                     session.setHibernateFlushMode(FlushMode.MANUAL);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430                 }                                                                                        </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 431                 order = persist(order);                                                                  </span>
<span  style=""> 432                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 433                 if (extensionManager != null) {                                                          </span>
<span class="3957126338116198589" onmouseenter="enter('3957126338116198589');" onmouseout="out('3957126338116198589');" style=""> 434                     extensionManager.getProxy().attachAdditionalDataToOrder(order, priceOrder);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435                 }                                                                                        </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 436                 if (!autoFlushSaveCart) {                                                                </span>
<span class="-582956567966567765" onmouseenter="enter('-582956567966567765');" onmouseout="out('-582956567966567765');" style=""> 437                     session.setFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438                 }                                                                                        </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 439                 TransactionUtils.finalizeTransaction(status, transactionManager, false);                 </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 440             } catch (RuntimeException ex) {                                                              </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 441                 TransactionUtils.finalizeTransaction(status, transactionManager, true);                  </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 442                 throw ex;                                                                                </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 443             } finally {                                                                                  </span>
<span class="8320148466827839591" onmouseenter="enter('8320148466827839591');" onmouseout="out('8320148466827839591');" style=""> 444                 if (!autoFlushSaveCart &amp;&amp; !session.getFlushMode().equals(current)) {                     </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 445                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 447             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448         }                                                                                                </span>
<span  style=""> 449                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 450         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451     }                                                                                                    </span>
<span  style=""> 452                                                                                                          </span>
<span class="3548225205011979861" onmouseenter="enter('3548225205011979861');" onmouseout="out('3548225205011979861');" style=""> 453     // This method exists to provide OrderService methods the ability to save an order                   </span>
<span class="-3137042620959847201" onmouseenter="enter('-3137042620959847201');" onmouseout="out('-3137042620959847201');" style=""> 454     // without having to worry about a PricingException being thrown.                                    </span>
<span class="-8294379095766791864" onmouseenter="enter('-8294379095766791864');" onmouseout="out('-8294379095766791864');" style=""> 455     protected Order persist(Order order) {                                                               </span>
<span class="8818772614490614908" onmouseenter="enter('8818772614490614908');" onmouseout="out('8818772614490614908');" style=""> 456         return orderDao.save(order);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457     }                                                                                                    </span>
<span  style=""> 458                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 459     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 460     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="1194611983531410278" onmouseenter="enter('1194611983531410278');" onmouseout="out('1194611983531410278');" style=""> 461     public void cancelOrder(Order order) {                                                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 462         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463     }                                                                                                    </span>
<span  style=""> 464                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 465     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 466     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="3151062967360623973" onmouseenter="enter('3151062967360623973');" onmouseout="out('3151062967360623973');" style=""> 467     public void deleteOrder(Order order) {                                                               </span>
<span class="362561214599706117" onmouseenter="enter('362561214599706117');" onmouseout="out('362561214599706117');" style=""> 468         orderMultishipOptionService.deleteAllOrderMultishipOptions(order);                               </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 469         orderDao.delete(order);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470     }                                                                                                    </span>
<span  style=""> 471                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 472     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 473     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6908985997151819220" onmouseenter="enter('-6908985997151819220');" onmouseout="out('-6908985997151819220');" style=""><abbr title=" 474     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferException {"> 474     public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceptiðŸ”µ</abbr></span>
<span class="-6957816096303048614" onmouseenter="enter('-6957816096303048614');" onmouseout="out('-6957816096303048614');" style=""> 475         ArrayList&lt;OfferCode&gt; offerCodes = new ArrayList&lt;OfferCode&gt;();                                    </span>
<span class="-3489605780287301859" onmouseenter="enter('-3489605780287301859');" onmouseout="out('-3489605780287301859');" style=""> 476         offerCodes.add(offerCode);                                                                       </span>
<span class="5360942362216082169" onmouseenter="enter('5360942362216082169');" onmouseout="out('5360942362216082169');" style=""> 477         return addOfferCodes(order, offerCodes, priceOrder);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478     }                                                                                                    </span>
<span  style=""> 479                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 480     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 481     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6002760974922308486" onmouseenter="enter('-6002760974922308486');" onmouseout="out('-6002760974922308486');" style=""><abbr title=" 482     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingException, OfferException {"> 482     public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricinðŸ”µ</abbr></span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 483         preValidateCartOperation(order);                                                                 </span>
<span class="-6297044254079066685" onmouseenter="enter('-6297044254079066685');" onmouseout="out('-6297044254079066685');" style=""> 484         Set&lt;Offer&gt; addedOffers = offerService.getUniqueOffersFromOrder(order);                           </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 485         if (extensionManager != null) {                                                                  </span>
<span class="4843221393928633011" onmouseenter="enter('4843221393928633011');" onmouseout="out('4843221393928633011');" style=""> 486             extensionManager.getProxy().addOfferCodes(order, offerCodes, priceOrder);                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487         }                                                                                                </span>
<span class="-5013116012900958115" onmouseenter="enter('-5013116012900958115');" onmouseout="out('-5013116012900958115');" style=""> 488         if (offerCodes != null &amp;&amp; !offerCodes.isEmpty()) {                                               </span>
<span class="8649045155270180220" onmouseenter="enter('8649045155270180220');" onmouseout="out('8649045155270180220');" style=""> 489             for (OfferCode offerCode : offerCodes) {                                                     </span>
<span  style=""> 490                                                                                                          </span>
<span class="-7298696073195110538" onmouseenter="enter('-7298696073195110538');" onmouseout="out('-7298696073195110538');" style=""><abbr title=" 491                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) {"> 491                 if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOðŸ”µ</abbr></span>
<span class="6234350320401768221" onmouseenter="enter('6234350320401768221');" onmouseout="out('6234350320401768221');" style=""> 492                     throw new OfferAlreadyAddedException(&quot;The offer has already been added.&quot;);           </span>
<span class="-3830868071340909057" onmouseenter="enter('-3830868071340909057');" onmouseout="out('-3830868071340909057');" style=""> 493                 } else if (!offerService.verifyMaxCustomerUsageThreshold(order, offerCode)) {            </span>
<span class="4333070718197812940" onmouseenter="enter('4333070718197812940');" onmouseout="out('4333070718197812940');" style=""><abbr title=" 494                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maximum allowed number of times.&quot;);"> 494                     throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more thðŸ”µ</abbr></span>
<span class="-5924935946468451057" onmouseenter="enter('-5924935946468451057');" onmouseout="out('-5924935946468451057');" style=""> 495                 } else if (!offerCode.isActive() || !offerCode.getOffer().isActive()) {                  </span>
<span class="-5410451342198456207" onmouseenter="enter('-5410451342198456207');" onmouseout="out('-5410451342198456207');" style=""> 496                     throw new OfferExpiredException(&quot;The offer has expired.&quot;);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497                 }                                                                                        </span>
<span  style=""> 498                                                                                                          </span>
<span class="-8263838424494001377" onmouseenter="enter('-8263838424494001377');" onmouseout="out('-8263838424494001377');" style=""> 499                 order.getAddedOfferCodes().add(offerCode);                                               </span>
<span  style=""> 500                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 501             }                                                                                            </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 502             order = save(order, priceOrder);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503         }                                                                                                </span>
<span  style=""> 504                                                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 505         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506     }                                                                                                    </span>
<span  style=""> 507                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 508     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 509     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-8165165962317769711" onmouseenter="enter('-8165165962317769711');" onmouseout="out('-8165165962317769711');" style=""><abbr title=" 510     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException {"> 510     public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingExceðŸ”µ</abbr></span>
<span class="7292636042273352545" onmouseenter="enter('7292636042273352545');" onmouseout="out('7292636042273352545');" style=""> 511         order.getAddedOfferCodes().remove(offerCode);                                                    </span>
<span class="-7106254142148835248" onmouseenter="enter('-7106254142148835248');" onmouseout="out('-7106254142148835248');" style=""> 512         offerServiceExtensionManager.removeOfferCodeFromOrder(offerCode, order);                         </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 513         order = save(order, priceOrder);                                                                 </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 514         return order;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 517     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 518     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1709915701203298020" onmouseenter="enter('-1709915701203298020');" onmouseout="out('-1709915701203298020');" style=""> 519     public Order removeAllOfferCodes(Order order, boolean priceOrder) throws PricingException {          </span>
<span class="-6954607053476807171" onmouseenter="enter('-6954607053476807171');" onmouseout="out('-6954607053476807171');" style=""> 520          order.getAddedOfferCodes().clear();                                                             </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 521          order = save(order, priceOrder);                                                                </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 522          return order;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523     }                                                                                                    </span>
<span  style=""> 524                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 525     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 526     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 526     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="6605929857558449758" onmouseenter="enter('6605929857558449758');" onmouseout="out('6605929857558449758');" style=""> 527     public void setDeleteEmptyNamedOrders(boolean deleteEmptyNamedOrders) {                              </span>
<span class="-5922450764665272748" onmouseenter="enter('-5922450764665272748');" onmouseout="out('-5922450764665272748');" style=""> 528         this.deleteEmptyNamedOrders = deleteEmptyNamedOrders;                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529     }                                                                                                    </span>
<span  style=""> 530                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 531     @Override                                                                                            </span>
<span class="8809427274039428572" onmouseenter="enter('8809427274039428572');" onmouseout="out('8809427274039428572');" style=""> 532     public OrderItem findLastMatchingItem(Order order, Long skuId, Long productId) {                     </span>
<span class="3897119298100986011" onmouseenter="enter('3897119298100986011');" onmouseout="out('3897119298100986011');" style=""> 533         if (order.getOrderItems() != null) {                                                             </span>
<span class="3057467599356722650" onmouseenter="enter('3057467599356722650');" onmouseout="out('3057467599356722650');" style=""> 534             for (int i=(order.getOrderItems().size()-1); i &gt;= 0; i--) {                                  </span>
<span class="-8753960614479292481" onmouseenter="enter('-8753960614479292481');" onmouseout="out('-8753960614479292481');" style=""> 535                 OrderItem currentItem = (order.getOrderItems().get(i));                                  </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style=""> 536                 if (currentItem instanceof DiscreteOrderItem) {                                          </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style=""> 537                     DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                    </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 538                     if (skuId != null) {                                                                 </span>
<span class="-8668132489177117394" onmouseenter="enter('-8668132489177117394');" onmouseout="out('-8668132489177117394');" style=""><abbr title=" 539                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId())) {"> 539                         if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId()))ðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 540                             return discreteItem;                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541                         }                                                                                </span>
<span class="2262602886329333955" onmouseenter="enter('2262602886329333955');" onmouseout="out('2262602886329333955');" style=""><abbr title=" 542                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteItem.getProduct().getId())) {"> 542                     } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equalsðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 543                         return discreteItem;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544                     }                                                                                    </span>
<span  style=""> 545                                                                                                          </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style=""> 546                 } else if (currentItem instanceof BundleOrderItem) {                                     </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style=""> 547                     BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                          </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 548                     if (skuId != null) {                                                                 </span>
<span class="-2960070722540544872" onmouseenter="enter('-2960070722540544872');" onmouseout="out('-2960070722540544872');" style=""> 549                         if (bundleItem.getSku() != null &amp;&amp; skuId.equals(bundleItem.getSku().getId())) {  </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 550                             return bundleItem;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551                         }                                                                                </span>
<span class="2116719638664851076" onmouseenter="enter('2116719638664851076');" onmouseout="out('2116719638664851076');" style=""><abbr title=" 552                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItem.getProduct().getId())) {"> 552                     } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bðŸ”µ</abbr></span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 553                         return bundleItem;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 558         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559     }                                                                                                    </span>
<span  style=""> 560                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 561     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 562     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-6433964895207235713" onmouseenter="enter('-6433964895207235713');" onmouseout="out('-6433964895207235713');" style=""> 563     public Order confirmOrder(Order order) {                                                             </span>
<span class="9181791888739176058" onmouseenter="enter('9181791888739176058');" onmouseout="out('9181791888739176058');" style=""> 564         return orderDao.submitOrder(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565     }                                                                                                    </span>
<span  style=""> 566                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 567     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 568     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1196063989926378996" onmouseenter="enter('-1196063989926378996');" onmouseout="out('-1196063989926378996');" style=""><abbr title=" 569     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 569     public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartExcðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 570         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 571         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 572             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573         }                                                                                                </span>
<span class="6349420761965903996" onmouseenter="enter('6349420761965903996');" onmouseout="out('6349420761965903996');" style=""> 574         List&lt;OrderItem&gt; items = new ArrayList&lt;OrderItem&gt;(namedOrder.getOrderItems());                    </span>
<span  style=""> 575                                                                                                          </span>
<span class="6607428262094447152" onmouseenter="enter('6607428262094447152');" onmouseout="out('6607428262094447152');" style=""> 576         // Remove any order items that are children                                                      </span>
<span class="7631703850134052237" onmouseenter="enter('7631703850134052237');" onmouseout="out('7631703850134052237');" style=""> 577         CollectionUtils.filter(items,  new TypedPredicate&lt;OrderItem&gt;() {                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 578             @Override                                                                                    </span>
<span class="4901231018495450056" onmouseenter="enter('4901231018495450056');" onmouseout="out('4901231018495450056');" style=""> 579             public boolean eval(OrderItem orderItem) {                                                   </span>
<span class="-2481948952058789921" onmouseenter="enter('-2481948952058789921');" onmouseout="out('-2481948952058789921');" style=""> 580                 return orderItem.getParentOrderItem() == null;                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 582         });                                                                                              </span>
<span class="-4844745637831365496" onmouseenter="enter('-4844745637831365496');" onmouseout="out('-4844745637831365496');" style=""> 583         for (OrderItem item : items) {                                                                   </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 584             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 584             OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItemðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 585             cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                        </span>
<span  style=""> 586                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 587             if (moveNamedOrderItems) {                                                                   </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 588                 removeItem(namedOrder.getId(), item.getId(), false);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 589             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590         }                                                                                                </span>
<span  style=""> 591                                                                                                          </span>
<span class="-6527299291227137901" onmouseenter="enter('-6527299291227137901');" onmouseout="out('-6527299291227137901');" style=""> 592         if (deleteEmptyNamedOrders) {                                                                    </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 593             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594         }                                                                                                </span>
<span  style=""> 595                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 596         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597     }                                                                                                    </span>
<span  style=""> 598                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 599     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 600     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="486294103490899905" onmouseenter="enter('486294103490899905');" onmouseout="out('486294103490899905');" style=""><abbr title=" 601     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 601     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemovðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 602         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 603         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 604             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 605         }                                                                                                </span>
<span  style=""> 606                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 607         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 607         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 608         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 609                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 610         if (moveNamedOrderItems) {                                                                       </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 611             removeItem(namedOrder.getId(), item.getId(), false);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 612         }                                                                                                </span>
<span  style=""> 613                                                                                                          </span>
<span class="-3555431676535314681" onmouseenter="enter('-3555431676535314681');" onmouseout="out('-3555431676535314681');" style=""> 614         if (namedOrder.getOrderItems().size() == 0 &amp;&amp; deleteEmptyNamedOrders) {                          </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 615             cancelOrder(namedOrder);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616         }                                                                                                </span>
<span  style=""> 617                                                                                                          </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 618         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619     }                                                                                                    </span>
<span  style=""> 620                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 621     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 622     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="6073762115033780324" onmouseenter="enter('6073762115033780324');" onmouseout="out('6073762115033780324');" style=""><abbr title=" 623     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws RemoveFromCartException, AddToCartException, UpdateCartException {"> 623     public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrderðŸ”µ</abbr></span>
<span class="-6164187211557222893" onmouseenter="enter('-6164187211557222893');" onmouseout="out('-6164187211557222893');" style=""> 624         // Validate that the quantity requested makes sense                                              </span>
<span class="632487064450637769" onmouseenter="enter('632487064450637769');" onmouseout="out('632487064450637769');" style=""> 625         if (quantity &lt; 1 || quantity &gt; item.getQuantity()) {                                             </span>
<span class="9015263082333587317" onmouseenter="enter('9015263082333587317');" onmouseout="out('9015263082333587317');" style=""> 626             throw new IllegalArgumentException(&quot;Cannot move 0 or less quantity&quot;);                        </span>
<span class="5237951611682684444" onmouseenter="enter('5237951611682684444');" onmouseout="out('5237951611682684444');" style=""> 627         } else if (quantity == item.getQuantity()) {                                                     </span>
<span class="-6422299663726892430" onmouseenter="enter('-6422299663726892430');" onmouseout="out('-6422299663726892430');" style=""> 628             return addItemFromNamedOrder(namedOrder, item, priceOrder);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 629         }                                                                                                </span>
<span  style=""> 630                                                                                                          </span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 631         Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                        </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 632         if (cartOrder == null) {                                                                         </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 633             cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634         }                                                                                                </span>
<span  style=""> 635                                                                                                          </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""><abbr title=" 636         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);"> 636         OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(iteðŸ”µ</abbr></span>
<span class="8127078771873751614" onmouseenter="enter('8127078771873751614');" onmouseout="out('8127078771873751614');" style=""> 637         orderItemRequest.setQuantity(quantity);                                                          </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 638         cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                            </span>
<span  style=""> 639                                                                                                          </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 640         if (moveNamedOrderItems) {                                                                       </span>
<span class="-1872324351499578531" onmouseenter="enter('-1872324351499578531');" onmouseout="out('-1872324351499578531');" style=""> 641             // Update the old item to its new quantity only if we&#x27;re moving items                        </span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 642             OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                         </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 643             orderItemRequestDTO.setOrderItemId(item.getId());                                            </span>
<span class="2294188755442690225" onmouseenter="enter('2294188755442690225');" onmouseout="out('2294188755442690225');" style=""> 644             orderItemRequestDTO.setQuantity(item.getQuantity() - quantity);                              </span>
<span class="4972493477102298628" onmouseenter="enter('4972493477102298628');" onmouseout="out('4972493477102298628');" style=""> 645             updateItemQuantity(namedOrder.getId(), orderItemRequestDTO, false);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646         }                                                                                                </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 647         return cartOrder;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 648     }                                                                                                    </span>
<span  style=""> 649                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 650     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 651     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1212731706886603863" onmouseenter="enter('-1212731706886603863');" onmouseout="out('-1212731706886603863');" style=""><abbr title=" 652     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder) throws PricingException {"> 652     public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean prðŸ”µ</abbr></span>
<span class="6582622510368580131" onmouseenter="enter('6582622510368580131');" onmouseout="out('6582622510368580131');" style=""> 653         GiftWrapOrderItem item = orderItemService.createGiftWrapOrderItem(itemRequest);                  </span>
<span class="-474933544378469288" onmouseenter="enter('-474933544378469288');" onmouseout="out('-474933544378469288');" style=""> 654         item.setOrder(order);                                                                            </span>
<span class="-5871784861123565961" onmouseenter="enter('-5871784861123565961');" onmouseout="out('-5871784861123565961');" style=""> 655         item = (GiftWrapOrderItem) orderItemService.saveOrderItem(item);                                 </span>
<span  style=""> 656                                                                                                          </span>
<span class="6197964192831249775" onmouseenter="enter('6197964192831249775');" onmouseout="out('6197964192831249775');" style=""> 657         order.getOrderItems().add(item);                                                                 </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 658         order = save(order, priceOrder);                                                                 </span>
<span  style=""> 659                                                                                                          </span>
<span class="-3331987500944083076" onmouseenter="enter('-3331987500944083076');" onmouseout="out('-3331987500944083076');" style=""> 660         return item;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661     }                                                                                                    </span>
<span  style=""> 662                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 663     @Override                                                                                            </span>
<span class="684519713081169381" onmouseenter="enter('684519713081169381');" onmouseout="out('684519713081169381');" style=""> 664     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {AddToCartException.class})             </span>
<span class="4069854779845915812" onmouseenter="enter('4069854779845915812');" onmouseout="out('4069854779845915812');" style=""><abbr title=" 665     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 665     public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throwðŸ”µ</abbr></span>
<span class="-1143974214922837949" onmouseenter="enter('-1143974214922837949');" onmouseout="out('-1143974214922837949');" style=""> 666         // Don&#x27;t allow overrides from this method.                                                       </span>
<span class="8194194096343660389" onmouseenter="enter('8194194096343660389');" onmouseout="out('8194194096343660389');" style=""> 667         orderItemRequestDTO.setOverrideRetailPrice(null);                                                </span>
<span class="-5206909193534990943" onmouseenter="enter('-5206909193534990943');" onmouseout="out('-5206909193534990943');" style=""> 668         orderItemRequestDTO.setOverrideSalePrice(null);                                                  </span>
<span class="-7735674882921518291" onmouseenter="enter('-7735674882921518291');" onmouseout="out('-7735674882921518291');" style=""> 669         return addItemWithPriceOverrides(orderId, orderItemRequestDTO, priceOrder);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 670     }                                                                                                    </span>
<span  style=""> 671                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 672     @Override                                                                                            </span>
<span class="-670805249178869687" onmouseenter="enter('-670805249178869687');" onmouseout="out('-670805249178869687');" style=""> 673     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { AddToCartException.class })           </span>
<span class="2295594549845892145" onmouseenter="enter('2295594549845892145');" onmouseout="out('2295594549845892145');" style=""><abbr title=" 674     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 674     public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleanðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 675         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 676         preValidateCartOperation(order);                                                                 </span>
<span class="2914653273227801204" onmouseenter="enter('2914653273227801204');" onmouseout="out('2914653273227801204');" style=""> 677         if (getAutomaticallyMergeLikeItems()) {                                                          </span>
<span class="-1260995424369374686" onmouseenter="enter('-1260995424369374686');" onmouseout="out('-1260995424369374686');" style=""> 678             OrderItem item = findMatchingItem(order, orderItemRequestDTO);                               </span>
<span class="-4741837152748801640" onmouseenter="enter('-4741837152748801640');" onmouseout="out('-4741837152748801640');" style=""> 679             if (item != null &amp;&amp; item.getParentOrderItem() == null) {                                     </span>
<span class="8907881414365549792" onmouseenter="enter('8907881414365549792');" onmouseout="out('8907881414365549792');" style=""> 680                 orderItemRequestDTO.setQuantity(item.getQuantity() + orderItemRequestDTO.getQuantity()); </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 681                 orderItemRequestDTO.setOrderItemId(item.getId());                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 682                 try {                                                                                    </span>
<span class="-1392380570648359537" onmouseenter="enter('-1392380570648359537');" onmouseout="out('-1392380570648359537');" style=""> 683                     return updateItemQuantity(orderId, orderItemRequestDTO, priceOrder);                 </span>
<span class="2264439919030346254" onmouseenter="enter('2264439919030346254');" onmouseout="out('2264439919030346254');" style=""> 684                 } catch (RemoveFromCartException e) {                                                    </span>
<span class="3695461348108676960" onmouseenter="enter('3695461348108676960');" onmouseout="out('3695461348108676960');" style=""><abbr title=" 685                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cart&quot;, e);"> 685                     throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adðŸ”µ</abbr></span>
<span class="-268181248887409465" onmouseenter="enter('-268181248887409465');" onmouseout="out('-268181248887409465');" style=""> 686                 } catch (UpdateCartException e) {                                                        </span>
<span class="9009836242172298460" onmouseenter="enter('9009836242172298460');" onmouseout="out('9009836242172298460');" style=""> 687                     throw new AddToCartException(&quot;Could not update quantity for matched item&quot;, e);       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 688                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 689             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690         }                                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 691         try {                                                                                            </span>
<span class="5353648265182308095" onmouseenter="enter('5353648265182308095');" onmouseout="out('5353648265182308095');" style=""><abbr title=" 692             // We only want to price on the last addition for performance reasons and only if the user asked for it."> 692             // We only want to price on the last addition for performance reasons and only if the user asðŸ”µ</abbr></span>
<span class="4429210190612929719" onmouseenter="enter('4429210190612929719');" onmouseout="out('4429210190612929719');" style=""> 693             int numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO)) : -1;  </span>
<span class="94226225238380310" onmouseenter="enter('94226225238380310');" onmouseout="out('94226225238380310');" style=""> 694             int currentAddition = 1;                                                                     </span>
<span  style=""> 695                                                                                                          </span>
<span class="3086923041990690310" onmouseenter="enter('3086923041990690310');" onmouseout="out('3086923041990690310');" style=""><abbr title=" 696             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, currentAddition == numAdditionRequests);"> 696             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span  style=""> 697                                                                                                          </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 698             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 699             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 700             if (!autoFlushAddToCart) {                                                                   </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 701                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 701                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 702                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 702                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 703                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 704                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 706             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 707             try {                                                                                        </span>
<span class="1764939006998328340" onmouseenter="enter('1764939006998328340');" onmouseout="out('1764939006998328340');" style=""><abbr title=" 708                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequest);"> 708                 context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequeðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 709             } finally {                                                                                  </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 710                 if (!autoFlushAddToCart) {                                                               </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 711                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 713             }                                                                                            </span>
<span  style=""> 714                                                                                                          </span>
<span class="-507750410624174489" onmouseenter="enter('-507750410624174489');" onmouseout="out('-507750410624174489');" style=""> 715             List&lt;ActivityMessageDTO&gt; orderMessages = new ArrayList&lt;ActivityMessageDTO&gt;();                </span>
<span class="-9090729846937660303" onmouseenter="enter('-9090729846937660303');" onmouseout="out('-9090729846937660303');" style=""> 716             orderMessages.addAll(((ActivityMessages) context).getActivityMessages());                    </span>
<span  style=""> 717                                                                                                          </span>
<span class="7756277132938928975" onmouseenter="enter('7756277132938928975');" onmouseout="out('7756277132938928975');" style=""> 718             // Update the orderItemRequest incase it changed during the initial add to cart workflow     </span>
<span class="-7203895251723249067" onmouseenter="enter('-7203895251723249067');" onmouseout="out('-7203895251723249067');" style=""> 719             orderItemRequestDTO = context.getSeedData().getItemRequest();                                </span>
<span class="4534199544912449864" onmouseenter="enter('4534199544912449864');" onmouseout="out('4534199544912449864');" style=""> 720             numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO) - 1) : -1;  </span>
<span class="4780820064776482606" onmouseenter="enter('4780820064776482606');" onmouseout="out('4780820064776482606');" style=""><abbr title=" 721             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessages);"> 721             addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessagðŸ”µ</abbr></span>
<span  style=""> 722                                                                                                          </span>
<span class="-2935463552695848258" onmouseenter="enter('-2935463552695848258');" onmouseout="out('-2935463552695848258');" style=""> 723             context.getSeedData().getOrder().setOrderMessages(orderMessages);                            </span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 724             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 725         } catch (WorkflowException e) {                                                                  </span>
<span class="-1335771490090575105" onmouseenter="enter('-1335771490090575105');" onmouseout="out('-1335771490090575105');" style=""> 726             throw new AddToCartException(&quot;Could not add to cart&quot;, getCartOperationExceptionRootCause(e));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727         }                                                                                                </span>
<span  style=""> 728                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729     }                                                                                                    </span>
<span  style=""> 730                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 731     @Override                                                                                            </span>
<span class="-3516024114449400059" onmouseenter="enter('-3516024114449400059');" onmouseout="out('-3516024114449400059');" style=""> 732     public int getTotalChildOrderItems(OrderItemRequestDTO orderItemRequestDTO) {                        </span>
<span class="-4883106140571490694" onmouseenter="enter('-4883106140571490694');" onmouseout="out('-4883106140571490694');" style=""> 733         int count = 1;                                                                                   </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 734         for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {              </span>
<span class="-8452259100874171936" onmouseenter="enter('-8452259100874171936');" onmouseout="out('-8452259100874171936');" style=""> 735             count += getTotalChildOrderItems(childRequest);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 736         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 737         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738     }                                                                                                    </span>
<span  style=""> 739                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 740     @Override                                                                                            </span>
<span class="6996885202551649754" onmouseenter="enter('6996885202551649754');" onmouseout="out('6996885202551649754');" style=""><abbr title=" 741     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAddition, ProcessContext&lt;CartOperationRequest&gt; context, List&lt;ActivityMessageDTO&gt; orderMessages) throws WorkflowException {"> 741     public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int curreðŸ”µ</abbr></span>
<span class="8934449600530371968" onmouseenter="enter('8934449600530371968');" onmouseout="out('8934449600530371968');" style=""> 742         if (CollectionUtils.isNotEmpty(orderItemRequestDTO.getChildOrderItems())) {                      </span>
<span class="2491660913208132768" onmouseenter="enter('2491660913208132768');" onmouseout="out('2491660913208132768');" style=""> 743             Long parentOrderItemId = context.getSeedData().getOrderItem().getId();                       </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 744             for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {          </span>
<span class="3535307469424733623" onmouseenter="enter('3535307469424733623');" onmouseout="out('3535307469424733623');" style=""> 745                 childRequest.setParentOrderItemId(parentOrderItemId);                                    </span>
<span class="-1408015228336766113" onmouseenter="enter('-1408015228336766113');" onmouseout="out('-1408015228336766113');" style=""> 746                 currentAddition++;                                                                       </span>
<span  style=""> 747                                                                                                          </span>
<span class="-8953231422270651058" onmouseenter="enter('-8953231422270651058');" onmouseout="out('-8953231422270651058');" style=""> 748                 if (childRequest.getQuantity() &gt; 0) {                                                    </span>
<span class="1978205204114939470" onmouseenter="enter('1978205204114939470');" onmouseout="out('1978205204114939470');" style=""><abbr title=" 749                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrder(), childRequest, currentAddition == numAdditionRequests);"> 749                     CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedDatðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 750                     Session session = em.unwrap(Session.class);                                          </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 751                     FlushMode current = session.getHibernateFlushMode();                                 </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 752                     if (!autoFlushAddToCart) {                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 753                         //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 753                         //Performance measure. Hibernate will sometimes perform an autoflush when performðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 754                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 754                         //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern aboutðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 755                         //incorrect results because something has not been flushed to the database yet.  </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 756                         session.setHibernateFlushMode(FlushMode.MANUAL);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 757                     }                                                                                    </span>
<span class="174091692271706246" onmouseenter="enter('174091692271706246');" onmouseout="out('174091692271706246');" style=""> 758                     ProcessContext&lt;CartOperationRequest&gt; childContext;                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 759                     try {                                                                                </span>
<span class="3858921168069452982" onmouseenter="enter('3858921168069452982');" onmouseout="out('3858921168069452982');" style=""><abbr title=" 760                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCartOpRequest);"> 760                         childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivitieðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 761                     } finally {                                                                          </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 762                         if (!autoFlushAddToCart) {                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 763                             session.setHibernateFlushMode(current);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 764                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 765                     }                                                                                    </span>
<span class="4342049387377288099" onmouseenter="enter('4342049387377288099');" onmouseout="out('4342049387377288099');" style=""> 766                     orderMessages.addAll(((ActivityMessages) childContext).getActivityMessages());       </span>
<span  style=""> 767                                                                                                          </span>
<span class="5649628204352445838" onmouseenter="enter('5649628204352445838');" onmouseout="out('5649628204352445838');" style=""><abbr title=" 768                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages);"> 768                     addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 769                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 770             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 771         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772     }                                                                                                    </span>
<span  style=""> 773                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 774     @Override                                                                                            </span>
<span class="-7880503742615035959" onmouseenter="enter('-7880503742615035959');" onmouseout="out('-7880503742615035959');" style=""><abbr title=" 775     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrderItem) {"> 775     public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO depðŸ”µ</abbr></span>
<span class="7029662020876668277" onmouseenter="enter('7029662020876668277');" onmouseout="out('7029662020876668277');" style=""> 776         parentOrderItemRequest.getChildOrderItems().add(dependentOrderItem);                             </span>
<span class="-5858860779658693712" onmouseenter="enter('-5858860779658693712');" onmouseout="out('-5858860779658693712');" style=""><abbr title=" 777         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;() {"> 777         Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;ðŸ”µ</abbr></span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 778             @Override                                                                                    </span>
<span class="-2632323703231374544" onmouseenter="enter('-2632323703231374544');" onmouseout="out('-2632323703231374544');" style=""> 779             public int compare(OrderItemRequestDTO o1, OrderItemRequestDTO o2) {                         </span>
<span class="-7086966684703257080" onmouseenter="enter('-7086966684703257080');" onmouseout="out('-7086966684703257080');" style=""><abbr title=" 780                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 780                 BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="2876551709679172033" onmouseenter="enter('2876551709679172033');" onmouseout="out('2876551709679172033');" style=""><abbr title=" 781                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));"> 781                 BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayðŸ”µ</abbr></span>
<span class="-3284317440061231656" onmouseenter="enter('-3284317440061231656');" onmouseout="out('-3284317440061231656');" style=""> 782                 return o1DisplayOrder.compareTo(o2DisplayOrder);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 783             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 784         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785     }                                                                                                    </span>
<span  style=""> 786                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 787     @Override                                                                                            </span>
<span class="-2531899947398484803" onmouseenter="enter('-2531899947398484803');" onmouseout="out('-2531899947398484803');" style=""><abbr title=" 788     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartException.class})"> 788     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCaðŸ”µ</abbr></span>
<span class="5266336311751039225" onmouseenter="enter('5266336311751039225');" onmouseout="out('5266336311751039225');" style=""><abbr title=" 789     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException, RemoveFromCartException {"> 789     public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 790         Order order = findOrderById(orderId);                                                            </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 791         preValidateCartOperation(order);                                                                 </span>
<span class="8786950828376343914" onmouseenter="enter('8786950828376343914');" onmouseout="out('8786950828376343914');" style=""> 792         preValidateUpdateQuantityOperation(findOrderById(orderId), orderItemRequestDTO);                 </span>
<span class="-2982195349177348585" onmouseenter="enter('-2982195349177348585');" onmouseout="out('-2982195349177348585');" style=""> 793         if (orderItemRequestDTO.getQuantity() == 0) {                                                    </span>
<span class="5934987267424355703" onmouseenter="enter('5934987267424355703');" onmouseout="out('5934987267424355703');" style=""> 794             return removeItem(orderId, orderItemRequestDTO.getOrderItemId(), priceOrder);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 795         }                                                                                                </span>
<span  style=""> 796                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 797         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 798             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 798             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 799             Session session = em.unwrap(Session.class);                                                  </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 800             FlushMode current = session.getHibernateFlushMode();                                         </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 801             if (!autoFlushUpdateCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 802                 //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 802                 //Performance measure. Hibernate will sometimes perform an autoflush when performing querðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 803                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 803                 //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queriesðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 804                 //incorrect results because something has not been flushed to the database yet.          </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 805                 session.setHibernateFlushMode(FlushMode.MANUAL);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 806             }                                                                                            </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 807             ProcessContext&lt;CartOperationRequest&gt; context;                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 808             try {                                                                                        </span>
<span class="4428072604906913766" onmouseenter="enter('4428072604906913766');" onmouseout="out('4428072604906913766');" style=""><abbr title=" 809                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpRequest);"> 809                 context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpReðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 810             } finally {                                                                                  </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 811                 if (!autoFlushUpdateCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 812                     session.setHibernateFlushMode(current);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 813                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 814             }                                                                                            </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 815             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 815             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 816             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 817         } catch (WorkflowException e) {                                                                  </span>
<span class="-2443073899933101644" onmouseenter="enter('-2443073899933101644');" onmouseout="out('-2443073899933101644');" style=""><abbr title=" 818             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e));"> 818             throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820     }                                                                                                    </span>
<span  style=""> 821                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 822     @Override                                                                                            </span>
<span class="3069128547561385261" onmouseenter="enter('3069128547561385261');" onmouseout="out('3069128547561385261');" style=""> 823     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {RemoveFromCartException.class})        </span>
<span class="-981474137904562454" onmouseenter="enter('-981474137904562454');" onmouseout="out('-981474137904562454');" style=""><abbr title=" 824     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartException {"> 824     public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartExceðŸ”µ</abbr></span>
<span class="2236102352074340212" onmouseenter="enter('2236102352074340212');" onmouseout="out('2236102352074340212');" style=""> 825         preValidateCartOperation(findOrderById(orderId));                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 826         try {                                                                                            </span>
<span class="-4288344051642570030" onmouseenter="enter('-4288344051642570030');" onmouseout="out('-4288344051642570030');" style=""> 827             OrderItem oi = orderItemService.readOrderItemById(orderItemId);                              </span>
<span class="-5187230272054076771" onmouseenter="enter('-5187230272054076771');" onmouseout="out('-5187230272054076771');" style=""> 828             if (oi == null) {                                                                            </span>
<span class="3942058861960606340" onmouseenter="enter('3942058861960606340');" onmouseout="out('3942058861960606340');" style=""> 829                 throw new WorkflowException(new ItemNotFoundException());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830             }                                                                                            </span>
<span class="3816340933425228129" onmouseenter="enter('3816340933425228129');" onmouseout="out('3816340933425228129');" style=""> 831             List&lt;Long&gt; childrenToRemove = new ArrayList&lt;Long&gt;();                                         </span>
<span class="-1993098536099392813" onmouseenter="enter('-1993098536099392813');" onmouseout="out('-1993098536099392813');" style=""> 832             if (oi instanceof BundleOrderItem) {                                                         </span>
<span class="7271984761308517823" onmouseenter="enter('7271984761308517823');" onmouseout="out('7271984761308517823');" style=""> 833                 List&lt;DiscreteOrderItem&gt; bundledItems = ((BundleOrderItem) oi).getDiscreteOrderItems();   </span>
<span class="7517044148543156187" onmouseenter="enter('7517044148543156187');" onmouseout="out('7517044148543156187');" style=""> 834                 for (DiscreteOrderItem doi : bundledItems) {                                             </span>
<span class="7367293631145453975" onmouseenter="enter('7367293631145453975');" onmouseout="out('7367293631145453975');" style=""> 835                     findAllChildrenToRemove(childrenToRemove, doi);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 837             } else {                                                                                     </span>
<span class="872231159337938033" onmouseenter="enter('872231159337938033');" onmouseout="out('872231159337938033');" style=""> 838                 findAllChildrenToRemove(childrenToRemove, oi);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839             }                                                                                            </span>
<span class="-8102792542621025713" onmouseenter="enter('-8102792542621025713');" onmouseout="out('-8102792542621025713');" style=""> 840             for (Long childToRemove : childrenToRemove) {                                                </span>
<span class="8117841110711526180" onmouseenter="enter('8117841110711526180');" onmouseout="out('8117841110711526180');" style=""> 841                 removeItemInternal(orderId, childToRemove, false);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 842             }                                                                                            </span>
<span  style=""> 843                                                                                                          </span>
<span class="-2688850311015489500" onmouseenter="enter('-2688850311015489500');" onmouseout="out('-2688850311015489500');" style=""> 844             return removeItemInternal(orderId, orderItemId, priceOrder);                                 </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 845         } catch (WorkflowException e) {                                                                  </span>
<span class="2503031575434857017" onmouseenter="enter('2503031575434857017');" onmouseout="out('2503031575434857017');" style=""><abbr title=" 846             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e));"> 846             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 848     }                                                                                                    </span>
<span  style=""> 849                                                                                                          </span>
<span class="-7053318232843416816" onmouseenter="enter('-7053318232843416816');" onmouseout="out('-7053318232843416816');" style=""> 850     protected void findAllChildrenToRemove(List&lt;Long&gt; childrenToRemove, OrderItem orderItem){            </span>
<span class="-8605703698739650954" onmouseenter="enter('-8605703698739650954');" onmouseout="out('-8605703698739650954');" style=""> 851         if (CollectionUtils.isNotEmpty(orderItem.getChildOrderItems())) {                                </span>
<span class="-4353610703709163867" onmouseenter="enter('-4353610703709163867');" onmouseout="out('-4353610703709163867');" style=""> 852             for (OrderItem childOrderItem : orderItem.getChildOrderItems()) {                            </span>
<span class="-6344861684690798964" onmouseenter="enter('-6344861684690798964');" onmouseout="out('-6344861684690798964');" style=""> 853                 findAllChildrenToRemove(childrenToRemove, childOrderItem);                               </span>
<span class="-4081734193801812324" onmouseenter="enter('-4081734193801812324');" onmouseout="out('-4081734193801812324');" style=""> 854                 childrenToRemove.add(childOrderItem.getId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 857     }                                                                                                    </span>
<span  style=""> 858                                                                                                          </span>
<span class="-9213800711467029414" onmouseenter="enter('-9213800711467029414');" onmouseout="out('-9213800711467029414');" style=""><abbr title=" 859     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowException {"> 859     protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkfloðŸ”µ</abbr></span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 860         OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                             </span>
<span class="279907255180715291" onmouseenter="enter('279907255180715291');" onmouseout="out('279907255180715291');" style=""> 861         orderItemRequestDTO.setOrderItemId(orderItemId);                                                 </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 862         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 862         CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemReðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 863         Session session = em.unwrap(Session.class);                                                      </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 864         FlushMode current = session.getHibernateFlushMode();                                             </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 865         if (!autoFlushRemoveFromCart) {                                                                  </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 866             //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 866             //Performance measure. Hibernate will sometimes perform an autoflush when performing query opðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 867             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 867             //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 868             //incorrect results because something has not been flushed to the database yet.              </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 869             session.setHibernateFlushMode(FlushMode.MANUAL);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 870         }                                                                                                </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 871         ProcessContext&lt;CartOperationRequest&gt; context;                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 872         try {                                                                                            </span>
<span class="1281982438499352462" onmouseenter="enter('1281982438499352462');" onmouseout="out('1281982438499352462');" style=""><abbr title=" 873             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequest);"> 873             context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequesðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 874         } finally {                                                                                      </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 875             if (!autoFlushRemoveFromCart) {                                                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 876                 session.setHibernateFlushMode(current);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878         }                                                                                                </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 879         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 879         context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActiviðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 880         return context.getSeedData().getOrder();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 881     }                                                                                                    </span>
<span  style=""> 882                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 883     @Override                                                                                            </span>
<span class="4101768281683729634" onmouseenter="enter('4101768281683729634');" onmouseout="out('4101768281683729634');" style=""> 884     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { RemoveFromCartException.class })      </span>
<span class="-3452873837479924235" onmouseenter="enter('-3452873837479924235');" onmouseout="out('-3452873837479924235');" style=""> 885     public Order removeInactiveItems(Long orderId, boolean priceOrder) throws RemoveFromCartException {  </span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 886         Order order = findOrderById(orderId);                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 887         try {                                                                                            </span>
<span  style=""> 888                                                                                                          </span>
<span class="-3956255490326849696" onmouseenter="enter('-3956255490326849696');" onmouseout="out('-3956255490326849696');" style=""> 889             for (OrderItem currentItem : new ArrayList&lt;OrderItem&gt;(order.getOrderItems())) {              </span>
<span class="-219225588148279740" onmouseenter="enter('-219225588148279740');" onmouseout="out('-219225588148279740');" style=""> 890                 if (!currentItem.isSkuActive()) {                                                        </span>
<span class="-2073025095864158325" onmouseenter="enter('-2073025095864158325');" onmouseout="out('-2073025095864158325');" style=""> 891                     removeItem(orderId, currentItem.getId(), priceOrder);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 892                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 893             }                                                                                            </span>
<span  style=""> 894                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 895         } catch (Exception e) {                                                                          </span>
<span class="9087614266041334113" onmouseenter="enter('9087614266041334113');" onmouseout="out('9087614266041334113');" style=""> 896             throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, e.getCause());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897         }                                                                                                </span>
<span class="6784501458837890045" onmouseenter="enter('6784501458837890045');" onmouseout="out('6784501458837890045');" style=""> 898         return findOrderById(orderId);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 899     }                                                                                                    </span>
<span  style=""> 900                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 901     @Override                                                                                            </span>
<span class="-2286265725818600106" onmouseenter="enter('-2286265725818600106');" onmouseout="out('-2286265725818600106');" style=""> 902     public boolean getAutomaticallyMergeLikeItems() {                                                    </span>
<span  style=""> 903                                                                                                          </span>
<span class="-8256644627815125391" onmouseenter="enter('-8256644627815125391');" onmouseout="out('-8256644627815125391');" style=""> 904         if (automaticallyMergeLikeItems != null) {                                                       </span>
<span class="2771319092236636517" onmouseenter="enter('2771319092236636517');" onmouseout="out('2771319092236636517');" style=""> 905             return automaticallyMergeLikeItems;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 906         }                                                                                                </span>
<span  style=""> 907                                                                                                          </span>
<span class="-661470022029899741" onmouseenter="enter('-661470022029899741');" onmouseout="out('-661470022029899741');" style=""> 908         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;automatically.merge.like.items&quot;, true);   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 909     }                                                                                                    </span>
<span  style=""> 910                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 911     @Override                                                                                            </span>
<span class="8909461220693294113" onmouseenter="enter('8909461220693294113');" onmouseout="out('8909461220693294113');" style=""> 912     public void setAutomaticallyMergeLikeItems(boolean automaticallyMergeLikeItems) {                    </span>
<span class="5376880332914447533" onmouseenter="enter('5376880332914447533');" onmouseout="out('5376880332914447533');" style=""> 913         this.automaticallyMergeLikeItems = automaticallyMergeLikeItems;                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 914     }                                                                                                    </span>
<span  style=""> 915                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 916     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 917     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 917     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="3855774874983732975" onmouseenter="enter('3855774874983732975');" onmouseout="out('3855774874983732975');" style=""> 918     public boolean isMoveNamedOrderItems() {                                                             </span>
<span class="-6652636869592443054" onmouseenter="enter('-6652636869592443054');" onmouseout="out('-6652636869592443054');" style=""> 919         return moveNamedOrderItems;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 920     }                                                                                                    </span>
<span  style=""> 921                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 922     @Override                                                                                            </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 923     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 923     @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, curðŸ”µ</abbr></span>
<span class="-1545993285048257021" onmouseenter="enter('-1545993285048257021');" onmouseout="out('-1545993285048257021');" style=""> 924     public void setMoveNamedOrderItems(boolean moveNamedOrderItems) {                                    </span>
<span class="-5896321919466635220" onmouseenter="enter('-5896321919466635220');" onmouseout="out('-5896321919466635220');" style=""> 925         this.moveNamedOrderItems = moveNamedOrderItems;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926     }                                                                                                    </span>
<span  style=""> 927                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 928     @Override                                                                                            </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 929     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 929     @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, cuðŸ”µ</abbr></span>
<span class="-1003289588467041676" onmouseenter="enter('-1003289588467041676');" onmouseout="out('-1003289588467041676');" style=""> 930     public boolean isDeleteEmptyNamedOrders() {                                                          </span>
<span class="-7878461261897242645" onmouseenter="enter('-7878461261897242645');" onmouseout="out('-7878461261897242645');" style=""> 931         return deleteEmptyNamedOrders;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 932     }                                                                                                    </span>
<span  style=""> 933                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 934     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 935     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-137537618393378808" onmouseenter="enter('-137537618393378808');" onmouseout="out('-137537618393378808');" style=""> 936     public void removeAllPaymentsFromOrder(Order order) {                                                </span>
<span class="3869583275658522189" onmouseenter="enter('3869583275658522189');" onmouseout="out('3869583275658522189');" style=""> 937         removePaymentsFromOrder(order, null);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938     }                                                                                                    </span>
<span  style=""> 939                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 940     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 941     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-1085850343810485193" onmouseenter="enter('-1085850343810485193');" onmouseout="out('-1085850343810485193');" style=""> 942     public void removePaymentsFromOrder(Order order, PaymentType paymentInfoType) {                      </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 943         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 944         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-6057897724905909333" onmouseenter="enter('-6057897724905909333');" onmouseout="out('-6057897724905909333');" style=""> 945             if (paymentInfoType == null || paymentInfoType.equals(paymentInfo.getType())) {              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 946                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 948         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 949         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 950         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 951             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 952                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 952                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 953             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 954                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 955                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 956             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 957             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 958             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 959             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 960         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961     }                                                                                                    </span>
<span  style=""> 962                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 963     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 964     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-609061517129084855" onmouseenter="enter('-609061517129084855');" onmouseout="out('-609061517129084855');" style=""> 965     public void removeCreditCardPaymentsFromOrder(Order order) {                                         </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 966         List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                        </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 967         for (OrderPayment paymentInfo : order.getPayments()) {                                           </span>
<span class="-8966393542166440080" onmouseenter="enter('-8966393542166440080');" onmouseout="out('-8966393542166440080');" style=""> 968             if (paymentInfo.getType().isCreditCardType()) {                                              </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 969                 infos.add(paymentInfo);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 970             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 971         }                                                                                                </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 972         order.getPayments().removeAll(infos);                                                            </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 973         for (OrderPayment paymentInfo : infos) {                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 974             try {                                                                                        </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 975                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 975                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(),ðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 976             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 977                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 978                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979             }                                                                                            </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 980             order.getPayments().remove(paymentInfo);                                                     </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 981             paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                               </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 982             paymentDao.delete(paymentInfo);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 983         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984     }                                                                                                    </span>
<span  style=""> 985                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 986     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 987     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="5110157232144308056" onmouseenter="enter('5110157232144308056');" onmouseout="out('5110157232144308056');" style=""> 988     public void removePaymentFromOrder(Order order, OrderPayment payment){                               </span>
<span class="-7148196279117480431" onmouseenter="enter('-7148196279117480431');" onmouseout="out('-7148196279117480431');" style=""> 989         OrderPayment paymentToRemove = null;                                                             </span>
<span class="-5892743526096946795" onmouseenter="enter('-5892743526096946795');" onmouseout="out('-5892743526096946795');" style=""> 990         for (OrderPayment info : order.getPayments()){                                                   </span>
<span class="-230615801168440856" onmouseenter="enter('-230615801168440856');" onmouseout="out('-230615801168440856');" style=""> 991             if (info.equals(payment)){                                                                   </span>
<span class="2491921736483213892" onmouseenter="enter('2491921736483213892');" onmouseout="out('2491921736483213892');" style=""> 992                 paymentToRemove = info;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 993             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 994         }                                                                                                </span>
<span class="-1581714824919605857" onmouseenter="enter('-1581714824919605857');" onmouseout="out('-1581714824919605857');" style=""> 995         if (paymentToRemove != null){                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 996             try {                                                                                        </span>
<span class="1303373247725909249" onmouseenter="enter('1303373247725909249');" onmouseout="out('1303373247725909249');" style=""><abbr title=" 997                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), payment.getType());"> 997                 securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumbeðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 998             } catch (WorkflowException e) {                                                              </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 999                 // do nothing--this is an acceptable condition                                           </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style="">1000                 LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1001             }                                                                                            </span>
<span class="5021028513790341802" onmouseenter="enter('5021028513790341802');" onmouseout="out('5021028513790341802');" style="">1002             order.getPayments().remove(paymentToRemove);                                                 </span>
<span class="-7249333565068001633" onmouseenter="enter('-7249333565068001633');" onmouseout="out('-7249333565068001633');" style="">1003             payment = paymentDao.readPaymentById(paymentToRemove.getId());                               </span>
<span class="-5369248081625730935" onmouseenter="enter('-5369248081625730935');" onmouseout="out('-5369248081625730935');" style="">1004             paymentDao.delete(payment);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1005         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1006     }                                                                                                    </span>
<span  style="">1007                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1008     /**                                                                                                  </span>
<span class="6936875034092858122" onmouseenter="enter('6936875034092858122');" onmouseout="out('6936875034092858122');" style="">1009      * This method will return the exception that is immediately below the deepest                       </span>
<span class="8325554843978875883" onmouseenter="enter('8325554843978875883');" onmouseout="out('8325554843978875883');" style="">1010      * WorkflowException in the current stack trace.                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1011      *                                                                                                   </span>
<span class="914602110034133584" onmouseenter="enter('914602110034133584');" onmouseout="out('914602110034133584');" style="">1012      * @param e the workflow exception that contains the requested root cause                            </span>
<span class="-825884884099351167" onmouseenter="enter('-825884884099351167');" onmouseout="out('-825884884099351167');" style="">1013      * @return the root cause of the workflow exception                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1014      */                                                                                                  </span>
<span class="-6688244297454300494" onmouseenter="enter('-6688244297454300494');" onmouseout="out('-6688244297454300494');" style="">1015     protected Throwable getCartOperationExceptionRootCause(WorkflowException e) {                        </span>
<span class="-6915919722100840508" onmouseenter="enter('-6915919722100840508');" onmouseout="out('-6915919722100840508');" style="">1016         Throwable cause = e.getCause();                                                                  </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style="">1017         if (cause == null) {                                                                             </span>
<span class="2254950224932520865" onmouseenter="enter('2254950224932520865');" onmouseout="out('2254950224932520865');" style="">1018             return e;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1019         }                                                                                                </span>
<span  style="">1020                                                                                                          </span>
<span class="2363873739200211359" onmouseenter="enter('2363873739200211359');" onmouseout="out('2363873739200211359');" style="">1021         Throwable currentCause = cause;                                                                  </span>
<span class="-3242506506853415284" onmouseenter="enter('-3242506506853415284');" onmouseout="out('-3242506506853415284');" style="">1022         while (currentCause.getCause() != null) {                                                        </span>
<span class="6579708771118863579" onmouseenter="enter('6579708771118863579');" onmouseout="out('6579708771118863579');" style="">1023             currentCause = currentCause.getCause();                                                      </span>
<span class="8991829102747430232" onmouseenter="enter('8991829102747430232');" onmouseout="out('8991829102747430232');" style="">1024             if (currentCause instanceof WorkflowException) {                                             </span>
<span class="-8175986703099391257" onmouseenter="enter('-8175986703099391257');" onmouseout="out('-8175986703099391257');" style="">1025                 cause = currentCause.getCause();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1026             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1027         }                                                                                                </span>
<span  style="">1028                                                                                                          </span>
<span class="-8291476910521993484" onmouseenter="enter('-8291476910521993484');" onmouseout="out('-8291476910521993484');" style="">1029         return cause;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1030     }                                                                                                    </span>
<span  style="">1031                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1032     /**                                                                                                  </span>
<span class="-4869107995961353955" onmouseenter="enter('-4869107995961353955');" onmouseout="out('-4869107995961353955');" style="">1033      * Returns true if the two items attributes exactly match.                                           </span>
<span class="-7080712594711412450" onmouseenter="enter('-7080712594711412450');" onmouseout="out('-7080712594711412450');" style="">1034      * @param item1Attributes                                                                            </span>
<span class="-6439056940940666101" onmouseenter="enter('-6439056940940666101');" onmouseout="out('-6439056940940666101');" style="">1035      * @param item2                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">1036      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1037      */                                                                                                  </span>
<span class="6199969656370324246" onmouseenter="enter('6199969656370324246');" onmouseout="out('6199969656370324246');" style=""><abbr title="1038     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2) {">1038     protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestðŸ”µ</abbr></span>
<span class="-4121399301000725365" onmouseenter="enter('-4121399301000725365');" onmouseout="out('-4121399301000725365');" style="">1039         int item1AttributeSize = item1Attributes == null ? 0 : item1Attributes.size();                   </span>
<span class="-4841456796483769583" onmouseenter="enter('-4841456796483769583');" onmouseout="out('-4841456796483769583');" style=""><abbr title="1040         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size();">1040         int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size()ðŸ”µ</abbr></span>
<span  style="">1041                                                                                                          </span>
<span class="-6976046912644474969" onmouseenter="enter('-6976046912644474969');" onmouseout="out('-6976046912644474969');" style="">1042         if (item1AttributeSize != item2AttributeSize) {                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1043             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1044         }                                                                                                </span>
<span  style="">1045                                                                                                          </span>
<span class="8660828604942896283" onmouseenter="enter('8660828604942896283');" onmouseout="out('8660828604942896283');" style="">1046         for (String key : item2.getItemAttributes().keySet()) {                                          </span>
<span class="-7527106708479866057" onmouseenter="enter('-7527106708479866057');" onmouseout="out('-7527106708479866057');" style=""><abbr title="1047             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).getValue();">1047             String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).geðŸ”µ</abbr></span>
<span class="-8945816914747285664" onmouseenter="enter('-8945816914747285664');" onmouseout="out('-8945816914747285664');" style="">1048             String itemTwoValue = item2.getItemAttributes().get(key);                                    </span>
<span class="2348135482578686472" onmouseenter="enter('2348135482578686472');" onmouseout="out('2348135482578686472');" style="">1049             if (!itemTwoValue.equals(itemOneValue)) {                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1050                 return false;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1051             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1052         }                                                                                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1053         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1054     }                                                                                                    </span>
<span  style="">1055                                                                                                          </span>
<span class="-4141718569550096543" onmouseenter="enter('-4141718569550096543');" onmouseout="out('-4141718569550096543');" style=""><abbr title="1056     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1Attributes,">1056     protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; iteðŸ”µ</abbr></span>
<span class="-3703517832068399666" onmouseenter="enter('-3703517832068399666');" onmouseout="out('-3703517832068399666');" style="">1057             OrderItemRequestDTO item2) {                                                                 </span>
<span class="-4525614051490920688" onmouseenter="enter('-4525614051490920688');" onmouseout="out('-4525614051490920688');" style="">1058         // Must match on SKU and options                                                                 </span>
<span class="4681926242181597732" onmouseenter="enter('4681926242181597732');" onmouseout="out('4681926242181597732');" style="">1059         if (item1Sku != null &amp;&amp; item2.getSkuId() != null) {                                              </span>
<span class="4828879456607690268" onmouseenter="enter('4828879456607690268');" onmouseout="out('4828879456607690268');" style="">1060             if (item1Sku.getId().equals(item2.getSkuId())) {                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1061                 return true;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1062             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1063         } else {                                                                                         </span>
<span class="-3562715489663556008" onmouseenter="enter('-3562715489663556008');" onmouseout="out('-3562715489663556008');" style="">1064             if (item1Product != null &amp;&amp; item2.getProductId() != null) {                                  </span>
<span class="-6090611743723364470" onmouseenter="enter('-6090611743723364470');" onmouseout="out('-6090611743723364470');" style="">1065                 if (item1Product.getId().equals(item2.getProductId())) {                                 </span>
<span class="-3558352998309083894" onmouseenter="enter('-3558352998309083894');" onmouseout="out('-3558352998309083894');" style="">1066                     return compareAttributes(item1Attributes, item2);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1068             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1069         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1070         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1071     }                                                                                                    </span>
<span  style="">1072                                                                                                          </span>
<span class="-7114483559120409995" onmouseenter="enter('-7114483559120409995');" onmouseout="out('-7114483559120409995');" style="">1073     protected OrderItem findMatchingItem(Order order, OrderItemRequestDTO itemToFind) {                  </span>
<span class="-5687874155783563532" onmouseenter="enter('-5687874155783563532');" onmouseout="out('-5687874155783563532');" style="">1074         if (order == null) {                                                                             </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1075             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1076         }                                                                                                </span>
<span class="4435196443097834597" onmouseenter="enter('4435196443097834597');" onmouseout="out('4435196443097834597');" style="">1077         for (OrderItem currentItem : order.getOrderItems()) {                                            </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style="">1078             if (currentItem instanceof DiscreteOrderItem) {                                              </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style="">1079                 DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                        </span>
<span class="-4911141910965303230" onmouseenter="enter('-4911141910965303230');" onmouseout="out('-4911141910965303230');" style=""><abbr title="1080                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttributes(),">1080                 if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItðŸ”µ</abbr></span>
<span class="-1179319244482714398" onmouseenter="enter('-1179319244482714398');" onmouseout="out('-1179319244482714398');" style="">1081                         itemToFind)) {                                                                   </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style="">1082                     return discreteItem;                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083                 }                                                                                        </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style="">1084             } else if (currentItem instanceof BundleOrderItem) {                                         </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style="">1085                 BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                              </span>
<span class="-7934111527767872247" onmouseenter="enter('-7934111527767872247');" onmouseout="out('-7934111527767872247');" style="">1086                 if (itemMatches(bundleItem.getSku(), bundleItem.getProduct(), null, itemToFind)) {       </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style="">1087                     return bundleItem;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1088                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1089             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1090         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1091         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1092     }                                                                                                    </span>
<span  style="">1093                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1094     @Override                                                                                            </span>
<span class="-5844561583982380564" onmouseenter="enter('-5844561583982380564');" onmouseout="out('-5844561583982380564');" style="">1095     @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { UpdateCartException.class })          </span>
<span class="586625526125468318" onmouseenter="enter('586625526125468318');" onmouseout="out('586625526125468318');" style=""><abbr title="1096     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException {">1096     public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, booleðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1097         try {                                                                                            </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title="1098             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);">1098             CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItðŸ”µ</abbr></span>
<span class="-8587304739270495732" onmouseenter="enter('-8587304739270495732');" onmouseout="out('-8587304739270495732');" style=""><abbr title="1099             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptionsForItemWorkflow.doActivities(cartOpRequest);">1099             ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updatePðŸ”µ</abbr></span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title="1100             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());">1100             context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getAcðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style="">1101             return context.getSeedData().getOrder();                                                     </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1102         } catch (WorkflowException e) {                                                                  </span>
<span class="1106241423190966760" onmouseenter="enter('1106241423190966760');" onmouseout="out('1106241423190966760');" style=""><abbr title="1103             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCause(e));">1103             throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCauseðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1104         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105     }                                                                                                    </span>
<span  style="">1106                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1107     @Override                                                                                            </span>
<span class="1062217594650773028" onmouseenter="enter('1062217594650773028');" onmouseout="out('1062217594650773028');" style="">1108     public Order reloadOrder(Order order) {                                                              </span>
<span class="-4055446979990348221" onmouseenter="enter('-4055446979990348221');" onmouseout="out('-4055446979990348221');" style="">1109         if (order == null || order instanceof NullOrderImpl || order.getId() == null) {                  </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style="">1110             return order;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111         }                                                                                                </span>
<span  style="">1112                                                                                                          </span>
<span class="4601321525892022542" onmouseenter="enter('4601321525892022542');" onmouseout="out('4601321525892022542');" style="">1113         return orderDao.readOrderById(order.getId(), true);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1114     }                                                                                                    </span>
<span  style="">1115                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1116     @Override                                                                                            </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="">1117     @Transactional(&quot;blTransactionManager&quot;)                                                               </span>
<span class="-7012224974908680421" onmouseenter="enter('-7012224974908680421');" onmouseout="out('-7012224974908680421');" style="">1118     public boolean acquireLock(Order order) {                                                            </span>
<span class="1335946416444527614" onmouseenter="enter('1335946416444527614');" onmouseout="out('1335946416444527614');" style="">1119         return orderDao.acquireLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1120     }                                                                                                    </span>
<span  style="">1121                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1122     @Override                                                                                            </span>
<span class="3603110228114188705" onmouseenter="enter('3603110228114188705');" onmouseout="out('3603110228114188705');" style="">1123     public boolean releaseLock(Order order) {                                                            </span>
<span class="1014135102090455120" onmouseenter="enter('1014135102090455120');" onmouseout="out('1014135102090455120');" style="">1124         return orderDao.releaseLock(order);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1125     }                                                                                                    </span>
<span  style="">1126                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1127     @Override                                                                                            </span>
<span class="-3640157100751954071" onmouseenter="enter('-3640157100751954071');" onmouseout="out('-3640157100751954071');" style="">1128     public void printOrder(Order order, Log log) {                                                       </span>
<span class="-3796071981400661878" onmouseenter="enter('-3796071981400661878');" onmouseout="out('-3796071981400661878');" style="">1129         if (!log.isDebugEnabled()) {                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1130             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1131         }                                                                                                </span>
<span  style="">1132                                                                                                          </span>
<span class="3667140805233255262" onmouseenter="enter('3667140805233255262');" onmouseout="out('3667140805233255262');" style="">1133         TableCreator tc = new TableCreator(new TableCreator.Col[] {                                      </span>
<span class="7681839206706458847" onmouseenter="enter('7681839206706458847');" onmouseout="out('7681839206706458847');" style="">1134             new TableCreator.Col(&quot;Order Item&quot;, 30),                                                      </span>
<span class="2598617298230317857" onmouseenter="enter('2598617298230317857');" onmouseout="out('2598617298230317857');" style="">1135             new TableCreator.Col(&quot;Qty&quot;),                                                                 </span>
<span class="-7694790865023700533" onmouseenter="enter('-7694790865023700533');" onmouseout="out('-7694790865023700533');" style="">1136             new TableCreator.Col(&quot;Unit Price&quot;),                                                          </span>
<span class="-4029215824508924196" onmouseenter="enter('-4029215824508924196');" onmouseout="out('-4029215824508924196');" style="">1137             new TableCreator.Col(&quot;Avg Adj&quot;),                                                             </span>
<span class="2280319324156256259" onmouseenter="enter('2280319324156256259');" onmouseout="out('2280319324156256259');" style="">1138             new TableCreator.Col(&quot;Total Adj&quot;),                                                           </span>
<span class="803984851040328531" onmouseenter="enter('803984851040328531');" onmouseout="out('803984851040328531');" style="">1139             new TableCreator.Col(&quot;Total Price&quot;)                                                          </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1140         });                                                                                              </span>
<span  style="">1141                                                                                                          </span>
<span class="8447029191885982498" onmouseenter="enter('8447029191885982498');" onmouseout="out('8447029191885982498');" style="">1142         for (OrderItem oi : order.getOrderItems()) {                                                     </span>
<span class="7794599779896353168" onmouseenter="enter('7794599779896353168');" onmouseout="out('7794599779896353168');" style="">1143             tc.addRow(new String[] {                                                                     </span>
<span class="-6517557825202851987" onmouseenter="enter('-6517557825202851987');" onmouseout="out('-6517557825202851987');" style="">1144                 oi.getName(),                                                                            </span>
<span class="-5588620079629414973" onmouseenter="enter('-5588620079629414973');" onmouseout="out('-5588620079629414973');" style="">1145                 String.valueOf(oi.getQuantity()),                                                        </span>
<span class="8023041970437622541" onmouseenter="enter('8023041970437622541');" onmouseout="out('8023041970437622541');" style="">1146                 String.valueOf(oi.getPriceBeforeAdjustments(true)),                                      </span>
<span class="4981794139639039914" onmouseenter="enter('4981794139639039914');" onmouseout="out('4981794139639039914');" style="">1147                 String.valueOf(oi.getAverageAdjustmentValue()),                                          </span>
<span class="-7621609530264461687" onmouseenter="enter('-7621609530264461687');" onmouseout="out('-7621609530264461687');" style="">1148                 String.valueOf(oi.getTotalAdjustmentValue()),                                            </span>
<span class="610268575597889106" onmouseenter="enter('610268575597889106');" onmouseout="out('610268575597889106');" style="">1149                 String.valueOf(oi.getTotalPrice())                                                       </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1150             });                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1151         }                                                                                                </span>
<span  style="">1152                                                                                                          </span>
<span class="-3387660244080770577" onmouseenter="enter('-3387660244080770577');" onmouseout="out('-3387660244080770577');" style="">1153         tc.addSeparator()                                                                                </span>
<span class="-4962129920853993876" onmouseenter="enter('-4962129920853993876');" onmouseout="out('-4962129920853993876');" style="">1154             .withGlobalRowHeaderWidth(15)                                                                </span>
<span class="8977950677164210482" onmouseenter="enter('8977950677164210482');" onmouseout="out('8977950677164210482');" style="">1155             .addRow(&quot;Subtotal&quot;, order.getSubTotal())                                                     </span>
<span class="9039771477815737150" onmouseenter="enter('9039771477815737150');" onmouseout="out('9039771477815737150');" style="">1156             .addRow(&quot;Order Adj.&quot;, order.getOrderAdjustmentsValue())                                      </span>
<span class="-3982350454387940822" onmouseenter="enter('-3982350454387940822');" onmouseout="out('-3982350454387940822');" style="">1157             .addRow(&quot;Tax&quot;, order.getTotalTax())                                                          </span>
<span class="-1569816593472627301" onmouseenter="enter('-1569816593472627301');" onmouseout="out('-1569816593472627301');" style="">1158             .addRow(&quot;Shipping&quot;, order.getTotalShipping())                                                </span>
<span class="-2587440008499047447" onmouseenter="enter('-2587440008499047447');" onmouseout="out('-2587440008499047447');" style="">1159             .addRow(&quot;Total&quot;, order.getTotal())                                                           </span>
<span class="-7531230309631143371" onmouseenter="enter('-7531230309631143371');" onmouseout="out('-7531230309631143371');" style="">1160             .addSeparator();                                                                             </span>
<span  style="">1161                                                                                                          </span>
<span class="5532863706287091360" onmouseenter="enter('5532863706287091360');" onmouseout="out('5532863706287091360');" style="">1162         log.debug(tc.toString());                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1163     }                                                                                                    </span>
<span  style="">1164                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1165     @Override                                                                                            </span>
<span class="-6821589912139190758" onmouseenter="enter('-6821589912139190758');" onmouseout="out('-6821589912139190758');" style="">1166     public void preValidateCartOperation(Order cart) {                                                   </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1167         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-2298593102036867448" onmouseenter="enter('-2298593102036867448');" onmouseout="out('-2298593102036867448');" style="">1168         extensionManager.getProxy().preValidateCartOperation(cart, erh);                                 </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1169         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1170             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1171         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1172             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1173         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1174     }                                                                                                    </span>
<span  style="">1175                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1176     @Override                                                                                            </span>
<span class="6673450650333126736" onmouseenter="enter('6673450650333126736');" onmouseout="out('6673450650333126736');" style="">1177     public void preValidateUpdateQuantityOperation(Order cart, OrderItemRequestDTO dto) {                </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1178         ExtensionResultHolder erh = new ExtensionResultHolder();                                         </span>
<span class="-1253981422185917754" onmouseenter="enter('-1253981422185917754');" onmouseout="out('-1253981422185917754');" style="">1179         extensionManager.getProxy().preValidateUpdateQuantityOperation(cart, dto, erh);                  </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1180         if (erh.getThrowable() instanceof IllegalCartOperationException) {                               </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1181             throw ((IllegalCartOperationException) erh.getThrowable());                                  </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1182         } else if (erh.getThrowable() != null) {                                                         </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1183             throw new RuntimeException(erh.getThrowable());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1184         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1185     }                                                                                                    </span>
<span  style="">1186                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1187     @Override                                                                                            </span>
<span class="7073850063066733207" onmouseenter="enter('7073850063066733207');" onmouseout="out('7073850063066733207');" style="">1188     public void refresh(Order order) {                                                                   </span>
<span class="4383314386154345120" onmouseenter="enter('4383314386154345120');" onmouseout="out('4383314386154345120');" style="">1189         orderDao.refresh(order);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1190     }                                                                                                    </span>
<span  style="">1191                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1192     @Override                                                                                            </span>
<span class="1062745462356892667" onmouseenter="enter('1062745462356892667');" onmouseout="out('1062745462356892667');" style="">1193     public Order findCartForCustomerWithEnhancements(Customer customer) {                                </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1194         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="8097724414319335156" onmouseenter="enter('8097724414319335156');" onmouseout="out('8097724414319335156');" style=""><abbr title="1195         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, erh);">1195         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1196         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1197             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1198         }                                                                                                </span>
<span class="-7896162153865126169" onmouseenter="enter('-7896162153865126169');" onmouseout="out('-7896162153865126169');" style="">1199         return findCartForCustomer(customer);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1200     }                                                                                                    </span>
<span  style="">1201                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1202     @Override                                                                                            </span>
<span class="3369501079555878000" onmouseenter="enter('3369501079555878000');" onmouseout="out('3369501079555878000');" style="">1203     public Order findCartForCustomerWithEnhancements(Customer customer, Order candidateOrder) {          </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1204         ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                           </span>
<span class="935633576463333972" onmouseenter="enter('935633576463333972');" onmouseout="out('935633576463333972');" style=""><abbr title="1205         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, candidateOrder, erh);">1205         ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancementsðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1206         if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                 </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1207             return erh.getResult();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1208         }                                                                                                </span>
<span class="5654562705123023026" onmouseenter="enter('5654562705123023026');" onmouseout="out('5654562705123023026');" style="">1209         return candidateOrder;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1210     }                                                                                                    </span>
<span  style="">1211                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1212     @Override                                                                                            </span>
<span class="7870513728701775364" onmouseenter="enter('7870513728701775364');" onmouseout="out('7870513728701775364');" style="">1213     public List&lt;Order&gt; findOrdersByEmail(String email) {                                                 </span>
<span class="-6244770976468678027" onmouseenter="enter('-6244770976468678027');" onmouseout="out('-6244770976468678027');" style="">1214         return orderDao.readOrdersByEmail(email);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1215     }                                                                                                    </span>
<span  style="">1216                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1217     @Override                                                                                            </span>
<span class="1732562485956607688" onmouseenter="enter('1732562485956607688');" onmouseout="out('1732562485956607688');" style="">1218     public List&lt;Order&gt; readBatchOrders(int start, int pageSize, List&lt;OrderStatus&gt; orderStatusList) {     </span>
<span class="-4564878267596583277" onmouseenter="enter('-4564878267596583277');" onmouseout="out('-4564878267596583277');" style="">1219         return orderDao.readBatchOrders(start, pageSize, orderStatusList);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1220     }                                                                                                    </span>
<span  style="">1221                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1222     @Override                                                                                            </span>
<span class="-7199170496986096208" onmouseenter="enter('-7199170496986096208');" onmouseout="out('-7199170496986096208');" style="">1223     	public Long readNumberOfOrders() {                                                                  </span>
<span class="4444270982432861777" onmouseenter="enter('4444270982432861777');" onmouseout="out('4444270982432861777');" style="">1224     		return orderDao.readNumberOfOrders();                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1225     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1226 }                                                                                                        </span>



</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2522844188166543739" onmouseenter="enter('2522844188166543739');" onmouseout="out('2522844188166543739');" style="">  18  package org.broadleafcommerce.core.order.service;                                                                 </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-1195774921000060328" onmouseenter="enter('-1195774921000060328');" onmouseout="out('-1195774921000060328');" style="">  21  import org.apache.commons.lang3.builder.CompareToBuilder;                                                         </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  24  import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                              </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  25  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="7974202605197813097" onmouseenter="enter('7974202605197813097');" onmouseout="out('7974202605197813097');" style="">  26  import org.broadleafcommerce.common.payment.PaymentType;                                                          </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  27  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="7029131086618023959" onmouseenter="enter('7029131086618023959');" onmouseout="out('7029131086618023959');" style="">  28  import org.broadleafcommerce.common.util.TableCreator;                                                            </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  29  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="4803307284880744779" onmouseenter="enter('4803307284880744779');" onmouseout="out('4803307284880744779');" style="">  30  import org.broadleafcommerce.common.util.TypedPredicate;                                                          </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  31  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  32  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  33  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  34  import org.broadleafcommerce.core.offer.dao.OfferDao;                                                             </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  35  import org.broadleafcommerce.core.offer.domain.Offer;                                                             </span>
<span class="1521662235446319191" onmouseenter="enter('1521662235446319191');" onmouseout="out('1521662235446319191');" style="">  36  import org.broadleafcommerce.core.offer.domain.OfferCode;                                                         </span>
<span class="263797997925672445" onmouseenter="enter('263797997925672445');" onmouseout="out('263797997925672445');" style="">  37  import org.broadleafcommerce.core.offer.service.OfferService;                                                     </span>
<span class="4256508551440919929" onmouseenter="enter('4256508551440919929');" onmouseout="out('4256508551440919929');" style="">  38  import org.broadleafcommerce.core.offer.service.OfferServiceExtensionHandler;                                     </span>
<span class="8148915287428556311" onmouseenter="enter('8148915287428556311');" onmouseout="out('8148915287428556311');" style="">  39  import org.broadleafcommerce.core.offer.service.OfferServiceExtensionManager;                                     </span>
<span class="-2264825748950997481" onmouseenter="enter('-2264825748950997481');" onmouseout="out('-2264825748950997481');" style="">  40  import org.broadleafcommerce.core.offer.service.exception.OfferAlreadyAddedException;                             </span>
<span class="6280580908510581954" onmouseenter="enter('6280580908510581954');" onmouseout="out('6280580908510581954');" style="">  41  import org.broadleafcommerce.core.offer.service.exception.OfferException;                                         </span>
<span class="7718612833831637853" onmouseenter="enter('7718612833831637853');" onmouseout="out('7718612833831637853');" style="">  42  import org.broadleafcommerce.core.offer.service.exception.OfferExpiredException;                                  </span>
<span class="2542407303560298775" onmouseenter="enter('2542407303560298775');" onmouseout="out('2542407303560298775');" style="">  43  import org.broadleafcommerce.core.offer.service.exception.OfferMaxUseExceededException;                           </span>
<span class="7365998840944773425" onmouseenter="enter('7365998840944773425');" onmouseout="out('7365998840944773425');" style="">  44  import org.broadleafcommerce.core.order.dao.OrderDao;                                                             </span>
<span class="-8431629490392379230" onmouseenter="enter('-8431629490392379230');" onmouseout="out('-8431629490392379230');" style="">  45  import org.broadleafcommerce.core.order.domain.BundleOrderItem;                                                   </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  46  import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                                 </span>
<span class="4607558792631823600" onmouseenter="enter('4607558792631823600');" onmouseout="out('4607558792631823600');" style="">  47  import org.broadleafcommerce.core.order.domain.GiftWrapOrderItem;                                                 </span>
<span class="3195477135256206744" onmouseenter="enter('3195477135256206744');" onmouseout="out('3195477135256206744');" style="">  48  import org.broadleafcommerce.core.order.domain.NullOrderFactory;                                                  </span>
<span class="6568352354414313904" onmouseenter="enter('6568352354414313904');" onmouseout="out('6568352354414313904');" style="">  49  import org.broadleafcommerce.core.order.domain.NullOrderImpl;                                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  50  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  51  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  52  import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                                </span>
<span class="-4972689095474256973" onmouseenter="enter('-4972689095474256973');" onmouseout="out('-4972689095474256973');" style="">  53  import org.broadleafcommerce.core.order.service.call.ActivityMessageDTO;                                          </span>
<span class="-7160318188857079464" onmouseenter="enter('-7160318188857079464');" onmouseout="out('-7160318188857079464');" style="">  54  import org.broadleafcommerce.core.order.service.call.GiftWrapOrderItemRequest;                                    </span>
<span class="-1901438765224473349" onmouseenter="enter('-1901438765224473349');" onmouseout="out('-1901438765224473349');" style="">  55  import org.broadleafcommerce.core.order.service.call.OrderItemRequestDTO;                                         </span>
<span class="-3854268344786449631" onmouseenter="enter('-3854268344786449631');" onmouseout="out('-3854268344786449631');" style="">  56  import org.broadleafcommerce.core.order.service.exception.AddToCartException;                                     </span>
<span class="-8548142165698551205" onmouseenter="enter('-8548142165698551205');" onmouseout="out('-8548142165698551205');" style="">  57  import org.broadleafcommerce.core.order.service.exception.IllegalCartOperationException;                          </span>
<span class="-3598721789967501677" onmouseenter="enter('-3598721789967501677');" onmouseout="out('-3598721789967501677');" style="">  58  import org.broadleafcommerce.core.order.service.exception.ItemNotFoundException;                                  </span>
<span class="4692349346970735648" onmouseenter="enter('4692349346970735648');" onmouseout="out('4692349346970735648');" style="">  59  import org.broadleafcommerce.core.order.service.exception.RemoveFromCartException;                                </span>
<span class="9042395061305363095" onmouseenter="enter('9042395061305363095');" onmouseout="out('9042395061305363095');" style="">  60  import org.broadleafcommerce.core.order.service.exception.UpdateCartException;                                    </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  61  import org.broadleafcommerce.core.order.service.type.OrderStatus;                                                 </span>
<span class="-3953683189888176126" onmouseenter="enter('-3953683189888176126');" onmouseout="out('-3953683189888176126');" style="">  62  import org.broadleafcommerce.core.order.service.workflow.CartOperationRequest;                                    </span>
<span class="3604210211865098056" onmouseenter="enter('3604210211865098056');" onmouseout="out('3604210211865098056');" style="">  63  import org.broadleafcommerce.core.payment.dao.OrderPaymentDao;                                                    </span>
<span class="725806334255742314" onmouseenter="enter('725806334255742314');" onmouseout="out('725806334255742314');" style="">  64  import org.broadleafcommerce.core.payment.domain.OrderPayment;                                                    </span>
<span class="-5451903065912654495" onmouseenter="enter('-5451903065912654495');" onmouseout="out('-5451903065912654495');" style="">  65  import org.broadleafcommerce.core.payment.domain.secure.Referenced;                                               </span>
<span class="5702480564955886723" onmouseenter="enter('5702480564955886723');" onmouseout="out('5702480564955886723');" style="">  66  import org.broadleafcommerce.core.payment.service.SecureOrderPaymentService;                                      </span>
<span class="-8638524682328332386" onmouseenter="enter('-8638524682328332386');" onmouseout="out('-8638524682328332386');" style="">  67  import org.broadleafcommerce.core.pricing.service.PricingService;                                                 </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  68  import org.broadleafcommerce.core.pricing.service.exception.PricingException;                                     </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  69  import org.broadleafcommerce.core.workflow.ActivityMessages;                                                      </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  70  import org.broadleafcommerce.core.workflow.ProcessContext;                                                        </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  71  import org.broadleafcommerce.core.workflow.Processor;                                                             </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  72  import org.broadleafcommerce.core.workflow.WorkflowException;                                                     </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  73  import org.broadleafcommerce.profile.core.domain.Customer;                                                        </span>
<span class="2095059086545149108" onmouseenter="enter('2095059086545149108');" onmouseout="out('2095059086545149108');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +import org.broadleafcommerce.profile.core.service.CustomerService;                                                </span>
<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  75  import org.hibernate.FlushMode;                                                                                   </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  76  import org.hibernate.Session;                                                                                     </span>
<span class="-6296437060367579882" onmouseenter="enter('-6296437060367579882');" onmouseout="out('-6296437060367579882');" style="">  77  import org.hibernate.exception.LockAcquisitionException;                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  78  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="1177291030959407810" onmouseenter="enter('1177291030959407810');" onmouseout="out('1177291030959407810');" style="">  79  import org.springframework.jmx.export.annotation.ManagedAttribute;                                                </span>
<span class="-2411378172167085657" onmouseenter="enter('-2411378172167085657');" onmouseout="out('-2411378172167085657');" style="">  80  import org.springframework.jmx.export.annotation.ManagedResource;                                                 </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  81  import org.springframework.stereotype.Service;                                                                    </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  82  import org.springframework.transaction.PlatformTransactionManager;                                                </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  83  import org.springframework.transaction.TransactionDefinition;                                                     </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  84  import org.springframework.transaction.TransactionStatus;                                                         </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  85  import org.springframework.transaction.annotation.Transactional;                                                  </span>
<span  style="">  86                                                                                                                    </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  87  import java.math.BigDecimal;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  88  import java.util.ArrayList;                                                                                       </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  89  import java.util.Collections;                                                                                     </span>
<span class="4561244361960433187" onmouseenter="enter('4561244361960433187');" onmouseout="out('4561244361960433187');" style="">  90  import java.util.Comparator;                                                                                      </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  91  import java.util.Date;                                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  92  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  93  import java.util.Map;                                                                                             </span>

<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  94  import java.util.Set;                                                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  96  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  97  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  98  import javax.persistence.PersistenceContext;                                                                      </span>
<span  style="">  99                                                                                                                    </span>
<span  style=""> 100                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 101  /**                                                                                                               </span>
<span class="2815697706567038739" onmouseenter="enter('2815697706567038739');" onmouseout="out('2815697706567038739');" style=""> 102   * @author apazzolini                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 103   */                                                                                                               </span>
<span class="7613295130782185909" onmouseenter="enter('7613295130782185909');" onmouseout="out('7613295130782185909');" style=""> 104  @Service(&quot;blOrderService&quot;)                                                                                        </span>
<span class="5819673836649587467" onmouseenter="enter('5819673836649587467');" onmouseout="out('5819673836649587467');" style=""><abbr title=" 105  @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLimit=15)"> 105  @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLiðŸ”µ</abbr></span>
<span class="-2072417237584838241" onmouseenter="enter('-2072417237584838241');" onmouseout="out('-2072417237584838241');" style=""> 106  public class OrderServiceImpl implements OrderService {                                                           </span>
<span class="-6147601375299019476" onmouseenter="enter('-6147601375299019476');" onmouseout="out('-6147601375299019476');" style=""> 107      private static final Log LOG = LogFactory.getLog(OrderServiceImpl.class);                                     </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-1034856612351701575" onmouseenter="enter('-1034856612351701575');" onmouseout="out('-1034856612351701575');" style=""> 109      /* DAOs */                                                                                                    </span>
<span class="4300412198824813091" onmouseenter="enter('4300412198824813091');" onmouseout="out('4300412198824813091');" style=""> 110      @Resource(name = &quot;blOrderPaymentDao&quot;)                                                                         </span>
<span class="-6743991484426169368" onmouseenter="enter('-6743991484426169368');" onmouseout="out('-6743991484426169368');" style=""> 111      protected OrderPaymentDao paymentDao;                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="-8616512229212864636" onmouseenter="enter('-8616512229212864636');" onmouseout="out('-8616512229212864636');" style=""> 113      @Resource(name = &quot;blOrderDao&quot;)                                                                                </span>
<span class="3205943113513590409" onmouseenter="enter('3205943113513590409');" onmouseout="out('3205943113513590409');" style=""> 114      protected OrderDao orderDao;                                                                                  </span>
<span  style=""> 115                                                                                                                    </span>
<span class="5779429748772127951" onmouseenter="enter('5779429748772127951');" onmouseout="out('5779429748772127951');" style=""> 116      @Resource(name = &quot;blOfferDao&quot;)                                                                                </span>
<span class="8858788780557179486" onmouseenter="enter('8858788780557179486');" onmouseout="out('8858788780557179486');" style=""> 117      protected OfferDao offerDao;                                                                                  </span>
<span  style=""> 118                                                                                                                    </span>
<span class="4027092641360680465" onmouseenter="enter('4027092641360680465');" onmouseout="out('4027092641360680465');" style=""> 119      /* Factories */                                                                                               </span>
<span class="-5967051191091567596" onmouseenter="enter('-5967051191091567596');" onmouseout="out('-5967051191091567596');" style=""> 120      @Resource(name = &quot;blNullOrderFactory&quot;)                                                                        </span>
<span class="4068278867975252256" onmouseenter="enter('4068278867975252256');" onmouseout="out('4068278867975252256');" style=""> 121      protected NullOrderFactory nullOrderFactory;                                                                  </span>
<span  style=""> 122                                                                                                                    </span>
<span class="1042938529233933214" onmouseenter="enter('1042938529233933214');" onmouseout="out('1042938529233933214');" style=""> 123      /* Services */                                                                                                </span>
<span class="6969754559269026560" onmouseenter="enter('6969754559269026560');" onmouseout="out('6969754559269026560');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    @Resource(name = &quot;blCustomerService&quot;)                                                                         </span>
<span class="5369585293672379772" onmouseenter="enter('5369585293672379772');" onmouseout="out('5369585293672379772');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +    protected CustomerService customerService;                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                                                                                                                  </span>
<span class="1740335809005650078" onmouseenter="enter('1740335809005650078');" onmouseout="out('1740335809005650078');" style=""> 127      @Resource(name = &quot;blPricingService&quot;)                                                                          </span>
<span class="-3953942945177082651" onmouseenter="enter('-3953942945177082651');" onmouseout="out('-3953942945177082651');" style=""> 128      protected PricingService pricingService;                                                                      </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-8762117636097767442" onmouseenter="enter('-8762117636097767442');" onmouseout="out('-8762117636097767442');" style=""> 130      @Resource(name = &quot;blOrderItemService&quot;)                                                                        </span>
<span class="-7939877477893967584" onmouseenter="enter('-7939877477893967584');" onmouseout="out('-7939877477893967584');" style=""> 131      protected OrderItemService orderItemService;                                                                  </span>
<span  style=""> 132                                                                                                                    </span>
<span class="2996711079688344376" onmouseenter="enter('2996711079688344376');" onmouseout="out('2996711079688344376');" style=""> 133      @Resource(name = &quot;blFulfillmentGroupService&quot;)                                                                 </span>
<span class="-4012624862608675616" onmouseenter="enter('-4012624862608675616');" onmouseout="out('-4012624862608675616');" style=""> 134      protected FulfillmentGroupService fulfillmentGroupService;                                                    </span>
<span  style=""> 135                                                                                                                    </span>
<span class="401190535541877398" onmouseenter="enter('401190535541877398');" onmouseout="out('401190535541877398');" style=""> 136      @Resource(name = &quot;blOfferService&quot;)                                                                            </span>
<span class="5260453850719866461" onmouseenter="enter('5260453850719866461');" onmouseout="out('5260453850719866461');" style=""> 137      protected OfferService offerService;                                                                          </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-5728623657958779082" onmouseenter="enter('-5728623657958779082');" onmouseout="out('-5728623657958779082');" style=""> 139      @Resource(name = &quot;blSecureOrderPaymentService&quot;)                                                               </span>
<span class="-6581230590179767656" onmouseenter="enter('-6581230590179767656');" onmouseout="out('-6581230590179767656');" style=""> 140      protected SecureOrderPaymentService securePaymentInfoService;                                                 </span>
<span  style=""> 141                                                                                                                    </span>
<span class="3052322175513128984" onmouseenter="enter('3052322175513128984');" onmouseout="out('3052322175513128984');" style=""> 142      @Resource(name = &quot;blMergeCartService&quot;)                                                                        </span>
<span class="8208298738953975930" onmouseenter="enter('8208298738953975930');" onmouseout="out('8208298738953975930');" style=""> 143      protected MergeCartService mergeCartService;                                                                  </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-5141785283307634971" onmouseenter="enter('-5141785283307634971');" onmouseout="out('-5141785283307634971');" style=""> 145      @Resource(name = &quot;blOrderServiceExtensionManager&quot;)                                                            </span>
<span class="7609575163897375728" onmouseenter="enter('7609575163897375728');" onmouseout="out('7609575163897375728');" style=""> 146      protected OrderServiceExtensionManager extensionManager;                                                      </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-2568041442687394420" onmouseenter="enter('-2568041442687394420');" onmouseout="out('-2568041442687394420');" style=""> 148      /* Workflows */                                                                                               </span>
<span class="2793266955607927868" onmouseenter="enter('2793266955607927868');" onmouseout="out('2793266955607927868');" style=""> 149      @Resource(name = &quot;blAddItemWorkflow&quot;)                                                                         </span>
<span class="-7970748165831650126" onmouseenter="enter('-7970748165831650126');" onmouseout="out('-7970748165831650126');" style=""> 150      protected Processor addItemWorkflow;                                                                          </span>
<span  style=""> 151                                                                                                                    </span>
<span class="6527917864594618071" onmouseenter="enter('6527917864594618071');" onmouseout="out('6527917864594618071');" style=""> 152      @Resource(name = &quot;blUpdateProductOptionsForItemWorkflow&quot;)                                                     </span>
<span class="-3432528377574027794" onmouseenter="enter('-3432528377574027794');" onmouseout="out('-3432528377574027794');" style=""> 153      private Processor updateProductOptionsForItemWorkflow;                                                        </span>
<span  style=""> 154                                                                                                                    </span>
<span class="-8676131598314218463" onmouseenter="enter('-8676131598314218463');" onmouseout="out('-8676131598314218463');" style=""> 155      @Resource(name = &quot;blUpdateItemWorkflow&quot;)                                                                      </span>
<span class="-4038034170241387616" onmouseenter="enter('-4038034170241387616');" onmouseout="out('-4038034170241387616');" style=""> 156      protected Processor updateItemWorkflow;                                                                       </span>
<span  style=""> 157                                                                                                                    </span>
<span class="2809816546718326729" onmouseenter="enter('2809816546718326729');" onmouseout="out('2809816546718326729');" style=""> 158      @Resource(name = &quot;blRemoveItemWorkflow&quot;)                                                                      </span>
<span class="8820366819754000449" onmouseenter="enter('8820366819754000449');" onmouseout="out('8820366819754000449');" style=""> 159      protected Processor removeItemWorkflow;                                                                       </span>
<span  style=""> 160                                                                                                                    </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 161      @Resource(name = &quot;blTransactionManager&quot;)                                                                      </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 162      protected PlatformTransactionManager transactionManager;                                                      </span>
<span  style=""> 163                                                                                                                    </span>
<span class="4647563353113875163" onmouseenter="enter('4647563353113875163');" onmouseout="out('4647563353113875163');" style=""> 164      @Value(&quot;${pricing.retry.count.for.lock.failure}&quot;)                                                             </span>
<span class="3768032238220096351" onmouseenter="enter('3768032238220096351');" onmouseout="out('3768032238220096351');" style=""> 165      protected int pricingRetryCountForLockFailure = 3;                                                            </span>
<span  style=""> 166                                                                                                                    </span>
<span class="-5649780437206020465" onmouseenter="enter('-5649780437206020465');" onmouseout="out('-5649780437206020465');" style=""> 167      @Value(&quot;${pricing.retry.wait.interval.for.lock.failure}&quot;)                                                     </span>
<span class="6143681610186845623" onmouseenter="enter('6143681610186845623');" onmouseout="out('6143681610186845623');" style=""> 168      protected long pricingRetryWaitIntervalForLockFailure = 500L;                                                 </span>
<span  style=""> 169                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 170      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 171       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="-4084123837140279098" onmouseenter="enter('-4084123837140279098');" onmouseout="out('-4084123837140279098');" style=""> 172       * add-to-cart workflow. This should generally be able to be left false. This is a performance measure and    </span>
<span class="531367490526902986" onmouseenter="enter('531367490526902986');" onmouseout="out('531367490526902986');" style=""> 173       * add-to-cart operations will be more efficient when this is false.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 174       */                                                                                                           </span>
<span class="-6971248696513840261" onmouseenter="enter('-6971248696513840261');" onmouseout="out('-6971248696513840261');" style=""> 175      @Value(&quot;${auto.flush.on.query.during.add.to.cart:false}&quot;)                                                     </span>
<span class="-9081510558149889178" onmouseenter="enter('-9081510558149889178');" onmouseout="out('-9081510558149889178');" style=""> 176      protected boolean autoFlushAddToCart = false;                                                                 </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 179       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="5682863995593575399" onmouseenter="enter('5682863995593575399');" onmouseout="out('5682863995593575399');" style=""> 180       * update-cart workflow. This should generally be able to be left false. This is a performance measure and    </span>
<span class="4015846476888264417" onmouseenter="enter('4015846476888264417');" onmouseout="out('4015846476888264417');" style=""> 181       * update-cart operations will be more efficient when this is false.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 182       */                                                                                                           </span>
<span class="4955973510412192391" onmouseenter="enter('4955973510412192391');" onmouseout="out('4955973510412192391');" style=""> 183      @Value(&quot;${auto.flush.on.query.during.update.cart:false}&quot;)                                                     </span>
<span class="-6560708755317111135" onmouseenter="enter('-6560708755317111135');" onmouseout="out('-6560708755317111135');" style=""> 184      protected boolean autoFlushUpdateCart = false;                                                                </span>
<span  style=""> 185                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 186      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 187       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="5427441896991106725" onmouseenter="enter('5427441896991106725');" onmouseout="out('5427441896991106725');" style=""><abbr title=" 188       * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure and"> 188       * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure anðŸ”µ</abbr></span>
<span class="-4648779041241212172" onmouseenter="enter('-4648779041241212172');" onmouseout="out('-4648779041241212172');" style=""> 189       * remove-from-cart operations will be more efficient when this is false.                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 190       */                                                                                                           </span>
<span class="-8172893732176017719" onmouseenter="enter('-8172893732176017719');" onmouseout="out('-8172893732176017719');" style=""> 191      @Value(&quot;${auto.flush.on.query.during.remove.from.cart:false}&quot;)                                                </span>
<span class="-3285670849425830103" onmouseenter="enter('-3285670849425830103');" onmouseout="out('-3285670849425830103');" style=""> 192      protected boolean autoFlushRemoveFromCart = false;                                                            </span>
<span  style=""> 193                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 194      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 195       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="3621392970638403989" onmouseenter="enter('3621392970638403989');" onmouseout="out('3621392970638403989');" style=""> 196       * order save pricing flow. This should generally be able to be left false. This is a performance measure and </span>
<span class="-6789052884213414091" onmouseenter="enter('-6789052884213414091');" onmouseout="out('-6789052884213414091');" style=""> 197       * save operations will be more efficient when this is false.                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 198       */                                                                                                           </span>
<span class="-188440796641371951" onmouseenter="enter('-188440796641371951');" onmouseout="out('-188440796641371951');" style=""> 199      @Value(&quot;${auto.flush.on.query.during.cart.pricing.save:false}&quot;)                                               </span>
<span class="-7447722827185958723" onmouseenter="enter('-7447722827185958723');" onmouseout="out('-7447722827185958723');" style=""> 200      protected boolean autoFlushSaveCart = false;                                                                  </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style=""> 202      @PersistenceContext(unitName=&quot;blPU&quot;)                                                                          </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 203      protected EntityManager em;                                                                                   </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-6638939562421962482" onmouseenter="enter('-6638939562421962482');" onmouseout="out('-6638939562421962482');" style=""> 205      /* Fields */                                                                                                  </span>
<span class="-3415856814483301136" onmouseenter="enter('-3415856814483301136');" onmouseout="out('-3415856814483301136');" style=""> 206      protected boolean moveNamedOrderItems = true;                                                                 </span>
<span class="-112332225907304480" onmouseenter="enter('-112332225907304480');" onmouseout="out('-112332225907304480');" style=""> 207      protected boolean deleteEmptyNamedOrders = true;                                                              </span>
<span  style=""> 208                                                                                                                    </span>
<span class="8203140173062168288" onmouseenter="enter('8203140173062168288');" onmouseout="out('8203140173062168288');" style=""> 209      protected Boolean automaticallyMergeLikeItems;                                                                </span>
<span  style=""> 210                                                                                                                    </span>
<span class="2799370370843719797" onmouseenter="enter('2799370370843719797');" onmouseout="out('2799370370843719797');" style=""> 211      @Resource(name = &quot;blOrderMultishipOptionService&quot;)                                                             </span>
<span class="768036680350789739" onmouseenter="enter('768036680350789739');" onmouseout="out('768036680350789739');" style=""> 212      protected OrderMultishipOptionService orderMultishipOptionService;                                            </span>
<span  style=""> 213                                                                                                                    </span>
<span class="1476595721846482438" onmouseenter="enter('1476595721846482438');" onmouseout="out('1476595721846482438');" style=""> 214      @Resource(name = &quot;blOfferServiceExtensionManager&quot;)                                                            </span>
<span class="1464017235088339416" onmouseenter="enter('1464017235088339416');" onmouseout="out('1464017235088339416');" style=""> 215      protected OfferServiceExtensionManager offerServiceExtensionManager;                                          </span>
<span  style=""> 216                                                                                                                    </span>
<span  style=""> 217                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 218      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 219      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style=""> 220      public Order createNewCartForCustomer(Customer customer) {                                                    </span>
<span class="-3250206482798517655" onmouseenter="enter('-3250206482798517655');" onmouseout="out('-3250206482798517655');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +        customer = customerService.saveCustomer(customer);                                                        </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style=""> 222          return orderDao.createNewCartForCustomer(customer);                                                       </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span  style=""> 224                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 226      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style=""> 227      public Order createNamedOrderForCustomer(String name, Customer customer) {                                    </span>
<span class="-2409876513820161352" onmouseenter="enter('-2409876513820161352');" onmouseout="out('-2409876513820161352');" style=""> 228          Order namedOrder = orderDao.create();                                                                     </span>
<span class="-4702827597577679131" onmouseenter="enter('-4702827597577679131');" onmouseout="out('-4702827597577679131');" style=""> 229          namedOrder.setCustomer(customer);                                                                         </span>
<span class="-5090709722664798426" onmouseenter="enter('-5090709722664798426');" onmouseout="out('-5090709722664798426');" style=""> 230          namedOrder.setName(name);                                                                                 </span>
<span class="-1603494808269519128" onmouseenter="enter('-1603494808269519128');" onmouseout="out('-1603494808269519128');" style=""> 231          namedOrder.setStatus(OrderStatus.NAMED);                                                                  </span>
<span  style=""> 232                                                                                                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 233          if (extensionManager != null) {                                                                           </span>
<span class="8990503012292673298" onmouseenter="enter('8990503012292673298');" onmouseout="out('8990503012292673298');" style=""> 234              extensionManager.getProxy().attachAdditionalDataToNewNamedCart(customer, namedOrder);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span  style=""> 236                                                                                                                    </span>
<span class="6872588596382822440" onmouseenter="enter('6872588596382822440');" onmouseout="out('6872588596382822440');" style=""> 237          if (BroadleafRequestContext.getBroadleafRequestContext() != null) {                                       </span>
<span class="8302259492819337972" onmouseenter="enter('8302259492819337972');" onmouseout="out('8302259492819337972');" style=""> 238              namedOrder.setLocale(BroadleafRequestContext.getBroadleafRequestContext().getLocale());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239          }                                                                                                         </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-4755266802229314023" onmouseenter="enter('-4755266802229314023');" onmouseout="out('-4755266802229314023');" style=""> 241          return persist(namedOrder); // No need to price here                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span  style=""> 243                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244      @Override                                                                                                     </span>
<span class="-5228222697072727023" onmouseenter="enter('-5228222697072727023');" onmouseout="out('-5228222697072727023');" style=""> 245      public Order findNamedOrderForCustomer(String name, Customer customer) {                                      </span>
<span class="3593606300255125692" onmouseenter="enter('3593606300255125692');" onmouseout="out('3593606300255125692');" style=""> 246          return orderDao.readNamedOrderForCustomer(customer, name);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247      }                                                                                                             </span>
<span  style=""> 248                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 249      @Override                                                                                                     </span>
<span class="-3536100433526278820" onmouseenter="enter('-3536100433526278820');" onmouseout="out('-3536100433526278820');" style=""> 250      public Order findOrderById(Long orderId) {                                                                    </span>
<span class="1161210593743093685" onmouseenter="enter('1161210593743093685');" onmouseout="out('1161210593743093685');" style=""> 251          return orderDao.readOrderById(orderId);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252      }                                                                                                             </span>
<span  style=""> 253                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 254      @Override                                                                                                     </span>
<span class="3514330874800299886" onmouseenter="enter('3514330874800299886');" onmouseout="out('3514330874800299886');" style=""> 255      public List&lt;Order&gt; findOrdersByIds(List&lt;Long&gt; orderIds) {                                                     </span>
<span class="-3891915877440809040" onmouseenter="enter('-3891915877440809040');" onmouseout="out('-3891915877440809040');" style=""> 256          return orderDao.readOrdersByIds(orderIds);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257      }                                                                                                             </span>
<span  style=""> 258                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 259      @Override                                                                                                     </span>
<span class="4729011646907808921" onmouseenter="enter('4729011646907808921');" onmouseout="out('4729011646907808921');" style=""> 260      public Order findOrderById(Long orderId, boolean refresh) {                                                   </span>
<span class="-1498807655754375115" onmouseenter="enter('-1498807655754375115');" onmouseout="out('-1498807655754375115');" style=""> 261          return orderDao.readOrderById(orderId, refresh);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span  style=""> 263                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 264      @Override                                                                                                     </span>
<span class="6472182469411690717" onmouseenter="enter('6472182469411690717');" onmouseout="out('6472182469411690717');" style=""> 265      public Order getNullOrder() {                                                                                 </span>
<span class="-9215158658227454796" onmouseenter="enter('-9215158658227454796');" onmouseout="out('-9215158658227454796');" style=""> 266          return nullOrderFactory.getNullOrder();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267      }                                                                                                             </span>
<span  style=""> 268                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 269      @Override                                                                                                     </span>
<span class="-868163728006062843" onmouseenter="enter('-868163728006062843');" onmouseout="out('-868163728006062843');" style=""> 270      public Order findCartForCustomer(Customer customer) {                                                         </span>
<span class="8766840141038390904" onmouseenter="enter('8766840141038390904');" onmouseout="out('8766840141038390904');" style=""> 271          return orderDao.readCartForCustomer(customer);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272      }                                                                                                             </span>
<span  style=""> 273                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 274      @Override                                                                                                     </span>
<span class="-7652784715167872669" onmouseenter="enter('-7652784715167872669');" onmouseout="out('-7652784715167872669');" style=""> 275      public List&lt;Order&gt; findOrdersForCustomer(Customer customer) {                                                 </span>
<span class="-1451410109320389957" onmouseenter="enter('-1451410109320389957');" onmouseout="out('-1451410109320389957');" style=""> 276          return orderDao.readOrdersForCustomer(customer.getId());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277      }                                                                                                             </span>
<span  style=""> 278                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 279      @Override                                                                                                     </span>
<span class="-1874817631753699552" onmouseenter="enter('-1874817631753699552');" onmouseout="out('-1874817631753699552');" style=""> 280      public List&lt;Order&gt; findOrdersForCustomer(Customer customer, OrderStatus status) {                             </span>
<span class="8303115895394445841" onmouseenter="enter('8303115895394445841');" onmouseout="out('8303115895394445841');" style=""> 281          return orderDao.readOrdersForCustomer(customer, status);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282      }                                                                                                             </span>
<span  style=""> 283                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 284      @Override                                                                                                     </span>
<span class="-5868034956931005765" onmouseenter="enter('-5868034956931005765');" onmouseout="out('-5868034956931005765');" style=""> 285      public Order findOrderByOrderNumber(String orderNumber) {                                                     </span>
<span class="4126063111294586184" onmouseenter="enter('4126063111294586184');" onmouseout="out('4126063111294586184');" style=""> 286          return orderDao.readOrderByOrderNumber(orderNumber);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287      }                                                                                                             </span>
<span  style=""> 288                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 289      @Override                                                                                                     </span>
<span class="4191009625455802778" onmouseenter="enter('4191009625455802778');" onmouseout="out('4191009625455802778');" style=""> 290      public List&lt;Order&gt; findOrdersByDateRange(Date startDate, Date endDate) {                                      </span>
<span class="4159366983783237003" onmouseenter="enter('4159366983783237003');" onmouseout="out('4159366983783237003');" style=""> 291          return orderDao.readOrdersByDateRange(startDate, endDate);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292      }                                                                                                             </span>
<span  style=""> 293                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 294      @Override                                                                                                     </span>
<span class="-5094637214545511446" onmouseenter="enter('-5094637214545511446');" onmouseout="out('-5094637214545511446');" style=""> 295      public List&lt;Order&gt; findOrdersByDaysCount(Integer daysCount, Integer batchSize) {                              </span>
<span class="-5623433853176777156" onmouseenter="enter('-5623433853176777156');" onmouseout="out('-5623433853176777156');" style=""> 296          return orderDao.readOrdersOlderThanDaysCount(daysCount, batchSize);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297      }                                                                                                             </span>
<span  style=""> 298                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 299      @Override                                                                                                     </span>
<span class="7584459338142486264" onmouseenter="enter('7584459338142486264');" onmouseout="out('7584459338142486264');" style=""> 300      public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endDate) {  </span>
<span class="-7476578265182813965" onmouseenter="enter('-7476578265182813965');" onmouseout="out('-7476578265182813965');" style=""> 301          return orderDao.readOrdersForCustomersInDateRange(customerIds, startDate, endDate);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span  style=""> 303                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 304      @Override                                                                                                     </span>
<span class="2742799531036946157" onmouseenter="enter('2742799531036946157');" onmouseout="out('2742799531036946157');" style=""> 305      public List&lt;OrderPayment&gt; findPaymentsForOrder(Order order) {                                                 </span>
<span class="-8492719680919611182" onmouseenter="enter('-8492719680919611182');" onmouseout="out('-8492719680919611182');" style=""> 306          return paymentDao.readPaymentsForOrder(order);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307      }                                                                                                             </span>
<span  style=""> 308                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 309      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 310      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-3332960922797777344" onmouseenter="enter('-3332960922797777344');" onmouseout="out('-3332960922797777344');" style=""> 311      public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfo) {      </span>
<span class="5531588484946379356" onmouseenter="enter('5531588484946379356');" onmouseout="out('5531588484946379356');" style=""> 312          payment.setOrder(order);                                                                                  </span>
<span class="-5902578581570361338" onmouseenter="enter('-5902578581570361338');" onmouseout="out('-5902578581570361338');" style=""> 313          order.getPayments().add(payment);                                                                         </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 314          order = persist(order);                                                                                   </span>
<span class="3102030919604467575" onmouseenter="enter('3102030919604467575');" onmouseout="out('3102030919604467575');" style=""> 315          int paymentIndex = order.getPayments().size() - 1;                                                        </span>
<span  style=""> 316                                                                                                                    </span>
<span class="-1059731582497422542" onmouseenter="enter('-1059731582497422542');" onmouseout="out('-1059731582497422542');" style=""> 317          if (securePaymentInfo != null) {                                                                          </span>
<span class="-3146705087638884484" onmouseenter="enter('-3146705087638884484');" onmouseout="out('-3146705087638884484');" style=""> 318              securePaymentInfoService.save(securePaymentInfo);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319          }                                                                                                         </span>
<span  style=""> 320                                                                                                                    </span>
<span class="-7441301587762344543" onmouseenter="enter('-7441301587762344543');" onmouseout="out('-7441301587762344543');" style=""> 321          return order.getPayments().get(paymentIndex);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322      }                                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 324      @Override                                                                                                     </span>
<span class="-6260636294738378695" onmouseenter="enter('-6260636294738378695');" onmouseout="out('-6260636294738378695');" style=""> 325      public Order save(Order order, boolean priceOrder, boolean repriceItems) throws PricingException {            </span>
<span class="-861950305740674202" onmouseenter="enter('-861950305740674202');" onmouseout="out('-861950305740674202');" style=""> 326          if (repriceItems) {                                                                                       </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 327              order.updatePrices();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328          }                                                                                                         </span>
<span class="7466161317523035871" onmouseenter="enter('7466161317523035871');" onmouseout="out('7466161317523035871');" style=""> 329          return save(order, priceOrder);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330      }                                                                                                             </span>
<span  style=""> 331                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 332      @Override                                                                                                     </span>
<span class="3492049941937307387" onmouseenter="enter('3492049941937307387');" onmouseout="out('3492049941937307387');" style=""> 333      public Order save(Order order, Boolean priceOrder) throws PricingException {                                  </span>
<span class="-7596987583027747839" onmouseenter="enter('-7596987583027747839');" onmouseout="out('-7596987583027747839');" style=""> 334          //persist the order first                                                                                 </span>
<span class="-389595421943223582" onmouseenter="enter('-389595421943223582');" onmouseout="out('-389595421943223582');" style=""> 335          TransactionStatus status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 336                      TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 337          try {                                                                                                     </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 338              order = persist(order);                                                                               </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 339              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 340          } catch (RuntimeException ex) {                                                                           </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 341              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 342              throw ex;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343          }                                                                                                         </span>
<span  style=""> 344                                                                                                                    </span>
<span class="3415408115507489273" onmouseenter="enter('3415408115507489273');" onmouseout="out('3415408115507489273');" style=""> 345          //make any pricing changes - possibly retrying with the persisted state if there&#x27;s a lock failure         </span>
<span class="3259489568218221951" onmouseenter="enter('3259489568218221951');" onmouseout="out('3259489568218221951');" style=""> 346          if (priceOrder) {                                                                                         </span>
<span class="1922471648485581677" onmouseenter="enter('1922471648485581677');" onmouseout="out('1922471648485581677');" style=""> 347              int retryCount = 0;                                                                                   </span>
<span class="-3964676588024243488" onmouseenter="enter('-3964676588024243488');" onmouseout="out('-3964676588024243488');" style=""> 348              boolean isValid = false;                                                                              </span>
<span class="-6184322868026722475" onmouseenter="enter('-6184322868026722475');" onmouseout="out('-6184322868026722475');" style=""> 349              while (!isValid) {                                                                                    </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 350                  Session session = em.unwrap(Session.class);                                                       </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 351                  FlushMode current = session.getHibernateFlushMode();                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 352                  try {                                                                                             </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 353                      if (!autoFlushSaveCart) {                                                                     </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 354                          //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 354                          //Performance measure. Hibernate will sometimes perform an autoflush when performing queryðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 355                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 355                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 356                          //incorrect results because something has not been flushed to the database yet.           </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 357                          session.setHibernateFlushMode(FlushMode.MANUAL);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358                      }                                                                                             </span>
<span class="8892823389652271355" onmouseenter="enter('8892823389652271355');" onmouseout="out('8892823389652271355');" style=""> 359                      order = pricingService.executePricing(order);                                                 </span>
<span class="9041443712359372060" onmouseenter="enter('9041443712359372060');" onmouseout="out('9041443712359372060');" style=""> 360                      isValid = true;                                                                               </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 361                  } catch (Exception ex) {                                                                          </span>
<span class="-2271119485062807010" onmouseenter="enter('-2271119485062807010');" onmouseout="out('-2271119485062807010');" style=""> 362                      boolean isValidCause = false;                                                                 </span>
<span class="-500838144782668299" onmouseenter="enter('-500838144782668299');" onmouseout="out('-500838144782668299');" style=""> 363                      Throwable cause = ex;                                                                         </span>
<span class="1460063134918401876" onmouseenter="enter('1460063134918401876');" onmouseout="out('1460063134918401876');" style=""> 364                      while (!isValidCause) {                                                                       </span>
<span class="4260495870590788788" onmouseenter="enter('4260495870590788788');" onmouseout="out('4260495870590788788');" style=""> 365                          if (cause.getClass().equals(LockAcquisitionException.class)) {                            </span>
<span class="-2629587088788625810" onmouseenter="enter('-2629587088788625810');" onmouseout="out('-2629587088788625810');" style=""> 366                              isValidCause = true;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367                          }                                                                                         </span>
<span class="8625050852301041214" onmouseenter="enter('8625050852301041214');" onmouseout="out('8625050852301041214');" style=""> 368                          cause = cause.getCause();                                                                 </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style=""> 369                          if (cause == null) {                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 370                              break;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372                      }                                                                                             </span>
<span class="617128514241385440" onmouseenter="enter('617128514241385440');" onmouseout="out('617128514241385440');" style=""> 373                      if (isValidCause) {                                                                           </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 374                          if (LOG.isInfoEnabled()) {                                                                </span>
<span class="-1515480896436827747" onmouseenter="enter('-1515480896436827747');" onmouseout="out('-1515480896436827747');" style=""> 375                              LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price again.&quot;);  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376                          }                                                                                         </span>
<span class="-5133746822051192612" onmouseenter="enter('-5133746822051192612');" onmouseout="out('-5133746822051192612');" style=""> 377                          isValid = false;                                                                          </span>
<span class="4577651777641283233" onmouseenter="enter('4577651777641283233');" onmouseout="out('4577651777641283233');" style=""> 378                          if (retryCount &gt;= pricingRetryCountForLockFailure) {                                      </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 379                              if (LOG.isInfoEnabled()) {                                                            </span>
<span class="8668513794109504150" onmouseenter="enter('8668513794109504150');" onmouseout="out('8668513794109504150');" style=""><abbr title=" 380                                  LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; + retryCount + &quot;). Throwing exception.&quot;);"> 380                                  LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; +ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                              }                                                                                     </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 382                              if (ex instanceof PricingException) {                                                 </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 383                                  throw (PricingException) ex;                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 384                              } else {                                                                              </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 385                                  throw new PricingException(ex);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 387                          } else {                                                                                  </span>
<span class="-1359453246670658998" onmouseenter="enter('-1359453246670658998');" onmouseout="out('-1359453246670658998');" style=""> 388                              order = findOrderById(order.getId());                                                 </span>
<span class="1564014130404929121" onmouseenter="enter('1564014130404929121');" onmouseout="out('1564014130404929121');" style=""> 389                              retryCount++;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 391                          try {                                                                                     </span>
<span class="-1188508433081841324" onmouseenter="enter('-1188508433081841324');" onmouseout="out('-1188508433081841324');" style=""> 392                              Thread.sleep(pricingRetryWaitIntervalForLockFailure);                                 </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style=""> 393                          } catch (Throwable e) {                                                                   </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 394                              //do nothing                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                          }                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 396                      } else {                                                                                      </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 397                          if (ex instanceof PricingException) {                                                     </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 398                              throw (PricingException) ex;                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 399                          } else {                                                                                  </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 400                              throw new PricingException(ex);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402                      }                                                                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 403                  } finally {                                                                                       </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 404                      if (!autoFlushSaveCart) {                                                                     </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 405                          session.setHibernateFlushMode(current);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408              }                                                                                                     </span>
<span  style=""> 409                                                                                                                    </span>
<span class="-3104014921676861204" onmouseenter="enter('-3104014921676861204');" onmouseout="out('-3104014921676861204');" style=""> 410              //make the final save of the priced order                                                             </span>
<span class="-5185576183489418340" onmouseenter="enter('-5185576183489418340');" onmouseout="out('-5185576183489418340');" style=""> 411              status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                              </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 412                                  TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                  </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 413              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 414              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 415              try {                                                                                                 </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 416                  if (!autoFlushSaveCart) {                                                                         </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 417                      //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 417                      //Performance measure. Hibernate will sometimes perform an autoflush when performing query opeðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 418                      //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 418                      //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in tðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 419                      //incorrect results because something has not been flushed to the database yet.               </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 420                      session.setHibernateFlushMode(FlushMode.MANUAL);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421                  }                                                                                                 </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 422                  order = persist(order);                                                                           </span>
<span  style=""> 423                                                                                                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 424                  if (extensionManager != null) {                                                                   </span>
<span class="3957126338116198589" onmouseenter="enter('3957126338116198589');" onmouseout="out('3957126338116198589');" style=""> 425                      extensionManager.getProxy().attachAdditionalDataToOrder(order, priceOrder);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                  }                                                                                                 </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 427                  if (!autoFlushSaveCart) {                                                                         </span>
<span class="-582956567966567765" onmouseenter="enter('-582956567966567765');" onmouseout="out('-582956567966567765');" style=""> 428                      session.setFlushMode(current);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429                  }                                                                                                 </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 430                  TransactionUtils.finalizeTransaction(status, transactionManager, false);                          </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 431              } catch (RuntimeException ex) {                                                                       </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 432                  TransactionUtils.finalizeTransaction(status, transactionManager, true);                           </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 433                  throw ex;                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 434              } finally {                                                                                           </span>
<span class="8320148466827839591" onmouseenter="enter('8320148466827839591');" onmouseout="out('8320148466827839591');" style=""> 435                  if (!autoFlushSaveCart &amp;&amp; !session.getFlushMode().equals(current)) {                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 436                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439          }                                                                                                         </span>
<span  style=""> 440                                                                                                                    </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 441          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442      }                                                                                                             </span>
<span  style=""> 443                                                                                                                    </span>
<span class="3548225205011979861" onmouseenter="enter('3548225205011979861');" onmouseout="out('3548225205011979861');" style=""> 444      // This method exists to provide OrderService methods the ability to save an order                            </span>
<span class="-3137042620959847201" onmouseenter="enter('-3137042620959847201');" onmouseout="out('-3137042620959847201');" style=""> 445      // without having to worry about a PricingException being thrown.                                             </span>
<span class="-8294379095766791864" onmouseenter="enter('-8294379095766791864');" onmouseout="out('-8294379095766791864');" style=""> 446      protected Order persist(Order order) {                                                                        </span>
<span class="8818772614490614908" onmouseenter="enter('8818772614490614908');" onmouseout="out('8818772614490614908');" style=""> 447          return orderDao.save(order);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448      }                                                                                                             </span>
<span  style=""> 449                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 450      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 451      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="1194611983531410278" onmouseenter="enter('1194611983531410278');" onmouseout="out('1194611983531410278');" style=""> 452      public void cancelOrder(Order order) {                                                                        </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 453          orderDao.delete(order);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454      }                                                                                                             </span>
<span  style=""> 455                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 456      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 457      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="3151062967360623973" onmouseenter="enter('3151062967360623973');" onmouseout="out('3151062967360623973');" style=""> 458      public void deleteOrder(Order order) {                                                                        </span>
<span class="362561214599706117" onmouseenter="enter('362561214599706117');" onmouseout="out('362561214599706117');" style=""> 459          orderMultishipOptionService.deleteAllOrderMultishipOptions(order);                                        </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 460          orderDao.delete(order);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461      }                                                                                                             </span>
<span  style=""> 462                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 463      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 464      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6908985997151819220" onmouseenter="enter('-6908985997151819220');" onmouseout="out('-6908985997151819220');" style=""><abbr title=" 465      public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferException {"> 465      public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferðŸ”µ</abbr></span>
<span class="-6957816096303048614" onmouseenter="enter('-6957816096303048614');" onmouseout="out('-6957816096303048614');" style=""> 466          ArrayList&lt;OfferCode&gt; offerCodes = new ArrayList&lt;OfferCode&gt;();                                             </span>
<span class="-3489605780287301859" onmouseenter="enter('-3489605780287301859');" onmouseout="out('-3489605780287301859');" style=""> 467          offerCodes.add(offerCode);                                                                                </span>
<span class="5360942362216082169" onmouseenter="enter('5360942362216082169');" onmouseout="out('5360942362216082169');" style=""> 468          return addOfferCodes(order, offerCodes, priceOrder);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469      }                                                                                                             </span>
<span  style=""> 470                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 471      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 472      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6002760974922308486" onmouseenter="enter('-6002760974922308486');" onmouseout="out('-6002760974922308486');" style=""><abbr title=" 473      public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingException, OfferException {"> 473      public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingExceptioðŸ”µ</abbr></span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 474          preValidateCartOperation(order);                                                                          </span>
<span class="-6297044254079066685" onmouseenter="enter('-6297044254079066685');" onmouseout="out('-6297044254079066685');" style=""> 475          Set&lt;Offer&gt; addedOffers = offerService.getUniqueOffersFromOrder(order);                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 476          if (extensionManager != null) {                                                                           </span>
<span class="4843221393928633011" onmouseenter="enter('4843221393928633011');" onmouseout="out('4843221393928633011');" style=""> 477              extensionManager.getProxy().addOfferCodes(order, offerCodes, priceOrder);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span class="-5013116012900958115" onmouseenter="enter('-5013116012900958115');" onmouseout="out('-5013116012900958115');" style=""> 479          if (offerCodes != null &amp;&amp; !offerCodes.isEmpty()) {                                                        </span>
<span class="8649045155270180220" onmouseenter="enter('8649045155270180220');" onmouseout="out('8649045155270180220');" style=""> 480              for (OfferCode offerCode : offerCodes) {                                                              </span>
<span  style=""> 481                                                                                                                    </span>
<span class="-7298696073195110538" onmouseenter="enter('-7298696073195110538');" onmouseout="out('-7298696073195110538');" style=""><abbr title=" 482                  if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) {"> 482                  if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) ðŸ”µ</abbr></span>
<span class="6234350320401768221" onmouseenter="enter('6234350320401768221');" onmouseout="out('6234350320401768221');" style=""> 483                      throw new OfferAlreadyAddedException(&quot;The offer has already been added.&quot;);                    </span>
<span class="-3830868071340909057" onmouseenter="enter('-3830868071340909057');" onmouseout="out('-3830868071340909057');" style=""> 484                  } else if (!offerService.verifyMaxCustomerUsageThreshold(order, offerCode)) {                     </span>
<span class="4333070718197812940" onmouseenter="enter('4333070718197812940');" onmouseout="out('4333070718197812940');" style=""><abbr title=" 485                      throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maximum allowed number of times.&quot;);"> 485                      throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maðŸ”µ</abbr></span>
<span class="-5924935946468451057" onmouseenter="enter('-5924935946468451057');" onmouseout="out('-5924935946468451057');" style=""> 486                  } else if (!offerCode.isActive() || !offerCode.getOffer().isActive()) {                           </span>
<span class="-5410451342198456207" onmouseenter="enter('-5410451342198456207');" onmouseout="out('-5410451342198456207');" style=""> 487                      throw new OfferExpiredException(&quot;The offer has expired.&quot;);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488                  }                                                                                                 </span>
<span  style=""> 489                                                                                                                    </span>
<span class="-8263838424494001377" onmouseenter="enter('-8263838424494001377');" onmouseout="out('-8263838424494001377');" style=""> 490                  order.getAddedOfferCodes().add(offerCode);                                                        </span>
<span  style=""> 491                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492              }                                                                                                     </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 493              order = save(order, priceOrder);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494          }                                                                                                         </span>
<span  style=""> 495                                                                                                                    </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 496          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497      }                                                                                                             </span>
<span  style=""> 498                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 499      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 500      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-8165165962317769711" onmouseenter="enter('-8165165962317769711');" onmouseout="out('-8165165962317769711');" style=""> 501      public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException {  </span>
<span class="7292636042273352545" onmouseenter="enter('7292636042273352545');" onmouseout="out('7292636042273352545');" style=""> 502          order.getAddedOfferCodes().remove(offerCode);                                                             </span>
<span class="-7106254142148835248" onmouseenter="enter('-7106254142148835248');" onmouseout="out('-7106254142148835248');" style=""> 503          offerServiceExtensionManager.removeOfferCodeFromOrder(offerCode, order);                                  </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 504          order = save(order, priceOrder);                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 505          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506      }                                                                                                             </span>
<span  style=""> 507                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 508      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 509      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1709915701203298020" onmouseenter="enter('-1709915701203298020');" onmouseout="out('-1709915701203298020');" style=""> 510      public Order removeAllOfferCodes(Order order, boolean priceOrder) throws PricingException {                   </span>
<span class="-6954607053476807171" onmouseenter="enter('-6954607053476807171');" onmouseout="out('-6954607053476807171');" style=""> 511           order.getAddedOfferCodes().clear();                                                                      </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 512           order = save(order, priceOrder);                                                                         </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 513           return order;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514      }                                                                                                             </span>
<span  style=""> 515                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 516      @Override                                                                                                     </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 517      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 517      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimðŸ”µ</abbr></span>
<span class="6605929857558449758" onmouseenter="enter('6605929857558449758');" onmouseout="out('6605929857558449758');" style=""> 518      public void setDeleteEmptyNamedOrders(boolean deleteEmptyNamedOrders) {                                       </span>
<span class="-5922450764665272748" onmouseenter="enter('-5922450764665272748');" onmouseout="out('-5922450764665272748');" style=""> 519          this.deleteEmptyNamedOrders = deleteEmptyNamedOrders;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span  style=""> 521                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 522      @Override                                                                                                     </span>
<span class="8809427274039428572" onmouseenter="enter('8809427274039428572');" onmouseout="out('8809427274039428572');" style=""> 523      public OrderItem findLastMatchingItem(Order order, Long skuId, Long productId) {                              </span>
<span class="3897119298100986011" onmouseenter="enter('3897119298100986011');" onmouseout="out('3897119298100986011');" style=""> 524          if (order.getOrderItems() != null) {                                                                      </span>
<span class="3057467599356722650" onmouseenter="enter('3057467599356722650');" onmouseout="out('3057467599356722650');" style=""> 525              for (int i=(order.getOrderItems().size()-1); i &gt;= 0; i--) {                                           </span>
<span class="-8753960614479292481" onmouseenter="enter('-8753960614479292481');" onmouseout="out('-8753960614479292481');" style=""> 526                  OrderItem currentItem = (order.getOrderItems().get(i));                                           </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style=""> 527                  if (currentItem instanceof DiscreteOrderItem) {                                                   </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style=""> 528                      DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                             </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 529                      if (skuId != null) {                                                                          </span>
<span class="-8668132489177117394" onmouseenter="enter('-8668132489177117394');" onmouseout="out('-8668132489177117394');" style=""> 530                          if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId())) {       </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 531                              return discreteItem;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                          }                                                                                         </span>
<span class="2262602886329333955" onmouseenter="enter('2262602886329333955');" onmouseout="out('2262602886329333955');" style=""><abbr title=" 533                      } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteItem.getProduct().getId())) {"> 533                      } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 534                          return discreteItem;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                      }                                                                                             </span>
<span  style=""> 536                                                                                                                    </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style=""> 537                  } else if (currentItem instanceof BundleOrderItem) {                                              </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style=""> 538                      BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                                   </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 539                      if (skuId != null) {                                                                          </span>
<span class="-2960070722540544872" onmouseenter="enter('-2960070722540544872');" onmouseout="out('-2960070722540544872');" style=""> 540                          if (bundleItem.getSku() != null &amp;&amp; skuId.equals(bundleItem.getSku().getId())) {           </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 541                              return bundleItem;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                          }                                                                                         </span>
<span class="2116719638664851076" onmouseenter="enter('2116719638664851076');" onmouseout="out('2116719638664851076');" style=""><abbr title=" 543                      } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItem.getProduct().getId())) {"> 543                      } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItemðŸ”µ</abbr></span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 544                          return bundleItem;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 549          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550      }                                                                                                             </span>
<span  style=""> 551                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 552      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 553      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6433964895207235713" onmouseenter="enter('-6433964895207235713');" onmouseout="out('-6433964895207235713');" style=""> 554      public Order confirmOrder(Order order) {                                                                      </span>
<span class="9181791888739176058" onmouseenter="enter('9181791888739176058');" onmouseout="out('9181791888739176058');" style=""> 555          return orderDao.submitOrder(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556      }                                                                                                             </span>
<span  style=""> 557                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 558      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 559      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1196063989926378996" onmouseenter="enter('-1196063989926378996');" onmouseout="out('-1196063989926378996');" style=""><abbr title=" 560      public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 560      public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 561          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 562          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 563              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564          }                                                                                                         </span>
<span class="6349420761965903996" onmouseenter="enter('6349420761965903996');" onmouseout="out('6349420761965903996');" style=""> 565          List&lt;OrderItem&gt; items = new ArrayList&lt;OrderItem&gt;(namedOrder.getOrderItems());                             </span>
<span  style=""> 566                                                                                                                    </span>
<span class="6607428262094447152" onmouseenter="enter('6607428262094447152');" onmouseout="out('6607428262094447152');" style=""> 567          // Remove any order items that are children                                                               </span>
<span class="7631703850134052237" onmouseenter="enter('7631703850134052237');" onmouseout="out('7631703850134052237');" style=""> 568          CollectionUtils.filter(items,  new TypedPredicate&lt;OrderItem&gt;() {                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 569              @Override                                                                                             </span>
<span class="4901231018495450056" onmouseenter="enter('4901231018495450056');" onmouseout="out('4901231018495450056');" style=""> 570              public boolean eval(OrderItem orderItem) {                                                            </span>
<span class="-2481948952058789921" onmouseenter="enter('-2481948952058789921');" onmouseout="out('-2481948952058789921');" style=""> 571                  return orderItem.getParentOrderItem() == null;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 573          });                                                                                                       </span>
<span class="-4844745637831365496" onmouseenter="enter('-4844745637831365496');" onmouseout="out('-4844745637831365496');" style=""> 574          for (OrderItem item : items) {                                                                            </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 575              OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);  </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 576              cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                 </span>
<span  style=""> 577                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 578              if (moveNamedOrderItems) {                                                                            </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 579                  removeItem(namedOrder.getId(), item.getId(), false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581          }                                                                                                         </span>
<span  style=""> 582                                                                                                                    </span>
<span class="-6527299291227137901" onmouseenter="enter('-6527299291227137901');" onmouseout="out('-6527299291227137901');" style=""> 583          if (deleteEmptyNamedOrders) {                                                                             </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 584              cancelOrder(namedOrder);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585          }                                                                                                         </span>
<span  style=""> 586                                                                                                                    </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 587          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 590      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 591      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="486294103490899905" onmouseenter="enter('486294103490899905');" onmouseout="out('486294103490899905');" style=""><abbr title=" 592      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 592      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 593          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 594          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 595              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596          }                                                                                                         </span>
<span  style=""> 597                                                                                                                    </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 598          OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);      </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 599          cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                     </span>
<span  style=""> 600                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 601          if (moveNamedOrderItems) {                                                                                </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 602              removeItem(namedOrder.getId(), item.getId(), false);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603          }                                                                                                         </span>
<span  style=""> 604                                                                                                                    </span>
<span class="-3555431676535314681" onmouseenter="enter('-3555431676535314681');" onmouseout="out('-3555431676535314681');" style=""> 605          if (namedOrder.getOrderItems().size() == 0 &amp;&amp; deleteEmptyNamedOrders) {                                   </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 606              cancelOrder(namedOrder);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607          }                                                                                                         </span>
<span  style=""> 608                                                                                                                    </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 609          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610      }                                                                                                             </span>
<span  style=""> 611                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 612      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 613      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="6073762115033780324" onmouseenter="enter('6073762115033780324');" onmouseout="out('6073762115033780324');" style=""><abbr title=" 614      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws RemoveFromCartException, AddToCartException, UpdateCartException {"> 614      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws ðŸ”µ</abbr></span>
<span class="-6164187211557222893" onmouseenter="enter('-6164187211557222893');" onmouseout="out('-6164187211557222893');" style=""> 615          // Validate that the quantity requested makes sense                                                       </span>
<span class="632487064450637769" onmouseenter="enter('632487064450637769');" onmouseout="out('632487064450637769');" style=""> 616          if (quantity &lt; 1 || quantity &gt; item.getQuantity()) {                                                      </span>
<span class="9015263082333587317" onmouseenter="enter('9015263082333587317');" onmouseout="out('9015263082333587317');" style=""> 617              throw new IllegalArgumentException(&quot;Cannot move 0 or less quantity&quot;);                                 </span>
<span class="5237951611682684444" onmouseenter="enter('5237951611682684444');" onmouseout="out('5237951611682684444');" style=""> 618          } else if (quantity == item.getQuantity()) {                                                              </span>
<span class="-6422299663726892430" onmouseenter="enter('-6422299663726892430');" onmouseout="out('-6422299663726892430');" style=""> 619              return addItemFromNamedOrder(namedOrder, item, priceOrder);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620          }                                                                                                         </span>
<span  style=""> 621                                                                                                                    </span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 622          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 623          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 624              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625          }                                                                                                         </span>
<span  style=""> 626                                                                                                                    </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 627          OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);      </span>
<span class="8127078771873751614" onmouseenter="enter('8127078771873751614');" onmouseout="out('8127078771873751614');" style=""> 628          orderItemRequest.setQuantity(quantity);                                                                   </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 629          cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                     </span>
<span  style=""> 630                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 631          if (moveNamedOrderItems) {                                                                                </span>
<span class="-1872324351499578531" onmouseenter="enter('-1872324351499578531');" onmouseout="out('-1872324351499578531');" style=""> 632              // Update the old item to its new quantity only if we&#x27;re moving items                                 </span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 633              OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                                  </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 634              orderItemRequestDTO.setOrderItemId(item.getId());                                                     </span>
<span class="2294188755442690225" onmouseenter="enter('2294188755442690225');" onmouseout="out('2294188755442690225');" style=""> 635              orderItemRequestDTO.setQuantity(item.getQuantity() - quantity);                                       </span>
<span class="4972493477102298628" onmouseenter="enter('4972493477102298628');" onmouseout="out('4972493477102298628');" style=""> 636              updateItemQuantity(namedOrder.getId(), orderItemRequestDTO, false);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637          }                                                                                                         </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 638          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639      }                                                                                                             </span>
<span  style=""> 640                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 641      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 642      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1212731706886603863" onmouseenter="enter('-1212731706886603863');" onmouseout="out('-1212731706886603863');" style=""><abbr title=" 643      public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder) throws PricingException {"> 643      public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder)ðŸ”µ</abbr></span>
<span class="6582622510368580131" onmouseenter="enter('6582622510368580131');" onmouseout="out('6582622510368580131');" style=""> 644          GiftWrapOrderItem item = orderItemService.createGiftWrapOrderItem(itemRequest);                           </span>
<span class="-474933544378469288" onmouseenter="enter('-474933544378469288');" onmouseout="out('-474933544378469288');" style=""> 645          item.setOrder(order);                                                                                     </span>
<span class="-5871784861123565961" onmouseenter="enter('-5871784861123565961');" onmouseout="out('-5871784861123565961');" style=""> 646          item = (GiftWrapOrderItem) orderItemService.saveOrderItem(item);                                          </span>
<span  style=""> 647                                                                                                                    </span>
<span class="6197964192831249775" onmouseenter="enter('6197964192831249775');" onmouseout="out('6197964192831249775');" style=""> 648          order.getOrderItems().add(item);                                                                          </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 649          order = save(order, priceOrder);                                                                          </span>
<span  style=""> 650                                                                                                                    </span>
<span class="-3331987500944083076" onmouseenter="enter('-3331987500944083076');" onmouseout="out('-3331987500944083076');" style=""> 651          return item;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652      }                                                                                                             </span>
<span  style=""> 653                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 654      @Override                                                                                                     </span>
<span class="684519713081169381" onmouseenter="enter('684519713081169381');" onmouseout="out('684519713081169381');" style=""> 655      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {AddToCartException.class})                      </span>
<span class="4069854779845915812" onmouseenter="enter('4069854779845915812');" onmouseout="out('4069854779845915812');" style=""><abbr title=" 656      public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 656      public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCaðŸ”µ</abbr></span>
<span class="-1143974214922837949" onmouseenter="enter('-1143974214922837949');" onmouseout="out('-1143974214922837949');" style=""> 657          // Don&#x27;t allow overrides from this method.                                                                </span>
<span class="8194194096343660389" onmouseenter="enter('8194194096343660389');" onmouseout="out('8194194096343660389');" style=""> 658          orderItemRequestDTO.setOverrideRetailPrice(null);                                                         </span>
<span class="-5206909193534990943" onmouseenter="enter('-5206909193534990943');" onmouseout="out('-5206909193534990943');" style=""> 659          orderItemRequestDTO.setOverrideSalePrice(null);                                                           </span>
<span class="-7735674882921518291" onmouseenter="enter('-7735674882921518291');" onmouseout="out('-7735674882921518291');" style=""> 660          return addItemWithPriceOverrides(orderId, orderItemRequestDTO, priceOrder);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661      }                                                                                                             </span>
<span  style=""> 662                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 663      @Override                                                                                                     </span>
<span class="-670805249178869687" onmouseenter="enter('-670805249178869687');" onmouseout="out('-670805249178869687');" style=""> 664      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { AddToCartException.class })                    </span>
<span class="2295594549845892145" onmouseenter="enter('2295594549845892145');" onmouseout="out('2295594549845892145');" style=""><abbr title=" 665      public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 665      public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrdðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 666          Order order = findOrderById(orderId);                                                                     </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 667          preValidateCartOperation(order);                                                                          </span>
<span class="2914653273227801204" onmouseenter="enter('2914653273227801204');" onmouseout="out('2914653273227801204');" style=""> 668          if (getAutomaticallyMergeLikeItems()) {                                                                   </span>
<span class="-1260995424369374686" onmouseenter="enter('-1260995424369374686');" onmouseout="out('-1260995424369374686');" style=""> 669              OrderItem item = findMatchingItem(order, orderItemRequestDTO);                                        </span>
<span class="-4741837152748801640" onmouseenter="enter('-4741837152748801640');" onmouseout="out('-4741837152748801640');" style=""> 670              if (item != null &amp;&amp; item.getParentOrderItem() == null) {                                              </span>
<span class="8907881414365549792" onmouseenter="enter('8907881414365549792');" onmouseout="out('8907881414365549792');" style=""> 671                  orderItemRequestDTO.setQuantity(item.getQuantity() + orderItemRequestDTO.getQuantity());          </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 672                  orderItemRequestDTO.setOrderItemId(item.getId());                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 673                  try {                                                                                             </span>
<span class="-1392380570648359537" onmouseenter="enter('-1392380570648359537');" onmouseout="out('-1392380570648359537');" style=""> 674                      return updateItemQuantity(orderId, orderItemRequestDTO, priceOrder);                          </span>
<span class="2264439919030346254" onmouseenter="enter('2264439919030346254');" onmouseout="out('2264439919030346254');" style=""> 675                  } catch (RemoveFromCartException e) {                                                             </span>
<span class="3695461348108676960" onmouseenter="enter('3695461348108676960');" onmouseout="out('3695461348108676960');" style=""><abbr title=" 676                      throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cart&quot;, e);"> 676                      throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cðŸ”µ</abbr></span>
<span class="-268181248887409465" onmouseenter="enter('-268181248887409465');" onmouseout="out('-268181248887409465');" style=""> 677                  } catch (UpdateCartException e) {                                                                 </span>
<span class="9009836242172298460" onmouseenter="enter('9009836242172298460');" onmouseout="out('9009836242172298460');" style=""> 678                      throw new AddToCartException(&quot;Could not update quantity for matched item&quot;, e);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 680              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 682          try {                                                                                                     </span>
<span class="5353648265182308095" onmouseenter="enter('5353648265182308095');" onmouseout="out('5353648265182308095');" style=""><abbr title=" 683              // We only want to price on the last addition for performance reasons and only if the user asked for it."> 683              // We only want to price on the last addition for performance reasons and only if the user asked for iðŸ”µ</abbr></span>
<span class="4429210190612929719" onmouseenter="enter('4429210190612929719');" onmouseout="out('4429210190612929719');" style=""> 684              int numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO)) : -1;           </span>
<span class="94226225238380310" onmouseenter="enter('94226225238380310');" onmouseout="out('94226225238380310');" style=""> 685              int currentAddition = 1;                                                                              </span>
<span  style=""> 686                                                                                                                    </span>
<span class="3086923041990690310" onmouseenter="enter('3086923041990690310');" onmouseout="out('3086923041990690310');" style=""><abbr title=" 687              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, currentAddition == numAdditionRequests);"> 687              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span  style=""> 688                                                                                                                    </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 689              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 690              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 691              if (!autoFlushAddToCart) {                                                                            </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 692                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 692                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operatiðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 693                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 693                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the fðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 694                  //incorrect results because something has not been flushed to the database yet.                   </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 695                  session.setHibernateFlushMode(FlushMode.MANUAL);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696              }                                                                                                     </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 697              ProcessContext&lt;CartOperationRequest&gt; context;                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 698              try {                                                                                                 </span>
<span class="1764939006998328340" onmouseenter="enter('1764939006998328340');" onmouseout="out('1764939006998328340');" style=""> 699                  context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequest);     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 700              } finally {                                                                                           </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 701                  if (!autoFlushAddToCart) {                                                                        </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 702                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704              }                                                                                                     </span>
<span  style=""> 705                                                                                                                    </span>
<span class="-507750410624174489" onmouseenter="enter('-507750410624174489');" onmouseout="out('-507750410624174489');" style=""> 706              List&lt;ActivityMessageDTO&gt; orderMessages = new ArrayList&lt;ActivityMessageDTO&gt;();                         </span>
<span class="-9090729846937660303" onmouseenter="enter('-9090729846937660303');" onmouseout="out('-9090729846937660303');" style=""> 707              orderMessages.addAll(((ActivityMessages) context).getActivityMessages());                             </span>
<span  style=""> 708                                                                                                                    </span>
<span class="7756277132938928975" onmouseenter="enter('7756277132938928975');" onmouseout="out('7756277132938928975');" style=""> 709              // Update the orderItemRequest incase it changed during the initial add to cart workflow              </span>
<span class="-7203895251723249067" onmouseenter="enter('-7203895251723249067');" onmouseout="out('-7203895251723249067');" style=""> 710              orderItemRequestDTO = context.getSeedData().getItemRequest();                                         </span>
<span class="4534199544912449864" onmouseenter="enter('4534199544912449864');" onmouseout="out('4534199544912449864');" style=""> 711              numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO) - 1) : -1;           </span>
<span class="4780820064776482606" onmouseenter="enter('4780820064776482606');" onmouseout="out('4780820064776482606');" style=""> 712              addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessages);     </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-2935463552695848258" onmouseenter="enter('-2935463552695848258');" onmouseout="out('-2935463552695848258');" style=""> 714              context.getSeedData().getOrder().setOrderMessages(orderMessages);                                     </span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 715              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 716          } catch (WorkflowException e) {                                                                           </span>
<span class="-1335771490090575105" onmouseenter="enter('-1335771490090575105');" onmouseout="out('-1335771490090575105');" style=""> 717              throw new AddToCartException(&quot;Could not add to cart&quot;, getCartOperationExceptionRootCause(e));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718          }                                                                                                         </span>
<span  style=""> 719                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720      }                                                                                                             </span>
<span  style=""> 721                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 722      @Override                                                                                                     </span>
<span class="-3516024114449400059" onmouseenter="enter('-3516024114449400059');" onmouseout="out('-3516024114449400059');" style=""> 723      public int getTotalChildOrderItems(OrderItemRequestDTO orderItemRequestDTO) {                                 </span>
<span class="-4883106140571490694" onmouseenter="enter('-4883106140571490694');" onmouseout="out('-4883106140571490694');" style=""> 724          int count = 1;                                                                                            </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 725          for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {                       </span>
<span class="-8452259100874171936" onmouseenter="enter('-8452259100874171936');" onmouseout="out('-8452259100874171936');" style=""> 726              count += getTotalChildOrderItems(childRequest);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 728          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729      }                                                                                                             </span>
<span  style=""> 730                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 731      @Override                                                                                                     </span>
<span class="6996885202551649754" onmouseenter="enter('6996885202551649754');" onmouseout="out('6996885202551649754');" style=""><abbr title=" 732      public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAddition, ProcessContext&lt;CartOperationRequest&gt; context, List&lt;ActivityMessageDTO&gt; orderMessages) throws WorkflowException {"> 732      public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAdditioðŸ”µ</abbr></span>
<span class="8934449600530371968" onmouseenter="enter('8934449600530371968');" onmouseout="out('8934449600530371968');" style=""> 733          if (CollectionUtils.isNotEmpty(orderItemRequestDTO.getChildOrderItems())) {                               </span>
<span class="2491660913208132768" onmouseenter="enter('2491660913208132768');" onmouseout="out('2491660913208132768');" style=""> 734              Long parentOrderItemId = context.getSeedData().getOrderItem().getId();                                </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 735              for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {                   </span>
<span class="3535307469424733623" onmouseenter="enter('3535307469424733623');" onmouseout="out('3535307469424733623');" style=""> 736                  childRequest.setParentOrderItemId(parentOrderItemId);                                             </span>
<span class="-1408015228336766113" onmouseenter="enter('-1408015228336766113');" onmouseout="out('-1408015228336766113');" style=""> 737                  currentAddition++;                                                                                </span>
<span  style=""> 738                                                                                                                    </span>
<span class="-8953231422270651058" onmouseenter="enter('-8953231422270651058');" onmouseout="out('-8953231422270651058');" style=""> 739                  if (childRequest.getQuantity() &gt; 0) {                                                             </span>
<span class="1978205204114939470" onmouseenter="enter('1978205204114939470');" onmouseout="out('1978205204114939470');" style=""><abbr title=" 740                      CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrder(), childRequest, currentAddition == numAdditionRequests);"> 740                      CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 741                      Session session = em.unwrap(Session.class);                                                   </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 742                      FlushMode current = session.getHibernateFlushMode();                                          </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 743                      if (!autoFlushAddToCart) {                                                                    </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 744                          //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 744                          //Performance measure. Hibernate will sometimes perform an autoflush when performing queryðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 745                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 745                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 746                          //incorrect results because something has not been flushed to the database yet.           </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 747                          session.setHibernateFlushMode(FlushMode.MANUAL);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748                      }                                                                                             </span>
<span class="174091692271706246" onmouseenter="enter('174091692271706246');" onmouseout="out('174091692271706246');" style=""> 749                      ProcessContext&lt;CartOperationRequest&gt; childContext;                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 750                      try {                                                                                         </span>
<span class="3858921168069452982" onmouseenter="enter('3858921168069452982');" onmouseout="out('3858921168069452982');" style=""><abbr title=" 751                          childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCartOpRequest);"> 751                          childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCaðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 752                      } finally {                                                                                   </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 753                          if (!autoFlushAddToCart) {                                                                </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 754                              session.setHibernateFlushMode(current);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756                      }                                                                                             </span>
<span class="4342049387377288099" onmouseenter="enter('4342049387377288099');" onmouseout="out('4342049387377288099');" style=""> 757                      orderMessages.addAll(((ActivityMessages) childContext).getActivityMessages());                </span>
<span  style=""> 758                                                                                                                    </span>
<span class="5649628204352445838" onmouseenter="enter('5649628204352445838');" onmouseout="out('5649628204352445838');" style=""><abbr title=" 759                      addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages);"> 759                      addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages)ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763      }                                                                                                             </span>
<span  style=""> 764                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 765      @Override                                                                                                     </span>
<span class="-7880503742615035959" onmouseenter="enter('-7880503742615035959');" onmouseout="out('-7880503742615035959');" style=""><abbr title=" 766      public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrderItem) {"> 766      public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrdðŸ”µ</abbr></span>
<span class="7029662020876668277" onmouseenter="enter('7029662020876668277');" onmouseout="out('7029662020876668277');" style=""> 767          parentOrderItemRequest.getChildOrderItems().add(dependentOrderItem);                                      </span>
<span class="-5858860779658693712" onmouseenter="enter('-5858860779658693712');" onmouseout="out('-5858860779658693712');" style=""> 768          Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;() {     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 769              @Override                                                                                             </span>
<span class="-2632323703231374544" onmouseenter="enter('-2632323703231374544');" onmouseout="out('-2632323703231374544');" style=""> 770              public int compare(OrderItemRequestDTO o1, OrderItemRequestDTO o2) {                                  </span>
<span class="-7086966684703257080" onmouseenter="enter('-7086966684703257080');" onmouseout="out('-7086966684703257080');" style=""> 771                  BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));</span>
<span class="2876551709679172033" onmouseenter="enter('2876551709679172033');" onmouseout="out('2876551709679172033');" style=""> 772                  BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));</span>
<span class="-3284317440061231656" onmouseenter="enter('-3284317440061231656');" onmouseout="out('-3284317440061231656');" style=""> 773                  return o1DisplayOrder.compareTo(o2DisplayOrder);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 775          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776      }                                                                                                             </span>
<span  style=""> 777                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 778      @Override                                                                                                     </span>
<span class="-2531899947398484803" onmouseenter="enter('-2531899947398484803');" onmouseout="out('-2531899947398484803');" style=""><abbr title=" 779      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartException.class})"> 779      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartExceptiðŸ”µ</abbr></span>
<span class="5266336311751039225" onmouseenter="enter('5266336311751039225');" onmouseout="out('5266336311751039225');" style=""><abbr title=" 780      public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException, RemoveFromCartException {"> 780      public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) thrðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 781          Order order = findOrderById(orderId);                                                                     </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 782          preValidateCartOperation(order);                                                                          </span>
<span class="8786950828376343914" onmouseenter="enter('8786950828376343914');" onmouseout="out('8786950828376343914');" style=""> 783          preValidateUpdateQuantityOperation(findOrderById(orderId), orderItemRequestDTO);                          </span>
<span class="-2982195349177348585" onmouseenter="enter('-2982195349177348585');" onmouseout="out('-2982195349177348585');" style=""> 784          if (orderItemRequestDTO.getQuantity() == 0) {                                                             </span>
<span class="5934987267424355703" onmouseenter="enter('5934987267424355703');" onmouseout="out('5934987267424355703');" style=""> 785              return removeItem(orderId, orderItemRequestDTO.getOrderItemId(), priceOrder);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786          }                                                                                                         </span>
<span  style=""> 787                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 788          try {                                                                                                     </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 789              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 789              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 790              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 791              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 792              if (!autoFlushUpdateCart) {                                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 793                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 793                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operatiðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 794                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 794                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the fðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 795                  //incorrect results because something has not been flushed to the database yet.                   </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 796                  session.setHibernateFlushMode(FlushMode.MANUAL);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797              }                                                                                                     </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 798              ProcessContext&lt;CartOperationRequest&gt; context;                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 799              try {                                                                                                 </span>
<span class="4428072604906913766" onmouseenter="enter('4428072604906913766');" onmouseout="out('4428072604906913766');" style=""> 800                  context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpRequest);  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 801              } finally {                                                                                           </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 802                  if (!autoFlushUpdateCart) {                                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 803                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805              }                                                                                                     </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 806              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 806              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMesðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 807              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 808          } catch (WorkflowException e) {                                                                           </span>
<span class="-2443073899933101644" onmouseenter="enter('-2443073899933101644');" onmouseout="out('-2443073899933101644');" style=""><abbr title=" 809              throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e));"> 809              throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e))ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811      }                                                                                                             </span>
<span  style=""> 812                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 813      @Override                                                                                                     </span>
<span class="3069128547561385261" onmouseenter="enter('3069128547561385261');" onmouseout="out('3069128547561385261');" style=""> 814      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {RemoveFromCartException.class})                 </span>
<span class="-981474137904562454" onmouseenter="enter('-981474137904562454');" onmouseout="out('-981474137904562454');" style=""> 815      public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartException {  </span>
<span class="2236102352074340212" onmouseenter="enter('2236102352074340212');" onmouseout="out('2236102352074340212');" style=""> 816          preValidateCartOperation(findOrderById(orderId));                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 817          try {                                                                                                     </span>
<span class="-4288344051642570030" onmouseenter="enter('-4288344051642570030');" onmouseout="out('-4288344051642570030');" style=""> 818              OrderItem oi = orderItemService.readOrderItemById(orderItemId);                                       </span>
<span class="-5187230272054076771" onmouseenter="enter('-5187230272054076771');" onmouseout="out('-5187230272054076771');" style=""> 819              if (oi == null) {                                                                                     </span>
<span class="3942058861960606340" onmouseenter="enter('3942058861960606340');" onmouseout="out('3942058861960606340');" style=""> 820                  throw new WorkflowException(new ItemNotFoundException());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821              }                                                                                                     </span>
<span class="3816340933425228129" onmouseenter="enter('3816340933425228129');" onmouseout="out('3816340933425228129');" style=""> 822              List&lt;Long&gt; childrenToRemove = new ArrayList&lt;Long&gt;();                                                  </span>
<span class="-1993098536099392813" onmouseenter="enter('-1993098536099392813');" onmouseout="out('-1993098536099392813');" style=""> 823              if (oi instanceof BundleOrderItem) {                                                                  </span>
<span class="7271984761308517823" onmouseenter="enter('7271984761308517823');" onmouseout="out('7271984761308517823');" style=""> 824                  List&lt;DiscreteOrderItem&gt; bundledItems = ((BundleOrderItem) oi).getDiscreteOrderItems();            </span>
<span class="7517044148543156187" onmouseenter="enter('7517044148543156187');" onmouseout="out('7517044148543156187');" style=""> 825                  for (DiscreteOrderItem doi : bundledItems) {                                                      </span>
<span class="7367293631145453975" onmouseenter="enter('7367293631145453975');" onmouseout="out('7367293631145453975');" style=""> 826                      findAllChildrenToRemove(childrenToRemove, doi);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 828              } else {                                                                                              </span>
<span class="872231159337938033" onmouseenter="enter('872231159337938033');" onmouseout="out('872231159337938033');" style=""> 829                  findAllChildrenToRemove(childrenToRemove, oi);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830              }                                                                                                     </span>
<span class="-8102792542621025713" onmouseenter="enter('-8102792542621025713');" onmouseout="out('-8102792542621025713');" style=""> 831              for (Long childToRemove : childrenToRemove) {                                                         </span>
<span class="8117841110711526180" onmouseenter="enter('8117841110711526180');" onmouseout="out('8117841110711526180');" style=""> 832                  removeItemInternal(orderId, childToRemove, false);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833              }                                                                                                     </span>
<span  style=""> 834                                                                                                                    </span>
<span class="-2688850311015489500" onmouseenter="enter('-2688850311015489500');" onmouseout="out('-2688850311015489500');" style=""> 835              return removeItemInternal(orderId, orderItemId, priceOrder);                                          </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 836          } catch (WorkflowException e) {                                                                           </span>
<span class="2503031575434857017" onmouseenter="enter('2503031575434857017');" onmouseout="out('2503031575434857017');" style=""><abbr title=" 837              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e));"> 837              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e))ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839      }                                                                                                             </span>
<span  style=""> 840                                                                                                                    </span>
<span class="-7053318232843416816" onmouseenter="enter('-7053318232843416816');" onmouseout="out('-7053318232843416816');" style=""> 841      protected void findAllChildrenToRemove(List&lt;Long&gt; childrenToRemove, OrderItem orderItem){                     </span>
<span class="-8605703698739650954" onmouseenter="enter('-8605703698739650954');" onmouseout="out('-8605703698739650954');" style=""> 842          if (CollectionUtils.isNotEmpty(orderItem.getChildOrderItems())) {                                         </span>
<span class="-4353610703709163867" onmouseenter="enter('-4353610703709163867');" onmouseout="out('-4353610703709163867');" style=""> 843              for (OrderItem childOrderItem : orderItem.getChildOrderItems()) {                                     </span>
<span class="-6344861684690798964" onmouseenter="enter('-6344861684690798964');" onmouseout="out('-6344861684690798964');" style=""> 844                  findAllChildrenToRemove(childrenToRemove, childOrderItem);                                        </span>
<span class="-4081734193801812324" onmouseenter="enter('-4081734193801812324');" onmouseout="out('-4081734193801812324');" style=""> 845                  childrenToRemove.add(childOrderItem.getId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 848      }                                                                                                             </span>
<span  style=""> 849                                                                                                                    </span>
<span class="-9213800711467029414" onmouseenter="enter('-9213800711467029414');" onmouseout="out('-9213800711467029414');" style=""><abbr title=" 850      protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowException {"> 850      protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowExceptioðŸ”µ</abbr></span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 851          OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                                      </span>
<span class="279907255180715291" onmouseenter="enter('279907255180715291');" onmouseout="out('279907255180715291');" style=""> 852          orderItemRequestDTO.setOrderItemId(orderItemId);                                                          </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 853          CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 853          CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO,ðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 854          Session session = em.unwrap(Session.class);                                                               </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 855          FlushMode current = session.getHibernateFlushMode();                                                      </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 856          if (!autoFlushRemoveFromCart) {                                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 857              //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 857              //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations ðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 858              //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 858              //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 859              //incorrect results because something has not been flushed to the database yet.                       </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 860              session.setHibernateFlushMode(FlushMode.MANUAL);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861          }                                                                                                         </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 862          ProcessContext&lt;CartOperationRequest&gt; context;                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 863          try {                                                                                                     </span>
<span class="1281982438499352462" onmouseenter="enter('1281982438499352462');" onmouseout="out('1281982438499352462');" style=""> 864              context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequest);      </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 865          } finally {                                                                                               </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 866              if (!autoFlushRemoveFromCart) {                                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 867                  session.setHibernateFlushMode(current);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869          }                                                                                                         </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 870          context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 870          context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessageðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 871          return context.getSeedData().getOrder();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872      }                                                                                                             </span>
<span  style=""> 873                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 874      @Override                                                                                                     </span>
<span class="4101768281683729634" onmouseenter="enter('4101768281683729634');" onmouseout="out('4101768281683729634');" style=""> 875      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { RemoveFromCartException.class })               </span>
<span class="-3452873837479924235" onmouseenter="enter('-3452873837479924235');" onmouseout="out('-3452873837479924235');" style=""> 876      public Order removeInactiveItems(Long orderId, boolean priceOrder) throws RemoveFromCartException {           </span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 877          Order order = findOrderById(orderId);                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 878          try {                                                                                                     </span>
<span  style=""> 879                                                                                                                    </span>
<span class="-3956255490326849696" onmouseenter="enter('-3956255490326849696');" onmouseout="out('-3956255490326849696');" style=""> 880              for (OrderItem currentItem : new ArrayList&lt;OrderItem&gt;(order.getOrderItems())) {                       </span>
<span class="-219225588148279740" onmouseenter="enter('-219225588148279740');" onmouseout="out('-219225588148279740');" style=""> 881                  if (!currentItem.isSkuActive()) {                                                                 </span>
<span class="-2073025095864158325" onmouseenter="enter('-2073025095864158325');" onmouseout="out('-2073025095864158325');" style=""> 882                      removeItem(orderId, currentItem.getId(), priceOrder);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884              }                                                                                                     </span>
<span  style=""> 885                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 886          } catch (Exception e) {                                                                                   </span>
<span class="9087614266041334113" onmouseenter="enter('9087614266041334113');" onmouseout="out('9087614266041334113');" style=""> 887              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, e.getCause());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888          }                                                                                                         </span>
<span class="6784501458837890045" onmouseenter="enter('6784501458837890045');" onmouseout="out('6784501458837890045');" style=""> 889          return findOrderById(orderId);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890      }                                                                                                             </span>
<span  style=""> 891                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 892      @Override                                                                                                     </span>
<span class="-2286265725818600106" onmouseenter="enter('-2286265725818600106');" onmouseout="out('-2286265725818600106');" style=""> 893      public boolean getAutomaticallyMergeLikeItems() {                                                             </span>
<span  style=""> 894                                                                                                                    </span>
<span class="-8256644627815125391" onmouseenter="enter('-8256644627815125391');" onmouseout="out('-8256644627815125391');" style=""> 895          if (automaticallyMergeLikeItems != null) {                                                                </span>
<span class="2771319092236636517" onmouseenter="enter('2771319092236636517');" onmouseout="out('2771319092236636517');" style=""> 896              return automaticallyMergeLikeItems;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897          }                                                                                                         </span>
<span  style=""> 898                                                                                                                    </span>
<span class="-661470022029899741" onmouseenter="enter('-661470022029899741');" onmouseout="out('-661470022029899741');" style=""> 899          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;automatically.merge.like.items&quot;, true);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900      }                                                                                                             </span>
<span  style=""> 901                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 902      @Override                                                                                                     </span>
<span class="8909461220693294113" onmouseenter="enter('8909461220693294113');" onmouseout="out('8909461220693294113');" style=""> 903      public void setAutomaticallyMergeLikeItems(boolean automaticallyMergeLikeItems) {                             </span>
<span class="5376880332914447533" onmouseenter="enter('5376880332914447533');" onmouseout="out('5376880332914447533');" style=""> 904          this.automaticallyMergeLikeItems = automaticallyMergeLikeItems;                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905      }                                                                                                             </span>
<span  style=""> 906                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 907      @Override                                                                                                     </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 908      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 908      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeðŸ”µ</abbr></span>
<span class="3855774874983732975" onmouseenter="enter('3855774874983732975');" onmouseout="out('3855774874983732975');" style=""> 909      public boolean isMoveNamedOrderItems() {                                                                      </span>
<span class="-6652636869592443054" onmouseenter="enter('-6652636869592443054');" onmouseout="out('-6652636869592443054');" style=""> 910          return moveNamedOrderItems;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911      }                                                                                                             </span>
<span  style=""> 912                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 913      @Override                                                                                                     </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 914      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 914      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeðŸ”µ</abbr></span>
<span class="-1545993285048257021" onmouseenter="enter('-1545993285048257021');" onmouseout="out('-1545993285048257021');" style=""> 915      public void setMoveNamedOrderItems(boolean moveNamedOrderItems) {                                             </span>
<span class="-5896321919466635220" onmouseenter="enter('-5896321919466635220');" onmouseout="out('-5896321919466635220');" style=""> 916          this.moveNamedOrderItems = moveNamedOrderItems;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917      }                                                                                                             </span>
<span  style=""> 918                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 919      @Override                                                                                                     </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 920      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 920      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimðŸ”µ</abbr></span>
<span class="-1003289588467041676" onmouseenter="enter('-1003289588467041676');" onmouseout="out('-1003289588467041676');" style=""> 921      public boolean isDeleteEmptyNamedOrders() {                                                                   </span>
<span class="-7878461261897242645" onmouseenter="enter('-7878461261897242645');" onmouseout="out('-7878461261897242645');" style=""> 922          return deleteEmptyNamedOrders;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923      }                                                                                                             </span>
<span  style=""> 924                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 925      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 926      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-137537618393378808" onmouseenter="enter('-137537618393378808');" onmouseout="out('-137537618393378808');" style=""> 927      public void removeAllPaymentsFromOrder(Order order) {                                                         </span>
<span class="3869583275658522189" onmouseenter="enter('3869583275658522189');" onmouseout="out('3869583275658522189');" style=""> 928          removePaymentsFromOrder(order, null);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 929      }                                                                                                             </span>
<span  style=""> 930                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 931      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 932      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1085850343810485193" onmouseenter="enter('-1085850343810485193');" onmouseout="out('-1085850343810485193');" style=""> 933      public void removePaymentsFromOrder(Order order, PaymentType paymentInfoType) {                               </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 934          List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                                 </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 935          for (OrderPayment paymentInfo : order.getPayments()) {                                                    </span>
<span class="-6057897724905909333" onmouseenter="enter('-6057897724905909333');" onmouseout="out('-6057897724905909333');" style=""> 936              if (paymentInfoType == null || paymentInfoType.equals(paymentInfo.getType())) {                       </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 937                  infos.add(paymentInfo);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939          }                                                                                                         </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 940          order.getPayments().removeAll(infos);                                                                     </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 941          for (OrderPayment paymentInfo : infos) {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 942              try {                                                                                                 </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 943                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 943                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentIðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 944              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 945                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 946                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947              }                                                                                                     </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 948              order.getPayments().remove(paymentInfo);                                                              </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 949              paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                                        </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 950              paymentDao.delete(paymentInfo);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952      }                                                                                                             </span>
<span  style=""> 953                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 954      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 955      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-609061517129084855" onmouseenter="enter('-609061517129084855');" onmouseout="out('-609061517129084855');" style=""> 956      public void removeCreditCardPaymentsFromOrder(Order order) {                                                  </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 957          List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                                 </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 958          for (OrderPayment paymentInfo : order.getPayments()) {                                                    </span>
<span class="-8966393542166440080" onmouseenter="enter('-8966393542166440080');" onmouseout="out('-8966393542166440080');" style=""> 959              if (paymentInfo.getType().isCreditCardType()) {                                                       </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 960                  infos.add(paymentInfo);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962          }                                                                                                         </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 963          order.getPayments().removeAll(infos);                                                                     </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 964          for (OrderPayment paymentInfo : infos) {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 965              try {                                                                                                 </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 966                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 966                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentIðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 967              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 968                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 969                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 970              }                                                                                                     </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 971              order.getPayments().remove(paymentInfo);                                                              </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 972              paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                                        </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 973              paymentDao.delete(paymentInfo);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 974          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975      }                                                                                                             </span>
<span  style=""> 976                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 977      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 978      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="5110157232144308056" onmouseenter="enter('5110157232144308056');" onmouseout="out('5110157232144308056');" style=""> 979      public void removePaymentFromOrder(Order order, OrderPayment payment){                                        </span>
<span class="-7148196279117480431" onmouseenter="enter('-7148196279117480431');" onmouseout="out('-7148196279117480431');" style=""> 980          OrderPayment paymentToRemove = null;                                                                      </span>
<span class="-5892743526096946795" onmouseenter="enter('-5892743526096946795');" onmouseout="out('-5892743526096946795');" style=""> 981          for (OrderPayment info : order.getPayments()){                                                            </span>
<span class="-230615801168440856" onmouseenter="enter('-230615801168440856');" onmouseout="out('-230615801168440856');" style=""> 982              if (info.equals(payment)){                                                                            </span>
<span class="2491921736483213892" onmouseenter="enter('2491921736483213892');" onmouseout="out('2491921736483213892');" style=""> 983                  paymentToRemove = info;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985          }                                                                                                         </span>
<span class="-1581714824919605857" onmouseenter="enter('-1581714824919605857');" onmouseout="out('-1581714824919605857');" style=""> 986          if (paymentToRemove != null){                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 987              try {                                                                                                 </span>
<span class="1303373247725909249" onmouseenter="enter('1303373247725909249');" onmouseout="out('1303373247725909249');" style=""><abbr title=" 988                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), payment.getType());"> 988                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), paymðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 989              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 990                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 991                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 992              }                                                                                                     </span>
<span class="5021028513790341802" onmouseenter="enter('5021028513790341802');" onmouseout="out('5021028513790341802');" style=""> 993              order.getPayments().remove(paymentToRemove);                                                          </span>
<span class="-7249333565068001633" onmouseenter="enter('-7249333565068001633');" onmouseout="out('-7249333565068001633');" style=""> 994              payment = paymentDao.readPaymentById(paymentToRemove.getId());                                        </span>
<span class="-5369248081625730935" onmouseenter="enter('-5369248081625730935');" onmouseout="out('-5369248081625730935');" style=""> 995              paymentDao.delete(payment);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 996          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 997      }                                                                                                             </span>
<span  style=""> 998                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 999      /**                                                                                                           </span>
<span class="6936875034092858122" onmouseenter="enter('6936875034092858122');" onmouseout="out('6936875034092858122');" style="">1000       * This method will return the exception that is immediately below the deepest                                </span>
<span class="8325554843978875883" onmouseenter="enter('8325554843978875883');" onmouseout="out('8325554843978875883');" style="">1001       * WorkflowException in the current stack trace.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1002       *                                                                                                            </span>
<span class="914602110034133584" onmouseenter="enter('914602110034133584');" onmouseout="out('914602110034133584');" style="">1003       * @param e the workflow exception that contains the requested root cause                                     </span>
<span class="-825884884099351167" onmouseenter="enter('-825884884099351167');" onmouseout="out('-825884884099351167');" style="">1004       * @return the root cause of the workflow exception                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1005       */                                                                                                           </span>
<span class="-6688244297454300494" onmouseenter="enter('-6688244297454300494');" onmouseout="out('-6688244297454300494');" style="">1006      protected Throwable getCartOperationExceptionRootCause(WorkflowException e) {                                 </span>
<span class="-6915919722100840508" onmouseenter="enter('-6915919722100840508');" onmouseout="out('-6915919722100840508');" style="">1007          Throwable cause = e.getCause();                                                                           </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style="">1008          if (cause == null) {                                                                                      </span>
<span class="2254950224932520865" onmouseenter="enter('2254950224932520865');" onmouseout="out('2254950224932520865');" style="">1009              return e;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1010          }                                                                                                         </span>
<span  style="">1011                                                                                                                    </span>
<span class="2363873739200211359" onmouseenter="enter('2363873739200211359');" onmouseout="out('2363873739200211359');" style="">1012          Throwable currentCause = cause;                                                                           </span>
<span class="-3242506506853415284" onmouseenter="enter('-3242506506853415284');" onmouseout="out('-3242506506853415284');" style="">1013          while (currentCause.getCause() != null) {                                                                 </span>
<span class="6579708771118863579" onmouseenter="enter('6579708771118863579');" onmouseout="out('6579708771118863579');" style="">1014              currentCause = currentCause.getCause();                                                               </span>
<span class="8991829102747430232" onmouseenter="enter('8991829102747430232');" onmouseout="out('8991829102747430232');" style="">1015              if (currentCause instanceof WorkflowException) {                                                      </span>
<span class="-8175986703099391257" onmouseenter="enter('-8175986703099391257');" onmouseout="out('-8175986703099391257');" style="">1016                  cause = currentCause.getCause();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1018          }                                                                                                         </span>
<span  style="">1019                                                                                                                    </span>
<span class="-8291476910521993484" onmouseenter="enter('-8291476910521993484');" onmouseout="out('-8291476910521993484');" style="">1020          return cause;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1021      }                                                                                                             </span>
<span  style="">1022                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1023      /**                                                                                                           </span>
<span class="-4869107995961353955" onmouseenter="enter('-4869107995961353955');" onmouseout="out('-4869107995961353955');" style="">1024       * Returns true if the two items attributes exactly match.                                                    </span>
<span class="-7080712594711412450" onmouseenter="enter('-7080712594711412450');" onmouseout="out('-7080712594711412450');" style="">1025       * @param item1Attributes                                                                                     </span>
<span class="-6439056940940666101" onmouseenter="enter('-6439056940940666101');" onmouseout="out('-6439056940940666101');" style="">1026       * @param item2                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">1027       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1028       */                                                                                                           </span>
<span class="6199969656370324246" onmouseenter="enter('6199969656370324246');" onmouseout="out('6199969656370324246');" style=""><abbr title="1029      protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2) {">1029      protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2ðŸ”µ</abbr></span>
<span class="-4121399301000725365" onmouseenter="enter('-4121399301000725365');" onmouseout="out('-4121399301000725365');" style="">1030          int item1AttributeSize = item1Attributes == null ? 0 : item1Attributes.size();                            </span>
<span class="-4841456796483769583" onmouseenter="enter('-4841456796483769583');" onmouseout="out('-4841456796483769583');" style="">1031          int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size();        </span>
<span  style="">1032                                                                                                                    </span>
<span class="-6976046912644474969" onmouseenter="enter('-6976046912644474969');" onmouseout="out('-6976046912644474969');" style="">1033          if (item1AttributeSize != item2AttributeSize) {                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1034              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035          }                                                                                                         </span>
<span  style="">1036                                                                                                                    </span>
<span class="8660828604942896283" onmouseenter="enter('8660828604942896283');" onmouseout="out('8660828604942896283');" style="">1037          for (String key : item2.getItemAttributes().keySet()) {                                                   </span>
<span class="-7527106708479866057" onmouseenter="enter('-7527106708479866057');" onmouseout="out('-7527106708479866057');" style="">1038              String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).getValue();</span>
<span class="-8945816914747285664" onmouseenter="enter('-8945816914747285664');" onmouseout="out('-8945816914747285664');" style="">1039              String itemTwoValue = item2.getItemAttributes().get(key);                                             </span>
<span class="2348135482578686472" onmouseenter="enter('2348135482578686472');" onmouseout="out('2348135482578686472');" style="">1040              if (!itemTwoValue.equals(itemOneValue)) {                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1041                  return false;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1042              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1043          }                                                                                                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1044          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1045      }                                                                                                             </span>
<span  style="">1046                                                                                                                    </span>
<span class="-4141718569550096543" onmouseenter="enter('-4141718569550096543');" onmouseout="out('-4141718569550096543');" style=""><abbr title="1047      protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1Attributes,">1047      protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1AttribuðŸ”µ</abbr></span>
<span class="-3703517832068399666" onmouseenter="enter('-3703517832068399666');" onmouseout="out('-3703517832068399666');" style="">1048              OrderItemRequestDTO item2) {                                                                          </span>
<span class="-4525614051490920688" onmouseenter="enter('-4525614051490920688');" onmouseout="out('-4525614051490920688');" style="">1049          // Must match on SKU and options                                                                          </span>
<span class="4681926242181597732" onmouseenter="enter('4681926242181597732');" onmouseout="out('4681926242181597732');" style="">1050          if (item1Sku != null &amp;&amp; item2.getSkuId() != null) {                                                       </span>
<span class="4828879456607690268" onmouseenter="enter('4828879456607690268');" onmouseout="out('4828879456607690268');" style="">1051              if (item1Sku.getId().equals(item2.getSkuId())) {                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1052                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1054          } else {                                                                                                  </span>
<span class="-3562715489663556008" onmouseenter="enter('-3562715489663556008');" onmouseout="out('-3562715489663556008');" style="">1055              if (item1Product != null &amp;&amp; item2.getProductId() != null) {                                           </span>
<span class="-6090611743723364470" onmouseenter="enter('-6090611743723364470');" onmouseout="out('-6090611743723364470');" style="">1056                  if (item1Product.getId().equals(item2.getProductId())) {                                          </span>
<span class="-3558352998309083894" onmouseenter="enter('-3558352998309083894');" onmouseout="out('-3558352998309083894');" style="">1057                      return compareAttributes(item1Attributes, item2);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1058                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1059              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1060          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1061          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1062      }                                                                                                             </span>
<span  style="">1063                                                                                                                    </span>
<span class="-7114483559120409995" onmouseenter="enter('-7114483559120409995');" onmouseout="out('-7114483559120409995');" style="">1064      protected OrderItem findMatchingItem(Order order, OrderItemRequestDTO itemToFind) {                           </span>
<span class="-5687874155783563532" onmouseenter="enter('-5687874155783563532');" onmouseout="out('-5687874155783563532');" style="">1065          if (order == null) {                                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1066              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067          }                                                                                                         </span>
<span class="4435196443097834597" onmouseenter="enter('4435196443097834597');" onmouseout="out('4435196443097834597');" style="">1068          for (OrderItem currentItem : order.getOrderItems()) {                                                     </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style="">1069              if (currentItem instanceof DiscreteOrderItem) {                                                       </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style="">1070                  DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                                 </span>
<span class="-4911141910965303230" onmouseenter="enter('-4911141910965303230');" onmouseout="out('-4911141910965303230');" style=""><abbr title="1071                  if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttributes(),">1071                  if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttribuðŸ”µ</abbr></span>
<span class="-1179319244482714398" onmouseenter="enter('-1179319244482714398');" onmouseout="out('-1179319244482714398');" style="">1072                          itemToFind)) {                                                                            </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style="">1073                      return discreteItem;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1074                  }                                                                                                 </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style="">1075              } else if (currentItem instanceof BundleOrderItem) {                                                  </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style="">1076                  BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                                       </span>
<span class="-7934111527767872247" onmouseenter="enter('-7934111527767872247');" onmouseout="out('-7934111527767872247');" style="">1077                  if (itemMatches(bundleItem.getSku(), bundleItem.getProduct(), null, itemToFind)) {                </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style="">1078                      return bundleItem;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1079                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1081          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1082          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083      }                                                                                                             </span>
<span  style="">1084                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1085      @Override                                                                                                     </span>
<span class="-5844561583982380564" onmouseenter="enter('-5844561583982380564');" onmouseout="out('-5844561583982380564');" style="">1086      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { UpdateCartException.class })                   </span>
<span class="586625526125468318" onmouseenter="enter('586625526125468318');" onmouseout="out('586625526125468318');" style=""><abbr title="1087      public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException {">1087      public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1088          try {                                                                                                     </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title="1089              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);">1089              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span class="-8587304739270495732" onmouseenter="enter('-8587304739270495732');" onmouseout="out('-8587304739270495732');" style=""><abbr title="1090              ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptionsForItemWorkflow.doActivities(cartOpRequest);">1090              ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptðŸ”µ</abbr></span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title="1091              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());">1091              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMesðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style="">1092              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1093          } catch (WorkflowException e) {                                                                           </span>
<span class="1106241423190966760" onmouseenter="enter('1106241423190966760');" onmouseout="out('1106241423190966760');" style="">1094              throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCause(e));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1095          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1096      }                                                                                                             </span>
<span  style="">1097                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1098      @Override                                                                                                     </span>
<span class="1062217594650773028" onmouseenter="enter('1062217594650773028');" onmouseout="out('1062217594650773028');" style="">1099      public Order reloadOrder(Order order) {                                                                       </span>
<span class="-4055446979990348221" onmouseenter="enter('-4055446979990348221');" onmouseout="out('-4055446979990348221');" style="">1100          if (order == null || order instanceof NullOrderImpl || order.getId() == null) {                           </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style="">1101              return order;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102          }                                                                                                         </span>
<span  style="">1103                                                                                                                    </span>
<span class="4601321525892022542" onmouseenter="enter('4601321525892022542');" onmouseout="out('4601321525892022542');" style="">1104          return orderDao.readOrderById(order.getId(), true);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105      }                                                                                                             </span>
<span  style="">1106                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1107      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="">1108      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-7012224974908680421" onmouseenter="enter('-7012224974908680421');" onmouseout="out('-7012224974908680421');" style="">1109      public boolean acquireLock(Order order) {                                                                     </span>
<span class="1335946416444527614" onmouseenter="enter('1335946416444527614');" onmouseout="out('1335946416444527614');" style="">1110          return orderDao.acquireLock(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111      }                                                                                                             </span>
<span  style="">1112                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1113      @Override                                                                                                     </span>
<span class="3603110228114188705" onmouseenter="enter('3603110228114188705');" onmouseout="out('3603110228114188705');" style="">1114      public boolean releaseLock(Order order) {                                                                     </span>
<span class="1014135102090455120" onmouseenter="enter('1014135102090455120');" onmouseout="out('1014135102090455120');" style="">1115          return orderDao.releaseLock(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1116      }                                                                                                             </span>
<span  style="">1117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1118      @Override                                                                                                     </span>
<span class="-3640157100751954071" onmouseenter="enter('-3640157100751954071');" onmouseout="out('-3640157100751954071');" style="">1119      public void printOrder(Order order, Log log) {                                                                </span>
<span class="-3796071981400661878" onmouseenter="enter('-3796071981400661878');" onmouseout="out('-3796071981400661878');" style="">1120          if (!log.isDebugEnabled()) {                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1121              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1122          }                                                                                                         </span>
<span  style="">1123                                                                                                                    </span>
<span class="3667140805233255262" onmouseenter="enter('3667140805233255262');" onmouseout="out('3667140805233255262');" style="">1124          TableCreator tc = new TableCreator(new TableCreator.Col[] {                                               </span>
<span class="7681839206706458847" onmouseenter="enter('7681839206706458847');" onmouseout="out('7681839206706458847');" style="">1125              new TableCreator.Col(&quot;Order Item&quot;, 30),                                                               </span>
<span class="2598617298230317857" onmouseenter="enter('2598617298230317857');" onmouseout="out('2598617298230317857');" style="">1126              new TableCreator.Col(&quot;Qty&quot;),                                                                          </span>
<span class="-7694790865023700533" onmouseenter="enter('-7694790865023700533');" onmouseout="out('-7694790865023700533');" style="">1127              new TableCreator.Col(&quot;Unit Price&quot;),                                                                   </span>
<span class="-4029215824508924196" onmouseenter="enter('-4029215824508924196');" onmouseout="out('-4029215824508924196');" style="">1128              new TableCreator.Col(&quot;Avg Adj&quot;),                                                                      </span>
<span class="2280319324156256259" onmouseenter="enter('2280319324156256259');" onmouseout="out('2280319324156256259');" style="">1129              new TableCreator.Col(&quot;Total Adj&quot;),                                                                    </span>
<span class="803984851040328531" onmouseenter="enter('803984851040328531');" onmouseout="out('803984851040328531');" style="">1130              new TableCreator.Col(&quot;Total Price&quot;)                                                                   </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1131          });                                                                                                       </span>
<span  style="">1132                                                                                                                    </span>
<span class="8447029191885982498" onmouseenter="enter('8447029191885982498');" onmouseout="out('8447029191885982498');" style="">1133          for (OrderItem oi : order.getOrderItems()) {                                                              </span>
<span class="7794599779896353168" onmouseenter="enter('7794599779896353168');" onmouseout="out('7794599779896353168');" style="">1134              tc.addRow(new String[] {                                                                              </span>
<span class="-6517557825202851987" onmouseenter="enter('-6517557825202851987');" onmouseout="out('-6517557825202851987');" style="">1135                  oi.getName(),                                                                                     </span>
<span class="-5588620079629414973" onmouseenter="enter('-5588620079629414973');" onmouseout="out('-5588620079629414973');" style="">1136                  String.valueOf(oi.getQuantity()),                                                                 </span>
<span class="8023041970437622541" onmouseenter="enter('8023041970437622541');" onmouseout="out('8023041970437622541');" style="">1137                  String.valueOf(oi.getPriceBeforeAdjustments(true)),                                               </span>
<span class="4981794139639039914" onmouseenter="enter('4981794139639039914');" onmouseout="out('4981794139639039914');" style="">1138                  String.valueOf(oi.getAverageAdjustmentValue()),                                                   </span>
<span class="-7621609530264461687" onmouseenter="enter('-7621609530264461687');" onmouseout="out('-7621609530264461687');" style="">1139                  String.valueOf(oi.getTotalAdjustmentValue()),                                                     </span>
<span class="610268575597889106" onmouseenter="enter('610268575597889106');" onmouseout="out('610268575597889106');" style="">1140                  String.valueOf(oi.getTotalPrice())                                                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1141              });                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1142          }                                                                                                         </span>
<span  style="">1143                                                                                                                    </span>
<span class="-3387660244080770577" onmouseenter="enter('-3387660244080770577');" onmouseout="out('-3387660244080770577');" style="">1144          tc.addSeparator()                                                                                         </span>
<span class="-4962129920853993876" onmouseenter="enter('-4962129920853993876');" onmouseout="out('-4962129920853993876');" style="">1145              .withGlobalRowHeaderWidth(15)                                                                         </span>
<span class="8977950677164210482" onmouseenter="enter('8977950677164210482');" onmouseout="out('8977950677164210482');" style="">1146              .addRow(&quot;Subtotal&quot;, order.getSubTotal())                                                              </span>
<span class="9039771477815737150" onmouseenter="enter('9039771477815737150');" onmouseout="out('9039771477815737150');" style="">1147              .addRow(&quot;Order Adj.&quot;, order.getOrderAdjustmentsValue())                                               </span>
<span class="-3982350454387940822" onmouseenter="enter('-3982350454387940822');" onmouseout="out('-3982350454387940822');" style="">1148              .addRow(&quot;Tax&quot;, order.getTotalTax())                                                                   </span>
<span class="-1569816593472627301" onmouseenter="enter('-1569816593472627301');" onmouseout="out('-1569816593472627301');" style="">1149              .addRow(&quot;Shipping&quot;, order.getTotalShipping())                                                         </span>
<span class="-2587440008499047447" onmouseenter="enter('-2587440008499047447');" onmouseout="out('-2587440008499047447');" style="">1150              .addRow(&quot;Total&quot;, order.getTotal())                                                                    </span>
<span class="-7531230309631143371" onmouseenter="enter('-7531230309631143371');" onmouseout="out('-7531230309631143371');" style="">1151              .addSeparator();                                                                                      </span>
<span  style="">1152                                                                                                                    </span>
<span class="5532863706287091360" onmouseenter="enter('5532863706287091360');" onmouseout="out('5532863706287091360');" style="">1153          log.debug(tc.toString());                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1154      }                                                                                                             </span>
<span  style="">1155                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1156      @Override                                                                                                     </span>
<span class="-6821589912139190758" onmouseenter="enter('-6821589912139190758');" onmouseout="out('-6821589912139190758');" style="">1157      public void preValidateCartOperation(Order cart) {                                                            </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1158          ExtensionResultHolder erh = new ExtensionResultHolder();                                                  </span>
<span class="-2298593102036867448" onmouseenter="enter('-2298593102036867448');" onmouseout="out('-2298593102036867448');" style="">1159          extensionManager.getProxy().preValidateCartOperation(cart, erh);                                          </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1160          if (erh.getThrowable() instanceof IllegalCartOperationException) {                                        </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1161              throw ((IllegalCartOperationException) erh.getThrowable());                                           </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1162          } else if (erh.getThrowable() != null) {                                                                  </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1163              throw new RuntimeException(erh.getThrowable());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1164          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165      }                                                                                                             </span>
<span  style="">1166                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1167      @Override                                                                                                     </span>
<span class="6673450650333126736" onmouseenter="enter('6673450650333126736');" onmouseout="out('6673450650333126736');" style="">1168      public void preValidateUpdateQuantityOperation(Order cart, OrderItemRequestDTO dto) {                         </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1169          ExtensionResultHolder erh = new ExtensionResultHolder();                                                  </span>
<span class="-1253981422185917754" onmouseenter="enter('-1253981422185917754');" onmouseout="out('-1253981422185917754');" style="">1170          extensionManager.getProxy().preValidateUpdateQuantityOperation(cart, dto, erh);                           </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1171          if (erh.getThrowable() instanceof IllegalCartOperationException) {                                        </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1172              throw ((IllegalCartOperationException) erh.getThrowable());                                           </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1173          } else if (erh.getThrowable() != null) {                                                                  </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1174              throw new RuntimeException(erh.getThrowable());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1175          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176      }                                                                                                             </span>
<span  style="">1177                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1178      @Override                                                                                                     </span>
<span class="7073850063066733207" onmouseenter="enter('7073850063066733207');" onmouseout="out('7073850063066733207');" style="">1179      public void refresh(Order order) {                                                                            </span>
<span class="4383314386154345120" onmouseenter="enter('4383314386154345120');" onmouseout="out('4383314386154345120');" style="">1180          orderDao.refresh(order);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1181      }                                                                                                             </span>
<span  style="">1182                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1183      @Override                                                                                                     </span>
<span class="1062745462356892667" onmouseenter="enter('1062745462356892667');" onmouseout="out('1062745462356892667');" style="">1184      public Order findCartForCustomerWithEnhancements(Customer customer) {                                         </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1185          ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                                    </span>
<span class="8097724414319335156" onmouseenter="enter('8097724414319335156');" onmouseout="out('8097724414319335156');" style=""><abbr title="1186          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, erh);">1186          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customerðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1187          if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                          </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1188              return erh.getResult();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1189          }                                                                                                         </span>
<span class="-7896162153865126169" onmouseenter="enter('-7896162153865126169');" onmouseout="out('-7896162153865126169');" style="">1190          return findCartForCustomer(customer);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1191      }                                                                                                             </span>
<span  style="">1192                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1193      @Override                                                                                                     </span>
<span class="3369501079555878000" onmouseenter="enter('3369501079555878000');" onmouseout="out('3369501079555878000');" style="">1194      public Order findCartForCustomerWithEnhancements(Customer customer, Order candidateOrder) {                   </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1195          ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                                    </span>
<span class="935633576463333972" onmouseenter="enter('935633576463333972');" onmouseout="out('935633576463333972');" style=""><abbr title="1196          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, candidateOrder, erh);">1196          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customerðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1197          if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                          </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1198              return erh.getResult();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1199          }                                                                                                         </span>
<span class="5654562705123023026" onmouseenter="enter('5654562705123023026');" onmouseout="out('5654562705123023026');" style="">1200          return candidateOrder;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1201      }                                                                                                             </span>
<span  style="">1202                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1203      @Override                                                                                                     </span>
<span class="7870513728701775364" onmouseenter="enter('7870513728701775364');" onmouseout="out('7870513728701775364');" style="">1204      public List&lt;Order&gt; findOrdersByEmail(String email) {                                                          </span>
<span class="-6244770976468678027" onmouseenter="enter('-6244770976468678027');" onmouseout="out('-6244770976468678027');" style="">1205          return orderDao.readOrdersByEmail(email);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206      }                                                                                                             </span>
<span  style="">1207                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1208      @Override                                                                                                     </span>
<span class="1732562485956607688" onmouseenter="enter('1732562485956607688');" onmouseout="out('1732562485956607688');" style="">1209      public List&lt;Order&gt; readBatchOrders(int start, int pageSize, List&lt;OrderStatus&gt; orderStatusList) {              </span>
<span class="-4564878267596583277" onmouseenter="enter('-4564878267596583277');" onmouseout="out('-4564878267596583277');" style="">1210          return orderDao.readBatchOrders(start, pageSize, orderStatusList);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1211      }                                                                                                             </span>
<span  style="">1212                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1213      @Override                                                                                                     </span>
<span class="-7199170496986096208" onmouseenter="enter('-7199170496986096208');" onmouseout="out('-7199170496986096208');" style="">1214  	public Long readNumberOfOrders() {                                                                               </span>
<span class="4444270982432861777" onmouseenter="enter('4444270982432861777');" onmouseout="out('4444270982432861777');" style="">1215      		return orderDao.readNumberOfOrders();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1216      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1217  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2522844188166543739" onmouseenter="enter('2522844188166543739');" onmouseout="out('2522844188166543739');" style="">  18  package org.broadleafcommerce.core.order.service;                                                                 </span>
<span  style="">  19                                                                                                                    </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  20  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-1195774921000060328" onmouseenter="enter('-1195774921000060328');" onmouseout="out('-1195774921000060328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import org.apache.commons.lang3.builder.CompareToBuilder;                                                         </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  24  import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                              </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  25  import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="7974202605197813097" onmouseenter="enter('7974202605197813097');" onmouseout="out('7974202605197813097');" style="">  26  import org.broadleafcommerce.common.payment.PaymentType;                                                          </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  27  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="7029131086618023959" onmouseenter="enter('7029131086618023959');" onmouseout="out('7029131086618023959');" style="">  28  import org.broadleafcommerce.common.util.TableCreator;                                                            </span>
<span class="5107697851223623564" onmouseenter="enter('5107697851223623564');" onmouseout="out('5107697851223623564');" style="">  29  import org.broadleafcommerce.common.util.TransactionUtils;                                                        </span>
<span class="4803307284880744779" onmouseenter="enter('4803307284880744779');" onmouseout="out('4803307284880744779');" style="">  30  import org.broadleafcommerce.common.util.TypedPredicate;                                                          </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  31  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  32  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  33  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  34  import org.broadleafcommerce.core.offer.dao.OfferDao;                                                             </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  35  import org.broadleafcommerce.core.offer.domain.Offer;                                                             </span>
<span class="1521662235446319191" onmouseenter="enter('1521662235446319191');" onmouseout="out('1521662235446319191');" style="">  36  import org.broadleafcommerce.core.offer.domain.OfferCode;                                                         </span>
<span class="263797997925672445" onmouseenter="enter('263797997925672445');" onmouseout="out('263797997925672445');" style="">  37  import org.broadleafcommerce.core.offer.service.OfferService;                                                     </span>
<span class="4256508551440919929" onmouseenter="enter('4256508551440919929');" onmouseout="out('4256508551440919929');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import org.broadleafcommerce.core.offer.service.OfferServiceExtensionHandler;                                     </span>
<span class="8148915287428556311" onmouseenter="enter('8148915287428556311');" onmouseout="out('8148915287428556311');" style="">  39  import org.broadleafcommerce.core.offer.service.OfferServiceExtensionManager;                                     </span>
<span class="-2264825748950997481" onmouseenter="enter('-2264825748950997481');" onmouseout="out('-2264825748950997481');" style="">  40  import org.broadleafcommerce.core.offer.service.exception.OfferAlreadyAddedException;                             </span>
<span class="6280580908510581954" onmouseenter="enter('6280580908510581954');" onmouseout="out('6280580908510581954');" style="">  41  import org.broadleafcommerce.core.offer.service.exception.OfferException;                                         </span>
<span class="7718612833831637853" onmouseenter="enter('7718612833831637853');" onmouseout="out('7718612833831637853');" style="">  42  import org.broadleafcommerce.core.offer.service.exception.OfferExpiredException;                                  </span>
<span class="2542407303560298775" onmouseenter="enter('2542407303560298775');" onmouseout="out('2542407303560298775');" style="">  43  import org.broadleafcommerce.core.offer.service.exception.OfferMaxUseExceededException;                           </span>
<span class="7365998840944773425" onmouseenter="enter('7365998840944773425');" onmouseout="out('7365998840944773425');" style="">  44  import org.broadleafcommerce.core.order.dao.OrderDao;                                                             </span>
<span class="-8431629490392379230" onmouseenter="enter('-8431629490392379230');" onmouseout="out('-8431629490392379230');" style="">  45  import org.broadleafcommerce.core.order.domain.BundleOrderItem;                                                   </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  46  import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                                 </span>
<span class="4607558792631823600" onmouseenter="enter('4607558792631823600');" onmouseout="out('4607558792631823600');" style="">  47  import org.broadleafcommerce.core.order.domain.GiftWrapOrderItem;                                                 </span>
<span class="3195477135256206744" onmouseenter="enter('3195477135256206744');" onmouseout="out('3195477135256206744');" style="">  48  import org.broadleafcommerce.core.order.domain.NullOrderFactory;                                                  </span>
<span class="6568352354414313904" onmouseenter="enter('6568352354414313904');" onmouseout="out('6568352354414313904');" style="">  49  import org.broadleafcommerce.core.order.domain.NullOrderImpl;                                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  50  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  51  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  52  import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                                </span>
<span class="-4972689095474256973" onmouseenter="enter('-4972689095474256973');" onmouseout="out('-4972689095474256973');" style="">  53  import org.broadleafcommerce.core.order.service.call.ActivityMessageDTO;                                          </span>
<span class="-7160318188857079464" onmouseenter="enter('-7160318188857079464');" onmouseout="out('-7160318188857079464');" style="">  54  import org.broadleafcommerce.core.order.service.call.GiftWrapOrderItemRequest;                                    </span>
<span class="-1901438765224473349" onmouseenter="enter('-1901438765224473349');" onmouseout="out('-1901438765224473349');" style="">  55  import org.broadleafcommerce.core.order.service.call.OrderItemRequestDTO;                                         </span>
<span class="-3854268344786449631" onmouseenter="enter('-3854268344786449631');" onmouseout="out('-3854268344786449631');" style="">  56  import org.broadleafcommerce.core.order.service.exception.AddToCartException;                                     </span>
<span class="-8548142165698551205" onmouseenter="enter('-8548142165698551205');" onmouseout="out('-8548142165698551205');" style="">  57  import org.broadleafcommerce.core.order.service.exception.IllegalCartOperationException;                          </span>
<span class="-3598721789967501677" onmouseenter="enter('-3598721789967501677');" onmouseout="out('-3598721789967501677');" style="">  58  import org.broadleafcommerce.core.order.service.exception.ItemNotFoundException;                                  </span>
<span class="4692349346970735648" onmouseenter="enter('4692349346970735648');" onmouseout="out('4692349346970735648');" style="">  59  import org.broadleafcommerce.core.order.service.exception.RemoveFromCartException;                                </span>
<span class="9042395061305363095" onmouseenter="enter('9042395061305363095');" onmouseout="out('9042395061305363095');" style="">  60  import org.broadleafcommerce.core.order.service.exception.UpdateCartException;                                    </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  61  import org.broadleafcommerce.core.order.service.type.OrderStatus;                                                 </span>
<span class="-3953683189888176126" onmouseenter="enter('-3953683189888176126');" onmouseout="out('-3953683189888176126');" style="">  62  import org.broadleafcommerce.core.order.service.workflow.CartOperationRequest;                                    </span>
<span class="3604210211865098056" onmouseenter="enter('3604210211865098056');" onmouseout="out('3604210211865098056');" style="">  63  import org.broadleafcommerce.core.payment.dao.OrderPaymentDao;                                                    </span>
<span class="725806334255742314" onmouseenter="enter('725806334255742314');" onmouseout="out('725806334255742314');" style="">  64  import org.broadleafcommerce.core.payment.domain.OrderPayment;                                                    </span>
<span class="-5451903065912654495" onmouseenter="enter('-5451903065912654495');" onmouseout="out('-5451903065912654495');" style="">  65  import org.broadleafcommerce.core.payment.domain.secure.Referenced;                                               </span>
<span class="5702480564955886723" onmouseenter="enter('5702480564955886723');" onmouseout="out('5702480564955886723');" style="">  66  import org.broadleafcommerce.core.payment.service.SecureOrderPaymentService;                                      </span>
<span class="-8638524682328332386" onmouseenter="enter('-8638524682328332386');" onmouseout="out('-8638524682328332386');" style="">  67  import org.broadleafcommerce.core.pricing.service.PricingService;                                                 </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  68  import org.broadleafcommerce.core.pricing.service.exception.PricingException;                                     </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  69  import org.broadleafcommerce.core.workflow.ActivityMessages;                                                      </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  70  import org.broadleafcommerce.core.workflow.ProcessContext;                                                        </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  71  import org.broadleafcommerce.core.workflow.Processor;                                                             </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  72  import org.broadleafcommerce.core.workflow.WorkflowException;                                                     </span>
<span class="-6242194486783230477" onmouseenter="enter('-6242194486783230477');" onmouseout="out('-6242194486783230477');" style="">  73  import org.broadleafcommerce.profile.core.domain.Customer;                                                        </span>

<span class="3891204800073608559" onmouseenter="enter('3891204800073608559');" onmouseout="out('3891204800073608559');" style="">  74  import org.hibernate.FlushMode;                                                                                   </span>
<span class="-1504015732959009083" onmouseenter="enter('-1504015732959009083');" onmouseout="out('-1504015732959009083');" style="">  75  import org.hibernate.Session;                                                                                     </span>
<span class="-6296437060367579882" onmouseenter="enter('-6296437060367579882');" onmouseout="out('-6296437060367579882');" style="">  76  import org.hibernate.exception.LockAcquisitionException;                                                          </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  77  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="1177291030959407810" onmouseenter="enter('1177291030959407810');" onmouseout="out('1177291030959407810');" style="">  78  import org.springframework.jmx.export.annotation.ManagedAttribute;                                                </span>
<span class="-2411378172167085657" onmouseenter="enter('-2411378172167085657');" onmouseout="out('-2411378172167085657');" style="">  79  import org.springframework.jmx.export.annotation.ManagedResource;                                                 </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  80  import org.springframework.stereotype.Service;                                                                    </span>
<span class="-740123120803947738" onmouseenter="enter('-740123120803947738');" onmouseout="out('-740123120803947738');" style="">  81  import org.springframework.transaction.PlatformTransactionManager;                                                </span>
<span class="-8923386680468181280" onmouseenter="enter('-8923386680468181280');" onmouseout="out('-8923386680468181280');" style="">  82  import org.springframework.transaction.TransactionDefinition;                                                     </span>
<span class="8980559080936335720" onmouseenter="enter('8980559080936335720');" onmouseout="out('8980559080936335720');" style="">  83  import org.springframework.transaction.TransactionStatus;                                                         </span>
<span class="4419089678332371422" onmouseenter="enter('4419089678332371422');" onmouseout="out('4419089678332371422');" style="">  84  import org.springframework.transaction.annotation.Transactional;                                                  </span>
<span  style="">  85                                                                                                                    </span>
<span class="2075466404860203191" onmouseenter="enter('2075466404860203191');" onmouseout="out('2075466404860203191');" style="">  86  import java.math.BigDecimal;                                                                                      </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  87  import java.util.ArrayList;                                                                                       </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  88  import java.util.Collections;                                                                                     </span>
<span class="4561244361960433187" onmouseenter="enter('4561244361960433187');" onmouseout="out('4561244361960433187');" style="">  89  import java.util.Comparator;                                                                                      </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  90  import java.util.Date;                                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  91  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  92  import java.util.Map;                                                                                             </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +import java.util.Objects;                                                                                         </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  94  import java.util.Set;                                                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  96  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  97  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  98  import javax.persistence.PersistenceContext;                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -                                                                                                                  </span>
<span  style=""> 100                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 101  /**                                                                                                               </span>
<span class="2815697706567038739" onmouseenter="enter('2815697706567038739');" onmouseout="out('2815697706567038739');" style=""> 102   * @author apazzolini                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 103   */                                                                                                               </span>
<span class="7613295130782185909" onmouseenter="enter('7613295130782185909');" onmouseout="out('7613295130782185909');" style=""> 104  @Service(&quot;blOrderService&quot;)                                                                                        </span>
<span class="5819673836649587467" onmouseenter="enter('5819673836649587467');" onmouseout="out('5819673836649587467');" style=""><abbr title=" 105  @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLimit=15)"> 105  @ManagedResource(objectName=&quot;org.broadleafcommerce:name=OrderService&quot;, description=&quot;Order Service&quot;, currencyTimeLiðŸ”µ</abbr></span>
<span class="-2072417237584838241" onmouseenter="enter('-2072417237584838241');" onmouseout="out('-2072417237584838241');" style=""> 106  public class OrderServiceImpl implements OrderService {                                                           </span>
<span class="-6147601375299019476" onmouseenter="enter('-6147601375299019476');" onmouseout="out('-6147601375299019476');" style=""> 107      private static final Log LOG = LogFactory.getLog(OrderServiceImpl.class);                                     </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-1034856612351701575" onmouseenter="enter('-1034856612351701575');" onmouseout="out('-1034856612351701575');" style=""> 109      /* DAOs */                                                                                                    </span>
<span class="4300412198824813091" onmouseenter="enter('4300412198824813091');" onmouseout="out('4300412198824813091');" style=""> 110      @Resource(name = &quot;blOrderPaymentDao&quot;)                                                                         </span>
<span class="-6743991484426169368" onmouseenter="enter('-6743991484426169368');" onmouseout="out('-6743991484426169368');" style=""> 111      protected OrderPaymentDao paymentDao;                                                                         </span>
<span  style=""> 112                                                                                                                    </span>
<span class="-8616512229212864636" onmouseenter="enter('-8616512229212864636');" onmouseout="out('-8616512229212864636');" style=""> 113      @Resource(name = &quot;blOrderDao&quot;)                                                                                </span>
<span class="3205943113513590409" onmouseenter="enter('3205943113513590409');" onmouseout="out('3205943113513590409');" style=""> 114      protected OrderDao orderDao;                                                                                  </span>
<span  style=""> 115                                                                                                                    </span>
<span class="5779429748772127951" onmouseenter="enter('5779429748772127951');" onmouseout="out('5779429748772127951');" style=""> 116      @Resource(name = &quot;blOfferDao&quot;)                                                                                </span>
<span class="8858788780557179486" onmouseenter="enter('8858788780557179486');" onmouseout="out('8858788780557179486');" style=""> 117      protected OfferDao offerDao;                                                                                  </span>
<span  style=""> 118                                                                                                                    </span>
<span class="4027092641360680465" onmouseenter="enter('4027092641360680465');" onmouseout="out('4027092641360680465');" style=""> 119      /* Factories */                                                                                               </span>
<span class="-5967051191091567596" onmouseenter="enter('-5967051191091567596');" onmouseout="out('-5967051191091567596');" style=""> 120      @Resource(name = &quot;blNullOrderFactory&quot;)                                                                        </span>
<span class="4068278867975252256" onmouseenter="enter('4068278867975252256');" onmouseout="out('4068278867975252256');" style=""> 121      protected NullOrderFactory nullOrderFactory;                                                                  </span>
<span  style=""> 122                                                                                                                    </span>
<span class="1042938529233933214" onmouseenter="enter('1042938529233933214');" onmouseout="out('1042938529233933214');" style=""> 123      /* Services */                                                                                                </span>



<span class="1740335809005650078" onmouseenter="enter('1740335809005650078');" onmouseout="out('1740335809005650078');" style=""> 124      @Resource(name = &quot;blPricingService&quot;)                                                                          </span>
<span class="-3953942945177082651" onmouseenter="enter('-3953942945177082651');" onmouseout="out('-3953942945177082651');" style=""> 125      protected PricingService pricingService;                                                                      </span>
<span  style=""> 126                                                                                                                    </span>
<span class="-8762117636097767442" onmouseenter="enter('-8762117636097767442');" onmouseout="out('-8762117636097767442');" style=""> 127      @Resource(name = &quot;blOrderItemService&quot;)                                                                        </span>
<span class="-7939877477893967584" onmouseenter="enter('-7939877477893967584');" onmouseout="out('-7939877477893967584');" style=""> 128      protected OrderItemService orderItemService;                                                                  </span>
<span  style=""> 129                                                                                                                    </span>
<span class="2996711079688344376" onmouseenter="enter('2996711079688344376');" onmouseout="out('2996711079688344376');" style=""> 130      @Resource(name = &quot;blFulfillmentGroupService&quot;)                                                                 </span>
<span class="-4012624862608675616" onmouseenter="enter('-4012624862608675616');" onmouseout="out('-4012624862608675616');" style=""> 131      protected FulfillmentGroupService fulfillmentGroupService;                                                    </span>
<span  style=""> 132                                                                                                                    </span>
<span class="401190535541877398" onmouseenter="enter('401190535541877398');" onmouseout="out('401190535541877398');" style=""> 133      @Resource(name = &quot;blOfferService&quot;)                                                                            </span>
<span class="5260453850719866461" onmouseenter="enter('5260453850719866461');" onmouseout="out('5260453850719866461');" style=""> 134      protected OfferService offerService;                                                                          </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-5728623657958779082" onmouseenter="enter('-5728623657958779082');" onmouseout="out('-5728623657958779082');" style=""> 136      @Resource(name = &quot;blSecureOrderPaymentService&quot;)                                                               </span>
<span class="-6581230590179767656" onmouseenter="enter('-6581230590179767656');" onmouseout="out('-6581230590179767656');" style=""> 137      protected SecureOrderPaymentService securePaymentInfoService;                                                 </span>
<span  style=""> 138                                                                                                                    </span>
<span class="3052322175513128984" onmouseenter="enter('3052322175513128984');" onmouseout="out('3052322175513128984');" style=""> 139      @Resource(name = &quot;blMergeCartService&quot;)                                                                        </span>
<span class="8208298738953975930" onmouseenter="enter('8208298738953975930');" onmouseout="out('8208298738953975930');" style=""> 140      protected MergeCartService mergeCartService;                                                                  </span>
<span  style=""> 141                                                                                                                    </span>
<span class="-5141785283307634971" onmouseenter="enter('-5141785283307634971');" onmouseout="out('-5141785283307634971');" style=""> 142      @Resource(name = &quot;blOrderServiceExtensionManager&quot;)                                                            </span>
<span class="7609575163897375728" onmouseenter="enter('7609575163897375728');" onmouseout="out('7609575163897375728');" style=""> 143      protected OrderServiceExtensionManager extensionManager;                                                      </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-2568041442687394420" onmouseenter="enter('-2568041442687394420');" onmouseout="out('-2568041442687394420');" style=""> 145      /* Workflows */                                                                                               </span>
<span class="2793266955607927868" onmouseenter="enter('2793266955607927868');" onmouseout="out('2793266955607927868');" style=""> 146      @Resource(name = &quot;blAddItemWorkflow&quot;)                                                                         </span>
<span class="-7970748165831650126" onmouseenter="enter('-7970748165831650126');" onmouseout="out('-7970748165831650126');" style=""> 147      protected Processor addItemWorkflow;                                                                          </span>
<span  style=""> 148                                                                                                                    </span>
<span class="6527917864594618071" onmouseenter="enter('6527917864594618071');" onmouseout="out('6527917864594618071');" style=""> 149      @Resource(name = &quot;blUpdateProductOptionsForItemWorkflow&quot;)                                                     </span>
<span class="-3432528377574027794" onmouseenter="enter('-3432528377574027794');" onmouseout="out('-3432528377574027794');" style=""> 150      private Processor updateProductOptionsForItemWorkflow;                                                        </span>
<span  style=""> 151                                                                                                                    </span>
<span class="-8676131598314218463" onmouseenter="enter('-8676131598314218463');" onmouseout="out('-8676131598314218463');" style=""> 152      @Resource(name = &quot;blUpdateItemWorkflow&quot;)                                                                      </span>
<span class="-4038034170241387616" onmouseenter="enter('-4038034170241387616');" onmouseout="out('-4038034170241387616');" style=""> 153      protected Processor updateItemWorkflow;                                                                       </span>
<span  style=""> 154                                                                                                                    </span>
<span class="2809816546718326729" onmouseenter="enter('2809816546718326729');" onmouseout="out('2809816546718326729');" style=""> 155      @Resource(name = &quot;blRemoveItemWorkflow&quot;)                                                                      </span>
<span class="8820366819754000449" onmouseenter="enter('8820366819754000449');" onmouseout="out('8820366819754000449');" style=""> 156      protected Processor removeItemWorkflow;                                                                       </span>
<span  style=""> 157                                                                                                                    </span>
<span class="-2629969533830190342" onmouseenter="enter('-2629969533830190342');" onmouseout="out('-2629969533830190342');" style=""> 158      @Resource(name = &quot;blTransactionManager&quot;)                                                                      </span>
<span class="-8090157640080505156" onmouseenter="enter('-8090157640080505156');" onmouseout="out('-8090157640080505156');" style=""> 159      protected PlatformTransactionManager transactionManager;                                                      </span>
<span  style=""> 160                                                                                                                    </span>
<span class="4647563353113875163" onmouseenter="enter('4647563353113875163');" onmouseout="out('4647563353113875163');" style=""> 161      @Value(&quot;${pricing.retry.count.for.lock.failure}&quot;)                                                             </span>
<span class="3768032238220096351" onmouseenter="enter('3768032238220096351');" onmouseout="out('3768032238220096351');" style=""> 162      protected int pricingRetryCountForLockFailure = 3;                                                            </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-5649780437206020465" onmouseenter="enter('-5649780437206020465');" onmouseout="out('-5649780437206020465');" style=""> 164      @Value(&quot;${pricing.retry.wait.interval.for.lock.failure}&quot;)                                                     </span>
<span class="6143681610186845623" onmouseenter="enter('6143681610186845623');" onmouseout="out('6143681610186845623');" style=""> 165      protected long pricingRetryWaitIntervalForLockFailure = 500L;                                                 </span>
<span  style=""> 166                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 167      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 168       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="-4084123837140279098" onmouseenter="enter('-4084123837140279098');" onmouseout="out('-4084123837140279098');" style=""> 169       * add-to-cart workflow. This should generally be able to be left false. This is a performance measure and    </span>
<span class="531367490526902986" onmouseenter="enter('531367490526902986');" onmouseout="out('531367490526902986');" style=""> 170       * add-to-cart operations will be more efficient when this is false.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 171       */                                                                                                           </span>
<span class="-6971248696513840261" onmouseenter="enter('-6971248696513840261');" onmouseout="out('-6971248696513840261');" style=""> 172      @Value(&quot;${auto.flush.on.query.during.add.to.cart:false}&quot;)                                                     </span>
<span class="-9081510558149889178" onmouseenter="enter('-9081510558149889178');" onmouseout="out('-9081510558149889178');" style=""> 173      protected boolean autoFlushAddToCart = false;                                                                 </span>
<span  style=""> 174                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 175      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 176       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="5682863995593575399" onmouseenter="enter('5682863995593575399');" onmouseout="out('5682863995593575399');" style=""> 177       * update-cart workflow. This should generally be able to be left false. This is a performance measure and    </span>
<span class="4015846476888264417" onmouseenter="enter('4015846476888264417');" onmouseout="out('4015846476888264417');" style=""> 178       * update-cart operations will be more efficient when this is false.                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 179       */                                                                                                           </span>
<span class="4955973510412192391" onmouseenter="enter('4955973510412192391');" onmouseout="out('4955973510412192391');" style=""> 180      @Value(&quot;${auto.flush.on.query.during.update.cart:false}&quot;)                                                     </span>
<span class="-6560708755317111135" onmouseenter="enter('-6560708755317111135');" onmouseout="out('-6560708755317111135');" style=""> 181      protected boolean autoFlushUpdateCart = false;                                                                </span>
<span  style=""> 182                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 183      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 184       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="5427441896991106725" onmouseenter="enter('5427441896991106725');" onmouseout="out('5427441896991106725');" style=""><abbr title=" 185       * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure and"> 185       * remove-from-cart workflow. This should generally be able to be left false. This is a performance measure anðŸ”µ</abbr></span>
<span class="-4648779041241212172" onmouseenter="enter('-4648779041241212172');" onmouseout="out('-4648779041241212172');" style=""> 186       * remove-from-cart operations will be more efficient when this is false.                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 187       */                                                                                                           </span>
<span class="-8172893732176017719" onmouseenter="enter('-8172893732176017719');" onmouseout="out('-8172893732176017719');" style=""> 188      @Value(&quot;${auto.flush.on.query.during.remove.from.cart:false}&quot;)                                                </span>
<span class="-3285670849425830103" onmouseenter="enter('-3285670849425830103');" onmouseout="out('-3285670849425830103');" style=""> 189      protected boolean autoFlushRemoveFromCart = false;                                                            </span>
<span  style=""> 190                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 191      /**                                                                                                           </span>
<span class="-3837734042251911246" onmouseenter="enter('-3837734042251911246');" onmouseout="out('-3837734042251911246');" style=""> 192       * Advanced setting. Should Hibernate auto flush before queries during an                                     </span>
<span class="3621392970638403989" onmouseenter="enter('3621392970638403989');" onmouseout="out('3621392970638403989');" style=""> 193       * order save pricing flow. This should generally be able to be left false. This is a performance measure and </span>
<span class="-6789052884213414091" onmouseenter="enter('-6789052884213414091');" onmouseout="out('-6789052884213414091');" style=""> 194       * save operations will be more efficient when this is false.                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195       */                                                                                                           </span>
<span class="-188440796641371951" onmouseenter="enter('-188440796641371951');" onmouseout="out('-188440796641371951');" style=""> 196      @Value(&quot;${auto.flush.on.query.during.cart.pricing.save:false}&quot;)                                               </span>
<span class="-7447722827185958723" onmouseenter="enter('-7447722827185958723');" onmouseout="out('-7447722827185958723');" style=""> 197      protected boolean autoFlushSaveCart = false;                                                                  </span>
<span  style=""> 198                                                                                                                    </span>
<span class="-4259734795637808055" onmouseenter="enter('-4259734795637808055');" onmouseout="out('-4259734795637808055');" style=""> 199      @PersistenceContext(unitName=&quot;blPU&quot;)                                                                          </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style=""> 200      protected EntityManager em;                                                                                   </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-6638939562421962482" onmouseenter="enter('-6638939562421962482');" onmouseout="out('-6638939562421962482');" style=""> 202      /* Fields */                                                                                                  </span>
<span class="-3415856814483301136" onmouseenter="enter('-3415856814483301136');" onmouseout="out('-3415856814483301136');" style=""> 203      protected boolean moveNamedOrderItems = true;                                                                 </span>
<span class="-112332225907304480" onmouseenter="enter('-112332225907304480');" onmouseout="out('-112332225907304480');" style=""> 204      protected boolean deleteEmptyNamedOrders = true;                                                              </span>
<span  style=""> 205                                                                                                                    </span>
<span class="8203140173062168288" onmouseenter="enter('8203140173062168288');" onmouseout="out('8203140173062168288');" style=""> 206      protected Boolean automaticallyMergeLikeItems;                                                                </span>
<span  style=""> 207                                                                                                                    </span>
<span class="2799370370843719797" onmouseenter="enter('2799370370843719797');" onmouseout="out('2799370370843719797');" style=""> 208      @Resource(name = &quot;blOrderMultishipOptionService&quot;)                                                             </span>
<span class="768036680350789739" onmouseenter="enter('768036680350789739');" onmouseout="out('768036680350789739');" style=""> 209      protected OrderMultishipOptionService orderMultishipOptionService;                                            </span>
<span  style=""> 210                                                                                                                    </span>
<span class="1476595721846482438" onmouseenter="enter('1476595721846482438');" onmouseout="out('1476595721846482438');" style=""> 211      @Resource(name = &quot;blOfferServiceExtensionManager&quot;)                                                            </span>
<span class="1464017235088339416" onmouseenter="enter('1464017235088339416');" onmouseout="out('1464017235088339416');" style=""> 212      protected OfferServiceExtensionManager offerServiceExtensionManager;                                          </span>
<span  style=""> 213                                                                                                                    </span>
<span  style=""> 214                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 215      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 216      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="2962710468340724478" onmouseenter="enter('2962710468340724478');" onmouseout="out('2962710468340724478');" style=""> 217      public Order createNewCartForCustomer(Customer customer) {                                                    </span>

<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -        return orderDao.createNewCartForCustomer(customer);                                                       </span>
<span class="-8527029649040543351" onmouseenter="enter('-8527029649040543351');" onmouseout="out('-8527029649040543351');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +        final Object lock = Objects.isNull(customer.getId()) ? customer : customer.getId();                       </span>
<span class="-4616623925289667129" onmouseenter="enter('-4616623925289667129');" onmouseout="out('-4616623925289667129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +        synchronized (lock) {                                                                                     </span>
<span class="4064278658512726247" onmouseenter="enter('4064278658512726247');" onmouseout="out('4064278658512726247');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +            return orderDao.createNewCartForCustomer(customer);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span  style=""> 224                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 225      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 226      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="4441059431493140556" onmouseenter="enter('4441059431493140556');" onmouseout="out('4441059431493140556');" style=""> 227      public Order createNamedOrderForCustomer(String name, Customer customer) {                                    </span>
<span class="-2409876513820161352" onmouseenter="enter('-2409876513820161352');" onmouseout="out('-2409876513820161352');" style=""> 228          Order namedOrder = orderDao.create();                                                                     </span>
<span class="-4702827597577679131" onmouseenter="enter('-4702827597577679131');" onmouseout="out('-4702827597577679131');" style=""> 229          namedOrder.setCustomer(customer);                                                                         </span>
<span class="-5090709722664798426" onmouseenter="enter('-5090709722664798426');" onmouseout="out('-5090709722664798426');" style=""> 230          namedOrder.setName(name);                                                                                 </span>
<span class="-1603494808269519128" onmouseenter="enter('-1603494808269519128');" onmouseout="out('-1603494808269519128');" style=""> 231          namedOrder.setStatus(OrderStatus.NAMED);                                                                  </span>
<span  style=""> 232                                                                                                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 233          if (extensionManager != null) {                                                                           </span>
<span class="8990503012292673298" onmouseenter="enter('8990503012292673298');" onmouseout="out('8990503012292673298');" style=""> 234              extensionManager.getProxy().attachAdditionalDataToNewNamedCart(customer, namedOrder);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235          }                                                                                                         </span>
<span  style=""> 236                                                                                                                    </span>
<span class="6872588596382822440" onmouseenter="enter('6872588596382822440');" onmouseout="out('6872588596382822440');" style=""> 237          if (BroadleafRequestContext.getBroadleafRequestContext() != null) {                                       </span>
<span class="8302259492819337972" onmouseenter="enter('8302259492819337972');" onmouseout="out('8302259492819337972');" style=""> 238              namedOrder.setLocale(BroadleafRequestContext.getBroadleafRequestContext().getLocale());               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239          }                                                                                                         </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-4755266802229314023" onmouseenter="enter('-4755266802229314023');" onmouseout="out('-4755266802229314023');" style=""> 241          return persist(namedOrder); // No need to price here                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242      }                                                                                                             </span>
<span  style=""> 243                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244      @Override                                                                                                     </span>
<span class="-5228222697072727023" onmouseenter="enter('-5228222697072727023');" onmouseout="out('-5228222697072727023');" style=""> 245      public Order findNamedOrderForCustomer(String name, Customer customer) {                                      </span>
<span class="3593606300255125692" onmouseenter="enter('3593606300255125692');" onmouseout="out('3593606300255125692');" style=""> 246          return orderDao.readNamedOrderForCustomer(customer, name);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247      }                                                                                                             </span>
<span  style=""> 248                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 249      @Override                                                                                                     </span>
<span class="-3536100433526278820" onmouseenter="enter('-3536100433526278820');" onmouseout="out('-3536100433526278820');" style=""> 250      public Order findOrderById(Long orderId) {                                                                    </span>
<span class="1161210593743093685" onmouseenter="enter('1161210593743093685');" onmouseout="out('1161210593743093685');" style=""> 251          return orderDao.readOrderById(orderId);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252      }                                                                                                             </span>
<span  style=""> 253                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 254      @Override                                                                                                     </span>
<span class="3514330874800299886" onmouseenter="enter('3514330874800299886');" onmouseout="out('3514330874800299886');" style=""> 255      public List&lt;Order&gt; findOrdersByIds(List&lt;Long&gt; orderIds) {                                                     </span>
<span class="-3891915877440809040" onmouseenter="enter('-3891915877440809040');" onmouseout="out('-3891915877440809040');" style=""> 256          return orderDao.readOrdersByIds(orderIds);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257      }                                                                                                             </span>
<span  style=""> 258                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 259      @Override                                                                                                     </span>
<span class="4729011646907808921" onmouseenter="enter('4729011646907808921');" onmouseout="out('4729011646907808921');" style=""> 260      public Order findOrderById(Long orderId, boolean refresh) {                                                   </span>
<span class="-1498807655754375115" onmouseenter="enter('-1498807655754375115');" onmouseout="out('-1498807655754375115');" style=""> 261          return orderDao.readOrderById(orderId, refresh);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span  style=""> 263                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 264      @Override                                                                                                     </span>
<span class="6472182469411690717" onmouseenter="enter('6472182469411690717');" onmouseout="out('6472182469411690717');" style=""> 265      public Order getNullOrder() {                                                                                 </span>
<span class="-9215158658227454796" onmouseenter="enter('-9215158658227454796');" onmouseout="out('-9215158658227454796');" style=""> 266          return nullOrderFactory.getNullOrder();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267      }                                                                                                             </span>
<span  style=""> 268                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 269      @Override                                                                                                     </span>
<span class="-868163728006062843" onmouseenter="enter('-868163728006062843');" onmouseout="out('-868163728006062843');" style=""> 270      public Order findCartForCustomer(Customer customer) {                                                         </span>
<span class="8766840141038390904" onmouseenter="enter('8766840141038390904');" onmouseout="out('8766840141038390904');" style=""> 271          return orderDao.readCartForCustomer(customer);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272      }                                                                                                             </span>
<span  style=""> 273                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 274      @Override                                                                                                     </span>
<span class="-7652784715167872669" onmouseenter="enter('-7652784715167872669');" onmouseout="out('-7652784715167872669');" style=""> 275      public List&lt;Order&gt; findOrdersForCustomer(Customer customer) {                                                 </span>
<span class="-1451410109320389957" onmouseenter="enter('-1451410109320389957');" onmouseout="out('-1451410109320389957');" style=""> 276          return orderDao.readOrdersForCustomer(customer.getId());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277      }                                                                                                             </span>
<span  style=""> 278                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 279      @Override                                                                                                     </span>
<span class="-1874817631753699552" onmouseenter="enter('-1874817631753699552');" onmouseout="out('-1874817631753699552');" style=""> 280      public List&lt;Order&gt; findOrdersForCustomer(Customer customer, OrderStatus status) {                             </span>
<span class="8303115895394445841" onmouseenter="enter('8303115895394445841');" onmouseout="out('8303115895394445841');" style=""> 281          return orderDao.readOrdersForCustomer(customer, status);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282      }                                                                                                             </span>
<span  style=""> 283                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 284      @Override                                                                                                     </span>
<span class="-5868034956931005765" onmouseenter="enter('-5868034956931005765');" onmouseout="out('-5868034956931005765');" style=""> 285      public Order findOrderByOrderNumber(String orderNumber) {                                                     </span>
<span class="4126063111294586184" onmouseenter="enter('4126063111294586184');" onmouseout="out('4126063111294586184');" style=""> 286          return orderDao.readOrderByOrderNumber(orderNumber);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287      }                                                                                                             </span>
<span  style=""> 288                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 289      @Override                                                                                                     </span>
<span class="4191009625455802778" onmouseenter="enter('4191009625455802778');" onmouseout="out('4191009625455802778');" style=""> 290      public List&lt;Order&gt; findOrdersByDateRange(Date startDate, Date endDate) {                                      </span>
<span class="4159366983783237003" onmouseenter="enter('4159366983783237003');" onmouseout="out('4159366983783237003');" style=""> 291          return orderDao.readOrdersByDateRange(startDate, endDate);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292      }                                                                                                             </span>
<span  style=""> 293                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 294      @Override                                                                                                     </span>
<span class="-5094637214545511446" onmouseenter="enter('-5094637214545511446');" onmouseout="out('-5094637214545511446');" style=""> 295      public List&lt;Order&gt; findOrdersByDaysCount(Integer daysCount, Integer batchSize) {                              </span>
<span class="-5623433853176777156" onmouseenter="enter('-5623433853176777156');" onmouseout="out('-5623433853176777156');" style=""> 296          return orderDao.readOrdersOlderThanDaysCount(daysCount, batchSize);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297      }                                                                                                             </span>
<span  style=""> 298                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 299      @Override                                                                                                     </span>
<span class="7584459338142486264" onmouseenter="enter('7584459338142486264');" onmouseout="out('7584459338142486264');" style=""> 300      public List&lt;Order&gt; findOrdersForCustomersInDateRange(List&lt;Long&gt; customerIds, Date startDate, Date endDate) {  </span>
<span class="-7476578265182813965" onmouseenter="enter('-7476578265182813965');" onmouseout="out('-7476578265182813965');" style=""> 301          return orderDao.readOrdersForCustomersInDateRange(customerIds, startDate, endDate);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span  style=""> 303                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 304      @Override                                                                                                     </span>
<span class="2742799531036946157" onmouseenter="enter('2742799531036946157');" onmouseout="out('2742799531036946157');" style=""> 305      public List&lt;OrderPayment&gt; findPaymentsForOrder(Order order) {                                                 </span>
<span class="-8492719680919611182" onmouseenter="enter('-8492719680919611182');" onmouseout="out('-8492719680919611182');" style=""> 306          return paymentDao.readPaymentsForOrder(order);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307      }                                                                                                             </span>
<span  style=""> 308                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 309      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 310      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-3332960922797777344" onmouseenter="enter('-3332960922797777344');" onmouseout="out('-3332960922797777344');" style=""> 311      public OrderPayment addPaymentToOrder(Order order, OrderPayment payment, Referenced securePaymentInfo) {      </span>
<span class="5531588484946379356" onmouseenter="enter('5531588484946379356');" onmouseout="out('5531588484946379356');" style=""> 312          payment.setOrder(order);                                                                                  </span>
<span class="-5902578581570361338" onmouseenter="enter('-5902578581570361338');" onmouseout="out('-5902578581570361338');" style=""> 313          order.getPayments().add(payment);                                                                         </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 314          order = persist(order);                                                                                   </span>
<span class="3102030919604467575" onmouseenter="enter('3102030919604467575');" onmouseout="out('3102030919604467575');" style=""> 315          int paymentIndex = order.getPayments().size() - 1;                                                        </span>
<span  style=""> 316                                                                                                                    </span>
<span class="-1059731582497422542" onmouseenter="enter('-1059731582497422542');" onmouseout="out('-1059731582497422542');" style=""> 317          if (securePaymentInfo != null) {                                                                          </span>
<span class="-3146705087638884484" onmouseenter="enter('-3146705087638884484');" onmouseout="out('-3146705087638884484');" style=""> 318              securePaymentInfoService.save(securePaymentInfo);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319          }                                                                                                         </span>
<span  style=""> 320                                                                                                                    </span>
<span class="-7441301587762344543" onmouseenter="enter('-7441301587762344543');" onmouseout="out('-7441301587762344543');" style=""> 321          return order.getPayments().get(paymentIndex);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322      }                                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 324      @Override                                                                                                     </span>
<span class="-6260636294738378695" onmouseenter="enter('-6260636294738378695');" onmouseout="out('-6260636294738378695');" style=""> 325      public Order save(Order order, boolean priceOrder, boolean repriceItems) throws PricingException {            </span>
<span class="-861950305740674202" onmouseenter="enter('-861950305740674202');" onmouseout="out('-861950305740674202');" style=""> 326          if (repriceItems) {                                                                                       </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 327              order.updatePrices();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328          }                                                                                                         </span>
<span class="7466161317523035871" onmouseenter="enter('7466161317523035871');" onmouseout="out('7466161317523035871');" style=""> 329          return save(order, priceOrder);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330      }                                                                                                             </span>
<span  style=""> 331                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 332      @Override                                                                                                     </span>
<span class="3492049941937307387" onmouseenter="enter('3492049941937307387');" onmouseout="out('3492049941937307387');" style=""> 333      public Order save(Order order, Boolean priceOrder) throws PricingException {                                  </span>
<span class="-7596987583027747839" onmouseenter="enter('-7596987583027747839');" onmouseout="out('-7596987583027747839');" style=""> 334          //persist the order first                                                                                 </span>
<span class="-389595421943223582" onmouseenter="enter('-389595421943223582');" onmouseout="out('-389595421943223582');" style=""> 335          TransactionStatus status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 336                      TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 337          try {                                                                                                     </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 338              order = persist(order);                                                                               </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 339              TransactionUtils.finalizeTransaction(status, transactionManager, false);                              </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 340          } catch (RuntimeException ex) {                                                                           </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 341              TransactionUtils.finalizeTransaction(status, transactionManager, true);                               </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 342              throw ex;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343          }                                                                                                         </span>
<span  style=""> 344                                                                                                                    </span>
<span class="3415408115507489273" onmouseenter="enter('3415408115507489273');" onmouseout="out('3415408115507489273');" style=""> 345          //make any pricing changes - possibly retrying with the persisted state if there&#x27;s a lock failure         </span>
<span class="3259489568218221951" onmouseenter="enter('3259489568218221951');" onmouseout="out('3259489568218221951');" style=""> 346          if (priceOrder) {                                                                                         </span>
<span class="1922471648485581677" onmouseenter="enter('1922471648485581677');" onmouseout="out('1922471648485581677');" style=""> 347              int retryCount = 0;                                                                                   </span>
<span class="-3964676588024243488" onmouseenter="enter('-3964676588024243488');" onmouseout="out('-3964676588024243488');" style=""> 348              boolean isValid = false;                                                                              </span>
<span class="-6184322868026722475" onmouseenter="enter('-6184322868026722475');" onmouseout="out('-6184322868026722475');" style=""> 349              while (!isValid) {                                                                                    </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 350                  Session session = em.unwrap(Session.class);                                                       </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 351                  FlushMode current = session.getHibernateFlushMode();                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 352                  try {                                                                                             </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 353                      if (!autoFlushSaveCart) {                                                                     </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 354                          //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 354                          //Performance measure. Hibernate will sometimes perform an autoflush when performing queryðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 355                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 355                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 356                          //incorrect results because something has not been flushed to the database yet.           </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 357                          session.setHibernateFlushMode(FlushMode.MANUAL);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358                      }                                                                                             </span>
<span class="8892823389652271355" onmouseenter="enter('8892823389652271355');" onmouseout="out('8892823389652271355');" style=""> 359                      order = pricingService.executePricing(order);                                                 </span>
<span class="9041443712359372060" onmouseenter="enter('9041443712359372060');" onmouseout="out('9041443712359372060');" style=""> 360                      isValid = true;                                                                               </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style=""> 361                  } catch (Exception ex) {                                                                          </span>
<span class="-2271119485062807010" onmouseenter="enter('-2271119485062807010');" onmouseout="out('-2271119485062807010');" style=""> 362                      boolean isValidCause = false;                                                                 </span>
<span class="-500838144782668299" onmouseenter="enter('-500838144782668299');" onmouseout="out('-500838144782668299');" style=""> 363                      Throwable cause = ex;                                                                         </span>
<span class="1460063134918401876" onmouseenter="enter('1460063134918401876');" onmouseout="out('1460063134918401876');" style=""> 364                      while (!isValidCause) {                                                                       </span>
<span class="4260495870590788788" onmouseenter="enter('4260495870590788788');" onmouseout="out('4260495870590788788');" style=""> 365                          if (cause.getClass().equals(LockAcquisitionException.class)) {                            </span>
<span class="-2629587088788625810" onmouseenter="enter('-2629587088788625810');" onmouseout="out('-2629587088788625810');" style=""> 366                              isValidCause = true;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367                          }                                                                                         </span>
<span class="8625050852301041214" onmouseenter="enter('8625050852301041214');" onmouseout="out('8625050852301041214');" style=""> 368                          cause = cause.getCause();                                                                 </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style=""> 369                          if (cause == null) {                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 370                              break;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372                      }                                                                                             </span>
<span class="617128514241385440" onmouseenter="enter('617128514241385440');" onmouseout="out('617128514241385440');" style=""> 373                      if (isValidCause) {                                                                           </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 374                          if (LOG.isInfoEnabled()) {                                                                </span>
<span class="-1515480896436827747" onmouseenter="enter('-1515480896436827747');" onmouseout="out('-1515480896436827747');" style=""> 375                              LOG.info(&quot;Problem acquiring lock during pricing call - attempting to price again.&quot;);  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376                          }                                                                                         </span>
<span class="-5133746822051192612" onmouseenter="enter('-5133746822051192612');" onmouseout="out('-5133746822051192612');" style=""> 377                          isValid = false;                                                                          </span>
<span class="4577651777641283233" onmouseenter="enter('4577651777641283233');" onmouseout="out('4577651777641283233');" style=""> 378                          if (retryCount &gt;= pricingRetryCountForLockFailure) {                                      </span>
<span class="-4873093459421651994" onmouseenter="enter('-4873093459421651994');" onmouseout="out('-4873093459421651994');" style=""> 379                              if (LOG.isInfoEnabled()) {                                                            </span>
<span class="8668513794109504150" onmouseenter="enter('8668513794109504150');" onmouseout="out('8668513794109504150');" style=""><abbr title=" 380                                  LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; + retryCount + &quot;). Throwing exception.&quot;);"> 380                                  LOG.info(&quot;Problem acquiring lock during pricing call. Retry limit exceeded at (&quot; +ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381                              }                                                                                     </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 382                              if (ex instanceof PricingException) {                                                 </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 383                                  throw (PricingException) ex;                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 384                              } else {                                                                              </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 385                                  throw new PricingException(ex);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386                              }                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 387                          } else {                                                                                  </span>
<span class="-1359453246670658998" onmouseenter="enter('-1359453246670658998');" onmouseout="out('-1359453246670658998');" style=""> 388                              order = findOrderById(order.getId());                                                 </span>
<span class="1564014130404929121" onmouseenter="enter('1564014130404929121');" onmouseout="out('1564014130404929121');" style=""> 389                              retryCount++;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390                          }                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 391                          try {                                                                                     </span>
<span class="-1188508433081841324" onmouseenter="enter('-1188508433081841324');" onmouseout="out('-1188508433081841324');" style=""> 392                              Thread.sleep(pricingRetryWaitIntervalForLockFailure);                                 </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style=""> 393                          } catch (Throwable e) {                                                                   </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 394                              //do nothing                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395                          }                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 396                      } else {                                                                                      </span>
<span class="7472901078957906516" onmouseenter="enter('7472901078957906516');" onmouseout="out('7472901078957906516');" style=""> 397                          if (ex instanceof PricingException) {                                                     </span>
<span class="2469828804259227961" onmouseenter="enter('2469828804259227961');" onmouseout="out('2469828804259227961');" style=""> 398                              throw (PricingException) ex;                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 399                          } else {                                                                                  </span>
<span class="9060566973398350249" onmouseenter="enter('9060566973398350249');" onmouseout="out('9060566973398350249');" style=""> 400                              throw new PricingException(ex);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402                      }                                                                                             </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 403                  } finally {                                                                                       </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 404                      if (!autoFlushSaveCart) {                                                                     </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 405                          session.setHibernateFlushMode(current);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408              }                                                                                                     </span>
<span  style=""> 409                                                                                                                    </span>
<span class="-3104014921676861204" onmouseenter="enter('-3104014921676861204');" onmouseout="out('-3104014921676861204');" style=""> 410              //make the final save of the priced order                                                             </span>
<span class="-5185576183489418340" onmouseenter="enter('-5185576183489418340');" onmouseout="out('-5185576183489418340');" style=""> 411              status = TransactionUtils.createTransaction(&quot;saveOrder&quot;,                                              </span>
<span class="1168284124728548434" onmouseenter="enter('1168284124728548434');" onmouseout="out('1168284124728548434');" style=""> 412                                  TransactionDefinition.PROPAGATION_REQUIRED, transactionManager);                  </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 413              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 414              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 415              try {                                                                                                 </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 416                  if (!autoFlushSaveCart) {                                                                         </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 417                      //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 417                      //Performance measure. Hibernate will sometimes perform an autoflush when performing query opeðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 418                      //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 418                      //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in tðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 419                      //incorrect results because something has not been flushed to the database yet.               </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 420                      session.setHibernateFlushMode(FlushMode.MANUAL);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421                  }                                                                                                 </span>
<span class="-1513225391584259550" onmouseenter="enter('-1513225391584259550');" onmouseout="out('-1513225391584259550');" style=""> 422                  order = persist(order);                                                                           </span>
<span  style=""> 423                                                                                                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 424                  if (extensionManager != null) {                                                                   </span>
<span class="3957126338116198589" onmouseenter="enter('3957126338116198589');" onmouseout="out('3957126338116198589');" style=""> 425                      extensionManager.getProxy().attachAdditionalDataToOrder(order, priceOrder);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426                  }                                                                                                 </span>
<span class="-8336730214389471675" onmouseenter="enter('-8336730214389471675');" onmouseout="out('-8336730214389471675');" style=""> 427                  if (!autoFlushSaveCart) {                                                                         </span>
<span class="-582956567966567765" onmouseenter="enter('-582956567966567765');" onmouseout="out('-582956567966567765');" style=""> 428                      session.setFlushMode(current);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429                  }                                                                                                 </span>
<span class="1624993680032303162" onmouseenter="enter('1624993680032303162');" onmouseout="out('1624993680032303162');" style=""> 430                  TransactionUtils.finalizeTransaction(status, transactionManager, false);                          </span>
<span class="3255801419413274971" onmouseenter="enter('3255801419413274971');" onmouseout="out('3255801419413274971');" style=""> 431              } catch (RuntimeException ex) {                                                                       </span>
<span class="8253539662668603618" onmouseenter="enter('8253539662668603618');" onmouseout="out('8253539662668603618');" style=""> 432                  TransactionUtils.finalizeTransaction(status, transactionManager, true);                           </span>
<span class="8479095309709473887" onmouseenter="enter('8479095309709473887');" onmouseout="out('8479095309709473887');" style=""> 433                  throw ex;                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 434              } finally {                                                                                           </span>
<span class="8320148466827839591" onmouseenter="enter('8320148466827839591');" onmouseout="out('8320148466827839591');" style=""> 435                  if (!autoFlushSaveCart &amp;&amp; !session.getFlushMode().equals(current)) {                              </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 436                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439          }                                                                                                         </span>
<span  style=""> 440                                                                                                                    </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 441          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442      }                                                                                                             </span>
<span  style=""> 443                                                                                                                    </span>
<span class="3548225205011979861" onmouseenter="enter('3548225205011979861');" onmouseout="out('3548225205011979861');" style=""> 444      // This method exists to provide OrderService methods the ability to save an order                            </span>
<span class="-3137042620959847201" onmouseenter="enter('-3137042620959847201');" onmouseout="out('-3137042620959847201');" style=""> 445      // without having to worry about a PricingException being thrown.                                             </span>
<span class="-8294379095766791864" onmouseenter="enter('-8294379095766791864');" onmouseout="out('-8294379095766791864');" style=""> 446      protected Order persist(Order order) {                                                                        </span>
<span class="8818772614490614908" onmouseenter="enter('8818772614490614908');" onmouseout="out('8818772614490614908');" style=""> 447          return orderDao.save(order);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448      }                                                                                                             </span>
<span  style=""> 449                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 450      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 451      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="1194611983531410278" onmouseenter="enter('1194611983531410278');" onmouseout="out('1194611983531410278');" style=""> 452      public void cancelOrder(Order order) {                                                                        </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 453          orderDao.delete(order);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454      }                                                                                                             </span>
<span  style=""> 455                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 456      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 457      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="3151062967360623973" onmouseenter="enter('3151062967360623973');" onmouseout="out('3151062967360623973');" style=""> 458      public void deleteOrder(Order order) {                                                                        </span>
<span class="362561214599706117" onmouseenter="enter('362561214599706117');" onmouseout="out('362561214599706117');" style=""> 459          orderMultishipOptionService.deleteAllOrderMultishipOptions(order);                                        </span>
<span class="-3988456155337639945" onmouseenter="enter('-3988456155337639945');" onmouseout="out('-3988456155337639945');" style=""> 460          orderDao.delete(order);                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461      }                                                                                                             </span>
<span  style=""> 462                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 463      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 464      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6908985997151819220" onmouseenter="enter('-6908985997151819220');" onmouseout="out('-6908985997151819220');" style=""><abbr title=" 465      public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferException {"> 465      public Order addOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException, OfferðŸ”µ</abbr></span>
<span class="-6957816096303048614" onmouseenter="enter('-6957816096303048614');" onmouseout="out('-6957816096303048614');" style=""> 466          ArrayList&lt;OfferCode&gt; offerCodes = new ArrayList&lt;OfferCode&gt;();                                             </span>
<span class="-3489605780287301859" onmouseenter="enter('-3489605780287301859');" onmouseout="out('-3489605780287301859');" style=""> 467          offerCodes.add(offerCode);                                                                                </span>
<span class="5360942362216082169" onmouseenter="enter('5360942362216082169');" onmouseout="out('5360942362216082169');" style=""> 468          return addOfferCodes(order, offerCodes, priceOrder);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469      }                                                                                                             </span>
<span  style=""> 470                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 471      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 472      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6002760974922308486" onmouseenter="enter('-6002760974922308486');" onmouseout="out('-6002760974922308486');" style=""><abbr title=" 473      public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingException, OfferException {"> 473      public Order addOfferCodes(Order order, List&lt;OfferCode&gt; offerCodes, boolean priceOrder) throws PricingExceptioðŸ”µ</abbr></span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 474          preValidateCartOperation(order);                                                                          </span>
<span class="-6297044254079066685" onmouseenter="enter('-6297044254079066685');" onmouseout="out('-6297044254079066685');" style=""> 475          Set&lt;Offer&gt; addedOffers = offerService.getUniqueOffersFromOrder(order);                                    </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 476          if (extensionManager != null) {                                                                           </span>
<span class="4843221393928633011" onmouseenter="enter('4843221393928633011');" onmouseout="out('4843221393928633011');" style=""> 477              extensionManager.getProxy().addOfferCodes(order, offerCodes, priceOrder);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span class="-5013116012900958115" onmouseenter="enter('-5013116012900958115');" onmouseout="out('-5013116012900958115');" style=""> 479          if (offerCodes != null &amp;&amp; !offerCodes.isEmpty()) {                                                        </span>
<span class="8649045155270180220" onmouseenter="enter('8649045155270180220');" onmouseout="out('8649045155270180220');" style=""> 480              for (OfferCode offerCode : offerCodes) {                                                              </span>
<span  style=""> 481                                                                                                                    </span>
<span class="-7298696073195110538" onmouseenter="enter('-7298696073195110538');" onmouseout="out('-7298696073195110538');" style=""><abbr title=" 482                  if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) {"> 482                  if (order.getAddedOfferCodes().contains(offerCode) || addedOffers.contains(offerCode.getOffer())) ðŸ”µ</abbr></span>
<span class="6234350320401768221" onmouseenter="enter('6234350320401768221');" onmouseout="out('6234350320401768221');" style=""> 483                      throw new OfferAlreadyAddedException(&quot;The offer has already been added.&quot;);                    </span>
<span class="-3830868071340909057" onmouseenter="enter('-3830868071340909057');" onmouseout="out('-3830868071340909057');" style=""> 484                  } else if (!offerService.verifyMaxCustomerUsageThreshold(order, offerCode)) {                     </span>
<span class="4333070718197812940" onmouseenter="enter('4333070718197812940');" onmouseout="out('4333070718197812940');" style=""><abbr title=" 485                      throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maximum allowed number of times.&quot;);"> 485                      throw new OfferMaxUseExceededException(&quot;The customer has used this offer code more than the maðŸ”µ</abbr></span>
<span class="-5924935946468451057" onmouseenter="enter('-5924935946468451057');" onmouseout="out('-5924935946468451057');" style=""> 486                  } else if (!offerCode.isActive() || !offerCode.getOffer().isActive()) {                           </span>
<span class="-5410451342198456207" onmouseenter="enter('-5410451342198456207');" onmouseout="out('-5410451342198456207');" style=""> 487                      throw new OfferExpiredException(&quot;The offer has expired.&quot;);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488                  }                                                                                                 </span>
<span  style=""> 489                                                                                                                    </span>
<span class="-8263838424494001377" onmouseenter="enter('-8263838424494001377');" onmouseout="out('-8263838424494001377');" style=""> 490                  order.getAddedOfferCodes().add(offerCode);                                                        </span>
<span  style=""> 491                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492              }                                                                                                     </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 493              order = save(order, priceOrder);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494          }                                                                                                         </span>
<span  style=""> 495                                                                                                                    </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 496          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497      }                                                                                                             </span>
<span  style=""> 498                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 499      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 500      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-8165165962317769711" onmouseenter="enter('-8165165962317769711');" onmouseout="out('-8165165962317769711');" style=""> 501      public Order removeOfferCode(Order order, OfferCode offerCode, boolean priceOrder) throws PricingException {  </span>
<span class="7292636042273352545" onmouseenter="enter('7292636042273352545');" onmouseout="out('7292636042273352545');" style=""> 502          order.getAddedOfferCodes().remove(offerCode);                                                             </span>
<span class="-7106254142148835248" onmouseenter="enter('-7106254142148835248');" onmouseout="out('-7106254142148835248');" style=""> 503          offerServiceExtensionManager.removeOfferCodeFromOrder(offerCode, order);                                  </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 504          order = save(order, priceOrder);                                                                          </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 505          return order;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506      }                                                                                                             </span>
<span  style=""> 507                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 508      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 509      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1709915701203298020" onmouseenter="enter('-1709915701203298020');" onmouseout="out('-1709915701203298020');" style=""> 510      public Order removeAllOfferCodes(Order order, boolean priceOrder) throws PricingException {                   </span>
<span class="-6954607053476807171" onmouseenter="enter('-6954607053476807171');" onmouseout="out('-6954607053476807171');" style=""> 511           order.getAddedOfferCodes().clear();                                                                      </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 512           order = save(order, priceOrder);                                                                         </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style=""> 513           return order;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514      }                                                                                                             </span>
<span  style=""> 515                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 516      @Override                                                                                                     </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 517      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 517      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimðŸ”µ</abbr></span>
<span class="6605929857558449758" onmouseenter="enter('6605929857558449758');" onmouseout="out('6605929857558449758');" style=""> 518      public void setDeleteEmptyNamedOrders(boolean deleteEmptyNamedOrders) {                                       </span>
<span class="-5922450764665272748" onmouseenter="enter('-5922450764665272748');" onmouseout="out('-5922450764665272748');" style=""> 519          this.deleteEmptyNamedOrders = deleteEmptyNamedOrders;                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span  style=""> 521                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 522      @Override                                                                                                     </span>
<span class="8809427274039428572" onmouseenter="enter('8809427274039428572');" onmouseout="out('8809427274039428572');" style=""> 523      public OrderItem findLastMatchingItem(Order order, Long skuId, Long productId) {                              </span>
<span class="3897119298100986011" onmouseenter="enter('3897119298100986011');" onmouseout="out('3897119298100986011');" style=""> 524          if (order.getOrderItems() != null) {                                                                      </span>
<span class="3057467599356722650" onmouseenter="enter('3057467599356722650');" onmouseout="out('3057467599356722650');" style=""> 525              for (int i=(order.getOrderItems().size()-1); i &gt;= 0; i--) {                                           </span>
<span class="-8753960614479292481" onmouseenter="enter('-8753960614479292481');" onmouseout="out('-8753960614479292481');" style=""> 526                  OrderItem currentItem = (order.getOrderItems().get(i));                                           </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style=""> 527                  if (currentItem instanceof DiscreteOrderItem) {                                                   </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style=""> 528                      DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                             </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 529                      if (skuId != null) {                                                                          </span>
<span class="-8668132489177117394" onmouseenter="enter('-8668132489177117394');" onmouseout="out('-8668132489177117394');" style=""> 530                          if (discreteItem.getSku() != null &amp;&amp; skuId.equals(discreteItem.getSku().getId())) {       </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 531                              return discreteItem;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                          }                                                                                         </span>
<span class="2262602886329333955" onmouseenter="enter('2262602886329333955');" onmouseout="out('2262602886329333955');" style=""><abbr title=" 533                      } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteItem.getProduct().getId())) {"> 533                      } else if (productId != null &amp;&amp; discreteItem.getProduct() != null &amp;&amp; productId.equals(discreteðŸ”µ</abbr></span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style=""> 534                          return discreteItem;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                      }                                                                                             </span>
<span  style=""> 536                                                                                                                    </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style=""> 537                  } else if (currentItem instanceof BundleOrderItem) {                                              </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style=""> 538                      BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                                   </span>
<span class="-3267813558094606678" onmouseenter="enter('-3267813558094606678');" onmouseout="out('-3267813558094606678');" style=""> 539                      if (skuId != null) {                                                                          </span>
<span class="-2960070722540544872" onmouseenter="enter('-2960070722540544872');" onmouseout="out('-2960070722540544872');" style=""> 540                          if (bundleItem.getSku() != null &amp;&amp; skuId.equals(bundleItem.getSku().getId())) {           </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 541                              return bundleItem;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542                          }                                                                                         </span>
<span class="2116719638664851076" onmouseenter="enter('2116719638664851076');" onmouseout="out('2116719638664851076');" style=""><abbr title=" 543                      } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItem.getProduct().getId())) {"> 543                      } else if (productId != null &amp;&amp; bundleItem.getProduct() != null &amp;&amp; productId.equals(bundleItemðŸ”µ</abbr></span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style=""> 544                          return bundleItem;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 549          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 550      }                                                                                                             </span>
<span  style=""> 551                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 552      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 553      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-6433964895207235713" onmouseenter="enter('-6433964895207235713');" onmouseout="out('-6433964895207235713');" style=""> 554      public Order confirmOrder(Order order) {                                                                      </span>
<span class="9181791888739176058" onmouseenter="enter('9181791888739176058');" onmouseout="out('9181791888739176058');" style=""> 555          return orderDao.submitOrder(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556      }                                                                                                             </span>
<span  style=""> 557                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 558      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 559      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1196063989926378996" onmouseenter="enter('-1196063989926378996');" onmouseout="out('-1196063989926378996');" style=""><abbr title=" 560      public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 560      public Order addAllItemsFromNamedOrder(Order namedOrder, boolean priceOrder) throws RemoveFromCartException, AðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 561          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 562          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 563              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 564          }                                                                                                         </span>
<span class="6349420761965903996" onmouseenter="enter('6349420761965903996');" onmouseout="out('6349420761965903996');" style=""> 565          List&lt;OrderItem&gt; items = new ArrayList&lt;OrderItem&gt;(namedOrder.getOrderItems());                             </span>
<span  style=""> 566                                                                                                                    </span>
<span class="6607428262094447152" onmouseenter="enter('6607428262094447152');" onmouseout="out('6607428262094447152');" style=""> 567          // Remove any order items that are children                                                               </span>
<span class="7631703850134052237" onmouseenter="enter('7631703850134052237');" onmouseout="out('7631703850134052237');" style=""> 568          CollectionUtils.filter(items,  new TypedPredicate&lt;OrderItem&gt;() {                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 569              @Override                                                                                             </span>
<span class="4901231018495450056" onmouseenter="enter('4901231018495450056');" onmouseout="out('4901231018495450056');" style=""> 570              public boolean eval(OrderItem orderItem) {                                                            </span>
<span class="-2481948952058789921" onmouseenter="enter('-2481948952058789921');" onmouseout="out('-2481948952058789921');" style=""> 571                  return orderItem.getParentOrderItem() == null;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 572              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 573          });                                                                                                       </span>
<span class="-4844745637831365496" onmouseenter="enter('-4844745637831365496');" onmouseout="out('-4844745637831365496');" style=""> 574          for (OrderItem item : items) {                                                                            </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 575              OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);  </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 576              cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                 </span>
<span  style=""> 577                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 578              if (moveNamedOrderItems) {                                                                            </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 579                  removeItem(namedOrder.getId(), item.getId(), false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 581          }                                                                                                         </span>
<span  style=""> 582                                                                                                                    </span>
<span class="-6527299291227137901" onmouseenter="enter('-6527299291227137901');" onmouseout="out('-6527299291227137901');" style=""> 583          if (deleteEmptyNamedOrders) {                                                                             </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 584              cancelOrder(namedOrder);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585          }                                                                                                         </span>
<span  style=""> 586                                                                                                                    </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 587          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 588      }                                                                                                             </span>
<span  style=""> 589                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 590      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 591      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="486294103490899905" onmouseenter="enter('486294103490899905');" onmouseout="out('486294103490899905');" style=""><abbr title=" 592      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartException, AddToCartException {"> 592      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, boolean priceOrder) throws RemoveFromCartðŸ”µ</abbr></span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 593          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 594          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 595              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 596          }                                                                                                         </span>
<span  style=""> 597                                                                                                                    </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 598          OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);      </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 599          cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                     </span>
<span  style=""> 600                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 601          if (moveNamedOrderItems) {                                                                                </span>
<span class="5657544415191055254" onmouseenter="enter('5657544415191055254');" onmouseout="out('5657544415191055254');" style=""> 602              removeItem(namedOrder.getId(), item.getId(), false);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603          }                                                                                                         </span>
<span  style=""> 604                                                                                                                    </span>
<span class="-3555431676535314681" onmouseenter="enter('-3555431676535314681');" onmouseout="out('-3555431676535314681');" style=""> 605          if (namedOrder.getOrderItems().size() == 0 &amp;&amp; deleteEmptyNamedOrders) {                                   </span>
<span class="1626114747734410317" onmouseenter="enter('1626114747734410317');" onmouseout="out('1626114747734410317');" style=""> 606              cancelOrder(namedOrder);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607          }                                                                                                         </span>
<span  style=""> 608                                                                                                                    </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 609          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610      }                                                                                                             </span>
<span  style=""> 611                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 612      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 613      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="6073762115033780324" onmouseenter="enter('6073762115033780324');" onmouseout="out('6073762115033780324');" style=""><abbr title=" 614      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws RemoveFromCartException, AddToCartException, UpdateCartException {"> 614      public Order addItemFromNamedOrder(Order namedOrder, OrderItem item, int quantity, boolean priceOrder) throws ðŸ”µ</abbr></span>
<span class="-6164187211557222893" onmouseenter="enter('-6164187211557222893');" onmouseout="out('-6164187211557222893');" style=""> 615          // Validate that the quantity requested makes sense                                                       </span>
<span class="632487064450637769" onmouseenter="enter('632487064450637769');" onmouseout="out('632487064450637769');" style=""> 616          if (quantity &lt; 1 || quantity &gt; item.getQuantity()) {                                                      </span>
<span class="9015263082333587317" onmouseenter="enter('9015263082333587317');" onmouseout="out('9015263082333587317');" style=""> 617              throw new IllegalArgumentException(&quot;Cannot move 0 or less quantity&quot;);                                 </span>
<span class="5237951611682684444" onmouseenter="enter('5237951611682684444');" onmouseout="out('5237951611682684444');" style=""> 618          } else if (quantity == item.getQuantity()) {                                                              </span>
<span class="-6422299663726892430" onmouseenter="enter('-6422299663726892430');" onmouseout="out('-6422299663726892430');" style=""> 619              return addItemFromNamedOrder(namedOrder, item, priceOrder);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620          }                                                                                                         </span>
<span  style=""> 621                                                                                                                    </span>
<span class="1594062279994823759" onmouseenter="enter('1594062279994823759');" onmouseout="out('1594062279994823759');" style=""> 622          Order cartOrder = orderDao.readCartForCustomer(namedOrder.getCustomer());                                 </span>
<span class="2199109909196353711" onmouseenter="enter('2199109909196353711');" onmouseout="out('2199109909196353711');" style=""> 623          if (cartOrder == null) {                                                                                  </span>
<span class="1468813060707387638" onmouseenter="enter('1468813060707387638');" onmouseout="out('1468813060707387638');" style=""> 624              cartOrder = createNewCartForCustomer(namedOrder.getCustomer());                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625          }                                                                                                         </span>
<span  style=""> 626                                                                                                                    </span>
<span class="-4477779525911352780" onmouseenter="enter('-4477779525911352780');" onmouseout="out('-4477779525911352780');" style=""> 627          OrderItemRequestDTO orderItemRequest = orderItemService.buildOrderItemRequestDTOFromOrderItem(item);      </span>
<span class="8127078771873751614" onmouseenter="enter('8127078771873751614');" onmouseout="out('8127078771873751614');" style=""> 628          orderItemRequest.setQuantity(quantity);                                                                   </span>
<span class="-8689878210081109402" onmouseenter="enter('-8689878210081109402');" onmouseout="out('-8689878210081109402');" style=""> 629          cartOrder = addItem(cartOrder.getId(), orderItemRequest, priceOrder);                                     </span>
<span  style=""> 630                                                                                                                    </span>
<span class="-4568432078182420464" onmouseenter="enter('-4568432078182420464');" onmouseout="out('-4568432078182420464');" style=""> 631          if (moveNamedOrderItems) {                                                                                </span>
<span class="-1872324351499578531" onmouseenter="enter('-1872324351499578531');" onmouseout="out('-1872324351499578531');" style=""> 632              // Update the old item to its new quantity only if we&#x27;re moving items                                 </span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 633              OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                                  </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 634              orderItemRequestDTO.setOrderItemId(item.getId());                                                     </span>
<span class="2294188755442690225" onmouseenter="enter('2294188755442690225');" onmouseout="out('2294188755442690225');" style=""> 635              orderItemRequestDTO.setQuantity(item.getQuantity() - quantity);                                       </span>
<span class="4972493477102298628" onmouseenter="enter('4972493477102298628');" onmouseout="out('4972493477102298628');" style=""> 636              updateItemQuantity(namedOrder.getId(), orderItemRequestDTO, false);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637          }                                                                                                         </span>
<span class="-5293291189585447736" onmouseenter="enter('-5293291189585447736');" onmouseout="out('-5293291189585447736');" style=""> 638          return cartOrder;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639      }                                                                                                             </span>
<span  style=""> 640                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 641      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 642      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1212731706886603863" onmouseenter="enter('-1212731706886603863');" onmouseout="out('-1212731706886603863');" style=""><abbr title=" 643      public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder) throws PricingException {"> 643      public OrderItem addGiftWrapItemToOrder(Order order, GiftWrapOrderItemRequest itemRequest, boolean priceOrder)ðŸ”µ</abbr></span>
<span class="6582622510368580131" onmouseenter="enter('6582622510368580131');" onmouseout="out('6582622510368580131');" style=""> 644          GiftWrapOrderItem item = orderItemService.createGiftWrapOrderItem(itemRequest);                           </span>
<span class="-474933544378469288" onmouseenter="enter('-474933544378469288');" onmouseout="out('-474933544378469288');" style=""> 645          item.setOrder(order);                                                                                     </span>
<span class="-5871784861123565961" onmouseenter="enter('-5871784861123565961');" onmouseout="out('-5871784861123565961');" style=""> 646          item = (GiftWrapOrderItem) orderItemService.saveOrderItem(item);                                          </span>
<span  style=""> 647                                                                                                                    </span>
<span class="6197964192831249775" onmouseenter="enter('6197964192831249775');" onmouseout="out('6197964192831249775');" style=""> 648          order.getOrderItems().add(item);                                                                          </span>
<span class="3563147267220668588" onmouseenter="enter('3563147267220668588');" onmouseout="out('3563147267220668588');" style=""> 649          order = save(order, priceOrder);                                                                          </span>
<span  style=""> 650                                                                                                                    </span>
<span class="-3331987500944083076" onmouseenter="enter('-3331987500944083076');" onmouseout="out('-3331987500944083076');" style=""> 651          return item;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 652      }                                                                                                             </span>
<span  style=""> 653                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 654      @Override                                                                                                     </span>
<span class="684519713081169381" onmouseenter="enter('684519713081169381');" onmouseout="out('684519713081169381');" style=""> 655      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {AddToCartException.class})                      </span>
<span class="4069854779845915812" onmouseenter="enter('4069854779845915812');" onmouseout="out('4069854779845915812');" style=""><abbr title=" 656      public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 656      public Order addItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCaðŸ”µ</abbr></span>
<span class="-1143974214922837949" onmouseenter="enter('-1143974214922837949');" onmouseout="out('-1143974214922837949');" style=""> 657          // Don&#x27;t allow overrides from this method.                                                                </span>
<span class="8194194096343660389" onmouseenter="enter('8194194096343660389');" onmouseout="out('8194194096343660389');" style=""> 658          orderItemRequestDTO.setOverrideRetailPrice(null);                                                         </span>
<span class="-5206909193534990943" onmouseenter="enter('-5206909193534990943');" onmouseout="out('-5206909193534990943');" style=""> 659          orderItemRequestDTO.setOverrideSalePrice(null);                                                           </span>
<span class="-7735674882921518291" onmouseenter="enter('-7735674882921518291');" onmouseout="out('-7735674882921518291');" style=""> 660          return addItemWithPriceOverrides(orderId, orderItemRequestDTO, priceOrder);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661      }                                                                                                             </span>
<span  style=""> 662                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 663      @Override                                                                                                     </span>
<span class="-670805249178869687" onmouseenter="enter('-670805249178869687');" onmouseout="out('-670805249178869687');" style=""> 664      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { AddToCartException.class })                    </span>
<span class="2295594549845892145" onmouseenter="enter('2295594549845892145');" onmouseout="out('2295594549845892145');" style=""><abbr title=" 665      public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws AddToCartException {"> 665      public Order addItemWithPriceOverrides(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrdðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 666          Order order = findOrderById(orderId);                                                                     </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 667          preValidateCartOperation(order);                                                                          </span>
<span class="2914653273227801204" onmouseenter="enter('2914653273227801204');" onmouseout="out('2914653273227801204');" style=""> 668          if (getAutomaticallyMergeLikeItems()) {                                                                   </span>
<span class="-1260995424369374686" onmouseenter="enter('-1260995424369374686');" onmouseout="out('-1260995424369374686');" style=""> 669              OrderItem item = findMatchingItem(order, orderItemRequestDTO);                                        </span>
<span class="-4741837152748801640" onmouseenter="enter('-4741837152748801640');" onmouseout="out('-4741837152748801640');" style=""> 670              if (item != null &amp;&amp; item.getParentOrderItem() == null) {                                              </span>
<span class="8907881414365549792" onmouseenter="enter('8907881414365549792');" onmouseout="out('8907881414365549792');" style=""> 671                  orderItemRequestDTO.setQuantity(item.getQuantity() + orderItemRequestDTO.getQuantity());          </span>
<span class="960965161220645172" onmouseenter="enter('960965161220645172');" onmouseout="out('960965161220645172');" style=""> 672                  orderItemRequestDTO.setOrderItemId(item.getId());                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 673                  try {                                                                                             </span>
<span class="-1392380570648359537" onmouseenter="enter('-1392380570648359537');" onmouseout="out('-1392380570648359537');" style=""> 674                      return updateItemQuantity(orderId, orderItemRequestDTO, priceOrder);                          </span>
<span class="2264439919030346254" onmouseenter="enter('2264439919030346254');" onmouseout="out('2264439919030346254');" style=""> 675                  } catch (RemoveFromCartException e) {                                                             </span>
<span class="3695461348108676960" onmouseenter="enter('3695461348108676960');" onmouseout="out('3695461348108676960');" style=""><abbr title=" 676                      throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cart&quot;, e);"> 676                      throw new AddToCartException(&quot;Unexpected error - system tried to remove item while adding to cðŸ”µ</abbr></span>
<span class="-268181248887409465" onmouseenter="enter('-268181248887409465');" onmouseout="out('-268181248887409465');" style=""> 677                  } catch (UpdateCartException e) {                                                                 </span>
<span class="9009836242172298460" onmouseenter="enter('9009836242172298460');" onmouseout="out('9009836242172298460');" style=""> 678                      throw new AddToCartException(&quot;Could not update quantity for matched item&quot;, e);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 680              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681          }                                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 682          try {                                                                                                     </span>
<span class="5353648265182308095" onmouseenter="enter('5353648265182308095');" onmouseout="out('5353648265182308095');" style=""><abbr title=" 683              // We only want to price on the last addition for performance reasons and only if the user asked for it."> 683              // We only want to price on the last addition for performance reasons and only if the user asked for iðŸ”µ</abbr></span>
<span class="4429210190612929719" onmouseenter="enter('4429210190612929719');" onmouseout="out('4429210190612929719');" style=""> 684              int numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO)) : -1;           </span>
<span class="94226225238380310" onmouseenter="enter('94226225238380310');" onmouseout="out('94226225238380310');" style=""> 685              int currentAddition = 1;                                                                              </span>
<span  style=""> 686                                                                                                                    </span>
<span class="3086923041990690310" onmouseenter="enter('3086923041990690310');" onmouseout="out('3086923041990690310');" style=""><abbr title=" 687              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, currentAddition == numAdditionRequests);"> 687              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span  style=""> 688                                                                                                                    </span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 689              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 690              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 691              if (!autoFlushAddToCart) {                                                                            </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 692                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 692                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operatiðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 693                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 693                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the fðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 694                  //incorrect results because something has not been flushed to the database yet.                   </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 695                  session.setHibernateFlushMode(FlushMode.MANUAL);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696              }                                                                                                     </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 697              ProcessContext&lt;CartOperationRequest&gt; context;                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 698              try {                                                                                                 </span>
<span class="1764939006998328340" onmouseenter="enter('1764939006998328340');" onmouseout="out('1764939006998328340');" style=""> 699                  context = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(cartOpRequest);     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 700              } finally {                                                                                           </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 701                  if (!autoFlushAddToCart) {                                                                        </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 702                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704              }                                                                                                     </span>
<span  style=""> 705                                                                                                                    </span>
<span class="-507750410624174489" onmouseenter="enter('-507750410624174489');" onmouseout="out('-507750410624174489');" style=""> 706              List&lt;ActivityMessageDTO&gt; orderMessages = new ArrayList&lt;ActivityMessageDTO&gt;();                         </span>
<span class="-9090729846937660303" onmouseenter="enter('-9090729846937660303');" onmouseout="out('-9090729846937660303');" style=""> 707              orderMessages.addAll(((ActivityMessages) context).getActivityMessages());                             </span>
<span  style=""> 708                                                                                                                    </span>
<span class="7756277132938928975" onmouseenter="enter('7756277132938928975');" onmouseout="out('7756277132938928975');" style=""> 709              // Update the orderItemRequest incase it changed during the initial add to cart workflow              </span>
<span class="-7203895251723249067" onmouseenter="enter('-7203895251723249067');" onmouseout="out('-7203895251723249067');" style=""> 710              orderItemRequestDTO = context.getSeedData().getItemRequest();                                         </span>
<span class="4534199544912449864" onmouseenter="enter('4534199544912449864');" onmouseout="out('4534199544912449864');" style=""> 711              numAdditionRequests = priceOrder ? (getTotalChildOrderItems(orderItemRequestDTO) - 1) : -1;           </span>
<span class="4780820064776482606" onmouseenter="enter('4780820064776482606');" onmouseout="out('4780820064776482606');" style=""> 712              addChildItems(orderItemRequestDTO, numAdditionRequests, currentAddition, context, orderMessages);     </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-2935463552695848258" onmouseenter="enter('-2935463552695848258');" onmouseout="out('-2935463552695848258');" style=""> 714              context.getSeedData().getOrder().setOrderMessages(orderMessages);                                     </span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 715              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 716          } catch (WorkflowException e) {                                                                           </span>
<span class="-1335771490090575105" onmouseenter="enter('-1335771490090575105');" onmouseout="out('-1335771490090575105');" style=""> 717              throw new AddToCartException(&quot;Could not add to cart&quot;, getCartOperationExceptionRootCause(e));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 718          }                                                                                                         </span>
<span  style=""> 719                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 720      }                                                                                                             </span>
<span  style=""> 721                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 722      @Override                                                                                                     </span>
<span class="-3516024114449400059" onmouseenter="enter('-3516024114449400059');" onmouseout="out('-3516024114449400059');" style=""> 723      public int getTotalChildOrderItems(OrderItemRequestDTO orderItemRequestDTO) {                                 </span>
<span class="-4883106140571490694" onmouseenter="enter('-4883106140571490694');" onmouseout="out('-4883106140571490694');" style=""> 724          int count = 1;                                                                                            </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 725          for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {                       </span>
<span class="-8452259100874171936" onmouseenter="enter('-8452259100874171936');" onmouseout="out('-8452259100874171936');" style=""> 726              count += getTotalChildOrderItems(childRequest);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 727          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 728          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 729      }                                                                                                             </span>
<span  style=""> 730                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 731      @Override                                                                                                     </span>
<span class="6996885202551649754" onmouseenter="enter('6996885202551649754');" onmouseout="out('6996885202551649754');" style=""><abbr title=" 732      public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAddition, ProcessContext&lt;CartOperationRequest&gt; context, List&lt;ActivityMessageDTO&gt; orderMessages) throws WorkflowException {"> 732      public void addChildItems(OrderItemRequestDTO orderItemRequestDTO, int numAdditionRequests, int currentAdditioðŸ”µ</abbr></span>
<span class="8934449600530371968" onmouseenter="enter('8934449600530371968');" onmouseout="out('8934449600530371968');" style=""> 733          if (CollectionUtils.isNotEmpty(orderItemRequestDTO.getChildOrderItems())) {                               </span>
<span class="2491660913208132768" onmouseenter="enter('2491660913208132768');" onmouseout="out('2491660913208132768');" style=""> 734              Long parentOrderItemId = context.getSeedData().getOrderItem().getId();                                </span>
<span class="827363712591849808" onmouseenter="enter('827363712591849808');" onmouseout="out('827363712591849808');" style=""> 735              for (OrderItemRequestDTO childRequest : orderItemRequestDTO.getChildOrderItems()) {                   </span>
<span class="3535307469424733623" onmouseenter="enter('3535307469424733623');" onmouseout="out('3535307469424733623');" style=""> 736                  childRequest.setParentOrderItemId(parentOrderItemId);                                             </span>
<span class="-1408015228336766113" onmouseenter="enter('-1408015228336766113');" onmouseout="out('-1408015228336766113');" style=""> 737                  currentAddition++;                                                                                </span>
<span  style=""> 738                                                                                                                    </span>
<span class="-8953231422270651058" onmouseenter="enter('-8953231422270651058');" onmouseout="out('-8953231422270651058');" style=""> 739                  if (childRequest.getQuantity() &gt; 0) {                                                             </span>
<span class="1978205204114939470" onmouseenter="enter('1978205204114939470');" onmouseout="out('1978205204114939470');" style=""><abbr title=" 740                      CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrder(), childRequest, currentAddition == numAdditionRequests);"> 740                      CartOperationRequest childCartOpRequest = new CartOperationRequest(context.getSeedData().getOrðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 741                      Session session = em.unwrap(Session.class);                                                   </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 742                      FlushMode current = session.getHibernateFlushMode();                                          </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 743                      if (!autoFlushAddToCart) {                                                                    </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 744                          //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 744                          //Performance measure. Hibernate will sometimes perform an autoflush when performing queryðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 745                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 745                          //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 746                          //incorrect results because something has not been flushed to the database yet.           </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 747                          session.setHibernateFlushMode(FlushMode.MANUAL);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748                      }                                                                                             </span>
<span class="174091692271706246" onmouseenter="enter('174091692271706246');" onmouseout="out('174091692271706246');" style=""> 749                      ProcessContext&lt;CartOperationRequest&gt; childContext;                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 750                      try {                                                                                         </span>
<span class="3858921168069452982" onmouseenter="enter('3858921168069452982');" onmouseout="out('3858921168069452982');" style=""><abbr title=" 751                          childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCartOpRequest);"> 751                          childContext = (ProcessContext&lt;CartOperationRequest&gt;) addItemWorkflow.doActivities(childCaðŸ”µ</abbr></span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 752                      } finally {                                                                                   </span>
<span class="-5036642430060471843" onmouseenter="enter('-5036642430060471843');" onmouseout="out('-5036642430060471843');" style=""> 753                          if (!autoFlushAddToCart) {                                                                </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 754                              session.setHibernateFlushMode(current);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 755                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 756                      }                                                                                             </span>
<span class="4342049387377288099" onmouseenter="enter('4342049387377288099');" onmouseout="out('4342049387377288099');" style=""> 757                      orderMessages.addAll(((ActivityMessages) childContext).getActivityMessages());                </span>
<span  style=""> 758                                                                                                                    </span>
<span class="5649628204352445838" onmouseenter="enter('5649628204352445838');" onmouseout="out('5649628204352445838');" style=""><abbr title=" 759                      addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages);"> 759                      addChildItems(childRequest, numAdditionRequests, currentAddition, childContext, orderMessages)ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 760                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763      }                                                                                                             </span>
<span  style=""> 764                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 765      @Override                                                                                                     </span>
<span class="-7880503742615035959" onmouseenter="enter('-7880503742615035959');" onmouseout="out('-7880503742615035959');" style=""><abbr title=" 766      public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrderItem) {"> 766      public void addDependentOrderItem(OrderItemRequestDTO parentOrderItemRequest, OrderItemRequestDTO dependentOrdðŸ”µ</abbr></span>
<span class="7029662020876668277" onmouseenter="enter('7029662020876668277');" onmouseout="out('7029662020876668277');" style=""> 767          parentOrderItemRequest.getChildOrderItems().add(dependentOrderItem);                                      </span>
<span class="-5858860779658693712" onmouseenter="enter('-5858860779658693712');" onmouseout="out('-5858860779658693712');" style=""> 768          Collections.sort(parentOrderItemRequest.getChildOrderItems(), new Comparator&lt;OrderItemRequestDTO&gt;() {     </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 769              @Override                                                                                             </span>
<span class="-2632323703231374544" onmouseenter="enter('-2632323703231374544');" onmouseout="out('-2632323703231374544');" style=""> 770              public int compare(OrderItemRequestDTO o1, OrderItemRequestDTO o2) {                                  </span>
<span class="-7086966684703257080" onmouseenter="enter('-7086966684703257080');" onmouseout="out('-7086966684703257080');" style=""> 771                  BigDecimal o1DisplayOrder = new BigDecimal(o1.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));</span>
<span class="2876551709679172033" onmouseenter="enter('2876551709679172033');" onmouseout="out('2876551709679172033');" style=""> 772                  BigDecimal o2DisplayOrder = new BigDecimal(o2.getAdditionalAttributes().get(&quot;addOnDisplayOrder&quot;));</span>
<span class="-3284317440061231656" onmouseenter="enter('-3284317440061231656');" onmouseout="out('-3284317440061231656');" style=""> 773                  return o1DisplayOrder.compareTo(o2DisplayOrder);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 774              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 775          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776      }                                                                                                             </span>
<span  style=""> 777                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 778      @Override                                                                                                     </span>
<span class="-2531899947398484803" onmouseenter="enter('-2531899947398484803');" onmouseout="out('-2531899947398484803');" style=""><abbr title=" 779      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartException.class})"> 779      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {UpdateCartException.class, RemoveFromCartExceptiðŸ”µ</abbr></span>
<span class="5266336311751039225" onmouseenter="enter('5266336311751039225');" onmouseout="out('5266336311751039225');" style=""><abbr title=" 780      public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException, RemoveFromCartException {"> 780      public Order updateItemQuantity(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) thrðŸ”µ</abbr></span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 781          Order order = findOrderById(orderId);                                                                     </span>
<span class="-3622269712341645482" onmouseenter="enter('-3622269712341645482');" onmouseout="out('-3622269712341645482');" style=""> 782          preValidateCartOperation(order);                                                                          </span>
<span class="8786950828376343914" onmouseenter="enter('8786950828376343914');" onmouseout="out('8786950828376343914');" style=""> 783          preValidateUpdateQuantityOperation(findOrderById(orderId), orderItemRequestDTO);                          </span>
<span class="-2982195349177348585" onmouseenter="enter('-2982195349177348585');" onmouseout="out('-2982195349177348585');" style=""> 784          if (orderItemRequestDTO.getQuantity() == 0) {                                                             </span>
<span class="5934987267424355703" onmouseenter="enter('5934987267424355703');" onmouseout="out('5934987267424355703');" style=""> 785              return removeItem(orderId, orderItemRequestDTO.getOrderItemId(), priceOrder);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786          }                                                                                                         </span>
<span  style=""> 787                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 788          try {                                                                                                     </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 789              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 789              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 790              Session session = em.unwrap(Session.class);                                                           </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 791              FlushMode current = session.getHibernateFlushMode();                                                  </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 792              if (!autoFlushUpdateCart) {                                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 793                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 793                  //Performance measure. Hibernate will sometimes perform an autoflush when performing query operatiðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 794                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 794                  //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the fðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 795                  //incorrect results because something has not been flushed to the database yet.                   </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 796                  session.setHibernateFlushMode(FlushMode.MANUAL);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797              }                                                                                                     </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 798              ProcessContext&lt;CartOperationRequest&gt; context;                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 799              try {                                                                                                 </span>
<span class="4428072604906913766" onmouseenter="enter('4428072604906913766');" onmouseout="out('4428072604906913766');" style=""> 800                  context = (ProcessContext&lt;CartOperationRequest&gt;) updateItemWorkflow.doActivities(cartOpRequest);  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 801              } finally {                                                                                           </span>
<span class="4352600534627059277" onmouseenter="enter('4352600534627059277');" onmouseout="out('4352600534627059277');" style=""> 802                  if (!autoFlushUpdateCart) {                                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 803                      session.setHibernateFlushMode(current);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805              }                                                                                                     </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 806              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 806              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMesðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 807              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 808          } catch (WorkflowException e) {                                                                           </span>
<span class="-2443073899933101644" onmouseenter="enter('-2443073899933101644');" onmouseout="out('-2443073899933101644');" style=""><abbr title=" 809              throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e));"> 809              throw new UpdateCartException(&quot;Could not update cart quantity&quot;, getCartOperationExceptionRootCause(e))ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811      }                                                                                                             </span>
<span  style=""> 812                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 813      @Override                                                                                                     </span>
<span class="3069128547561385261" onmouseenter="enter('3069128547561385261');" onmouseout="out('3069128547561385261');" style=""> 814      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = {RemoveFromCartException.class})                 </span>
<span class="-981474137904562454" onmouseenter="enter('-981474137904562454');" onmouseout="out('-981474137904562454');" style=""> 815      public Order removeItem(Long orderId, Long orderItemId, boolean priceOrder) throws RemoveFromCartException {  </span>
<span class="2236102352074340212" onmouseenter="enter('2236102352074340212');" onmouseout="out('2236102352074340212');" style=""> 816          preValidateCartOperation(findOrderById(orderId));                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 817          try {                                                                                                     </span>
<span class="-4288344051642570030" onmouseenter="enter('-4288344051642570030');" onmouseout="out('-4288344051642570030');" style=""> 818              OrderItem oi = orderItemService.readOrderItemById(orderItemId);                                       </span>
<span class="-5187230272054076771" onmouseenter="enter('-5187230272054076771');" onmouseout="out('-5187230272054076771');" style=""> 819              if (oi == null) {                                                                                     </span>
<span class="3942058861960606340" onmouseenter="enter('3942058861960606340');" onmouseout="out('3942058861960606340');" style=""> 820                  throw new WorkflowException(new ItemNotFoundException());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821              }                                                                                                     </span>
<span class="3816340933425228129" onmouseenter="enter('3816340933425228129');" onmouseout="out('3816340933425228129');" style=""> 822              List&lt;Long&gt; childrenToRemove = new ArrayList&lt;Long&gt;();                                                  </span>
<span class="-1993098536099392813" onmouseenter="enter('-1993098536099392813');" onmouseout="out('-1993098536099392813');" style=""> 823              if (oi instanceof BundleOrderItem) {                                                                  </span>
<span class="7271984761308517823" onmouseenter="enter('7271984761308517823');" onmouseout="out('7271984761308517823');" style=""> 824                  List&lt;DiscreteOrderItem&gt; bundledItems = ((BundleOrderItem) oi).getDiscreteOrderItems();            </span>
<span class="7517044148543156187" onmouseenter="enter('7517044148543156187');" onmouseout="out('7517044148543156187');" style=""> 825                  for (DiscreteOrderItem doi : bundledItems) {                                                      </span>
<span class="7367293631145453975" onmouseenter="enter('7367293631145453975');" onmouseout="out('7367293631145453975');" style=""> 826                      findAllChildrenToRemove(childrenToRemove, doi);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 828              } else {                                                                                              </span>
<span class="872231159337938033" onmouseenter="enter('872231159337938033');" onmouseout="out('872231159337938033');" style=""> 829                  findAllChildrenToRemove(childrenToRemove, oi);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830              }                                                                                                     </span>
<span class="-8102792542621025713" onmouseenter="enter('-8102792542621025713');" onmouseout="out('-8102792542621025713');" style=""> 831              for (Long childToRemove : childrenToRemove) {                                                         </span>
<span class="8117841110711526180" onmouseenter="enter('8117841110711526180');" onmouseout="out('8117841110711526180');" style=""> 832                  removeItemInternal(orderId, childToRemove, false);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833              }                                                                                                     </span>
<span  style=""> 834                                                                                                                    </span>
<span class="-2688850311015489500" onmouseenter="enter('-2688850311015489500');" onmouseout="out('-2688850311015489500');" style=""> 835              return removeItemInternal(orderId, orderItemId, priceOrder);                                          </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 836          } catch (WorkflowException e) {                                                                           </span>
<span class="2503031575434857017" onmouseenter="enter('2503031575434857017');" onmouseout="out('2503031575434857017');" style=""><abbr title=" 837              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e));"> 837              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, getCartOperationExceptionRootCause(e))ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 838          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839      }                                                                                                             </span>
<span  style=""> 840                                                                                                                    </span>
<span class="-7053318232843416816" onmouseenter="enter('-7053318232843416816');" onmouseout="out('-7053318232843416816');" style=""> 841      protected void findAllChildrenToRemove(List&lt;Long&gt; childrenToRemove, OrderItem orderItem){                     </span>
<span class="-8605703698739650954" onmouseenter="enter('-8605703698739650954');" onmouseout="out('-8605703698739650954');" style=""> 842          if (CollectionUtils.isNotEmpty(orderItem.getChildOrderItems())) {                                         </span>
<span class="-4353610703709163867" onmouseenter="enter('-4353610703709163867');" onmouseout="out('-4353610703709163867');" style=""> 843              for (OrderItem childOrderItem : orderItem.getChildOrderItems()) {                                     </span>
<span class="-6344861684690798964" onmouseenter="enter('-6344861684690798964');" onmouseout="out('-6344861684690798964');" style=""> 844                  findAllChildrenToRemove(childrenToRemove, childOrderItem);                                        </span>
<span class="-4081734193801812324" onmouseenter="enter('-4081734193801812324');" onmouseout="out('-4081734193801812324');" style=""> 845                  childrenToRemove.add(childOrderItem.getId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 848      }                                                                                                             </span>
<span  style=""> 849                                                                                                                    </span>
<span class="-9213800711467029414" onmouseenter="enter('-9213800711467029414');" onmouseout="out('-9213800711467029414');" style=""><abbr title=" 850      protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowException {"> 850      protected Order removeItemInternal(Long orderId, Long orderItemId, boolean priceOrder) throws WorkflowExceptioðŸ”µ</abbr></span>
<span class="6669066091375973642" onmouseenter="enter('6669066091375973642');" onmouseout="out('6669066091375973642');" style=""> 851          OrderItemRequestDTO orderItemRequestDTO = new OrderItemRequestDTO();                                      </span>
<span class="279907255180715291" onmouseenter="enter('279907255180715291');" onmouseout="out('279907255180715291');" style=""> 852          orderItemRequestDTO.setOrderItemId(orderItemId);                                                          </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title=" 853          CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);"> 853          CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO,ðŸ”µ</abbr></span>
<span class="-7566406292282453993" onmouseenter="enter('-7566406292282453993');" onmouseout="out('-7566406292282453993');" style=""> 854          Session session = em.unwrap(Session.class);                                                               </span>
<span class="3814060679807464293" onmouseenter="enter('3814060679807464293');" onmouseout="out('3814060679807464293');" style=""> 855          FlushMode current = session.getHibernateFlushMode();                                                      </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 856          if (!autoFlushRemoveFromCart) {                                                                           </span>
<span class="74183495874762978" onmouseenter="enter('74183495874762978');" onmouseout="out('74183495874762978');" style=""><abbr title=" 857              //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations and this can"> 857              //Performance measure. Hibernate will sometimes perform an autoflush when performing query operations ðŸ”µ</abbr></span>
<span class="-5895073202807437946" onmouseenter="enter('-5895073202807437946');" onmouseout="out('-5895073202807437946');" style=""><abbr title=" 858              //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow returning"> 858              //be expensive. It is possible to avoid the autoflush if there&#x27;s no concern about queries in the flow ðŸ”µ</abbr></span>
<span class="8569249026183711173" onmouseenter="enter('8569249026183711173');" onmouseout="out('8569249026183711173');" style=""> 859              //incorrect results because something has not been flushed to the database yet.                       </span>
<span class="5642929065352278415" onmouseenter="enter('5642929065352278415');" onmouseout="out('5642929065352278415');" style=""> 860              session.setHibernateFlushMode(FlushMode.MANUAL);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861          }                                                                                                         </span>
<span class="-6096547514332542747" onmouseenter="enter('-6096547514332542747');" onmouseout="out('-6096547514332542747');" style=""> 862          ProcessContext&lt;CartOperationRequest&gt; context;                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 863          try {                                                                                                     </span>
<span class="1281982438499352462" onmouseenter="enter('1281982438499352462');" onmouseout="out('1281982438499352462');" style=""> 864              context = (ProcessContext&lt;CartOperationRequest&gt;) removeItemWorkflow.doActivities(cartOpRequest);      </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 865          } finally {                                                                                               </span>
<span class="101365695829415177" onmouseenter="enter('101365695829415177');" onmouseout="out('101365695829415177');" style=""> 866              if (!autoFlushRemoveFromCart) {                                                                       </span>
<span class="2156397092217642783" onmouseenter="enter('2156397092217642783');" onmouseout="out('2156397092217642783');" style=""> 867                  session.setHibernateFlushMode(current);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 868              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869          }                                                                                                         </span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title=" 870          context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());"> 870          context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessageðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style=""> 871          return context.getSeedData().getOrder();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872      }                                                                                                             </span>
<span  style=""> 873                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 874      @Override                                                                                                     </span>
<span class="4101768281683729634" onmouseenter="enter('4101768281683729634');" onmouseout="out('4101768281683729634');" style=""> 875      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { RemoveFromCartException.class })               </span>
<span class="-3452873837479924235" onmouseenter="enter('-3452873837479924235');" onmouseout="out('-3452873837479924235');" style=""> 876      public Order removeInactiveItems(Long orderId, boolean priceOrder) throws RemoveFromCartException {           </span>
<span class="4031476081722729439" onmouseenter="enter('4031476081722729439');" onmouseout="out('4031476081722729439');" style=""> 877          Order order = findOrderById(orderId);                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 878          try {                                                                                                     </span>
<span  style=""> 879                                                                                                                    </span>
<span class="-3956255490326849696" onmouseenter="enter('-3956255490326849696');" onmouseout="out('-3956255490326849696');" style=""> 880              for (OrderItem currentItem : new ArrayList&lt;OrderItem&gt;(order.getOrderItems())) {                       </span>
<span class="-219225588148279740" onmouseenter="enter('-219225588148279740');" onmouseout="out('-219225588148279740');" style=""> 881                  if (!currentItem.isSkuActive()) {                                                                 </span>
<span class="-2073025095864158325" onmouseenter="enter('-2073025095864158325');" onmouseout="out('-2073025095864158325');" style=""> 882                      removeItem(orderId, currentItem.getId(), priceOrder);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884              }                                                                                                     </span>
<span  style=""> 885                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 886          } catch (Exception e) {                                                                                   </span>
<span class="9087614266041334113" onmouseenter="enter('9087614266041334113');" onmouseout="out('9087614266041334113');" style=""> 887              throw new RemoveFromCartException(&quot;Could not remove from cart&quot;, e.getCause());                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888          }                                                                                                         </span>
<span class="6784501458837890045" onmouseenter="enter('6784501458837890045');" onmouseout="out('6784501458837890045');" style=""> 889          return findOrderById(orderId);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 890      }                                                                                                             </span>
<span  style=""> 891                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 892      @Override                                                                                                     </span>
<span class="-2286265725818600106" onmouseenter="enter('-2286265725818600106');" onmouseout="out('-2286265725818600106');" style=""> 893      public boolean getAutomaticallyMergeLikeItems() {                                                             </span>
<span  style=""> 894                                                                                                                    </span>
<span class="-8256644627815125391" onmouseenter="enter('-8256644627815125391');" onmouseout="out('-8256644627815125391');" style=""> 895          if (automaticallyMergeLikeItems != null) {                                                                </span>
<span class="2771319092236636517" onmouseenter="enter('2771319092236636517');" onmouseout="out('2771319092236636517');" style=""> 896              return automaticallyMergeLikeItems;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897          }                                                                                                         </span>
<span  style=""> 898                                                                                                                    </span>
<span class="-661470022029899741" onmouseenter="enter('-661470022029899741');" onmouseout="out('-661470022029899741');" style=""> 899          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;automatically.merge.like.items&quot;, true);            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900      }                                                                                                             </span>
<span  style=""> 901                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 902      @Override                                                                                                     </span>
<span class="8909461220693294113" onmouseenter="enter('8909461220693294113');" onmouseout="out('8909461220693294113');" style=""> 903      public void setAutomaticallyMergeLikeItems(boolean automaticallyMergeLikeItems) {                             </span>
<span class="5376880332914447533" onmouseenter="enter('5376880332914447533');" onmouseout="out('5376880332914447533');" style=""> 904          this.automaticallyMergeLikeItems = automaticallyMergeLikeItems;                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905      }                                                                                                             </span>
<span  style=""> 906                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 907      @Override                                                                                                     </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 908      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 908      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeðŸ”µ</abbr></span>
<span class="3855774874983732975" onmouseenter="enter('3855774874983732975');" onmouseout="out('3855774874983732975');" style=""> 909      public boolean isMoveNamedOrderItems() {                                                                      </span>
<span class="-6652636869592443054" onmouseenter="enter('-6652636869592443054');" onmouseout="out('-6652636869592443054');" style=""> 910          return moveNamedOrderItems;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911      }                                                                                                             </span>
<span  style=""> 912                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 913      @Override                                                                                                     </span>
<span class="-2739038284834053497" onmouseenter="enter('-2739038284834053497');" onmouseout="out('-2739038284834053497');" style=""><abbr title=" 914      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeLimit=15)"> 914      @ManagedAttribute(description=&quot;The move item from named order when adding to the cart attribute&quot;, currencyTimeðŸ”µ</abbr></span>
<span class="-1545993285048257021" onmouseenter="enter('-1545993285048257021');" onmouseout="out('-1545993285048257021');" style=""> 915      public void setMoveNamedOrderItems(boolean moveNamedOrderItems) {                                             </span>
<span class="-5896321919466635220" onmouseenter="enter('-5896321919466635220');" onmouseout="out('-5896321919466635220');" style=""> 916          this.moveNamedOrderItems = moveNamedOrderItems;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917      }                                                                                                             </span>
<span  style=""> 918                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 919      @Override                                                                                                     </span>
<span class="-8017861565242530615" onmouseenter="enter('-8017861565242530615');" onmouseout="out('-8017861565242530615');" style=""><abbr title=" 920      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimeLimit=15)"> 920      @ManagedAttribute(description=&quot;The delete empty named order after adding items to cart attribute&quot;, currencyTimðŸ”µ</abbr></span>
<span class="-1003289588467041676" onmouseenter="enter('-1003289588467041676');" onmouseout="out('-1003289588467041676');" style=""> 921      public boolean isDeleteEmptyNamedOrders() {                                                                   </span>
<span class="-7878461261897242645" onmouseenter="enter('-7878461261897242645');" onmouseout="out('-7878461261897242645');" style=""> 922          return deleteEmptyNamedOrders;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923      }                                                                                                             </span>
<span  style=""> 924                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 925      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 926      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-137537618393378808" onmouseenter="enter('-137537618393378808');" onmouseout="out('-137537618393378808');" style=""> 927      public void removeAllPaymentsFromOrder(Order order) {                                                         </span>
<span class="3869583275658522189" onmouseenter="enter('3869583275658522189');" onmouseout="out('3869583275658522189');" style=""> 928          removePaymentsFromOrder(order, null);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 929      }                                                                                                             </span>
<span  style=""> 930                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 931      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 932      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-1085850343810485193" onmouseenter="enter('-1085850343810485193');" onmouseout="out('-1085850343810485193');" style=""> 933      public void removePaymentsFromOrder(Order order, PaymentType paymentInfoType) {                               </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 934          List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                                 </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 935          for (OrderPayment paymentInfo : order.getPayments()) {                                                    </span>
<span class="-6057897724905909333" onmouseenter="enter('-6057897724905909333');" onmouseout="out('-6057897724905909333');" style=""> 936              if (paymentInfoType == null || paymentInfoType.equals(paymentInfo.getType())) {                       </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 937                  infos.add(paymentInfo);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 938              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939          }                                                                                                         </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 940          order.getPayments().removeAll(infos);                                                                     </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 941          for (OrderPayment paymentInfo : infos) {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 942              try {                                                                                                 </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 943                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 943                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentIðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 944              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 945                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 946                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947              }                                                                                                     </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 948              order.getPayments().remove(paymentInfo);                                                              </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 949              paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                                        </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 950              paymentDao.delete(paymentInfo);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 951          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 952      }                                                                                                             </span>
<span  style=""> 953                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 954      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 955      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-609061517129084855" onmouseenter="enter('-609061517129084855');" onmouseout="out('-609061517129084855');" style=""> 956      public void removeCreditCardPaymentsFromOrder(Order order) {                                                  </span>
<span class="-3971925944905394172" onmouseenter="enter('-3971925944905394172');" onmouseout="out('-3971925944905394172');" style=""> 957          List&lt;OrderPayment&gt; infos = new ArrayList&lt;OrderPayment&gt;();                                                 </span>
<span class="-6590574901129937123" onmouseenter="enter('-6590574901129937123');" onmouseout="out('-6590574901129937123');" style=""> 958          for (OrderPayment paymentInfo : order.getPayments()) {                                                    </span>
<span class="-8966393542166440080" onmouseenter="enter('-8966393542166440080');" onmouseout="out('-8966393542166440080');" style=""> 959              if (paymentInfo.getType().isCreditCardType()) {                                                       </span>
<span class="4933203212577199356" onmouseenter="enter('4933203212577199356');" onmouseout="out('4933203212577199356');" style=""> 960                  infos.add(paymentInfo);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962          }                                                                                                         </span>
<span class="6690857544228101144" onmouseenter="enter('6690857544228101144');" onmouseout="out('6690857544228101144');" style=""> 963          order.getPayments().removeAll(infos);                                                                     </span>
<span class="-6267696511348246892" onmouseenter="enter('-6267696511348246892');" onmouseout="out('-6267696511348246892');" style=""> 964          for (OrderPayment paymentInfo : infos) {                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 965              try {                                                                                                 </span>
<span class="6006147570248015378" onmouseenter="enter('6006147570248015378');" onmouseout="out('6006147570248015378');" style=""><abbr title=" 966                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentInfo.getType());"> 966                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentInfo.getReferenceNumber(), paymentIðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 967              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 968                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 969                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 970              }                                                                                                     </span>
<span class="-5344304312032595722" onmouseenter="enter('-5344304312032595722');" onmouseout="out('-5344304312032595722');" style=""> 971              order.getPayments().remove(paymentInfo);                                                              </span>
<span class="-4724168949564473027" onmouseenter="enter('-4724168949564473027');" onmouseout="out('-4724168949564473027');" style=""> 972              paymentInfo = paymentDao.readPaymentById(paymentInfo.getId());                                        </span>
<span class="-8141548574584166661" onmouseenter="enter('-8141548574584166661');" onmouseout="out('-8141548574584166661');" style=""> 973              paymentDao.delete(paymentInfo);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 974          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975      }                                                                                                             </span>
<span  style=""> 976                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 977      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style=""> 978      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="5110157232144308056" onmouseenter="enter('5110157232144308056');" onmouseout="out('5110157232144308056');" style=""> 979      public void removePaymentFromOrder(Order order, OrderPayment payment){                                        </span>
<span class="-7148196279117480431" onmouseenter="enter('-7148196279117480431');" onmouseout="out('-7148196279117480431');" style=""> 980          OrderPayment paymentToRemove = null;                                                                      </span>
<span class="-5892743526096946795" onmouseenter="enter('-5892743526096946795');" onmouseout="out('-5892743526096946795');" style=""> 981          for (OrderPayment info : order.getPayments()){                                                            </span>
<span class="-230615801168440856" onmouseenter="enter('-230615801168440856');" onmouseout="out('-230615801168440856');" style=""> 982              if (info.equals(payment)){                                                                            </span>
<span class="2491921736483213892" onmouseenter="enter('2491921736483213892');" onmouseout="out('2491921736483213892');" style=""> 983                  paymentToRemove = info;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985          }                                                                                                         </span>
<span class="-1581714824919605857" onmouseenter="enter('-1581714824919605857');" onmouseout="out('-1581714824919605857');" style=""> 986          if (paymentToRemove != null){                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 987              try {                                                                                                 </span>
<span class="1303373247725909249" onmouseenter="enter('1303373247725909249');" onmouseout="out('1303373247725909249');" style=""><abbr title=" 988                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), payment.getType());"> 988                  securePaymentInfoService.findAndRemoveSecurePaymentInfo(paymentToRemove.getReferenceNumber(), paymðŸ”µ</abbr></span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 989              } catch (WorkflowException e) {                                                                       </span>
<span class="1391989410717897225" onmouseenter="enter('1391989410717897225');" onmouseout="out('1391989410717897225');" style=""> 990                  // do nothing--this is an acceptable condition                                                    </span>
<span class="-6225989068828834912" onmouseenter="enter('-6225989068828834912');" onmouseout="out('-6225989068828834912');" style=""> 991                  LOG.debug(&quot;No secure payment is associated with the OrderPayment&quot;, e);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 992              }                                                                                                     </span>
<span class="5021028513790341802" onmouseenter="enter('5021028513790341802');" onmouseout="out('5021028513790341802');" style=""> 993              order.getPayments().remove(paymentToRemove);                                                          </span>
<span class="-7249333565068001633" onmouseenter="enter('-7249333565068001633');" onmouseout="out('-7249333565068001633');" style=""> 994              payment = paymentDao.readPaymentById(paymentToRemove.getId());                                        </span>
<span class="-5369248081625730935" onmouseenter="enter('-5369248081625730935');" onmouseout="out('-5369248081625730935');" style=""> 995              paymentDao.delete(payment);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 996          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 997      }                                                                                                             </span>
<span  style=""> 998                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 999      /**                                                                                                           </span>
<span class="6936875034092858122" onmouseenter="enter('6936875034092858122');" onmouseout="out('6936875034092858122');" style="">1000       * This method will return the exception that is immediately below the deepest                                </span>
<span class="8325554843978875883" onmouseenter="enter('8325554843978875883');" onmouseout="out('8325554843978875883');" style="">1001       * WorkflowException in the current stack trace.                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">1002       *                                                                                                            </span>
<span class="914602110034133584" onmouseenter="enter('914602110034133584');" onmouseout="out('914602110034133584');" style="">1003       * @param e the workflow exception that contains the requested root cause                                     </span>
<span class="-825884884099351167" onmouseenter="enter('-825884884099351167');" onmouseout="out('-825884884099351167');" style="">1004       * @return the root cause of the workflow exception                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1005       */                                                                                                           </span>
<span class="-6688244297454300494" onmouseenter="enter('-6688244297454300494');" onmouseout="out('-6688244297454300494');" style="">1006      protected Throwable getCartOperationExceptionRootCause(WorkflowException e) {                                 </span>
<span class="-6915919722100840508" onmouseenter="enter('-6915919722100840508');" onmouseout="out('-6915919722100840508');" style="">1007          Throwable cause = e.getCause();                                                                           </span>
<span class="1206512241003466432" onmouseenter="enter('1206512241003466432');" onmouseout="out('1206512241003466432');" style="">1008          if (cause == null) {                                                                                      </span>
<span class="2254950224932520865" onmouseenter="enter('2254950224932520865');" onmouseout="out('2254950224932520865');" style="">1009              return e;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1010          }                                                                                                         </span>
<span  style="">1011                                                                                                                    </span>
<span class="2363873739200211359" onmouseenter="enter('2363873739200211359');" onmouseout="out('2363873739200211359');" style="">1012          Throwable currentCause = cause;                                                                           </span>
<span class="-3242506506853415284" onmouseenter="enter('-3242506506853415284');" onmouseout="out('-3242506506853415284');" style="">1013          while (currentCause.getCause() != null) {                                                                 </span>
<span class="6579708771118863579" onmouseenter="enter('6579708771118863579');" onmouseout="out('6579708771118863579');" style="">1014              currentCause = currentCause.getCause();                                                               </span>
<span class="8991829102747430232" onmouseenter="enter('8991829102747430232');" onmouseout="out('8991829102747430232');" style="">1015              if (currentCause instanceof WorkflowException) {                                                      </span>
<span class="-8175986703099391257" onmouseenter="enter('-8175986703099391257');" onmouseout="out('-8175986703099391257');" style="">1016                  cause = currentCause.getCause();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1018          }                                                                                                         </span>
<span  style="">1019                                                                                                                    </span>
<span class="-8291476910521993484" onmouseenter="enter('-8291476910521993484');" onmouseout="out('-8291476910521993484');" style="">1020          return cause;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1021      }                                                                                                             </span>
<span  style="">1022                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">1023      /**                                                                                                           </span>
<span class="-4869107995961353955" onmouseenter="enter('-4869107995961353955');" onmouseout="out('-4869107995961353955');" style="">1024       * Returns true if the two items attributes exactly match.                                                    </span>
<span class="-7080712594711412450" onmouseenter="enter('-7080712594711412450');" onmouseout="out('-7080712594711412450');" style="">1025       * @param item1Attributes                                                                                     </span>
<span class="-6439056940940666101" onmouseenter="enter('-6439056940940666101');" onmouseout="out('-6439056940940666101');" style="">1026       * @param item2                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">1027       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">1028       */                                                                                                           </span>
<span class="6199969656370324246" onmouseenter="enter('6199969656370324246');" onmouseout="out('6199969656370324246');" style=""><abbr title="1029      protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2) {">1029      protected boolean compareAttributes(Map&lt;String, OrderItemAttribute&gt; item1Attributes, OrderItemRequestDTO item2ðŸ”µ</abbr></span>
<span class="-4121399301000725365" onmouseenter="enter('-4121399301000725365');" onmouseout="out('-4121399301000725365');" style="">1030          int item1AttributeSize = item1Attributes == null ? 0 : item1Attributes.size();                            </span>
<span class="-4841456796483769583" onmouseenter="enter('-4841456796483769583');" onmouseout="out('-4841456796483769583');" style="">1031          int item2AttributeSize = item2.getItemAttributes() == null ? 0 : item2.getItemAttributes().size();        </span>
<span  style="">1032                                                                                                                    </span>
<span class="-6976046912644474969" onmouseenter="enter('-6976046912644474969');" onmouseout="out('-6976046912644474969');" style="">1033          if (item1AttributeSize != item2AttributeSize) {                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1034              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035          }                                                                                                         </span>
<span  style="">1036                                                                                                                    </span>
<span class="8660828604942896283" onmouseenter="enter('8660828604942896283');" onmouseout="out('8660828604942896283');" style="">1037          for (String key : item2.getItemAttributes().keySet()) {                                                   </span>
<span class="-7527106708479866057" onmouseenter="enter('-7527106708479866057');" onmouseout="out('-7527106708479866057');" style="">1038              String itemOneValue = (item1Attributes.get(key) == null) ? null : item1Attributes.get(key).getValue();</span>
<span class="-8945816914747285664" onmouseenter="enter('-8945816914747285664');" onmouseout="out('-8945816914747285664');" style="">1039              String itemTwoValue = item2.getItemAttributes().get(key);                                             </span>
<span class="2348135482578686472" onmouseenter="enter('2348135482578686472');" onmouseout="out('2348135482578686472');" style="">1040              if (!itemTwoValue.equals(itemOneValue)) {                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1041                  return false;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1042              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1043          }                                                                                                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1044          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1045      }                                                                                                             </span>
<span  style="">1046                                                                                                                    </span>
<span class="-4141718569550096543" onmouseenter="enter('-4141718569550096543');" onmouseout="out('-4141718569550096543');" style=""><abbr title="1047      protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1Attributes,">1047      protected boolean itemMatches(Sku item1Sku, Product item1Product, Map&lt;String, OrderItemAttribute&gt; item1AttribuðŸ”µ</abbr></span>
<span class="-3703517832068399666" onmouseenter="enter('-3703517832068399666');" onmouseout="out('-3703517832068399666');" style="">1048              OrderItemRequestDTO item2) {                                                                          </span>
<span class="-4525614051490920688" onmouseenter="enter('-4525614051490920688');" onmouseout="out('-4525614051490920688');" style="">1049          // Must match on SKU and options                                                                          </span>
<span class="4681926242181597732" onmouseenter="enter('4681926242181597732');" onmouseout="out('4681926242181597732');" style="">1050          if (item1Sku != null &amp;&amp; item2.getSkuId() != null) {                                                       </span>
<span class="4828879456607690268" onmouseenter="enter('4828879456607690268');" onmouseout="out('4828879456607690268');" style="">1051              if (item1Sku.getId().equals(item2.getSkuId())) {                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">1052                  return true;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">1054          } else {                                                                                                  </span>
<span class="-3562715489663556008" onmouseenter="enter('-3562715489663556008');" onmouseout="out('-3562715489663556008');" style="">1055              if (item1Product != null &amp;&amp; item2.getProductId() != null) {                                           </span>
<span class="-6090611743723364470" onmouseenter="enter('-6090611743723364470');" onmouseout="out('-6090611743723364470');" style="">1056                  if (item1Product.getId().equals(item2.getProductId())) {                                          </span>
<span class="-3558352998309083894" onmouseenter="enter('-3558352998309083894');" onmouseout="out('-3558352998309083894');" style="">1057                      return compareAttributes(item1Attributes, item2);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1058                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1059              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1060          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="">1061          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1062      }                                                                                                             </span>
<span  style="">1063                                                                                                                    </span>
<span class="-7114483559120409995" onmouseenter="enter('-7114483559120409995');" onmouseout="out('-7114483559120409995');" style="">1064      protected OrderItem findMatchingItem(Order order, OrderItemRequestDTO itemToFind) {                           </span>
<span class="-5687874155783563532" onmouseenter="enter('-5687874155783563532');" onmouseout="out('-5687874155783563532');" style="">1065          if (order == null) {                                                                                      </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1066              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1067          }                                                                                                         </span>
<span class="4435196443097834597" onmouseenter="enter('4435196443097834597');" onmouseout="out('4435196443097834597');" style="">1068          for (OrderItem currentItem : order.getOrderItems()) {                                                     </span>
<span class="7409273867886691712" onmouseenter="enter('7409273867886691712');" onmouseout="out('7409273867886691712');" style="">1069              if (currentItem instanceof DiscreteOrderItem) {                                                       </span>
<span class="-3348377052985074331" onmouseenter="enter('-3348377052985074331');" onmouseout="out('-3348377052985074331');" style="">1070                  DiscreteOrderItem discreteItem = (DiscreteOrderItem) currentItem;                                 </span>
<span class="-4911141910965303230" onmouseenter="enter('-4911141910965303230');" onmouseout="out('-4911141910965303230');" style=""><abbr title="1071                  if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttributes(),">1071                  if (itemMatches(discreteItem.getSku(), discreteItem.getProduct(), discreteItem.getOrderItemAttribuðŸ”µ</abbr></span>
<span class="-1179319244482714398" onmouseenter="enter('-1179319244482714398');" onmouseout="out('-1179319244482714398');" style="">1072                          itemToFind)) {                                                                            </span>
<span class="-8051031831344945202" onmouseenter="enter('-8051031831344945202');" onmouseout="out('-8051031831344945202');" style="">1073                      return discreteItem;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1074                  }                                                                                                 </span>
<span class="-7672249992752475284" onmouseenter="enter('-7672249992752475284');" onmouseout="out('-7672249992752475284');" style="">1075              } else if (currentItem instanceof BundleOrderItem) {                                                  </span>
<span class="2492746005491881221" onmouseenter="enter('2492746005491881221');" onmouseout="out('2492746005491881221');" style="">1076                  BundleOrderItem bundleItem = (BundleOrderItem) currentItem;                                       </span>
<span class="-7934111527767872247" onmouseenter="enter('-7934111527767872247');" onmouseout="out('-7934111527767872247');" style="">1077                  if (itemMatches(bundleItem.getSku(), bundleItem.getProduct(), null, itemToFind)) {                </span>
<span class="-4265040120930303576" onmouseenter="enter('-4265040120930303576');" onmouseout="out('-4265040120930303576');" style="">1078                      return bundleItem;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1079                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1080              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1081          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1082          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1083      }                                                                                                             </span>
<span  style="">1084                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1085      @Override                                                                                                     </span>
<span class="-5844561583982380564" onmouseenter="enter('-5844561583982380564');" onmouseout="out('-5844561583982380564');" style="">1086      @Transactional(value = &quot;blTransactionManager&quot;, rollbackFor = { UpdateCartException.class })                   </span>
<span class="586625526125468318" onmouseenter="enter('586625526125468318');" onmouseout="out('586625526125468318');" style=""><abbr title="1087      public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOrder) throws UpdateCartException {">1087      public Order updateProductOptionsForItem(Long orderId, OrderItemRequestDTO orderItemRequestDTO, boolean priceOðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">1088          try {                                                                                                     </span>
<span class="6761578202380617805" onmouseenter="enter('6761578202380617805');" onmouseout="out('6761578202380617805');" style=""><abbr title="1089              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestDTO, priceOrder);">1089              CartOperationRequest cartOpRequest = new CartOperationRequest(findOrderById(orderId), orderItemRequestðŸ”µ</abbr></span>
<span class="-8587304739270495732" onmouseenter="enter('-8587304739270495732');" onmouseout="out('-8587304739270495732');" style=""><abbr title="1090              ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptionsForItemWorkflow.doActivities(cartOpRequest);">1090              ProcessContext&lt;CartOperationRequest&gt; context = (ProcessContext&lt;CartOperationRequest&gt;) updateProductOptðŸ”µ</abbr></span>
<span class="2088636785271250595" onmouseenter="enter('2088636785271250595');" onmouseout="out('2088636785271250595');" style=""><abbr title="1091              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());">1091              context.getSeedData().getOrder().getOrderMessages().addAll(((ActivityMessages) context).getActivityMesðŸ”µ</abbr></span>
<span class="823736066576759373" onmouseenter="enter('823736066576759373');" onmouseout="out('823736066576759373');" style="">1092              return context.getSeedData().getOrder();                                                              </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">1093          } catch (WorkflowException e) {                                                                           </span>
<span class="1106241423190966760" onmouseenter="enter('1106241423190966760');" onmouseout="out('1106241423190966760');" style="">1094              throw new UpdateCartException(&quot;Could not product options&quot;, getCartOperationExceptionRootCause(e));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1095          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1096      }                                                                                                             </span>
<span  style="">1097                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1098      @Override                                                                                                     </span>
<span class="1062217594650773028" onmouseenter="enter('1062217594650773028');" onmouseout="out('1062217594650773028');" style="">1099      public Order reloadOrder(Order order) {                                                                       </span>
<span class="-4055446979990348221" onmouseenter="enter('-4055446979990348221');" onmouseout="out('-4055446979990348221');" style="">1100          if (order == null || order instanceof NullOrderImpl || order.getId() == null) {                           </span>
<span class="-5747246288187903060" onmouseenter="enter('-5747246288187903060');" onmouseout="out('-5747246288187903060');" style="">1101              return order;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1102          }                                                                                                         </span>
<span  style="">1103                                                                                                                    </span>
<span class="4601321525892022542" onmouseenter="enter('4601321525892022542');" onmouseout="out('4601321525892022542');" style="">1104          return orderDao.readOrderById(order.getId(), true);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1105      }                                                                                                             </span>
<span  style="">1106                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1107      @Override                                                                                                     </span>
<span class="5049387329381023556" onmouseenter="enter('5049387329381023556');" onmouseout="out('5049387329381023556');" style="">1108      @Transactional(&quot;blTransactionManager&quot;)                                                                        </span>
<span class="-7012224974908680421" onmouseenter="enter('-7012224974908680421');" onmouseout="out('-7012224974908680421');" style="">1109      public boolean acquireLock(Order order) {                                                                     </span>
<span class="1335946416444527614" onmouseenter="enter('1335946416444527614');" onmouseout="out('1335946416444527614');" style="">1110          return orderDao.acquireLock(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1111      }                                                                                                             </span>
<span  style="">1112                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1113      @Override                                                                                                     </span>
<span class="3603110228114188705" onmouseenter="enter('3603110228114188705');" onmouseout="out('3603110228114188705');" style="">1114      public boolean releaseLock(Order order) {                                                                     </span>
<span class="1014135102090455120" onmouseenter="enter('1014135102090455120');" onmouseout="out('1014135102090455120');" style="">1115          return orderDao.releaseLock(order);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1116      }                                                                                                             </span>
<span  style="">1117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1118      @Override                                                                                                     </span>
<span class="-3640157100751954071" onmouseenter="enter('-3640157100751954071');" onmouseout="out('-3640157100751954071');" style="">1119      public void printOrder(Order order, Log log) {                                                                </span>
<span class="-3796071981400661878" onmouseenter="enter('-3796071981400661878');" onmouseout="out('-3796071981400661878');" style="">1120          if (!log.isDebugEnabled()) {                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">1121              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1122          }                                                                                                         </span>
<span  style="">1123                                                                                                                    </span>
<span class="3667140805233255262" onmouseenter="enter('3667140805233255262');" onmouseout="out('3667140805233255262');" style="">1124          TableCreator tc = new TableCreator(new TableCreator.Col[] {                                               </span>
<span class="7681839206706458847" onmouseenter="enter('7681839206706458847');" onmouseout="out('7681839206706458847');" style="">1125              new TableCreator.Col(&quot;Order Item&quot;, 30),                                                               </span>
<span class="2598617298230317857" onmouseenter="enter('2598617298230317857');" onmouseout="out('2598617298230317857');" style="">1126              new TableCreator.Col(&quot;Qty&quot;),                                                                          </span>
<span class="-7694790865023700533" onmouseenter="enter('-7694790865023700533');" onmouseout="out('-7694790865023700533');" style="">1127              new TableCreator.Col(&quot;Unit Price&quot;),                                                                   </span>
<span class="-4029215824508924196" onmouseenter="enter('-4029215824508924196');" onmouseout="out('-4029215824508924196');" style="">1128              new TableCreator.Col(&quot;Avg Adj&quot;),                                                                      </span>
<span class="2280319324156256259" onmouseenter="enter('2280319324156256259');" onmouseout="out('2280319324156256259');" style="">1129              new TableCreator.Col(&quot;Total Adj&quot;),                                                                    </span>
<span class="803984851040328531" onmouseenter="enter('803984851040328531');" onmouseout="out('803984851040328531');" style="">1130              new TableCreator.Col(&quot;Total Price&quot;)                                                                   </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1131          });                                                                                                       </span>
<span  style="">1132                                                                                                                    </span>
<span class="8447029191885982498" onmouseenter="enter('8447029191885982498');" onmouseout="out('8447029191885982498');" style="">1133          for (OrderItem oi : order.getOrderItems()) {                                                              </span>
<span class="7794599779896353168" onmouseenter="enter('7794599779896353168');" onmouseout="out('7794599779896353168');" style="">1134              tc.addRow(new String[] {                                                                              </span>
<span class="-6517557825202851987" onmouseenter="enter('-6517557825202851987');" onmouseout="out('-6517557825202851987');" style="">1135                  oi.getName(),                                                                                     </span>
<span class="-5588620079629414973" onmouseenter="enter('-5588620079629414973');" onmouseout="out('-5588620079629414973');" style="">1136                  String.valueOf(oi.getQuantity()),                                                                 </span>
<span class="8023041970437622541" onmouseenter="enter('8023041970437622541');" onmouseout="out('8023041970437622541');" style="">1137                  String.valueOf(oi.getPriceBeforeAdjustments(true)),                                               </span>
<span class="4981794139639039914" onmouseenter="enter('4981794139639039914');" onmouseout="out('4981794139639039914');" style="">1138                  String.valueOf(oi.getAverageAdjustmentValue()),                                                   </span>
<span class="-7621609530264461687" onmouseenter="enter('-7621609530264461687');" onmouseout="out('-7621609530264461687');" style="">1139                  String.valueOf(oi.getTotalAdjustmentValue()),                                                     </span>
<span class="610268575597889106" onmouseenter="enter('610268575597889106');" onmouseout="out('610268575597889106');" style="">1140                  String.valueOf(oi.getTotalPrice())                                                                </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">1141              });                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1142          }                                                                                                         </span>
<span  style="">1143                                                                                                                    </span>
<span class="-3387660244080770577" onmouseenter="enter('-3387660244080770577');" onmouseout="out('-3387660244080770577');" style="">1144          tc.addSeparator()                                                                                         </span>
<span class="-4962129920853993876" onmouseenter="enter('-4962129920853993876');" onmouseout="out('-4962129920853993876');" style="">1145              .withGlobalRowHeaderWidth(15)                                                                         </span>
<span class="8977950677164210482" onmouseenter="enter('8977950677164210482');" onmouseout="out('8977950677164210482');" style="">1146              .addRow(&quot;Subtotal&quot;, order.getSubTotal())                                                              </span>
<span class="9039771477815737150" onmouseenter="enter('9039771477815737150');" onmouseout="out('9039771477815737150');" style="">1147              .addRow(&quot;Order Adj.&quot;, order.getOrderAdjustmentsValue())                                               </span>
<span class="-3982350454387940822" onmouseenter="enter('-3982350454387940822');" onmouseout="out('-3982350454387940822');" style="">1148              .addRow(&quot;Tax&quot;, order.getTotalTax())                                                                   </span>
<span class="-1569816593472627301" onmouseenter="enter('-1569816593472627301');" onmouseout="out('-1569816593472627301');" style="">1149              .addRow(&quot;Shipping&quot;, order.getTotalShipping())                                                         </span>
<span class="-2587440008499047447" onmouseenter="enter('-2587440008499047447');" onmouseout="out('-2587440008499047447');" style="">1150              .addRow(&quot;Total&quot;, order.getTotal())                                                                    </span>
<span class="-7531230309631143371" onmouseenter="enter('-7531230309631143371');" onmouseout="out('-7531230309631143371');" style="">1151              .addSeparator();                                                                                      </span>
<span  style="">1152                                                                                                                    </span>
<span class="5532863706287091360" onmouseenter="enter('5532863706287091360');" onmouseout="out('5532863706287091360');" style="">1153          log.debug(tc.toString());                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1154      }                                                                                                             </span>
<span  style="">1155                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1156      @Override                                                                                                     </span>
<span class="-6821589912139190758" onmouseenter="enter('-6821589912139190758');" onmouseout="out('-6821589912139190758');" style="">1157      public void preValidateCartOperation(Order cart) {                                                            </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1158          ExtensionResultHolder erh = new ExtensionResultHolder();                                                  </span>
<span class="-2298593102036867448" onmouseenter="enter('-2298593102036867448');" onmouseout="out('-2298593102036867448');" style="">1159          extensionManager.getProxy().preValidateCartOperation(cart, erh);                                          </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1160          if (erh.getThrowable() instanceof IllegalCartOperationException) {                                        </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1161              throw ((IllegalCartOperationException) erh.getThrowable());                                           </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1162          } else if (erh.getThrowable() != null) {                                                                  </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1163              throw new RuntimeException(erh.getThrowable());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1164          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1165      }                                                                                                             </span>
<span  style="">1166                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1167      @Override                                                                                                     </span>
<span class="6673450650333126736" onmouseenter="enter('6673450650333126736');" onmouseout="out('6673450650333126736');" style="">1168      public void preValidateUpdateQuantityOperation(Order cart, OrderItemRequestDTO dto) {                         </span>
<span class="636040910686188019" onmouseenter="enter('636040910686188019');" onmouseout="out('636040910686188019');" style="">1169          ExtensionResultHolder erh = new ExtensionResultHolder();                                                  </span>
<span class="-1253981422185917754" onmouseenter="enter('-1253981422185917754');" onmouseout="out('-1253981422185917754');" style="">1170          extensionManager.getProxy().preValidateUpdateQuantityOperation(cart, dto, erh);                           </span>
<span class="-8513171518561855619" onmouseenter="enter('-8513171518561855619');" onmouseout="out('-8513171518561855619');" style="">1171          if (erh.getThrowable() instanceof IllegalCartOperationException) {                                        </span>
<span class="4429068555638980213" onmouseenter="enter('4429068555638980213');" onmouseout="out('4429068555638980213');" style="">1172              throw ((IllegalCartOperationException) erh.getThrowable());                                           </span>
<span class="-1685056697784370808" onmouseenter="enter('-1685056697784370808');" onmouseout="out('-1685056697784370808');" style="">1173          } else if (erh.getThrowable() != null) {                                                                  </span>
<span class="1266525243540661331" onmouseenter="enter('1266525243540661331');" onmouseout="out('1266525243540661331');" style="">1174              throw new RuntimeException(erh.getThrowable());                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1175          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1176      }                                                                                                             </span>
<span  style="">1177                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1178      @Override                                                                                                     </span>
<span class="7073850063066733207" onmouseenter="enter('7073850063066733207');" onmouseout="out('7073850063066733207');" style="">1179      public void refresh(Order order) {                                                                            </span>
<span class="4383314386154345120" onmouseenter="enter('4383314386154345120');" onmouseout="out('4383314386154345120');" style="">1180          orderDao.refresh(order);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1181      }                                                                                                             </span>
<span  style="">1182                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1183      @Override                                                                                                     </span>
<span class="1062745462356892667" onmouseenter="enter('1062745462356892667');" onmouseout="out('1062745462356892667');" style="">1184      public Order findCartForCustomerWithEnhancements(Customer customer) {                                         </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1185          ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                                    </span>
<span class="8097724414319335156" onmouseenter="enter('8097724414319335156');" onmouseout="out('8097724414319335156');" style=""><abbr title="1186          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, erh);">1186          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customerðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1187          if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                          </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1188              return erh.getResult();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1189          }                                                                                                         </span>
<span class="-7896162153865126169" onmouseenter="enter('-7896162153865126169');" onmouseout="out('-7896162153865126169');" style="">1190          return findCartForCustomer(customer);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1191      }                                                                                                             </span>
<span  style="">1192                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1193      @Override                                                                                                     </span>
<span class="3369501079555878000" onmouseenter="enter('3369501079555878000');" onmouseout="out('3369501079555878000');" style="">1194      public Order findCartForCustomerWithEnhancements(Customer customer, Order candidateOrder) {                   </span>
<span class="5165057861481115804" onmouseenter="enter('5165057861481115804');" onmouseout="out('5165057861481115804');" style="">1195          ExtensionResultHolder&lt;Order&gt; erh = new ExtensionResultHolder&lt;Order&gt;();                                    </span>
<span class="935633576463333972" onmouseenter="enter('935633576463333972');" onmouseout="out('935633576463333972');" style=""><abbr title="1196          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customer, candidateOrder, erh);">1196          ExtensionResultStatusType resultStatusType = extensionManager.findCartForCustomerWithEnhancements(customerðŸ”µ</abbr></span>
<span class="6681977435671185568" onmouseenter="enter('6681977435671185568');" onmouseout="out('6681977435671185568');" style="">1197          if (ExtensionResultStatusType.NOT_HANDLED != resultStatusType) {                                          </span>
<span class="1471471665797487691" onmouseenter="enter('1471471665797487691');" onmouseout="out('1471471665797487691');" style="">1198              return erh.getResult();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1199          }                                                                                                         </span>
<span class="5654562705123023026" onmouseenter="enter('5654562705123023026');" onmouseout="out('5654562705123023026');" style="">1200          return candidateOrder;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1201      }                                                                                                             </span>
<span  style="">1202                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1203      @Override                                                                                                     </span>
<span class="7870513728701775364" onmouseenter="enter('7870513728701775364');" onmouseout="out('7870513728701775364');" style="">1204      public List&lt;Order&gt; findOrdersByEmail(String email) {                                                          </span>
<span class="-6244770976468678027" onmouseenter="enter('-6244770976468678027');" onmouseout="out('-6244770976468678027');" style="">1205          return orderDao.readOrdersByEmail(email);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1206      }                                                                                                             </span>
<span  style="">1207                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1208      @Override                                                                                                     </span>
<span class="1732562485956607688" onmouseenter="enter('1732562485956607688');" onmouseout="out('1732562485956607688');" style="">1209      public List&lt;Order&gt; readBatchOrders(int start, int pageSize, List&lt;OrderStatus&gt; orderStatusList) {              </span>
<span class="-4564878267596583277" onmouseenter="enter('-4564878267596583277');" onmouseout="out('-4564878267596583277');" style="">1210          return orderDao.readBatchOrders(start, pageSize, orderStatusList);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1211      }                                                                                                             </span>
<span  style="">1212                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1213      @Override                                                                                                     </span>
<span class="-7199170496986096208" onmouseenter="enter('-7199170496986096208');" onmouseout="out('-7199170496986096208');" style="">1214  	public Long readNumberOfOrders() {                                                                               </span>
<span class="4444270982432861777" onmouseenter="enter('4444270982432861777');" onmouseout="out('4444270982432861777');" style="">1215      		return orderDao.readNumberOfOrders();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1216      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1217  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            