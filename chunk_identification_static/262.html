<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>262</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    262
                    <a href="261.html">prev</a>
                    <a href="263.html">next</a>
                    <a href="262_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_19af9aee8a11baeec3d762122e0750770ea31cd1_hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;19af9aee8a11baeec3d762122e0750770ea31cd1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;19af9aee8a11baeec3d762122e0750770ea31cd1^1:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;19af9aee8a11baeec3d762122e0750770ea31cd1^2:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;40c2c0fe4eb270d5956d2f1e6b11ef26336e7a9e:hbase/hbase-sink/src/main/java/com/dtstack/flink/sql/sink/hbase/HbaseOutputFormat.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj], [bsj], [bs], [j]], subset: [[bsj], [bsj], [bs], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  21                                                                                                          </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="">  22 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  23 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  26 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  28 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  30 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  31 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  32 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  33 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  34 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  35 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  36 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  37 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  38 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  39 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  40 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  41 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  46 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  47 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  48 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  49 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  52 import java.util.Objects;                                                                                </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  53 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  54 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  55 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  56 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  57                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  58 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  59  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  60  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  62 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span  style="">  63                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  64     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  65     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  66     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  67     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  68     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  69     private String[] columnNames;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  70     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  71     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  72     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  73     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  74     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  75     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  76     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  77     private String clientKeytabFile;                                                                     </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  78     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  79     private String[] qualifiers;                                                                         </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  80     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  81     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  82     private transient Table table;                                                                       </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  83     private transient ChoreService choreService;                                                         </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  84     private transient List&lt;Row&gt; records;                                                                 </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  85     private transient volatile boolean closed = false;                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  87      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  89     private Integer batchSize;                                                                           </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  90     private Long batchWaitInterval;                                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  91     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  92      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  94     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  95     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style="">  96                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  97     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="">  98      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  99      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style=""> 100     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style=""> 101                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 102     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span  style=""> 104                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 105     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 106         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 110     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 111         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 112         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 116     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 117         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 118         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 119         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 120         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 121         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 122         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 123         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 126     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 127         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 128             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 129                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 130                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 131             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 132                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 133                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 134                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 135                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 137         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 138             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 140         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141     }                                                                                                    </span>
<span  style=""> 142                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 143     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 144      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 145      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 146      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 147      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 148     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 149         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 150             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 151                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 152                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 153                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 154                 );                                                                                       </span>
<span  style=""> 155                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 156                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 157                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 158                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 159                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 160                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 163                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 164                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 167             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 168             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170     }                                                                                                    </span>
<span  style=""> 171                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 172     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 173         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 174         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 175                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 176         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 177         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 178         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 178         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 179                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 180         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 181                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 182         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 183         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 183         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 184                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 185         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 186         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 187                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 188         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 188         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 189         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 190         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 191             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 192                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 193                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 194                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 195                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                 }                                                                                        </span>
<span  style=""> 197                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 198                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 199             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 200                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 201                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 203         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204     }                                                                                                    </span>
<span  style=""> 205                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 206     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 207     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 208         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 209             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 210                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 212                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 217     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 218         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 219         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 220         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 221             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223     }                                                                                                    </span>
<span  style=""> 224                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 225     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 226         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="2702507020447237742" onmouseenter="enter('2702507020447237742');" onmouseout="out('2702507020447237742');" style=""> 227         Object[] results = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 228         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 229             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 230             for (Row record : records) {                                                                 </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 231                 Put put = getPutByRow(record);                                                           </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 232                 if (put == null || put.isEmpty()) {                                                      </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 233 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234                     dirtyDataManager.execute();                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236                         record.toString(),                                                               </span>
<span class="7815765536260095992" onmouseenter="enter('7815765536260095992');" onmouseout="out('7815765536260095992');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237                         &quot;HBase put is empty, check record please!&quot;                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239                     outDirtyRecords.inc();                                                               </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 240 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246             }                                                                                            </span>
<span class="-7907197852339825500" onmouseenter="enter('-7907197852339825500');" onmouseout="out('-7907197852339825500');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247         } catch (IOException | InterruptedException ignored) {                                           </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249             // 判断数据是否插入成功                                                                                </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250             for (int i = 0; i &lt; results.length; i++) {                                                   </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251                 if (results[i] instanceof Exception) {                                                   </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252                     if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 253 =======                                                                                                  </span>
<span class="-1237525694688178699" onmouseenter="enter('-1237525694688178699');" onmouseout="out('-1237525694688178699');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254                     dealError(                                                                           </span>
<span class="891149538086870920" onmouseenter="enter('891149538086870920');" onmouseout="out('891149538086870920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255                         record,                                                                          </span>
<span class="3856437991371115709" onmouseenter="enter('3856437991371115709');" onmouseout="out('3856437991371115709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                         &quot;HBase put is empty, please check the record.&quot;);                                 </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 257 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 258                 } else {                                                                                 </span>
<span class="4470807213303714255" onmouseenter="enter('4470807213303714255');" onmouseout="out('4470807213303714255');" style=""> 259                     puts.add(put);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261             }                                                                                            </span>
<span class="-5028617666301505856" onmouseenter="enter('-5028617666301505856');" onmouseout="out('-5028617666301505856');" style=""> 262             results = new Object[puts.size()];                                                           </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 263             table.batch(puts, results);                                                                  </span>
<span  style=""> 264                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 265             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 266             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 267                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 268                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269             }                                                                                            </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style=""> 270         } catch (IOException | InterruptedException e) {                                                 </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 271             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 272         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 273             // 判断数据是否插入成功                                                                                </span>
<span class="-3528902168646229933" onmouseenter="enter('-3528902168646229933');" onmouseout="out('-3528902168646229933');" style=""> 274             for (int i = 0; i &lt; Objects.requireNonNull(results).length; i++) {                           </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 275                 if (results[i] instanceof Exception) {                                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 276 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277                     dirtyDataManager.execute();                                                          </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278                     // 脏数据记录                                                                             </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280                         records.get(i).toString(),                                                       </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281                         ExceptionTrace.traceOriginalCause((Exception) results[i])                        </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 283                     outDirtyRecords.inc();                                                               </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 284 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300             table.put(put);                                                                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 301 =======                                                                                                  </span>
<span class="2374030727617048190" onmouseenter="enter('2374030727617048190');" onmouseout="out('2374030727617048190');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                     dealError(records.get(i), ExceptionTrace.traceOriginalCause((Exception) results[i]));</span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 303 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 304                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 305                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 306                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 309             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 310             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span  style=""> 313                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 314     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 315         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 316         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 317             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 318             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 319             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span  style=""> 321                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 322         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 323             table.put(put);                                                                              </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 324 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         } catch (Exception e) {                                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329             dirtyDataManager.collectDirtyData(                                                           </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 330                 record.toString(),                                                                       </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 331                 ExceptionTrace.traceOriginalCause(e));                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 332             outDirtyRecords.inc();                                                                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 333 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336                                                                                                          </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339         }                                                                                                </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 357 =======                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358         } catch (Exception e) {                                                                          </span>
<span class="-8645058660559347801" onmouseenter="enter('-8645058660559347801');" onmouseout="out('-8645058660559347801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             dealError(record, ExceptionTrace.traceOriginalCause(e));                                     </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 360 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361         }                                                                                                </span>
<span  style=""> 362                                                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 363         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="-1029363078755938846" onmouseenter="enter('-1029363078755938846');" onmouseout="out('-1029363078755938846');" style=""> 366     private void dealError(Row record, String cause) {                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 367         if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {           </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style=""> 368             LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                          </span>
<span class="768105938836943395" onmouseenter="enter('768105938836943395');" onmouseout="out('768105938836943395');" style=""> 369             LOG.error(&quot;Error cause: &quot; + cause);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370         }                                                                                                </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 371         outDirtyRecords.inc();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span  style=""> 373                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 374     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 375         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 376         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 377             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 379         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 380         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 381             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 382             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 383                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 384                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 385                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 386                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 387                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 390         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391     }                                                                                                    </span>
<span  style=""> 392                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 393     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 394         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 395         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 396         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 397             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 398             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 399             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 401         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402     }                                                                                                    </span>
<span  style=""> 403                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 404     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 405         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 406         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 407         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 408         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409     }                                                                                                    </span>
<span  style=""> 410                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 411     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 412         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 413         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 414             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 416         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417     }                                                                                                    </span>
<span  style=""> 418                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 419     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 420     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 421         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 422             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423         }                                                                                                </span>
<span  style=""> 424                                                                                                          </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 425         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 426         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 427             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428         }                                                                                                </span>
<span  style=""> 429                                                                                                          </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 430         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 431             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 432             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 433                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span  style=""> 436                                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 437         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 438             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 439             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440         }                                                                                                </span>
<span  style=""> 441                                                                                                          </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 442         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 443             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 445     }                                                                                                    </span>
<span  style=""> 446                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 447     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 448                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 449                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 450                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 451         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 452             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 452             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 454         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 455         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 456         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 457         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 458                                                                                                          </span>
<span  style=""> 459                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 460         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 461             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462         }                                                                                                </span>
<span  style=""> 463                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 464         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 465             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 466             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 467             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469     }                                                                                                    </span>
<span  style=""> 470                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 471     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 472     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 473         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 474                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 475                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 476                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 477                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 478                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 479                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 480                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 481                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 482                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 483                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484     }                                                                                                    </span>
<span  style=""> 485                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 486     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 487                                                                                                          </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 488         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 489                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 490         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 491             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492         }                                                                                                </span>
<span  style=""> 493                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 494         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 495             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 496             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497         }                                                                                                </span>
<span  style=""> 498                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 499         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 500             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 501             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502         }                                                                                                </span>
<span  style=""> 503                                                                                                          </span>
<span  style=""> 504                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 505         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 506             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 507             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508         }                                                                                                </span>
<span  style=""> 509                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 510         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 511             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 512             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513         }                                                                                                </span>
<span  style=""> 514                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 515         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 516             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 517             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518         }                                                                                                </span>
<span  style=""> 519                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 520         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 521             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 522             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523         }                                                                                                </span>
<span  style=""> 524                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 525         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 526             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 527             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528         }                                                                                                </span>
<span  style=""> 529                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 530         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 531             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 532             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533         }                                                                                                </span>
<span  style=""> 534                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 535         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 536             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 537             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538         }                                                                                                </span>
<span  style=""> 539                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 540         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 541             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 542             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 543         }                                                                                                </span>
<span  style=""> 544                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 545         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 546             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 547             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548         }                                                                                                </span>
<span  style=""> 549                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 550         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 551             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 552             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553         }                                                                                                </span>
<span  style=""> 554                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 555         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 556             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 557             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558         }                                                                                                </span>
<span  style=""> 559                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 560         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 561             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 562             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563         }                                                                                                </span>
<span  style=""> 564                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 565         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 566             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 567             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568         }                                                                                                </span>
<span  style=""> 569                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 570         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 571             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 572             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 573         }                                                                                                </span>
<span  style=""> 574                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 575         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 576             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 577             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 578             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 579             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 579             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 580                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 581             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 582             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 583                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 584             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 585                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 586                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 587                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 588                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 589                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 590                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 591                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 594             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 595             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 596                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 597             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 598         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 599     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 600 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  21                                                                                                          </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="">  22 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  23 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  26 import com.google.common.collect.Maps;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  28 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  30 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  31 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  32 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  33 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  34 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  35 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  36 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  37 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  38 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  39 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  40 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  41 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  44                                                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  46 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  47 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  48 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  49 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  52 import java.util.Objects;                                                                                </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  53 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  54 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  55 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  56 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  57                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  58 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  59  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  60  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  62 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span  style="">  63                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  64     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  65     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  66     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  67     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  68     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  69     private String[] columnNames;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  70     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  71     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  72     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  73     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  74     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  75     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  76     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  77     private String clientKeytabFile;                                                                     </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  78     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  79     private String[] qualifiers;                                                                         </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  80     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  81     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  82     private transient Table table;                                                                       </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  83     private transient ChoreService choreService;                                                         </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  84     private transient List&lt;Row&gt; records;                                                                 </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  85     private transient volatile boolean closed = false;                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  87      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  89     private Integer batchSize;                                                                           </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  90     private Long batchWaitInterval;                                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  91     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  92      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  94     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  95     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style="">  96                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  97     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="">  98      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  99      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style=""> 100     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style=""> 101                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 102     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span  style=""> 104                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 105     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 106         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 110     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 111         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 112         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span  style=""> 114                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 116     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 117         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 118         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 119         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 120         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 121         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 122         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 123         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 126     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 127         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 128             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 129                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 130                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 131             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 132                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 133                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 134                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 135                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 137         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 138             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 140         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141     }                                                                                                    </span>
<span  style=""> 142                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 143     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 144      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 145      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 146      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 147      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 148     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 149         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 150             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 151                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 152                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 153                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 154                 );                                                                                       </span>
<span  style=""> 155                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 156                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 157                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 158                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 159                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 160                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 163                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 164                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 167             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 168             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170     }                                                                                                    </span>
<span  style=""> 171                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 172     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 173         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 174         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 175                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 176         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 177         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 178         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 178         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 179                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 180         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 181                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 182         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 183         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 183         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 184                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 185         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 186         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 187                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 188         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 188         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 189         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 190         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 191             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 192                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 193                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 194                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 195                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                 }                                                                                        </span>
<span  style=""> 197                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 198                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 199             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 200                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 201                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 203         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204     }                                                                                                    </span>
<span  style=""> 205                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 206     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 207     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 208         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 209             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 210                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 211             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 212                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 217     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 218         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 219         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 220         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 221             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223     }                                                                                                    </span>
<span  style=""> 224                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 225     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 226         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="2702507020447237742" onmouseenter="enter('2702507020447237742');" onmouseout="out('2702507020447237742');" style=""> 227         Object[] results = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 228         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 229             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 230             for (Row record : records) {                                                                 </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 231                 Put put = getPutByRow(record);                                                           </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 232                 if (put == null || put.isEmpty()) {                                                      </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 233 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234                     dirtyDataManager.execute();                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236                         record.toString(),                                                               </span>
<span class="7815765536260095992" onmouseenter="enter('7815765536260095992');" onmouseout="out('7815765536260095992');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237                         &quot;HBase put is empty, check record please!&quot;                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239                     outDirtyRecords.inc();                                                               </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 240 ||||||| BASE                                                                                             </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241             table.batch(puts, results);                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 247 =======                                                                                                  </span>
<span class="-1237525694688178699" onmouseenter="enter('-1237525694688178699');" onmouseout="out('-1237525694688178699');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248                     dealError(                                                                           </span>
<span class="891149538086870920" onmouseenter="enter('891149538086870920');" onmouseout="out('891149538086870920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249                         record,                                                                          </span>
<span class="3856437991371115709" onmouseenter="enter('3856437991371115709');" onmouseout="out('3856437991371115709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250                         &quot;HBase put is empty, please check the record.&quot;);                                 </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 251 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 252                 } else {                                                                                 </span>
<span class="4470807213303714255" onmouseenter="enter('4470807213303714255');" onmouseout="out('4470807213303714255');" style=""> 253                     puts.add(put);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255             }                                                                                            </span>
<span class="-5028617666301505856" onmouseenter="enter('-5028617666301505856');" onmouseout="out('-5028617666301505856');" style=""> 256             results = new Object[puts.size()];                                                           </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 257             table.batch(puts, results);                                                                  </span>
<span  style=""> 258                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 259             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 260             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 261                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 262                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style=""> 264         } catch (IOException | InterruptedException e) {                                                 </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 265             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 266         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 267             // 判断数据是否插入成功                                                                                </span>
<span class="-3528902168646229933" onmouseenter="enter('-3528902168646229933');" onmouseout="out('-3528902168646229933');" style=""> 268             for (int i = 0; i &lt; Objects.requireNonNull(results).length; i++) {                           </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 269                 if (results[i] instanceof Exception) {                                                   </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 270 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271                     dirtyDataManager.execute();                                                          </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272                     // 脏数据记录                                                                             </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274                         records.get(i).toString(),                                                       </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275                         ExceptionTrace.traceOriginalCause((Exception) results[i])                        </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277                     outDirtyRecords.inc();                                                               </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 278 ||||||| BASE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 285 =======                                                                                                  </span>
<span class="2374030727617048190" onmouseenter="enter('2374030727617048190');" onmouseout="out('2374030727617048190');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286                     dealError(records.get(i), ExceptionTrace.traceOriginalCause((Exception) results[i]));</span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 287 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 288                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 289                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 290                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 293             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 294             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296     }                                                                                                    </span>
<span  style=""> 297                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 298     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 299         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 300         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 301             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 302             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 303             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304         }                                                                                                </span>
<span  style=""> 305                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 306         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 307             table.put(put);                                                                              </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 308 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 309 ||||||| BASE                                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310         } catch (Exception e) {                                                                          </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311             if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {       </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                 LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                      </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                 LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 314 =======                                                                                                  </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         } catch (Exception e) {                                                                          </span>
<span class="-8645058660559347801" onmouseenter="enter('-8645058660559347801');" onmouseout="out('-8645058660559347801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316             dealError(record, ExceptionTrace.traceOriginalCause(e));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 319 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 320         if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                          </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 321             LOG.info(record.toString());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322         }                                                                                                </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 323         } catch (Exception e) {                                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style=""> 324             dirtyDataManager.collectDirtyData(                                                           </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style=""> 325                 record.toString(),                                                                       </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style=""> 326                 ExceptionTrace.traceOriginalCause(e));                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 327             outDirtyRecords.inc();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328         }                                                                                                </span>
<span  style=""> 329                                                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 330         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331     }                                                                                                    </span>
<span  style=""> 332                                                                                                          </span>
<span class="-1029363078755938846" onmouseenter="enter('-1029363078755938846');" onmouseout="out('-1029363078755938846');" style=""> 333     private void dealError(Row record, String cause) {                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 334         if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {           </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style=""> 335             LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                          </span>
<span class="768105938836943395" onmouseenter="enter('768105938836943395');" onmouseout="out('768105938836943395');" style=""> 336             LOG.error(&quot;Error cause: &quot; + cause);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 338         outDirtyRecords.inc();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span  style=""> 340                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 341     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 342         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 343         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 344             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 346         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 347         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 348             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 349             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 350                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 351                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 352                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 353                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 354                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 357         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358     }                                                                                                    </span>
<span  style=""> 359                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 360     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 361         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 362         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 363         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 364             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 365             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 366             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 368         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369     }                                                                                                    </span>
<span  style=""> 370                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 371     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 372         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 373         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 374         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 375         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376     }                                                                                                    </span>
<span  style=""> 377                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 378     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 379         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 380         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 381             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 383         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384     }                                                                                                    </span>
<span  style=""> 385                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 386     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 387     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 388         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 389             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390         }                                                                                                </span>
<span  style=""> 391                                                                                                          </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 392         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 393         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 394             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395         }                                                                                                </span>
<span  style=""> 396                                                                                                          </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 397         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 398             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 399             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 400                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402         }                                                                                                </span>
<span  style=""> 403                                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 404         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 405             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 406             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407         }                                                                                                </span>
<span  style=""> 408                                                                                                          </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 409         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 410             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412     }                                                                                                    </span>
<span  style=""> 413                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 414     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 415                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 416                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 417                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 418         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 419             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 419             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 421         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 422         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 423         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 424         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 425                                                                                                          </span>
<span  style=""> 426                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 427         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 428             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429         }                                                                                                </span>
<span  style=""> 430                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 431         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 432             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 433             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 434             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436     }                                                                                                    </span>
<span  style=""> 437                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 438     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 439     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 440         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 441                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 442                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 443                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 444                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 445                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 446                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 447                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 448                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 449                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 450                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451     }                                                                                                    </span>
<span  style=""> 452                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 453     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 454                                                                                                          </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 455         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 456                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 457         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 458             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459         }                                                                                                </span>
<span  style=""> 460                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 461         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 462             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 463             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464         }                                                                                                </span>
<span  style=""> 465                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 466         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 467             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 468             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469         }                                                                                                </span>
<span  style=""> 470                                                                                                          </span>
<span  style=""> 471                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 472         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 473             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 474             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475         }                                                                                                </span>
<span  style=""> 476                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 477         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 478             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 479             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480         }                                                                                                </span>
<span  style=""> 481                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 482         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 483             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 484             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span  style=""> 486                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 487         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 488             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 489             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490         }                                                                                                </span>
<span  style=""> 491                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 492         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 493             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 494             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span  style=""> 496                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 497         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 498             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 499             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500         }                                                                                                </span>
<span  style=""> 501                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 502         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 503             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 504             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505         }                                                                                                </span>
<span  style=""> 506                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 507         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 508             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 509             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510         }                                                                                                </span>
<span  style=""> 511                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 512         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 513             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 514             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515         }                                                                                                </span>
<span  style=""> 516                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 517         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 518             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 519             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520         }                                                                                                </span>
<span  style=""> 521                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 522         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 523             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 524             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span  style=""> 526                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 527         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 528             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 529             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530         }                                                                                                </span>
<span  style=""> 531                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 532         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 533             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 534             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535         }                                                                                                </span>
<span  style=""> 536                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 537         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 538             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 539             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540         }                                                                                                </span>
<span  style=""> 541                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 542         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 543             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 544             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 545             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 546             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 546             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 547                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 548             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 549             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 550                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 551             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 552                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 553                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 554                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 555                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 556                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 557                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 558                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 559                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 561             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 562             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 563                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 564             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567 }                                                                                                        </span>































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  18 package com.dtstack.flink.sql.sink.hbase;                                                                </span>
<span  style="">  19                                                                                                          </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="">  20 import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                      </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  21 import com.dtstack.flink.sql.exception.ExceptionTrace;                                                   </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  22 import com.dtstack.flink.sql.factory.DTThreadFactory;                                                    </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  23 import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                    </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  24 import com.google.common.collect.Maps;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  25 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  26 import java.io.IOException;                                                                              </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  27 import java.security.PrivilegedAction;                                                                   </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  28 import java.util.ArrayList;                                                                              </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  29 import java.util.LinkedList;                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  30 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  31 import java.util.Map;                                                                                    </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="">  32 import java.util.Objects;                                                                                </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  33 import java.util.concurrent.ScheduledExecutorService;                                                    </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  34 import java.util.concurrent.ScheduledFuture;                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  35 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  36 import java.util.concurrent.TimeUnit;                                                                    </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  37 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  38 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  39 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  40 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  41 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  42 import org.apache.hadoop.hbase.AuthUtil;                                                                 </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  43 import org.apache.hadoop.hbase.ChoreService;                                                             </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  44 import org.apache.hadoop.hbase.HBaseConfiguration;                                                       </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  45 import org.apache.hadoop.hbase.ScheduledChore;                                                           </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  46 import org.apache.hadoop.hbase.TableName;                                                                </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  47 import org.apache.hadoop.hbase.client.Connection;                                                        </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  48 import org.apache.hadoop.hbase.client.ConnectionFactory;                                                 </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  49 import org.apache.hadoop.hbase.client.Put;                                                               </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  50 import org.apache.hadoop.hbase.client.Table;                                                             </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  51 import org.apache.hadoop.security.UserGroupInformation;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  52 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  53 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  54                                                                                                          </span>
<span  style="">  55                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56 /**                                                                                                      </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  57  * @author: jingzhen@dtstack.com                                                                         </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  58  * date: 2017-6-29                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59  */                                                                                                      </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  60 public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                </span>
<span  style="">  61                                                                                                          </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  62     private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                  </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  63     private String host;                                                                                 </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  64     private String zkParent;                                                                             </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  65     private String rowkey;                                                                               </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  66     private String tableName;                                                                            </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  67     private String[] columnNames;                                                                        </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  68     private Map&lt;String, String&gt; columnNameFamily;                                                        </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  69     private boolean kerberosAuthEnable;                                                                  </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  70     private String regionserverKeytabFile;                                                               </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  71     private String regionserverPrincipal;                                                                </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  72     private String securityKrb5Conf;                                                                     </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  73     private String zookeeperSaslClient;                                                                  </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  74     private String clientPrincipal;                                                                      </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  75     private String clientKeytabFile;                                                                     </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  76     private String[] families;                                                                           </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  77     private String[] qualifiers;                                                                         </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  78     private transient org.apache.hadoop.conf.Configuration conf;                                         </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  79     private transient Connection conn;                                                                   </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  80     private transient Table table;                                                                       </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  81     private transient ChoreService choreService;                                                         </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  82     private transient List&lt;Row&gt; records;                                                                 </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  83     private transient volatile boolean closed = false;                                                   </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  84     /**                                                                                                  </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  85      * 批量写入的参数                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86      */                                                                                                  </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  87     private Integer batchSize;                                                                           </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  88     private Long batchWaitInterval;                                                                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  89     /**                                                                                                  </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  90      * 定时任务                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91      */                                                                                                  </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  92     private transient ScheduledExecutorService scheduler;                                                </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  93     private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                </span>
<span  style="">  94                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  95     /**                                                                                                  </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="">  96      * 脏数据管理                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  97      */                                                                                                  </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style="">  98     private DirtyDataManager dirtyDataManager;                                                           </span>
<span  style="">  99                                                                                                          </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 100     private HbaseOutputFormat() {                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101     }                                                                                                    </span>
<span  style=""> 102                                                                                                          </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 103     public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                    </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 104         return new HbaseOutputFormatBuilder();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 107     @Override                                                                                            </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 108     public void configure(Configuration parameters) {                                                    </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 109         // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                    </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 110         // DO NOTHING                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111     }                                                                                                    </span>
<span  style=""> 112                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 113     @Override                                                                                            </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 114     public void open(int taskNumber, int numTasks) throws IOException {                                  </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 115         LOG.warn(&quot;---open---&quot;);                                                                          </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 116         records = new ArrayList&lt;&gt;();                                                                     </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 117         conf = HBaseConfiguration.create();                                                              </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 118         openConn();                                                                                      </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 119         table = conn.getTable(TableName.valueOf(tableName));                                             </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 120         LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                               </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 121         initMetric();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122     }                                                                                                    </span>
<span  style=""> 123                                                                                                          </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 124     private void openConn() {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 125         try {                                                                                            </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 126             if (kerberosAuthEnable) {                                                                    </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 127                 LOG.info(&quot;open kerberos conn&quot;);                                                          </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 128                 openKerberosConn();                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 129             } else {                                                                                     </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 130                 LOG.info(&quot;open conn&quot;);                                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 131                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                             </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 132                 conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                   </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 133                 conn = ConnectionFactory.createConnection(conf);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 135         } catch (Exception e) {                                                                          </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 136             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137         }                                                                                                </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 138         initScheduledTask(batchWaitInterval);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139     }                                                                                                    </span>
<span  style=""> 140                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 141     /**                                                                                                  </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 142      * 初始化定时写入任务                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 143      *                                                                                                   </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 144      * @param batchWaitInterval 定时任务时间                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 145      */                                                                                                  </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 146     private void initScheduledTask(Long batchWaitInterval) {                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 147         try {                                                                                            </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 148             if (batchWaitInterval &gt; 0) {                                                                 </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 149                 this.scheduler = new ScheduledThreadPoolExecutor(                                        </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 150                         1,                                                                               </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 151                         new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 152                 );                                                                                       </span>
<span  style=""> 153                                                                                                          </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 154                 this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                            </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 155                         () -&gt; {                                                                          </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 156                             synchronized (HbaseOutputFormat.this) {                                      </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 157                                 if (!records.isEmpty()) {                                                </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 158                                     dealBatchOperation(records);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                             }                                                                            </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 161                         }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                   </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 162                 );                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164         } catch (Exception e) {                                                                          </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 165             LOG.error(&quot;init schedule task failed !&quot;);                                                    </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 166             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168     }                                                                                                    </span>
<span  style=""> 169                                                                                                          </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 170     private void openKerberosConn() throws Exception {                                                   </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 171         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                     </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 172         conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                           </span>
<span  style=""> 173                                                                                                          </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 174         LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                            </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 175         Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);</span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""><abbr title=" 176         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);"> 176         Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;🔵</abbr></span>
<span  style=""> 177                                                                                                          </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 178         fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);      </span>
<span  style=""> 179                                                                                                          </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 180         clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;           </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""><abbr title=" 181         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;"> 181         clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal🔵</abbr></span>
<span  style=""> 182                                                                                                          </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 183         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                       </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 184         conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                 </span>
<span  style=""> 185                                                                                                          </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 186         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 186         UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrinci🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 187         org.apache.hadoop.conf.Configuration finalConf = conf;                                           </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 188         conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 189             try {                                                                                        </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 190                 ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                             </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 191                 if (authChore != null) {                                                                 </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 192                     choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 193                     choreService.scheduleChore(authChore);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194                 }                                                                                        </span>
<span  style=""> 195                                                                                                          </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 196                 return ConnectionFactory.createConnection(finalConf);                                    </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 197             } catch (IOException e) {                                                                    </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 198                 LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                              </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 199                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200             }                                                                                            </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 201         });                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 204     @Override                                                                                            </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 205     public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                               </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 206         if (record.f0) {                                                                                 </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style=""> 207             if (this.batchSize &gt; 1) {                                                                    </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 208                 writeBatchRecord(record.f1);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 209             } else {                                                                                     </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 210                 dealInsert(record.f1);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 215     public void writeBatchRecord(Row row) {                                                              </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 216         records.add(row);                                                                                </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 217         // 数据累计到batchSize之后开始处理                                                                          </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 218         if (records.size() == this.batchSize) {                                                          </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 219             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span  style=""> 222                                                                                                          </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 223     protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                  </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 224         // A null in the result array means that the call for that action failed, even after retries.    </span>
<span class="2702507020447237742" onmouseenter="enter('2702507020447237742');" onmouseout="out('2702507020447237742');" style=""> 225         Object[] results = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 226         try {                                                                                            </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 227             List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                          </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 228             for (Row record : records) {                                                                 </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 229                 Put put = getPutByRow(record);                                                           </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 230                 if (put == null || put.isEmpty()) {                                                      </span>
<span  style=""> 231                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 232 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 233                     dirtyDataManager.execute();                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 234                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 235                         record.toString(),                                                               </span>
<span class="7815765536260095992" onmouseenter="enter('7815765536260095992');" onmouseout="out('7815765536260095992');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 236                         &quot;HBase put is empty, check record please!&quot;                                       </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 237                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 238                     outDirtyRecords.inc();                                                               </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 239                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 240 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 241 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 241 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 242 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243                                                                                                          </span>
<span class="-1237525694688178699" onmouseenter="enter('-1237525694688178699');" onmouseout="out('-1237525694688178699');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244                     dealError(                                                                           </span>
<span class="891149538086870920" onmouseenter="enter('891149538086870920');" onmouseout="out('891149538086870920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245                         record,                                                                          </span>
<span class="3856437991371115709" onmouseenter="enter('3856437991371115709');" onmouseout="out('3856437991371115709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246                         &quot;HBase put is empty, please check the record.&quot;);                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 248 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 249                 } else {                                                                                 </span>
<span class="4470807213303714255" onmouseenter="enter('4470807213303714255');" onmouseout="out('4470807213303714255');" style=""> 250                     puts.add(put);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252             }                                                                                            </span>
<span class="-5028617666301505856" onmouseenter="enter('-5028617666301505856');" onmouseout="out('-5028617666301505856');" style=""> 253             results = new Object[puts.size()];                                                           </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 254             table.batch(puts, results);                                                                  </span>
<span  style=""> 255                                                                                                          </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 256             // 打印结果                                                                                      </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 257             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 258                 // 只打印最后一条数据                                                                             </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 259                 LOG.info(records.get(records.size() - 1).toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260             }                                                                                            </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style=""> 261         } catch (IOException | InterruptedException e) {                                                 </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style=""> 262             // ignore exception                                                                          </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 263         } finally {                                                                                      </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 264             // 判断数据是否插入成功                                                                                </span>
<span class="-3528902168646229933" onmouseenter="enter('-3528902168646229933');" onmouseout="out('-3528902168646229933');" style=""> 265             for (int i = 0; i &lt; Objects.requireNonNull(results).length; i++) {                           </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 266                 if (results[i] instanceof Exception) {                                                   </span>
<span  style=""> 267                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 268 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269                     dirtyDataManager.execute();                                                          </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270                     // 脏数据记录                                                                             </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271                     dirtyDataManager.collectDirtyData(                                                   </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272                         records.get(i).toString(),                                                       </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273                         ExceptionTrace.traceOriginalCause((Exception) results[i])                        </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274                     );                                                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275                     outDirtyRecords.inc();                                                               </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 277 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 278 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 278 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 279 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280                                                                                                          </span>
<span class="2374030727617048190" onmouseenter="enter('2374030727617048190');" onmouseout="out('2374030727617048190');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281                     dealError(records.get(i), ExceptionTrace.traceOriginalCause((Exception) results[i]));</span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 283 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 284                 } else {                                                                                 </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 285                     // 输出结果条数记录                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 286                     outRecords.inc();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288             }                                                                                            </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 289             // 添加完数据之后数据清空records                                                                        </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 290             records.clear();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292     }                                                                                                    </span>
<span  style=""> 293                                                                                                          </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 294     protected void dealInsert(Row record) {                                                              </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 295         Put put = getPutByRow(record);                                                                   </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 296         if (put == null || put.isEmpty()) {                                                              </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 297             // 记录脏数据                                                                                     </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 298             outDirtyRecords.inc();                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 299             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 302         try {                                                                                            </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 303             table.put(put);                                                                              </span>
<span  style=""> 304                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 305 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306             if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                      </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307                 LOG.info(record.toString());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         } catch (Exception e) {                                                                          </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310             dirtyDataManager.collectDirtyData(                                                           </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311                 record.toString(),                                                                       </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312                 ExceptionTrace.traceOriginalCause(e));                                                   </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313             outDirtyRecords.inc();                                                                       </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 315 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 316 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 316 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 317 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319         } catch (Exception e) {                                                                          </span>
<span class="-8645058660559347801" onmouseenter="enter('-8645058660559347801');" onmouseout="out('-8645058660559347801');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320             dealError(record, ExceptionTrace.traceOriginalCause(e));                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 322 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323         }                                                                                                </span>
<span  style=""> 324                                                                                                          </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 325         outRecords.inc();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326     }                                                                                                    </span>
<span  style=""> 327                                                                                                          </span>
<span class="-1029363078755938846" onmouseenter="enter('-1029363078755938846');" onmouseout="out('-1029363078755938846');" style=""> 328     private void dealError(Row record, String cause) {                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style=""> 329         if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {           </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style=""> 330             LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                          </span>
<span class="768105938836943395" onmouseenter="enter('768105938836943395');" onmouseout="out('768105938836943395');" style=""> 331             LOG.error(&quot;Error cause: &quot; + cause);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332         }                                                                                                </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 333         outDirtyRecords.inc();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 336     private Put getPutByRow(Row record) {                                                                </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 337         String rowKey = buildRowKey(record);                                                             </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 338         if (StringUtils.isEmpty(rowKey)) {                                                               </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 339             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340         }                                                                                                </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 341         Put put = new Put(rowKey.getBytes());                                                            </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 342         for (int i = 0; i &lt; record.getArity(); ++i) {                                                    </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 343             Object fieldVal = record.getField(i);                                                        </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 344             if (fieldVal != null) {                                                                      </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 345                 byte[] val = fieldVal.toString().getBytes();                                             </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 346                 byte[] cf = families[i].getBytes();                                                      </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 347                 byte[] qualifier = qualifiers[i].getBytes();                                             </span>
<span  style=""> 348                                                                                                          </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 349                 put.addColumn(cf, qualifier, val);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351         }                                                                                                </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 352         return put;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353     }                                                                                                    </span>
<span  style=""> 354                                                                                                          </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 355     private String buildRowKey(Row record) {                                                             </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 356         String rowKeyValues = getRowKeyValues(record);                                                   </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 357         // all rowkey not null                                                                           </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 358         if (StringUtils.isBlank(rowKeyValues)) {                                                         </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 359             LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                             </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 360             outDirtyRecords.inc();                                                                       </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 361             return &quot;&quot;;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362         }                                                                                                </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 363         return rowKeyValues;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 366     private String getRowKeyValues(Row record) {                                                         </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 367         Map&lt;String, Object&gt; row = rowConvertMap(record);                                                 </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 368         RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                               </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 369         rowKeyBuilder.init(rowkey);                                                                      </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 370         return rowKeyBuilder.getRowKey(row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371     }                                                                                                    </span>
<span  style=""> 372                                                                                                          </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 373     private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                              </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 374         Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 375         for (int i = 0; i &lt; columnNames.length; i++) {                                                   </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 376             rowValue.put(columnNames[i], record.getField(i));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377         }                                                                                                </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 378         return rowValue;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379     }                                                                                                    </span>
<span  style=""> 380                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 381     @Override                                                                                            </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 382     public synchronized void close() throws IOException {                                                </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 383         if (closed) {                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 384             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385         }                                                                                                </span>
<span  style=""> 386                                                                                                          </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 387         closed = true;                                                                                   </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 388         if (!records.isEmpty()) {                                                                        </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 389             dealBatchOperation(records);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 390         }                                                                                                </span>
<span  style=""> 391                                                                                                          </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 392         if (scheduledFuture != null) {                                                                   </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 393             scheduledFuture.cancel(false);                                                               </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 394             if (scheduler != null) {                                                                     </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 395                 scheduler.shutdownNow();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397         }                                                                                                </span>
<span  style=""> 398                                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 399         if (conn != null) {                                                                              </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 400             conn.close();                                                                                </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 401             conn = null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402         }                                                                                                </span>
<span  style=""> 403                                                                                                          </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style=""> 404         if (dirtyDataManager != null) {                                                                  </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style=""> 405             dirtyDataManager.close();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 407     }                                                                                                    </span>
<span  style=""> 408                                                                                                          </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 409     private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                     </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 410                                         String regionserverPrincipal,                                    </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 411                                         String zookeeperSaslClient,                                      </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 412                                         String securityKrb5Conf) {                                       </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 413         if (StringUtils.isEmpty(regionserverPrincipal)) {                                                </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 414             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 414             throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415         }                                                                                                </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 416         config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);         </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 417         config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);   </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 418         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                           </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 419         config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                      </span>
<span  style=""> 420                                                                                                          </span>
<span  style=""> 421                                                                                                          </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 422         if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                 </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 423             System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424         }                                                                                                </span>
<span  style=""> 425                                                                                                          </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 426         if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                    </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 427             String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;    </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 428             LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                   </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 429             System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431     }                                                                                                    </span>
<span  style=""> 432                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 433     @Override                                                                                            </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 434     public String toString() {                                                                           </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 435         return &quot;HbaseOutputFormat kerberos{&quot; +                                                           </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 436                 &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                             </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 437                 &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                           </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 438                 &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                             </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 439                 &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                       </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 440                 &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                 </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 441                 &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                         </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 442                 &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                       </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 443                 &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                     </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 444                 &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                     </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 445                 &#x27;}&#x27;;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 446     }                                                                                                    </span>
<span  style=""> 447                                                                                                          </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 448     public static class HbaseOutputFormatBuilder {                                                       </span>
<span  style=""> 449                                                                                                          </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 450         private final HbaseOutputFormat format;                                                          </span>
<span  style=""> 451                                                                                                          </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 452         private HbaseOutputFormatBuilder() {                                                             </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 453             format = new HbaseOutputFormat();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454         }                                                                                                </span>
<span  style=""> 455                                                                                                          </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 456         public HbaseOutputFormatBuilder setHost(String host) {                                           </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 457             format.host = host;                                                                          </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 458             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459         }                                                                                                </span>
<span  style=""> 460                                                                                                          </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 461         public HbaseOutputFormatBuilder setZkParent(String parent) {                                     </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 462             format.zkParent = parent;                                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 463             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464         }                                                                                                </span>
<span  style=""> 465                                                                                                          </span>
<span  style=""> 466                                                                                                          </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 467         public HbaseOutputFormatBuilder setTable(String tableName) {                                     </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 468             format.tableName = tableName;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 469             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470         }                                                                                                </span>
<span  style=""> 471                                                                                                          </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 472         public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                       </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 473             format.rowkey = rowkey;                                                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 474             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475         }                                                                                                </span>
<span  style=""> 476                                                                                                          </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 477         public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                           </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 478             format.columnNames = columnNames;                                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 479             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480         }                                                                                                </span>
<span  style=""> 481                                                                                                          </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 482         public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {      </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 483             format.columnNameFamily = columnNameFamily;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 484             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485         }                                                                                                </span>
<span  style=""> 486                                                                                                          </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 487         public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {              </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 488             format.kerberosAuthEnable = kerberosAuthEnable;                                              </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 489             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490         }                                                                                                </span>
<span  style=""> 491                                                                                                          </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 492         public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {       </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 493             format.regionserverKeytabFile = regionserverKeytabFile;                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 494             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span  style=""> 496                                                                                                          </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 497         public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {         </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 498             format.regionserverPrincipal = regionserverPrincipal;                                        </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 499             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500         }                                                                                                </span>
<span  style=""> 501                                                                                                          </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 502         public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                   </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 503             format.securityKrb5Conf = securityKrb5Conf;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 504             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 505         }                                                                                                </span>
<span  style=""> 506                                                                                                          </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 507         public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {             </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 508             format.zookeeperSaslClient = zookeeperSaslClient;                                            </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 509             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510         }                                                                                                </span>
<span  style=""> 511                                                                                                          </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 512         public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                     </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 513             format.clientPrincipal = clientPrincipal;                                                    </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 514             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515         }                                                                                                </span>
<span  style=""> 516                                                                                                          </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 517         public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                   </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 518             format.clientKeytabFile = clientKeytabFile;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 519             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520         }                                                                                                </span>
<span  style=""> 521                                                                                                          </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style=""> 522         public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {             </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style=""> 523             format.dirtyDataManager = dirtyDataManager;                                                  </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 524             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525         }                                                                                                </span>
<span  style=""> 526                                                                                                          </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 527         public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 528             format.batchSize = batchSize;                                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 529             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530         }                                                                                                </span>
<span  style=""> 531                                                                                                          </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 532         public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                   </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 533             format.batchWaitInterval = batchWaitInterval;                                                </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 534             return this;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535         }                                                                                                </span>
<span  style=""> 536                                                                                                          </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 537         public HbaseOutputFormat finish() {                                                              </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 538             Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);              </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 539             Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);               </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 540             Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);           </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""><abbr title=" 541             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;);"> 541             Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be🔵</abbr></span>
<span  style=""> 542                                                                                                          </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 543             String[] families = new String[format.columnNames.length];                                   </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 544             String[] qualifiers = new String[format.columnNames.length];                                 </span>
<span  style=""> 545                                                                                                          </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 546             if (format.columnNameFamily != null) {                                                       </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 547                 List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());               </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 548                 String[] columns = keyList.toArray(new String[0]);                                       </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 549                 for (int i = 0; i &lt; columns.length; ++i) {                                               </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 550                     String col = columns[i];                                                             </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 551                     String[] part = col.split(&quot;:&quot;);                                                      </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 552                     families[i] = part[0];                                                               </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 553                     qualifiers[i] = part[1];                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 555             }                                                                                            </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 556             format.families = families;                                                                  </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 557             format.qualifiers = qualifiers;                                                              </span>
<span  style=""> 558                                                                                                          </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 559             return format;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 562 }                                                                                                        </span>




































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  21                                                                                                                    </span>
<span class="-6258277968020170341" onmouseenter="enter('-6258277968020170341');" onmouseout="out('-6258277968020170341');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.dtstack.flink.sql.dirtyManager.manager.DirtyDataManager;                                               </span>
<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  23  import com.dtstack.flink.sql.exception.ExceptionTrace;                                                            </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  24  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  25  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  26  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  27  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  28  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  30  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  31  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  32  import org.apache.hadoop.hbase.AuthUtil;                                                                          </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  33  import org.apache.hadoop.hbase.ChoreService;                                                                      </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  34  import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  35  import org.apache.hadoop.hbase.ScheduledChore;                                                                    </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  36  import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  37  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  38  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  39  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  40  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  41  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  42  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  43  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  44                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  46  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  47  import java.security.PrivilegedAction;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  48  import java.util.ArrayList;                                                                                       </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  49  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  50  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  51  import java.util.Map;                                                                                             </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import java.util.Objects;                                                                                         </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  53  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  54  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  55  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  56  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  57                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  58  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  59   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  60   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61   */                                                                                                               </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  62  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                         </span>
<span  style="">  63                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  64      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  65      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  66      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  67      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  68      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  69      private String[] columnNames;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  70      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  71      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  72      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  73      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  74      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  75      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  76      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  77      private String clientKeytabFile;                                                                              </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  78      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  79      private String[] qualifiers;                                                                                  </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  80      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  81      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  82      private transient Table table;                                                                                </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  83      private transient ChoreService choreService;                                                                  </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  84      private transient List&lt;Row&gt; records;                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  85      private transient volatile boolean closed = false;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  86      /**                                                                                                           </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  87       * 批量写入的参数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88       */                                                                                                           </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  89      private Integer batchSize;                                                                                    </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  90      private Long batchWaitInterval;                                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  91      /**                                                                                                           </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  92       * 定时任务                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93       */                                                                                                           </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  94      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  95      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>
<span  style="">  96                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +    /**                                                                                                           </span>
<span class="4307024989801496339" onmouseenter="enter('4307024989801496339');" onmouseout="out('4307024989801496339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +     * 脏数据管理                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +     */                                                                                                           </span>
<span class="-2697667257374928299" onmouseenter="enter('-2697667257374928299');" onmouseout="out('-2697667257374928299');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    private DirtyDataManager dirtyDataManager;                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                                                                                                                  </span>
<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style=""> 102      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103      }                                                                                                             </span>
<span  style=""> 104                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style=""> 105      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 106          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107      }                                                                                                             </span>
<span  style=""> 108                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 110      public void configure(Configuration parameters) {                                                             </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 111          // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                             </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 112          // DO NOTHING                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113      }                                                                                                             </span>
<span  style=""> 114                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 116      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 117          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 118          records = new ArrayList&lt;&gt;();                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 119          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 120          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 121          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 122          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 123          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124      }                                                                                                             </span>
<span  style=""> 125                                                                                                                    </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 126      private void openConn() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 127          try {                                                                                                     </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 128              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 129                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 130                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 131              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 132                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 133                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 134                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 135                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 137          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 138              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139          }                                                                                                         </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 140          initScheduledTask(batchWaitInterval);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141      }                                                                                                             </span>
<span  style=""> 142                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 143      /**                                                                                                           </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 144       * 初始化定时写入任务                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 145       *                                                                                                            </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 146       * @param batchWaitInterval 定时任务时间                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 147       */                                                                                                           </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 148      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 149          try {                                                                                                     </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 150              if (batchWaitInterval &gt; 0) {                                                                          </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 151                  this.scheduler = new ScheduledThreadPoolExecutor(                                                 </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 152                          1,                                                                                        </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 153                          new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 154                  );                                                                                                </span>
<span  style=""> 155                                                                                                                    </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 156                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                                     </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 157                          () -&gt; {                                                                                   </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 158                              synchronized (HbaseOutputFormat.this) {                                               </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 159                                  if (!records.isEmpty()) {                                                         </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 160                                      dealBatchOperation(records);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162                              }                                                                                     </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 163                          }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 164                  );                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 166          } catch (Exception e) {                                                                                   </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 167              LOG.error(&quot;init schedule task failed !&quot;);                                                             </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 168              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 172      private void openKerberosConn() throws Exception {                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 173          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 174          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 176          LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                                     </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 177          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 178          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 179                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 180          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 181                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 182          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 183          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 184                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 185          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 186          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 187                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 188          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 188          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 189          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 190          conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 191              try {                                                                                                 </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 192                  ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                      </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 193                  if (authChore != null) {                                                                          </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 194                      choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                         </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 195                      choreService.scheduleChore(authChore);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                  }                                                                                                 </span>
<span  style=""> 197                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 198                  return ConnectionFactory.createConnection(finalConf);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 199              } catch (IOException e) {                                                                             </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 200                  LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                       </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 201                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 203          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204      }                                                                                                             </span>
<span  style=""> 205                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 206      @Override                                                                                                     </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 207      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                                        </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 208          if (record.f0) {                                                                                          </span>
<span class="8741474660790294795" onmouseenter="enter('8741474660790294795');" onmouseout="out('8741474660790294795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -            if (this.batchSize != 0) {                                                                            </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +            if (this.batchSize &gt; 1) {                                                                             </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 211                  writeBatchRecord(record.f1);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 212              } else {                                                                                              </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 213                  dealInsert(record.f1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 218      public void writeBatchRecord(Row row) {                                                                       </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 219          records.add(row);                                                                                         </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 220          // 数据累计到batchSize之后开始处理                                                                                   </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 221          if (records.size() == this.batchSize) {                                                                   </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 222              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224      }                                                                                                             </span>
<span  style=""> 225                                                                                                                    </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 226      protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                           </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 227          // A null in the result array means that the call for that action failed, even after retries.             </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        Object[] results = new Object[records.size()];                                                            </span>
<span class="2702507020447237742" onmouseenter="enter('2702507020447237742');" onmouseout="out('2702507020447237742');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        Object[] results = null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 230          try {                                                                                                     </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 231              List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                                   </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 232              for (Row record : records) {                                                                          </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -                puts.add(getPutByRow(record));                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -            }                                                                                                     </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +                Put put = getPutByRow(record);                                                                    </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                if (put == null || put.isEmpty()) {                                                               </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +                    dirtyDataManager.execute();                                                                   </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                    dirtyDataManager.collectDirtyData(                                                            </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +                        record.toString(),                                                                        </span>
<span class="7815765536260095992" onmouseenter="enter('7815765536260095992');" onmouseout="out('7815765536260095992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +                        &quot;HBase put is empty, check record please!&quot;                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +                    );                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                    outDirtyRecords.inc();                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                } else {                                                                                          </span>
<span class="4470807213303714255" onmouseenter="enter('4470807213303714255');" onmouseout="out('4470807213303714255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                    puts.add(put);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +            }                                                                                                     </span>
<span class="-5028617666301505856" onmouseenter="enter('-5028617666301505856');" onmouseout="out('-5028617666301505856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +            results = new Object[puts.size()];                                                                    </span>
<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 248              table.batch(puts, results);                                                                           </span>
<span  style=""> 249                                                                                                                    </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 250              // 打印结果                                                                                               </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 251              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 252                  // 只打印最后一条数据                                                                                      </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 253                  LOG.info(records.get(records.size() - 1).toString());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254              }                                                                                                     </span>
<span class="-7907197852339825500" onmouseenter="enter('-7907197852339825500');" onmouseout="out('-7907197852339825500');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 255 -        } catch (IOException | InterruptedException ignored) {                                                    </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +        } catch (IOException | InterruptedException e) {                                                          </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +            // ignore exception                                                                                   </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 258          } finally {                                                                                               </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 259              // 判断数据是否插入成功                                                                                         </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 260 -            for (int i = 0; i &lt; results.length; i++) {                                                            </span>
<span class="-3528902168646229933" onmouseenter="enter('-3528902168646229933');" onmouseout="out('-3528902168646229933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +            for (int i = 0; i &lt; Objects.requireNonNull(results).length; i++) {                                    </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 262                  if (results[i] instanceof Exception) {                                                            </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                    if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                                </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                        LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                               </span>
<span class="191608650467857411" onmouseenter="enter('191608650467857411');" onmouseout="out('191608650467857411');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -                        LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results[i]));   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -                    }                                                                                             </span>
<span class="-4996017807114895224" onmouseenter="enter('-4996017807114895224');" onmouseout="out('-4996017807114895224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +                    dirtyDataManager.execute();                                                                   </span>
<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style=""> 268                      // 脏数据记录                                                                                      </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +                    dirtyDataManager.collectDirtyData(                                                            </span>
<span class="2903760467988971292" onmouseenter="enter('2903760467988971292');" onmouseout="out('2903760467988971292');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +                        records.get(i).toString(),                                                                </span>
<span class="5608629942095290553" onmouseenter="enter('5608629942095290553');" onmouseout="out('5608629942095290553');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                        ExceptionTrace.traceOriginalCause((Exception) results[i])                                 </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +                    );                                                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 273                      outDirtyRecords.inc();                                                                        </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 274                  } else {                                                                                          </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 275                      // 输出结果条数记录                                                                                   </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 276                      outRecords.inc();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278              }                                                                                                     </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 279              // 添加完数据之后数据清空records                                                                                 </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 280              records.clear();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282      }                                                                                                             </span>
<span  style=""> 283                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 284      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 285          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 286          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 287              // 记录脏数据                                                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 288              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 289              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290          }                                                                                                         </span>
<span  style=""> 291                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 292          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 293              table.put(put);                                                                                       </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +            if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +                LOG.info(record.toString());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +            }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 297          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -            if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -                LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                               </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -                LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -            }                                                                                                     </span>
<span class="1564953538831944204" onmouseenter="enter('1564953538831944204');" onmouseout="out('1564953538831944204');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +            dirtyDataManager.collectDirtyData(                                                                    </span>
<span class="5410876618906134123" onmouseenter="enter('5410876618906134123');" onmouseout="out('5410876618906134123');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +                record.toString(),                                                                                </span>
<span class="2536668618460450946" onmouseenter="enter('2536668618460450946');" onmouseout="out('2536668618460450946');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +                ExceptionTrace.traceOriginalCause(e));                                                            </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 305              outDirtyRecords.inc();                                                                                </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306          }                                                                                                         </span>
<span  style=""> 307                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -        if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -            LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -        }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 311          outRecords.inc();                                                                                         </span>








<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 314      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 315          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 316          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 317              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 319          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 320          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 321              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 322              if (fieldVal != null) {                                                                               </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 323                  byte[] val = fieldVal.toString().getBytes();                                                      </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 324                  byte[] cf = families[i].getBytes();                                                               </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 325                  byte[] qualifier = qualifiers[i].getBytes();                                                      </span>
<span  style=""> 326                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 327                  put.addColumn(cf, qualifier, val);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 330          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331      }                                                                                                             </span>
<span  style=""> 332                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 333      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 334          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 335          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 336          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 337              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 338              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 339              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 341          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342      }                                                                                                             </span>
<span  style=""> 343                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 344      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 345          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 346          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 347          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 348          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 349      }                                                                                                             </span>
<span  style=""> 350                                                                                                                    </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 351      private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                                       </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 352          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 353          for (int i = 0; i &lt; columnNames.length; i++) {                                                            </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 354              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 356          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357      }                                                                                                             </span>
<span  style=""> 358                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 359      @Override                                                                                                     </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 360      public synchronized void close() throws IOException {                                                         </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 361          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 362              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363          }                                                                                                         </span>
<span  style=""> 364                                                                                                                    </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 365          closed = true;                                                                                            </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 366          if (!records.isEmpty()) {                                                                                 </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 367              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368          }                                                                                                         </span>
<span  style=""> 369                                                                                                                    </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 370          if (scheduledFuture != null) {                                                                            </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 371              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 372              if (scheduler != null) {                                                                              </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 373                  scheduler.shutdownNow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375          }                                                                                                         </span>
<span  style=""> 376                                                                                                                    </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 377          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 378              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 379              conn = null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +                                                                                                                  </span>
<span class="-7172164562796099790" onmouseenter="enter('-7172164562796099790');" onmouseout="out('-7172164562796099790');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +        if (dirtyDataManager != null) {                                                                           </span>
<span class="6812508367565727421" onmouseenter="enter('6812508367565727421');" onmouseout="out('6812508367565727421');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +            dirtyDataManager.close();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385      }                                                                                                             </span>
<span  style=""> 386                                                                                                                    </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 387      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                              </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 388                                          String regionserverPrincipal,                                             </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 389                                          String zookeeperSaslClient,                                               </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 390                                          String securityKrb5Conf) {                                                </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 391          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 392              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 392              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 394          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 395          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 396          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 397          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 398                                                                                                                    </span>
<span  style=""> 399                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 400          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 401              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402          }                                                                                                         </span>
<span  style=""> 403                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 404          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 405              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 406              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 407              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409      }                                                                                                             </span>
<span  style=""> 410                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 411      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 412      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 413          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 414                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 415                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 416                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 417                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 418                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 419                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 420                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 421                  &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                              </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 422                  &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                              </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 423                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424      }                                                                                                             </span>
<span  style=""> 425                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 426      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 427                                                                                                                    </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 428          private final HbaseOutputFormat format;                                                                   </span>
<span  style=""> 429                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 430          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 431              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 432          }                                                                                                         </span>
<span  style=""> 433                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 434          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 435              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 436              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span  style=""> 438                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 439          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 440              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 441              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442          }                                                                                                         </span>
<span  style=""> 443                                                                                                                    </span>
<span  style=""> 444                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 445          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 446              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 447              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 448          }                                                                                                         </span>
<span  style=""> 449                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 450          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 451              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 452              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453          }                                                                                                         </span>
<span  style=""> 454                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 455          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 456              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 457              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458          }                                                                                                         </span>
<span  style=""> 459                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 460          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 461              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 462              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463          }                                                                                                         </span>
<span  style=""> 464                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 465          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 466              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 467              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468          }                                                                                                         </span>
<span  style=""> 469                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 470          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 471              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 472              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473          }                                                                                                         </span>
<span  style=""> 474                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 475          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 476              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 477              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 478          }                                                                                                         </span>
<span  style=""> 479                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 480          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 481              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 482              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483          }                                                                                                         </span>
<span  style=""> 484                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 485          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 486              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 487              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488          }                                                                                                         </span>
<span  style=""> 489                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 490          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 491              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 492              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493          }                                                                                                         </span>
<span  style=""> 494                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 495          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 496              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 497              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498          }                                                                                                         </span>
<span  style=""> 499                                                                                                                    </span>
<span class="-2265759085308818657" onmouseenter="enter('-2265759085308818657');" onmouseout="out('-2265759085308818657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 500 +        public HbaseOutputFormatBuilder setDirtyManager(DirtyDataManager dirtyDataManager) {                      </span>
<span class="-3697426272062367669" onmouseenter="enter('-3697426272062367669');" onmouseout="out('-3697426272062367669');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 501 +            format.dirtyDataManager = dirtyDataManager;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +            return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +                                                                                                                  </span>
<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 505          public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                         </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 506              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 507              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 508          }                                                                                                         </span>
<span  style=""> 509                                                                                                                    </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 510          public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                            </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 511              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 512              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513          }                                                                                                         </span>
<span  style=""> 514                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 515          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 516              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 517              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 518              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 519              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 520                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 521              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 522              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 523                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 524              if (format.columnNameFamily != null) {                                                                </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 525                  List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());                        </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 526                  String[] columns = keyList.toArray(new String[0]);                                                </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 527                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 528                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 529                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 530                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 531                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 534              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 535              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 536                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 537              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="8482835397054500786" onmouseenter="enter('8482835397054500786');" onmouseout="out('8482835397054500786');" style="">  20  package com.dtstack.flink.sql.sink.hbase;                                                                         </span>
<span  style="">  21                                                                                                                    </span>

<span class="8242627409855407146" onmouseenter="enter('8242627409855407146');" onmouseout="out('8242627409855407146');" style="">  22  import com.dtstack.flink.sql.exception.ExceptionTrace;                                                            </span>
<span class="9128825106411316982" onmouseenter="enter('9128825106411316982');" onmouseout="out('9128825106411316982');" style="">  23  import com.dtstack.flink.sql.factory.DTThreadFactory;                                                             </span>
<span class="102868081392093008" onmouseenter="enter('102868081392093008');" onmouseout="out('102868081392093008');" style="">  24  import com.dtstack.flink.sql.outputformat.AbstractDtRichOutputFormat;                                             </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  27  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  28  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  29  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  30  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="-6167510691397340134" onmouseenter="enter('-6167510691397340134');" onmouseout="out('-6167510691397340134');" style="">  31  import org.apache.hadoop.hbase.AuthUtil;                                                                          </span>
<span class="-7540112440525095855" onmouseenter="enter('-7540112440525095855');" onmouseout="out('-7540112440525095855');" style="">  32  import org.apache.hadoop.hbase.ChoreService;                                                                      </span>
<span class="-2192907090032735453" onmouseenter="enter('-2192907090032735453');" onmouseout="out('-2192907090032735453');" style="">  33  import org.apache.hadoop.hbase.HBaseConfiguration;                                                                </span>
<span class="-7227593598332358996" onmouseenter="enter('-7227593598332358996');" onmouseout="out('-7227593598332358996');" style="">  34  import org.apache.hadoop.hbase.ScheduledChore;                                                                    </span>
<span class="-1233342480689635281" onmouseenter="enter('-1233342480689635281');" onmouseout="out('-1233342480689635281');" style="">  35  import org.apache.hadoop.hbase.TableName;                                                                         </span>
<span class="3632472925081593574" onmouseenter="enter('3632472925081593574');" onmouseout="out('3632472925081593574');" style="">  36  import org.apache.hadoop.hbase.client.Connection;                                                                 </span>
<span class="4344740040662435246" onmouseenter="enter('4344740040662435246');" onmouseout="out('4344740040662435246');" style="">  37  import org.apache.hadoop.hbase.client.ConnectionFactory;                                                          </span>
<span class="-3924445369769787086" onmouseenter="enter('-3924445369769787086');" onmouseout="out('-3924445369769787086');" style="">  38  import org.apache.hadoop.hbase.client.Put;                                                                        </span>
<span class="1819111527575803882" onmouseenter="enter('1819111527575803882');" onmouseout="out('1819111527575803882');" style="">  39  import org.apache.hadoop.hbase.client.Table;                                                                      </span>
<span class="506888042235574053" onmouseenter="enter('506888042235574053');" onmouseout="out('506888042235574053');" style="">  40  import org.apache.hadoop.security.UserGroupInformation;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  41  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  42  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  44  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  45  import java.io.IOException;                                                                                       </span>
<span class="1742248696071637161" onmouseenter="enter('1742248696071637161');" onmouseout="out('1742248696071637161');" style="">  46  import java.security.PrivilegedAction;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  47  import java.util.ArrayList;                                                                                       </span>
<span class="2644117295780670879" onmouseenter="enter('2644117295780670879');" onmouseout="out('2644117295780670879');" style="">  48  import java.util.LinkedList;                                                                                      </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  49  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  50  import java.util.Map;                                                                                             </span>
<span class="6306724220981822255" onmouseenter="enter('6306724220981822255');" onmouseout="out('6306724220981822255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import java.util.Objects;                                                                                         </span>
<span class="-3897126621644903861" onmouseenter="enter('-3897126621644903861');" onmouseout="out('-3897126621644903861');" style="">  52  import java.util.concurrent.ScheduledExecutorService;                                                             </span>
<span class="-305598108755392570" onmouseenter="enter('-305598108755392570');" onmouseout="out('-305598108755392570');" style="">  53  import java.util.concurrent.ScheduledFuture;                                                                      </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  54  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  55  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  56                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  57  /**                                                                                                               </span>
<span class="-6786750206767189620" onmouseenter="enter('-6786750206767189620');" onmouseout="out('-6786750206767189620');" style="">  58   * @author: jingzhen@dtstack.com                                                                                  </span>
<span class="-2643125328500546565" onmouseenter="enter('-2643125328500546565');" onmouseout="out('-2643125328500546565');" style="">  59   * date: 2017-6-29                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60   */                                                                                                               </span>
<span class="6184840381507081969" onmouseenter="enter('6184840381507081969');" onmouseout="out('6184840381507081969');" style="">  61  public class HbaseOutputFormat extends AbstractDtRichOutputFormat&lt;Tuple2&lt;Boolean, Row&gt;&gt; {                         </span>
<span  style="">  62                                                                                                                    </span>
<span class="-1998795470991493365" onmouseenter="enter('-1998795470991493365');" onmouseout="out('-1998795470991493365');" style="">  63      private static final Logger LOG = LoggerFactory.getLogger(HbaseOutputFormat.class);                           </span>
<span class="-1112587504433449375" onmouseenter="enter('-1112587504433449375');" onmouseout="out('-1112587504433449375');" style="">  64      private String host;                                                                                          </span>
<span class="7859111350759242760" onmouseenter="enter('7859111350759242760');" onmouseout="out('7859111350759242760');" style="">  65      private String zkParent;                                                                                      </span>
<span class="8199822137793761378" onmouseenter="enter('8199822137793761378');" onmouseout="out('8199822137793761378');" style="">  66      private String rowkey;                                                                                        </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style="">  67      private String tableName;                                                                                     </span>
<span class="7810105112933339058" onmouseenter="enter('7810105112933339058');" onmouseout="out('7810105112933339058');" style="">  68      private String[] columnNames;                                                                                 </span>
<span class="-2766311408925309027" onmouseenter="enter('-2766311408925309027');" onmouseout="out('-2766311408925309027');" style="">  69      private Map&lt;String, String&gt; columnNameFamily;                                                                 </span>
<span class="-7984562056821796528" onmouseenter="enter('-7984562056821796528');" onmouseout="out('-7984562056821796528');" style="">  70      private boolean kerberosAuthEnable;                                                                           </span>
<span class="-7386280600356117312" onmouseenter="enter('-7386280600356117312');" onmouseout="out('-7386280600356117312');" style="">  71      private String regionserverKeytabFile;                                                                        </span>
<span class="-1847736455254110424" onmouseenter="enter('-1847736455254110424');" onmouseout="out('-1847736455254110424');" style="">  72      private String regionserverPrincipal;                                                                         </span>
<span class="2630561331587936941" onmouseenter="enter('2630561331587936941');" onmouseout="out('2630561331587936941');" style="">  73      private String securityKrb5Conf;                                                                              </span>
<span class="2659158971240423081" onmouseenter="enter('2659158971240423081');" onmouseout="out('2659158971240423081');" style="">  74      private String zookeeperSaslClient;                                                                           </span>
<span class="-4507182811915139716" onmouseenter="enter('-4507182811915139716');" onmouseout="out('-4507182811915139716');" style="">  75      private String clientPrincipal;                                                                               </span>
<span class="-5620912111943307084" onmouseenter="enter('-5620912111943307084');" onmouseout="out('-5620912111943307084');" style="">  76      private String clientKeytabFile;                                                                              </span>
<span class="-2689510262430523403" onmouseenter="enter('-2689510262430523403');" onmouseout="out('-2689510262430523403');" style="">  77      private String[] families;                                                                                    </span>
<span class="4282763728459488007" onmouseenter="enter('4282763728459488007');" onmouseout="out('4282763728459488007');" style="">  78      private String[] qualifiers;                                                                                  </span>
<span class="9019559823705303323" onmouseenter="enter('9019559823705303323');" onmouseout="out('9019559823705303323');" style="">  79      private transient org.apache.hadoop.conf.Configuration conf;                                                  </span>
<span class="-454863983751728251" onmouseenter="enter('-454863983751728251');" onmouseout="out('-454863983751728251');" style="">  80      private transient Connection conn;                                                                            </span>
<span class="4479524898423725315" onmouseenter="enter('4479524898423725315');" onmouseout="out('4479524898423725315');" style="">  81      private transient Table table;                                                                                </span>
<span class="5207070850086647751" onmouseenter="enter('5207070850086647751');" onmouseout="out('5207070850086647751');" style="">  82      private transient ChoreService choreService;                                                                  </span>
<span class="-6214430030140755124" onmouseenter="enter('-6214430030140755124');" onmouseout="out('-6214430030140755124');" style="">  83      private transient List&lt;Row&gt; records;                                                                          </span>
<span class="4293032579277507790" onmouseenter="enter('4293032579277507790');" onmouseout="out('4293032579277507790');" style="">  84      private transient volatile boolean closed = false;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  85      /**                                                                                                           </span>
<span class="-1179534313037171997" onmouseenter="enter('-1179534313037171997');" onmouseout="out('-1179534313037171997');" style="">  86       * 批量写入的参数                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  87       */                                                                                                           </span>
<span class="-3323133785720374878" onmouseenter="enter('-3323133785720374878');" onmouseout="out('-3323133785720374878');" style="">  88      private Integer batchSize;                                                                                    </span>
<span class="-787752491163974595" onmouseenter="enter('-787752491163974595');" onmouseout="out('-787752491163974595');" style="">  89      private Long batchWaitInterval;                                                                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90      /**                                                                                                           </span>
<span class="5314515920584500570" onmouseenter="enter('5314515920584500570');" onmouseout="out('5314515920584500570');" style="">  91       * 定时任务                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  92       */                                                                                                           </span>
<span class="9015955711937997200" onmouseenter="enter('9015955711937997200');" onmouseout="out('9015955711937997200');" style="">  93      private transient ScheduledExecutorService scheduler;                                                         </span>
<span class="-5761494216005426476" onmouseenter="enter('-5761494216005426476');" onmouseout="out('-5761494216005426476');" style="">  94      private transient ScheduledFuture&lt;?&gt; scheduledFuture;                                                         </span>
<span  style="">  95                                                                                                                    </span>





<span class="-2361367187510772956" onmouseenter="enter('-2361367187510772956');" onmouseout="out('-2361367187510772956');" style="">  96      private HbaseOutputFormat() {                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span class="-3448854242059653434" onmouseenter="enter('-3448854242059653434');" onmouseout="out('-3448854242059653434');" style="">  99      public static HbaseOutputFormatBuilder buildHbaseOutputFormat() {                                             </span>
<span class="21315192672457377" onmouseenter="enter('21315192672457377');" onmouseout="out('21315192672457377');" style=""> 100          return new HbaseOutputFormatBuilder();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101      }                                                                                                             </span>
<span  style=""> 102                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 103      @Override                                                                                                     </span>
<span class="-7846204402542625177" onmouseenter="enter('-7846204402542625177');" onmouseout="out('-7846204402542625177');" style=""> 104      public void configure(Configuration parameters) {                                                             </span>
<span class="4712095260235620502" onmouseenter="enter('4712095260235620502');" onmouseout="out('4712095260235620502');" style=""> 105          // 这里不要做耗时较长的操作，否则会导致AKKA通信超时                                                                             </span>
<span class="5146313286879962318" onmouseenter="enter('5146313286879962318');" onmouseout="out('5146313286879962318');" style=""> 106          // DO NOTHING                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107      }                                                                                                             </span>
<span  style=""> 108                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109      @Override                                                                                                     </span>
<span class="8196832651644244787" onmouseenter="enter('8196832651644244787');" onmouseout="out('8196832651644244787');" style=""> 110      public void open(int taskNumber, int numTasks) throws IOException {                                           </span>
<span class="4628329639510322151" onmouseenter="enter('4628329639510322151');" onmouseout="out('4628329639510322151');" style=""> 111          LOG.warn(&quot;---open---&quot;);                                                                                   </span>
<span class="4192166044761261281" onmouseenter="enter('4192166044761261281');" onmouseout="out('4192166044761261281');" style=""> 112          records = new ArrayList&lt;&gt;();                                                                              </span>
<span class="6170793632210655406" onmouseenter="enter('6170793632210655406');" onmouseout="out('6170793632210655406');" style=""> 113          conf = HBaseConfiguration.create();                                                                       </span>
<span class="-6659896539183463760" onmouseenter="enter('-6659896539183463760');" onmouseout="out('-6659896539183463760');" style=""> 114          openConn();                                                                                               </span>
<span class="9193105531813893118" onmouseenter="enter('9193105531813893118');" onmouseout="out('9193105531813893118');" style=""> 115          table = conn.getTable(TableName.valueOf(tableName));                                                      </span>
<span class="-8608917367020381250" onmouseenter="enter('-8608917367020381250');" onmouseout="out('-8608917367020381250');" style=""> 116          LOG.warn(&quot;---open end(get table from hbase) ---&quot;);                                                        </span>
<span class="7389701435636403373" onmouseenter="enter('7389701435636403373');" onmouseout="out('7389701435636403373');" style=""> 117          initMetric();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118      }                                                                                                             </span>
<span  style=""> 119                                                                                                                    </span>
<span class="4062302003302285733" onmouseenter="enter('4062302003302285733');" onmouseout="out('4062302003302285733');" style=""> 120      private void openConn() {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 121          try {                                                                                                     </span>
<span class="-5629300784711557707" onmouseenter="enter('-5629300784711557707');" onmouseout="out('-5629300784711557707');" style=""> 122              if (kerberosAuthEnable) {                                                                             </span>
<span class="-3576771688432142213" onmouseenter="enter('-3576771688432142213');" onmouseout="out('-3576771688432142213');" style=""> 123                  LOG.info(&quot;open kerberos conn&quot;);                                                                   </span>
<span class="7287859609811063282" onmouseenter="enter('7287859609811063282');" onmouseout="out('7287859609811063282');" style=""> 124                  openKerberosConn();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 125              } else {                                                                                              </span>
<span class="-8999147878413742067" onmouseenter="enter('-8999147878413742067');" onmouseout="out('-8999147878413742067');" style=""> 126                  LOG.info(&quot;open conn&quot;);                                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 127                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                      </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 128                  conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                            </span>
<span class="3081760951769415551" onmouseenter="enter('3081760951769415551');" onmouseout="out('3081760951769415551');" style=""> 129                  conn = ConnectionFactory.createConnection(conf);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 131          } catch (Exception e) {                                                                                   </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 132              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133          }                                                                                                         </span>
<span class="-3251827356232524015" onmouseenter="enter('-3251827356232524015');" onmouseout="out('-3251827356232524015');" style=""> 134          initScheduledTask(batchWaitInterval);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135      }                                                                                                             </span>
<span  style=""> 136                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 137      /**                                                                                                           </span>
<span class="-4618490323724809138" onmouseenter="enter('-4618490323724809138');" onmouseout="out('-4618490323724809138');" style=""> 138       * 初始化定时写入任务                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 139       *                                                                                                            </span>
<span class="-6019255784969734897" onmouseenter="enter('-6019255784969734897');" onmouseout="out('-6019255784969734897');" style=""> 140       * @param batchWaitInterval 定时任务时间                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 141       */                                                                                                           </span>
<span class="-4335191442342413864" onmouseenter="enter('-4335191442342413864');" onmouseout="out('-4335191442342413864');" style=""> 142      private void initScheduledTask(Long batchWaitInterval) {                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 143          try {                                                                                                     </span>
<span class="-6914796820410830425" onmouseenter="enter('-6914796820410830425');" onmouseout="out('-6914796820410830425');" style=""> 144              if (batchWaitInterval &gt; 0) {                                                                          </span>
<span class="-5496433596462609636" onmouseenter="enter('-5496433596462609636');" onmouseout="out('-5496433596462609636');" style=""> 145                  this.scheduler = new ScheduledThreadPoolExecutor(                                                 </span>
<span class="-2839476990451879288" onmouseenter="enter('-2839476990451879288');" onmouseout="out('-2839476990451879288');" style=""> 146                          1,                                                                                        </span>
<span class="7990791092299291147" onmouseenter="enter('7990791092299291147');" onmouseout="out('7990791092299291147');" style=""> 147                          new DTThreadFactory(&quot;hbase-batch-flusher&quot;)                                                </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 148                  );                                                                                                </span>
<span  style=""> 149                                                                                                                    </span>
<span class="-203393809629916131" onmouseenter="enter('-203393809629916131');" onmouseout="out('-203393809629916131');" style=""> 150                  this.scheduledFuture = this.scheduler.scheduleWithFixedDelay(                                     </span>
<span class="-950605123680687726" onmouseenter="enter('-950605123680687726');" onmouseout="out('-950605123680687726');" style=""> 151                          () -&gt; {                                                                                   </span>
<span class="4298051871776433706" onmouseenter="enter('4298051871776433706');" onmouseout="out('4298051871776433706');" style=""> 152                              synchronized (HbaseOutputFormat.this) {                                               </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 153                                  if (!records.isEmpty()) {                                                         </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 154                                      dealBatchOperation(records);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                              }                                                                                     </span>
<span class="-7130646397950156780" onmouseenter="enter('-7130646397950156780');" onmouseout="out('-7130646397950156780');" style=""> 157                          }, batchWaitInterval, batchWaitInterval, TimeUnit.MILLISECONDS                            </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 158                  );                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 160          } catch (Exception e) {                                                                                   </span>
<span class="-7977716518561108957" onmouseenter="enter('-7977716518561108957');" onmouseout="out('-7977716518561108957');" style=""> 161              LOG.error(&quot;init schedule task failed !&quot;);                                                             </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 162              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="554541339515108265" onmouseenter="enter('554541339515108265');" onmouseout="out('554541339515108265');" style=""> 166      private void openKerberosConn() throws Exception {                                                            </span>
<span class="6489255724038197665" onmouseenter="enter('6489255724038197665');" onmouseout="out('6489255724038197665');" style=""> 167          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_QUORUM, host);                                              </span>
<span class="5164590218595267016" onmouseenter="enter('5164590218595267016');" onmouseout="out('5164590218595267016');" style=""> 168          conf.set(HbaseConfigUtils.KEY_HBASE_ZOOKEEPER_ZNODE_QUORUM, zkParent);                                    </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-3993584407466944775" onmouseenter="enter('-3993584407466944775');" onmouseout="out('-3993584407466944775');" style=""> 170          LOG.info(&quot;kerberos config:{}&quot;, this.conf.toString());                                                     </span>
<span class="-2944487718950880875" onmouseenter="enter('-2944487718950880875');" onmouseout="out('-2944487718950880875');" style=""> 171          Preconditions.checkArgument(!StringUtils.isEmpty(clientPrincipal), &quot; clientPrincipal not null!&quot;);         </span>
<span class="-3588103214551804884" onmouseenter="enter('-3588103214551804884');" onmouseout="out('-3588103214551804884');" style=""> 172          Preconditions.checkArgument(!StringUtils.isEmpty(clientKeytabFile), &quot; clientKeytabFile not null!&quot;);       </span>
<span  style=""> 173                                                                                                                    </span>
<span class="5752672663198920938" onmouseenter="enter('5752672663198920938');" onmouseout="out('5752672663198920938');" style=""> 174          fillSyncKerberosConfig(conf, regionserverPrincipal, zookeeperSaslClient, securityKrb5Conf);               </span>
<span  style=""> 175                                                                                                                    </span>
<span class="3299193594689652046" onmouseenter="enter('3299193594689652046');" onmouseout="out('3299193594689652046');" style=""> 176          clientKeytabFile = System.getProperty(&quot;user.dir&quot;) + File.separator + clientKeytabFile;                    </span>
<span class="-222520208937860433" onmouseenter="enter('-222520208937860433');" onmouseout="out('-222520208937860433');" style=""> 177          clientPrincipal = !StringUtils.isEmpty(clientPrincipal) ? clientPrincipal : regionserverPrincipal;        </span>
<span  style=""> 178                                                                                                                    </span>
<span class="6535133710380467550" onmouseenter="enter('6535133710380467550');" onmouseout="out('6535133710380467550');" style=""> 179          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KEYTAB_FILE, clientKeytabFile);                                </span>
<span class="5528155500603713852" onmouseenter="enter('5528155500603713852');" onmouseout="out('5528155500603713852');" style=""> 180          conf.set(HbaseConfigUtils.KEY_HBASE_CLIENT_KERBEROS_PRINCIPAL, clientPrincipal);                          </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-4472198898489738455" onmouseenter="enter('-4472198898489738455');" onmouseout="out('-4472198898489738455');" style=""><abbr title=" 182          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clientKeytabFile);"> 182          UserGroupInformation userGroupInformation = HbaseConfigUtils.loginAndReturnUGI(conf, clientPrincipal, clie🔵</abbr></span>
<span class="-8276825221644989165" onmouseenter="enter('-8276825221644989165');" onmouseout="out('-8276825221644989165');" style=""> 183          org.apache.hadoop.conf.Configuration finalConf = conf;                                                    </span>
<span class="-4203568365593986839" onmouseenter="enter('-4203568365593986839');" onmouseout="out('-4203568365593986839');" style=""> 184          conn = userGroupInformation.doAs((PrivilegedAction&lt;Connection&gt;) () -&gt; {                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 185              try {                                                                                                 </span>
<span class="7307615995514536715" onmouseenter="enter('7307615995514536715');" onmouseout="out('7307615995514536715');" style=""> 186                  ScheduledChore authChore = AuthUtil.getAuthChore(finalConf);                                      </span>
<span class="-197847525249055305" onmouseenter="enter('-197847525249055305');" onmouseout="out('-197847525249055305');" style=""> 187                  if (authChore != null) {                                                                          </span>
<span class="-8246092021605355948" onmouseenter="enter('-8246092021605355948');" onmouseout="out('-8246092021605355948');" style=""> 188                      choreService = new ChoreService(&quot;hbaseKerberosSink&quot;);                                         </span>
<span class="-8826483668716034927" onmouseenter="enter('-8826483668716034927');" onmouseout="out('-8826483668716034927');" style=""> 189                      choreService.scheduleChore(authChore);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190                  }                                                                                                 </span>
<span  style=""> 191                                                                                                                    </span>
<span class="4154721590036532450" onmouseenter="enter('4154721590036532450');" onmouseout="out('4154721590036532450');" style=""> 192                  return ConnectionFactory.createConnection(finalConf);                                             </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 193              } catch (IOException e) {                                                                             </span>
<span class="-3157264661781249287" onmouseenter="enter('-3157264661781249287');" onmouseout="out('-3157264661781249287');" style=""> 194                  LOG.error(&quot;Get connection fail with config:{}&quot;, finalConf);                                       </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 195                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196              }                                                                                                     </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 197          });                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198      }                                                                                                             </span>
<span  style=""> 199                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 200      @Override                                                                                                     </span>
<span class="4451470640953786443" onmouseenter="enter('4451470640953786443');" onmouseout="out('4451470640953786443');" style=""> 201      public void writeRecord(Tuple2&lt;Boolean, Row&gt; record) {                                                        </span>
<span class="-6271552658445453889" onmouseenter="enter('-6271552658445453889');" onmouseout="out('-6271552658445453889');" style=""> 202          if (record.f0) {                                                                                          </span>
<span class="8741474660790294795" onmouseenter="enter('8741474660790294795');" onmouseout="out('8741474660790294795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -            if (this.batchSize != 0) {                                                                            </span>
<span class="-1412316093108805317" onmouseenter="enter('-1412316093108805317');" onmouseout="out('-1412316093108805317');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +            if (this.batchSize &gt; 1) {                                                                             </span>
<span class="-3915938943207675487" onmouseenter="enter('-3915938943207675487');" onmouseout="out('-3915938943207675487');" style=""> 205                  writeBatchRecord(record.f1);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 206              } else {                                                                                              </span>
<span class="-7335688184222713140" onmouseenter="enter('-7335688184222713140');" onmouseout="out('-7335688184222713140');" style=""> 207                  dealInsert(record.f1);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="7409854049023865450" onmouseenter="enter('7409854049023865450');" onmouseout="out('7409854049023865450');" style=""> 212      public void writeBatchRecord(Row row) {                                                                       </span>
<span class="-8489669256282756692" onmouseenter="enter('-8489669256282756692');" onmouseout="out('-8489669256282756692');" style=""> 213          records.add(row);                                                                                         </span>
<span class="7816961125917511950" onmouseenter="enter('7816961125917511950');" onmouseout="out('7816961125917511950');" style=""> 214          // 数据累计到batchSize之后开始处理                                                                                   </span>
<span class="-8421526056807747257" onmouseenter="enter('-8421526056807747257');" onmouseout="out('-8421526056807747257');" style=""> 215          if (records.size() == this.batchSize) {                                                                   </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 216              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218      }                                                                                                             </span>
<span  style=""> 219                                                                                                                    </span>
<span class="6155607686717210941" onmouseenter="enter('6155607686717210941');" onmouseout="out('6155607686717210941');" style=""> 220      protected synchronized void dealBatchOperation(List&lt;Row&gt; records) {                                           </span>
<span class="7079052564843470664" onmouseenter="enter('7079052564843470664');" onmouseout="out('7079052564843470664');" style=""> 221          // A null in the result array means that the call for that action failed, even after retries.             </span>
<span class="-7898978178383061123" onmouseenter="enter('-7898978178383061123');" onmouseout="out('-7898978178383061123');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -        Object[] results = new Object[records.size()];                                                            </span>
<span class="2702507020447237742" onmouseenter="enter('2702507020447237742');" onmouseout="out('2702507020447237742');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +        Object[] results = null;                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 224          try {                                                                                                     </span>
<span class="7465699806090575512" onmouseenter="enter('7465699806090575512');" onmouseout="out('7465699806090575512');" style=""> 225              List&lt;Put&gt; puts = new ArrayList&lt;&gt;();                                                                   </span>
<span class="-3359286951605927044" onmouseenter="enter('-3359286951605927044');" onmouseout="out('-3359286951605927044');" style=""> 226              for (Row record : records) {                                                                          </span>
<span class="4049132556821532406" onmouseenter="enter('4049132556821532406');" onmouseout="out('4049132556821532406');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -                puts.add(getPutByRow(record));                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -            }                                                                                                     </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +                Put put = getPutByRow(record);                                                                    </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +                if (put == null || put.isEmpty()) {                                                               </span>
<span class="-1237525694688178699" onmouseenter="enter('-1237525694688178699');" onmouseout="out('-1237525694688178699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +                    dealError(                                                                                    </span>
<span class="891149538086870920" onmouseenter="enter('891149538086870920');" onmouseout="out('891149538086870920');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                        record,                                                                                   </span>
<span class="3856437991371115709" onmouseenter="enter('3856437991371115709');" onmouseout="out('3856437991371115709');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +                        &quot;HBase put is empty, please check the record.&quot;);                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +                } else {                                                                                          </span>
<span class="4470807213303714255" onmouseenter="enter('4470807213303714255');" onmouseout="out('4470807213303714255');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +                    puts.add(put);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +            }                                                                                                     </span>
<span class="-5028617666301505856" onmouseenter="enter('-5028617666301505856');" onmouseout="out('-5028617666301505856');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +            results = new Object[puts.size()];                                                                    </span>



<span class="-5447344449678770351" onmouseenter="enter('-5447344449678770351');" onmouseout="out('-5447344449678770351');" style=""> 239              table.batch(puts, results);                                                                           </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-9056065712847920506" onmouseenter="enter('-9056065712847920506');" onmouseout="out('-9056065712847920506');" style=""> 241              // 打印结果                                                                                               </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 242              if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                               </span>
<span class="5281285154236320816" onmouseenter="enter('5281285154236320816');" onmouseout="out('5281285154236320816');" style=""> 243                  // 只打印最后一条数据                                                                                      </span>
<span class="2207421343662210234" onmouseenter="enter('2207421343662210234');" onmouseout="out('2207421343662210234');" style=""> 244                  LOG.info(records.get(records.size() - 1).toString());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245              }                                                                                                     </span>
<span class="-7907197852339825500" onmouseenter="enter('-7907197852339825500');" onmouseout="out('-7907197852339825500');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -        } catch (IOException | InterruptedException ignored) {                                                    </span>
<span class="8227086056609440437" onmouseenter="enter('8227086056609440437');" onmouseout="out('8227086056609440437');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +        } catch (IOException | InterruptedException e) {                                                          </span>
<span class="-6605187121122414151" onmouseenter="enter('-6605187121122414151');" onmouseout="out('-6605187121122414151');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +            // ignore exception                                                                                   </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 249          } finally {                                                                                               </span>
<span class="-475283866084030163" onmouseenter="enter('-475283866084030163');" onmouseout="out('-475283866084030163');" style=""> 250              // 判断数据是否插入成功                                                                                         </span>
<span class="-6482523650055084019" onmouseenter="enter('-6482523650055084019');" onmouseout="out('-6482523650055084019');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 251 -            for (int i = 0; i &lt; results.length; i++) {                                                            </span>
<span class="-3528902168646229933" onmouseenter="enter('-3528902168646229933');" onmouseout="out('-3528902168646229933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +            for (int i = 0; i &lt; Objects.requireNonNull(results).length; i++) {                                    </span>
<span class="-8845839500811999658" onmouseenter="enter('-8845839500811999658');" onmouseout="out('-8845839500811999658');" style=""> 253                  if (results[i] instanceof Exception) {                                                            </span>
<span class="4551324879963203709" onmouseenter="enter('4551324879963203709');" onmouseout="out('4551324879963203709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 254 -                    if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0) {                                </span>
<span class="-2151650842329164506" onmouseenter="enter('-2151650842329164506');" onmouseout="out('-2151650842329164506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 255 -                        LOG.error(&quot;Get dirty data: {}&quot;, records.get(i).toString());                               </span>
<span class="191608650467857411" onmouseenter="enter('191608650467857411');" onmouseout="out('191608650467857411');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 256 -                        LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause((Exception) results[i]));   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -                    }                                                                                             </span>

<span class="5031653099657510757" onmouseenter="enter('5031653099657510757');" onmouseout="out('5031653099657510757');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -                    // 脏数据记录                                                                                      </span>




<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 259 -                    outDirtyRecords.inc();                                                                        </span>
<span class="2374030727617048190" onmouseenter="enter('2374030727617048190');" onmouseout="out('2374030727617048190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +                    dealError(records.get(i), ExceptionTrace.traceOriginalCause((Exception) results[i]));         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 261                  } else {                                                                                          </span>
<span class="9060890565613975544" onmouseenter="enter('9060890565613975544');" onmouseout="out('9060890565613975544');" style=""> 262                      // 输出结果条数记录                                                                                   </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 263                      outRecords.inc();                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265              }                                                                                                     </span>
<span class="2830966572736035561" onmouseenter="enter('2830966572736035561');" onmouseout="out('2830966572736035561');" style=""> 266              // 添加完数据之后数据清空records                                                                                 </span>
<span class="1401638785724428327" onmouseenter="enter('1401638785724428327');" onmouseout="out('1401638785724428327');" style=""> 267              records.clear();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269      }                                                                                                             </span>
<span  style=""> 270                                                                                                                    </span>
<span class="-1273223453152305911" onmouseenter="enter('-1273223453152305911');" onmouseout="out('-1273223453152305911');" style=""> 271      protected void dealInsert(Row record) {                                                                       </span>
<span class="2286546344533770910" onmouseenter="enter('2286546344533770910');" onmouseout="out('2286546344533770910');" style=""> 272          Put put = getPutByRow(record);                                                                            </span>
<span class="-1610294336323547905" onmouseenter="enter('-1610294336323547905');" onmouseout="out('-1610294336323547905');" style=""> 273          if (put == null || put.isEmpty()) {                                                                       </span>
<span class="2721664433571413674" onmouseenter="enter('2721664433571413674');" onmouseout="out('2721664433571413674');" style=""> 274              // 记录脏数据                                                                                              </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 275              outDirtyRecords.inc();                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 276              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277          }                                                                                                         </span>
<span  style=""> 278                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 279          try {                                                                                                     </span>
<span class="-5039012024552744365" onmouseenter="enter('-5039012024552744365');" onmouseout="out('-5039012024552744365');" style=""> 280              table.put(put);                                                                                       </span>



<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 281          } catch (Exception e) {                                                                                   </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -            if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -                LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                               </span>
<span class="5284749126956950965" onmouseenter="enter('5284749126956950965');" onmouseout="out('5284749126956950965');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -                LOG.error(&quot;Error cause: &quot; + ExceptionTrace.traceOriginalCause(e));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -            }                                                                                                     </span>



<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -            outDirtyRecords.inc();                                                                                </span>
<span class="-8645058660559347801" onmouseenter="enter('-8645058660559347801');" onmouseout="out('-8645058660559347801');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +            dealError(record, ExceptionTrace.traceOriginalCause(e));                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288          }                                                                                                         </span>
<span  style=""> 289                                                                                                                    </span>
<span class="319547505475825588" onmouseenter="enter('319547505475825588');" onmouseout="out('319547505475825588');" style=""> 290          if (outRecords.getCount() % ROW_PRINT_FREQUENCY == 0) {                                                   </span>
<span class="8616688217303038940" onmouseenter="enter('8616688217303038940');" onmouseout="out('8616688217303038940');" style=""> 291              LOG.info(record.toString());                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292          }                                                                                                         </span>
<span class="-6698244658870964997" onmouseenter="enter('-6698244658870964997');" onmouseout="out('-6698244658870964997');" style=""> 293          outRecords.inc();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +                                                                                                                  </span>
<span class="-1029363078755938846" onmouseenter="enter('-1029363078755938846');" onmouseout="out('-1029363078755938846');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    private void dealError(Row record, String cause) {                                                            </span>
<span class="-1553153886547914794" onmouseenter="enter('-1553153886547914794');" onmouseout="out('-1553153886547914794');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +        if (outDirtyRecords.getCount() % DIRTY_PRINT_FREQUENCY == 0 || LOG.isDebugEnabled()) {                    </span>
<span class="2726121967123277907" onmouseenter="enter('2726121967123277907');" onmouseout="out('2726121967123277907');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +            LOG.error(&quot;Get dirty data: {}&quot;, record.toString());                                                   </span>
<span class="768105938836943395" onmouseenter="enter('768105938836943395');" onmouseout="out('768105938836943395');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +            LOG.error(&quot;Error cause: &quot; + cause);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +        }                                                                                                         </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +        outDirtyRecords.inc();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span  style=""> 303                                                                                                                    </span>
<span class="322210527588699897" onmouseenter="enter('322210527588699897');" onmouseout="out('322210527588699897');" style=""> 304      private Put getPutByRow(Row record) {                                                                         </span>
<span class="-515079666757889569" onmouseenter="enter('-515079666757889569');" onmouseout="out('-515079666757889569');" style=""> 305          String rowKey = buildRowKey(record);                                                                      </span>
<span class="-3042741861550188482" onmouseenter="enter('-3042741861550188482');" onmouseout="out('-3042741861550188482');" style=""> 306          if (StringUtils.isEmpty(rowKey)) {                                                                        </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 307              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308          }                                                                                                         </span>
<span class="6628374870071836816" onmouseenter="enter('6628374870071836816');" onmouseout="out('6628374870071836816');" style=""> 309          Put put = new Put(rowKey.getBytes());                                                                     </span>
<span class="6686885560976679770" onmouseenter="enter('6686885560976679770');" onmouseout="out('6686885560976679770');" style=""> 310          for (int i = 0; i &lt; record.getArity(); ++i) {                                                             </span>
<span class="-675729552049420308" onmouseenter="enter('-675729552049420308');" onmouseout="out('-675729552049420308');" style=""> 311              Object fieldVal = record.getField(i);                                                                 </span>
<span class="1446130737419320226" onmouseenter="enter('1446130737419320226');" onmouseout="out('1446130737419320226');" style=""> 312              if (fieldVal != null) {                                                                               </span>
<span class="-6034367363724242535" onmouseenter="enter('-6034367363724242535');" onmouseout="out('-6034367363724242535');" style=""> 313                  byte[] val = fieldVal.toString().getBytes();                                                      </span>
<span class="-8040922810430068483" onmouseenter="enter('-8040922810430068483');" onmouseout="out('-8040922810430068483');" style=""> 314                  byte[] cf = families[i].getBytes();                                                               </span>
<span class="7636323173174764508" onmouseenter="enter('7636323173174764508');" onmouseout="out('7636323173174764508');" style=""> 315                  byte[] qualifier = qualifiers[i].getBytes();                                                      </span>
<span  style=""> 316                                                                                                                    </span>
<span class="-8822567710193184850" onmouseenter="enter('-8822567710193184850');" onmouseout="out('-8822567710193184850');" style=""> 317                  put.addColumn(cf, qualifier, val);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319          }                                                                                                         </span>
<span class="-7214570880130349966" onmouseenter="enter('-7214570880130349966');" onmouseout="out('-7214570880130349966');" style=""> 320          return put;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span  style=""> 322                                                                                                                    </span>
<span class="3533350300985449860" onmouseenter="enter('3533350300985449860');" onmouseout="out('3533350300985449860');" style=""> 323      private String buildRowKey(Row record) {                                                                      </span>
<span class="-3715228676917734715" onmouseenter="enter('-3715228676917734715');" onmouseout="out('-3715228676917734715');" style=""> 324          String rowKeyValues = getRowKeyValues(record);                                                            </span>
<span class="-9169131587500721485" onmouseenter="enter('-9169131587500721485');" onmouseout="out('-9169131587500721485');" style=""> 325          // all rowkey not null                                                                                    </span>
<span class="-8521606061394371980" onmouseenter="enter('-8521606061394371980');" onmouseout="out('-8521606061394371980');" style=""> 326          if (StringUtils.isBlank(rowKeyValues)) {                                                                  </span>
<span class="2015691005096194193" onmouseenter="enter('2015691005096194193');" onmouseout="out('2015691005096194193');" style=""> 327              LOG.error(&quot;row key value must not null,record is ..{}&quot;, record);                                      </span>
<span class="999846223812588238" onmouseenter="enter('999846223812588238');" onmouseout="out('999846223812588238');" style=""> 328              outDirtyRecords.inc();                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 329              return &quot;&quot;;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330          }                                                                                                         </span>
<span class="-4383989179268143790" onmouseenter="enter('-4383989179268143790');" onmouseout="out('-4383989179268143790');" style=""> 331          return rowKeyValues;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332      }                                                                                                             </span>
<span  style=""> 333                                                                                                                    </span>
<span class="-9223023478746005439" onmouseenter="enter('-9223023478746005439');" onmouseout="out('-9223023478746005439');" style=""> 334      private String getRowKeyValues(Row record) {                                                                  </span>
<span class="7976995495490442143" onmouseenter="enter('7976995495490442143');" onmouseout="out('7976995495490442143');" style=""> 335          Map&lt;String, Object&gt; row = rowConvertMap(record);                                                          </span>
<span class="-3368450219794937309" onmouseenter="enter('-3368450219794937309');" onmouseout="out('-3368450219794937309');" style=""> 336          RowKeyBuilder rowKeyBuilder = new RowKeyBuilder();                                                        </span>
<span class="5825911174203046639" onmouseenter="enter('5825911174203046639');" onmouseout="out('5825911174203046639');" style=""> 337          rowKeyBuilder.init(rowkey);                                                                               </span>
<span class="-6547860369776062934" onmouseenter="enter('-6547860369776062934');" onmouseout="out('-6547860369776062934');" style=""> 338          return rowKeyBuilder.getRowKey(row);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339      }                                                                                                             </span>
<span  style=""> 340                                                                                                                    </span>
<span class="-377363125174840758" onmouseenter="enter('-377363125174840758');" onmouseout="out('-377363125174840758');" style=""> 341      private Map&lt;String, Object&gt; rowConvertMap(Row record) {                                                       </span>
<span class="7769636772805982456" onmouseenter="enter('7769636772805982456');" onmouseout="out('7769636772805982456');" style=""> 342          Map&lt;String, Object&gt; rowValue = Maps.newHashMap();                                                         </span>
<span class="-7667132822428998289" onmouseenter="enter('-7667132822428998289');" onmouseout="out('-7667132822428998289');" style=""> 343          for (int i = 0; i &lt; columnNames.length; i++) {                                                            </span>
<span class="-7245742525638291647" onmouseenter="enter('-7245742525638291647');" onmouseout="out('-7245742525638291647');" style=""> 344              rowValue.put(columnNames[i], record.getField(i));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345          }                                                                                                         </span>
<span class="1359792014511308450" onmouseenter="enter('1359792014511308450');" onmouseout="out('1359792014511308450');" style=""> 346          return rowValue;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347      }                                                                                                             </span>
<span  style=""> 348                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 349      @Override                                                                                                     </span>
<span class="4289344322261848589" onmouseenter="enter('4289344322261848589');" onmouseout="out('4289344322261848589');" style=""> 350      public synchronized void close() throws IOException {                                                         </span>
<span class="6765329276469905715" onmouseenter="enter('6765329276469905715');" onmouseout="out('6765329276469905715');" style=""> 351          if (closed) {                                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 352              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353          }                                                                                                         </span>
<span  style=""> 354                                                                                                                    </span>
<span class="5606214304023690467" onmouseenter="enter('5606214304023690467');" onmouseout="out('5606214304023690467');" style=""> 355          closed = true;                                                                                            </span>
<span class="-8934114146052196531" onmouseenter="enter('-8934114146052196531');" onmouseout="out('-8934114146052196531');" style=""> 356          if (!records.isEmpty()) {                                                                                 </span>
<span class="697731604482690959" onmouseenter="enter('697731604482690959');" onmouseout="out('697731604482690959');" style=""> 357              dealBatchOperation(records);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358          }                                                                                                         </span>
<span  style=""> 359                                                                                                                    </span>
<span class="-2111983699341206073" onmouseenter="enter('-2111983699341206073');" onmouseout="out('-2111983699341206073');" style=""> 360          if (scheduledFuture != null) {                                                                            </span>
<span class="-290660898949228596" onmouseenter="enter('-290660898949228596');" onmouseout="out('-290660898949228596');" style=""> 361              scheduledFuture.cancel(false);                                                                        </span>
<span class="-3716354873563067089" onmouseenter="enter('-3716354873563067089');" onmouseout="out('-3716354873563067089');" style=""> 362              if (scheduler != null) {                                                                              </span>
<span class="-2669964725291938364" onmouseenter="enter('-2669964725291938364');" onmouseout="out('-2669964725291938364');" style=""> 363                  scheduler.shutdownNow();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365          }                                                                                                         </span>
<span  style=""> 366                                                                                                                    </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style=""> 367          if (conn != null) {                                                                                       </span>
<span class="6797770436169560685" onmouseenter="enter('6797770436169560685');" onmouseout="out('6797770436169560685');" style=""> 368              conn.close();                                                                                         </span>
<span class="9019609077842850285" onmouseenter="enter('9019609077842850285');" onmouseout="out('9019609077842850285');" style=""> 369              conn = null;                                                                                          </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371      }                                                                                                             </span>
<span  style=""> 372                                                                                                                    </span>
<span class="-2023446651231142987" onmouseenter="enter('-2023446651231142987');" onmouseout="out('-2023446651231142987');" style=""> 373      private void fillSyncKerberosConfig(org.apache.hadoop.conf.Configuration config,                              </span>
<span class="8731157305284588824" onmouseenter="enter('8731157305284588824');" onmouseout="out('8731157305284588824');" style=""> 374                                          String regionserverPrincipal,                                             </span>
<span class="-4518776034393335788" onmouseenter="enter('-4518776034393335788');" onmouseout="out('-4518776034393335788');" style=""> 375                                          String zookeeperSaslClient,                                               </span>
<span class="-6794926968785423889" onmouseenter="enter('-6794926968785423889');" onmouseout="out('-6794926968785423889');" style=""> 376                                          String securityKrb5Conf) {                                                </span>
<span class="4377495895124869194" onmouseenter="enter('4377495895124869194');" onmouseout="out('4377495895124869194');" style=""> 377          if (StringUtils.isEmpty(regionserverPrincipal)) {                                                         </span>
<span class="3724848001183544861" onmouseenter="enter('3724848001183544861');" onmouseout="out('3724848001183544861');" style=""><abbr title=" 378              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos&quot;);"> 378              throw new IllegalArgumentException(&quot;Must provide regionserverPrincipal when authentication is Kerberos🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379          }                                                                                                         </span>
<span class="-2230677165953523488" onmouseenter="enter('-2230677165953523488');" onmouseout="out('-2230677165953523488');" style=""> 380          config.set(HbaseConfigUtils.KEY_HBASE_MASTER_KERBEROS_PRINCIPAL, regionserverPrincipal);                  </span>
<span class="7777619649023121850" onmouseenter="enter('7777619649023121850');" onmouseout="out('7777619649023121850');" style=""> 381          config.set(HbaseConfigUtils.KEY_HBASE_REGIONSERVER_KERBEROS_PRINCIPAL, regionserverPrincipal);            </span>
<span class="7110590210001604981" onmouseenter="enter('7110590210001604981');" onmouseout="out('7110590210001604981');" style=""> 382          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHORIZATION, &quot;true&quot;);                                    </span>
<span class="-6687260574647583036" onmouseenter="enter('-6687260574647583036');" onmouseout="out('-6687260574647583036');" style=""> 383          config.set(HbaseConfigUtils.KEY_HBASE_SECURITY_AUTHENTICATION, &quot;kerberos&quot;);                               </span>
<span  style=""> 384                                                                                                                    </span>
<span  style=""> 385                                                                                                                    </span>
<span class="8509923338862756882" onmouseenter="enter('8509923338862756882');" onmouseout="out('8509923338862756882');" style=""> 386          if (!StringUtils.isEmpty(zookeeperSaslClient)) {                                                          </span>
<span class="5909143731759943094" onmouseenter="enter('5909143731759943094');" onmouseout="out('5909143731759943094');" style=""> 387              System.setProperty(HbaseConfigUtils.KEY_ZOOKEEPER_SASL_CLIENT, zookeeperSaslClient);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388          }                                                                                                         </span>
<span  style=""> 389                                                                                                                    </span>
<span class="3369188219523843079" onmouseenter="enter('3369188219523843079');" onmouseout="out('3369188219523843079');" style=""> 390          if (!StringUtils.isEmpty(securityKrb5Conf)) {                                                             </span>
<span class="1319110120049057207" onmouseenter="enter('1319110120049057207');" onmouseout="out('1319110120049057207');" style=""> 391              String krb5ConfPath = System.getProperty(&quot;user.dir&quot;) + File.separator + securityKrb5Conf;             </span>
<span class="3437858609332103668" onmouseenter="enter('3437858609332103668');" onmouseout="out('3437858609332103668');" style=""> 392              LOG.info(&quot;krb5ConfPath:{}&quot;, krb5ConfPath);                                                            </span>
<span class="1350706264907978359" onmouseenter="enter('1350706264907978359');" onmouseout="out('1350706264907978359');" style=""> 393              System.setProperty(HbaseConfigUtils.KEY_JAVA_SECURITY_KRB5_CONF, krb5ConfPath);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395      }                                                                                                             </span>
<span  style=""> 396                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 397      @Override                                                                                                     </span>
<span class="6050671966953268025" onmouseenter="enter('6050671966953268025');" onmouseout="out('6050671966953268025');" style=""> 398      public String toString() {                                                                                    </span>
<span class="8514211630817342368" onmouseenter="enter('8514211630817342368');" onmouseout="out('8514211630817342368');" style=""> 399          return &quot;HbaseOutputFormat kerberos{&quot; +                                                                    </span>
<span class="-4980090060183439231" onmouseenter="enter('-4980090060183439231');" onmouseout="out('-4980090060183439231');" style=""> 400                  &quot;kerberosAuthEnable=&quot; + kerberosAuthEnable +                                                      </span>
<span class="-4827571705779505606" onmouseenter="enter('-4827571705779505606');" onmouseout="out('-4827571705779505606');" style=""> 401                  &quot;, regionserverKeytabFile=&#x27;&quot; + regionserverKeytabFile + &#x27;\&#x27;&#x27; +                                    </span>
<span class="-7466008524266243055" onmouseenter="enter('-7466008524266243055');" onmouseout="out('-7466008524266243055');" style=""> 402                  &quot;, regionserverPrincipal=&#x27;&quot; + regionserverPrincipal + &#x27;\&#x27;&#x27; +                                      </span>
<span class="-254395438867662671" onmouseenter="enter('-254395438867662671');" onmouseout="out('-254395438867662671');" style=""> 403                  &quot;, securityKrb5Conf=&#x27;&quot; + securityKrb5Conf + &#x27;\&#x27;&#x27; +                                                </span>
<span class="6200113852601796990" onmouseenter="enter('6200113852601796990');" onmouseout="out('6200113852601796990');" style=""> 404                  &quot;, zookeeperSaslClient=&#x27;&quot; + zookeeperSaslClient + &#x27;\&#x27;&#x27; +                                          </span>
<span class="-8766147650563752448" onmouseenter="enter('-8766147650563752448');" onmouseout="out('-8766147650563752448');" style=""> 405                  &quot;, clientPrincipal=&#x27;&quot; + clientPrincipal + &#x27;\&#x27;&#x27; +                                                  </span>
<span class="-5562923352688486529" onmouseenter="enter('-5562923352688486529');" onmouseout="out('-5562923352688486529');" style=""> 406                  &quot;, clientKeytabFile=&#x27;&quot; + clientKeytabFile + &#x27;\&#x27;&#x27; +                                                </span>
<span class="-5278654253341208026" onmouseenter="enter('-5278654253341208026');" onmouseout="out('-5278654253341208026');" style=""> 407                  &quot;, batchSize=&#x27;&quot; + batchSize + &#x27;\&#x27;&#x27; +                                                              </span>
<span class="3224050433214815036" onmouseenter="enter('3224050433214815036');" onmouseout="out('3224050433214815036');" style=""> 408                  &quot;, batchWaitInterval=&#x27;&quot; + batchWaitInterval + &#x27;\&#x27;&#x27; +                                              </span>
<span class="5076852287940809349" onmouseenter="enter('5076852287940809349');" onmouseout="out('5076852287940809349');" style=""> 409                  &#x27;}&#x27;;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410      }                                                                                                             </span>
<span  style=""> 411                                                                                                                    </span>
<span class="6609687680510232421" onmouseenter="enter('6609687680510232421');" onmouseout="out('6609687680510232421');" style=""> 412      public static class HbaseOutputFormatBuilder {                                                                </span>
<span  style=""> 413                                                                                                                    </span>
<span class="2017005579571175361" onmouseenter="enter('2017005579571175361');" onmouseout="out('2017005579571175361');" style=""> 414          private final HbaseOutputFormat format;                                                                   </span>
<span  style=""> 415                                                                                                                    </span>
<span class="-7562467453717182807" onmouseenter="enter('-7562467453717182807');" onmouseout="out('-7562467453717182807');" style=""> 416          private HbaseOutputFormatBuilder() {                                                                      </span>
<span class="3872747668781934738" onmouseenter="enter('3872747668781934738');" onmouseout="out('3872747668781934738');" style=""> 417              format = new HbaseOutputFormat();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418          }                                                                                                         </span>
<span  style=""> 419                                                                                                                    </span>
<span class="-6830794828322536987" onmouseenter="enter('-6830794828322536987');" onmouseout="out('-6830794828322536987');" style=""> 420          public HbaseOutputFormatBuilder setHost(String host) {                                                    </span>
<span class="1098268190258995419" onmouseenter="enter('1098268190258995419');" onmouseout="out('1098268190258995419');" style=""> 421              format.host = host;                                                                                   </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 422              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423          }                                                                                                         </span>
<span  style=""> 424                                                                                                                    </span>
<span class="-8555108270714797513" onmouseenter="enter('-8555108270714797513');" onmouseout="out('-8555108270714797513');" style=""> 425          public HbaseOutputFormatBuilder setZkParent(String parent) {                                              </span>
<span class="-1988836191988732683" onmouseenter="enter('-1988836191988732683');" onmouseout="out('-1988836191988732683');" style=""> 426              format.zkParent = parent;                                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 427              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428          }                                                                                                         </span>
<span  style=""> 429                                                                                                                    </span>
<span  style=""> 430                                                                                                                    </span>
<span class="-7464087989666634359" onmouseenter="enter('-7464087989666634359');" onmouseout="out('-7464087989666634359');" style=""> 431          public HbaseOutputFormatBuilder setTable(String tableName) {                                              </span>
<span class="-1585853008866177938" onmouseenter="enter('-1585853008866177938');" onmouseout="out('-1585853008866177938');" style=""> 432              format.tableName = tableName;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 433              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 434          }                                                                                                         </span>
<span  style=""> 435                                                                                                                    </span>
<span class="-5595599694738301687" onmouseenter="enter('-5595599694738301687');" onmouseout="out('-5595599694738301687');" style=""> 436          public HbaseOutputFormatBuilder setRowkey(String rowkey) {                                                </span>
<span class="8397273627698640768" onmouseenter="enter('8397273627698640768');" onmouseout="out('8397273627698640768');" style=""> 437              format.rowkey = rowkey;                                                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 438              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439          }                                                                                                         </span>
<span  style=""> 440                                                                                                                    </span>
<span class="4148616573264398915" onmouseenter="enter('4148616573264398915');" onmouseout="out('4148616573264398915');" style=""> 441          public HbaseOutputFormatBuilder setColumnNames(String[] columnNames) {                                    </span>
<span class="8111181380495818076" onmouseenter="enter('8111181380495818076');" onmouseout="out('8111181380495818076');" style=""> 442              format.columnNames = columnNames;                                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 443              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444          }                                                                                                         </span>
<span  style=""> 445                                                                                                                    </span>
<span class="6177421549041509504" onmouseenter="enter('6177421549041509504');" onmouseout="out('6177421549041509504');" style=""> 446          public HbaseOutputFormatBuilder setColumnNameFamily(Map&lt;String, String&gt; columnNameFamily) {               </span>
<span class="6646032535860483967" onmouseenter="enter('6646032535860483967');" onmouseout="out('6646032535860483967');" style=""> 447              format.columnNameFamily = columnNameFamily;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 448              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449          }                                                                                                         </span>
<span  style=""> 450                                                                                                                    </span>
<span class="-8744098439233286762" onmouseenter="enter('-8744098439233286762');" onmouseout="out('-8744098439233286762');" style=""> 451          public HbaseOutputFormatBuilder setKerberosAuthEnable(boolean kerberosAuthEnable) {                       </span>
<span class="-6043966616649082889" onmouseenter="enter('-6043966616649082889');" onmouseout="out('-6043966616649082889');" style=""> 452              format.kerberosAuthEnable = kerberosAuthEnable;                                                       </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 453              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 454          }                                                                                                         </span>
<span  style=""> 455                                                                                                                    </span>
<span class="-3553114788626910628" onmouseenter="enter('-3553114788626910628');" onmouseout="out('-3553114788626910628');" style=""> 456          public HbaseOutputFormatBuilder setRegionserverKeytabFile(String regionserverKeytabFile) {                </span>
<span class="2216712614208739913" onmouseenter="enter('2216712614208739913');" onmouseout="out('2216712614208739913');" style=""> 457              format.regionserverKeytabFile = regionserverKeytabFile;                                               </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 458              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 459          }                                                                                                         </span>
<span  style=""> 460                                                                                                                    </span>
<span class="-7259776484952634007" onmouseenter="enter('-7259776484952634007');" onmouseout="out('-7259776484952634007');" style=""> 461          public HbaseOutputFormatBuilder setRegionserverPrincipal(String regionserverPrincipal) {                  </span>
<span class="8809727470639175561" onmouseenter="enter('8809727470639175561');" onmouseout="out('8809727470639175561');" style=""> 462              format.regionserverPrincipal = regionserverPrincipal;                                                 </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 463              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464          }                                                                                                         </span>
<span  style=""> 465                                                                                                                    </span>
<span class="2844526367964638113" onmouseenter="enter('2844526367964638113');" onmouseout="out('2844526367964638113');" style=""> 466          public HbaseOutputFormatBuilder setSecurityKrb5Conf(String securityKrb5Conf) {                            </span>
<span class="8278303195769823444" onmouseenter="enter('8278303195769823444');" onmouseout="out('8278303195769823444');" style=""> 467              format.securityKrb5Conf = securityKrb5Conf;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 468              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469          }                                                                                                         </span>
<span  style=""> 470                                                                                                                    </span>
<span class="2352594464201684244" onmouseenter="enter('2352594464201684244');" onmouseout="out('2352594464201684244');" style=""> 471          public HbaseOutputFormatBuilder setZookeeperSaslClient(String zookeeperSaslClient) {                      </span>
<span class="-5432599759509038586" onmouseenter="enter('-5432599759509038586');" onmouseout="out('-5432599759509038586');" style=""> 472              format.zookeeperSaslClient = zookeeperSaslClient;                                                     </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 473              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474          }                                                                                                         </span>
<span  style=""> 475                                                                                                                    </span>
<span class="8307408215509482891" onmouseenter="enter('8307408215509482891');" onmouseout="out('8307408215509482891');" style=""> 476          public HbaseOutputFormatBuilder setClientPrincipal(String clientPrincipal) {                              </span>
<span class="5335415983234142155" onmouseenter="enter('5335415983234142155');" onmouseout="out('5335415983234142155');" style=""> 477              format.clientPrincipal = clientPrincipal;                                                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 478              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479          }                                                                                                         </span>
<span  style=""> 480                                                                                                                    </span>
<span class="-3995121798707011830" onmouseenter="enter('-3995121798707011830');" onmouseout="out('-3995121798707011830');" style=""> 481          public HbaseOutputFormatBuilder setClientKeytabFile(String clientKeytabFile) {                            </span>
<span class="474412143157678909" onmouseenter="enter('474412143157678909');" onmouseout="out('474412143157678909');" style=""> 482              format.clientKeytabFile = clientKeytabFile;                                                           </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 483              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484          }                                                                                                         </span>
<span  style=""> 485                                                                                                                    </span>





<span class="4023087602225622105" onmouseenter="enter('4023087602225622105');" onmouseout="out('4023087602225622105');" style=""> 486          public HbaseOutputFormatBuilder setBatchSize(Integer batchSize) {                                         </span>
<span class="-6323290766219617895" onmouseenter="enter('-6323290766219617895');" onmouseout="out('-6323290766219617895');" style=""> 487              format.batchSize = batchSize;                                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 488              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489          }                                                                                                         </span>
<span  style=""> 490                                                                                                                    </span>
<span class="-5917768840410662758" onmouseenter="enter('-5917768840410662758');" onmouseout="out('-5917768840410662758');" style=""> 491          public HbaseOutputFormatBuilder setBatchWaitInterval(Long batchWaitInterval) {                            </span>
<span class="7659700979146023520" onmouseenter="enter('7659700979146023520');" onmouseout="out('7659700979146023520');" style=""> 492              format.batchWaitInterval = batchWaitInterval;                                                         </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 493              return this;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494          }                                                                                                         </span>
<span  style=""> 495                                                                                                                    </span>
<span class="-1633266557830705366" onmouseenter="enter('-1633266557830705366');" onmouseout="out('-1633266557830705366');" style=""> 496          public HbaseOutputFormat finish() {                                                                       </span>
<span class="-1917798064700757305" onmouseenter="enter('-1917798064700757305');" onmouseout="out('-1917798064700757305');" style=""> 497              Preconditions.checkNotNull(format.host, &quot;zookeeperQuorum should be specified&quot;);                       </span>
<span class="-3187960007215777002" onmouseenter="enter('-3187960007215777002');" onmouseout="out('-3187960007215777002');" style=""> 498              Preconditions.checkNotNull(format.tableName, &quot;tableName should be specified&quot;);                        </span>
<span class="6677692882044062526" onmouseenter="enter('6677692882044062526');" onmouseout="out('6677692882044062526');" style=""> 499              Preconditions.checkNotNull(format.columnNames, &quot;columnNames should be specified&quot;);                    </span>
<span class="9155241339104110992" onmouseenter="enter('9155241339104110992');" onmouseout="out('9155241339104110992');" style=""> 500              Preconditions.checkArgument(format.columnNames.length != 0, &quot;columnNames length should not be zero&quot;); </span>
<span  style=""> 501                                                                                                                    </span>
<span class="1476072603477685402" onmouseenter="enter('1476072603477685402');" onmouseout="out('1476072603477685402');" style=""> 502              String[] families = new String[format.columnNames.length];                                            </span>
<span class="-5072957928321019917" onmouseenter="enter('-5072957928321019917');" onmouseout="out('-5072957928321019917');" style=""> 503              String[] qualifiers = new String[format.columnNames.length];                                          </span>
<span  style=""> 504                                                                                                                    </span>
<span class="6925529885431926690" onmouseenter="enter('6925529885431926690');" onmouseout="out('6925529885431926690');" style=""> 505              if (format.columnNameFamily != null) {                                                                </span>
<span class="-3782457040151504241" onmouseenter="enter('-3782457040151504241');" onmouseout="out('-3782457040151504241');" style=""> 506                  List&lt;String&gt; keyList = new LinkedList&lt;&gt;(format.columnNameFamily.keySet());                        </span>
<span class="95947244594256569" onmouseenter="enter('95947244594256569');" onmouseout="out('95947244594256569');" style=""> 507                  String[] columns = keyList.toArray(new String[0]);                                                </span>
<span class="-948234391288284732" onmouseenter="enter('-948234391288284732');" onmouseout="out('-948234391288284732');" style=""> 508                  for (int i = 0; i &lt; columns.length; ++i) {                                                        </span>
<span class="5163422670922721635" onmouseenter="enter('5163422670922721635');" onmouseout="out('5163422670922721635');" style=""> 509                      String col = columns[i];                                                                      </span>
<span class="3292823380718708749" onmouseenter="enter('3292823380718708749');" onmouseout="out('3292823380718708749');" style=""> 510                      String[] part = col.split(&quot;:&quot;);                                                               </span>
<span class="-8307009578578424577" onmouseenter="enter('-8307009578578424577');" onmouseout="out('-8307009578578424577');" style=""> 511                      families[i] = part[0];                                                                        </span>
<span class="6086937559882281278" onmouseenter="enter('6086937559882281278');" onmouseout="out('6086937559882281278');" style=""> 512                      qualifiers[i] = part[1];                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 514              }                                                                                                     </span>
<span class="7917534943437956950" onmouseenter="enter('7917534943437956950');" onmouseout="out('7917534943437956950');" style=""> 515              format.families = families;                                                                           </span>
<span class="-1525176204294321088" onmouseenter="enter('-1525176204294321088');" onmouseout="out('-1525176204294321088');" style=""> 516              format.qualifiers = qualifiers;                                                                       </span>
<span  style=""> 517                                                                                                                    </span>
<span class="9058009825496417823" onmouseenter="enter('9058009825496417823');" onmouseout="out('9058009825496417823');" style=""> 518              return format;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            