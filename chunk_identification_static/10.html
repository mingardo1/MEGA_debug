<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>10</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    10
                    <a href="9.html">prev</a>
                    <a href="11.html">next</a>
                    <a href="10_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_651db90b99455d330ec1889f5728cc2d0742d9f9_app/src/main/java/com/arialyy/simple/core/download/HighestPriorityActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;651db90b99455d330ec1889f5728cc2d0742d9f9:app/src/main/java/com/arialyy/simple/core/download/HighestPriorityActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;651db90b99455d330ec1889f5728cc2d0742d9f9^1:app/src/main/java/com/arialyy/simple/core/download/HighestPriorityActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;651db90b99455d330ec1889f5728cc2d0742d9f9^2:app/src/main/java/com/arialyy/simple/core/download/HighestPriorityActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;fdb607e10faf4051fac8bac66cb5751ec828ae36:app/src/main/java/com/arialyy/simple/core/download/HighestPriorityActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.simple.core.download;
  17 
  18 import android.os.Bundle;
  19 import android.os.Environment;
  20 import android.support.v7.widget.LinearLayoutManager;
  21 import android.support.v7.widget.RecyclerView;
  22 import android.view.Menu;
  23 import android.view.MenuItem;
  24 import android.view.View;
  25 import android.widget.Button;
  26 import android.widget.TextView;
  27 import com.arialyy.annotations.Download;
  28 import com.arialyy.aria.core.Aria;
  29 import com.arialyy.aria.core.download.DownloadEntity;
  30 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import com.arialyy.aria.core.download.DownloadTask;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import com.arialyy.aria.core.inf.AbsEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import com.arialyy.aria.core.inf.IEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37 import com.arialyy.simple.core.download.multi_download.DownloadAdapter;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 import com.arialyy.simple.util.AppUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import java.util.ArrayList;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import java.util.HashSet;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import java.util.List;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44 import java.util.Set;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47  * Created by lyy on 2017/6/2.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48  * 最高优先级任务Demo</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49  */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50 public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51   private HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52   private Button mStart;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53   private Button mStop;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54   private Button mCancel;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55   private TextView mSize;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56   private TextView mSpeed;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57   private RecyclerView mList;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58   private DownloadEntity mEntity;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60   private String mTaskName = &quot;光明大陆&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61   private static final String DOWNLOAD_URL =</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  62       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;">  62       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee🔵</abbr></span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63   private DownloadAdapter mAdapter;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64   private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65   private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68     return R.layout.activity_highest_priority;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72     super.init(savedInstanceState);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73     mPb = findViewById(R.id.progressBar);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74     mStart = findViewById(R.id.start);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75     mStop = findViewById(R.id.stop);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     mCancel = findViewById(R.id.cancel);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77     mSize = findViewById(R.id.size);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78     mSpeed = findViewById(R.id.speed);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79     mList = findViewById(R.id.list);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81     setTitle(&quot;最高优先级任务&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82     getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83     initWidget();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84     Aria.download(this).register();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87   private void initWidget() {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88     mEntity = Aria.download(this).getFirstDownloadEntity(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90     if (mEntity != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91       mPb.setProgress(mEntity.getPercent());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92       if (mEntity.getState() == IEntity.STATE_STOP) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93         mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94         mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95         setBtState(true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96       } else if (mEntity.getState() == IEntity.STATE_RUNNING) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97         setBtState(false);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99       mSize.setText(mEntity.getConvertFileSize());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102     List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103     if (temp != null &amp;&amp; !temp.isEmpty()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104       for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         if (entity.getUrl().equals(DOWNLOAD_URL)) continue;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106         mData.add(entity);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107         mRecord.add(entity.getUrl());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108       }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110     mAdapter = new DownloadAdapter(this, mData);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111     mList.setLayoutManager(new LinearLayoutManager(this));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112     mList.setAdapter(mAdapter);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115   @Override public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116     getMenuInflater().inflate(R.menu.menu_highest_priority, menu);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117     return super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120   @Override public boolean onMenuItemClick(MenuItem item) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121     switch (item.getItemId()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122       case R.id.add_task:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123         List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124         for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125           String url = entity.getUrl();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126           if (mRecord.contains(url)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127             continue;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128           }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129           mAdapter.addDownloadEntity(entity);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130           mRecord.add(url);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132         mAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 133         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 134       case R.id.help:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 135         String title = &quot;最高优先级任务介绍&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 136         String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 137             + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 138             + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139             + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140             + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141             + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142             + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143         showMsgDialog(title, msg);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146     return true;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147   }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 149   public void onClick(View view) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 150     switch (view.getId()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 151       case R.id.start:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152         if (AppUtil.chekEntityValid(mEntity)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 153           Aria.download(this)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 154               .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 155               .setFilePath(Environment.getExternalStorageDirectory().getPath()</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156                   + &quot;/Download/&quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 157                   + mTaskName</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 158                   + &quot;.apk&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 159               .setHighestPriority();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 160         } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 161           Aria.download(this).load(mEntity.getId()).resume();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163         ((TextView) view).setText(getString(R.string.stop));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165       case R.id.stop:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166         if (AppUtil.chekEntityValid(mEntity)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167           Aria.download(this).load(mEntity.getId()).stop();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169         ((TextView) view).setText(getString(R.string.resume));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         break;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171       case R.id.cancel:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172         if (AppUtil.chekEntityValid(mEntity)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173           Aria.download(this).load(mEntity.getId()).cancel();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174         }</span>
 175 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176 import com.arialyy.aria.core.download.DownloadTarget;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177 import com.arialyy.aria.core.download.DownloadTask;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178 import com.arialyy.aria.core.inf.AbsEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179 import com.arialyy.aria.core.inf.IEntity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184 import com.arialyy.simple.core.download.multi_download.DownloadAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187 import java.util.HashSet;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189 import java.util.Set;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192  * Created by lyy on 2017/6/2.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193  * 最高优先级任务Demo</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195 public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196   private HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197   private Button mStart;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198   private Button mStop;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199   private Button mCancel;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200   private TextView mSize;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201   private TextView mSpeed;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202   private RecyclerView mList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204   private String mTaskName = &quot;光明大陆&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205   private static final String DOWNLOAD_URL =</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 206       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;"> 206       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207   private DownloadAdapter mAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208   private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209   private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212     return R.layout.activity_highest_priority;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216     super.init(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217     mPb = findViewById(R.id.progressBar);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218     mStart = findViewById(R.id.start);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219     mStop = findViewById(R.id.stop);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220     mCancel = findViewById(R.id.cancel);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221     mSize = findViewById(R.id.size);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222     mSpeed = findViewById(R.id.speed);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223     mList = findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225     setTitle(&quot;最高优先级任务&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227     initWidget();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228     Aria.download(this).register();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231   private void initWidget() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233     mPb.setProgress(target.getPercent());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234     if (target.getTaskState() == IEntity.STATE_STOP) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235       mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237       setBtState(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238     } else if (target.isRunning()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239       setBtState(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241     mSize.setText(target.getConvertFileSize());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242     List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243     if (temp != null &amp;&amp; !temp.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244       for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245         if (entity.getUrl().equals(DOWNLOAD_URL)) continue;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         mData.add(entity);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247         mRecord.add(entity.getUrl());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248       }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250     mAdapter = new DownloadAdapter(this, mData);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251     mList.setLayoutManager(new LinearLayoutManager(this));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252     mList.setAdapter(mAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255   @Override public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256     getMenuInflater().inflate(R.menu.menu_highest_priority, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257     return super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260   @Override public boolean onMenuItemClick(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261     switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262       case R.id.add_task:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264         for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265           String url = entity.getUrl();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266           if (mRecord.contains(url)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267             continue;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268           }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269           mAdapter.addDownloadEntity(entity);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270           mRecord.add(url);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272         mAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274       case R.id.help:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275         String title = &quot;最高优先级任务介绍&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277             + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279             + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280             + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281             + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282             + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         showMsgDialog(title, msg);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286     return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287   }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289   public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290     switch (view.getId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291       case R.id.start:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294           Aria.download(this)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295               .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296               .setFilePath(Environment.getExternalStorageDirectory().getPath()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297                   + &quot;/Download/&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                   + mTaskName</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                   + &quot;.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300               .setHighestPriority();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302           Aria.download(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305       case R.id.stop:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306         Aria.download(this).load(DOWNLOAD_URL).pause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307         break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308       case R.id.cancel:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309         Aria.download(this).load(DOWNLOAD_URL).cancel();</span>
 310 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311 import com.arialyy.aria.core.download.DownloadTarget;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312 import com.arialyy.aria.core.download.DownloadTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313 import com.arialyy.aria.core.inf.AbsEntity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314 import com.arialyy.aria.core.inf.IEntity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315 import com.arialyy.frame.util.show.L;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316 import com.arialyy.simple.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317 import com.arialyy.simple.base.BaseActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318 import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319 import com.arialyy.simple.core.download.multi_download.DownloadAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322 import java.util.HashSet;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 import java.util.Set;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327  * Created by lyy on 2017/6/2.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328  * 最高优先级任务Demo</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330 public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331   private HorizontalProgressBarWithNumber mPb;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332   private Button mStart;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333   private Button mStop;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334   private Button mCancel;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335   private TextView mSize;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336   private TextView mSpeed;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337   private RecyclerView mList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339   private String mTaskName = &quot;光明大陆&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340   private static final String DOWNLOAD_URL =</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 341       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;"> 341       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee🔵</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342   private DownloadAdapter mAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343   private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344   private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346   @Override protected int setLayoutId() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347     return R.layout.activity_highest_priority;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348   }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350   @Override protected void init(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351     super.init(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352     mPb = findViewById(R.id.progressBar);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353     mStart = findViewById(R.id.start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354     mStop = findViewById(R.id.stop);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355     mCancel = findViewById(R.id.cancel);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356     mSize = findViewById(R.id.size);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357     mSpeed = findViewById(R.id.speed);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358     mList = findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360     setTitle(&quot;最高优先级任务&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361     getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362     initWidget();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363     Aria.download(this).register();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364   }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366   private void initWidget() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368     mPb.setProgress(target.getPercent());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369     if (target.getTaskState() == IEntity.STATE_STOP) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370       mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372       setBtState(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373     } else if (target.isRunning()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374       setBtState(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376     mSize.setText(target.getConvertFileSize());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377     List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378     if (temp != null &amp;&amp; !temp.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379       for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380         if (entity.getUrl().equals(DOWNLOAD_URL)) continue;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381         mData.add(entity);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382         mRecord.add(entity.getUrl());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383       }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385     mAdapter = new DownloadAdapter(this, mData);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386     mList.setLayoutManager(new LinearLayoutManager(this));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     mList.setAdapter(mAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388   }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390   @Override public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391     getMenuInflater().inflate(R.menu.menu_highest_priority, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392     return super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393   }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395   @Override public boolean onMenuItemClick(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396     switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397       case R.id.add_task:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398         List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399         for (DownloadEntity entity : temp) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400           String url = entity.getUrl();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401           if (mRecord.contains(url)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402             continue;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403           }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404           mAdapter.addDownloadEntity(entity);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405           mRecord.add(url);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407         mAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408         break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409       case R.id.help:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410         String title = &quot;最高优先级任务介绍&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411         String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412             + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413             + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414             + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415             + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416             + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417             + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418         showMsgDialog(title, msg);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419         break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421     return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422   }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424   public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425     switch (view.getId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426       case R.id.start:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427         String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429           Aria.download(this)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430               .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431               .setFilePath(Environment.getExternalStorageDirectory().getPath()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                   + &quot;/Download/&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433                   + mTaskName</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434                   + &quot;.apk&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435               .setHighestPriority();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436         } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437           Aria.download(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440       case R.id.stop:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         Aria.download(this).load(DOWNLOAD_URL).pause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442         break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443       case R.id.cancel:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444         Aria.download(this).load(DOWNLOAD_URL).cancel();</span>
 445 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 446         break;
 447     }
 448   }
 449 
 450   /**
 451    * 设置start 和 stop 按钮状态
 452    */
 453   private void setBtState(boolean state) {
 454     mStart.setEnabled(state);
 455     mStop.setEnabled(!state);
 456   }
 457 
 458   @Download.onPre public void onPre(DownloadTask task) {
 459     mAdapter.updateState(task.getDownloadEntity());
 460   }
 461 
 462   @Download.onTaskPre public void onTaskPre(DownloadTask task) {
 463     if (task.getKey().equals(DOWNLOAD_URL)) {
 464       mSize.setText(task.getConvertFileSize());
 465     }
 466     mAdapter.updateState(task.getDownloadEntity());
 467   }
 468 
 469   @Download.onTaskStart public void onTaskStart(DownloadTask task) {
 470     if (task.getKey().equals(DOWNLOAD_URL)) {
 471       setBtState(false);
 472     }
 473     mAdapter.updateState(task.getDownloadEntity());
 474   }
 475 
 476   @Download.onTaskResume public void onTaskResume(DownloadTask task) {
 477     if (task.getKey().equals(DOWNLOAD_URL)) {
 478       setBtState(false);
 479     }
 480     mAdapter.updateState(task.getDownloadEntity());
 481   }
 482 
 483   @Download.onTaskStop public void onTaskStop(DownloadTask task) {
 484     if (task.getKey().equals(DOWNLOAD_URL)) {
 485       setBtState(true);
 486       mStart.setText(&quot;恢复&quot;);
 487       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 488     }
 489     mAdapter.updateState(task.getDownloadEntity());
 490   }
 491 
 492   @Download.onTaskCancel public void onTaskCancel(DownloadTask task) {
 493     if (task.getKey().equals(DOWNLOAD_URL)) {
 494       setBtState(true);
 495       mStart.setText(&quot;开始&quot;);
 496       mPb.setProgress(0);
 497     }
 498     mAdapter.updateState(task.getDownloadEntity());
 499   }
 500 
 501   @Download.onTaskFail public void onTaskFail(DownloadTask task) {
 502     if (task.getKey().equals(DOWNLOAD_URL)) {
 503       setBtState(true);
 504     } else {
 505       L.d(TAG, &quot;download fail【&quot; + task.getKey() + &quot;】&quot;);
 506     }
 507   }
 508 
 509   @Download.onTaskComplete public void onTaskComplete(DownloadTask task) {
 510     if (task.getKey().equals(DOWNLOAD_URL)) {
 511       setBtState(true);
 512       mStart.setText(&quot;重新开始&quot;);
 513       mStart.setTextColor(getResources().getColor(android.R.color.holo_green_light));
 514       mPb.setProgress(100);
 515     }
 516     mAdapter.updateState(task.getDownloadEntity());
 517   }
 518 
 519   @Download.onTaskRunning public void onTaskRunning(DownloadTask task) {
 520     if (task.getKey().equals(DOWNLOAD_URL)) {
 521       mPb.setProgress(task.getPercent());
 522       mSpeed.setText(task.getConvertSpeed());
 523     }
 524     mAdapter.setProgress(task.getDownloadEntity());
 525   }
 526 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.simple.core.download;
  17 
  18 import android.os.Bundle;
  19 import android.os.Environment;
  20 import android.support.v7.widget.LinearLayoutManager;
  21 import android.support.v7.widget.RecyclerView;
  22 import android.view.Menu;
  23 import android.view.MenuItem;
  24 import android.view.View;
  25 import android.widget.Button;
  26 import android.widget.TextView;
  27 import com.arialyy.annotations.Download;
  28 import com.arialyy.aria.core.Aria;
  29 import com.arialyy.aria.core.download.DownloadEntity;
  30 import com.arialyy.aria.core.download.DownloadTask;
  31 import com.arialyy.aria.core.inf.AbsEntity;
  32 import com.arialyy.aria.core.inf.IEntity;
  33 import com.arialyy.frame.util.show.L;
  34 import com.arialyy.simple.R;
  35 import com.arialyy.simple.base.BaseActivity;
  36 import com.arialyy.simple.core.download.multi_download.DownloadAdapter;
  37 import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;
  38 import com.arialyy.simple.util.AppUtil;
  39 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  40 import java.util.ArrayList;
  41 import java.util.HashSet;
  42 import java.util.List;
  43 import java.util.Set;
  44 
  45 /**
  46  * Created by lyy on 2017/6/2.
  47  * 最高优先级任务Demo
  48  */
  49 public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {
  50   private HorizontalProgressBarWithNumber mPb;
  51   private Button mStart;
  52   private Button mStop;
  53   private Button mCancel;
  54   private TextView mSize;
  55   private TextView mSpeed;
  56   private RecyclerView mList;
  57   private DownloadEntity mEntity;
  58 
  59   private String mTaskName = &quot;光明大陆&quot;;
  60   private static final String DOWNLOAD_URL =
<abbr title="  61       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;">  61       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee🔵</abbr>
  62   private DownloadAdapter mAdapter;
  63   private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();
  64   private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();
  65 
  66   @Override protected int setLayoutId() {
  67     return R.layout.activity_highest_priority;
  68   }
  69 
  70   @Override protected void init(Bundle savedInstanceState) {
  71     super.init(savedInstanceState);
  72     mPb = findViewById(R.id.progressBar);
  73     mStart = findViewById(R.id.start);
  74     mStop = findViewById(R.id.stop);
  75     mCancel = findViewById(R.id.cancel);
  76     mSize = findViewById(R.id.size);
  77     mSpeed = findViewById(R.id.speed);
  78     mList = findViewById(R.id.list);
  79 
  80     setTitle(&quot;最高优先级任务&quot;);
  81     getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);
  82     initWidget();
  83     Aria.download(this).register();
  84   }
  85 
  86   private void initWidget() {
  87     mEntity = Aria.download(this).getFirstDownloadEntity(DOWNLOAD_URL);
  88 
  89     if (mEntity != null) {
  90       mPb.setProgress(mEntity.getPercent());
  91       if (mEntity.getState() == IEntity.STATE_STOP) {
  92         mStart.setText(&quot;恢复&quot;);
  93         mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
  94         setBtState(true);
  95       } else if (mEntity.getState() == IEntity.STATE_RUNNING) {
  96         setBtState(false);
  97       }
  98       mSize.setText(mEntity.getConvertFileSize());
  99     }
 100 
 101     List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();
 102     if (temp != null &amp;&amp; !temp.isEmpty()) {
 103       for (DownloadEntity entity : temp) {
 104         if (entity.getUrl().equals(DOWNLOAD_URL)) continue;
 105         mData.add(entity);
 106         mRecord.add(entity.getUrl());
 107       }
 108     }
 109     mAdapter = new DownloadAdapter(this, mData);
 110     mList.setLayoutManager(new LinearLayoutManager(this));
 111     mList.setAdapter(mAdapter);
 112   }
 113 
 114   @Override public boolean onCreateOptionsMenu(Menu menu) {
 115     getMenuInflater().inflate(R.menu.menu_highest_priority, menu);
 116     return super.onCreateOptionsMenu(menu);
 117   }
 118 
 119   @Override public boolean onMenuItemClick(MenuItem item) {
 120     switch (item.getItemId()) {
 121       case R.id.add_task:
 122         List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();
 123         for (DownloadEntity entity : temp) {
 124           String url = entity.getUrl();
 125           if (mRecord.contains(url)) {
 126             continue;
 127           }
 128           mAdapter.addDownloadEntity(entity);
 129           mRecord.add(url);
 130         }
 131         mAdapter.notifyDataSetChanged();
 132         break;
 133       case R.id.help:
 134         String title = &quot;最高优先级任务介绍&quot;;
 135         String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;
 136             + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;
 137             + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;
 138             + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;
 139             + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;
 140             + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;
 141             + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;
 142         showMsgDialog(title, msg);
 143         break;
 144     }
 145     return true;
 146   }
 147 
 148   public void onClick(View view) {
 149     switch (view.getId()) {
 150       case R.id.start:
 151         if (AppUtil.chekEntityValid(mEntity)) {
 152           Aria.download(this)
 153               .load(DOWNLOAD_URL)
 154               .setFilePath(Environment.getExternalStorageDirectory().getPath()
 155                   + &quot;/Download/&quot;
 156                   + mTaskName
 157                   + &quot;.apk&quot;)
 158               .setHighestPriority();
 159         } else {
 160           Aria.download(this).load(mEntity.getId()).resume();
 161         }
 162         ((TextView) view).setText(getString(R.string.stop));
 163         break;
 164       case R.id.stop:
 165         if (AppUtil.chekEntityValid(mEntity)) {
 166           Aria.download(this).load(mEntity.getId()).stop();
 167         }
 168         ((TextView) view).setText(getString(R.string.resume));
 169         break;
 170       case R.id.cancel:
 171         if (AppUtil.chekEntityValid(mEntity)) {
 172           Aria.download(this).load(mEntity.getId()).cancel();
 173         }
 174         break;
 175     }
 176   }
 177 
 178   /**
 179    * 设置start 和 stop 按钮状态
 180    */
 181   private void setBtState(boolean state) {
 182     mStart.setEnabled(state);
 183     mStop.setEnabled(!state);
 184   }
 185 
 186   @Download.onPre public void onPre(DownloadTask task) {
 187     mAdapter.updateState(task.getDownloadEntity());
 188   }
 189 
 190   @Download.onTaskPre public void onTaskPre(DownloadTask task) {
 191     if (task.getKey().equals(DOWNLOAD_URL)) {
 192       mSize.setText(task.getConvertFileSize());
 193     }
 194     mAdapter.updateState(task.getDownloadEntity());
 195   }
 196 
 197   @Download.onTaskStart public void onTaskStart(DownloadTask task) {
 198     if (task.getKey().equals(DOWNLOAD_URL)) {
 199       setBtState(false);
 200     }
 201     mAdapter.updateState(task.getDownloadEntity());
 202   }
 203 
 204   @Download.onTaskResume public void onTaskResume(DownloadTask task) {
 205     if (task.getKey().equals(DOWNLOAD_URL)) {
 206       setBtState(false);
 207     }
 208     mAdapter.updateState(task.getDownloadEntity());
 209   }
 210 
 211   @Download.onTaskStop public void onTaskStop(DownloadTask task) {
 212     if (task.getKey().equals(DOWNLOAD_URL)) {
 213       setBtState(true);
 214       mStart.setText(&quot;恢复&quot;);
 215       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 216     }
 217     mAdapter.updateState(task.getDownloadEntity());
 218   }
 219 
 220   @Download.onTaskCancel public void onTaskCancel(DownloadTask task) {
 221     if (task.getKey().equals(DOWNLOAD_URL)) {
 222       setBtState(true);
 223       mStart.setText(&quot;开始&quot;);
 224       mPb.setProgress(0);
 225     }
 226     mAdapter.updateState(task.getDownloadEntity());
 227   }
 228 
 229   @Download.onTaskFail public void onTaskFail(DownloadTask task) {
 230     if (task.getKey().equals(DOWNLOAD_URL)) {
 231       setBtState(true);
 232     } else {
 233       L.d(TAG, &quot;download fail【&quot; + task.getKey() + &quot;】&quot;);
 234     }
 235   }
 236 
 237   @Download.onTaskComplete public void onTaskComplete(DownloadTask task) {
 238     if (task.getKey().equals(DOWNLOAD_URL)) {
 239       setBtState(true);
 240       mStart.setText(&quot;重新开始&quot;);
 241       mStart.setTextColor(getResources().getColor(android.R.color.holo_green_light));
 242       mPb.setProgress(100);
 243     }
 244     mAdapter.updateState(task.getDownloadEntity());
 245   }
 246 
 247   @Download.onTaskRunning public void onTaskRunning(DownloadTask task) {
 248     if (task.getKey().equals(DOWNLOAD_URL)) {
 249       mPb.setProgress(task.getPercent());
 250       mSpeed.setText(task.getConvertSpeed());
 251     }
 252     mAdapter.setProgress(task.getDownloadEntity());
 253   }
 254 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.simple.core.download;
  17 
  18 import android.os.Bundle;
  19 import android.os.Environment;
  20 import android.support.v7.widget.LinearLayoutManager;
  21 import android.support.v7.widget.RecyclerView;
  22 import android.view.Menu;
  23 import android.view.MenuItem;
  24 import android.view.View;
  25 import android.widget.Button;
  26 import android.widget.TextView;
  27 import com.arialyy.annotations.Download;
  28 import com.arialyy.aria.core.Aria;
  29 import com.arialyy.aria.core.download.DownloadEntity;
  30 import com.arialyy.aria.core.download.DownloadTask;
  31 import com.arialyy.aria.core.inf.AbsEntity;
  32 import com.arialyy.aria.core.inf.IEntity;
  33 import com.arialyy.frame.util.show.L;
  34 import com.arialyy.simple.R;
  35 import com.arialyy.simple.base.BaseActivity;
  36 import com.arialyy.simple.core.download.multi_download.DownloadAdapter;
  37 import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;
  38 import com.arialyy.simple.util.AppUtil;
  39 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  40 import java.util.ArrayList;
  41 import java.util.HashSet;
  42 import java.util.List;
  43 import java.util.Set;
  44 
  45 
  46 /**
  47  * Created by lyy on 2017/6/2.
  48  * 最高优先级任务Demo
  49  */
  50 public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {
  51   private HorizontalProgressBarWithNumber mPb;
  52 
  53   private Button mStart;
  54 
  55   private Button mStop;
  56 
  57   private Button mCancel;
  58 
  59   private TextView mSize;
  60 
  61   private TextView mSpeed;
  62 
  63   private RecyclerView mList;
  64 
  65   private DownloadEntity mEntity;
  66 
  67   private String mTaskName = &quot;光明大陆&quot;;
  68 
  69   private static final String DOWNLOAD_URL =
<abbr title="  70       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;">  70       &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee🔵</abbr>
  71 
  72   private DownloadAdapter mAdapter;
  73 
  74   private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();
  75 
  76   private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();
  77 
  78   @Override protected int setLayoutId() {
  79     return R.layout.activity_highest_priority;
  80   }
  81 
  82   @Override protected void init(Bundle savedInstanceState) {
  83     super.init(savedInstanceState);
  84     mPb = findViewById(R.id.progressBar);
  85     mStart = findViewById(R.id.start);
  86     mStop = findViewById(R.id.stop);
  87     mCancel = findViewById(R.id.cancel);
  88     mSize = findViewById(R.id.size);
  89     mSpeed = findViewById(R.id.speed);
  90     mList = findViewById(R.id.list);
  91 
  92     setTitle(&quot;最高优先级任务&quot;);
  93     getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);
  94     initWidget();
  95     Aria.download(this).register();
  96   }
  97 
  98   private void initWidget() {
  99     mEntity = Aria.download(this).getFirstDownloadEntity(DOWNLOAD_URL);
 100     if (mEntity != null) {
 101       mPb.setProgress(mEntity.getPercent());
 102       if (mEntity.getState() == IEntity.STATE_STOP) {
 103         mStart.setText(&quot;恢复&quot;);
 104         mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 105         setBtState(true);
 106       } else if (mEntity.getState() == IEntity.STATE_RUNNING) {
 107         setBtState(false);
 108       }
 109       mSize.setText(mEntity.getConvertFileSize());
 110     }
 111     List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();
 112     if ((temp != null) &amp;&amp; (!temp.isEmpty())) {
 113       for (DownloadEntity entity : temp) {
 114         if (entity.getUrl().equals(DOWNLOAD_URL)) {
 115           continue;
 116         }
 117         mData.add(entity);
 118         mRecord.add(entity.getUrl());
 119       }
 120     }
 121     mAdapter = new DownloadAdapter(this, mData);
 122     mList.setLayoutManager(new LinearLayoutManager(this));
 123     mList.setAdapter(mAdapter);
 124   }
 125 
 126   @Override public boolean onCreateOptionsMenu(Menu menu) {
 127     getMenuInflater().inflate(R.menu.menu_highest_priority, menu);
 128     return super.onCreateOptionsMenu(menu);
 129   }
 130 
 131   @Override public boolean onMenuItemClick(MenuItem item) {
 132     switch (item.getItemId()) {
 133       case R.id.add_task:
 134         List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();
 135         for (DownloadEntity entity : temp) {
 136           String url = entity.getUrl();
 137           if (mRecord.contains(url)) {
 138             continue;
 139           }
 140           mAdapter.addDownloadEntity(entity);
 141           mRecord.add(url);
 142         }
 143         mAdapter.notifyDataSetChanged();
 144         break;
 145       case R.id.help:
 146         String title = &quot;最高优先级任务介绍&quot;;
 147         String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;
 148             + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;
 149             + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;
 150             + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;
 151             + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;
 152             + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;
 153             + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;
 154         showMsgDialog(title, msg);
 155         break;
 156     }
 157     return true;
 158   }
 159 
 160   public void onClick(View view) {
 161     switch (view.getId()) {
 162       case R.id.start :
 163         if (AppUtil.chekEntityValid(mEntity)) {
<abbr title=" 164           Aria.download(this).load(DOWNLOAD_URL).setFilePath(((Environment.getExternalStorageDirectory().getPath() + &quot;/Download/&quot;) + mTaskName) + &quot;.apk&quot;).setHighestPriority();"> 164           Aria.download(this).load(DOWNLOAD_URL).setFilePath(((Environment.getExternalStorageDirectory().🔵</abbr>
 165         } else {
 166           Aria.download(this).load(mEntity.getId()).resume();
 167         }
 168         ((TextView) (view)).setText(getString(R.string.stop));
 169         break;
 170       case R.id.stop :
 171         if (AppUtil.chekEntityValid(mEntity)) {
 172           Aria.download(this).load(mEntity.getId()).stop();
 173         }
 174         ((TextView) (view)).setText(getString(R.string.resume));
 175         break;
 176       case R.id.cancel :
 177         if (AppUtil.chekEntityValid(mEntity)) {
 178           Aria.download(this).load(mEntity.getId()).cancel();
 179         }
 180         break;
 181     }
 182   }
 183 
 184   /**
 185    * 设置start 和 stop 按钮状态
 186    */
 187   private void setBtState(boolean state) {
 188     mStart.setEnabled(state);
 189     mStop.setEnabled(!state);
 190   }
 191 
 192   @Download.onPre public void onPre(DownloadTask task) {
 193     mAdapter.updateState(task.getDownloadEntity());
 194   }
 195 
 196   @Download.onTaskPre public void onTaskPre(DownloadTask task) {
 197     if (task.getKey().equals(DOWNLOAD_URL)) {
 198       mSize.setText(task.getConvertFileSize());
 199     }
 200     mAdapter.updateState(task.getDownloadEntity());
 201   }
 202 
 203   @Download.onTaskStart public void onTaskStart(DownloadTask task) {
 204     if (task.getKey().equals(DOWNLOAD_URL)) {
 205       setBtState(false);
 206     }
 207     mAdapter.updateState(task.getDownloadEntity());
 208   }
 209 
 210   @Download.onTaskResume public void onTaskResume(DownloadTask task) {
 211     if (task.getKey().equals(DOWNLOAD_URL)) {
 212       setBtState(false);
 213     }
 214     mAdapter.updateState(task.getDownloadEntity());
 215   }
 216 
 217   @Download.onTaskStop public void onTaskStop(DownloadTask task) {
 218     if (task.getKey().equals(DOWNLOAD_URL)) {
 219       setBtState(true);
 220       mStart.setText(&quot;恢复&quot;);
 221       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 222     }
 223     mAdapter.updateState(task.getDownloadEntity());
 224   }
 225 
 226   @Download.onTaskCancel public void onTaskCancel(DownloadTask task) {
 227     if (task.getKey().equals(DOWNLOAD_URL)) {
 228       setBtState(true);
 229       mStart.setText(&quot;开始&quot;);
 230       mPb.setProgress(0);
 231     }
 232     mAdapter.updateState(task.getDownloadEntity());
 233   }
 234 
 235   @Download.onTaskFail public void onTaskFail(DownloadTask task) {
 236     if (task.getKey().equals(DOWNLOAD_URL)) {
 237       setBtState(true);
 238     } else {
 239       L.d(TAG, &quot;download fail【&quot; + task.getKey() + &quot;】&quot;);
 240     }
 241   }
 242 
 243   @Download.onTaskComplete public void onTaskComplete(DownloadTask task) {
 244     if (task.getKey().equals(DOWNLOAD_URL)) {
 245       setBtState(true);
 246       mStart.setText(&quot;重新开始&quot;);
 247       mStart.setTextColor(getResources().getColor(android.R.color.holo_green_light));
 248       mPb.setProgress(100);
 249     }
 250     mAdapter.updateState(task.getDownloadEntity());
 251   }
 252 
 253   @Download.onTaskRunning public void onTaskRunning(DownloadTask task) {
 254     if (task.getKey().equals(DOWNLOAD_URL)) {
 255       mPb.setProgress(task.getPercent());
 256       mSpeed.setText(task.getConvertSpeed());
 257     }
 258     mAdapter.setProgress(task.getDownloadEntity());
 259   }
 260 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.simple.core.download;
  17  
  18  import android.os.Bundle;
  19  import android.os.Environment;
  20  import android.support.v7.widget.LinearLayoutManager;
  21  import android.support.v7.widget.RecyclerView;
  22  import android.view.Menu;
  23  import android.view.MenuItem;
  24  import android.view.View;
  25  import android.widget.Button;
  26  import android.widget.TextView;
  27  import com.arialyy.annotations.Download;
  28  import com.arialyy.aria.core.Aria;
  29  import com.arialyy.aria.core.download.DownloadEntity;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.arialyy.aria.core.download.DownloadTarget;</span>
  31  import com.arialyy.aria.core.download.DownloadTask;
  32  import com.arialyy.aria.core.inf.AbsEntity;
  33  import com.arialyy.aria.core.inf.IEntity;
  34  import com.arialyy.frame.util.show.L;
  35  import com.arialyy.simple.R;
  36  import com.arialyy.simple.base.BaseActivity;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import com.arialyy.simple.core.download.multi_download.DownloadAdapter;</span>
  38  import com.arialyy.simple.databinding.ActivityHighestPriorityBinding;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -import com.arialyy.simple.core.download.multi_download.DownloadAdapter;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import com.arialyy.simple.util.AppUtil;</span>
  41  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  42  import java.util.ArrayList;
  43  import java.util.HashSet;
  44  import java.util.List;
  45  import java.util.Set;
  46  
  47  /**
  48   * Created by lyy on 2017/6/2.
  49   * 最高优先级任务Demo
  50   */
  51  public class HighestPriorityActivity extends BaseActivity&lt;ActivityHighestPriorityBinding&gt; {
  52    private HorizontalProgressBarWithNumber mPb;
  53    private Button mStart;
  54    private Button mStop;
  55    private Button mCancel;
  56    private TextView mSize;
  57    private TextView mSpeed;
  58    private RecyclerView mList;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +  private DownloadEntity mEntity;</span>
  60  
  61    private String mTaskName = &quot;光明大陆&quot;;
  62    private static final String DOWNLOAD_URL =
<abbr title="  63        &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b26a38707dac92b136add91191ac1219aadb4a3aa70bfa6d06d2d8db.apk&quot;;">  63        &quot;https://res5.d.cn/6f78ee3bcfdd033e64892a8553a95814cf5b4a62b12a76d9eb2a694905f0dc30fa5c7f728806a4ee0b3479e7b🔵</abbr>
  64    private DownloadAdapter mAdapter;
  65    private List&lt;AbsEntity&gt; mData = new ArrayList&lt;&gt;();
  66    private Set&lt;String&gt; mRecord = new HashSet&lt;&gt;();
  67  
  68    @Override protected int setLayoutId() {
  69      return R.layout.activity_highest_priority;
  70    }
  71  
  72    @Override protected void init(Bundle savedInstanceState) {
  73      super.init(savedInstanceState);
  74      mPb = findViewById(R.id.progressBar);
  75      mStart = findViewById(R.id.start);
  76      mStop = findViewById(R.id.stop);
  77      mCancel = findViewById(R.id.cancel);
  78      mSize = findViewById(R.id.size);
  79      mSpeed = findViewById(R.id.speed);
  80      mList = findViewById(R.id.list);
  81  
  82      setTitle(&quot;最高优先级任务&quot;);
  83      getBinding().setTaskName(&quot;任务名：&quot; + mTaskName + &quot; （最高优先级任务）&quot;);
  84      initWidget();
  85      Aria.download(this).register();
  86    }
  87  
  88    private void initWidget() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -    DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -    mPb.setProgress(target.getPercent());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -    if (target.getTaskState() == IEntity.STATE_STOP) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -      mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -      mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -      setBtState(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -    } else if (target.isRunning()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -      setBtState(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -    mSize.setText(target.getConvertFileSize());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    mEntity = Aria.download(this).getFirstDownloadEntity(DOWNLOAD_URL);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +    if (mEntity != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +      mPb.setProgress(mEntity.getPercent());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +      if (mEntity.getState() == IEntity.STATE_STOP) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        mStart.setText(&quot;恢复&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        setBtState(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +      } else if (mEntity.getState() == IEntity.STATE_RUNNING) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        setBtState(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +      }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +      mSize.setText(mEntity.getConvertFileSize());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +</span>
 113      List&lt;DownloadEntity&gt; temp = Aria.download(this).getTaskList();
 114      if (temp != null &amp;&amp; !temp.isEmpty()) {
 115        for (DownloadEntity entity : temp) {
 116          if (entity.getUrl().equals(DOWNLOAD_URL)) continue;
 117          mData.add(entity);
 118          mRecord.add(entity.getUrl());
 119        }
 120      }
 121      mAdapter = new DownloadAdapter(this, mData);
 122      mList.setLayoutManager(new LinearLayoutManager(this));
 123      mList.setAdapter(mAdapter);
 124    }
 125  
 126    @Override public boolean onCreateOptionsMenu(Menu menu) {
 127      getMenuInflater().inflate(R.menu.menu_highest_priority, menu);
 128      return super.onCreateOptionsMenu(menu);
 129    }
 130  
 131    @Override public boolean onMenuItemClick(MenuItem item) {
 132      switch (item.getItemId()) {
 133        case R.id.add_task:
 134          List&lt;DownloadEntity&gt; temp = getModule(DownloadModule.class).getHighestTestList();
 135          for (DownloadEntity entity : temp) {
 136            String url = entity.getUrl();
 137            if (mRecord.contains(url)) {
 138              continue;
 139            }
 140            mAdapter.addDownloadEntity(entity);
 141            mRecord.add(url);
 142          }
 143          mAdapter.notifyDataSetChanged();
 144          break;
 145        case R.id.help:
 146          String title = &quot;最高优先级任务介绍&quot;;
 147          String msg = &quot; 将任务设置为最高优先级任务，最高优先级任务有以下特点：\n&quot;
 148              + &quot; 1、在下载队列中，有且只有一个最高优先级任务\n&quot;
 149              + &quot; 2、最高优先级任务会一直存在，直到用户手动暂停或任务完成\n&quot;
 150              + &quot; 3、任务调度器不会暂停最高优先级任务\n&quot;
 151              + &quot; 4、用户手动暂停或任务完成后，第二次重新执行该任务，该命令将失效\n&quot;
 152              + &quot; 5、如果下载队列中已经满了，则会停止队尾的任务，当高优先级任务完成后，该队尾任务将自动执行\n&quot;
 153              + &quot; 6、把任务设置为最高优先级任务后，将自动执行任务，不需要重新调用start()启动任务&quot;;
 154          showMsgDialog(title, msg);
 155          break;
 156      }
 157      return true;
 158    }
 159  
 160    public void onClick(View view) {
 161      switch (view.getId()) {
 162        case R.id.start:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -        String text = ((TextView) view).getText().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -        if (text.equals(&quot;重新开始？&quot;) || text.equals(&quot;开始&quot;)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +        if (AppUtil.chekEntityValid(mEntity)) {</span>
 166            Aria.download(this)
 167                .load(DOWNLOAD_URL)
 168                .setFilePath(Environment.getExternalStorageDirectory().getPath()
 169                    + &quot;/Download/&quot;
 170                    + mTaskName
 171                    + &quot;.apk&quot;)
 172                .setHighestPriority();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -        } else if (text.equals(&quot;恢复&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -          Aria.download(this).load(DOWNLOAD_URL).resume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +          Aria.download(this).load(mEntity.getId()).resume();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +        ((TextView) view).setText(getString(R.string.stop));</span>
 180          break;
 181        case R.id.stop:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -        Aria.download(this).load(DOWNLOAD_URL).pause();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +        if (AppUtil.chekEntityValid(mEntity)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +          Aria.download(this).load(mEntity.getId()).stop();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +        ((TextView) view).setText(getString(R.string.resume));</span>
 187          break;
 188        case R.id.cancel:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -        Aria.download(this).load(DOWNLOAD_URL).cancel();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        if (AppUtil.chekEntityValid(mEntity)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +          Aria.download(this).load(mEntity.getId()).cancel();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +        }</span>
 193          break;
 194      }
 195    }
 196  
 197    /**
 198     * 设置start 和 stop 按钮状态
 199     */
 200    private void setBtState(boolean state) {
 201      mStart.setEnabled(state);
 202      mStop.setEnabled(!state);
 203    }
 204  
 205    @Download.onPre public void onPre(DownloadTask task) {
 206      mAdapter.updateState(task.getDownloadEntity());
 207    }
 208  
 209    @Download.onTaskPre public void onTaskPre(DownloadTask task) {
 210      if (task.getKey().equals(DOWNLOAD_URL)) {
 211        mSize.setText(task.getConvertFileSize());
 212      }
 213      mAdapter.updateState(task.getDownloadEntity());
 214    }
 215  
 216    @Download.onTaskStart public void onTaskStart(DownloadTask task) {
 217      if (task.getKey().equals(DOWNLOAD_URL)) {
 218        setBtState(false);
 219      }
 220      mAdapter.updateState(task.getDownloadEntity());
 221    }
 222  
 223    @Download.onTaskResume public void onTaskResume(DownloadTask task) {
 224      if (task.getKey().equals(DOWNLOAD_URL)) {
 225        setBtState(false);
 226      }
 227      mAdapter.updateState(task.getDownloadEntity());
 228    }
 229  
 230    @Download.onTaskStop public void onTaskStop(DownloadTask task) {
 231      if (task.getKey().equals(DOWNLOAD_URL)) {
 232        setBtState(true);
 233        mStart.setText(&quot;恢复&quot;);
 234        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 235      }
 236      mAdapter.updateState(task.getDownloadEntity());
 237    }
 238  
 239    @Download.onTaskCancel public void onTaskCancel(DownloadTask task) {
 240      if (task.getKey().equals(DOWNLOAD_URL)) {
 241        setBtState(true);
 242        mStart.setText(&quot;开始&quot;);
 243        mPb.setProgress(0);
 244      }
 245      mAdapter.updateState(task.getDownloadEntity());
 246    }
 247  
 248    @Download.onTaskFail public void onTaskFail(DownloadTask task) {
 249      if (task.getKey().equals(DOWNLOAD_URL)) {
 250        setBtState(true);
 251      } else {
 252        L.d(TAG, &quot;download fail【&quot; + task.getKey() + &quot;】&quot;);
 253      }
 254    }
 255  
 256    @Download.onTaskComplete public void onTaskComplete(DownloadTask task) {
 257      if (task.getKey().equals(DOWNLOAD_URL)) {
 258        setBtState(true);
 259        mStart.setText(&quot;重新开始&quot;);
 260        mStart.setTextColor(getResources().getColor(android.R.color.holo_green_light));
 261        mPb.setProgress(100);
 262      }
 263      mAdapter.updateState(task.getDownloadEntity());
 264    }
 265  
 266    @Download.onTaskRunning public void onTaskRunning(DownloadTask task) {
 267      if (task.getKey().equals(DOWNLOAD_URL)) {
 268        mPb.setProgress(task.getPercent());
 269        mSpeed.setText(task.getConvertSpeed());
 270      }
 271      mAdapter.setProgress(task.getDownloadEntity());
 272    }
 273  }</pre></td>
                            <td><pre></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            