<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>561</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    561
                    <a href="560.html">prev</a>
                    <a href="562.html">next</a>
                    <a href="561_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_7302b163e73618ae14d90bd0ad9b64f1caf7c884_core/src/main/java/com/dtstack/flink/sql/Main.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884:core/src/main/java/com/dtstack/flink/sql/Main.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884^1:core/src/main/java/com/dtstack/flink/sql/Main.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884^2:core/src/main/java/com/dtstack/flink/sql/Main.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b259aa5e9ca64e4d07266783ec504a1f5fd6d5ec:core/src/main/java/com/dtstack/flink/sql/Main.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b]], subset: [[b], [b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 
  19 
  20 package com.dtstack.flink.sql;
  21 
  22 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  23 import com.dtstack.flink.sql.config.CalciteConfig;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  24 import com.dtstack.flink.sql.classloader.ClassLoaderManager;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import com.dtstack.flink.sql.enums.ClusterMode;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import com.dtstack.flink.sql.enums.ECacheType;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import com.dtstack.flink.sql.environment.MyLocalStreamEnvironment;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import com.dtstack.flink.sql.environment.StreamEnvConfigManager;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import com.dtstack.flink.sql.exec.FlinkSQLExec;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  30 import com.dtstack.flink.sql.option.OptionParser;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  31 import com.dtstack.flink.sql.parser.CreateFuncParser;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import com.dtstack.flink.sql.parser.CreateTmpTableParser;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  33 import com.dtstack.flink.sql.parser.InsertSqlParser;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  34 import com.dtstack.flink.sql.parser.SqlParser;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  35 import com.dtstack.flink.sql.parser.SqlTree;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  36 import com.dtstack.flink.sql.side.SideSqlExec;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  37 import com.dtstack.flink.sql.side.SideTableInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38 import com.dtstack.flink.sql.table.SourceTableInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39 import com.dtstack.flink.sql.table.TableInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import com.dtstack.flink.sql.table.TargetTableInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import com.dtstack.flink.sql.sink.StreamSinkFactory;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import com.dtstack.flink.sql.source.StreamSourceFactory;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import com.dtstack.flink.sql.util.DtStringUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44 import com.dtstack.flink.sql.watermarker.WaterMarkerAssigner;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 import com.dtstack.flink.sql.function.FunctionManager;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  47 import org.apache.calcite.sql.SqlInsert;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48 import org.apache.calcite.sql.SqlNode;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50 import org.apache.flink.api.common.typeinfo.TypeInformation;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51 import org.apache.flink.api.java.tuple.Tuple2;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52 import org.apache.flink.api.java.typeutils.RowTypeInfo;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53 import com.google.common.base.Strings;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54 import com.google.common.collect.Lists;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55 import com.google.common.collect.Maps;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56 import com.google.common.collect.Sets;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57 import com.fasterxml.jackson.databind.ObjectMapper;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58 import org.apache.flink.client.program.ContextEnvironment;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59 import org.apache.flink.streaming.api.datastream.DataStream;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60 import org.apache.flink.streaming.api.environment.StreamContextEnvironment;</span>
  61 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 import com.dtstack.flink.sql.config.CalciteConfig;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 import com.dtstack.flink.sql.classloader.ClassLoaderManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64 import com.dtstack.flink.sql.enums.ClusterMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 import com.dtstack.flink.sql.enums.ECacheType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 import com.dtstack.flink.sql.environment.MyLocalStreamEnvironment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 import com.dtstack.flink.sql.environment.StreamEnvConfigManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 import com.dtstack.flink.sql.exec.FlinkSQLExec;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 import com.dtstack.flink.sql.option.OptionParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 import com.dtstack.flink.sql.parser.CreateFuncParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 import com.dtstack.flink.sql.parser.CreateTmpTableParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 import com.dtstack.flink.sql.parser.InsertSqlParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 import com.dtstack.flink.sql.parser.SqlParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74 import com.dtstack.flink.sql.parser.SqlTree;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 import com.dtstack.flink.sql.side.SideSqlExec;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 import com.dtstack.flink.sql.side.SideTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 import com.dtstack.flink.sql.table.SourceTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 import com.dtstack.flink.sql.table.TableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 import com.dtstack.flink.sql.table.TargetTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80 import com.dtstack.flink.sql.sink.StreamSinkFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 import com.dtstack.flink.sql.source.StreamSourceFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 import com.dtstack.flink.sql.util.DtStringUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 import com.dtstack.flink.sql.watermarker.WaterMarkerAssigner;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 import com.dtstack.flink.sql.function.FunctionManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 import org.apache.calcite.sql.SqlInsert;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 import org.apache.calcite.sql.SqlNode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 import org.apache.flink.api.common.typeinfo.TypeInformation;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 import org.apache.flink.api.java.tuple.Tuple2;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 import org.apache.flink.api.java.typeutils.RowTypeInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92 import com.google.common.base.Strings;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 import com.google.common.collect.Lists;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94 import com.google.common.collect.Maps;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 import com.google.common.collect.Sets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 import com.fasterxml.jackson.databind.ObjectMapper;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97 import org.apache.flink.streaming.api.datastream.DataStream;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99 import org.apache.flink.table.api.EnvironmentSettings;</span>
 100 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103 import com.dtstack.flink.sql.exec.ExecuteProcessHelper;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104 import com.dtstack.flink.sql.exec.ParamsInfo;</span>
 105 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 106 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
 107 import org.slf4j.Logger;
 108 import org.slf4j.LoggerFactory;
 109 
 110 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111 import java.io.File;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112 import java.lang.reflect.Field;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113 import java.lang.reflect.InvocationTargetException;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114 import java.net.URL;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115 import java.net.URLClassLoader;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116 import java.net.URLDecoder;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117 import java.util.ArrayList;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118 import java.util.List;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119 import java.util.Map;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120 import java.util.Properties;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121 import java.util.Set;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124 </span>
 125 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126 import com.dtstack.flink.sql.parser.CreateFuncParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127 import com.dtstack.flink.sql.parser.CreateTmpTableParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128 import com.dtstack.flink.sql.parser.InsertSqlParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129 import com.dtstack.flink.sql.parser.SqlParser;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 import com.dtstack.flink.sql.parser.SqlTree;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131 import com.dtstack.flink.sql.side.SideSqlExec;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 import com.dtstack.flink.sql.side.SideTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133 import com.dtstack.flink.sql.table.SourceTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 import com.dtstack.flink.sql.table.TableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135 import com.dtstack.flink.sql.table.TargetTableInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136 import com.dtstack.flink.sql.sink.StreamSinkFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137 import com.dtstack.flink.sql.source.StreamSourceFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138 import com.dtstack.flink.sql.util.DtStringUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139 import com.dtstack.flink.sql.watermarker.WaterMarkerAssigner;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140 import com.dtstack.flink.sql.function.FunctionManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142 import org.apache.calcite.sql.SqlInsert;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143 import org.apache.calcite.sql.SqlNode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145 import org.apache.flink.api.common.typeinfo.TypeInformation;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146 import org.apache.flink.api.java.tuple.Tuple2;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 import org.apache.flink.api.java.typeutils.RowTypeInfo;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148 import com.google.common.base.Strings;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149 import com.google.common.collect.Lists;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150 import com.google.common.collect.Maps;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151 import com.google.common.collect.Sets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152 import com.fasterxml.jackson.databind.ObjectMapper;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153 import org.apache.flink.streaming.api.datastream.DataStream;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155 import org.apache.flink.table.api.EnvironmentSettings;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 import org.apache.flink.table.api.Table;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157 import org.apache.flink.table.api.TableEnvironment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158 import org.apache.flink.table.api.java.StreamTableEnvironment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159 import org.apache.flink.table.sinks.TableSink;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160 import org.apache.flink.types.Row;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164 import java.io.File;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 import java.lang.reflect.InvocationTargetException;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166 import java.net.URL;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167 import java.net.URLClassLoader;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172 import java.util.Set;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177  * Date: 2018/6/26</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179  * @author xuchao</span>
 180 =======
 181 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 182 /**
 183  * Date: 2018/6/26
 184  * Company: www.dtstack.com
 185  * @author xuchao
 186  */
 187 
 188 public class Main {
 189     private static final Logger LOG = LoggerFactory.getLogger(Main.class);
 190 
 191     public static void main(String[] args) throws Exception {
 192         ParamsInfo paramsInfo = ExecuteProcessHelper.parseParams(args);
 193         ExecuteProcessHelper.setLogLevel(paramsInfo);
 194         StreamExecutionEnvironment env = ExecuteProcessHelper.getStreamExecution(paramsInfo);
 195         env.execute(paramsInfo.getName());
 196         LOG.info(&quot;program {} execution success&quot;, paramsInfo.getName());
 197     }
 198 }</pre></td>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 
  19 
  20 package com.dtstack.flink.sql;
  21 import org.apache.flink.client.program.ContextEnvironment;
  22 import org.apache.flink.streaming.api.environment.StreamContextEnvironment;
  23 
  24 
  25 
  26 import com.dtstack.flink.sql.exec.ExecuteProcessHelper;
  27 import com.dtstack.flink.sql.exec.ParamsInfo;
  28 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  29 import org.slf4j.Logger;
  30 import org.slf4j.LoggerFactory;
  31 import java.lang.reflect.Field;
  32 import java.util.ArrayList;
  33 
  34 /**
  35  * Date: 2018/6/26
  36  * Company: www.dtstack.com
  37  * @author xuchao
  38  */
  39 
  40 public class Main {
  41     private static final Logger LOG = LoggerFactory.getLogger(Main.class);
  42 
  43     public static void main(String[] args) throws Exception {
  44         ParamsInfo paramsInfo = ExecuteProcessHelper.parseParams(args);
  45         ExecuteProcessHelper.setLogLevel(paramsInfo);
  46         StreamExecutionEnvironment env = ExecuteProcessHelper.getStreamExecution(paramsInfo);
  47         env.execute(paramsInfo.getName());
  48         LOG.info(&quot;program {} execution success&quot;, paramsInfo.getName());
  49     }
  50 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Licensed to the Apache Software Foundation (ASF) under one
   3  * or more contributor license agreements.  See the NOTICE file
   4  * distributed with this work for additional information
   5  * regarding copyright ownership.  The ASF licenses this file
   6  * to you under the Apache License, Version 2.0 (the
   7  * &quot;License&quot;); you may not use this file except in compliance
   8  * with the License.  You may obtain a copy of the License at
   9  *
  10  *     http://www.apache.org/licenses/LICENSE-2.0
  11  *
  12  * Unless required by applicable law or agreed to in writing, software
  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15  * See the License for the specific language governing permissions and
  16  * limitations under the License.
  17  */
  18 package com.dtstack.flink.sql;
  19 
  20 import com.dtstack.flink.sql.exec.ExecuteProcessHelper;
  21 import com.dtstack.flink.sql.exec.ParamsInfo;
  22 import java.lang.reflect.Field;
  23 import java.util.ArrayList;
  24 import org.apache.flink.client.program.ContextEnvironment;
  25 import org.apache.flink.streaming.api.environment.StreamContextEnvironment;
  26 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  27 import org.slf4j.Logger;
  28 import org.slf4j.LoggerFactory;
  29 
  30 
  31 /**
  32  * Date: 2018/6/26
  33  * Company: www.dtstack.com
  34  * @author xuchao
  35  */
  36 public class Main {
  37     private static final Logger LOG = LoggerFactory.getLogger(Main.class);
  38 
  39     public static void main(String[] args) throws Exception {
  40         ParamsInfo paramsInfo = ExecuteProcessHelper.parseParams(args);
  41         ExecuteProcessHelper.setLogLevel(paramsInfo);
  42         StreamExecutionEnvironment env = ExecuteProcessHelper.getStreamExecution(paramsInfo);
  43         env.execute(paramsInfo.getName());
  44         LOG.info(&quot;program {} execution success&quot;, paramsInfo.getName());
  45     }
  46 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   *     http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  
  20  package com.dtstack.flink.sql;
  21  
  22  import com.dtstack.flink.sql.config.CalciteConfig;
  23  import com.dtstack.flink.sql.classloader.ClassLoaderManager;
  24  import com.dtstack.flink.sql.enums.ClusterMode;
  25  import com.dtstack.flink.sql.enums.ECacheType;
  26  import com.dtstack.flink.sql.environment.MyLocalStreamEnvironment;
  27  import com.dtstack.flink.sql.environment.StreamEnvConfigManager;
  28  import com.dtstack.flink.sql.exec.FlinkSQLExec;
  29  import com.dtstack.flink.sql.option.OptionParser;
  30  import com.dtstack.flink.sql.parser.CreateFuncParser;
  31  import com.dtstack.flink.sql.parser.CreateTmpTableParser;
  32  import com.dtstack.flink.sql.parser.InsertSqlParser;
  33  import com.dtstack.flink.sql.parser.SqlParser;
  34  import com.dtstack.flink.sql.parser.SqlTree;
  35  import com.dtstack.flink.sql.side.SideSqlExec;
  36  import com.dtstack.flink.sql.side.SideTableInfo;
  37  import com.dtstack.flink.sql.table.SourceTableInfo;
  38  import com.dtstack.flink.sql.table.TableInfo;
  39  import com.dtstack.flink.sql.table.TargetTableInfo;
  40  import com.dtstack.flink.sql.sink.StreamSinkFactory;
  41  import com.dtstack.flink.sql.source.StreamSourceFactory;
  42  import com.dtstack.flink.sql.util.DtStringUtil;
  43  import com.dtstack.flink.sql.watermarker.WaterMarkerAssigner;
  44  import com.dtstack.flink.sql.function.FunctionManager;
  45  import com.dtstack.flink.sql.util.PluginUtil;
  46  import org.apache.calcite.sql.SqlInsert;
  47  import org.apache.calcite.sql.SqlNode;
  48  import org.apache.commons.io.Charsets;
  49  import org.apache.flink.api.common.typeinfo.TypeInformation;
  50  import org.apache.flink.api.java.tuple.Tuple2;
  51  import org.apache.flink.api.java.typeutils.RowTypeInfo;
  52  import com.google.common.base.Strings;
  53  import com.google.common.collect.Lists;
  54  import com.google.common.collect.Maps;
  55  import com.google.common.collect.Sets;
  56  import com.fasterxml.jackson.databind.ObjectMapper;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +import org.apache.flink.client.program.ContextEnvironment;</span>
  58  import org.apache.flink.streaming.api.datastream.DataStream;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +import org.apache.flink.streaming.api.environment.StreamContextEnvironment;</span>



  60  import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
  61  import org.apache.flink.table.api.EnvironmentSettings;
  62  import org.apache.flink.table.api.Table;
  63  import org.apache.flink.table.api.TableEnvironment;
  64  import org.apache.flink.table.api.java.StreamTableEnvironment;
  65  import org.apache.flink.table.sinks.TableSink;
  66  import org.apache.flink.types.Row;
  67  import org.slf4j.Logger;
  68  import org.slf4j.LoggerFactory;
  69  
  70  import java.io.File;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +import java.lang.reflect.Field;</span>
  72  import java.lang.reflect.InvocationTargetException;
  73  import java.net.URL;
  74  import java.net.URLClassLoader;
  75  import java.net.URLDecoder;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +import java.util.ArrayList;</span>
  77  import java.util.List;
  78  import java.util.Map;
  79  import java.util.Properties;
  80  import java.util.Set;
  81  
  82  import com.dtstack.flink.sql.option.Options;
  83  
  84  /**
  85   * Date: 2018/6/26
  86   * Company: www.dtstack.com
  87   * @author xuchao
  88   */
  89  
  90  public class Main {
  91  
  92      private static final String CLASS_FILE_NAME_FMT = &quot;class_path_%d&quot;;
  93  
  94      private static final ObjectMapper objMapper = new ObjectMapper();
  95  
  96      private static final Logger LOG = LoggerFactory.getLogger(Main.class);
  97  
  98  
  99      public static void main(String[] args) throws Exception {
 100  
 101          OptionParser optionParser = new OptionParser(args);
 102          Options options = optionParser.getOptions();
 103          String sql = options.getSql();
 104          String name = options.getName();
 105          String addJarListStr = options.getAddjar();
 106          String localSqlPluginPath = options.getLocalSqlPluginPath();
 107          String remoteSqlPluginPath = options.getRemoteSqlPluginPath();
 108          String pluginLoadMode = options.getPluginLoadMode();
 109          String deployMode = options.getMode();
 110          String confProp = options.getConfProp();
 111  
 112          sql = URLDecoder.decode(sql, Charsets.UTF_8.name());
 113          SqlParser.setLocalSqlPluginRoot(localSqlPluginPath);
 114  
 115          List&lt;String&gt; addJarFileList = Lists.newArrayList();
 116          if (!Strings.isNullOrEmpty(addJarListStr)) {
 117              addJarListStr = URLDecoder.decode(addJarListStr, Charsets.UTF_8.name());
 118              addJarFileList = objMapper.readValue(addJarListStr, List.class);
 119          }
 120  
 121          confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());
 122          Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);
 123          StreamExecutionEnvironment env = getStreamExeEnv(confProperties, deployMode);
 124          StreamTableEnvironment tableEnv = getStreamTableEnv(env, confProperties);
 125  
 126          List&lt;URL&gt; jarURList = Lists.newArrayList();
 127          SqlTree sqlTree = SqlParser.parseSql(sql);
 128  
 129          //Get External jar to load
 130          for (String addJarPath : addJarFileList) {
 131              File tmpFile = new File(addJarPath);
 132              jarURList.add(tmpFile.toURI().toURL());
 133          }
 134  
 135          Map&lt;String, SideTableInfo&gt; sideTableMap = Maps.newHashMap();
 136          Map&lt;String, Table&gt; registerTableCache = Maps.newHashMap();
 137  
 138          //register udf
 139          registerUserDefinedFunction(sqlTree, jarURList, tableEnv);
 140          //register table schema
<abbr title=" 141          Set&lt;URL&gt; classPathSets = registerTable(sqlTree, env, tableEnv, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode, sideTableMap, registerTableCache);"> 141          Set&lt;URL&gt; classPathSets = registerTable(sqlTree, env, tableEnv, localSqlPluginPath, remoteSqlPluginPath, pl🔵</abbr>
 142          // cache classPathSets
 143          registerPluginUrlToCachedFile(env, classPathSets);
 144  
 145          sqlTranslation(localSqlPluginPath, tableEnv, sqlTree, sideTableMap, registerTableCache);
 146  
 147          if (env instanceof MyLocalStreamEnvironment) {
 148              ((MyLocalStreamEnvironment) env).setClasspaths(ClassLoaderManager.getClassPath());
 149          }
 150  
 151          env.execute(name);
 152      }
 153  
<abbr title=" 154      private static void sqlTranslation(String localSqlPluginPath, StreamTableEnvironment tableEnv, SqlTree sqlTree, Map&lt;String, SideTableInfo&gt; sideTableMap, Map&lt;String, Table&gt; registerTableCache) throws Exception {"> 154      private static void sqlTranslation(String localSqlPluginPath, StreamTableEnvironment tableEnv, SqlTree sqlTree🔵</abbr>
 155          SideSqlExec sideSqlExec = new SideSqlExec();
 156          sideSqlExec.setLocalSqlPluginPath(localSqlPluginPath);
 157          for (CreateTmpTableParser.SqlParserResult result : sqlTree.getTmpSqlList()) {
 158              sideSqlExec.registerTmpTable(result, sideTableMap, tableEnv, registerTableCache);
 159          }
 160  
 161          for (InsertSqlParser.SqlParseResult result : sqlTree.getExecSqlList()) {
 162              if (LOG.isInfoEnabled()) {
 163                  LOG.info(&quot;exe-sql:\n&quot; + result.getExecSql());
 164              }
 165              boolean isSide = false;
 166              for (String tableName : result.getTargetTableList()) {
 167                  if (sqlTree.getTmpTableMap().containsKey(tableName)) {
 168                      CreateTmpTableParser.SqlParserResult tmp = sqlTree.getTmpTableMap().get(tableName);
 169                      String realSql = DtStringUtil.replaceIgnoreQuota(result.getExecSql(), &quot;`&quot;, &quot;&quot;);
 170  
<abbr title=" 171                      SqlNode sqlNode = org.apache.calcite.sql.parser.SqlParser.create(realSql, CalciteConfig.MYSQL_LEX_CONFIG).parseStmt();"> 171                      SqlNode sqlNode = org.apache.calcite.sql.parser.SqlParser.create(realSql, CalciteConfig.MYSQL_🔵</abbr>
 172                      String tmpSql = ((SqlInsert) sqlNode).getSource().toString();
 173                      tmp.setExecSql(tmpSql);
 174                      sideSqlExec.registerTmpTable(tmp, sideTableMap, tableEnv, registerTableCache);
 175                  } else {
 176                      for (String sourceTable : result.getSourceTableList()) {
 177                          if (sideTableMap.containsKey(sourceTable)) {
 178                              isSide = true;
 179                              break;
 180                          }
 181                      }
 182                      if (isSide) {
 183                          //sql-dimensional table contains the dimension table of execution
 184                          sideSqlExec.exec(result.getExecSql(), sideTableMap, tableEnv, registerTableCache);
 185                      } else {
 186                          FlinkSQLExec.sqlUpdate(tableEnv, result.getExecSql());
 187                          if (LOG.isInfoEnabled()) {
 188                              LOG.info(&quot;exec sql: &quot; + result.getExecSql());
 189                          }
 190                      }
 191                  }
 192              }
 193          }
 194  
 195  
 196      }
 197  
 198  
<abbr title=" 199      private static void registerUserDefinedFunction(SqlTree sqlTree, List&lt;URL&gt; jarURList, TableEnvironment tableEnv)"> 199      private static void registerUserDefinedFunction(SqlTree sqlTree, List&lt;URL&gt; jarURList, TableEnvironment tableEn🔵</abbr>
 200              throws IllegalAccessException, InvocationTargetException {
 201          // udf和tableEnv须由同一个类加载器加载
 202          ClassLoader levelClassLoader = tableEnv.getClass().getClassLoader();
 203          URLClassLoader classLoader = null;
 204          List&lt;CreateFuncParser.SqlParserResult&gt; funcList = sqlTree.getFunctionList();
 205          for (CreateFuncParser.SqlParserResult funcInfo : funcList) {
 206              //classloader
 207              if (classLoader == null) {
 208                  classLoader = ClassLoaderManager.loadExtraJar(jarURList, (URLClassLoader) levelClassLoader);
 209              }
<abbr title=" 210              FunctionManager.registerUDF(funcInfo.getType(), funcInfo.getClassName(), funcInfo.getName(), tableEnv, classLoader);"> 210              FunctionManager.registerUDF(funcInfo.getType(), funcInfo.getClassName(), funcInfo.getName(), tableEnv,🔵</abbr>
 211          }
 212      }
 213  
 214      /**
 215       *    向Flink注册源表和结果表，返回执行时插件包的全路径
 216       * @param sqlTree
 217       * @param env
 218       * @param tableEnv
 219       * @param localSqlPluginPath
 220       * @param remoteSqlPluginPath
 221       * @param pluginLoadMode   插件加载模式 classpath or shipfile
 222       * @param sideTableMap
 223       * @param registerTableCache
 224       * @return
 225       * @throws Exception
 226       */
<abbr title=" 227      private static Set&lt;URL&gt; registerTable(SqlTree sqlTree, StreamExecutionEnvironment env, StreamTableEnvironment tableEnv, String localSqlPluginPath,"> 227      private static Set&lt;URL&gt; registerTable(SqlTree sqlTree, StreamExecutionEnvironment env, StreamTableEnvironment 🔵</abbr>
<abbr title=" 228                                            String remoteSqlPluginPath, String pluginLoadMode, Map&lt;String, SideTableInfo&gt; sideTableMap, Map&lt;String, Table&gt; registerTableCache) throws Exception {"> 228                                            String remoteSqlPluginPath, String pluginLoadMode, Map&lt;String, SideTable🔵</abbr>
 229          Set&lt;URL&gt; pluginClassPatshSets = Sets.newHashSet();
 230          WaterMarkerAssigner waterMarkerAssigner = new WaterMarkerAssigner();
 231          for (TableInfo tableInfo : sqlTree.getTableInfoMap().values()) {
 232  
 233              if (tableInfo instanceof SourceTableInfo) {
 234  
 235                  SourceTableInfo sourceTableInfo = (SourceTableInfo) tableInfo;
<abbr title=" 236                  Table table = StreamSourceFactory.getStreamSource(sourceTableInfo, env, tableEnv, localSqlPluginPath);"> 236                  Table table = StreamSourceFactory.getStreamSource(sourceTableInfo, env, tableEnv, localSqlPluginPa🔵</abbr>
 237                  tableEnv.registerTable(sourceTableInfo.getAdaptName(), table);
<abbr title=" 238                  //Note --- parameter conversion function can not be used inside a function of the type of polymerization"> 238                  //Note --- parameter conversion function can not be used inside a function of the type of polymeri🔵</abbr>
 239                  //Create table in which the function is arranged only need adaptation sql
 240                  String adaptSql = sourceTableInfo.getAdaptSelectSql();
 241                  Table adaptTable = adaptSql == null ? table : tableEnv.sqlQuery(adaptSql);
 242  
<abbr title=" 243                  RowTypeInfo typeInfo = new RowTypeInfo(adaptTable.getSchema().getFieldTypes(), adaptTable.getSchema().getFieldNames());"> 243                  RowTypeInfo typeInfo = new RowTypeInfo(adaptTable.getSchema().getFieldTypes(), adaptTable.getSchem🔵</abbr>
 244                  DataStream adaptStream = tableEnv.toRetractStream(adaptTable, typeInfo)
 245                          .map((Tuple2&lt;Boolean, Row&gt; f0) -&gt; {
 246                              return f0.f1;
 247                          })
 248                          .returns(typeInfo);
 249  
 250                  String fields = String.join(&quot;,&quot;, typeInfo.getFieldNames());
 251  
 252                  if (waterMarkerAssigner.checkNeedAssignWaterMarker(sourceTableInfo)) {
 253                      adaptStream = waterMarkerAssigner.assignWaterMarker(adaptStream, typeInfo, sourceTableInfo);
 254                      fields += &quot;,ROWTIME.ROWTIME&quot;;
 255                  } else {
 256                      fields += &quot;,PROCTIME.PROCTIME&quot;;
 257                  }
 258  
 259                  Table regTable = tableEnv.fromDataStream(adaptStream, fields);
 260                  tableEnv.registerTable(tableInfo.getName(), regTable);
 261                  if (LOG.isInfoEnabled()) {
 262                      LOG.info(&quot;registe table {} success.&quot;, tableInfo.getName());
 263                  }
 264                  registerTableCache.put(tableInfo.getName(), regTable);
 265  
<abbr title=" 266                  URL sourceTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), SourceTableInfo.SOURCE_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 266                  URL sourceTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), SourceTa🔵</abbr>
 267                  pluginClassPatshSets.add(sourceTablePathUrl);
 268              } else if (tableInfo instanceof TargetTableInfo) {
<abbr title=" 269                  TableSink tableSink = StreamSinkFactory.getTableSink((TargetTableInfo) tableInfo, localSqlPluginPath);"> 269                  TableSink tableSink = StreamSinkFactory.getTableSink((TargetTableInfo) tableInfo, localSqlPluginPa🔵</abbr>
 270                  TypeInformation[] flinkTypes = FunctionManager.transformTypes(tableInfo.getFieldClasses());
 271                  tableEnv.registerTableSink(tableInfo.getName(), tableInfo.getFields(), flinkTypes, tableSink);
 272  
<abbr title=" 273                  URL sinkTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), TargetTableInfo.TARGET_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 273                  URL sinkTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), TargetTabl🔵</abbr>
 274                  pluginClassPatshSets.add(sinkTablePathUrl);
 275              } else if (tableInfo instanceof SideTableInfo) {
<abbr title=" 276                  String sideOperator = ECacheType.ALL.name().equals(((SideTableInfo) tableInfo).getCacheType()) ? &quot;all&quot; : &quot;async&quot;;"> 276                  String sideOperator = ECacheType.ALL.name().equals(((SideTableInfo) tableInfo).getCacheType()) ? &quot;🔵</abbr>
 277                  sideTableMap.put(tableInfo.getName(), (SideTableInfo) tableInfo);
 278  
<abbr title=" 279                  URL sideTablePathUrl = PluginUtil.buildSidePathByLoadMode(tableInfo.getType(), sideOperator, SideTableInfo.TARGET_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 279                  URL sideTablePathUrl = PluginUtil.buildSidePathByLoadMode(tableInfo.getType(), sideOperator, SideT🔵</abbr>
 280                  pluginClassPatshSets.add(sideTablePathUrl);
 281              } else {
 282                  throw new RuntimeException(&quot;not support table type:&quot; + tableInfo.getType());
 283              }
 284          }
 285          return pluginClassPatshSets;
 286      }
 287  
 288      /**
 289       *   将job依赖的插件包路径存储到cacheFile，在外围将插件包路径传递给jobgraph
 290       * @param env
 291       * @param classPathSet
 292       */
 293      private static void registerPluginUrlToCachedFile(StreamExecutionEnvironment env, Set&lt;URL&gt; classPathSet) {
 294          int i = 0;
 295          for (URL url : classPathSet) {
 296              String classFileName = String.format(CLASS_FILE_NAME_FMT, i);
 297              env.registerCachedFile(url.getPath(), classFileName, true);
 298              i++;
 299          }
 300      }
 301  
<abbr title=" 302      private static StreamExecutionEnvironment getStreamExeEnv(Properties confProperties, String deployMode) throws Exception {"> 302      private static StreamExecutionEnvironment getStreamExeEnv(Properties confProperties, String deployMode) throws🔵</abbr>
 303          StreamExecutionEnvironment env = !ClusterMode.local.name().equals(deployMode) ?
 304                  StreamExecutionEnvironment.getExecutionEnvironment() :
 305                  new MyLocalStreamEnvironment();
 306  
 307          StreamEnvConfigManager.streamExecutionEnvironmentConfig(env, confProperties);
 308          return env;
 309      }
 310  
<abbr title=" 311      private static StreamTableEnvironment getStreamTableEnv(StreamExecutionEnvironment env, Properties confProperties) {"> 311      private static StreamTableEnvironment getStreamTableEnv(StreamExecutionEnvironment env, Properties confPropert🔵</abbr>
 312          // use blink and streammode
 313          EnvironmentSettings settings = EnvironmentSettings.newInstance()
 314                  .useBlinkPlanner()
 315                  .inStreamingMode()
 316                  .build();
 317  
 318          StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, settings);
 319          StreamEnvConfigManager.streamTableEnvironmentStateTTLConfig(tableEnv, confProperties);
 320          return tableEnv;





 321      }
 322  }</pre></td>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   *     http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  
  20  package com.dtstack.flink.sql;
  21  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import com.dtstack.flink.sql.config.CalciteConfig;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import com.dtstack.flink.sql.classloader.ClassLoaderManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import com.dtstack.flink.sql.enums.ClusterMode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.dtstack.flink.sql.enums.ECacheType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import com.dtstack.flink.sql.environment.MyLocalStreamEnvironment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import com.dtstack.flink.sql.environment.StreamEnvConfigManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import com.dtstack.flink.sql.exec.FlinkSQLExec;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.dtstack.flink.sql.option.OptionParser;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.dtstack.flink.sql.parser.CreateFuncParser;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import com.dtstack.flink.sql.parser.CreateTmpTableParser;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import com.dtstack.flink.sql.parser.InsertSqlParser;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.dtstack.flink.sql.parser.SqlParser;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.dtstack.flink.sql.parser.SqlTree;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import com.dtstack.flink.sql.side.SideSqlExec;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import com.dtstack.flink.sql.side.SideTableInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import com.dtstack.flink.sql.table.SourceTableInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -import com.dtstack.flink.sql.table.TableInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -import com.dtstack.flink.sql.table.TargetTableInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -import com.dtstack.flink.sql.sink.StreamSinkFactory;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -import com.dtstack.flink.sql.source.StreamSourceFactory;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -import com.dtstack.flink.sql.util.DtStringUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -import com.dtstack.flink.sql.watermarker.WaterMarkerAssigner;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -import com.dtstack.flink.sql.function.FunctionManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -import org.apache.calcite.sql.SqlInsert;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -import org.apache.calcite.sql.SqlNode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -import org.apache.flink.api.common.typeinfo.TypeInformation;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -import org.apache.flink.api.java.tuple.Tuple2;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -import org.apache.flink.api.java.typeutils.RowTypeInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -import com.google.common.base.Strings;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -import com.google.common.collect.Lists;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -import com.google.common.collect.Maps;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -import com.google.common.collect.Sets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -import com.fasterxml.jackson.databind.ObjectMapper;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -import org.apache.flink.streaming.api.datastream.DataStream;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import com.dtstack.flink.sql.exec.ExecuteProcessHelper;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import com.dtstack.flink.sql.exec.ParamsInfo;</span>
  62  import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -import org.apache.flink.table.api.EnvironmentSettings;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -import org.apache.flink.table.api.Table;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -import org.apache.flink.table.api.TableEnvironment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -import org.apache.flink.table.api.java.StreamTableEnvironment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -import org.apache.flink.table.sinks.TableSink;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -import org.apache.flink.types.Row;</span>
  69  import org.slf4j.Logger;
  70  import org.slf4j.LoggerFactory;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -import java.io.File;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -import java.lang.reflect.InvocationTargetException;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -import java.net.URL;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -import java.net.URLClassLoader;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -import java.net.URLDecoder;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -import java.util.Map;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -import java.util.Properties;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -import java.util.Set;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -import com.dtstack.flink.sql.option.Options;</span>
  83  
  84  /**
  85   * Date: 2018/6/26
  86   * Company: www.dtstack.com
  87   * @author xuchao
  88   */
  89  
  90  public class Main {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -    private static final String CLASS_FILE_NAME_FMT = &quot;class_path_%d&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -    private static final ObjectMapper objMapper = new ObjectMapper();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -</span>
  96      private static final Logger LOG = LoggerFactory.getLogger(Main.class);
  97  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -</span>
  99      public static void main(String[] args) throws Exception {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -        OptionParser optionParser = new OptionParser(args);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -        Options options = optionParser.getOptions();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -        String sql = options.getSql();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -        String name = options.getName();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -        String addJarListStr = options.getAddjar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -        String localSqlPluginPath = options.getLocalSqlPluginPath();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -        String remoteSqlPluginPath = options.getRemoteSqlPluginPath();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -        String pluginLoadMode = options.getPluginLoadMode();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -        String deployMode = options.getMode();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -        String confProp = options.getConfProp();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -        sql = URLDecoder.decode(sql, Charsets.UTF_8.name());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -        SqlParser.setLocalSqlPluginRoot(localSqlPluginPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -        List&lt;String&gt; addJarFileList = Lists.newArrayList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        if (!Strings.isNullOrEmpty(addJarListStr)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -            addJarListStr = URLDecoder.decode(addJarListStr, Charsets.UTF_8.name());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -            addJarFileList = objMapper.readValue(addJarListStr, List.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -        confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -        Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -        StreamExecutionEnvironment env = getStreamExeEnv(confProperties, deployMode);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -        StreamTableEnvironment tableEnv = getStreamTableEnv(env, confProperties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -        List&lt;URL&gt; jarURList = Lists.newArrayList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -        SqlTree sqlTree = SqlParser.parseSql(sql);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -        //Get External jar to load</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -        for (String addJarPath : addJarFileList) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -            File tmpFile = new File(addJarPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -            jarURList.add(tmpFile.toURI().toURL());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -        Map&lt;String, SideTableInfo&gt; sideTableMap = Maps.newHashMap();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -        Map&lt;String, Table&gt; registerTableCache = Maps.newHashMap();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -        //register udf</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -        registerUserDefinedFunction(sqlTree, jarURList, tableEnv);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -        //register table schema</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 141 -        Set&lt;URL&gt; classPathSets = registerTable(sqlTree, env, tableEnv, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode, sideTableMap, registerTableCache);"> 141 -        Set&lt;URL&gt; classPathSets = registerTable(sqlTree, env, tableEnv, localSqlPluginPath, remoteSqlPluginPath, pl🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -        // cache classPathSets</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -        registerPluginUrlToCachedFile(env, classPathSets);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -        sqlTranslation(localSqlPluginPath, tableEnv, sqlTree, sideTableMap, registerTableCache);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -        if (env instanceof MyLocalStreamEnvironment) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -            ((MyLocalStreamEnvironment) env).setClasspaths(ClassLoaderManager.getClassPath());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -        env.execute(name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 154 -    private static void sqlTranslation(String localSqlPluginPath, StreamTableEnvironment tableEnv, SqlTree sqlTree, Map&lt;String, SideTableInfo&gt; sideTableMap, Map&lt;String, Table&gt; registerTableCache) throws Exception {"> 154 -    private static void sqlTranslation(String localSqlPluginPath, StreamTableEnvironment tableEnv, SqlTree sqlTree🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -        SideSqlExec sideSqlExec = new SideSqlExec();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -        sideSqlExec.setLocalSqlPluginPath(localSqlPluginPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -        for (CreateTmpTableParser.SqlParserResult result : sqlTree.getTmpSqlList()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -            sideSqlExec.registerTmpTable(result, sideTableMap, tableEnv, registerTableCache);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -        for (InsertSqlParser.SqlParseResult result : sqlTree.getExecSqlList()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -            if (LOG.isInfoEnabled()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -                LOG.info(&quot;exe-sql:\n&quot; + result.getExecSql());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -            boolean isSide = false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -            for (String tableName : result.getTargetTableList()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -                if (sqlTree.getTmpTableMap().containsKey(tableName)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -                    CreateTmpTableParser.SqlParserResult tmp = sqlTree.getTmpTableMap().get(tableName);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -                    String realSql = DtStringUtil.replaceIgnoreQuota(result.getExecSql(), &quot;`&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 171 -                    SqlNode sqlNode = org.apache.calcite.sql.parser.SqlParser.create(realSql, CalciteConfig.MYSQL_LEX_CONFIG).parseStmt();"> 171 -                    SqlNode sqlNode = org.apache.calcite.sql.parser.SqlParser.create(realSql, CalciteConfig.MYSQL_🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -                    String tmpSql = ((SqlInsert) sqlNode).getSource().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -                    tmp.setExecSql(tmpSql);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -                    sideSqlExec.registerTmpTable(tmp, sideTableMap, tableEnv, registerTableCache);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -                } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -                    for (String sourceTable : result.getSourceTableList()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -                        if (sideTableMap.containsKey(sourceTable)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -                            isSide = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -                            break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -                    if (isSide) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -                        //sql-dimensional table contains the dimension table of execution</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -                        sideSqlExec.exec(result.getExecSql(), sideTableMap, tableEnv, registerTableCache);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -                    } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -                        FlinkSQLExec.sqlUpdate(tableEnv, result.getExecSql());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -                        if (LOG.isInfoEnabled()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -                            LOG.info(&quot;exec sql: &quot; + result.getExecSql());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -                        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 199 -    private static void registerUserDefinedFunction(SqlTree sqlTree, List&lt;URL&gt; jarURList, TableEnvironment tableEnv)"> 199 -    private static void registerUserDefinedFunction(SqlTree sqlTree, List&lt;URL&gt; jarURList, TableEnvironment tableEn🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -            throws IllegalAccessException, InvocationTargetException {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -        // udf和tableEnv须由同一个类加载器加载</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -        ClassLoader levelClassLoader = tableEnv.getClass().getClassLoader();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -        URLClassLoader classLoader = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -        List&lt;CreateFuncParser.SqlParserResult&gt; funcList = sqlTree.getFunctionList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -        for (CreateFuncParser.SqlParserResult funcInfo : funcList) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -            //classloader</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -            if (classLoader == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -                classLoader = ClassLoaderManager.loadExtraJar(jarURList, (URLClassLoader) levelClassLoader);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 210 -            FunctionManager.registerUDF(funcInfo.getType(), funcInfo.getClassName(), funcInfo.getName(), tableEnv, classLoader);"> 210 -            FunctionManager.registerUDF(funcInfo.getType(), funcInfo.getClassName(), funcInfo.getName(), tableEnv,🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -     *    向Flink注册源表和结果表，返回执行时插件包的全路径</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -     * @param sqlTree</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -     * @param env</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -     * @param tableEnv</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -     * @param localSqlPluginPath</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -     * @param remoteSqlPluginPath</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -     * @param pluginLoadMode   插件加载模式 classpath or shipfile</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -     * @param sideTableMap</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -     * @param registerTableCache</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -     * @return</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -     * @throws Exception</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 227 -    private static Set&lt;URL&gt; registerTable(SqlTree sqlTree, StreamExecutionEnvironment env, StreamTableEnvironment tableEnv, String localSqlPluginPath,"> 227 -    private static Set&lt;URL&gt; registerTable(SqlTree sqlTree, StreamExecutionEnvironment env, StreamTableEnvironment 🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 228 -                                          String remoteSqlPluginPath, String pluginLoadMode, Map&lt;String, SideTableInfo&gt; sideTableMap, Map&lt;String, Table&gt; registerTableCache) throws Exception {"> 228 -                                          String remoteSqlPluginPath, String pluginLoadMode, Map&lt;String, SideTable🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -        Set&lt;URL&gt; pluginClassPatshSets = Sets.newHashSet();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -        WaterMarkerAssigner waterMarkerAssigner = new WaterMarkerAssigner();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -        for (TableInfo tableInfo : sqlTree.getTableInfoMap().values()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -            if (tableInfo instanceof SourceTableInfo) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -                SourceTableInfo sourceTableInfo = (SourceTableInfo) tableInfo;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 236 -                Table table = StreamSourceFactory.getStreamSource(sourceTableInfo, env, tableEnv, localSqlPluginPath);"> 236 -                Table table = StreamSourceFactory.getStreamSource(sourceTableInfo, env, tableEnv, localSqlPluginPa🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -                tableEnv.registerTable(sourceTableInfo.getAdaptName(), table);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 238 -                //Note --- parameter conversion function can not be used inside a function of the type of polymerization"> 238 -                //Note --- parameter conversion function can not be used inside a function of the type of polymeri🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -                //Create table in which the function is arranged only need adaptation sql</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -                String adaptSql = sourceTableInfo.getAdaptSelectSql();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -                Table adaptTable = adaptSql == null ? table : tableEnv.sqlQuery(adaptSql);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 243 -                RowTypeInfo typeInfo = new RowTypeInfo(adaptTable.getSchema().getFieldTypes(), adaptTable.getSchema().getFieldNames());"> 243 -                RowTypeInfo typeInfo = new RowTypeInfo(adaptTable.getSchema().getFieldTypes(), adaptTable.getSchem🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -                DataStream adaptStream = tableEnv.toRetractStream(adaptTable, typeInfo)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -                        .map((Tuple2&lt;Boolean, Row&gt; f0) -&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -                            return f0.f1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -                        })</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -                        .returns(typeInfo);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -                String fields = String.join(&quot;,&quot;, typeInfo.getFieldNames());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 251 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 252 -                if (waterMarkerAssigner.checkNeedAssignWaterMarker(sourceTableInfo)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -                    adaptStream = waterMarkerAssigner.assignWaterMarker(adaptStream, typeInfo, sourceTableInfo);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 254 -                    fields += &quot;,ROWTIME.ROWTIME&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -                } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 256 -                    fields += &quot;,PROCTIME.PROCTIME&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 258 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 259 -                Table regTable = tableEnv.fromDataStream(adaptStream, fields);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -                tableEnv.registerTable(tableInfo.getName(), regTable);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 261 -                if (LOG.isInfoEnabled()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 262 -                    LOG.info(&quot;registe table {} success.&quot;, tableInfo.getName());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 263 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -                registerTableCache.put(tableInfo.getName(), regTable);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 265 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 266 -                URL sourceTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), SourceTableInfo.SOURCE_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 266 -                URL sourceTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), SourceTa🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -                pluginClassPatshSets.add(sourceTablePathUrl);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 268 -            } else if (tableInfo instanceof TargetTableInfo) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 269 -                TableSink tableSink = StreamSinkFactory.getTableSink((TargetTableInfo) tableInfo, localSqlPluginPath);"> 269 -                TableSink tableSink = StreamSinkFactory.getTableSink((TargetTableInfo) tableInfo, localSqlPluginPa🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -                TypeInformation[] flinkTypes = FunctionManager.transformTypes(tableInfo.getFieldClasses());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -                tableEnv.registerTableSink(tableInfo.getName(), tableInfo.getFields(), flinkTypes, tableSink);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 273 -                URL sinkTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), TargetTableInfo.TARGET_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 273 -                URL sinkTablePathUrl = PluginUtil.buildSourceAndSinkPathByLoadMode(tableInfo.getType(), TargetTabl🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -                pluginClassPatshSets.add(sinkTablePathUrl);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -            } else if (tableInfo instanceof SideTableInfo) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 276 -                String sideOperator = ECacheType.ALL.name().equals(((SideTableInfo) tableInfo).getCacheType()) ? &quot;all&quot; : &quot;async&quot;;"> 276 -                String sideOperator = ECacheType.ALL.name().equals(((SideTableInfo) tableInfo).getCacheType()) ? &quot;🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -                sideTableMap.put(tableInfo.getName(), (SideTableInfo) tableInfo);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 279 -                URL sideTablePathUrl = PluginUtil.buildSidePathByLoadMode(tableInfo.getType(), sideOperator, SideTableInfo.TARGET_SUFFIX, localSqlPluginPath, remoteSqlPluginPath, pluginLoadMode);"> 279 -                URL sideTablePathUrl = PluginUtil.buildSidePathByLoadMode(tableInfo.getType(), sideOperator, SideT🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -                pluginClassPatshSets.add(sideTablePathUrl);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -            } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 282 -                throw new RuntimeException(&quot;not support table type:&quot; + tableInfo.getType());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 283 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -        return pluginClassPatshSets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -     *   将job依赖的插件包路径存储到cacheFile，在外围将插件包路径传递给jobgraph</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -     * @param env</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -     * @param classPathSet</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 293 -    private static void registerPluginUrlToCachedFile(StreamExecutionEnvironment env, Set&lt;URL&gt; classPathSet) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 294 -        int i = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 295 -        for (URL url : classPathSet) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 296 -            String classFileName = String.format(CLASS_FILE_NAME_FMT, i);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 297 -            env.registerCachedFile(url.getPath(), classFileName, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 298 -            i++;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 299 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 300 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 301 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 302 -    private static StreamExecutionEnvironment getStreamExeEnv(Properties confProperties, String deployMode) throws Exception {"> 302 -    private static StreamExecutionEnvironment getStreamExeEnv(Properties confProperties, String deployMode) throws🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 303 -        StreamExecutionEnvironment env = !ClusterMode.local.name().equals(deployMode) ?</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 304 -                StreamExecutionEnvironment.getExecutionEnvironment() :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 305 -                new MyLocalStreamEnvironment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -        StreamEnvConfigManager.streamExecutionEnvironmentConfig(env, confProperties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -        return env;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 311 -    private static StreamTableEnvironment getStreamTableEnv(StreamExecutionEnvironment env, Properties confProperties) {"> 311 -    private static StreamTableEnvironment getStreamTableEnv(StreamExecutionEnvironment env, Properties confPropert🔵</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -        // use blink and streammode</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -        EnvironmentSettings settings = EnvironmentSettings.newInstance()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -                .useBlinkPlanner()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -                .inStreamingMode()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -                .build();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -        StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, settings);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -        StreamEnvConfigManager.streamTableEnvironmentStateTTLConfig(tableEnv, confProperties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -        return tableEnv;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +        ParamsInfo paramsInfo = ExecuteProcessHelper.parseParams(args);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +        ExecuteProcessHelper.setLogLevel(paramsInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +        StreamExecutionEnvironment env = ExecuteProcessHelper.getStreamExecution(paramsInfo);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +        env.execute(paramsInfo.getName());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +        LOG.info(&quot;program {} execution success&quot;, paramsInfo.getName());</span>
 326      }
 327  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            